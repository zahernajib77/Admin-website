(window.webpackJsonp=window.webpackJsonp||[]).push([[1],{"/6Yf":function(t,e,n){"use strict";n.d(e,"a",function(){return o}),n.d(e,"b",function(){return c}),n.d(e,"c",function(){return a});var r=n("mrSG"),i=n("qOnz"),o=function(){function t(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}return t.prototype.setInstantiationMode=function(t){return this.instantiationMode=t,this},t.prototype.setMultipleInstances=function(t){return this.multipleInstances=t,this},t.prototype.setServiceProps=function(t){return this.serviceProps=t,this},t.prototype.setInstanceCreatedCallback=function(t){return this.onInstanceCreated=t,this},t}(),s="[DEFAULT]",a=function(){function t(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}return t.prototype.get=function(t){var e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){var n=new i.a;if(this.instancesDeferred.set(e,n),this.isInitialized(e)||this.shouldAutoInitialize())try{var r=this.getOrInitializeService({instanceIdentifier:e});r&&n.resolve(r)}catch(o){}}return this.instancesDeferred.get(e).promise},t.prototype.getImmediate=function(t){var e,n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error("Service "+this.name+" is not available")}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(i){if(r)return null;throw i}},t.prototype.getComponent=function(){return this.component},t.prototype.setComponent=function(t){var e,n;if(t.name!==this.name)throw Error("Mismatching Component "+t.name+" for Provider "+this.name+".");if(this.component)throw Error("Component for "+this.name+" has already been provided");if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:s})}catch(h){}try{for(var i=Object(r.g)(this.instancesDeferred.entries()),o=i.next();!o.done;o=i.next()){var a=Object(r.e)(o.value,2),c=a[1],l=this.normalizeInstanceIdentifier(a[0]);try{var u=this.getOrInitializeService({instanceIdentifier:l});c.resolve(u)}catch(h){}}}catch(d){e={error:d}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}}},t.prototype.clearInstance=function(t){void 0===t&&(t=s),this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)},t.prototype.delete=function(){return Object(r.b)(this,void 0,void 0,function(){var t;return Object(r.d)(this,function(e){switch(e.label){case 0:return t=Array.from(this.instances.values()),[4,Promise.all(Object(r.f)(Object(r.f)([],Object(r.e)(t.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))),Object(r.e)(t.filter(function(t){return"_delete"in t}).map(function(t){return t._delete()}))))];case 1:return e.sent(),[2]}})})},t.prototype.isComponentSet=function(){return null!=this.component},t.prototype.isInitialized=function(t){return void 0===t&&(t=s),this.instances.has(t)},t.prototype.getOptions=function(t){return void 0===t&&(t=s),this.instancesOptions.get(t)||{}},t.prototype.initialize=function(t){var e,n;void 0===t&&(t={});var i=t.options,o=void 0===i?{}:i,s=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(s))throw Error(this.name+"("+s+") has already been initialized");if(!this.isComponentSet())throw Error("Component "+this.name+" has not been registered yet");var a=this.getOrInitializeService({instanceIdentifier:s,options:o});try{for(var c=Object(r.g)(this.instancesDeferred.entries()),l=c.next();!l.done;l=c.next()){var u=Object(r.e)(l.value,2),h=u[1];s===this.normalizeInstanceIdentifier(u[0])&&h.resolve(a)}}catch(d){e={error:d}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}return a},t.prototype.onInit=function(t,e){var n,r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);var o=this.instances.get(r);return o&&t(o,r),function(){i.delete(t)}},t.prototype.invokeOnInitCallbacks=function(t,e){var n,i,o=this.onInitCallbacks.get(e);if(o)try{for(var s=Object(r.g)(o),a=s.next();!a.done;a=s.next()){var c=a.value;try{c(t,e)}catch(l){}}}catch(u){n={error:u}}finally{try{a&&!a.done&&(i=s.return)&&i.call(s)}finally{if(n)throw n.error}}},t.prototype.getOrInitializeService=function(t){var e,n=t.instanceIdentifier,r=t.options,i=void 0===r?{}:r,o=this.instances.get(n);if(!o&&this.component&&(o=this.component.instanceFactory(this.container,{instanceIdentifier:(e=n,e===s?void 0:e),options:i}),this.instances.set(n,o),this.instancesOptions.set(n,i),this.invokeOnInitCallbacks(o,n),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,n,o)}catch(a){}return o||null},t.prototype.normalizeInstanceIdentifier=function(t){return void 0===t&&(t=s),this.component?this.component.multipleInstances?t:s:t},t.prototype.shouldAutoInitialize=function(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode},t}(),c=function(){function t(t){this.name=t,this.providers=new Map}return t.prototype.addComponent=function(t){var e=this.getProvider(t.name);if(e.isComponentSet())throw new Error("Component "+t.name+" has already been registered with "+this.name);e.setComponent(t)},t.prototype.addOrOverwriteComponent=function(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)},t.prototype.getProvider=function(t){if(this.providers.has(t))return this.providers.get(t);var e=new a(t,this);return this.providers.set(t,e),e},t.prototype.getProviders=function(){return Array.from(this.providers.values())},t}()},0:function(t,e,n){t.exports=n("zUnb")},"2QA8":function(t,e,n){"use strict";n.d(e,"a",function(){return r});const r=(()=>"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random())()},"2fFW":function(t,e,n){"use strict";n.d(e,"a",function(){return i});let r=!1;const i={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){if(t){const t=new Error;console.warn("DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n"+t.stack)}else r&&console.log("RxJS: Back to a better error behavior. Thank you. <3");r=t},get useDeprecatedSynchronousErrorHandling(){return r}}},"3N8a":function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n("quSY");class i extends r.a{constructor(t,e){super()}schedule(t,e=0){return this}}class o extends i{constructor(t,e){super(t,e),this.scheduler=t,this.work=e,this.pending=!1}schedule(t,e=0){if(this.closed)return this;this.state=t;const n=this.id,r=this.scheduler;return null!=n&&(this.id=this.recycleAsyncId(r,n,e)),this.pending=!0,this.delay=e,this.id=this.id||this.requestAsyncId(r,this.id,e),this}requestAsyncId(t,e,n=0){return setInterval(t.flush.bind(t,this),n)}recycleAsyncId(t,e,n=0){if(null!==n&&this.delay===n&&!1===this.pending)return e;clearInterval(e)}execute(t,e){if(this.closed)return new Error("executing a cancelled action");this.pending=!1;const n=this._execute(t,e);if(n)return n;!1===this.pending&&null!=this.id&&(this.id=this.recycleAsyncId(this.scheduler,this.id,null))}_execute(t,e){let n,r=!1;try{this.work(t)}catch(i){r=!0,n=!!i&&i||new Error(i)}if(r)return this.unsubscribe(),n}_unsubscribe(){const t=this.id,e=this.scheduler,n=e.actions,r=n.indexOf(this);this.work=null,this.state=null,this.pending=!1,this.scheduler=null,-1!==r&&n.splice(r,1),null!=t&&(this.id=this.recycleAsyncId(e,t,null)),this.delay=null}}},"3UD+":function(t,e){t.exports=function(t){if(!t.webpackPolyfill){var e=Object.create(t);e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),Object.defineProperty(e,"exports",{enumerable:!0}),e.webpackPolyfill=1}return e}},"4ZJM":function(t,e,n){t.exports=function(){"use strict";var t,e,n;function r(r,i){if(t)if(e){var o="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+t+")(sharedChunk); ("+e+")(sharedChunk); self.onerror = null;",s={};t(s),n=i(s),"undefined"!=typeof window&&window&&window.URL&&window.URL.createObjectURL&&(n.workerUrl=window.URL.createObjectURL(new Blob([o],{type:"text/javascript"})))}else e=i;else t=i}return r(0,function(t){var e="2.8.2",n=r;function r(t,e,n,r){this.cx=3*t,this.bx=3*(n-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*e,this.by=3*(r-e)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=r,this.p2x=n,this.p2y=r}r.prototype.sampleCurveX=function(t){return((this.ax*t+this.bx)*t+this.cx)*t},r.prototype.sampleCurveY=function(t){return((this.ay*t+this.by)*t+this.cy)*t},r.prototype.sampleCurveDerivativeX=function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},r.prototype.solveCurveX=function(t,e){var n,r,i,o,s;for(void 0===e&&(e=1e-6),i=t,s=0;s<8;s++){if(o=this.sampleCurveX(i)-t,Math.abs(o)<e)return i;var a=this.sampleCurveDerivativeX(i);if(Math.abs(a)<1e-6)break;i-=o/a}if((i=t)<(n=0))return n;if(i>(r=1))return r;for(;n<r;){if(o=this.sampleCurveX(i),Math.abs(o-t)<e)return i;t>o?n=i:r=i,i=.5*(r-n)+n}return i},r.prototype.solve=function(t,e){return this.sampleCurveY(this.solveCurveX(t,e))};var i=o;function o(t,e){this.x=t,this.y=e}o.prototype={clone:function(){return new o(this.x,this.y)},add:function(t){return this.clone()._add(t)},sub:function(t){return this.clone()._sub(t)},multByPoint:function(t){return this.clone()._multByPoint(t)},divByPoint:function(t){return this.clone()._divByPoint(t)},mult:function(t){return this.clone()._mult(t)},div:function(t){return this.clone()._div(t)},rotate:function(t){return this.clone()._rotate(t)},rotateAround:function(t,e){return this.clone()._rotateAround(t,e)},matMult:function(t){return this.clone()._matMult(t)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(t){return this.x===t.x&&this.y===t.y},dist:function(t){return Math.sqrt(this.distSqr(t))},distSqr:function(t){var e=t.x-this.x,n=t.y-this.y;return e*e+n*n},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(t){return Math.atan2(this.y-t.y,this.x-t.x)},angleWith:function(t){return this.angleWithSep(t.x,t.y)},angleWithSep:function(t,e){return Math.atan2(this.x*e-this.y*t,this.x*t+this.y*e)},_matMult:function(t){var e=t[2]*this.x+t[3]*this.y;return this.x=t[0]*this.x+t[1]*this.y,this.y=e,this},_add:function(t){return this.x+=t.x,this.y+=t.y,this},_sub:function(t){return this.x-=t.x,this.y-=t.y,this},_mult:function(t){return this.x*=t,this.y*=t,this},_div:function(t){return this.x/=t,this.y/=t,this},_multByPoint:function(t){return this.x*=t.x,this.y*=t.y,this},_divByPoint:function(t){return this.x/=t.x,this.y/=t.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var t=this.y;return this.y=this.x,this.x=-t,this},_rotate:function(t){var e=Math.cos(t),n=Math.sin(t),r=n*this.x+e*this.y;return this.x=e*this.x-n*this.y,this.y=r,this},_rotateAround:function(t,e){var n=Math.cos(t),r=Math.sin(t),i=e.y+r*(this.x-e.x)+n*(this.y-e.y);return this.x=e.x+n*(this.x-e.x)-r*(this.y-e.y),this.y=i,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},o.convert=function(t){return t instanceof o?t:Array.isArray(t)?new o(t[0],t[1]):t};var s="undefined"!=typeof self?self:{};const a=Math.PI/180,c=180/Math.PI;function l(t){return t*a}function u(t){return t*c}const h=[[0,0],[1,0],[1,1],[0,1]];function d(t){if(t<=0)return 0;if(t>=1)return 1;const e=t*t,n=e*t;return 4*(t<.5?n:3*(t-e)+n-.75)}function p(t,e,r,i){const o=new n(t,e,r,i);return function(t){return o.solve(t)}}const f=p(.25,.1,.25,1);function m(t,e,n){return Math.min(n,Math.max(e,t))}function g(t,e,n){return(n=m((n-t)/(e-t),0,1))*n*(3-2*n)}function _(t,e,n){const r=n-e,i=((t-e)%r+r)%r+e;return i===e?n:i}function y(t,e,n){if(!t.length)return n(null,[]);let r=t.length;const i=new Array(t.length);let o=null;t.forEach((t,s)=>{e(t,(t,e)=>{t&&(o=t),i[s]=e,0==--r&&n(o,i)})})}function v(t){const e=[];for(const n in t)e.push(t[n]);return e}function b(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}let x=1;function w(){return x++}function T(){return function t(e){return e?(e^Math.random()*(16>>e/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,t)}()}function C(t){return t<=1?1:Math.pow(2,Math.ceil(Math.log(t)/Math.LN2))}function E(t){return!!t&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(t)}function S(t,e){t.forEach(t=>{e[t]&&(e[t]=e[t].bind(e))})}function I(t,e){return-1!==t.indexOf(e,t.length-e.length)}function k(t,e,n){const r={};for(const i in t)r[i]=e.call(n||this,t[i],i,t);return r}function A(t,e,n){const r={};for(const i in t)e.call(n||this,t[i],i,t)&&(r[i]=t[i]);return r}function M(t){return Array.isArray(t)?t.map(M):"object"==typeof t&&t?k(t,M):t}const O={};function P(t){O[t]||("undefined"!=typeof console&&console.warn(t),O[t]=!0)}function D(t,e,n){return(n.y-t.y)*(e.x-t.x)>(e.y-t.y)*(n.x-t.x)}function R(t){let e=0;for(let n,r,i=0,o=t.length,s=o-1;i<o;s=i++)n=t[i],r=t[s],e+=(r.x-n.x)*(n.y+r.y);return e}function N(){return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope}function L(t){const e={};if(t.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(t,n,r,i)=>{const o=r||i;return e[n]=!o||o.toLowerCase(),""}),e["max-age"]){const t=parseInt(e["max-age"],10);isNaN(t)?delete e["max-age"]:e["max-age"]=t}return e}let j,z,F,B,U=null;function V(t){if(null==U){const e=t.navigator?t.navigator.userAgent:null;U=!!t.safari||!(!e||!(/\b(iPad|iPhone|iPod)\b/.test(e)||e.match("Safari")&&!e.match("Chrome")))}return U}function q(t){try{const e=s[t];return e.setItem("_mapbox_test_",1),e.removeItem("_mapbox_test_"),!0}catch(t){return!1}}const G={now:()=>void 0!==F?F:s.performance.now(),setNow(t){F=t},restoreNow(){F=void 0},frame(t){const e=s.requestAnimationFrame(t);return{cancel:()=>s.cancelAnimationFrame(e)}},getImageData(t,e=0){const{width:n,height:r}=t;B||(B=s.document.createElement("canvas"));const i=B.getContext("2d");if(!i)throw new Error("failed to create canvas 2d context");return(n>B.width||r>B.height)&&(B.width=n,B.height=r),i.clearRect(-e,-e,n+2*e,r+2*e),i.drawImage(t,0,0,n,r),i.getImageData(-e,-e,n+2*e,r+2*e)},resolveURL:t=>(j||(j=s.document.createElement("a")),j.href=t,j.href),get devicePixelRatio(){return s.devicePixelRatio},get prefersReducedMotion(){return!!s.matchMedia&&(null==z&&(z=s.matchMedia("(prefers-reduced-motion: reduce)")),z.matches)}};let $;const W={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){if(null==$){const t=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;try{$=null!=process.env.API_URL_REGEX?new RegExp(process.env.API_URL_REGEX):t}catch(e){$=t}}return $},get EVENTS_URL(){return this.API_URL?0===this.API_URL.indexOf("https://api.mapbox.cn")?"https://events.mapbox.cn/events/v2":0===this.API_URL.indexOf("https://api.mapbox.com")?"https://events.mapbox.com/events/v2":null:null},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},H={supported:!1,testSupport:function(t){!X&&K&&(Y?Q(t):Z=t)}};let Z,K,X=!1,Y=!1;function Q(t){const e=t.createTexture();t.bindTexture(t.TEXTURE_2D,e);try{if(t.texImage2D(t.TEXTURE_2D,0,t.RGBA,t.RGBA,t.UNSIGNED_BYTE,K),t.isContextLost())return;H.supported=!0}catch(t){}t.deleteTexture(e),X=!0}s.document&&(K=s.document.createElement("img"),K.onload=function(){Z&&Q(Z),Z=null,Y=!0},K.onerror=function(){X=!0,Z=null},K.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const J="01",tt="NO_ACCESS_TOKEN";function et(t){return 0===t.indexOf("mapbox:")}function nt(t){return W.API_URL_REGEX.test(t)}const rt=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function it(t){const e=t.match(rt);if(!e)throw new Error("Unable to parse URL object");return{protocol:e[1],authority:e[2],path:e[3]||"/",params:e[4]?e[4].split("&"):[]}}function ot(t){const e=t.params.length?`?${t.params.join("&")}`:"";return`${t.protocol}://${t.authority}${t.path}${e}`}function st(t){if(!t)return null;const e=t.split(".");if(!e||3!==e.length)return null;try{return JSON.parse(decodeURIComponent(s.atob(e[1]).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join("")))}catch(t){return null}}class at{constructor(t){this.type=t,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const e=st(W.ACCESS_TOKEN);let n="";return n=e&&e.u?s.btoa(encodeURIComponent(e.u).replace(/%([0-9A-F]{2})/g,(t,e)=>String.fromCharCode(Number("0x"+e)))):W.ACCESS_TOKEN||"",t?`mapbox.eventData.${t}:${n}`:`mapbox.eventData:${n}`}fetchEventData(){const t=q("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{const t=s.localStorage.getItem(e);t&&(this.eventData=JSON.parse(t));const r=s.localStorage.getItem(n);r&&(this.anonId=r)}catch(t){P("Unable to read from LocalStorage")}}saveEventData(){const t=q("localStorage"),e=this.getStorageKey(),n=this.getStorageKey("uuid");if(t)try{s.localStorage.setItem(n,this.anonId),Object.keys(this.eventData).length>=1&&s.localStorage.setItem(e,JSON.stringify(this.eventData))}catch(t){P("Unable to write to LocalStorage")}}processRequests(t){}postEvent(t,n,r,i){if(!W.EVENTS_URL)return;const o=it(W.EVENTS_URL);o.params.push(`access_token=${i||W.ACCESS_TOKEN||""}`);const s={event:this.type,created:new Date(t).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:e,skuId:J,userId:this.anonId},a=n?b(s,n):s,c={url:ot(o),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=kt(c,t=>{this.pendingRequest=null,r(t),this.saveEventData(),this.processRequests(i)})}queueRequest(t,e){this.queue.push(t),this.processRequests(e)}}const ct=new class extends at{constructor(t){super("appUserTurnstile"),this._customAccessToken=t}postTurnstileEvent(t,e){W.EVENTS_URL&&W.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>et(t)||nt(t))&&this.queueRequest(Date.now(),e)}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const e=st(W.ACCESS_TOKEN),n=e?e.u:W.ACCESS_TOKEN;let r=n!==this.eventData.tokenU;E(this.anonId)||(this.anonId=T(),r=!0);const i=this.queue.shift();if(this.eventData.lastSuccess){const t=new Date(this.eventData.lastSuccess),e=new Date(i),n=(i-this.eventData.lastSuccess)/864e5;r=r||n>=1||n<-1||t.getDate()!==e.getDate()}else r=!0;r?this.postEvent(i,{"enabled.telemetry":!1},t=>{t||(this.eventData.lastSuccess=i,this.eventData.tokenU=n)},t):this.processRequests()}},lt=ct.postTurnstileEvent.bind(ct),ut=new class extends at{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,e,n,r){this.skuToken=e,this.errorCb=r,W.EVENTS_URL&&(n||W.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(tt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||(this.anonId||this.fetchEventData(),E(this.anonId)||(this.anonId=T()),this.postEvent(n,{skuToken:this.skuToken},t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t))}},ht=ut.postMapLoadEvent.bind(ut),dt=new class extends at{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,e,n,r){if(!W.API_URL||!W.SESSION_PATH)return;const i=it(W.API_URL+W.SESSION_PATH);i.params.push(`sku=${e||""}`),i.params.push(`access_token=${r||W.ACCESS_TOKEN||""}`);const o={url:ot(i),headers:{"Content-Type":"text/plain"}};this.pendingRequest=At(o,t=>{this.pendingRequest=null,n(t),this.saveEventData(),this.processRequests(r)})}getSessionAPI(t,e,n,r){this.skuToken=e,this.errorCb=r,W.SESSION_PATH&&W.API_URL&&(n||W.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(tt)))}processRequests(t){if(this.pendingRequest||0===this.queue.length)return;const{id:e,timestamp:n}=this.queue.shift();e&&this.success[e]||this.getSession(n,this.skuToken,t=>{t?this.errorCb(t):e&&(this.success[e]=!0)},t)}},pt=dt.getSessionAPI.bind(dt),ft=new Set,mt="mapbox-tiles";let gt,_t,yt=500,vt=50;function bt(){s.caches&&!gt&&(gt=s.caches.open(mt))}function xt(t){const e=t.indexOf("?");return e<0?t:t.slice(0,e)}let wt=1/0;const Tt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};"function"==typeof Object.freeze&&Object.freeze(Tt);class Ct extends Error{constructor(t,e,n){401===e&&nt(n)&&(t+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),super(t),this.status=e,this.url=n}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Et=N()?()=>self.worker&&self.worker.referrer:()=>("blob:"===s.location.protocol?s.parent:s).location.href,St=function(t,e){if(!(/^file:/.test(n=t.url)||/^file:/.test(Et())&&!/^\w+:/.test(n))){if(s.fetch&&s.Request&&s.AbortController&&s.Request.prototype.hasOwnProperty("signal"))return function(t,e){const n=new s.AbortController,r=new s.Request(t.url,{method:t.method||"GET",body:t.body,credentials:t.credentials,headers:t.headers,referrer:Et(),signal:n.signal});let i=!1,o=!1;const a=(c=r.url).indexOf("sku=")>0&&nt(c);var c;"json"===t.type&&r.headers.set("Accept","application/json");const l=(n,i,c)=>{if(o)return;if(n&&"SecurityError"!==n.message&&P(n),i&&c)return u(i);const l=Date.now();s.fetch(r).then(n=>{if(n.ok){const t=a?n.clone():null;return u(n,t,l)}return e(new Ct(n.statusText,n.status,t.url))}).catch(t=>{20!==t.code&&e(new Error(t.message))})},u=(n,a,c)=>{("arrayBuffer"===t.type?n.arrayBuffer():"json"===t.type?n.json():n.text()).then(t=>{o||(a&&c&&function(t,e,n){if(bt(),!gt)return;const r={status:e.status,statusText:e.statusText,headers:new s.Headers};e.headers.forEach((t,e)=>r.headers.set(e,t));const i=L(e.headers.get("Cache-Control")||"");if(i["no-store"])return;i["max-age"]&&r.headers.set("Expires",new Date(n+1e3*i["max-age"]).toUTCString());const o=r.headers.get("Expires");o&&(new Date(o).getTime()-n<42e4||function(t,e){if(void 0===_t)try{new Response(new ReadableStream),_t=!0}catch(t){_t=!1}_t?e(t.body):t.blob().then(e)}(e,e=>{const n=new s.Response(e,r);bt(),gt&&gt.then(e=>e.put(xt(t.url),n)).catch(t=>P(t.message))}))}(r,a,c),i=!0,e(null,t,n.headers.get("Cache-Control"),n.headers.get("Expires")))}).catch(t=>{o||e(new Error(t.message))})};return a?function(t,e){if(bt(),!gt)return e(null);const n=xt(t.url);gt.then(t=>{t.match(n).then(r=>{const i=function(t){if(!t)return!1;const e=new Date(t.headers.get("Expires")||0),n=L(t.headers.get("Cache-Control")||"");return e>Date.now()&&!n["no-cache"]}(r);t.delete(n),i&&t.put(n,r.clone()),e(null,r,i)}).catch(e)}).catch(e)}(r,l):l(null,null),{cancel:()=>{o=!0,i||n.abort()}}}(t,e);if(N()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",t,e,void 0,!0)}var n;return function(t,e){const n=new s.XMLHttpRequest;n.open(t.method||"GET",t.url,!0),"arrayBuffer"===t.type&&(n.responseType="arraybuffer");for(const r in t.headers)n.setRequestHeader(r,t.headers[r]);return"json"===t.type&&(n.responseType="text",n.setRequestHeader("Accept","application/json")),n.withCredentials="include"===t.credentials,n.onerror=()=>{e(new Error(n.statusText))},n.onload=()=>{if((n.status>=200&&n.status<300||0===n.status)&&null!==n.response){let r=n.response;if("json"===t.type)try{r=JSON.parse(n.response)}catch(t){return e(t)}e(null,r,n.getResponseHeader("Cache-Control"),n.getResponseHeader("Expires"))}else e(new Ct(n.statusText,n.status,t.url))},n.send(t.body),{cancel:()=>n.abort()}}(t,e)},It=function(t,e){return St(b(t,{type:"arrayBuffer"}),e)},kt=function(t,e){return St(b(t,{method:"POST"}),e)},At=function(t,e){return St(b(t,{method:"GET"}),e)};function Mt(t){const e=s.document.createElement("a");return e.href=t,e.protocol===s.document.location.protocol&&e.host===s.document.location.host}const Ot="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Pt,Dt;Pt=[],Dt=0;const Rt=function(t,e){if(H.supported&&(t.headers||(t.headers={}),t.headers.accept="image/webp,*/*"),Dt>=W.MAX_PARALLEL_IMAGE_REQUESTS){const n={requestParameters:t,callback:e,cancelled:!1,cancel(){this.cancelled=!0}};return Pt.push(n),n}Dt++;let n=!1;const r=()=>{if(!n)for(n=!0,Dt--;Pt.length&&Dt<W.MAX_PARALLEL_IMAGE_REQUESTS;){const t=Pt.shift(),{requestParameters:e,callback:n,cancelled:r}=t;r||(t.cancel=Rt(e,n).cancel)}},i=It(t,(t,n,i,o)=>{r(),t?e(t):n&&(s.createImageBitmap?function(t,e){const n=new s.Blob([new Uint8Array(t)],{type:"image/png"});s.createImageBitmap(n).then(t=>{e(null,t)}).catch(t=>{e(new Error(`Could not load image because of ${t.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(n,(t,n)=>e(t,n,i,o)):function(t,e){const n=new s.Image,r=s.URL;n.onload=()=>{e(null,n),r.revokeObjectURL(n.src),n.onload=null,s.requestAnimationFrame(()=>{n.src=Ot})},n.onerror=()=>e(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const i=new s.Blob([new Uint8Array(t)],{type:"image/png"});n.src=t.byteLength?r.createObjectURL(i):Ot}(n,(t,n)=>e(t,n,i,o)))});return{cancel:()=>{i.cancel(),r()}}};function Nt(t,e,n){n[t]&&-1!==n[t].indexOf(e)||(n[t]=n[t]||[],n[t].push(e))}function Lt(t,e,n){if(n&&n[t]){const r=n[t].indexOf(e);-1!==r&&n[t].splice(r,1)}}class jt{constructor(t,e={}){b(this,e),this.type=t}}class zt extends jt{constructor(t,e={}){super("error",b({error:t},e))}}class Ft{on(t,e){return this._listeners=this._listeners||{},Nt(t,e,this._listeners),this}off(t,e){return Lt(t,e,this._listeners),Lt(t,e,this._oneTimeListeners),this}once(t,e){return e?(this._oneTimeListeners=this._oneTimeListeners||{},Nt(t,e,this._oneTimeListeners),this):new Promise(e=>this.once(t,e))}fire(t,e){"string"==typeof t&&(t=new jt(t,e||{}));const n=t.type;if(this.listens(n)){t.target=this;const e=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of e)n.call(this,t);const r=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const o of r)Lt(n,o,this._oneTimeListeners),o.call(this,t);const i=this._eventedParent;i&&(b(t,"function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData),i.fire(t))}else t instanceof zt&&console.error(t.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,e){return this._eventedParent=t,this._eventedParentData=e,this}}var Bt=JSON.parse('{"$version":8,"$root":{"version":{"required":true,"type":"enum","values":[8]},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360,"units":"degrees"},"pitch":{"type":"number","default":0,"units":"degrees"},"light":{"type":"light"},"terrain":{"type":"terrain"},"fog":{"type":"fog"},"sources":{"required":true,"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"required":true,"type":"array","value":"layer"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],"source_vector":{"type":{"required":true,"type":"enum","values":{"vector":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"required":true,"type":"enum","values":{"raster":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"scheme":{"type":"enum","values":{"xyz":{},"tms":{}},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"required":true,"type":"enum","values":{"raster-dem":{}}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512,"units":"pixels"},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":{},"mapbox":{}},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"required":true,"type":"enum","values":{"geojson":{}}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"}},"source_video":{"type":{"required":true,"type":"enum","values":{"video":{}}},"urls":{"required":true,"type":"array","value":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"required":true,"type":"enum","values":{"image":{}}},"url":{"required":true,"type":"string"},"coordinates":{"required":true,"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"layer":{"id":{"type":"string","required":true},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"raster":{},"hillshade":{},"background":{},"sky":{}},"required":true},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"}},"layout":["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background","layout_sky"],"layout_background":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":{},"round":{},"square":{}},"default":"butt","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":{},"round":{},"miter":{}},"default":"miter","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"requires":[{"line-join":"miter"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-round-limit":{"type":"number","default":1.05,"requires":[{"line-join":"round"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":{},"line":{},"line-center":{}},"default":"point","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-spacing":{"type":"number","default":250,"minimum":1,"units":"pixels","requires":[{"symbol-placement":"line"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{"type":"number","expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":{},"viewport-y":{},"source":{}},"default":"auto","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{"type":"boolean","default":false,"requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-optional":{"type":"boolean","default":false,"requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-size":{"type":"number","default":1,"minimum":0,"units":"factor of the original icon size","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{"type":"enum","values":{"none":{},"width":{},"height":{},"both":{}},"default":"none","requires":["icon-image","text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"units":"pixels","requires":["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-image":{"type":"resolvedImage","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{"type":"boolean","default":false,"requires":["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{"type":"enum","values":{"map":{},"viewport":{},"auto":{}},"default":"auto","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{"type":"number","default":10,"minimum":0,"units":"ems","requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"units":"ems","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":{},"left":{},"center":{},"right":{}},"default":"center","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","units":"ems","default":0,"requires":["text-field"],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"requires":["text-field",{"symbol-placement":["point"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-anchor":{"type":"enum","values":{"center":{},"left":{},"right":{},"top":{},"bottom":{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},"default":"center","requires":["text-field",{"!":"text-variable-anchor"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"units":"degrees","requires":["text-field",{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":{},"vertical":{}},"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-rotate":{"type":"number","default":0,"period":360,"units":"degrees","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-keep-upright":{"type":"boolean","default":true,"requires":["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-transform":{"type":"enum","values":{"none":{},"uppercase":{},"lowercase":{}},"default":"none","requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","units":"ems","length":2,"default":[0,0],"requires":["text-field",{"!":"text-radial-offset"}],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{"type":"boolean","default":false,"requires":["text-field"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-optional":{"type":"boolean","default":false,"requires":["text-field","icon-image"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":{},"none":{}},"default":"visible","property-type":"constant"}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"transition":false,"property-type":"data-driven","expression":{"interpolated":false,"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},"in":{},"!in":{},"all":{},"any":{},"none":{},"has":{},"!has":{},"within":{}}},"geometry_type":{"type":"enum","values":{"Point":{},"LineString":{},"Polygon":{}}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":{},"exponential":{},"interval":{},"categorical":{}},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":{},"lab":{},"hcl":{}},"default":"rgb"},"default":{"type":"*","required":false}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"horizon-blend":{"type":"number","property-type":"data-constant","default":0.1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":{},"viewport":{}},"property-type":"data-constant","transition":false,"expression":{"interpolated":false,"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","property-type":"data-constant","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","property-type":"data-constant","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"intensity":{"type":"number","property-type":"data-constant","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":{},"equalEarth":{},"equirectangular":{},"lambertConformalConic":{},"mercator":{},"naturalEarth":{},"winkelTripel":{}},"default":"mercator","required":true},"center":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]},"parallels":{"type":"array","length":2,"value":"number","property-type":"data-constant","transition":false,"requires":[{"name":["albers","lambertConformalConic"]}]}},"terrain":{"source":{"type":"string","required":true},"exaggeration":{"type":"number","property-type":"data-constant","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background","paint_sky"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","transition":true,"requires":[{"!":"fill-pattern"},{"fill-antialias":true}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"fill-extrusion-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["fill-extrusion-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"units":"meters","transition":true,"requires":["fill-extrusion-height"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"line-pattern"}],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["line-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"transition":true,"units":"line widths","requires":[{"!":"line-pattern"}],"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{"type":"color","transition":false,"requires":[{"!":"line-pattern"},{"source":"geojson","has":{"lineMetrics":true}}],"expression":{"interpolated":true,"parameters":["line-progress"]},"property-type":"color-ramp"}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["circle-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"units":"pixels","expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"transition":false,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"transition":false,"expression":{"interpolated":true,"parameters":["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["icon-image"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["icon-image","icon-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","transition":true,"overridable":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","transition":true,"requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"units":"pixels","requires":["text-field"],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"map","requires":["text-field","text-translate"],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"units":"degrees","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"raster-resampling":{"type":"enum","values":{"linear":{},"nearest":{}},"default":"linear","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"transition":false,"units":"milliseconds","expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"transition":false,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{"type":"enum","values":{"map":{},"viewport":{}},"default":"viewport","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{"type":"color","default":"#000000","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_background":{"background-color":{"type":"color","default":"#000000","transition":true,"requires":[{"!":"background-pattern"}],"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"},"background-pattern":{"type":"resolvedImage","transition":true,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"cross-faded"},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":{},"atmosphere":{}},"default":"atmosphere","expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"requires":[{"sky-type":"atmosphere"}],"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-atmosphere-sun-intensity":{"type":"number","requires":[{"sky-type":"atmosphere"}],"default":10,"minimum":0,"maximum":100,"transition":false,"property-type":"data-constant"},"sky-gradient-center":{"type":"array","requires":[{"sky-type":"gradient"}],"value":"number","default":[0,0],"length":2,"units":"degrees","minimum":[0,0],"maximum":[360,180],"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient-radius":{"type":"number","requires":[{"sky-type":"gradient"}],"default":90,"minimum":0,"maximum":180,"transition":false,"expression":{"interpolated":false,"parameters":["zoom"]},"property-type":"data-constant"},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"transition":false,"requires":[{"sky-type":"gradient"}],"expression":{"interpolated":true,"parameters":["sky-radial-progress"]},"property-type":"color-ramp"},"sky-atmosphere-halo-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-atmosphere-color":{"type":"color","default":"white","transition":false,"requires":[{"sky-type":"atmosphere"}],"property-type":"data-constant"},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"property-type":"data-constant"}},"transition":{"duration":{"type":"number","default":300,"minimum":0,"units":"milliseconds"},"delay":{"type":"number","default":0,"minimum":0,"units":"milliseconds"}},"property-type":{"data-driven":{"type":"property-type"},"cross-faded":{"type":"property-type"},"cross-faded-data-driven":{"type":"property-type"},"color-ramp":{"type":"property-type"},"data-constant":{"type":"property-type"},"constant":{"type":"property-type"}},"promoteId":{"*":{"type":"string"}}}');function Ut(t,...e){for(const n of e)for(const e in n)t[e]=n[e];return t}function Vt(t){return t instanceof Number||t instanceof String||t instanceof Boolean?t.valueOf():t}function qt(t){if(Array.isArray(t))return t.map(qt);if(t instanceof Object&&!(t instanceof Number||t instanceof String||t instanceof Boolean)){const e={};for(const n in t)e[n]=qt(t[n]);return e}return Vt(t)}class Gt extends Error{constructor(t,e){super(e),this.message=e,this.key=t}}class $t{constructor(t,e=[]){this.parent=t,this.bindings={};for(const[n,r]of e)this.bindings[n]=r}concat(t){return new $t(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const Wt={kind:"null"},Ht={kind:"number"},Zt={kind:"string"},Kt={kind:"boolean"},Xt={kind:"color"},Yt={kind:"object"},Qt={kind:"value"},Jt={kind:"collator"},te={kind:"formatted"},ee={kind:"resolvedImage"};function ne(t,e){return{kind:"array",itemType:t,N:e}}function re(t){if("array"===t.kind){const e=re(t.itemType);return"number"==typeof t.N?`array<${e}, ${t.N}>`:"value"===t.itemType.kind?"array":`array<${e}>`}return t.kind}const ie=[Wt,Ht,Zt,Kt,Xt,te,Yt,ne(Qt),ee];function oe(t,e){if("error"===e.kind)return null;if("array"===t.kind){if("array"===e.kind&&(0===e.N&&"value"===e.itemType.kind||!oe(t.itemType,e.itemType))&&("number"!=typeof t.N||t.N===e.N))return null}else{if(t.kind===e.kind)return null;if("value"===t.kind)for(const t of ie)if(!oe(t,e))return null}return`Expected ${re(t)} but found ${re(e)} instead.`}function se(t,e){return e.some(e=>e.kind===t.kind)}function ae(t,e){return e.some(e=>"null"===e?null===t:"array"===e?Array.isArray(t):"object"===e?t&&!Array.isArray(t)&&"object"==typeof t:e===typeof t)}function ce(t){var e={exports:{}};return t(e,e.exports),e.exports}var le=ce(function(t,e){var n={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function r(t){return(t=Math.round(t))<0?0:t>255?255:t}function i(t){return r("%"===t[t.length-1]?parseFloat(t)/100*255:parseInt(t))}function o(t){return(e="%"===t[t.length-1]?parseFloat(t)/100:parseFloat(t))<0?0:e>1?1:e;var e}function s(t,e,n){return n<0?n+=1:n>1&&(n-=1),6*n<1?t+(e-t)*n*6:2*n<1?e:3*n<2?t+(e-t)*(2/3-n)*6:t}try{e.parseCSSColor=function(t){var e,a=t.replace(/ /g,"").toLowerCase();if(a in n)return n[a].slice();if("#"===a[0])return 4===a.length?(e=parseInt(a.substr(1),16))>=0&&e<=4095?[(3840&e)>>4|(3840&e)>>8,240&e|(240&e)>>4,15&e|(15&e)<<4,1]:null:7===a.length&&(e=parseInt(a.substr(1),16))>=0&&e<=16777215?[(16711680&e)>>16,(65280&e)>>8,255&e,1]:null;var c=a.indexOf("("),l=a.indexOf(")");if(-1!==c&&l+1===a.length){var u=a.substr(0,c),h=a.substr(c+1,l-(c+1)).split(","),d=1;switch(u){case"rgba":if(4!==h.length)return null;d=o(h.pop());case"rgb":return 3!==h.length?null:[i(h[0]),i(h[1]),i(h[2]),d];case"hsla":if(4!==h.length)return null;d=o(h.pop());case"hsl":if(3!==h.length)return null;var p=(parseFloat(h[0])%360+360)%360/360,f=o(h[1]),m=o(h[2]),g=m<=.5?m*(f+1):m+f-m*f,_=2*m-g;return[r(255*s(_,g,p+1/3)),r(255*s(_,g,p)),r(255*s(_,g,p-1/3)),d];default:return null}}return null}}catch(t){}});class ue{constructor(t,e,n,r=1){this.r=t,this.g=e,this.b=n,this.a=r}static parse(t){if(!t)return;if(t instanceof ue)return t;if("string"!=typeof t)return;const e=le.parseCSSColor(t);return e?new ue(e[0]/255*e[3],e[1]/255*e[3],e[2]/255*e[3],e[3]):void 0}toString(){const[t,e,n,r]=this.toArray();return`rgba(${Math.round(t)},${Math.round(e)},${Math.round(n)},${r})`}toArray(){const{r:t,g:e,b:n,a:r}=this;return 0===r?[0,0,0,0]:[255*t/r,255*e/r,255*n/r,r]}}ue.black=new ue(0,0,0,1),ue.white=new ue(1,1,1,1),ue.transparent=new ue(0,0,0,0),ue.red=new ue(1,0,0,1),ue.blue=new ue(0,0,1,1);class he{constructor(t,e,n){this.sensitivity=t?e?"variant":"case":e?"accent":"base",this.locale=n,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,e){return this.collator.compare(t,e)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class de{constructor(t,e,n,r,i){this.text=t.normalize?t.normalize():t,this.image=e,this.scale=n,this.fontStack=r,this.textColor=i}}class pe{constructor(t){this.sections=t}static fromString(t){return new pe([new de(t,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(t=>0!==t.text.length||t.image&&0!==t.image.name.length)}static factory(t){return t instanceof pe?t:pe.fromString(t)}toString(){return 0===this.sections.length?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const e of this.sections){if(e.image){t.push(["image",e.image.name]);continue}t.push(e.text);const n={};e.fontStack&&(n["text-font"]=["literal",e.fontStack.split(",")]),e.scale&&(n["font-scale"]=e.scale),e.textColor&&(n["text-color"]=["rgba"].concat(e.textColor.toArray())),t.push(n)}return t}}class fe{constructor(t){this.name=t.name,this.available=t.available}toString(){return this.name}static fromString(t){return t?new fe({name:t,available:!1}):null}serialize(){return["image",this.name]}}function me(t,e,n,r){return"number"==typeof t&&t>=0&&t<=255&&"number"==typeof e&&e>=0&&e<=255&&"number"==typeof n&&n>=0&&n<=255?void 0===r||"number"==typeof r&&r>=0&&r<=1?null:`Invalid rgba value [${[t,e,n,r].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${("number"==typeof r?[t,e,n,r]:[t,e,n]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function ge(t){if(null===t)return!0;if("string"==typeof t)return!0;if("boolean"==typeof t)return!0;if("number"==typeof t)return!0;if(t instanceof ue)return!0;if(t instanceof he)return!0;if(t instanceof pe)return!0;if(t instanceof fe)return!0;if(Array.isArray(t)){for(const e of t)if(!ge(e))return!1;return!0}if("object"==typeof t){for(const e in t)if(!ge(t[e]))return!1;return!0}return!1}function _e(t){if(null===t)return Wt;if("string"==typeof t)return Zt;if("boolean"==typeof t)return Kt;if("number"==typeof t)return Ht;if(t instanceof ue)return Xt;if(t instanceof he)return Jt;if(t instanceof pe)return te;if(t instanceof fe)return ee;if(Array.isArray(t)){const e=t.length;let n;for(const r of t){const t=_e(r);if(n){if(n===t)continue;n=Qt;break}n=t}return ne(n||Qt,e)}return Yt}function ye(t){const e=typeof t;return null===t?"":"string"===e||"number"===e||"boolean"===e?String(t):t instanceof ue||t instanceof pe||t instanceof fe?t.toString():JSON.stringify(t)}class ve{constructor(t,e){this.type=t,this.value=e}static parse(t,e){if(2!==t.length)return e.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!ge(t[1]))return e.error("invalid value");const n=t[1];let r=_e(n);const i=e.expectedType;return"array"!==r.kind||0!==r.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(r=i),new ve(r,n)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof ue?["rgba"].concat(this.value.toArray()):this.value instanceof pe?this.value.serialize():this.value}}class be{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const xe={string:Zt,number:Ht,boolean:Kt,object:Yt};class we{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");let n,r=1;const i=t[0];if("array"===i){let i,o;if(t.length>2){const n=t[1];if("string"!=typeof n||!(n in xe)||"object"===n)return e.error('The item type argument of "array" must be one of string, number, boolean',1);i=xe[n],r++}else i=Qt;if(t.length>3){if(null!==t[2]&&("number"!=typeof t[2]||t[2]<0||t[2]!==Math.floor(t[2])))return e.error('The length argument to "array" must be a positive integer literal',2);o=t[2],r++}n=ne(i,o)}else n=xe[i];const o=[];for(;r<t.length;r++){const n=e.parse(t[r],r,Qt);if(!n)return null;o.push(n)}return new we(n,o)}evaluate(t){for(let e=0;e<this.args.length;e++){const n=this.args[e].evaluate(t);if(!oe(this.type,_e(n)))return n;if(e===this.args.length-1)throw new be(`Expected value to be of type ${re(this.type)}, but found ${re(_e(n))} instead.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,e=[t.kind];if("array"===t.kind){const n=t.itemType;if("string"===n.kind||"number"===n.kind||"boolean"===n.kind){e.push(n.kind);const r=t.N;("number"==typeof r||this.args.length>1)&&e.push(r)}}return e.concat(this.args.map(t=>t.serialize()))}}class Te{constructor(t){this.type=te,this.sections=t}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[1];if(!Array.isArray(n)&&"object"==typeof n)return e.error("First argument must be an image or text section.");const r=[];let i=!1;for(let o=1;o<=t.length-1;++o){const n=t[o];if(i&&"object"==typeof n&&!Array.isArray(n)){i=!1;let t=null;if(n["font-scale"]&&(t=e.parse(n["font-scale"],1,Ht),!t))return null;let o=null;if(n["text-font"]&&(o=e.parse(n["text-font"],1,ne(Zt)),!o))return null;let s=null;if(n["text-color"]&&(s=e.parse(n["text-color"],1,Xt),!s))return null;const a=r[r.length-1];a.scale=t,a.font=o,a.textColor=s}else{const n=e.parse(t[o],1,Qt);if(!n)return null;const s=n.type.kind;if("string"!==s&&"value"!==s&&"null"!==s&&"resolvedImage"!==s)return e.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,r.push({content:n,scale:null,font:null,textColor:null})}}return new Te(r)}evaluate(t){return new pe(this.sections.map(e=>{const n=e.content.evaluate(t);return _e(n)===ee?new de("",n,null,null,null):new de(ye(n),null,e.scale?e.scale.evaluate(t):null,e.font?e.font.evaluate(t).join(","):null,e.textColor?e.textColor.evaluate(t):null)}))}eachChild(t){for(const e of this.sections)t(e.content),e.scale&&t(e.scale),e.font&&t(e.font),e.textColor&&t(e.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const e of this.sections){t.push(e.content.serialize());const n={};e.scale&&(n["font-scale"]=e.scale.serialize()),e.font&&(n["text-font"]=e.font.serialize()),e.textColor&&(n["text-color"]=e.textColor.serialize()),t.push(n)}return t}}class Ce{constructor(t){this.type=ee,this.input=t}static parse(t,e){if(2!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Zt);return n?new Ce(n):e.error("No image name provided.")}evaluate(t){const e=this.input.evaluate(t),n=fe.fromString(e);return n&&t.availableImages&&(n.available=t.availableImages.indexOf(e)>-1),n}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){return["image",this.input.serialize()]}}const Ee={"to-boolean":Kt,"to-color":Xt,"to-number":Ht,"to-string":Zt};class Se{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expected at least one argument.");const n=t[0];if(("to-boolean"===n||"to-string"===n)&&2!==t.length)return e.error("Expected one argument.");const r=Ee[n],i=[];for(let o=1;o<t.length;o++){const n=e.parse(t[o],o,Qt);if(!n)return null;i.push(n)}return new Se(r,i)}evaluate(t){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(t));if("color"===this.type.kind){let e,n;for(const r of this.args){if(e=r.evaluate(t),n=null,e instanceof ue)return e;if("string"==typeof e){const n=t.parseColor(e);if(n)return n}else if(Array.isArray(e)&&(n=e.length<3||e.length>4?`Invalid rbga value ${JSON.stringify(e)}: expected an array containing either three or four numeric values.`:me(e[0],e[1],e[2],e[3]),!n))return new ue(e[0]/255,e[1]/255,e[2]/255,e[3])}throw new be(n||`Could not parse color from value '${"string"==typeof e?e:String(JSON.stringify(e))}'`)}if("number"===this.type.kind){let e=null;for(const n of this.args){if(e=n.evaluate(t),null===e)return 0;const r=Number(e);if(!isNaN(r))return r}throw new be(`Could not convert ${JSON.stringify(e)} to number.`)}return"formatted"===this.type.kind?pe.fromString(ye(this.args[0].evaluate(t))):"resolvedImage"===this.type.kind?fe.fromString(ye(this.args[0].evaluate(t))):ye(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Te([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Ce(this.args[0]).serialize();const t=[`to-${this.type.kind}`];return this.eachChild(e=>{t.push(e.serialize())}),t}}const Ie=["Unknown","Point","LineString","Polygon"];class ke{constructor(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null}id(){return this.feature&&"id"in this.feature&&this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?Ie[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,e=this.featureDistanceData.scale,{x:n,y:r}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(n*e-t[0])+this.featureDistanceData.bearing[1]*(r*e-t[1])}return 0}parseColor(t){let e=this._parseColorCache[t];return e||(e=this._parseColorCache[t]=ue.parse(t)),e}}class Ae{constructor(t,e,n,r){this.name=t,this.type=e,this._evaluate=n,this.args=r}evaluate(t){return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,e){const n=t[0],r=Ae.definitions[n];if(!r)return e.error(`Unknown expression "${n}". If you wanted a literal array, use ["literal", [...]].`,0);const i=Array.isArray(r)?r[0]:r.type,o=Array.isArray(r)?[[r[1],r[2]]]:r.overloads,s=o.filter(([e])=>!Array.isArray(e)||e.length===t.length-1);let a=null;for(const[c,l]of s){a=new Qe(e.registry,e.path,null,e.scope);const r=[];let o=!1;for(let e=1;e<t.length;e++){const n=t[e],i=Array.isArray(c)?c[e-1]:c.type,s=a.parse(n,1+r.length,i);if(!s){o=!0;break}r.push(s)}if(!o)if(Array.isArray(c)&&c.length!==r.length)a.error(`Expected ${c.length} arguments, but found ${r.length} instead.`);else{for(let t=0;t<r.length;t++){const e=Array.isArray(c)?c[t]:c.type,n=r[t];a.concat(t+1).checkSubtype(e,n.type)}if(0===a.errors.length)return new Ae(n,i,l,r)}}if(1===s.length)e.errors.push(...a.errors);else{const n=(s.length?s:o).map(([t])=>{return e=t,Array.isArray(e)?`(${e.map(re).join(", ")})`:`(${re(e.type)}...)`;var e}).join(" | "),r=[];for(let i=1;i<t.length;i++){const n=e.parse(t[i],1+r.length);if(!n)return null;r.push(re(n.type))}e.error(`Expected arguments of type ${n}, but found (${r.join(", ")}) instead.`)}return null}static register(t,e){Ae.definitions=e;for(const n in e)t[n]=Ae}}class Me{constructor(t,e,n){this.type=Jt,this.locale=n,this.caseSensitive=t,this.diacriticSensitive=e}static parse(t,e){if(2!==t.length)return e.error("Expected one argument.");const n=t[1];if("object"!=typeof n||Array.isArray(n))return e.error("Collator options argument must be an object.");const r=e.parse(void 0!==n["case-sensitive"]&&n["case-sensitive"],1,Kt);if(!r)return null;const i=e.parse(void 0!==n["diacritic-sensitive"]&&n["diacritic-sensitive"],1,Kt);if(!i)return null;let o=null;return n.locale&&(o=e.parse(n.locale,1,Zt),!o)?null:new Me(r,i,o)}evaluate(t){return new he(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}const Oe=8192;function Pe(t,e){t[0]=Math.min(t[0],e[0]),t[1]=Math.min(t[1],e[1]),t[2]=Math.max(t[2],e[0]),t[3]=Math.max(t[3],e[1])}function De(t,e){return!(t[0]<=e[0]||t[2]>=e[2]||t[1]<=e[1]||t[3]>=e[3])}function Re(t,e){const n=(180+t[0])/360,r=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t[1]*Math.PI/360)))/360,i=Math.pow(2,e.z);return[Math.round(n*i*Oe),Math.round(r*i*Oe)]}function Ne(t,e,n){const r=t[0]-e[0],i=t[1]-e[1],o=t[0]-n[0],s=t[1]-n[1];return r*s-o*i==0&&r*o<=0&&i*s<=0}function Le(t,e){let n=!1;for(let s=0,a=e.length;s<a;s++){const a=e[s];for(let e=0,s=a.length;e<s-1;e++){if(Ne(t,a[e],a[e+1]))return!1;(i=a[e])[1]>(r=t)[1]!=(o=a[e+1])[1]>r[1]&&r[0]<(o[0]-i[0])*(r[1]-i[1])/(o[1]-i[1])+i[0]&&(n=!n)}}var r,i,o;return n}function je(t,e){for(let n=0;n<e.length;n++)if(Le(t,e[n]))return!0;return!1}function ze(t,e,n,r){const i=r[0]-n[0],o=r[1]-n[1],s=(t[0]-n[0])*o-i*(t[1]-n[1]),a=(e[0]-n[0])*o-i*(e[1]-n[1]);return s>0&&a<0||s<0&&a>0}function Fe(t,e,n){for(const l of n)for(let n=0;n<l.length-1;++n)if(0!=(a=[(s=l[n+1])[0]-(o=l[n])[0],s[1]-o[1]])[0]*(c=[(i=e)[0]-(r=t)[0],i[1]-r[1]])[1]-a[1]*c[0]&&ze(r,i,o,s)&&ze(o,s,r,i))return!0;var r,i,o,s,a,c;return!1}function Be(t,e){for(let n=0;n<t.length;++n)if(!Le(t[n],e))return!1;for(let n=0;n<t.length-1;++n)if(Fe(t[n],t[n+1],e))return!1;return!0}function Ue(t,e){for(let n=0;n<e.length;n++)if(Be(t,e[n]))return!0;return!1}function Ve(t,e,n){const r=[];for(let i=0;i<t.length;i++){const o=[];for(let r=0;r<t[i].length;r++){const s=Re(t[i][r],n);Pe(e,s),o.push(s)}r.push(o)}return r}function qe(t,e,n){const r=[];for(let i=0;i<t.length;i++){const o=Ve(t[i],e,n);r.push(o)}return r}function Ge(t,e,n,r){if(t[0]<n[0]||t[0]>n[2]){const e=.5*r;let i=t[0]-n[0]>e?-r:n[0]-t[0]>e?r:0;0===i&&(i=t[0]-n[2]>e?-r:n[2]-t[0]>e?r:0),t[0]+=i}Pe(e,t)}function $e(t,e,n,r){const i=Math.pow(2,r.z)*Oe,o=[r.x*Oe,r.y*Oe],s=[];if(!t)return s;for(const a of t)for(const t of a){const r=[t.x+o[0],t.y+o[1]];Ge(r,e,n,i),s.push(r)}return s}function We(t,e,n,r){const i=Math.pow(2,r.z)*Oe,o=[r.x*Oe,r.y*Oe],s=[];if(!t)return s;for(const c of t){const t=[];for(const n of c){const r=[n.x+o[0],n.y+o[1]];Pe(e,r),t.push(r)}s.push(t)}if(e[2]-e[0]<=i/2){(a=e)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const t of s)for(const r of t)Ge(r,e,n,i)}var a;return s}class He{constructor(t,e){this.type=Kt,this.geojson=t,this.geometries=e}static parse(t,e){if(2!==t.length)return e.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(ge(t[1])){const e=t[1];if("FeatureCollection"===e.type)for(let t=0;t<e.features.length;++t){const n=e.features[t].geometry.type;if("Polygon"===n||"MultiPolygon"===n)return new He(e,e.features[t].geometry)}else if("Feature"===e.type){const t=e.geometry.type;if("Polygon"===t||"MultiPolygon"===t)return new He(e,e.geometry)}else if("Polygon"===e.type||"MultiPolygon"===e.type)return new He(e,e)}return e.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(null!=t.geometry()&&null!=t.canonicalID()){if("Point"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===e.type){const o=Ve(e.coordinates,r,i),s=$e(t.geometry(),n,r,i);if(!De(n,r))return!1;for(const t of s)if(!Le(t,o))return!1}if("MultiPolygon"===e.type){const o=qe(e.coordinates,r,i),s=$e(t.geometry(),n,r,i);if(!De(n,r))return!1;for(const t of s)if(!je(t,o))return!1}return!0}(t,this.geometries);if("LineString"===t.geometryType())return function(t,e){const n=[1/0,1/0,-1/0,-1/0],r=[1/0,1/0,-1/0,-1/0],i=t.canonicalID();if(!i)return!1;if("Polygon"===e.type){const o=Ve(e.coordinates,r,i),s=We(t.geometry(),n,r,i);if(!De(n,r))return!1;for(const t of s)if(!Be(t,o))return!1}if("MultiPolygon"===e.type){const o=qe(e.coordinates,r,i),s=We(t.geometry(),n,r,i);if(!De(n,r))return!1;for(const t of s)if(!Ue(t,o))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}function Ze(t){if(t instanceof Ae){if("get"===t.name&&1===t.args.length)return!1;if("feature-state"===t.name)return!1;if("has"===t.name&&1===t.args.length)return!1;if("properties"===t.name||"geometry-type"===t.name||"id"===t.name)return!1;if(/^filter-/.test(t.name))return!1}if(t instanceof He)return!1;let e=!0;return t.eachChild(t=>{e&&!Ze(t)&&(e=!1)}),e}function Ke(t){if(t instanceof Ae&&"feature-state"===t.name)return!1;let e=!0;return t.eachChild(t=>{e&&!Ke(t)&&(e=!1)}),e}function Xe(t,e){if(t instanceof Ae&&e.indexOf(t.name)>=0)return!1;let n=!0;return t.eachChild(t=>{n&&!Xe(t,e)&&(n=!1)}),n}class Ye{constructor(t,e){this.type=e.type,this.name=t,this.boundExpression=e}static parse(t,e){if(2!==t.length||"string"!=typeof t[1])return e.error("'var' expression requires exactly one string literal argument.");const n=t[1];return e.scope.has(n)?new Ye(n,e.scope.get(n)):e.error(`Unknown variable "${n}". Make sure "${n}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Qe{constructor(t,e=[],n,r=new $t,i=[]){this.registry=t,this.path=e,this.key=e.map(t=>`[${t}]`).join(""),this.scope=r,this.errors=i,this.expectedType=n}parse(t,e,n,r,i={}){return e?this.concat(e,n,r)._parse(t,i):this._parse(t,i)}_parse(t,e){function n(t,e,n){return"assert"===n?new we(e,[t]):"coerce"===n?new Se(e,[t]):t}if(null!==t&&"string"!=typeof t&&"boolean"!=typeof t&&"number"!=typeof t||(t=["literal",t]),Array.isArray(t)){if(0===t.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const r=t[0];if("string"!=typeof r)return this.error(`Expression name must be a string, but found ${typeof r} instead. If you wanted a literal array, use ["literal", [...]].`,0),null;const i=this.registry[r];if(i){let r=i.parse(t,this);if(!r)return null;if(this.expectedType){const t=this.expectedType,i=r.type;if("string"!==t.kind&&"number"!==t.kind&&"boolean"!==t.kind&&"object"!==t.kind&&"array"!==t.kind||"value"!==i.kind)if("color"!==t.kind&&"formatted"!==t.kind&&"resolvedImage"!==t.kind||"value"!==i.kind&&"string"!==i.kind){if(this.checkSubtype(t,i))return null}else r=n(r,t,e.typeAnnotation||"coerce");else r=n(r,t,e.typeAnnotation||"assert")}if(!(r instanceof ve)&&"resolvedImage"!==r.type.kind&&Je(r)){const e=new ke;try{r=new ve(r.type,r.evaluate(e))}catch(t){return this.error(t.message),null}}return r}return this.error(`Unknown expression "${r}". If you wanted a literal array, use ["literal", [...]].`,0)}return this.error(void 0===t?"'undefined' value invalid. Use null instead.":"object"==typeof t?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,e,n){const r="number"==typeof t?this.path.concat(t):this.path,i=n?this.scope.concat(n):this.scope;return new Qe(this.registry,r,e||null,i,this.errors)}error(t,...e){const n=`${this.key}${e.map(t=>`[${t}]`).join("")}`;this.errors.push(new Gt(n,t))}checkSubtype(t,e){const n=oe(t,e);return n&&this.error(n),n}}function Je(t){if(t instanceof Ye)return Je(t.boundExpression);if(t instanceof Ae&&"error"===t.name)return!1;if(t instanceof Me)return!1;if(t instanceof He)return!1;const e=t instanceof Se||t instanceof we;let n=!0;return t.eachChild(t=>{n=e?n&&Je(t):n&&t instanceof ve}),!!n&&Ze(t)&&Xe(t,["zoom","heatmap-density","line-progress","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center"])}function tn(t,e){const n=t.length-1;let r,i,o=0,s=n,a=0;for(;o<=s;)if(a=Math.floor((o+s)/2),r=t[a],i=t[a+1],r<=e){if(a===n||e<i)return a;o=a+1}else{if(!(r>e))throw new be("Input is not a number.");s=a-1}return 0}class en{constructor(t,e,n){this.type=t,this.input=e,this.labels=[],this.outputs=[];for(const[r,i]of n)this.labels.push(r),this.outputs.push(i)}static parse(t,e){if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");const n=e.parse(t[1],1,Ht);if(!n)return null;const r=[];let i=null;e.expectedType&&"value"!==e.expectedType.kind&&(i=e.expectedType);for(let o=1;o<t.length;o+=2){const n=1===o?-1/0:t[o],s=t[o+1],a=o,c=o+1;if("number"!=typeof n)return e.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(r.length&&r[r.length-1][0]>=n)return e.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const l=e.parse(s,c,i);if(!l)return null;i=i||l.type,r.push([n,l])}return new en(i,n,r)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);const i=e.length;return r>=e[i-1]?n[i-1].evaluate(t):n[tn(e,r)].evaluate(t)}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let e=0;e<this.labels.length;e++)e>0&&t.push(this.labels[e]),t.push(this.outputs[e].serialize());return t}}function nn(t,e,n){return t*(1-n)+e*n}var rn=Object.freeze({__proto__:null,number:nn,color:function(t,e,n){return new ue(nn(t.r,e.r,n),nn(t.g,e.g,n),nn(t.b,e.b,n),nn(t.a,e.a,n))},array:function(t,e,n){return t.map((t,r)=>nn(t,e[r],n))}});const on=.95047,sn=1.08883,an=4/29,cn=6/29,ln=3*cn*cn,un=Math.PI/180,hn=180/Math.PI;function dn(t){return t>.008856451679035631?Math.pow(t,1/3):t/ln+an}function pn(t){return t>cn?t*t*t:ln*(t-an)}function fn(t){return 255*(t<=.0031308?12.92*t:1.055*Math.pow(t,1/2.4)-.055)}function mn(t){return(t/=255)<=.04045?t/12.92:Math.pow((t+.055)/1.055,2.4)}function gn(t){const e=mn(t.r),n=mn(t.g),r=mn(t.b),i=dn((.4124564*e+.3575761*n+.1804375*r)/on),o=dn((.2126729*e+.7151522*n+.072175*r)/1);return{l:116*o-16,a:500*(i-o),b:200*(o-dn((.0193339*e+.119192*n+.9503041*r)/sn)),alpha:t.a}}function _n(t){let e=(t.l+16)/116,n=isNaN(t.a)?e:e+t.a/500,r=isNaN(t.b)?e:e-t.b/200;return e=1*pn(e),n=on*pn(n),r=sn*pn(r),new ue(fn(3.2404542*n-1.5371385*e-.4985314*r),fn(-.969266*n+1.8760108*e+.041556*r),fn(.0556434*n-.2040259*e+1.0572252*r),t.alpha)}function yn(t,e,n){const r=e-t;return t+n*(r>180||r<-180?r-360*Math.round(r/360):r)}const vn={forward:gn,reverse:_n,interpolate:function(t,e,n){return{l:nn(t.l,e.l,n),a:nn(t.a,e.a,n),b:nn(t.b,e.b,n),alpha:nn(t.alpha,e.alpha,n)}}},bn={forward:function(t){const{l:e,a:n,b:r}=gn(t),i=Math.atan2(r,n)*hn;return{h:i<0?i+360:i,c:Math.sqrt(n*n+r*r),l:e,alpha:t.a}},reverse:function(t){const e=t.h*un,n=t.c;return _n({l:t.l,a:Math.cos(e)*n,b:Math.sin(e)*n,alpha:t.alpha})},interpolate:function(t,e,n){return{h:yn(t.h,e.h,n),c:nn(t.c,e.c,n),l:nn(t.l,e.l,n),alpha:nn(t.alpha,e.alpha,n)}}};var xn=Object.freeze({__proto__:null,lab:vn,hcl:bn});class wn{constructor(t,e,n,r,i){this.type=t,this.operator=e,this.interpolation=n,this.input=r,this.labels=[],this.outputs=[];for(const[o,s]of i)this.labels.push(o),this.outputs.push(s)}static interpolationFactor(t,e,r,i){let o=0;if("exponential"===t.name)o=Tn(e,t.base,r,i);else if("linear"===t.name)o=Tn(e,1,r,i);else if("cubic-bezier"===t.name){const s=t.controlPoints;o=new n(s[0],s[1],s[2],s[3]).solve(Tn(e,1,r,i))}return o}static parse(t,e){let[n,r,i,...o]=t;if(!Array.isArray(r)||0===r.length)return e.error("Expected an interpolation type expression.",1);if("linear"===r[0])r={name:"linear"};else if("exponential"===r[0]){const t=r[1];if("number"!=typeof t)return e.error("Exponential interpolation requires a numeric base.",1,1);r={name:"exponential",base:t}}else{if("cubic-bezier"!==r[0])return e.error(`Unknown interpolation type ${String(r[0])}`,1,0);{const t=r.slice(1);if(4!==t.length||t.some(t=>"number"!=typeof t||t<0||t>1))return e.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);r={name:"cubic-bezier",controlPoints:t}}}if(t.length-1<4)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return e.error("Expected an even number of arguments.");if(i=e.parse(i,2,Ht),!i)return null;const s=[];let a=null;"interpolate-hcl"===n||"interpolate-lab"===n?a=Xt:e.expectedType&&"value"!==e.expectedType.kind&&(a=e.expectedType);for(let c=0;c<o.length;c+=2){const t=o[c],n=o[c+1],r=c+3,i=c+4;if("number"!=typeof t)return e.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',r);if(s.length&&s[s.length-1][0]>=t)return e.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',r);const l=e.parse(n,i,a);if(!l)return null;a=a||l.type,s.push([t,l])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new wn(a,n,r,i,s):e.error(`Type ${re(a)} is not interpolatable.`)}evaluate(t){const e=this.labels,n=this.outputs;if(1===e.length)return n[0].evaluate(t);const r=this.input.evaluate(t);if(r<=e[0])return n[0].evaluate(t);const i=e.length;if(r>=e[i-1])return n[i-1].evaluate(t);const o=tn(e,r),s=wn.interpolationFactor(this.interpolation,r,e[o],e[o+1]),a=n[o].evaluate(t),c=n[o+1].evaluate(t);return"interpolate"===this.operator?rn[this.type.kind.toLowerCase()](a,c,s):"interpolate-hcl"===this.operator?bn.reverse(bn.interpolate(bn.forward(a),bn.forward(c),s)):vn.reverse(vn.interpolate(vn.forward(a),vn.forward(c),s))}eachChild(t){t(this.input);for(const e of this.outputs)t(e)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);const e=[this.operator,t,this.input.serialize()];for(let n=0;n<this.labels.length;n++)e.push(this.labels[n],this.outputs[n].serialize());return e}}function Tn(t,e,n,r){const i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}class Cn{constructor(t,e){this.type=t,this.args=e}static parse(t,e){if(t.length<2)return e.error("Expectected at least one argument.");let n=null;const r=e.expectedType;r&&"value"!==r.kind&&(n=r);const i=[];for(const s of t.slice(1)){const t=e.parse(s,1+i.length,n,void 0,{typeAnnotation:"omit"});if(!t)return null;n=n||t.type,i.push(t)}const o=r&&i.some(t=>oe(r,t.type));return new Cn(o?Qt:n,i)}evaluate(t){let e,n=null,r=0;for(const i of this.args){if(r++,n=i.evaluate(t),n&&n instanceof fe&&!n.available&&(e||(e=n),n=null,r===this.args.length))return e;if(null!==n)break}return n}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class En{constructor(t,e){this.type=e.type,this.bindings=[].concat(t),this.result=e}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const e of this.bindings)t(e[1]);t(this.result)}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const n=[];for(let i=1;i<t.length-1;i+=2){const r=t[i];if("string"!=typeof r)return e.error(`Expected string, but found ${typeof r} instead.`,i);if(/[^a-zA-Z0-9_]/.test(r))return e.error("Variable names must contain only alphanumeric characters or '_'.",i);const o=e.parse(t[i+1],i+1);if(!o)return null;n.push([r,o])}const r=e.parse(t[t.length-1],t.length-1,e.expectedType,n);return r?new En(n,r):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[e,n]of this.bindings)t.push(e,n.serialize());return t.push(this.result.serialize()),t}}class Sn{constructor(t,e,n){this.type=t,this.index=e,this.input=n}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Ht),r=e.parse(t[2],2,ne(e.expectedType||Qt));return n&&r?new Sn(r.type.itemType,n,r):null}evaluate(t){const e=this.index.evaluate(t),n=this.input.evaluate(t);if(e<0)throw new be(`Array index out of bounds: ${e} < 0.`);if(e>=n.length)throw new be(`Array index out of bounds: ${e} > ${n.length-1}.`);if(e!==Math.floor(e))throw new be(`Array index must be an integer, but found ${e} instead.`);return n[e]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class In{constructor(t,e){this.type=Kt,this.needle=t,this.haystack=e}static parse(t,e){if(3!==t.length)return e.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Qt),r=e.parse(t[2],2,Qt);return n&&r?se(n.type,[Kt,Zt,Ht,Wt,Qt])?new In(n,r):e.error(`Expected first argument to be of type boolean, string, number or null, but found ${re(n.type)} instead`):null}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(null==n)return!1;if(!ae(e,["boolean","string","number","null"]))throw new be(`Expected first argument to be of type boolean, string, number or null, but found ${re(_e(e))} instead.`);if(!ae(n,["string","array"]))throw new be(`Expected second argument to be of type array or string, but found ${re(_e(n))} instead.`);return n.indexOf(e)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class kn{constructor(t,e,n){this.type=Ht,this.needle=t,this.haystack=e,this.fromIndex=n}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Qt),r=e.parse(t[2],2,Qt);if(!n||!r)return null;if(!se(n.type,[Kt,Zt,Ht,Wt,Qt]))return e.error(`Expected first argument to be of type boolean, string, number or null, but found ${re(n.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,Ht);return i?new kn(n,r,i):null}return new kn(n,r)}evaluate(t){const e=this.needle.evaluate(t),n=this.haystack.evaluate(t);if(!ae(e,["boolean","string","number","null"]))throw new be(`Expected first argument to be of type boolean, string, number or null, but found ${re(_e(e))} instead.`);if(!ae(n,["string","array"]))throw new be(`Expected second argument to be of type array or string, but found ${re(_e(n))} instead.`);if(this.fromIndex){const r=this.fromIndex.evaluate(t);return n.indexOf(e,r)}return n.indexOf(e)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class An{constructor(t,e,n,r,i,o){this.inputType=t,this.type=e,this.input=n,this.cases=r,this.outputs=i,this.otherwise=o}static parse(t,e){if(t.length<5)return e.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return e.error("Expected an even number of arguments.");let n,r;e.expectedType&&"value"!==e.expectedType.kind&&(r=e.expectedType);const i={},o=[];for(let c=2;c<t.length-1;c+=2){let s=t[c];const a=t[c+1];Array.isArray(s)||(s=[s]);const l=e.concat(c);if(0===s.length)return l.error("Expected at least one branch label.");for(const t of s){if("number"!=typeof t&&"string"!=typeof t)return l.error("Branch labels must be numbers or strings.");if("number"==typeof t&&Math.abs(t)>Number.MAX_SAFE_INTEGER)return l.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if("number"==typeof t&&Math.floor(t)!==t)return l.error("Numeric branch labels must be integer values.");if(n){if(l.checkSubtype(n,_e(t)))return null}else n=_e(t);if(void 0!==i[String(t)])return l.error("Branch labels must be unique.");i[String(t)]=o.length}const u=e.parse(a,c,r);if(!u)return null;r=r||u.type,o.push(u)}const s=e.parse(t[1],1,Qt);if(!s)return null;const a=e.parse(t[t.length-1],t.length-1,r);return a?"value"!==s.type.kind&&e.concat(1).checkSubtype(n,s.type)?null:new An(n,r,s,i,o,a):null}evaluate(t){const e=this.input.evaluate(t);return(_e(e)===this.inputType&&this.outputs[this.cases[e]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],e=Object.keys(this.cases).sort(),n=[],r={};for(const o of e){const t=r[this.cases[o]];void 0===t?(r[this.cases[o]]=n.length,n.push([this.cases[o],[o]])):n[t][1].push(o)}const i=t=>"number"===this.inputType.kind?Number(t):t;for(const[o,s]of n)t.push(1===s.length?i(s[0]):s.map(i)),t.push(this.outputs[o].serialize());return t.push(this.otherwise.serialize()),t}}class Mn{constructor(t,e,n){this.type=t,this.branches=e,this.otherwise=n}static parse(t,e){if(t.length<4)return e.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return e.error("Expected an odd number of arguments.");let n;e.expectedType&&"value"!==e.expectedType.kind&&(n=e.expectedType);const r=[];for(let o=1;o<t.length-1;o+=2){const i=e.parse(t[o],o,Kt);if(!i)return null;const s=e.parse(t[o+1],o+1,n);if(!s)return null;r.push([i,s]),n=n||s.type}const i=e.parse(t[t.length-1],t.length-1,n);return i?new Mn(n,r,i):null}evaluate(t){for(const[e,n]of this.branches)if(e.evaluate(t))return n.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[e,n]of this.branches)t(e),t(n);t(this.otherwise)}outputDefined(){return this.branches.every(([t,e])=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(e=>{t.push(e.serialize())}),t}}class On{constructor(t,e,n,r){this.type=t,this.input=e,this.beginIndex=n,this.endIndex=r}static parse(t,e){if(t.length<=2||t.length>=5)return e.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const n=e.parse(t[1],1,Qt),r=e.parse(t[2],2,Ht);if(!n||!r)return null;if(!se(n.type,[ne(Qt),Zt,Qt]))return e.error(`Expected first argument to be of type array or string, but found ${re(n.type)} instead`);if(4===t.length){const i=e.parse(t[3],3,Ht);return i?new On(n.type,n,r,i):null}return new On(n.type,n,r)}evaluate(t){const e=this.input.evaluate(t),n=this.beginIndex.evaluate(t);if(!ae(e,["string","array"]))throw new be(`Expected first argument to be of type array or string, but found ${re(_e(e))} instead.`);if(this.endIndex){const r=this.endIndex.evaluate(t);return e.slice(n,r)}return e.slice(n)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}function Pn(t,e){return"=="===t||"!="===t?"boolean"===e.kind||"string"===e.kind||"number"===e.kind||"null"===e.kind||"value"===e.kind:"string"===e.kind||"number"===e.kind||"value"===e.kind}function Dn(t,e,n,r){return 0===r.compare(e,n)}function Rn(t,e,n){const r="=="!==t&&"!="!==t;return class i{constructor(t,e,n){this.type=Kt,this.lhs=t,this.rhs=e,this.collator=n,this.hasUntypedArgument="value"===t.type.kind||"value"===e.type.kind}static parse(t,e){if(3!==t.length&&4!==t.length)return e.error("Expected two or three arguments.");const n=t[0];let o=e.parse(t[1],1,Qt);if(!o)return null;if(!Pn(n,o.type))return e.concat(1).error(`"${n}" comparisons are not supported for type '${re(o.type)}'.`);let s=e.parse(t[2],2,Qt);if(!s)return null;if(!Pn(n,s.type))return e.concat(2).error(`"${n}" comparisons are not supported for type '${re(s.type)}'.`);if(o.type.kind!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error(`Cannot compare types '${re(o.type)}' and '${re(s.type)}'.`);r&&("value"===o.type.kind&&"value"!==s.type.kind?o=new we(s.type,[o]):"value"!==o.type.kind&&"value"===s.type.kind&&(s=new we(o.type,[s])));let a=null;if(4===t.length){if("string"!==o.type.kind&&"string"!==s.type.kind&&"value"!==o.type.kind&&"value"!==s.type.kind)return e.error("Cannot use collator to compare non-string types.");if(a=e.parse(t[3],3,Jt),!a)return null}return new i(o,s,a)}evaluate(i){const o=this.lhs.evaluate(i),s=this.rhs.evaluate(i);if(r&&this.hasUntypedArgument){const e=_e(o),n=_e(s);if(e.kind!==n.kind||"string"!==e.kind&&"number"!==e.kind)throw new be(`Expected arguments for "${t}" to be (string, string) or (number, number), but found (${e.kind}, ${n.kind}) instead.`)}if(this.collator&&!r&&this.hasUntypedArgument){const t=_e(o),n=_e(s);if("string"!==t.kind||"string"!==n.kind)return e(i,o,s)}return this.collator?n(i,o,s,this.collator.evaluate(i)):e(i,o,s)}eachChild(t){t(this.lhs),t(this.rhs),this.collator&&t(this.collator)}outputDefined(){return!0}serialize(){const e=[t];return this.eachChild(t=>{e.push(t.serialize())}),e}}}const Nn=Rn("==",function(t,e,n){return e===n},Dn),Ln=Rn("!=",function(t,e,n){return e!==n},function(t,e,n,r){return!Dn(0,e,n,r)}),jn=Rn("<",function(t,e,n){return e<n},function(t,e,n,r){return r.compare(e,n)<0}),zn=Rn(">",function(t,e,n){return e>n},function(t,e,n,r){return r.compare(e,n)>0}),Fn=Rn("<=",function(t,e,n){return e<=n},function(t,e,n,r){return r.compare(e,n)<=0}),Bn=Rn(">=",function(t,e,n){return e>=n},function(t,e,n,r){return r.compare(e,n)>=0});class Un{constructor(t,e,n,r,i){this.type=Zt,this.number=t,this.locale=e,this.currency=n,this.minFractionDigits=r,this.maxFractionDigits=i}static parse(t,e){if(3!==t.length)return e.error("Expected two arguments.");const n=e.parse(t[1],1,Ht);if(!n)return null;const r=t[2];if("object"!=typeof r||Array.isArray(r))return e.error("NumberFormat options argument must be an object.");let i=null;if(r.locale&&(i=e.parse(r.locale,1,Zt),!i))return null;let o=null;if(r.currency&&(o=e.parse(r.currency,1,Zt),!o))return null;let s=null;if(r["min-fraction-digits"]&&(s=e.parse(r["min-fraction-digits"],1,Ht),!s))return null;let a=null;return r["max-fraction-digits"]&&(a=e.parse(r["max-fraction-digits"],1,Ht),!a)?null:new Un(n,i,o,s,a)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class Vn{constructor(t){this.type=Ht,this.input=t}static parse(t,e){if(2!==t.length)return e.error(`Expected 1 argument, but found ${t.length-1} instead.`);const n=e.parse(t[1],1);return n?"array"!==n.type.kind&&"string"!==n.type.kind&&"value"!==n.type.kind?e.error(`Expected argument of type string or array, but found ${re(n.type)} instead.`):new Vn(n):null}evaluate(t){const e=this.input.evaluate(t);if("string"==typeof e)return e.length;if(Array.isArray(e))return e.length;throw new be(`Expected value to be of type string or array, but found ${re(_e(e))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(e=>{t.push(e.serialize())}),t}}const qn={"==":Nn,"!=":Ln,">":zn,"<":jn,">=":Bn,"<=":Fn,array:we,at:Sn,boolean:we,case:Mn,coalesce:Cn,collator:Me,format:Te,image:Ce,in:In,"index-of":kn,interpolate:wn,"interpolate-hcl":wn,"interpolate-lab":wn,length:Vn,let:En,literal:ve,match:An,number:we,"number-format":Un,object:we,slice:On,step:en,string:we,"to-boolean":Se,"to-color":Se,"to-number":Se,"to-string":Se,var:Ye,within:He};function Gn(t,[e,n,r,i]){e=e.evaluate(t),n=n.evaluate(t),r=r.evaluate(t);const o=i?i.evaluate(t):1,s=me(e,n,r,o);if(s)throw new be(s);return new ue(e/255*o,n/255*o,r/255*o,o)}function $n(t,e){return t in e}function Wn(t,e){const n=e[t];return void 0===n?null:n}function Hn(t){return{type:t}}function Zn(t){return{result:"success",value:t}}function Kn(t){return{result:"error",value:t}}function Xn(t){return"data-driven"===t["property-type"]||"cross-faded-data-driven"===t["property-type"]}function Yn(t){return!!t.expression&&t.expression.parameters.indexOf("zoom")>-1}function Qn(t){return!!t.expression&&t.expression.interpolated}function Jn(t){return t instanceof Number?"number":t instanceof String?"string":t instanceof Boolean?"boolean":Array.isArray(t)?"array":null===t?"null":typeof t}function tr(t){return"object"==typeof t&&null!==t&&!Array.isArray(t)}function er(t){return t}function nr(t,e){const n="color"===e.type,r=t.stops&&"object"==typeof t.stops[0][0],i=r||!(r||void 0!==t.property),o=t.type||(Qn(e)?"exponential":"interval");if(n&&((t=Ut({},t)).stops&&(t.stops=t.stops.map(t=>[t[0],ue.parse(t[1])])),t.default=ue.parse(t.default?t.default:e.default)),t.colorSpace&&"rgb"!==t.colorSpace&&!xn[t.colorSpace])throw new Error(`Unknown color space: ${t.colorSpace}`);let s,a,c;if("exponential"===o)s=sr;else if("interval"===o)s=or;else if("categorical"===o){s=ir,a=Object.create(null);for(const e of t.stops)a[e[0]]=e[1];c=typeof t.stops[0][0]}else{if("identity"!==o)throw new Error(`Unknown function type "${o}"`);s=ar}if(r){const n={},r=[];for(let e=0;e<t.stops.length;e++){const i=t.stops[e],o=i[0].zoom;void 0===n[o]&&(n[o]={zoom:o,type:t.type,property:t.property,default:t.default,stops:[]},r.push(o)),n[o].stops.push([i[0].value,i[1]])}const i=[];for(const t of r)i.push([n[t].zoom,nr(n[t],e)]);const o={name:"linear"};return{kind:"composite",interpolationType:o,interpolationFactor:wn.interpolationFactor.bind(void 0,o),zoomStops:i.map(t=>t[0]),evaluate:({zoom:n},r)=>sr({stops:i,base:t.base},e,n).evaluate(n,r)}}if(i){const n="exponential"===o?{name:"exponential",base:void 0!==t.base?t.base:1}:null;return{kind:"camera",interpolationType:n,interpolationFactor:wn.interpolationFactor.bind(void 0,n),zoomStops:t.stops.map(t=>t[0]),evaluate:({zoom:n})=>s(t,e,n,a,c)}}return{kind:"source",evaluate(n,r){const i=r&&r.properties?r.properties[t.property]:void 0;return void 0===i?rr(t.default,e.default):s(t,e,i,a,c)}}}function rr(t,e,n){return void 0!==t?t:void 0!==e?e:void 0!==n?n:void 0}function ir(t,e,n,r,i){return rr(typeof n===i?r[n]:void 0,t.default,e.default)}function or(t,e,n){if("number"!==Jn(n))return rr(t.default,e.default);const r=t.stops.length;if(1===r)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[r-1][0])return t.stops[r-1][1];const i=tn(t.stops.map(t=>t[0]),n);return t.stops[i][1]}function sr(t,e,n){const r=void 0!==t.base?t.base:1;if("number"!==Jn(n))return rr(t.default,e.default);const i=t.stops.length;if(1===i)return t.stops[0][1];if(n<=t.stops[0][0])return t.stops[0][1];if(n>=t.stops[i-1][0])return t.stops[i-1][1];const o=tn(t.stops.map(t=>t[0]),n),s=function(t,e,n,r){const i=r-n,o=t-n;return 0===i?0:1===e?o/i:(Math.pow(e,o)-1)/(Math.pow(e,i)-1)}(n,r,t.stops[o][0],t.stops[o+1][0]),a=t.stops[o][1],c=t.stops[o+1][1];let l=rn[e.type]||er;if(t.colorSpace&&"rgb"!==t.colorSpace){const e=xn[t.colorSpace];l=(t,n)=>e.reverse(e.interpolate(e.forward(t),e.forward(n),s))}return"function"==typeof a.evaluate?{evaluate(...t){const e=a.evaluate.apply(void 0,t),n=c.evaluate.apply(void 0,t);if(void 0!==e&&void 0!==n)return l(e,n,s)}}:l(a,c,s)}function ar(t,e,n){return"color"===e.type?n=ue.parse(n):"formatted"===e.type?n=pe.fromString(n.toString()):"resolvedImage"===e.type?n=fe.fromString(n.toString()):Jn(n)===e.type||"enum"===e.type&&e.values[n]||(n=void 0),rr(n,t.default,e.default)}Ae.register(qn,{error:[{kind:"error"},[Zt],(t,[e])=>{throw new be(e.evaluate(t))}],typeof:[Zt,[Qt],(t,[e])=>re(_e(e.evaluate(t)))],"to-rgba":[ne(Ht,4),[Xt],(t,[e])=>e.evaluate(t).toArray()],rgb:[Xt,[Ht,Ht,Ht],Gn],rgba:[Xt,[Ht,Ht,Ht,Ht],Gn],has:{type:Kt,overloads:[[[Zt],(t,[e])=>$n(e.evaluate(t),t.properties())],[[Zt,Yt],(t,[e,n])=>$n(e.evaluate(t),n.evaluate(t))]]},get:{type:Qt,overloads:[[[Zt],(t,[e])=>Wn(e.evaluate(t),t.properties())],[[Zt,Yt],(t,[e,n])=>Wn(e.evaluate(t),n.evaluate(t))]]},"feature-state":[Qt,[Zt],(t,[e])=>Wn(e.evaluate(t),t.featureState||{})],properties:[Yt,[],t=>t.properties()],"geometry-type":[Zt,[],t=>t.geometryType()],id:[Qt,[],t=>t.id()],zoom:[Ht,[],t=>t.globals.zoom],pitch:[Ht,[],t=>t.globals.pitch||0],"distance-from-center":[Ht,[],t=>t.distanceFromCenter()],"heatmap-density":[Ht,[],t=>t.globals.heatmapDensity||0],"line-progress":[Ht,[],t=>t.globals.lineProgress||0],"sky-radial-progress":[Ht,[],t=>t.globals.skyRadialProgress||0],accumulated:[Qt,[],t=>void 0===t.globals.accumulated?null:t.globals.accumulated],"+":[Ht,Hn(Ht),(t,e)=>{let n=0;for(const r of e)n+=r.evaluate(t);return n}],"*":[Ht,Hn(Ht),(t,e)=>{let n=1;for(const r of e)n*=r.evaluate(t);return n}],"-":{type:Ht,overloads:[[[Ht,Ht],(t,[e,n])=>e.evaluate(t)-n.evaluate(t)],[[Ht],(t,[e])=>-e.evaluate(t)]]},"/":[Ht,[Ht,Ht],(t,[e,n])=>e.evaluate(t)/n.evaluate(t)],"%":[Ht,[Ht,Ht],(t,[e,n])=>e.evaluate(t)%n.evaluate(t)],ln2:[Ht,[],()=>Math.LN2],pi:[Ht,[],()=>Math.PI],e:[Ht,[],()=>Math.E],"^":[Ht,[Ht,Ht],(t,[e,n])=>Math.pow(e.evaluate(t),n.evaluate(t))],sqrt:[Ht,[Ht],(t,[e])=>Math.sqrt(e.evaluate(t))],log10:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))/Math.LN10],ln:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))],log2:[Ht,[Ht],(t,[e])=>Math.log(e.evaluate(t))/Math.LN2],sin:[Ht,[Ht],(t,[e])=>Math.sin(e.evaluate(t))],cos:[Ht,[Ht],(t,[e])=>Math.cos(e.evaluate(t))],tan:[Ht,[Ht],(t,[e])=>Math.tan(e.evaluate(t))],asin:[Ht,[Ht],(t,[e])=>Math.asin(e.evaluate(t))],acos:[Ht,[Ht],(t,[e])=>Math.acos(e.evaluate(t))],atan:[Ht,[Ht],(t,[e])=>Math.atan(e.evaluate(t))],min:[Ht,Hn(Ht),(t,e)=>Math.min(...e.map(e=>e.evaluate(t)))],max:[Ht,Hn(Ht),(t,e)=>Math.max(...e.map(e=>e.evaluate(t)))],abs:[Ht,[Ht],(t,[e])=>Math.abs(e.evaluate(t))],round:[Ht,[Ht],(t,[e])=>{const n=e.evaluate(t);return n<0?-Math.round(-n):Math.round(n)}],floor:[Ht,[Ht],(t,[e])=>Math.floor(e.evaluate(t))],ceil:[Ht,[Ht],(t,[e])=>Math.ceil(e.evaluate(t))],"filter-==":[Kt,[Zt,Qt],(t,[e,n])=>t.properties()[e.value]===n.value],"filter-id-==":[Kt,[Qt],(t,[e])=>t.id()===e.value],"filter-type-==":[Kt,[Zt],(t,[e])=>t.geometryType()===e.value],"filter-<":[Kt,[Zt,Qt],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r<i}],"filter-id-<":[Kt,[Qt],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<r}],"filter->":[Kt,[Zt,Qt],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r>i}],"filter-id->":[Kt,[Qt],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>r}],"filter-<=":[Kt,[Zt,Qt],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r<=i}],"filter-id-<=":[Kt,[Qt],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n<=r}],"filter->=":[Kt,[Zt,Qt],(t,[e,n])=>{const r=t.properties()[e.value],i=n.value;return typeof r==typeof i&&r>=i}],"filter-id->=":[Kt,[Qt],(t,[e])=>{const n=t.id(),r=e.value;return typeof n==typeof r&&n>=r}],"filter-has":[Kt,[Qt],(t,[e])=>e.value in t.properties()],"filter-has-id":[Kt,[],t=>null!==t.id()&&void 0!==t.id()],"filter-type-in":[Kt,[ne(Zt)],(t,[e])=>e.value.indexOf(t.geometryType())>=0],"filter-id-in":[Kt,[ne(Qt)],(t,[e])=>e.value.indexOf(t.id())>=0],"filter-in-small":[Kt,[Zt,ne(Qt)],(t,[e,n])=>n.value.indexOf(t.properties()[e.value])>=0],"filter-in-large":[Kt,[Zt,ne(Qt)],(t,[e,n])=>function(t,e,n,r){for(;n<=r;){const i=n+r>>1;if(e[i]===t)return!0;e[i]>t?r=i-1:n=i+1}return!1}(t.properties()[e.value],n.value,0,n.value.length-1)],all:{type:Kt,overloads:[[[Kt,Kt],(t,[e,n])=>e.evaluate(t)&&n.evaluate(t)],[Hn(Kt),(t,e)=>{for(const n of e)if(!n.evaluate(t))return!1;return!0}]]},any:{type:Kt,overloads:[[[Kt,Kt],(t,[e,n])=>e.evaluate(t)||n.evaluate(t)],[Hn(Kt),(t,e)=>{for(const n of e)if(n.evaluate(t))return!0;return!1}]]},"!":[Kt,[Kt],(t,[e])=>!e.evaluate(t)],"is-supported-script":[Kt,[Zt],(t,[e])=>{const n=t.globals&&t.globals.isSupportedScript;return!n||n(e.evaluate(t))}],upcase:[Zt,[Zt],(t,[e])=>e.evaluate(t).toUpperCase()],downcase:[Zt,[Zt],(t,[e])=>e.evaluate(t).toLowerCase()],concat:[Zt,Hn(Qt),(t,e)=>e.map(e=>ye(e.evaluate(t))).join("")],"resolved-locale":[Zt,[Jt],(t,[e])=>e.evaluate(t).resolvedLocale()]});class cr{constructor(t,e){this.expression=t,this._warningHistory={},this._evaluator=new ke,this._defaultValue=e?function(t){return"color"===t.type&&tr(t.default)?new ue(0,0,0,0):"color"===t.type?ue.parse(t.default)||null:void 0===t.default?null:t.default}(e):null,this._enumValues=e&&"enum"===e.type?e.values:null}evaluateWithoutErrorHandling(t,e,n,r,i,o,s,a){return this._evaluator.globals=t,this._evaluator.feature=e,this._evaluator.featureState=n,this._evaluator.canonical=r||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(t,e,n,r,i,o,s,a){this._evaluator.globals=t,this._evaluator.feature=e||null,this._evaluator.featureState=n||null,this._evaluator.canonical=r||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=o||null,this._evaluator.featureTileCoord=s||null,this._evaluator.featureDistanceData=a||null;try{const t=this.expression.evaluate(this._evaluator);if(null==t||"number"==typeof t&&t!=t)return this._defaultValue;if(this._enumValues&&!(t in this._enumValues))throw new be(`Expected value to be one of ${Object.keys(this._enumValues).map(t=>JSON.stringify(t)).join(", ")}, but found ${JSON.stringify(t)} instead.`);return t}catch(t){return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn(t.message)),this._defaultValue}}}function lr(t){return Array.isArray(t)&&t.length>0&&"string"==typeof t[0]&&t[0]in qn}function ur(t,e){const n=new Qe(qn,[],e?function(t){const e={color:Xt,string:Zt,number:Ht,enum:Zt,boolean:Kt,formatted:te,resolvedImage:ee};return"array"===t.type?ne(e[t.value]||Qt,t.length):e[t.type]}(e):void 0),r=n.parse(t,void 0,void 0,void 0,e&&"string"===e.type?{typeAnnotation:"coerce"}:void 0);return r?Zn(new cr(r,e)):Kn(n.errors)}class hr{constructor(t,e){this.kind=t,this._styleExpression=e,this.isStateDependent="constant"!==t&&!Ke(e.expression)}evaluateWithoutErrorHandling(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)}evaluate(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)}}class dr{constructor(t,e,n,r){this.kind=t,this.zoomStops=n,this._styleExpression=e,this.isStateDependent="camera"!==t&&!Ke(e.expression),this.interpolationType=r}evaluateWithoutErrorHandling(t,e,n,r,i,o){return this._styleExpression.evaluateWithoutErrorHandling(t,e,n,r,i,o)}evaluate(t,e,n,r,i,o){return this._styleExpression.evaluate(t,e,n,r,i,o)}interpolationFactor(t,e,n){return this.interpolationType?wn.interpolationFactor(this.interpolationType,t,e,n):0}}function pr(t,e){if("error"===(t=ur(t,e)).result)return t;const n=t.value.expression,r=Ze(n);if(!r&&!Xn(e))return Kn([new Gt("","data expressions not supported")]);const i=Xe(n,["zoom","pitch","distance-from-center"]);if(!i&&!Yn(e))return Kn([new Gt("","zoom expressions not supported")]);const o=mr(n);return o||i?o instanceof Gt?Kn([o]):o instanceof wn&&!Qn(e)?Kn([new Gt("",'"interpolate" expressions cannot be used with this property')]):Zn(o?new dr(r?"camera":"composite",t.value,o.labels,o instanceof wn?o.interpolation:void 0):new hr(r?"constant":"source",t.value)):Kn([new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}class fr{constructor(t,e){this._parameters=t,this._specification=e,Ut(this,nr(this._parameters,this._specification))}static deserialize(t){return new fr(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function mr(t){let e=null;if(t instanceof En)e=mr(t.result);else if(t instanceof Cn){for(const n of t.args)if(e=mr(n),e)break}else(t instanceof en||t instanceof wn)&&t.input instanceof Ae&&"zoom"===t.input.name&&(e=t);return e instanceof Gt||t.eachChild(t=>{const n=mr(t);n instanceof Gt?e=n:!e&&n?e=new Gt("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):e&&n&&e!==n&&(e=new Gt("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),e}class gr{constructor(t,e,n,r){this.message=(t?`${t}: `:"")+n,r&&(this.identifier=r),null!=e&&e.__line__&&(this.line=e.__line__)}}function _r(t){const e=t.key,n=t.value,r=t.valueSpec||{},i=t.objectElementValidators||{},o=t.style,s=t.styleSpec;let a=[];const c=Jn(n);if("object"!==c)return[new gr(e,n,`object expected, ${c} found`)];for(const l in n){const t=l.split(".")[0],c=r[t]||r["*"];let u;i[t]?u=i[t]:r[t]?u=Xr:i["*"]?u=i["*"]:r["*"]&&(u=Xr),u?a=a.concat(u({key:(e?`${e}.`:e)+l,value:n[l],valueSpec:c,style:o,styleSpec:s,object:n,objectKey:l},n)):a.push(new gr(e,n[l],`unknown property "${l}"`))}for(const l in r)i[l]||r[l].required&&void 0===r[l].default&&void 0===n[l]&&a.push(new gr(e,n,`missing required property "${l}"`));return a}function yr(t){const e=t.value,n=t.valueSpec,r=t.style,i=t.styleSpec,o=t.key,s=t.arrayElementValidator||Xr;if("array"!==Jn(e))return[new gr(o,e,`array expected, ${Jn(e)} found`)];if(n.length&&e.length!==n.length)return[new gr(o,e,`array length ${n.length} expected, length ${e.length} found`)];if(n["min-length"]&&e.length<n["min-length"])return[new gr(o,e,`array length at least ${n["min-length"]} expected, length ${e.length} found`)];let a={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};i.$version<7&&(a.function=n.function),"object"===Jn(n.value)&&(a=n.value);let c=[];for(let l=0;l<e.length;l++)c=c.concat(s({array:e,arrayIndex:l,value:e[l],valueSpec:a,style:r,styleSpec:i,key:`${o}[${l}]`}));return c}function vr(t){const e=t.key,n=t.value,r=t.valueSpec;let i=Jn(n);if("number"===i&&n!=n&&(i="NaN"),"number"!==i)return[new gr(e,n,`number expected, ${i} found`)];if("minimum"in r){let i=r.minimum;if("array"===Jn(r.minimum)&&(i=r.minimum[t.arrayIndex]),n<i)return[new gr(e,n,`${n} is less than the minimum value ${i}`)]}if("maximum"in r){let i=r.maximum;if("array"===Jn(r.maximum)&&(i=r.maximum[t.arrayIndex]),n>i)return[new gr(e,n,`${n} is greater than the maximum value ${i}`)]}return[]}function br(t){const e=t.valueSpec,n=Vt(t.value.type);let r,i,o,s={};const a="categorical"!==n&&void 0===t.value.property,c=!a,l="array"===Jn(t.value.stops)&&"array"===Jn(t.value.stops[0])&&"object"===Jn(t.value.stops[0][0]),u=_r({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===n)return[new gr(t.key,t.value,'identity function may not have a "stops" property')];let e=[];const r=t.value;return e=e.concat(yr({key:t.key,value:r,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:h})),"array"===Jn(r)&&0===r.length&&e.push(new gr(t.key,r,"array must have at least one stop")),e},default:function(t){return Xr({key:t.key,value:t.value,valueSpec:e,style:t.style,styleSpec:t.styleSpec})}}});return"identity"===n&&a&&u.push(new gr(t.key,t.value,'missing required property "property"')),"identity"===n||t.value.stops||u.push(new gr(t.key,t.value,'missing required property "stops"')),"exponential"===n&&t.valueSpec.expression&&!Qn(t.valueSpec)&&u.push(new gr(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(c&&!Xn(t.valueSpec)?u.push(new gr(t.key,t.value,"property functions not supported")):a&&!Yn(t.valueSpec)&&u.push(new gr(t.key,t.value,"zoom functions not supported"))),"categorical"!==n&&!l||void 0!==t.value.property||u.push(new gr(t.key,t.value,'"property" property is required')),u;function h(t){let n=[];const r=t.value,a=t.key;if("array"!==Jn(r))return[new gr(a,r,`array expected, ${Jn(r)} found`)];if(2!==r.length)return[new gr(a,r,`array length 2 expected, length ${r.length} found`)];if(l){if("object"!==Jn(r[0]))return[new gr(a,r,`object expected, ${Jn(r[0])} found`)];if(void 0===r[0].zoom)return[new gr(a,r,"object stop key must have zoom")];if(void 0===r[0].value)return[new gr(a,r,"object stop key must have value")];const e=Vt(r[0].zoom);if("number"!=typeof e)return[new gr(a,r[0].zoom,"stop zoom values must be numbers")];if(o&&o>e)return[new gr(a,r[0].zoom,"stop zoom values must appear in ascending order")];e!==o&&(o=e,i=void 0,s={}),n=n.concat(_r({key:`${a}[0]`,value:r[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:vr,value:d}}))}else n=n.concat(d({key:`${a}[0]`,value:r[0],valueSpec:{},style:t.style,styleSpec:t.styleSpec},r));return lr(qt(r[1]))?n.concat([new gr(`${a}[1]`,r[1],"expressions are not allowed in function stops.")]):n.concat(Xr({key:`${a}[1]`,value:r[1],valueSpec:e,style:t.style,styleSpec:t.styleSpec}))}function d(t,o){const a=Jn(t.value),c=Vt(t.value),l=null!==t.value?t.value:o;if(r){if(a!==r)return[new gr(t.key,l,`${a} stop domain type must match previous stop domain type ${r}`)]}else r=a;if("number"!==a&&"string"!==a&&"boolean"!==a&&"number"!=typeof c&&"string"!=typeof c&&"boolean"!=typeof c)return[new gr(t.key,l,"stop domain value must be a number, string, or boolean")];if("number"!==a&&"categorical"!==n){let r=`number expected, ${a} found`;return Xn(e)&&void 0===n&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new gr(t.key,l,r)]}return"categorical"!==n||"number"!==a||"number"==typeof c&&isFinite(c)&&Math.floor(c)===c?"categorical"!==n&&"number"===a&&"number"==typeof c&&"number"==typeof i&&void 0!==i&&c<i?[new gr(t.key,l,"stop domain values must appear in ascending order")]:(i=c,"categorical"===n&&c in s?[new gr(t.key,l,"stop domain values must be unique")]:(s[c]=!0,[])):[new gr(t.key,l,`integer expected, found ${String(c)}`)]}}function xr(t){const e=("property"===t.expressionContext?pr:ur)(qt(t.value),t.valueSpec);if("error"===e.result)return e.value.map(e=>new gr(`${t.key}${e.key}`,t.value,e.message));const n=e.value.expression||e.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new gr(t.key,t.value,`Invalid data expression for "${t.propertyKey}". Output values must be contained as literals within the expression.`)];if("property"===t.expressionContext&&"layout"===t.propertyType&&!Ke(n))return[new gr(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return wr(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!Xe(n,["zoom","feature-state"]))return[new gr(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!Ze(n))return[new gr(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function wr(t,e){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(e.valueSpec&&e.valueSpec.expression)for(const i of e.valueSpec.expression.parameters)n.delete(i);if(0===n.size)return[];const r=[];return t instanceof Ae&&n.has(t.name)?[new gr(e.key,e.value,`["${t.name}"] expression is not supported in a filter for a ${e.object.type} layer with id: ${e.object.id}`)]:(t.eachChild(t=>{r.push(...wr(t,e))}),r)}function Tr(t){const e=t.key,n=t.value,r=t.valueSpec,i=[];return Array.isArray(r.values)?-1===r.values.indexOf(Vt(n))&&i.push(new gr(e,n,`expected one of [${r.values.join(", ")}], ${JSON.stringify(n)} found`)):-1===Object.keys(r.values).indexOf(Vt(n))&&i.push(new gr(e,n,`expected one of [${Object.keys(r.values).join(", ")}], ${JSON.stringify(n)} found`)),i}function Cr(t){if(!0===t||!1===t)return!0;if(!Array.isArray(t)||0===t.length)return!1;switch(t[0]){case"has":return t.length>=2&&"$id"!==t[1]&&"$type"!==t[1];case"in":return t.length>=3&&("string"!=typeof t[1]||Array.isArray(t[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==t.length||Array.isArray(t[1])||Array.isArray(t[2]);case"any":case"all":for(const e of t.slice(1))if(!Cr(e)&&"boolean"!=typeof e)return!1;return!0;default:return!0}}function Er(t,e="fill"){if(null==t)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Cr(t)||(t=Pr(t));const n=t;let r=!0;try{r=function(t){if(!kr(t))return t;let e=qt(t);return Ir(e),e=Sr(e),e}(n)}catch(t){console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n${JSON.stringify(n,null,2)}\n        `)}const i=Bt[`filter_${e}`],o=ur(r,i);let s=null;if("error"===o.result)throw new Error(o.value.map(t=>`${t.key}: ${t.message}`).join(", "));s=(t,e,n)=>o.value.evaluate(t,e,{},n);let a=null,c=null;if(r!==n){const t=ur(n,i);if("error"===t.result)throw new Error(t.value.map(t=>`${t.key}: ${t.message}`).join(", "));a=(e,n,r,i,o)=>t.value.evaluate(e,n,{},r,void 0,void 0,i,o),c=!Ze(t.value.expression)}return s=s,{filter:s,dynamicFilter:a||void 0,needGeometry:Or(r),needFeature:!!c}}function Sr(t){if(!Array.isArray(t))return t;const e=function(t){if(Ar.has(t[0]))for(let e=1;e<t.length;e++)if(kr(t[e]))return!0;return t}(t);return!0===e?e:e.map(t=>Sr(t))}function Ir(t){let e=!1;const n=[];if("case"===t[0]){for(let r=1;r<t.length-1;r+=2)e=e||kr(t[r]),n.push(t[r+1]);n.push(t[t.length-1])}else if("match"===t[0]){e=e||kr(t[1]);for(let e=2;e<t.length-1;e+=2)n.push(t[e+1]);n.push(t[t.length-1])}else if("step"===t[0]){e=e||kr(t[1]);for(let e=1;e<t.length-1;e+=2)n.push(t[e+1])}e&&(t.length=0,t.push("any",...n));for(let r=1;r<t.length;r++)Ir(t[r])}function kr(t){if(!Array.isArray(t))return!1;if("pitch"===(e=t[0])||"distance-from-center"===e)return!0;var e;for(let n=1;n<t.length;n++)if(kr(t[n]))return!0;return!1}const Ar=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Mr(t,e){return t<e?-1:t>e?1:0}function Or(t){if(!Array.isArray(t))return!1;if("within"===t[0])return!0;for(let e=1;e<t.length;e++)if(Or(t[e]))return!0;return!1}function Pr(t){if(!t)return!0;const e=t[0];return t.length<=1?"any"!==e:"=="===e?Dr(t[1],t[2],"=="):"!="===e?Lr(Dr(t[1],t[2],"==")):"<"===e||">"===e||"<="===e||">="===e?Dr(t[1],t[2],e):"any"===e?(n=t.slice(1),["any"].concat(n.map(Pr))):"all"===e?["all"].concat(t.slice(1).map(Pr)):"none"===e?["all"].concat(t.slice(1).map(Pr).map(Lr)):"in"===e?Rr(t[1],t.slice(2)):"!in"===e?Lr(Rr(t[1],t.slice(2))):"has"===e?Nr(t[1]):"!has"===e?Lr(Nr(t[1])):"within"!==e||t;var n}function Dr(t,e,n){switch(t){case"$type":return[`filter-type-${n}`,e];case"$id":return[`filter-id-${n}`,e];default:return[`filter-${n}`,t,e]}}function Rr(t,e){if(0===e.length)return!1;switch(t){case"$type":return["filter-type-in",["literal",e]];case"$id":return["filter-id-in",["literal",e]];default:return e.length>200&&!e.some(t=>typeof t!=typeof e[0])?["filter-in-large",t,["literal",e.sort(Mr)]]:["filter-in-small",t,["literal",e]]}}function Nr(t){switch(t){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",t]}}function Lr(t){return["!",t]}function jr(t){return Cr(qt(t.value))?xr(Ut({},t,{expressionContext:"filter",valueSpec:t.styleSpec[`filter_${t.layerType||"fill"}`]})):zr(t)}function zr(t){const e=t.value,n=t.key;if("array"!==Jn(e))return[new gr(n,e,`array expected, ${Jn(e)} found`)];const r=t.styleSpec;let i,o=[];if(e.length<1)return[new gr(n,e,"filter array must have at least 1 element")];switch(o=o.concat(Tr({key:`${n}[0]`,value:e[0],valueSpec:r.filter_operator,style:t.style,styleSpec:t.styleSpec})),Vt(e[0])){case"<":case"<=":case">":case">=":e.length>=2&&"$type"===Vt(e[1])&&o.push(new gr(n,e,`"$type" cannot be use with operator "${e[0]}"`));case"==":case"!=":3!==e.length&&o.push(new gr(n,e,`filter array for operator "${e[0]}" must have 3 elements`));case"in":case"!in":e.length>=2&&(i=Jn(e[1]),"string"!==i&&o.push(new gr(`${n}[1]`,e[1],`string expected, ${i} found`)));for(let s=2;s<e.length;s++)i=Jn(e[s]),"$type"===Vt(e[1])?o=o.concat(Tr({key:`${n}[${s}]`,value:e[s],valueSpec:r.geometry_type,style:t.style,styleSpec:t.styleSpec})):"string"!==i&&"number"!==i&&"boolean"!==i&&o.push(new gr(`${n}[${s}]`,e[s],`string, number, or boolean expected, ${i} found`));break;case"any":case"all":case"none":for(let r=1;r<e.length;r++)o=o.concat(zr({key:`${n}[${r}]`,value:e[r],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":i=Jn(e[1]),2!==e.length?o.push(new gr(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"string"!==i&&o.push(new gr(`${n}[1]`,e[1],`string expected, ${i} found`));break;case"within":i=Jn(e[1]),2!==e.length?o.push(new gr(n,e,`filter array for "${e[0]}" operator must have 2 elements`)):"object"!==i&&o.push(new gr(`${n}[1]`,e[1],`object expected, ${i} found`))}return o}function Fr(t,e){const n=t.key,r=t.style,i=t.styleSpec,o=t.value,s=t.objectKey,a=i[`${e}_${t.layerType}`];if(!a)return[];const c=s.match(/^(.*)-transition$/);if("paint"===e&&c&&a[c[1]]&&a[c[1]].transition)return Xr({key:n,value:o,valueSpec:i.transition,style:r,styleSpec:i});const l=t.valueSpec||a[s];if(!l)return[new gr(n,o,`unknown property "${s}"`)];let u;if("string"===Jn(o)&&Xn(l)&&!l.tokens&&(u=/^{([^}]+)}$/.exec(o)))return[new gr(n,o,`"${s}" does not support interpolation syntax\nUse an identity property function instead: \`{ "type": "identity", "property": ${JSON.stringify(u[1])} }\`.`)];const h=[];return"symbol"===t.layerType&&("text-field"===s&&r&&!r.glyphs&&h.push(new gr(n,o,'use of "text-field" requires a style "glyphs" property')),"text-font"===s&&tr(qt(o))&&"identity"===Vt(o.type)&&h.push(new gr(n,o,'"text-font" does not support identity functions'))),h.concat(Xr({key:t.key,value:o,valueSpec:l,style:r,styleSpec:i,expressionContext:"property",propertyType:e,propertyKey:s}))}function Br(t){return Fr(t,"paint")}function Ur(t){return Fr(t,"layout")}function Vr(t){let e=[];const n=t.value,r=t.key,i=t.style,o=t.styleSpec;n.type||n.ref||e.push(new gr(r,n,'either "type" or "ref" is required'));let s=Vt(n.type);const a=Vt(n.ref);if(n.id){const o=Vt(n.id);for(let s=0;s<t.arrayIndex;s++){const t=i.layers[s];Vt(t.id)===o&&e.push(new gr(r,n.id,`duplicate layer id "${n.id}", previously used at line ${t.id.__line__}`))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in n&&e.push(new gr(r,n[t],`"${t}" is prohibited for ref layers`))}),i.layers.forEach(e=>{Vt(e.id)===a&&(t=e)}),t?t.ref?e.push(new gr(r,n.ref,"ref cannot reference another ref layer")):s=Vt(t.type):"string"==typeof a&&e.push(new gr(r,n.ref,`ref layer "${a}" not found`))}else if("background"!==s&&"sky"!==s)if(n.source){const t=i.sources&&i.sources[n.source],o=t&&Vt(t.type);t?"vector"===o&&"raster"===s?e.push(new gr(r,n.source,`layer "${n.id}" requires a raster source`)):"raster"===o&&"raster"!==s?e.push(new gr(r,n.source,`layer "${n.id}" requires a vector source`)):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==s?e.push(new gr(r,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"line"!==s||!n.paint||!n.paint["line-gradient"]||"geojson"===o&&t.lineMetrics||e.push(new gr(r,n,`layer "${n.id}" specifies a line-gradient, which requires a GeoJSON source with \`lineMetrics\` enabled.`)):e.push(new gr(r,n,`layer "${n.id}" must specify a "source-layer"`)):e.push(new gr(r,n.source,`source "${n.source}" not found`))}else e.push(new gr(r,n,'missing required property "source"'));return e=e.concat(_r({key:r,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>Xr({key:`${r}.type`,value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:t=>jr(Ut({layerType:s},t)),layout:t=>_r({layer:n,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>Ur(Ut({layerType:s},t))}}),paint:t=>_r({layer:n,key:t.key,value:t.value,valueSpec:{},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":t=>Br(Ut({layerType:s},t))}})}})),e}function qr(t){const e=t.value,n=t.key,r=Jn(e);return"string"!==r?[new gr(n,e,`string expected, ${r} found`)]:[]}const Gr={promoteId:function({key:t,value:e}){if("string"===Jn(e))return qr({key:t,value:e});{const n=[];for(const r in e)n.push(...qr({key:`${t}.${r}`,value:e[r]}));return n}}};function $r(t){const e=t.value,n=t.key,r=t.styleSpec,i=t.style;if(!e.type)return[new gr(n,e,'"type" is required')];const o=Vt(e.type);let s;switch(o){case"vector":case"raster":case"raster-dem":return s=_r({key:n,value:e,valueSpec:r[`source_${o.replace("-","_")}`],style:t.style,styleSpec:r,objectElementValidators:Gr}),s;case"geojson":if(s=_r({key:n,value:e,valueSpec:r.source_geojson,style:i,styleSpec:r,objectElementValidators:Gr}),e.cluster)for(const t in e.clusterProperties){const[r,i]=e.clusterProperties[t],o="string"==typeof r?[r,["accumulated"],["get",t]]:r;s.push(...xr({key:`${n}.${t}.map`,value:i,expressionContext:"cluster-map"})),s.push(...xr({key:`${n}.${t}.reduce`,value:o,expressionContext:"cluster-reduce"}))}return s;case"video":return _r({key:n,value:e,valueSpec:r.source_video,style:i,styleSpec:r});case"image":return _r({key:n,value:e,valueSpec:r.source_image,style:i,styleSpec:r});case"canvas":return[new gr(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Tr({key:`${n}.type`,value:e.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:i,styleSpec:r})}}function Wr(t){const e=t.value,n=t.styleSpec,r=n.light,i=t.style;let o=[];const s=Jn(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new gr("light",e,`object expected, ${s} found`)]),o;for(const a in e){const t=a.match(/^(.*)-transition$/);o=o.concat(t&&r[t[1]]&&r[t[1]].transition?Xr({key:a,value:e[a],valueSpec:n.transition,style:i,styleSpec:n}):r[a]?Xr({key:a,value:e[a],valueSpec:r[a],style:i,styleSpec:n}):[new gr(a,e[a],`unknown property "${a}"`)])}return o}function Hr(t){const e=t.value,n=t.key,r=t.style,i=t.styleSpec,o=i.terrain;let s=[];const a=Jn(e);if(void 0===e)return s;if("object"!==a)return s=s.concat([new gr("terrain",e,`object expected, ${a} found`)]),s;for(const c in e){const t=c.match(/^(.*)-transition$/);s=s.concat(t&&o[t[1]]&&o[t[1]].transition?Xr({key:c,value:e[c],valueSpec:i.transition,style:r,styleSpec:i}):o[c]?Xr({key:c,value:e[c],valueSpec:o[c],style:r,styleSpec:i}):[new gr(c,e[c],`unknown property "${c}"`)])}if(e.source){const t=r.sources&&r.sources[e.source],i=t&&Vt(t.type);t?"raster-dem"!==i&&s.push(new gr(n,e.source,`terrain cannot be used with a source of type ${String(i)}, it only be used with a "raster-dem" source type`)):s.push(new gr(n,e.source,`source "${e.source}" not found`))}else s.push(new gr(n,e,'terrain is missing required property "source"'));return s}function Zr(t){const e=t.value,n=t.style,r=t.styleSpec,i=r.fog;let o=[];const s=Jn(e);if(void 0===e)return o;if("object"!==s)return o=o.concat([new gr("fog",e,`object expected, ${s} found`)]),o;for(const a in e){const t=a.match(/^(.*)-transition$/);o=o.concat(t&&i[t[1]]&&i[t[1]].transition?Xr({key:a,value:e[a],valueSpec:r.transition,style:n,styleSpec:r}):i[a]?Xr({key:a,value:e[a],valueSpec:i[a],style:n,styleSpec:r}):[new gr(a,e[a],`unknown property "${a}"`)])}return o}const Kr={"*":()=>[],array:yr,boolean:function(t){const e=t.value,n=t.key,r=Jn(e);return"boolean"!==r?[new gr(n,e,`boolean expected, ${r} found`)]:[]},number:vr,color:function(t){const e=t.key,n=t.value,r=Jn(n);return"string"!==r?[new gr(e,n,`color expected, ${r} found`)]:null===le.parseCSSColor(n)?[new gr(e,n,`color expected, "${n}" found`)]:[]},enum:Tr,filter:jr,function:br,layer:Vr,object:_r,source:$r,light:Wr,terrain:Hr,fog:Zr,string:qr,formatted:function(t){return 0===qr(t).length?[]:xr(t)},resolvedImage:function(t){return 0===qr(t).length?[]:xr(t)},projection:function(t){const e=t.value,n=t.styleSpec,r=n.projection,i=t.style;let o=[];const s=Jn(e);if("object"===s)for(const a in e)o=o.concat(Xr({key:a,value:e[a],valueSpec:r[a],style:i,styleSpec:n}));else"string"!==s&&(o=o.concat([new gr("projection",e,`object or string expected, ${s} found`)]));return o}};function Xr(t){const e=t.value,n=t.valueSpec,r=t.styleSpec;return n.expression&&tr(Vt(e))?br(t):n.expression&&lr(qt(e))?xr(t):n.type&&Kr[n.type]?Kr[n.type](t):_r(Ut({},t,{valueSpec:n.type?r[n.type]:n}))}function Yr(t){const e=t.value,n=t.key,r=qr(t);return r.length||(-1===e.indexOf("{fontstack}")&&r.push(new gr(n,e,'"glyphs" url must include a "{fontstack}" token')),-1===e.indexOf("{range}")&&r.push(new gr(n,e,'"glyphs" url must include a "{range}" token'))),r}function Qr(t,e=Bt){return ei(Xr({key:"",value:t,valueSpec:e.$root,styleSpec:e,style:t,objectElementValidators:{glyphs:Yr,"*":()=>[]}}))}const Jr=t=>ei(Br(t)),ti=t=>ei(Ur(t));function ei(t){return t.slice().sort((t,e)=>t.line&&e.line?t.line-e.line:0)}function ni(t,e){let n=!1;if(e&&e.length)for(const r of e)t.fire(new zt(new Error(r.message))),n=!0;return n}var ri=ii;function ii(t,e,n){var r=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var i=new Int32Array(this.arrayBuffer);t=i[0],this.d=(e=i[1])+2*(n=i[2]);for(var o=0;o<this.d*this.d;o++){var s=i[3+o],a=i[3+o+1];r.push(s===a?null:i.subarray(s,a))}var c=i[3+r.length+1];this.keys=i.subarray(i[3+r.length],c),this.bboxes=i.subarray(c),this.insert=this._insertReadonly}else{this.d=e+2*n;for(var l=0;l<this.d*this.d;l++)r.push([]);this.keys=[],this.bboxes=[]}this.n=e,this.extent=t,this.padding=n,this.scale=e/t,this.uid=0;var u=n/e*t;this.min=-u,this.max=t+u}ii.prototype.insert=function(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertCell,this.uid++),this.keys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)},ii.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ii.prototype._insertCell=function(t,e,n,r,i,o){this.cells[i].push(o)},ii.prototype.query=function(t,e,n,r,i){var o=this.min,s=this.max;if(t<=o&&e<=o&&s<=n&&s<=r&&!i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(t,e,n,r,this._queryCell,a,{},i),a},ii.prototype._queryCell=function(t,e,n,r,i,o,s,a){var c=this.cells[i];if(null!==c)for(var l=this.keys,u=this.bboxes,h=0;h<c.length;h++){var d=c[h];if(void 0===s[d]){var p=4*d;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):t<=u[p+2]&&e<=u[p+3]&&n>=u[p+0]&&r>=u[p+1])?(s[d]=!0,o.push(l[d])):s[d]=!1}}},ii.prototype._forEachCell=function(t,e,n,r,i,o,s,a){for(var c=this._convertToCellCoord(t),l=this._convertToCellCoord(e),u=this._convertToCellCoord(n),h=this._convertToCellCoord(r),d=c;d<=u;d++)for(var p=l;p<=h;p++){var f=this.d*p+d;if((!a||a(this._convertFromCellCoord(d),this._convertFromCellCoord(p),this._convertFromCellCoord(d+1),this._convertFromCellCoord(p+1)))&&i.call(this,t,e,n,r,f,o,s,a))return}},ii.prototype._convertFromCellCoord=function(t){return(t-this.padding)/this.scale},ii.prototype._convertToCellCoord=function(t){return Math.max(0,Math.min(this.d-1,Math.floor(t*this.scale)+this.padding))},ii.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,e=3+this.cells.length+1+1,n=0,r=0;r<this.cells.length;r++)n+=this.cells[r].length;var i=new Int32Array(e+n+this.keys.length+this.bboxes.length);i[0]=this.extent,i[1]=this.n,i[2]=this.padding;for(var o=e,s=0;s<t.length;s++){var a=t[s];i[3+s]=o,i.set(a,o),o+=a.length}return i[3+t.length]=o,i.set(this.keys,o),i[3+t.length+1]=o+=this.keys.length,i.set(this.bboxes,o),o+=this.bboxes.length,i.buffer};const oi={};function si(t,e,n={}){Object.defineProperty(t,"_classRegistryKey",{value:e,writeable:!1}),oi[e]={klass:t,omit:n.omit||[]}}si(Object,"Object"),ri.serialize=function(t,e){const n=t.toArrayBuffer();return e&&e.push(n),{buffer:n}},ri.deserialize=function(t){return new ri(t.buffer)},Object.defineProperty(ri,"name",{value:"Grid"}),si(ri,"Grid"),si(ue,"Color"),si(Error,"Error"),si(Ct,"AJAXError"),si(fe,"ResolvedImage"),si(fr,"StylePropertyFunction"),si(cr,"StyleExpression",{omit:["_evaluator"]}),si(dr,"ZoomDependentExpression"),si(hr,"ZoomConstantExpression"),si(Ae,"CompoundExpression",{omit:["_evaluate"]});for(const nf in qn)oi[qn[nf]._classRegistryKey]||si(qn[nf],`Expression${nf}`);function ai(t){return t&&"undefined"!=typeof ArrayBuffer&&(t instanceof ArrayBuffer||t.constructor&&"ArrayBuffer"===t.constructor.name)}function ci(t){return s.ImageBitmap&&t instanceof s.ImageBitmap}function li(t,e){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp)return t;if(ai(t)||ci(t))return e&&e.push(t),t;if(ArrayBuffer.isView(t)){const n=t;return e&&e.push(n.buffer),n}if(t instanceof s.ImageData)return e&&e.push(t.data.buffer),t;if(Array.isArray(t)){const n=[];for(const r of t)n.push(li(r,e));return n}if("object"==typeof t){const n=t.constructor,r=n._classRegistryKey;if(!r)throw new Error(`can't serialize object of unregistered class ${r}`);const i=n.serialize?n.serialize(t,e):{};if(!n.serialize){for(const n in t)t.hasOwnProperty(n)&&(oi[r].omit.indexOf(n)>=0||(i[n]=li(t[n],e)));t instanceof Error&&(i.message=t.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==r&&(i.$name=r),i}throw new Error("can't serialize object of type "+typeof t)}function ui(t){if(null==t||"boolean"==typeof t||"number"==typeof t||"string"==typeof t||t instanceof Boolean||t instanceof Number||t instanceof String||t instanceof Date||t instanceof RegExp||ai(t)||ci(t)||ArrayBuffer.isView(t)||t instanceof s.ImageData)return t;if(Array.isArray(t))return t.map(ui);if("object"==typeof t){const e=t.$name||"Object",{klass:n}=oi[e];if(!n)throw new Error(`can't deserialize unregistered class ${e}`);if(n.deserialize)return n.deserialize(t);const r=Object.create(n.prototype);for(const i of Object.keys(t))"$name"!==i&&(r[i]=ui(t[i]));return r}throw new Error("can't deserialize object of type "+typeof t)}class hi{constructor(){this.first=!0}update(t,e){const n=Math.floor(t);return this.first?(this.first=!1,this.lastIntegerZoom=n,this.lastIntegerZoomTime=0,this.lastZoom=t,this.lastFloorZoom=n,!0):(this.lastFloorZoom>n?(this.lastIntegerZoom=n+1,this.lastIntegerZoomTime=e):this.lastFloorZoom<n&&(this.lastIntegerZoom=n,this.lastIntegerZoomTime=e),t!==this.lastZoom&&(this.lastZoom=t,this.lastFloorZoom=n,!0))}}const di=t=>t>=1536&&t<=1791,pi=t=>t>=1872&&t<=1919,fi=t=>t>=2208&&t<=2303,mi=t=>t>=11904&&t<=12031,gi=t=>t>=12032&&t<=12255,_i=t=>t>=12272&&t<=12287,yi=t=>t>=12288&&t<=12351,vi=t=>t>=12352&&t<=12447,bi=t=>t>=12448&&t<=12543,xi=t=>t>=12544&&t<=12591,wi=t=>t>=12704&&t<=12735,Ti=t=>t>=12736&&t<=12783,Ci=t=>t>=12784&&t<=12799,Ei=t=>t>=12800&&t<=13055,Si=t=>t>=13056&&t<=13311,Ii=t=>t>=13312&&t<=19903,ki=t=>t>=19968&&t<=40959,Ai=t=>t>=40960&&t<=42127,Mi=t=>t>=42128&&t<=42191,Oi=t=>t>=44032&&t<=55215,Pi=t=>t>=63744&&t<=64255,Di=t=>t>=64336&&t<=65023,Ri=t=>t>=65040&&t<=65055,Ni=t=>t>=65072&&t<=65103,Li=t=>t>=65104&&t<=65135,ji=t=>t>=65136&&t<=65279,zi=t=>t>=65280&&t<=65519;function Fi(t){for(const e of t)if(Vi(e.charCodeAt(0)))return!0;return!1}function Bi(t){for(const e of t)if(!Ui(e.charCodeAt(0)))return!1;return!0}function Ui(t){return!(di(t)||pi(t)||fi(t)||Di(t)||ji(t))}function Vi(t){return!(746!==t&&747!==t&&(t<4352||!(wi(t)||xi(t)||Ni(t)&&!(t>=65097&&t<=65103)||Pi(t)||Si(t)||mi(t)||Ti(t)||!(!yi(t)||t>=12296&&t<=12305||t>=12308&&t<=12319||12336===t)||Ii(t)||ki(t)||Ei(t)||(t=>t>=12592&&t<=12687)(t)||(t=>t>=43360&&t<=43391)(t)||(t=>t>=55216&&t<=55295)(t)||(t=>t>=4352&&t<=4607)(t)||Oi(t)||vi(t)||_i(t)||(t=>t>=12688&&t<=12703)(t)||gi(t)||Ci(t)||bi(t)&&12540!==t||!(!zi(t)||65288===t||65289===t||65293===t||t>=65306&&t<=65310||65339===t||65341===t||65343===t||t>=65371&&t<=65503||65507===t||t>=65512&&t<=65519)||!(!Li(t)||t>=65112&&t<=65118||t>=65123&&t<=65126)||(t=>t>=5120&&t<=5759)(t)||(t=>t>=6320&&t<=6399)(t)||Ri(t)||(t=>t>=19904&&t<=19967)(t)||Ai(t)||Mi(t))))}function qi(t){return!(Vi(t)||function(t){return!!((t=>t>=128&&t<=255)(t)&&(167===t||169===t||174===t||177===t||188===t||189===t||190===t||215===t||247===t)||(t=>t>=8192&&t<=8303)(t)&&(8214===t||8224===t||8225===t||8240===t||8241===t||8251===t||8252===t||8258===t||8263===t||8264===t||8265===t||8273===t)||(t=>t>=8448&&t<=8527)(t)||(t=>t>=8528&&t<=8591)(t)||(t=>t>=8960&&t<=9215)(t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||9003===t||t>=9085&&t<=9114||t>=9150&&t<=9165||9167===t||t>=9169&&t<=9179||t>=9186&&t<=9215)||(t=>t>=9216&&t<=9279)(t)&&9251!==t||(t=>t>=9280&&t<=9311)(t)||(t=>t>=9312&&t<=9471)(t)||(t=>t>=9632&&t<=9727)(t)||(t=>t>=9728&&t<=9983)(t)&&!(t>=9754&&t<=9759)||(t=>t>=11008&&t<=11263)(t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||yi(t)||bi(t)||(t=>t>=57344&&t<=63743)(t)||Ni(t)||Li(t)||zi(t)||8734===t||8756===t||8757===t||t>=9984&&t<=10087||t>=10102&&t<=10131||65532===t||65533===t)}(t))}function Gi(t){return t>=1424&&t<=2303||Di(t)||ji(t)}function $i(t,e){return!(!e&&Gi(t)||t>=2304&&t<=3583||t>=3840&&t<=4255||(t=>t>=6016&&t<=6143)(t))}function Wi(t){for(const e of t)if(Gi(e.charCodeAt(0)))return!0;return!1}const Hi="deferred",Zi="loading",Ki="loaded";let Xi=null,Yi="unavailable",Qi=null;const Ji=function(t){t&&"string"==typeof t&&t.indexOf("NetworkError")>-1&&(Yi="error"),Xi&&Xi(t)};function to(){eo.fire(new jt("pluginStateChange",{pluginStatus:Yi,pluginURL:Qi}))}const eo=new Ft,no=function(){return Yi},ro=function(){if(Yi!==Hi||!Qi)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");Yi=Zi,to(),Qi&&It({url:Qi},t=>{t?Ji(t):(Yi=Ki,to())})},io={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>Yi===Ki||null!=io.applyArabicShaping,isLoading:()=>Yi===Zi,setState(t){Yi=t.pluginStatus,Qi=t.pluginURL},isParsed:()=>null!=io.applyArabicShaping&&null!=io.processBidirectionalText&&null!=io.processStyledBidirectionalText,getPluginURL:()=>Qi};class oo{constructor(t,e){this.zoom=t,e?(this.now=e.now,this.fadeDuration=e.fadeDuration,this.zoomHistory=e.zoomHistory,this.transition=e.transition,this.pitch=e.pitch):(this.now=0,this.fadeDuration=0,this.zoomHistory=new hi,this.transition={},this.pitch=0)}isSupportedScript(t){return function(t,e){for(const n of t)if(!$i(n.charCodeAt(0),e))return!1;return!0}(t,io.isLoaded())}crossFadingFactor(){return 0===this.fadeDuration?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)}getCrossfadeParameters(){const t=this.zoom,e=t-Math.floor(t),n=this.crossFadingFactor();return t>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:e+(1-e)*n}:{fromScale:.5,toScale:1,t:1-(1-n)*e}}}class so{constructor(t,e){this.property=t,this.value=e,this.expression=function(t,e){if(tr(t))return new fr(t,e);if(lr(t)){const n=pr(t,e);if("error"===n.result)throw new Error(n.value.map(t=>`${t.key}: ${t.message}`).join(", "));return n.value}{let n=t;return"string"==typeof t&&"color"===e.type&&(n=ue.parse(t)),{kind:"constant",evaluate:()=>n}}}(void 0===e?t.specification.default:e,t.specification)}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(t,e,n){return this.property.possiblyEvaluate(this,t,e,n)}}class ao{constructor(t){this.property=t,this.value=new so(t,void 0)}transitioned(t,e){return new lo(this.property,this.value,e,b({},t.transition,this.transition),t.now)}untransitioned(){return new lo(this.property,this.value,null,{},0)}}class co{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues)}getValue(t){return M(this._values[t].value.value)}setValue(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ao(this._values[t].property)),this._values[t].value=new so(this._values[t].property,null===e?void 0:M(e))}getTransition(t){return M(this._values[t].transition)}setTransition(t,e){this._values.hasOwnProperty(t)||(this._values[t]=new ao(this._values[t].property)),this._values[t].transition=M(e)||void 0}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n);const r=this.getTransition(e);void 0!==r&&(t[`${e}-transition`]=r)}return t}transitioned(t,e){const n=new uo(this._properties);for(const r of Object.keys(this._values))n._values[r]=this._values[r].transitioned(t,e._values[r]);return n}untransitioned(){const t=new uo(this._properties);for(const e of Object.keys(this._values))t._values[e]=this._values[e].untransitioned();return t}}class lo{constructor(t,e,n,r,i){const o=r.delay||0,s=r.duration||0;i=i||0,this.property=t,this.value=e,this.begin=i+o,this.end=this.begin+s,t.specification.transition&&(r.delay||r.duration)&&(this.prior=n)}possiblyEvaluate(t,e,n){const r=t.now||0,i=this.value.possiblyEvaluate(t,e,n),o=this.prior;if(o){if(r>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(r<this.begin)return o.possiblyEvaluate(t,e,n);{const s=(r-this.begin)/(this.end-this.begin);return this.property.interpolate(o.possiblyEvaluate(t,e,n),i,d(s))}}return i}}class uo{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,e,n){const r=new fo(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(t,e,n);return r}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class ho{constructor(t){this._properties=t,this._values=Object.create(t.defaultPropertyValues)}getValue(t){return M(this._values[t].value)}setValue(t,e){this._values[t]=new so(this._values[t].property,null===e?void 0:M(e))}serialize(){const t={};for(const e of Object.keys(this._values)){const n=this.getValue(e);void 0!==n&&(t[e]=n)}return t}possiblyEvaluate(t,e,n){const r=new fo(this._properties);for(const i of Object.keys(this._values))r._values[i]=this._values[i].possiblyEvaluate(t,e,n);return r}}class po{constructor(t,e,n){this.property=t,this.value=e,this.parameters=n}isConstant(){return"constant"===this.value.kind}constantOr(t){return"constant"===this.value.kind?this.value.value:t}evaluate(t,e,n,r){return this.property.evaluate(this.value,this.parameters,t,e,n,r)}}class fo{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class mo{constructor(t){this.specification=t}possiblyEvaluate(t,e){return t.expression.evaluate(e)}interpolate(t,e,n){const r=rn[this.specification.type];return r?r(t,e,n):t}}class go{constructor(t,e){this.specification=t,this.overrides=e}possiblyEvaluate(t,e,n,r){return new po(this,"constant"===t.expression.kind||"camera"===t.expression.kind?{kind:"constant",value:t.expression.evaluate(e,null,{},n,r)}:t.expression,e)}interpolate(t,e,n){if("constant"!==t.value.kind||"constant"!==e.value.kind)return t;if(void 0===t.value.value||void 0===e.value.value)return new po(this,{kind:"constant",value:void 0},t.parameters);const r=rn[this.specification.type];return r?new po(this,{kind:"constant",value:r(t.value.value,e.value.value,n)},t.parameters):t}evaluate(t,e,n,r,i,o){return"constant"===t.kind?t.value:t.evaluate(e,n,r,i,o)}}class _o extends go{possiblyEvaluate(t,e,n,r){if(void 0===t.value)return new po(this,{kind:"constant",value:void 0},e);if("constant"===t.expression.kind){const i=t.expression.evaluate(e,null,{},n,r),o="resolvedImage"===t.property.specification.type&&"string"!=typeof i?i.name:i,s=this._calculate(o,o,o,e);return new po(this,{kind:"constant",value:s},e)}if("camera"===t.expression.kind){const n=this._calculate(t.expression.evaluate({zoom:e.zoom-1}),t.expression.evaluate({zoom:e.zoom}),t.expression.evaluate({zoom:e.zoom+1}),e);return new po(this,{kind:"constant",value:n},e)}return new po(this,t.expression,e)}evaluate(t,e,n,r,i,o){if("source"===t.kind){const s=t.evaluate(e,n,r,i,o);return this._calculate(s,s,s,e)}return"composite"===t.kind?this._calculate(t.evaluate({zoom:Math.floor(e.zoom)-1},n,r),t.evaluate({zoom:Math.floor(e.zoom)},n,r),t.evaluate({zoom:Math.floor(e.zoom)+1},n,r),e):t.value}_calculate(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e,other:n}:{from:n,to:e,other:t}}interpolate(t){return t}}class yo{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,r){if(void 0!==t.value){if("constant"===t.expression.kind){const i=t.expression.evaluate(e,null,{},n,r);return this._calculate(i,i,i,e)}return this._calculate(t.expression.evaluate(new oo(Math.floor(e.zoom-1),e)),t.expression.evaluate(new oo(Math.floor(e.zoom),e)),t.expression.evaluate(new oo(Math.floor(e.zoom+1),e)),e)}}_calculate(t,e,n,r){return r.zoom>r.zoomHistory.lastIntegerZoom?{from:t,to:e}:{from:n,to:e}}interpolate(t){return t}}class vo{constructor(t){this.specification=t}possiblyEvaluate(t,e,n,r){return!!t.expression.evaluate(e,null,{},n,r)}interpolate(){return!1}}class bo{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];for(const e in t){const n=t[e];n.specification.overridable&&this.overridableProperties.push(e);const r=this.defaultPropertyValues[e]=new so(n,void 0),i=this.defaultTransitionablePropertyValues[e]=new ao(n);this.defaultTransitioningPropertyValues[e]=i.untransitioned(),this.defaultPossiblyEvaluatedValues[e]=r.possiblyEvaluate({})}}}function xo(t,e){return 256*(t=m(Math.floor(t),0,255))+m(Math.floor(e),0,255)}si(go,"DataDrivenProperty"),si(mo,"DataConstantProperty"),si(_o,"CrossFadedDataDrivenProperty"),si(yo,"CrossFadedProperty"),si(vo,"ColorRampProperty");const wo={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class To{constructor(t,e){this._structArray=t,this._pos1=e*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Co{constructor(){this.isTransferred=!1,this.capacity=-1,this.resize(0)}static serialize(t,e){return t._trim(),e&&(t.isTransferred=!0,e.push(t.arrayBuffer)),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const e=Object.create(this.prototype);return e.arrayBuffer=t.arrayBuffer,e.length=t.length,e.capacity=t.arrayBuffer.byteLength/e.bytesPerElement,e._refreshViews(),e}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const e=this.uint8;this._refreshViews(),e&&this.uint8.set(e)}}_refreshViews(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function Eo(t,e=1){let n=0,r=0;return{members:t.map(t=>{const i=wo[t.type].BYTES_PER_ELEMENT,o=n=So(n,Math.max(e,i)),s=t.components||1;return r=Math.max(r,i),n+=i*s,{name:t.name,type:t.type,components:s,offset:o}}),size:So(n,Math.max(r,e)),alignment:e}}function So(t,e){return Math.ceil(t/e)*e}class Io extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const r=2*t;return this.int16[r+0]=e,this.int16[r+1]=n,t}}Io.prototype.bytesPerElement=4,si(Io,"StructArrayLayout2i4");class ko extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)}emplace(t,e,n,r){const i=3*t;return this.int16[i+0]=e,this.int16[i+1]=n,this.int16[i+2]=r,t}}ko.prototype.bytesPerElement=6,si(ko,"StructArrayLayout3i6");class Ao extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)}emplace(t,e,n,r,i){const o=4*t;return this.int16[o+0]=e,this.int16[o+1]=n,this.int16[o+2]=r,this.int16[o+3]=i,t}}Ao.prototype.bytesPerElement=8,si(Ao,"StructArrayLayout4i8");class Mo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o,s)}emplace(t,e,n,r,i,o,s,a){const c=6*t,l=12*t,u=3*t;return this.int16[c+0]=e,this.int16[c+1]=n,this.uint8[l+4]=r,this.uint8[l+5]=i,this.uint8[l+6]=o,this.uint8[l+7]=s,this.float32[u+2]=a,t}}Mo.prototype.bytesPerElement=12,si(Mo,"StructArrayLayout2i4ub1f12");class Oo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)}emplace(t,e,n,r,i){const o=4*t;return this.float32[o+0]=e,this.float32[o+1]=n,this.float32[o+2]=r,this.float32[o+3]=i,t}}Oo.prototype.bytesPerElement=16,si(Oo,"StructArrayLayout4f16");class Po extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,s,a,c,l){const u=this.length;return this.resize(u+1),this.emplace(u,t,e,n,r,i,o,s,a,c,l)}emplace(t,e,n,r,i,o,s,a,c,l,u){const h=10*t;return this.uint16[h+0]=e,this.uint16[h+1]=n,this.uint16[h+2]=r,this.uint16[h+3]=i,this.uint16[h+4]=o,this.uint16[h+5]=s,this.uint16[h+6]=a,this.uint16[h+7]=c,this.uint16[h+8]=l,this.uint16[h+9]=u,t}}Po.prototype.bytesPerElement=20,si(Po,"StructArrayLayout10ui20");class Do extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,s,a){const c=this.length;return this.resize(c+1),this.emplace(c,t,e,n,r,i,o,s,a)}emplace(t,e,n,r,i,o,s,a,c){const l=8*t;return this.uint16[l+0]=e,this.uint16[l+1]=n,this.uint16[l+2]=r,this.uint16[l+3]=i,this.uint16[l+4]=o,this.uint16[l+5]=s,this.uint16[l+6]=a,this.uint16[l+7]=c,t}}Do.prototype.bytesPerElement=16,si(Do,"StructArrayLayout8ui16");class Ro extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o){const s=this.length;return this.resize(s+1),this.emplace(s,t,e,n,r,i,o)}emplace(t,e,n,r,i,o,s){const a=6*t;return this.int16[a+0]=e,this.int16[a+1]=n,this.int16[a+2]=r,this.int16[a+3]=i,this.int16[a+4]=o,this.int16[a+5]=s,t}}Ro.prototype.bytesPerElement=12,si(Ro,"StructArrayLayout6i12");class No extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m){const g=this.length;return this.resize(g+1),this.emplace(g,t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m)}emplace(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g){const _=16*t;return this.int16[_+0]=e,this.int16[_+1]=n,this.int16[_+2]=r,this.int16[_+3]=i,this.uint16[_+4]=o,this.uint16[_+5]=s,this.uint16[_+6]=a,this.uint16[_+7]=c,this.int16[_+8]=l,this.int16[_+9]=u,this.int16[_+10]=h,this.int16[_+11]=d,this.int16[_+12]=p,this.int16[_+13]=f,this.int16[_+14]=m,this.int16[_+15]=g,t}}No.prototype.bytesPerElement=32,si(No,"StructArrayLayout4i4ui4i4i32");class Lo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)}emplace(t,e,n,r){const i=3*t;return this.float32[i+0]=e,this.float32[i+1]=n,this.float32[i+2]=r,t}}Lo.prototype.bytesPerElement=12,si(Lo,"StructArrayLayout3f12");class jo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint32[1*t+0]=e,t}}jo.prototype.bytesPerElement=4,si(jo,"StructArrayLayout1ul4");class zo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,s,a,c,l,u,h,d){const p=this.length;return this.resize(p+1),this.emplace(p,t,e,n,r,i,o,s,a,c,l,u,h,d)}emplace(t,e,n,r,i,o,s,a,c,l,u,h,d,p){const f=20*t,m=10*t;return this.int16[f+0]=e,this.int16[f+1]=n,this.int16[f+2]=r,this.int16[f+3]=i,this.int16[f+4]=o,this.float32[m+3]=s,this.float32[m+4]=a,this.float32[m+5]=c,this.float32[m+6]=l,this.int16[f+14]=u,this.uint32[m+8]=h,this.uint16[f+18]=d,this.uint16[f+19]=p,t}}zo.prototype.bytesPerElement=40,si(zo,"StructArrayLayout5i4f1i1ul2ui40");class Fo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o,s)}emplace(t,e,n,r,i,o,s,a){const c=8*t;return this.int16[c+0]=e,this.int16[c+1]=n,this.int16[c+2]=r,this.int16[c+4]=i,this.int16[c+5]=o,this.int16[c+6]=s,this.int16[c+7]=a,t}}Fo.prototype.bytesPerElement=16,si(Fo,"StructArrayLayout3i2i2i16");class Bo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,r,i)}emplace(t,e,n,r,i,o){const s=4*t,a=8*t;return this.float32[s+0]=e,this.float32[s+1]=n,this.float32[s+2]=r,this.int16[a+6]=i,this.int16[a+7]=o,t}}Bo.prototype.bytesPerElement=16,si(Bo,"StructArrayLayout2f1f2i16");class Uo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)}emplace(t,e,n,r,i){const o=12*t,s=3*t;return this.uint8[o+0]=e,this.uint8[o+1]=n,this.float32[s+1]=r,this.float32[s+2]=i,t}}Uo.prototype.bytesPerElement=12,si(Uo,"StructArrayLayout2ub2f12");class Vo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n){const r=this.length;return this.resize(r+1),this.emplace(r,t,e,n)}emplace(t,e,n,r){const i=3*t;return this.uint16[i+0]=e,this.uint16[i+1]=n,this.uint16[i+2]=r,t}}Vo.prototype.bytesPerElement=6,si(Vo,"StructArrayLayout3ui6");class qo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g,_,y,v,b){const x=this.length;return this.resize(x+1),this.emplace(x,t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g,_,y,v,b)}emplace(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g,_,y,v,b,x){const w=30*t,T=15*t,C=60*t;return this.int16[w+0]=e,this.int16[w+1]=n,this.int16[w+2]=r,this.float32[T+2]=i,this.float32[T+3]=o,this.uint16[w+8]=s,this.uint16[w+9]=a,this.uint32[T+5]=c,this.uint32[T+6]=l,this.uint32[T+7]=u,this.uint16[w+16]=h,this.uint16[w+17]=d,this.uint16[w+18]=p,this.float32[T+10]=f,this.float32[T+11]=m,this.uint8[C+48]=g,this.uint8[C+49]=_,this.uint8[C+50]=y,this.uint32[T+13]=v,this.int16[w+28]=b,this.uint8[C+58]=x,t}}qo.prototype.bytesPerElement=60,si(qo,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Go extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g,_,y,v,b,x,w,T,C,E,S,I,k,A){const M=this.length;return this.resize(M+1),this.emplace(M,t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g,_,y,v,b,x,w,T,C,E,S,I,k,A)}emplace(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g,_,y,v,b,x,w,T,C,E,S,I,k,A,M){const O=38*t,P=19*t;return this.int16[O+0]=e,this.int16[O+1]=n,this.int16[O+2]=r,this.float32[P+2]=i,this.float32[P+3]=o,this.int16[O+8]=s,this.int16[O+9]=a,this.int16[O+10]=c,this.int16[O+11]=l,this.int16[O+12]=u,this.int16[O+13]=h,this.uint16[O+14]=d,this.uint16[O+15]=p,this.uint16[O+16]=f,this.uint16[O+17]=m,this.uint16[O+18]=g,this.uint16[O+19]=_,this.uint16[O+20]=y,this.uint16[O+21]=v,this.uint16[O+22]=b,this.uint16[O+23]=x,this.uint16[O+24]=w,this.uint16[O+25]=T,this.uint16[O+26]=C,this.uint16[O+27]=E,this.uint16[O+28]=S,this.uint32[P+15]=I,this.float32[P+16]=k,this.float32[P+17]=A,this.float32[P+18]=M,t}}Go.prototype.bytesPerElement=76,si(Go,"StructArrayLayout3i2f6i15ui1ul3f76");class $o extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.float32[1*t+0]=e,t}}$o.prototype.bytesPerElement=4,si($o,"StructArrayLayout1f4");class Wo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o,s)}emplace(t,e,n,r,i,o,s,a){const c=7*t;return this.float32[c+0]=e,this.float32[c+1]=n,this.float32[c+2]=r,this.float32[c+3]=i,this.float32[c+4]=o,this.float32[c+5]=s,this.float32[c+6]=a,t}}Wo.prototype.bytesPerElement=28,si(Wo,"StructArrayLayout7f28");class Ho extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i){const o=this.length;return this.resize(o+1),this.emplace(o,t,e,n,r,i)}emplace(t,e,n,r,i,o){const s=5*t;return this.float32[s+0]=e,this.float32[s+1]=n,this.float32[s+2]=r,this.float32[s+3]=i,this.float32[s+4]=o,t}}Ho.prototype.bytesPerElement=20,si(Ho,"StructArrayLayout5f20");class Zo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e,n,r){const i=this.length;return this.resize(i+1),this.emplace(i,t,e,n,r)}emplace(t,e,n,r,i){const o=6*t;return this.uint32[3*t+0]=e,this.uint16[o+2]=n,this.uint16[o+3]=r,this.uint16[o+4]=i,t}}Zo.prototype.bytesPerElement=12,si(Zo,"StructArrayLayout1ul3ui12");class Ko extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const r=2*t;return this.uint16[r+0]=e,this.uint16[r+1]=n,t}}Ko.prototype.bytesPerElement=4,si(Ko,"StructArrayLayout2ui4");class Xo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const e=this.length;return this.resize(e+1),this.emplace(e,t)}emplace(t,e){return this.uint16[1*t+0]=e,t}}Xo.prototype.bytesPerElement=2,si(Xo,"StructArrayLayout1ui2");class Yo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e){const n=this.length;return this.resize(n+1),this.emplace(n,t,e)}emplace(t,e,n){const r=2*t;return this.float32[r+0]=e,this.float32[r+1]=n,t}}Yo.prototype.bytesPerElement=8,si(Yo,"StructArrayLayout2f8");class Qo extends Co{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,e,n,r,i,o,s){const a=this.length;return this.resize(a+1),this.emplace(a,t,e,n,r,i,o,s)}emplace(t,e,n,r,i,o,s,a){const c=8*t,l=4*t;return this.int16[c+0]=e,this.int16[c+1]=n,this.int16[c+2]=r,this.int16[c+3]=i,this.int16[c+4]=o,this.int16[c+5]=s,this.float32[l+3]=a,t}}Qo.prototype.bytesPerElement=16,si(Qo,"StructArrayLayout6i1f16");class Jo extends To{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}}Jo.prototype.size=12;class ts extends Ro{get(t){return new Jo(this,t)}}si(ts,"FillExtrusionExtArray");class es extends To{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}es.prototype.size=40;class ns extends zo{get(t){return new es(this,t)}}si(ns,"CollisionBoxArray");class rs extends To{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}rs.prototype.size=60;class is extends qo{get(t){return new rs(this,t)}}si(is,"PlacedSymbolArray");class os extends To{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+11]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+13]}get key(){return this._structArray.uint16[this._pos2+14]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+15]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+17]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+19]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+21]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+22]}get featureIndex(){return this._structArray.uint16[this._pos2+23]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+25]}get numIconVertices(){return this._structArray.uint16[this._pos2+26]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+27]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+28]}get crossTileID(){return this._structArray.uint32[this._pos4+15]}set crossTileID(t){this._structArray.uint32[this._pos4+15]=t}get textOffset0(){return this._structArray.float32[this._pos4+16]}get textOffset1(){return this._structArray.float32[this._pos4+17]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+18]}}os.prototype.size=76;class ss extends Go{get(t){return new os(this,t)}}si(ss,"SymbolInstanceArray");class as extends $o{getoffsetX(t){return this.float32[1*t+0]}}si(as,"GlyphOffsetArray");class cs extends ko{getx(t){return this.int16[3*t+0]}gety(t){return this.int16[3*t+1]}gettileUnitDistanceFromAnchor(t){return this.int16[3*t+2]}}si(cs,"SymbolLineVertexArray");class ls extends To{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}ls.prototype.size=12;class us extends Zo{get(t){return new ls(this,t)}}si(us,"FeatureIndexArray");class hs extends To{get a_centroid_pos0(){return this._structArray.uint16[this._pos2+0]}get a_centroid_pos1(){return this._structArray.uint16[this._pos2+1]}}hs.prototype.size=4;class ds extends Ko{get(t){return new hs(this,t)}}si(ds,"FillExtrusionCentroidArray");class ps extends To{get a_pos_30(){return this._structArray.int16[this._pos2+0]}get a_pos_31(){return this._structArray.int16[this._pos2+1]}get a_pos_32(){return this._structArray.int16[this._pos2+2]}get a_pos_normal_30(){return this._structArray.int16[this._pos2+3]}get a_pos_normal_31(){return this._structArray.int16[this._pos2+4]}get a_pos_normal_32(){return this._structArray.int16[this._pos2+5]}get a_scale(){return this._structArray.float32[this._pos4+3]}}ps.prototype.size=16;class fs extends Qo{get(t){return new ps(this,t)}}si(fs,"CircleGlobeExtArray");const ms=Eo([{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"}]),gs=Eo([{name:"a_dash_to",components:4,type:"Uint16"},{name:"a_dash_from",components:4,type:"Uint16"}]);var _s=ce(function(t){t.exports=function(t,e){var n,r,i,o,s,a,c,l;for(r=t.length-(n=3&t.length),i=e,s=3432918353,a=461845907,l=0;l<r;)c=255&t.charCodeAt(l)|(255&t.charCodeAt(++l))<<8|(255&t.charCodeAt(++l))<<16|(255&t.charCodeAt(++l))<<24,++l,i=27492+(65535&(o=5*(65535&(i=(i^=c=(65535&(c=(c=(65535&c)*s+(((c>>>16)*s&65535)<<16)&4294967295)<<15|c>>>17))*a+(((c>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(o>>>16)&65535)<<16);switch(c=0,n){case 3:c^=(255&t.charCodeAt(l+2))<<16;case 2:c^=(255&t.charCodeAt(l+1))<<8;case 1:i^=c=(65535&(c=(c=(65535&(c^=255&t.charCodeAt(l)))*s+(((c>>>16)*s&65535)<<16)&4294967295)<<15|c>>>17))*a+(((c>>>16)*a&65535)<<16)&4294967295}return i^=t.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}}),ys=ce(function(t){t.exports=function(t,e){for(var n,r=t.length,i=e^r,o=0;r>=4;)n=1540483477*(65535&(n=255&t.charCodeAt(o)|(255&t.charCodeAt(++o))<<8|(255&t.charCodeAt(++o))<<16|(255&t.charCodeAt(++o))<<24))+((1540483477*(n>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(n=1540483477*(65535&(n^=n>>>24))+((1540483477*(n>>>16)&65535)<<16)),r-=4,++o;switch(r){case 3:i^=(255&t.charCodeAt(o+2))<<16;case 2:i^=(255&t.charCodeAt(o+1))<<8;case 1:i=1540483477*(65535&(i^=255&t.charCodeAt(o)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}}),vs=_s,bs=ys;vs.murmur3=_s,vs.murmur2=bs;class xs{constructor(){this.ids=[],this.positions=[],this.indexed=!1}add(t,e,n,r){this.ids.push(ws(t)),this.positions.push(e,n,r)}getPositions(t){const e=ws(t);let n=0,r=this.ids.length-1;for(;n<r;){const t=n+r>>1;this.ids[t]>=e?r=t:n=t+1}const i=[];for(;this.ids[n]===e;)i.push({index:this.positions[3*n],start:this.positions[3*n+1],end:this.positions[3*n+2]}),n++;return i}static serialize(t,e){const n=new Float64Array(t.ids),r=new Uint32Array(t.positions);return Ts(n,r,0,n.length-1),e&&e.push(n.buffer,r.buffer),{ids:n,positions:r}}static deserialize(t){const e=new xs;return e.ids=t.ids,e.positions=t.positions,e.indexed=!0,e}}function ws(t){const e=+t;return!isNaN(e)&&Number.MIN_SAFE_INTEGER<=e&&e<=Number.MAX_SAFE_INTEGER?e:vs(String(t))}function Ts(t,e,n,r){for(;n<r;){const i=t[n+r>>1];let o=n-1,s=r+1;for(;;){do{o++}while(t[o]<i);do{s--}while(t[s]>i);if(o>=s)break;Cs(t,o,s),Cs(e,3*o,3*s),Cs(e,3*o+1,3*s+1),Cs(e,3*o+2,3*s+2)}s-n<r-s?(Ts(t,e,n,s),n=s+1):(Ts(t,e,s+1,r),r=s)}}function Cs(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}si(xs,"FeaturePositionMap");class Es{constructor(t,e){this.gl=t.gl,this.location=e}}class Ss extends Es{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1f(this.location,t))}}class Is extends Es{constructor(t,e){super(t,e),this.current=[0,0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]&&t[3]===this.current[3]||(this.current=t,this.gl.uniform4f(this.location,t[0],t[1],t[2],t[3]))}}class ks extends Es{constructor(t,e){super(t,e),this.current=ue.transparent}set(t){t.r===this.current.r&&t.g===this.current.g&&t.b===this.current.b&&t.a===this.current.a||(this.current=t,this.gl.uniform4f(this.location,t.r,t.g,t.b,t.a))}}const As=new Float32Array(16),Ms=new Float32Array(9),Os=new Float32Array(4);function Ps(t){return[xo(255*t.r,255*t.g),xo(255*t.b,255*t.a)]}class Ds{constructor(t,e,n){this.value=t,this.uniformNames=e.map(t=>`u_${t}`),this.type=n}setUniform(t,e,n){t.set(n.constantOr(this.value))}getBinding(t,e,n){return"color"===this.type?new ks(t,e):new Ss(t,e)}}class Rs{constructor(t,e){this.uniformNames=e.map(t=>`u_${t}`),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1}setConstantPatternPositions(t,e){this.pixelRatioFrom=e.pixelRatio||1,this.pixelRatioTo=t.pixelRatio||1,this.patternFrom=e.tl.concat(e.br),this.patternTo=t.tl.concat(t.br)}setUniform(t,e,n,r){const i="u_pattern_to"===r||"u_dash_to"===r?this.patternTo:"u_pattern_from"===r||"u_dash_from"===r?this.patternFrom:"u_pixel_ratio_to"===r?this.pixelRatioTo:"u_pixel_ratio_from"===r?this.pixelRatioFrom:null;i&&t.set(i)}getBinding(t,e,n){return"u_pattern_from"===n||"u_pattern_to"===n||"u_dash_from"===n||"u_dash_to"===n?new Is(t,e):new Ss(t,e)}}class Ns{constructor(t,e,n,r){this.expression=t,this.type=n,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:`a_${t}`,type:"Float32",components:"color"===n?2:1,offset:0})),this.paintVertexArray=new r}populatePaintArray(t,e,n,r,i,o){const s=this.paintVertexArray.length,a=this.expression.evaluate(new oo(0),e,{},i,r,o);this.paintVertexArray.resize(t),this._setPaintValue(s,t,a)}updatePaintArray(t,e,n,r,i){const o=this.expression.evaluate({zoom:0},n,r,void 0,i);this._setPaintValue(t,e,o)}_setPaintValue(t,e,n){if("color"===this.type){const r=Ps(n);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,r[0],r[1])}else{for(let r=t;r<e;r++)this.paintVertexArray.emplace(r,n);this.maxValue=Math.max(this.maxValue,Math.abs(n))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Ls{constructor(t,e,n,r,i,o){this.expression=t,this.uniformNames=e.map(t=>`u_${t}_t`),this.type=n,this.useIntegerZoom=r,this.zoom=i,this.maxValue=0,this.paintVertexAttributes=e.map(t=>({name:`a_${t}`,type:"Float32",components:"color"===n?4:2,offset:0})),this.paintVertexArray=new o}populatePaintArray(t,e,n,r,i,o){const s=this.expression.evaluate(new oo(this.zoom),e,{},i,r,o),a=this.expression.evaluate(new oo(this.zoom+1),e,{},i,r,o),c=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(c,t,s,a)}updatePaintArray(t,e,n,r,i){const o=this.expression.evaluate({zoom:this.zoom},n,r,void 0,i),s=this.expression.evaluate({zoom:this.zoom+1},n,r,void 0,i);this._setPaintValue(t,e,o,s)}_setPaintValue(t,e,n,r){if("color"===this.type){const i=Ps(n),o=Ps(r);for(let n=t;n<e;n++)this.paintVertexArray.emplace(n,i[0],i[1],o[0],o[1])}else{for(let i=t;i<e;i++)this.paintVertexArray.emplace(i,n,r);this.maxValue=Math.max(this.maxValue,Math.abs(n),Math.abs(r))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,e){const n=this.useIntegerZoom?Math.floor(e.zoom):e.zoom,r=m(this.expression.interpolationFactor(n,this.zoom,this.zoom+1),0,1);t.set(r)}getBinding(t,e,n){return new Ss(t,e)}}class js{constructor(t,e,n,r,i,o,s){this.expression=t,this.type=n,this.useIntegerZoom=r,this.zoom=i,this.layerId=s,this.paintVertexAttributes=("array"===n?gs:ms).members;for(let a=0;a<e.length;++a);this.zoomInPaintVertexArray=new o,this.zoomOutPaintVertexArray=new o}populatePaintArray(t,e,n){const r=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(t),this.zoomOutPaintVertexArray.resize(t),this._setPaintValues(r,t,e.patterns&&e.patterns[this.layerId],n)}updatePaintArray(t,e,n,r,i,o){this._setPaintValues(t,e,n.patterns&&n.patterns[this.layerId],o)}_setPaintValues(t,e,n,r){if(!r||!n)return;const{min:i,mid:o,max:s}=n,a=r[i],c=r[o],l=r[s];if(a&&c&&l)for(let u=t;u<e;u++)this._setPaintValue(this.zoomInPaintVertexArray,u,c,a),this._setPaintValue(this.zoomOutPaintVertexArray,u,c,l)}_setPaintValue(t,e,n,r){t.emplace(e,n.tl[0],n.tl[1],n.br[0],n.br[1],r.tl[0],r.tl[1],r.br[0],r.br[1],n.pixelRatio,r.pixelRatio)}upload(t){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=t.createVertexBuffer(this.zoomInPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=t.createVertexBuffer(this.zoomOutPaintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))}destroy(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()}}class zs{constructor(t,e,n=(()=>!0)){this.binders={},this._buffers=[];const r=[];for(const i in t.paint._values){if(!n(i))continue;const o=t.paint.get(i);if(!(o instanceof po&&Xn(o.property.specification)))continue;const s=Us(i,t.type),a=o.value,c=o.property.specification.type,l=o.property.useIntegerZoom,u=o.property.specification["property-type"],h="cross-faded"===u||"cross-faded-data-driven"===u,d="line-dasharray"===String(i)&&"constant"!==t.layout.get("line-cap").value.kind;if("constant"!==a.kind||d)if("source"===a.kind||d||h){const n=Gs(i,c,"source");this.binders[i]=h?new js(a,s,c,l,e,n,t.id):new Ns(a,s,c,n),r.push(`/a_${i}`)}else{const t=Gs(i,c,"composite");this.binders[i]=new Ls(a,s,c,l,e,t),r.push(`/z_${i}`)}else this.binders[i]=h?new Rs(a.value,s):new Ds(a.value,s,c),r.push(`/u_${i}`)}this.cacheKey=r.sort().join("")}getMaxValue(t){const e=this.binders[t];return e instanceof Ns||e instanceof Ls?e.maxValue:0}populatePaintArrays(t,e,n,r,i,o){for(const s in this.binders){const a=this.binders[s];(a instanceof Ns||a instanceof Ls||a instanceof js)&&a.populatePaintArray(t,e,n,r,i,o)}}setConstantPatternPositions(t,e){for(const n in this.binders){const r=this.binders[n];r instanceof Rs&&r.setConstantPatternPositions(t,e)}}updatePaintArrays(t,e,n,r,i,o){let s=!1;for(const a in t){const c=e.getPositions(a);for(const e of c){const c=n.feature(e.index);for(const n in this.binders){const l=this.binders[n];if((l instanceof Ns||l instanceof Ls||l instanceof js)&&!0===l.expression.isStateDependent){const u=r.paint.get(n);l.expression=u.value,l.updatePaintArray(e.start,e.end,c,t[a],i,o),s=!0}}}}return s}defines(){const t=[];for(const e in this.binders){const n=this.binders[e];(n instanceof Ds||n instanceof Rs)&&t.push(...n.uniformNames.map(t=>`#define HAS_UNIFORM_${t}`))}return t}getBinderAttributes(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof Ns||n instanceof Ls||n instanceof js)for(let e=0;e<n.paintVertexAttributes.length;e++)t.push(n.paintVertexAttributes[e].name)}return t}getBinderUniforms(){const t=[];for(const e in this.binders){const n=this.binders[e];if(n instanceof Ds||n instanceof Rs||n instanceof Ls)for(const e of n.uniformNames)t.push(e)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t,e){const n=[];for(const r in this.binders){const i=this.binders[r];if(i instanceof Ds||i instanceof Rs||i instanceof Ls)for(const o of i.uniformNames)if(e[o]){const s=i.getBinding(t,e[o],o);n.push({name:o,property:r,binding:s})}}return n}setUniforms(t,e,n,r){for(const{name:i,property:o,binding:s}of e)this.binders[o].setUniform(s,r,n.get(o),i)}updatePaintBuffers(t){this._buffers=[];for(const e in this.binders){const n=this.binders[e];if(t&&n instanceof js){const e=2===t.fromScale?n.zoomInPaintVertexBuffer:n.zoomOutPaintVertexBuffer;e&&this._buffers.push(e)}else(n instanceof Ns||n instanceof Ls)&&n.paintVertexBuffer&&this._buffers.push(n.paintVertexBuffer)}}upload(t){for(const e in this.binders){const n=this.binders[e];(n instanceof Ns||n instanceof Ls||n instanceof js)&&n.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const e=this.binders[t];(e instanceof Ns||e instanceof Ls||e instanceof js)&&e.destroy()}}}class Fs{constructor(t,e,n=(()=>!0)){this.programConfigurations={};for(const r of t)this.programConfigurations[r.id]=new zs(r,e,n);this.needsUpload=!1,this._featureMap=new xs,this._bufferOffset=0}populatePaintArrays(t,e,n,r,i,o,s){for(const a in this.programConfigurations)this.programConfigurations[a].populatePaintArrays(t,e,r,i,o,s);void 0!==e.id&&this._featureMap.add(e.id,n,this._bufferOffset,t),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,e,n,r,i){for(const o of n)this.needsUpload=this.programConfigurations[o.id].updatePaintArrays(t,this._featureMap,e,o,r,i)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const e in this.programConfigurations)this.programConfigurations[e].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const Bs={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"line-dasharray":["dash_to","dash_from"]};function Us(t,e){return Bs[t]||[t.replace(`${e}-`,"").replace(/-/g,"_")]}const Vs={"line-pattern":{source:Po,composite:Po},"fill-pattern":{source:Po,composite:Po},"fill-extrusion-pattern":{source:Po,composite:Po},"line-dasharray":{source:Do,composite:Do}},qs={color:{source:Yo,composite:Oo},number:{source:$o,composite:Yo}};function Gs(t,e,n){const r=Vs[t];return r&&r[n]||qs[e][n]}si(Ds,"ConstantBinder"),si(Rs,"CrossFadedConstantBinder"),si(Ns,"SourceExpressionBinder"),si(js,"CrossFadedCompositeBinder"),si(Ls,"CompositeExpressionBinder"),si(zs,"ProgramConfiguration",{omit:["_buffers"]}),si(Fs,"ProgramConfigurationSet");const $s="-transition";class Ws extends Ft{constructor(t,e){if(super(),this.id=t.id,this.type=t.type,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,"custom"!==t.type&&(this.metadata=(t=t).metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,"background"!==t.type&&"sky"!==t.type&&(this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter),e.layout&&(this._unevaluatedLayout=new ho(e.layout)),e.paint)){this._transitionablePaint=new co(e.paint);for(const e in t.paint)this.setPaintProperty(e,t.paint[e],{validate:!1});for(const e in t.layout)this.setLayoutProperty(e,t.layout[e],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new fo(e.paint)}}getCrossfadeParameters(){return this._crossfadeParameters}getLayoutProperty(t){return"visibility"===t?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,e,n={}){null!=e&&this._validate(ti,`layers.${this.id}.layout.${t}`,t,e,n)||("visibility"!==t?this._unevaluatedLayout.setValue(t,e):this.visibility=e)}getPaintProperty(t){return I(t,$s)?this._transitionablePaint.getTransition(t.slice(0,-$s.length)):this._transitionablePaint.getValue(t)}setPaintProperty(t,e,n={}){if(null!=e&&this._validate(Jr,`layers.${this.id}.paint.${t}`,t,e,n))return!1;if(I(t,$s))return this._transitionablePaint.setTransition(t.slice(0,-$s.length),e||void 0),!1;{const n=this._transitionablePaint._values[t],r="cross-faded-data-driven"===n.property.specification["property-type"],i=n.value.isDataDriven(),o=n.value;this._transitionablePaint.setValue(t,e),this._handleSpecialPaintPropertyUpdate(t);const s=this._transitionablePaint._values[t].value;return s.isDataDriven()||i||r||this._handleOverridablePaintPropertyUpdate(t,o,s)}}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getProgramConfiguration(t){return null}_handleOverridablePaintPropertyUpdate(t,e,n){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||"none"===this.visibility}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,e){t.getCrossfadeParameters&&(this._crossfadeParameters=t.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,e)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,e)}serialize(){const t={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(t.layout=t.layout||{},t.layout.visibility=this.visibility),A(t,(t,e)=>!(void 0===t||"layout"===e&&!Object.keys(t).length||"paint"===e&&!Object.keys(t).length))}_validate(t,e,n,r,i={}){return(!i||!1!==i.validate)&&ni(this,t.call(Qr,{key:e,layerType:this.type,objectKey:n,value:r,styleSpec:Bt,style:{glyphs:!0,sprite:!0}}))}is3D(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}resize(){}isStateDependent(){for(const t in this.paint._values){const e=this.paint.get(t);if(e instanceof po&&Xn(e.property.specification)&&("source"===e.value.kind||"composite"===e.value.kind)&&e.value.isStateDependent)return!0}return!1}compileFilter(){this._filterCompiled||(this._featureFilter=Er(this.filter),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}}const Hs=Eo([{name:"a_pos",components:2,type:"Int16"}],4),Zs=Eo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"},{name:"a_scale",components:1,type:"Float32"}]);class Ks{constructor(t=[]){this.segments=t}prepareSegment(t,e,n,r){let i=this.segments[this.segments.length-1];return t>Ks.MAX_VERTEX_ARRAY_LENGTH&&P(`Max vertices per segment is ${Ks.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!i||i.vertexLength+t>Ks.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==r)&&(i={vertexOffset:e.length,primitiveOffset:n.length,vertexLength:0,primitiveLength:0},void 0!==r&&(i.sortKey=r),this.segments.push(i)),i}get(){return this.segments}destroy(){for(const t of this.segments)for(const e in t.vaos)t.vaos[e].destroy()}static simpleSegment(t,e,n,r){return new Ks([{vertexOffset:t,primitiveOffset:e,vertexLength:n,primitiveLength:r,vaos:{},sortKey:0}])}}Ks.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,si(Ks,"SegmentVector");var Xs=8192;class Ys{constructor(t,e){t&&(e?this.setSouthWest(t).setNorthEast(e):4===t.length?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof Js?new Js(t.lng,t.lat):Js.convert(t),this}setSouthWest(t){return this._sw=t instanceof Js?new Js(t.lng,t.lat):Js.convert(t),this}extend(t){const e=this._sw,n=this._ne;let r,i;if(t instanceof Js)r=t,i=t;else{if(!(t instanceof Ys))return Array.isArray(t)?4===t.length||t.every(Array.isArray)?this.extend(Ys.convert(t)):this.extend(Js.convert(t)):this;if(r=t._sw,i=t._ne,!r||!i)return this}return e||n?(e.lng=Math.min(r.lng,e.lng),e.lat=Math.min(r.lat,e.lat),n.lng=Math.max(i.lng,n.lng),n.lat=Math.max(i.lat,n.lat)):(this._sw=new Js(r.lng,r.lat),this._ne=new Js(i.lng,i.lat)),this}getCenter(){return new Js((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new Js(this.getWest(),this.getNorth())}getSouthEast(){return new Js(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:e,lat:n}=Js.convert(t);let r=this._sw.lng<=e&&e<=this._ne.lng;return this._sw.lng>this._ne.lng&&(r=this._sw.lng>=e&&e>=this._ne.lng),this._sw.lat<=n&&n<=this._ne.lat&&r}static convert(t){return!t||t instanceof Ys?t:new Ys(t)}}const Qs=6371008.8;class Js{constructor(t,e){if(isNaN(t)||isNaN(e))throw new Error(`Invalid LngLat object: (${t}, ${e})`);if(this.lng=+t,this.lat=+e,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new Js(_(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const e=Math.PI/180,n=this.lat*e,r=t.lat*e,i=Math.sin(n)*Math.sin(r)+Math.cos(n)*Math.cos(r)*Math.cos((t.lng-this.lng)*e);return Qs*Math.acos(Math.min(i,1))}toBounds(t=0){const e=360*t/40075017,n=e/Math.cos(Math.PI/180*this.lat);return new Ys(new Js(this.lng-n,this.lat-e),new Js(this.lng+n,this.lat+e))}static convert(t){if(t instanceof Js)return t;if(Array.isArray(t)&&(2===t.length||3===t.length))return new Js(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&"object"==typeof t&&null!==t)return new Js(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}const ta=2*Math.PI*Qs;function ea(t){return ta*Math.cos(t*Math.PI/180)}function na(t){return(180+t)/360}function ra(t){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360}function ia(t,e){return t/ea(e)}function oa(t){return 360*t-180}function sa(t){return 360/Math.PI*Math.atan(Math.exp((180-360*t)*Math.PI/180))-90}function aa(t,e){return t*ea(sa(e))}const ca=85.051129;class la{constructor(t,e,n=0){this.x=+t,this.y=+e,this.z=+n}static fromLngLat(t,e=0){const n=Js.convert(t);return new la(na(n.lng),ra(n.lat),ia(e,n.lat))}toLngLat(){return new Js(oa(this.x),sa(this.y))}toAltitude(){return aa(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/ta*(t=sa(this.y),1/Math.cos(t*Math.PI/180));var t}}function ua(t,e,n,r,o,s,a,c,l){const u=(e+r)/2,h=(n+o)/2,d=new i(u,h);c(d),function(t,e,n,r,i,o){const s=n-i,a=r-o;return Math.abs((r-e)*s-(n-t)*a)/Math.hypot(s,a)}(d.x,d.y,s.x,s.y,a.x,a.y)>=l?(ua(t,e,n,u,h,s,d,c,l),ua(t,u,h,r,o,d,a,c,l)):t.push(a)}function ha(t,e,n){let r=t[0],i=r.x,o=r.y;e(r);const s=[r];for(let a=1;a<t.length;a++){const c=t[a],{x:l,y:u}=c;e(c),ua(s,i,o,l,u,r,c,e,n),i=l,o=u,r=c}return s}const da=Math.pow(2,14)-1,pa=-da-1;function fa(t,e){const n=Math.round(t.x*e),r=Math.round(t.y*e);return t.x=m(n,pa,da),t.y=m(r,pa,da),(n<t.x||n>t.x+1||r<t.y||r>t.y+1)&&P("Geometry exceeds allowed extent, reduce your vector tile buffer size"),t}function ma(t,e,n){const r=t.loadGeometry(),i=t.extent,o=Xs/i;if(e&&n&&n.projection.isReprojectedInTileSpace){const o=1<<e.z,{scale:s,x:a,y:c,projection:l}=n,u=t=>{const n=oa((e.x+t.x/i)/o),r=sa((e.y+t.y/i)/o),u=l.project(n,r);t.x=(u.x*s-a)*i,t.y=(u.y*s-c)*i};for(let e=0;e<r.length;e++)if(1!==t.type)r[e]=ha(r[e],u,1);else{const t=[];for(const n of r[e])n.x<0||n.x>=i||n.y<0||n.y>=i||(u(n),t.push(n));r[e]=t}}for(const s of r)for(const t of s)fa(t,o);return r}function ga(t,e){return{type:t.type,id:t.id,properties:t.properties,geometry:e?ma(t):[]}}function _a(t,e,n,r,i){t.emplaceBack(2*e+(r+1)/2,2*n+(i+1)/2)}function ya(t,e,n,r){const i=16384;t.emplaceBack(e.x,e.y,e.z,n[0]*i,n[1]*i,n[2]*i,r)}class va{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Io,this.indexArray=new Vo,this.segments=new Ks,this.programConfigurations=new Fs(t.layers,t.zoom),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n,r){const i=this.layers[0],o=[];let s=null;"circle"===i.type&&(s=i.layout.get("circle-sort-key"));for(const{feature:c,id:l,index:u,sourceLayerIndex:h}of t){const t=this.layers[0]._featureFilter.needGeometry,e=ga(c,t);if(!this.layers[0]._featureFilter.filter(new oo(this.zoom),e,n))continue;const i=s?s.evaluate(e,{},n):void 0,a={id:l,properties:c.properties,type:c.type,sourceLayerIndex:h,index:u,geometry:t?e.geometry:ma(c,n,r),patterns:{},sortKey:i};o.push(a)}s&&o.sort((t,e)=>t.sortKey-e.sortKey);let a=null;"globe"===r.projection.name&&(this.globeExtVertexArray=new fs,a=r.projection);for(const c of o){const{geometry:r,index:i,sourceLayerIndex:o}=c,s=t[i].feature;this.addFeature(c,r,i,e.availableImages,n,a),e.featureIndex.insert(s,r,i,o,this.index)}}update(t,e,n,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Hs.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,Zs.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy())}addFeature(t,e,n,r,i,o){for(const s of e)for(const e of s){const n=e.x,r=e.y;if(n<0||n>=Xs||r<0||r>=Xs)continue;if(o){const t=o.projectTilePoint(n,r,i),e=o.upVector(i,n,r),s=sa((r/Xs+i.y)/(1<<i.z)),a=o.pixelsPerMeter(s,1)/ia(1,s),c=this.globeExtVertexArray;ya(c,t,e,a),ya(c,t,e,a),ya(c,t,e,a),ya(c,t,e,a)}const s=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),a=s.vertexLength;_a(this.layoutVertexArray,n,r,-1,-1),_a(this.layoutVertexArray,n,r,1,-1),_a(this.layoutVertexArray,n,r,1,1),_a(this.layoutVertexArray,n,r,-1,1),this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+3,a+2),s.vertexLength+=4,s.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,{},r,i)}}function ba(t,e){for(let n=0;n<t.length;n++)if(Aa(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Aa(t,e[n]))return!0;return!!Ca(t,e)}function xa(t,e,n){return!!Aa(t,e)||!!Sa(e,t,n)}function wa(t,e){if(1===t.length)return ka(e,t[0]);for(let n=0;n<e.length;n++){const r=e[n];for(let e=0;e<r.length;e++)if(Aa(t,r[e]))return!0}for(let n=0;n<t.length;n++)if(ka(e,t[n]))return!0;for(let n=0;n<e.length;n++)if(Ca(t,e[n]))return!0;return!1}function Ta(t,e,n){if(t.length>1){if(Ca(t,e))return!0;for(let r=0;r<e.length;r++)if(Sa(e[r],t,n))return!0}for(let r=0;r<t.length;r++)if(Sa(t[r],e,n))return!0;return!1}function Ca(t,e){if(0===t.length||0===e.length)return!1;for(let n=0;n<t.length-1;n++){const r=t[n],i=t[n+1];for(let t=0;t<e.length-1;t++)if(Ea(r,i,e[t],e[t+1]))return!0}return!1}function Ea(t,e,n,r){return D(t,n,r)!==D(e,n,r)&&D(t,e,n)!==D(t,e,r)}function Sa(t,e,n){const r=n*n;if(1===e.length)return t.distSqr(e[0])<r;for(let i=1;i<e.length;i++)if(Ia(t,e[i-1],e[i])<r)return!0;return!1}function Ia(t,e,n){const r=e.distSqr(n);if(0===r)return t.distSqr(e);const i=((t.x-e.x)*(n.x-e.x)+(t.y-e.y)*(n.y-e.y))/r;return t.distSqr(i<0?e:i>1?n:n.sub(e)._mult(i)._add(e))}function ka(t,e){let n,r,i,o=!1;for(let s=0;s<t.length;s++){n=t[s];for(let t=0,s=n.length-1;t<n.length;s=t++)r=n[t],i=n[s],r.y>e.y!=i.y>e.y&&e.x<(i.x-r.x)*(e.y-r.y)/(i.y-r.y)+r.x&&(o=!o)}return o}function Aa(t,e){let n=!1;for(let r=0,i=t.length-1;r<t.length;i=r++){const o=t[r],s=t[i];o.y>e.y!=s.y>e.y&&e.x<(s.x-o.x)*(e.y-o.y)/(s.y-o.y)+o.x&&(n=!n)}return n}function Ma(t,e,n,r,o){for(const i of t)if(e<=i.x&&n<=i.y&&r>=i.x&&o>=i.y)return!0;const s=[new i(e,n),new i(e,o),new i(r,o),new i(r,n)];if(t.length>2)for(const i of s)if(Aa(t,i))return!0;for(let i=0;i<t.length-1;i++)if(Oa(t[i],t[i+1],s))return!0;return!1}function Oa(t,e,n){const r=n[0],i=n[2];if(t.x<r.x&&e.x<r.x||t.x>i.x&&e.x>i.x||t.y<r.y&&e.y<r.y||t.y>i.y&&e.y>i.y)return!1;const o=D(t,e,n[0]);return o!==D(t,e,n[1])||o!==D(t,e,n[2])||o!==D(t,e,n[3])}function Pa(t,e,n){const r=e.paint.get(t).value;return"constant"===r.kind?r.value:n.programConfigurations.get(e.id).getMaxValue(t)}function Da(t){return Math.sqrt(t[0]*t[0]+t[1]*t[1])}function Ra(t,e,n,r,o){if(!e[0]&&!e[1])return t;const s=i.convert(e)._mult(o);"viewport"===n&&s._rotate(-r);const a=[];for(let i=0;i<t.length;i++)a.push(t[i].sub(s));return a}function Na(t,e,n,r){const o=i.convert(t)._mult(r);return"viewport"===e&&o._rotate(-n),o}si(va,"CircleBucket",{omit:["layers"]});const La=new bo({"circle-sort-key":new go(Bt.layout_circle["circle-sort-key"])});var ja={paint:new bo({"circle-radius":new go(Bt.paint_circle["circle-radius"]),"circle-color":new go(Bt.paint_circle["circle-color"]),"circle-blur":new go(Bt.paint_circle["circle-blur"]),"circle-opacity":new go(Bt.paint_circle["circle-opacity"]),"circle-translate":new mo(Bt.paint_circle["circle-translate"]),"circle-translate-anchor":new mo(Bt.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new mo(Bt.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new mo(Bt.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new go(Bt.paint_circle["circle-stroke-width"]),"circle-stroke-color":new go(Bt.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new go(Bt.paint_circle["circle-stroke-opacity"])}),layout:La},za=1e-6,Fa="undefined"!=typeof Float32Array?Float32Array:Array;function Ba(){var t=new Fa(9);return Fa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[5]=0,t[6]=0,t[7]=0),t[0]=1,t[4]=1,t[8]=1,t}function Ua(t){return t[0]=1,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=1,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=1,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t}function Va(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],m=e[12],g=e[13],_=e[14],y=e[15],v=n[0],b=n[1],x=n[2],w=n[3];return t[0]=v*r+b*a+x*h+w*m,t[1]=v*i+b*c+x*d+w*g,t[2]=v*o+b*l+x*p+w*_,t[3]=v*s+b*u+x*f+w*y,t[4]=(v=n[4])*r+(b=n[5])*a+(x=n[6])*h+(w=n[7])*m,t[5]=v*i+b*c+x*d+w*g,t[6]=v*o+b*l+x*p+w*_,t[7]=v*s+b*u+x*f+w*y,t[8]=(v=n[8])*r+(b=n[9])*a+(x=n[10])*h+(w=n[11])*m,t[9]=v*i+b*c+x*d+w*g,t[10]=v*o+b*l+x*p+w*_,t[11]=v*s+b*u+x*f+w*y,t[12]=(v=n[12])*r+(b=n[13])*a+(x=n[14])*h+(w=n[15])*m,t[13]=v*i+b*c+x*d+w*g,t[14]=v*o+b*l+x*p+w*_,t[15]=v*s+b*u+x*f+w*y,t}function qa(t,e,n){var r,i,o,s,a,c,l,u,h,d,p,f,m=n[0],g=n[1],_=n[2];return e===t?(t[12]=e[0]*m+e[4]*g+e[8]*_+e[12],t[13]=e[1]*m+e[5]*g+e[9]*_+e[13],t[14]=e[2]*m+e[6]*g+e[10]*_+e[14],t[15]=e[3]*m+e[7]*g+e[11]*_+e[15]):(i=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=e[9],p=e[10],f=e[11],t[0]=r=e[0],t[1]=i,t[2]=o,t[3]=s,t[4]=a,t[5]=c,t[6]=l,t[7]=u,t[8]=h,t[9]=d,t[10]=p,t[11]=f,t[12]=r*m+a*g+h*_+e[12],t[13]=i*m+c*g+d*_+e[13],t[14]=o*m+l*g+p*_+e[14],t[15]=s*m+u*g+f*_+e[15]),t}function Ga(t,e,n){var r=n[0],i=n[1],o=n[2];return t[0]=e[0]*r,t[1]=e[1]*r,t[2]=e[2]*r,t[3]=e[3]*r,t[4]=e[4]*i,t[5]=e[5]*i,t[6]=e[6]*i,t[7]=e[7]*i,t[8]=e[8]*o,t[9]=e[9]*o,t[10]=e[10]*o,t[11]=e[11]*o,t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function $a(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[4],s=e[5],a=e[6],c=e[7],l=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[4]=o*i+l*r,t[5]=s*i+u*r,t[6]=a*i+h*r,t[7]=c*i+d*r,t[8]=l*i-o*r,t[9]=u*i-s*r,t[10]=h*i-a*r,t[11]=d*i-c*r,t}function Wa(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],c=e[3],l=e[8],u=e[9],h=e[10],d=e[11];return e!==t&&(t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i-l*r,t[1]=s*i-u*r,t[2]=a*i-h*r,t[3]=c*i-d*r,t[8]=o*r+l*i,t[9]=s*r+u*i,t[10]=a*r+h*i,t[11]=c*r+d*i,t}Math.hypot||(Math.hypot=function(){for(var t=0,e=arguments.length;e--;)t+=arguments[e]*arguments[e];return Math.sqrt(t)});var Ha=Va;function Za(){var t=new Fa(3);return Fa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t}function Ka(t){var e=new Fa(3);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e}function Xa(t){return Math.hypot(t[0],t[1],t[2])}function Ya(t,e,n){var r=new Fa(3);return r[0]=t,r[1]=e,r[2]=n,r}function Qa(t,e,n){return t[0]=e[0]+n[0],t[1]=e[1]+n[1],t[2]=e[2]+n[2],t}function Ja(t,e,n){return t[0]=e[0]-n[0],t[1]=e[1]-n[1],t[2]=e[2]-n[2],t}function tc(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t}function ec(t,e,n){return t[0]=Math.min(e[0],n[0]),t[1]=Math.min(e[1],n[1]),t[2]=Math.min(e[2],n[2]),t}function nc(t,e,n){return t[0]=Math.max(e[0],n[0]),t[1]=Math.max(e[1],n[1]),t[2]=Math.max(e[2],n[2]),t}function rc(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t}function ic(t,e,n,r){return t[0]=e[0]+n[0]*r,t[1]=e[1]+n[1]*r,t[2]=e[2]+n[2]*r,t}function oc(t,e){var n=e[0],r=e[1],i=e[2],o=n*n+r*r+i*i;return o>0&&(o=1/Math.sqrt(o)),t[0]=e[0]*o,t[1]=e[1]*o,t[2]=e[2]*o,t}function sc(t,e){return t[0]*e[0]+t[1]*e[1]+t[2]*e[2]}function ac(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[0],a=n[1],c=n[2];return t[0]=i*c-o*a,t[1]=o*s-r*c,t[2]=r*a-i*s,t}function cc(t,e,n){var r=e[0],i=e[1],o=e[2],s=n[3]*r+n[7]*i+n[11]*o+n[15];return t[0]=(n[0]*r+n[4]*i+n[8]*o+n[12])/(s=s||1),t[1]=(n[1]*r+n[5]*i+n[9]*o+n[13])/s,t[2]=(n[2]*r+n[6]*i+n[10]*o+n[14])/s,t}function lc(t,e,n){var r=n[0],i=n[1],o=n[2],s=e[0],a=e[1],c=e[2],l=i*c-o*a,u=o*s-r*c,h=r*a-i*s,d=i*h-o*u,p=o*l-r*h,f=r*u-i*l,m=2*n[3];return u*=m,h*=m,p*=2,f*=2,t[0]=s+(l*=m)+(d*=2),t[1]=a+u+p,t[2]=c+h+f,t}var uc,hc=Ja,dc=tc,pc=Xa;function fc(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3];return t[0]=n[0]*r+n[4]*i+n[8]*o+n[12]*s,t[1]=n[1]*r+n[5]*i+n[9]*o+n[13]*s,t[2]=n[2]*r+n[6]*i+n[10]*o+n[14]*s,t[3]=n[3]*r+n[7]*i+n[11]*o+n[15]*s,t}function mc(){var t=new Fa(4);return Fa!=Float32Array&&(t[0]=0,t[1]=0,t[2]=0),t[3]=1,t}function gc(t){return t[0]=0,t[1]=0,t[2]=0,t[3]=1,t}function _c(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c+s*a,t[1]=i*c+o*a,t[2]=o*c-i*a,t[3]=s*c-r*a,t}Za(),uc=new Fa(4),Fa!=Float32Array&&(uc[0]=0,uc[1]=0,uc[2]=0,uc[3]=0),Za(),Ya(1,0,0),Ya(0,1,0),mc(),mc(),Ba();class yc{constructor(t,e){this.points=t,this.planes=e}static fromInvProjectionMatrix(t,e,n,r){const i=Math.pow(2,n),o=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(n=>{const o=fc([],n,t),s=1/o[3]/e*i;return function(t,e,n){return t[0]=e[0]*n[0],t[1]=e[1]*n[1],t[2]=e[2]*n[2],t[3]=e[3]*n[3],t}(o,o,[s,s,r?1/o[3]:s,s])}),s=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(t=>{const e=oc([],ac([],hc([],o[t[0]],o[t[1]]),hc([],o[t[2]],o[t[1]]))),n=-sc(e,o[t[1]]);return e.concat(n)});return new yc(o,s)}}class vc{constructor(t,e){this.min=t,this.max=e,this.center=rc([],Qa([],this.min,this.max),.5)}quadrant(t){const e=[t%2==0,t<2],n=Ka(this.min),r=Ka(this.max);for(let i=0;i<e.length;i++)n[i]=e[i]?this.min[i]:this.center[i],r[i]=e[i]?this.center[i]:this.max[i];return r[2]=this.max[2],new vc(n,r)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,e=this.max;return[[t[0],t[1],t[2]],[e[0],t[1],t[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],e[2]],[t[0],e[1],e[2]]]}intersects(t){const e=this.getCorners();let n=!0;for(let r=0;r<t.planes.length;r++){const i=t.planes[r];let o=0;for(let t=0;t<e.length;t++)o+=sc(i,e[t])+i[3]>=0;if(0===o)return 0;o!==e.length&&(n=!1)}if(n)return 2;for(let r=0;r<3;r++){let e=Number.MAX_VALUE,n=-Number.MAX_VALUE;for(let i=0;i<t.points.length;i++){const o=t.points[i][r]-this.min[r];e=Math.min(e,o),n=Math.max(n,o)}if(n<0||e>this.max[r]-this.min[r])return 0}return 1}}function bc(t,e,n,r,i,o,s,a,c){if(o&&t.queryGeometry.isAboveHorizon)return!1;o&&(c*=t.pixelToTileUnitsFactor);for(const l of e)for(const e of l){const l=e.add(a),u=i&&n.elevation?n.elevation.exaggeration()*i.getElevationAt(l.x,l.y,!0):0,h=o?l:xc(l,u,r),d=o?t.tilespaceRays.map(t=>Cc(t,u)):t.queryGeometry.screenGeometry,p=fc([],[e.x,e.y,u,1],r);if(!s&&o?c*=p[3]/n.cameraToCenterDistance:s&&!o&&(c*=n.cameraToCenterDistance/p[3]),xa(d,h,c))return!0}return!1}function xc(t,e,n){const r=fc([],[t.x,t.y,e,1],n);return new i(r[0]/r[3],r[1]/r[3])}const wc=Ya(0,0,0),Tc=Ya(0,0,1);function Cc(t,e){const n=Za();return wc[2]=e,t.intersectsPlane(wc,Tc,n),new i(n[0],n[1])}class Ec extends va{}function Sc(t,{width:e,height:n},r,i){if(i){if(i instanceof Uint8ClampedArray)i=new Uint8Array(i.buffer);else if(i.length!==e*n*r)throw new RangeError("mismatched image size")}else i=new Uint8Array(e*n*r);return t.width=e,t.height=n,t.data=i,t}function Ic(t,e,n){const{width:r,height:i}=e;r===t.width&&i===t.height||(kc(t,e,{x:0,y:0},{x:0,y:0},{width:Math.min(t.width,r),height:Math.min(t.height,i)},n),t.width=r,t.height=i,t.data=e.data)}function kc(t,e,n,r,i,o){if(0===i.width||0===i.height)return e;if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const s=t.data,a=e.data;for(let c=0;c<i.height;c++){const l=((n.y+c)*t.width+n.x)*o,u=((r.y+c)*e.width+r.x)*o;for(let t=0;t<i.width*o;t++)a[u+t]=s[l+t]}return e}si(Ec,"HeatmapBucket",{omit:["layers"]});class Ac{constructor(t,e){Sc(this,t,1,e)}resize(t){Ic(this,new Ac(t),1)}clone(){return new Ac({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,r,i){kc(t,e,n,r,i,1)}}class Mc{constructor(t,e){Sc(this,t,4,e)}resize(t){Ic(this,new Mc(t),4)}replace(t,e){e?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Mc({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,e,n,r,i){kc(t,e,n,r,i,4)}}si(Ac,"AlphaImage"),si(Mc,"RGBAImage");var Oc={paint:new bo({"heatmap-radius":new go(Bt.paint_heatmap["heatmap-radius"]),"heatmap-weight":new go(Bt.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new mo(Bt.paint_heatmap["heatmap-intensity"]),"heatmap-color":new vo(Bt.paint_heatmap["heatmap-color"]),"heatmap-opacity":new mo(Bt.paint_heatmap["heatmap-opacity"])})};function Pc(t){const e={},n=t.resolution||256,r=t.clips?t.clips.length:1,i=t.image||new Mc({width:n,height:r}),o=(n,r,o)=>{e[t.evaluationKey]=o;const s=t.expression.evaluate(e);i.data[n+r+0]=Math.floor(255*s.r/s.a),i.data[n+r+1]=Math.floor(255*s.g/s.a),i.data[n+r+2]=Math.floor(255*s.b/s.a),i.data[n+r+3]=Math.floor(255*s.a)};if(t.clips)for(let s=0,a=0;s<r;++s,a+=4*n)for(let e=0,r=0;e<n;e++,r+=4){const i=e/(n-1),{start:c,end:l}=t.clips[s];o(a,r,c*(1-i)+l*i)}else for(let s=0,a=0;s<n;s++,a+=4)o(0,a,s/(n-1));return i}var Dc={paint:new bo({"hillshade-illumination-direction":new mo(Bt.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new mo(Bt.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new mo(Bt.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new mo(Bt.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new mo(Bt.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new mo(Bt.paint_hillshade["hillshade-accent-color"])})};const Rc=Eo([{name:"a_pos",components:2,type:"Int16"}],4),{members:Nc}=Rc;var Lc=zc,jc=zc;function zc(t,e,n){n=n||2;var r,i,o,s,a,c,l,u=e&&e.length,h=u?e[0]*n:t.length,d=Fc(t,0,h,n,!0),p=[];if(!d||d.next===d.prev)return p;if(u&&(d=function(t,e,n,r){var i,o,s,a=[];for(i=0,o=e.length;i<o;i++)(s=Fc(t,e[i]*r,i<o-1?e[i+1]*r:t.length,r,!1))===s.next&&(s.steiner=!0),a.push(Xc(s));for(a.sort(Wc),i=0;i<a.length;i++)n=Bc(n=Hc(a[i],n),n.next);return n}(t,e,d,n)),t.length>80*n){r=o=t[0],i=s=t[1];for(var f=n;f<h;f+=n)(a=t[f])<r&&(r=a),(c=t[f+1])<i&&(i=c),a>o&&(o=a),c>s&&(s=c);l=0!==(l=Math.max(o-r,s-i))?1/l:0}return Uc(d,p,n,r,i,l),p}function Fc(t,e,n,r,i){var o,s;if(i===ll(t,e,n,r)>0)for(o=e;o<n;o+=r)s=sl(o,t[o],t[o+1],s);else for(o=n-r;o>=e;o-=r)s=sl(o,t[o],t[o+1],s);return s&&tl(s,s.next)&&(al(s),s=s.next),s}function Bc(t,e){if(!t)return t;e||(e=t);var n,r=t;do{if(n=!1,r.steiner||!tl(r,r.next)&&0!==Jc(r.prev,r,r.next))r=r.next;else{if(al(r),(r=e=r.prev)===r.next)break;n=!0}}while(n||r!==e);return e}function Uc(t,e,n,r,i,o,s){if(t){!s&&o&&function(t,e,n,r){var i=t;do{null===i.z&&(i.z=Kc(i.x,i.y,e,n,r)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==t);i.prevZ.nextZ=null,i.prevZ=null,function(t){var e,n,r,i,o,s,a,c,l=1;do{for(n=t,t=null,o=null,s=0;n;){for(s++,r=n,a=0,e=0;e<l&&(a++,r=r.nextZ);e++);for(c=l;a>0||c>0&&r;)0!==a&&(0===c||!r||n.z<=r.z)?(i=n,n=n.nextZ,a--):(i=r,r=r.nextZ,c--),o?o.nextZ=i:t=i,i.prevZ=o,o=i;n=r}o.nextZ=null,l*=2}while(s>1)}(i)}(t,r,i,o);for(var a,c,l=t;t.prev!==t.next;)if(a=t.prev,c=t.next,o?qc(t,r,i,o):Vc(t))e.push(a.i/n),e.push(t.i/n),e.push(c.i/n),al(t),t=c.next,l=c.next;else if((t=c)===l){s?1===s?Uc(t=Gc(Bc(t),e,n),e,n,r,i,o,2):2===s&&$c(t,e,n,r,i,o):Uc(Bc(t),e,n,r,i,o,1);break}}}function Vc(t){var e=t.prev,n=t,r=t.next;if(Jc(e,n,r)>=0)return!1;for(var i=t.next.next;i!==t.prev;){if(Yc(e.x,e.y,n.x,n.y,r.x,r.y,i.x,i.y)&&Jc(i.prev,i,i.next)>=0)return!1;i=i.next}return!0}function qc(t,e,n,r){var i=t.prev,o=t,s=t.next;if(Jc(i,o,s)>=0)return!1;for(var a=i.x>o.x?i.x>s.x?i.x:s.x:o.x>s.x?o.x:s.x,c=i.y>o.y?i.y>s.y?i.y:s.y:o.y>s.y?o.y:s.y,l=Kc(i.x<o.x?i.x<s.x?i.x:s.x:o.x<s.x?o.x:s.x,i.y<o.y?i.y<s.y?i.y:s.y:o.y<s.y?o.y:s.y,e,n,r),u=Kc(a,c,e,n,r),h=t.prevZ,d=t.nextZ;h&&h.z>=l&&d&&d.z<=u;){if(h!==t.prev&&h!==t.next&&Yc(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&Jc(h.prev,h,h.next)>=0)return!1;if(h=h.prevZ,d!==t.prev&&d!==t.next&&Yc(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Jc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}for(;h&&h.z>=l;){if(h!==t.prev&&h!==t.next&&Yc(i.x,i.y,o.x,o.y,s.x,s.y,h.x,h.y)&&Jc(h.prev,h,h.next)>=0)return!1;h=h.prevZ}for(;d&&d.z<=u;){if(d!==t.prev&&d!==t.next&&Yc(i.x,i.y,o.x,o.y,s.x,s.y,d.x,d.y)&&Jc(d.prev,d,d.next)>=0)return!1;d=d.nextZ}return!0}function Gc(t,e,n){var r=t;do{var i=r.prev,o=r.next.next;!tl(i,o)&&el(i,r,r.next,o)&&il(i,o)&&il(o,i)&&(e.push(i.i/n),e.push(r.i/n),e.push(o.i/n),al(r),al(r.next),r=t=o),r=r.next}while(r!==t);return Bc(r)}function $c(t,e,n,r,i,o){var s=t;do{for(var a=s.next.next;a!==s.prev;){if(s.i!==a.i&&Qc(s,a)){var c=ol(s,a);return s=Bc(s,s.next),c=Bc(c,c.next),Uc(s,e,n,r,i,o),void Uc(c,e,n,r,i,o)}a=a.next}s=s.next}while(s!==t)}function Wc(t,e){return t.x-e.x}function Hc(t,e){var n=function(t,e){var n,r=e,i=t.x,o=t.y,s=-1/0;do{if(o<=r.y&&o>=r.next.y&&r.next.y!==r.y){var a=r.x+(o-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(a<=i&&a>s){if(s=a,a===i){if(o===r.y)return r;if(o===r.next.y)return r.next}n=r.x<r.next.x?r:r.next}}r=r.next}while(r!==e);if(!n)return null;if(i===s)return n;var c,l=n,u=n.x,h=n.y,d=1/0;r=n;do{i>=r.x&&r.x>=u&&i!==r.x&&Yc(o<h?i:s,o,u,h,o<h?s:i,o,r.x,r.y)&&(c=Math.abs(o-r.y)/(i-r.x),il(r,t)&&(c<d||c===d&&(r.x>n.x||r.x===n.x&&Zc(n,r)))&&(n=r,d=c)),r=r.next}while(r!==l);return n}(t,e);if(!n)return e;var r=ol(n,t),i=Bc(n,n.next);return Bc(r,r.next),e===n?i:e}function Zc(t,e){return Jc(t.prev,t,e.prev)<0&&Jc(e.next,t,t.next)<0}function Kc(t,e,n,r,i){return(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-n)*i)|t<<8))|t<<4))|t<<2))|t<<1))|(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*i)|e<<8))|e<<4))|e<<2))|e<<1))<<1}function Xc(t){var e=t,n=t;do{(e.x<n.x||e.x===n.x&&e.y<n.y)&&(n=e),e=e.next}while(e!==t);return n}function Yc(t,e,n,r,i,o,s,a){return(i-s)*(e-a)-(t-s)*(o-a)>=0&&(t-s)*(r-a)-(n-s)*(e-a)>=0&&(n-s)*(o-a)-(i-s)*(r-a)>=0}function Qc(t,e){return t.next.i!==e.i&&t.prev.i!==e.i&&!function(t,e){var n=t;do{if(n.i!==t.i&&n.next.i!==t.i&&n.i!==e.i&&n.next.i!==e.i&&el(n,n.next,t,e))return!0;n=n.next}while(n!==t);return!1}(t,e)&&(il(t,e)&&il(e,t)&&function(t,e){var n=t,r=!1,i=(t.x+e.x)/2,o=(t.y+e.y)/2;do{n.y>o!=n.next.y>o&&n.next.y!==n.y&&i<(n.next.x-n.x)*(o-n.y)/(n.next.y-n.y)+n.x&&(r=!r),n=n.next}while(n!==t);return r}(t,e)&&(Jc(t.prev,t,e.prev)||Jc(t,e.prev,e))||tl(t,e)&&Jc(t.prev,t,t.next)>0&&Jc(e.prev,e,e.next)>0)}function Jc(t,e,n){return(e.y-t.y)*(n.x-e.x)-(e.x-t.x)*(n.y-e.y)}function tl(t,e){return t.x===e.x&&t.y===e.y}function el(t,e,n,r){var i=rl(Jc(t,e,n)),o=rl(Jc(t,e,r)),s=rl(Jc(n,r,t)),a=rl(Jc(n,r,e));return i!==o&&s!==a||!(0!==i||!nl(t,n,e))||!(0!==o||!nl(t,r,e))||!(0!==s||!nl(n,t,r))||!(0!==a||!nl(n,e,r))}function nl(t,e,n){return e.x<=Math.max(t.x,n.x)&&e.x>=Math.min(t.x,n.x)&&e.y<=Math.max(t.y,n.y)&&e.y>=Math.min(t.y,n.y)}function rl(t){return t>0?1:t<0?-1:0}function il(t,e){return Jc(t.prev,t,t.next)<0?Jc(t,e,t.next)>=0&&Jc(t,t.prev,e)>=0:Jc(t,e,t.prev)<0||Jc(t,t.next,e)<0}function ol(t,e){var n=new cl(t.i,t.x,t.y),r=new cl(e.i,e.x,e.y),i=t.next,o=e.prev;return t.next=e,e.prev=t,n.next=i,i.prev=n,r.next=n,n.prev=r,o.next=r,r.prev=o,r}function sl(t,e,n,r){var i=new cl(t,e,n);return r?(i.next=r.next,i.prev=r,r.next.prev=i,r.next=i):(i.prev=i,i.next=i),i}function al(t){t.next.prev=t.prev,t.prev.next=t.next,t.prevZ&&(t.prevZ.nextZ=t.nextZ),t.nextZ&&(t.nextZ.prevZ=t.prevZ)}function cl(t,e,n){this.i=t,this.x=e,this.y=n,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ll(t,e,n,r){for(var i=0,o=e,s=n-r;o<n;o+=r)i+=(t[s]-t[o])*(t[o+1]+t[s+1]),s=o;return i}function ul(t,e,n,r,i){hl(t,e,n||0,r||t.length-1,i||pl)}function hl(t,e,n,r,i){for(;r>n;){if(r-n>600){var o=r-n+1,s=e-n+1,a=Math.log(o),c=.5*Math.exp(2*a/3),l=.5*Math.sqrt(a*c*(o-c)/o)*(s-o/2<0?-1:1);hl(t,e,Math.max(n,Math.floor(e-s*c/o+l)),Math.min(r,Math.floor(e+(o-s)*c/o+l)),i)}var u=t[e],h=n,d=r;for(dl(t,n,e),i(t[r],u)>0&&dl(t,n,r);h<d;){for(dl(t,h,d),h++,d--;i(t[h],u)<0;)h++;for(;i(t[d],u)>0;)d--}0===i(t[n],u)?dl(t,n,d):dl(t,++d,r),d<=e&&(n=d+1),e<=d&&(r=d-1)}}function dl(t,e,n){var r=t[e];t[e]=t[n],t[n]=r}function pl(t,e){return t<e?-1:t>e?1:0}function fl(t,e){const n=t.length;if(n<=1)return[t];const r=[];let i,o;for(let s=0;s<n;s++){const e=R(t[s]);0!==e&&(t[s].area=Math.abs(e),void 0===o&&(o=e<0),o===e<0?(i&&r.push(i),i=[t[s]]):i.push(t[s]))}if(i&&r.push(i),e>1)for(let s=0;s<r.length;s++)r[s].length<=e||(ul(r[s],e,1,r[s].length-1,ml),r[s]=r[s].slice(0,e));return r}function ml(t,e){return e.area-t.area}function gl(t,e,n){const r=n.patternDependencies;let i=!1;for(const o of e){const e=o.paint.get(`${t}-pattern`);e.isConstant()||(i=!0);const n=e.constantOr(null);n&&(i=!0,r[n.to]=!0,r[n.from]=!0)}return i}function _l(t,e,n,r,i){const o=i.patternDependencies;for(const s of e){const e=s.paint.get(`${t}-pattern`).value;if("constant"!==e.kind){let t=e.evaluate({zoom:r-1},n,{},i.availableImages),a=e.evaluate({zoom:r},n,{},i.availableImages),c=e.evaluate({zoom:r+1},n,{},i.availableImages);t=t&&t.name?t.name:t,a=a&&a.name?a.name:a,c=c&&c.name?c.name:c,o[t]=!0,o[a]=!0,o[c]=!0,n.patterns[s.id]={min:t,mid:a,max:c}}}return n}zc.deviation=function(t,e,n,r){var i=e&&e.length,o=Math.abs(ll(t,0,i?e[0]*n:t.length,n));if(i)for(var s=0,a=e.length;s<a;s++)o-=Math.abs(ll(t,e[s]*n,s<a-1?e[s+1]*n:t.length,n));var c=0;for(s=0;s<r.length;s+=3){var l=r[s]*n,u=r[s+1]*n,h=r[s+2]*n;c+=Math.abs((t[l]-t[h])*(t[u+1]-t[l+1])-(t[l]-t[u])*(t[h+1]-t[l+1]))}return 0===o&&0===c?0:Math.abs((c-o)/o)},zc.flatten=function(t){for(var e=t[0][0].length,n={vertices:[],holes:[],dimensions:e},r=0,i=0;i<t.length;i++){for(var o=0;o<t[i].length;o++)for(var s=0;s<e;s++)n.vertices.push(t[i][o][s]);i>0&&n.holes.push(r+=t[i-1].length)}return n},Lc.default=jc;class yl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Io,this.indexArray=new Vo,this.indexArray2=new Ko,this.programConfigurations=new Fs(t.layers,t.zoom),this.segments=new Ks,this.segments2=new Ks,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.projection=t.projection}populate(t,e,n,r){this.hasPattern=gl("fill",this.layers,e);const i=this.layers[0].layout.get("fill-sort-key"),o=[];for(const{feature:s,id:a,index:c,sourceLayerIndex:l}of t){const t=this.layers[0]._featureFilter.needGeometry,u=ga(s,t);if(!this.layers[0]._featureFilter.filter(new oo(this.zoom),u,n))continue;const h=i?i.evaluate(u,{},n,e.availableImages):void 0,d={id:a,properties:s.properties,type:s.type,sourceLayerIndex:l,index:c,geometry:t?u.geometry:ma(s,n,r),patterns:{},sortKey:h};o.push(d)}i&&o.sort((t,e)=>t.sortKey-e.sortKey);for(const s of o){const{geometry:r,index:i,sourceLayerIndex:o}=s;if(this.hasPattern){const t=_l("fill",this.layers,s,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(s,r,i,n,{},e.availableImages);e.featureIndex.insert(t[i].feature,r,i,o,this.index)}}update(t,e,n,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n,r)}addFeatures(t,e,n,r,i){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,e,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Nc),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.indexBuffer2=t.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())}addFeature(t,e,n,r,i,o=[]){for(const s of fl(e,500)){let t=0;for(const a of s)t+=a.length;const e=this.segments.prepareSegment(t,this.layoutVertexArray,this.indexArray),n=e.vertexLength,r=[],i=[];for(const a of s){if(0===a.length)continue;a!==s[0]&&i.push(r.length/2);const t=this.segments2.prepareSegment(a.length,this.layoutVertexArray,this.indexArray2),e=t.vertexLength;this.layoutVertexArray.emplaceBack(a[0].x,a[0].y),this.indexArray2.emplaceBack(e+a.length-1,e),r.push(a[0].x),r.push(a[0].y);for(let n=1;n<a.length;n++)this.layoutVertexArray.emplaceBack(a[n].x,a[n].y),this.indexArray2.emplaceBack(e+n-1,e+n),r.push(a[n].x),r.push(a[n].y);t.vertexLength+=a.length,t.primitiveLength+=a.length}const o=Lc(r,i);for(let s=0;s<o.length;s+=3)this.indexArray.emplaceBack(n+o[s],n+o[s+1],n+o[s+2]);e.vertexLength+=t,e.primitiveLength+=o.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,o,r)}}si(yl,"FillBucket",{omit:["layers","patternFeatures"]});const vl=new bo({"fill-sort-key":new go(Bt.layout_fill["fill-sort-key"])});var bl={paint:new bo({"fill-antialias":new mo(Bt.paint_fill["fill-antialias"]),"fill-opacity":new go(Bt.paint_fill["fill-opacity"]),"fill-color":new go(Bt.paint_fill["fill-color"]),"fill-outline-color":new go(Bt.paint_fill["fill-outline-color"]),"fill-translate":new mo(Bt.paint_fill["fill-translate"]),"fill-translate-anchor":new mo(Bt.paint_fill["fill-translate-anchor"]),"fill-pattern":new _o(Bt.paint_fill["fill-pattern"])}),layout:vl};const xl=Eo([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),wl=Eo([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Tl=Eo([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Cl}=xl;var El=Sl;function Sl(t,e,n,r,i){this.properties={},this.extent=n,this.type=0,this._pbf=t,this._geometry=-1,this._keys=r,this._values=i,t.readFields(Il,this,e)}function Il(t,e,n){1==t?e.id=n.readVarint():2==t?function(t,e){for(var n=t.readVarint()+t.pos;t.pos<n;){var r=e._keys[t.readVarint()],i=e._values[t.readVarint()];e.properties[r]=i}}(n,e):3==t?e.type=n.readVarint():4==t&&(e._geometry=n.pos)}function kl(t){for(var e,n,r=0,i=0,o=t.length,s=o-1;i<o;s=i++)r+=((n=t[s]).x-(e=t[i]).x)*(e.y+n.y);return r}Sl.types=["Unknown","Point","LineString","Polygon"],Sl.prototype.loadGeometry=function(){var t=this._pbf;t.pos=this._geometry;for(var e,n=t.readVarint()+t.pos,r=1,o=0,s=0,a=0,c=[];t.pos<n;){if(o<=0){var l=t.readVarint();r=7&l,o=l>>3}if(o--,1===r||2===r)s+=t.readSVarint(),a+=t.readSVarint(),1===r&&(e&&c.push(e),e=[]),e.push(new i(s,a));else{if(7!==r)throw new Error("unknown command "+r);e&&e.push(e[0].clone())}}return e&&c.push(e),c},Sl.prototype.bbox=function(){var t=this._pbf;t.pos=this._geometry;for(var e=t.readVarint()+t.pos,n=1,r=0,i=0,o=0,s=1/0,a=-1/0,c=1/0,l=-1/0;t.pos<e;){if(r<=0){var u=t.readVarint();n=7&u,r=u>>3}if(r--,1===n||2===n)(i+=t.readSVarint())<s&&(s=i),i>a&&(a=i),(o+=t.readSVarint())<c&&(c=o),o>l&&(l=o);else if(7!==n)throw new Error("unknown command "+n)}return[s,c,a,l]},Sl.prototype.toGeoJSON=function(t,e,n){var r,i,o=this.extent*Math.pow(2,n),s=this.extent*t,a=this.extent*e,c=this.loadGeometry(),l=Sl.types[this.type];function u(t){for(var e=0;e<t.length;e++){var n=t[e];t[e]=[360*(n.x+s)/o-180,360/Math.PI*Math.atan(Math.exp((180-360*(n.y+a)/o)*Math.PI/180))-90]}}switch(this.type){case 1:var h=[];for(r=0;r<c.length;r++)h[r]=c[r][0];u(c=h);break;case 2:for(r=0;r<c.length;r++)u(c[r]);break;case 3:for(c=function(t){var e=t.length;if(e<=1)return[t];for(var n,r,i=[],o=0;o<e;o++){var s=kl(t[o]);0!==s&&(void 0===r&&(r=s<0),r===s<0?(n&&i.push(n),n=[t[o]]):n.push(t[o]))}return n&&i.push(n),i}(c),r=0;r<c.length;r++)for(i=0;i<c[r].length;i++)u(c[r][i])}1===c.length?c=c[0]:l="Multi"+l;var d={type:"Feature",geometry:{type:l,coordinates:c},properties:this.properties};return"id"in this&&(d.id=this.id),d};var Al=Ml;function Ml(t,e){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Ol,this,e),this.length=this._features.length}function Ol(t,e,n){15===t?e.version=n.readVarint():1===t?e.name=n.readString():5===t?e.extent=n.readVarint():2===t?e._features.push(n.pos):3===t?e._keys.push(n.readString()):4===t&&e._values.push(function(t){for(var e=null,n=t.readVarint()+t.pos;t.pos<n;){var r=t.readVarint()>>3;e=1===r?t.readString():2===r?t.readFloat():3===r?t.readDouble():4===r?t.readVarint64():5===r?t.readVarint():6===r?t.readSVarint():7===r?t.readBoolean():null}return e}(n))}function Pl(t,e,n){if(3===t){var r=new Al(n,n.readVarint()+n.pos);r.length&&(e[r.name]=r)}}Ml.prototype.feature=function(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];var e=this._pbf.readVarint()+this._pbf.pos;return new El(this._pbf,e,this.extent,this._keys,this._values)};var Dl={VectorTile:function(t,e){this.layers=t.readFields(Pl,{},e)},VectorTileFeature:El,VectorTileLayer:Al};function Rl(t,e,n,r){const o=[],s=0===r?(t,e,n,r,o,s)=>{t.push(new i(s,n+(s-e)/(r-e)*(o-n)))}:(t,e,n,r,o,s)=>{t.push(new i(e+(s-n)/(o-n)*(r-e),s))};for(const i of t){const t=[];for(const o of i){if(o.length<=2)continue;const i=[];for(let t=0;t<o.length-1;t++){const a=o[t].x,c=o[t].y,l=o[t+1].x,u=o[t+1].y,h=0===r?a:c,d=0===r?l:u;h<e?d>e&&s(i,a,c,l,u,e):h>n?d<n&&s(i,a,c,l,u,n):i.push(o[t]),d<e&&h>=e&&s(i,a,c,l,u,e),d>n&&h<=n&&s(i,a,c,l,u,n)}let a=o[o.length-1];const c=0===r?a.x:a.y;c>=e&&c<=n&&i.push(a),i.length&&(a=i[i.length-1],i[0].x===a.x&&i[0].y===a.y||i.push(i[0]),t.push(i))}t.length&&o.push(t)}return o}const Nl=Dl.VectorTileFeature.types,Ll=Math.pow(2,13);function jl(t,e,n,r,i,o,s,a){t.emplaceBack((e<<1)+s,(n<<1)+o,(Math.floor(r*Ll)<<1)+i,Math.round(a))}function zl(t,e,n){const r=16384;t.emplaceBack(e.x,e.y,e.z,n[0]*r,n[1]*r,n[2]*r)}class Fl{constructor(){this.acc=new i(0,0),this.polyCount=[]}startRing(t){this.currentPolyCount={edges:0,top:0},this.polyCount.push(this.currentPolyCount),this.min||(this.min=new i(t.x,t.y),this.max=new i(t.x,t.y))}append(t,e){this.currentPolyCount.edges++,this.acc._add(t);const n=this.min,r=this.max;t.x<n.x?n.x=t.x:t.x>r.x&&(r.x=t.x),t.y<n.y?n.y=t.y:t.y>r.y&&(r.y=t.y),((0===t.x||t.x===Xs)&&t.x===e.x)!=((0===t.y||t.y===Xs)&&t.y===e.y)&&this.processBorderOverlap(t,e),e.x<0!=t.x<0&&this.addBorderIntersection(0,nn(e.y,t.y,(0-e.x)/(t.x-e.x))),e.x>Xs!=t.x>Xs&&this.addBorderIntersection(1,nn(e.y,t.y,(Xs-e.x)/(t.x-e.x))),e.y<0!=t.y<0&&this.addBorderIntersection(2,nn(e.x,t.x,(0-e.y)/(t.y-e.y))),e.y>Xs!=t.y>Xs&&this.addBorderIntersection(3,nn(e.x,t.x,(Xs-e.y)/(t.y-e.y)))}addBorderIntersection(t,e){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const n=this.borders[t];e<n[0]&&(n[0]=e),e>n[1]&&(n[1]=e)}processBorderOverlap(t,e){if(t.x===e.x){if(t.y===e.y)return;const n=0===t.x?0:1;this.addBorderIntersection(n,e.y),this.addBorderIntersection(n,t.y)}else{const n=0===t.y?2:3;this.addBorderIntersection(n,e.x),this.addBorderIntersection(n,t.x)}}centroid(){const t=this.polyCount.reduce((t,e)=>t+e.edges,0);return 0!==t?this.acc.div(t)._round():new i(0,0)}span(){return new i(this.max.x-this.min.x,this.max.y-this.min.y)}intersectsCount(){return this.borders.reduce((t,e)=>t+ +(e[0]!==Number.MAX_VALUE),0)}}class Bl{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Ao,this.centroidVertexArray=new ds,this.indexArray=new Vo,this.programConfigurations=new Fs(t.layers,t.zoom),this.segments=new Ks,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.enableTerrain=t.enableTerrain}populate(t,e,n,r){this.features=[],this.hasPattern=gl("fill-extrusion",this.layers,e),this.featuresOnBorder=[],this.borders=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.tileToMeter=function(t){const e=Math.exp(Math.PI*(1-t.y/(1<<t.z)*2));return 80150034*e/(e*e+1)/Xs/(1<<t.z)}(n);for(const{feature:i,id:o,index:s,sourceLayerIndex:a}of t){const t=this.layers[0]._featureFilter.needGeometry,c=ga(i,t);if(!this.layers[0]._featureFilter.filter(new oo(this.zoom),c,n))continue;const l={id:o,sourceLayerIndex:a,index:s,geometry:t?c.geometry:ma(i,n,r),properties:i.properties,type:i.type,patterns:{}},u=this.layoutVertexArray.length;this.hasPattern?this.features.push(_l("fill-extrusion",this.layers,l,this.zoom,e)):this.addFeature(l,l.geometry,s,n,{},e.availableImages,r),e.featureIndex.insert(i,l.geometry,s,a,this.index,u)}this.sortBorders()}addFeatures(t,e,n,r,i){for(const o of this.features){const{geometry:t}=o;this.addFeature(o,t,o.index,e,n,r,i)}this.sortBorders()}update(t,e,n,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Cl),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Tl.members,!0))),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){0!==this.centroidVertexArray.length&&(this.centroidVertexBuffer?this.needsCentroidUpdate&&this.centroidVertexBuffer.updateData(this.centroidVertexArray):this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,wl.members,!0),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,e,n,r,o,s,a){const c=[new i(0,0),new i(Xs,Xs)],l=a.projection,u="globe"===l.name,h=this.enableTerrain&&!u?new Fl:null;u&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new ts);const d=fl(e,500);for(let i=d.length-1;i>=0;i--){const t=d[i];(0===t.length||(p=t[0]).every(t=>t.x<=0)||p.every(t=>t.x>=Xs)||p.every(t=>t.y<=0)||p.every(t=>t.y>=Xs))&&d.splice(i,1)}var p;let f;if(u){const t=11.25,e=1<<r.z,n=oa(r.x/e),o=oa((r.x+1)/e),s=sa(r.y/e),a=sa((r.y+1)/e);f=function(t,e,n,r,o=0,s){const a=[];if(!t.length||!n||!r)return a;const c=(t,e)=>{for(const n of t)a.push({polygon:n,bounds:e})},l=Math.ceil(Math.log2(n)),u=Math.ceil(Math.log2(r)),h=l-u,d=[];for(let i=0;i<Math.abs(h);i++)d.push(h>0?0:1);for(let i=0;i<Math.min(l,u);i++)d.push(0),d.push(1);let p=t;if(p=Rl(p,e[0].y-o,e[1].y+o,1),p=Rl(p,e[0].x-o,e[1].x+o,0),!p.length)return a;const f=[];for(d.length?f.push({polygons:p,bounds:e,depth:0}):c(p,e);f.length;){const t=f.pop(),e=t.depth,n=d[e],r=t.bounds[0],a=t.bounds[1],l=0===n?r.x:r.y,u=0===n?a.x:a.y,h=s?s(n,l,u):.5*(l+u),p=Rl(t.polygons,l-o,h+o,n),m=Rl(t.polygons,h-o,u+o,n);if(p.length){const t=[r,new i(0===n?h:a.x,1===n?h:a.y)];d.length>e+1?f.push({polygons:p,bounds:t,depth:e+1}):c(p,t)}if(m.length){const t=[new i(0===n?h:r.x,1===n?h:r.y),a];d.length>e+1?f.push({polygons:m,bounds:t,depth:e+1}):c(m,t)}}return a}(d,c,Math.ceil((o-n)/t),Math.ceil((s-a)/t),1,(t,n,i)=>{if(0===t)return.5*(n+i);{const t=sa((r.y+n/Xs)/e);return(ra(.5*(sa((r.y+i/Xs)/e)+t))*e-r.y)*Xs}})}else{f=[];for(const t of d)f.push({polygon:t,bounds:c})}for(const i of f){const e=i.polygon;let n=0,o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray);for(let t=0;t<e.length;t++){const s=e[t];if(0===s.length)continue;n+=s.length;let a=0;h&&h.startRing(s[0]);for(let t=0;t<s.length;t++){const e=s[t];if(t>=1){const n=s[t-1];if(!Ul(e,n,i.bounds)){h&&h.append(e,n),o.vertexLength+4>Ks.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));const t=e.sub(n)._perp(),i=t.x/(Math.abs(t.x)+Math.abs(t.y)),s=t.y>0?1:0,c=n.dist(e);a+c>32768&&(a=0),jl(this.layoutVertexArray,e.x,e.y,i,s,0,0,a),jl(this.layoutVertexArray,e.x,e.y,i,s,0,1,a),a+=c,jl(this.layoutVertexArray,n.x,n.y,i,s,0,0,a),jl(this.layoutVertexArray,n.x,n.y,i,s,0,1,a);const d=o.vertexLength;if(this.indexArray.emplaceBack(d,d+2,d+1),this.indexArray.emplaceBack(d+1,d+2,d+3),o.vertexLength+=4,o.primitiveLength+=2,u){const t=this.layoutVertexExtArray,i=l.projectTilePoint(e.x,e.y,r),o=l.projectTilePoint(n.x,n.y,r),s=l.upVector(r,e.x,e.y),a=l.upVector(r,n.x,n.y);zl(t,i,s),zl(t,i,s),zl(t,o,a),zl(t,o,a)}}}}}if(o.vertexLength+n>Ks.MAX_VERTEX_ARRAY_LENGTH&&(o=this.segments.prepareSegment(n,this.layoutVertexArray,this.indexArray)),"Polygon"!==Nl[t.type])continue;const s=[],a=[],c=o.vertexLength;for(let t=0;t<e.length;t++){const n=e[t];if(0!==n.length){n!==e[0]&&a.push(s.length/2);for(let t=0;t<n.length;t++){const e=n[t];jl(this.layoutVertexArray,e.x,e.y,0,0,1,1,0),s.push(e.x),s.push(e.y),h&&h.currentPolyCount.top++,u&&zl(this.layoutVertexExtArray,l.projectTilePoint(e.x,e.y,r),l.upVector(r,e.x,e.y))}}}const d=Lc(s,a);for(let t=0;t<d.length;t+=3)this.indexArray.emplaceBack(c+d[t],c+d[t+2],c+d[t+1]);o.primitiveLength+=d.length/3,o.vertexLength+=n}if(h&&h.polyCount.length>0){if(h.borders){h.vertexArrayOffset=this.centroidVertexArray.length;const t=h.borders,e=this.featuresOnBorder.push(h)-1;for(let n=0;n<4;n++)t[n][0]!==Number.MAX_VALUE&&this.borders[n].push(e)}this.encodeCentroid(h.borders?void 0:h.centroid(),h)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,o,s,r)}sortBorders(){for(let t=0;t<4;t++)this.borders[t].sort((e,n)=>this.featuresOnBorder[e].borders[t][0]-this.featuresOnBorder[n].borders[t][0])}encodeCentroid(t,e,n=!0){let r,i;if(t)if(0!==t.y){const n=e.span()._mult(this.tileToMeter);r=(Math.max(t.x,1)<<3)+Math.min(7,Math.round(n.x/10)),i=(Math.max(t.y,1)<<3)+Math.min(7,Math.round(n.y/10))}else r=Math.ceil(7*(t.x+450)),i=0;else r=0,i=+n;let o=n?this.centroidVertexArray.length:e.vertexArrayOffset;for(const s of e.polyCount){n&&this.centroidVertexArray.resize(this.centroidVertexArray.length+4*s.edges+s.top);for(let t=0;t<2*s.edges;t++)this.centroidVertexArray.emplace(o++,0,i),this.centroidVertexArray.emplace(o++,r,i);for(let t=0;t<s.top;t++)this.centroidVertexArray.emplace(o++,r,i)}}}function Ul(t,e,n){return t.x===e.x&&(t.x<n[0].x||t.x>n[1].x)||t.y===e.y&&(t.y<n[0].y||t.y>n[1].y)}si(Bl,"FillExtrusionBucket",{omit:["layers","features"]}),si(Fl,"PartMetadata");var Vl={paint:new bo({"fill-extrusion-opacity":new mo(Bt["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new go(Bt["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new mo(Bt["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new mo(Bt["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new _o(Bt["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new go(Bt["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new go(Bt["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new mo(Bt["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})};function ql(t,e){return t.x*e.x+t.y*e.y}function Gl(t,e){if(1===t.length){let n=0;const r=e[n++];let i;for(;!i||r.equals(i);)if(i=e[n++],!i)return 1/0;for(;n<e.length;n++){const o=e[n],s=t[0],a=i.sub(r),c=o.sub(r),l=s.sub(r),u=ql(a,a),h=ql(a,c),d=ql(c,c),p=ql(l,a),f=ql(l,c),m=u*d-h*h,g=(d*p-h*f)/m,_=(u*f-h*p)/m,y=r.z*(1-g-_)+i.z*g+o.z*_;if(isFinite(y))return y}return 1/0}{let t=1/0;for(const n of e)t=Math.min(t,n.z);return t}}function $l(t){const e=new i(t[0],t[1]);return e.z=t[2],e}function Wl(t,e,n,r,i,o,s,a){const c=s*i.getElevationAt(t,e,!0,!0),l=0!==o[0],u=l?0===o[1]?s*(o[0]/7-450):s*function(t,e,n){const r=Math.floor(e[0]/8),i=Math.floor(e[1]/8),o=10*(e[0]-8*r),s=10*(e[1]-8*i),a=t.getElevationAt(r,i,!0,!0),c=t.getMeterToDEM(n),l=Math.floor(.5*(o*c-1)),u=Math.floor(.5*(s*c-1)),h=t.tileCoordToPixel(r,i),d=2*l+1,p=2*u+1,f=function(t,e,n,r,i){return[t.getElevationAtPixel(e,n,!0),t.getElevationAtPixel(e+i,n,!0),t.getElevationAtPixel(e,n+i,!0),t.getElevationAtPixel(e+r,n+i,!0)]}(t,h.x-l,h.y-u,d,p),m=Math.abs(f[0]-f[1]),g=Math.abs(f[2]-f[3]),_=Math.abs(f[0]-f[2])+Math.abs(f[1]-f[3]),y=Math.min(.25,.5*c*(m+g)/d),v=Math.min(.25,.5*c*_/p);return a+Math.max(y*o,v*s)}(i,o,a):c;return{base:c+(0===n)?-1:n,top:l?Math.max(u+r,c+n+2):c+r}}const Hl=Eo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),{members:Zl}=Hl,Kl=Eo([{name:"a_packed",components:3,type:"Float32"}]),{members:Xl}=Kl,Yl=Dl.VectorTileFeature.types,Ql=Math.cos(Math.PI/180*37.5);class Jl{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(t=>{this.gradients[t.id]={}}),this.layoutVertexArray=new Mo,this.layoutVertexArray2=new Lo,this.indexArray=new Vo,this.programConfigurations=new Fs(t.layers,t.zoom),this.segments=new Ks,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id)}populate(t,e,n,r){this.hasPattern=gl("line",this.layers,e);const i=this.layers[0].layout.get("line-sort-key"),o=[];for(const{feature:l,id:u,index:h,sourceLayerIndex:d}of t){const t=this.layers[0]._featureFilter.needGeometry,e=ga(l,t);if(!this.layers[0]._featureFilter.filter(new oo(this.zoom),e,n))continue;const s=i?i.evaluate(e,{},n):void 0,a={id:u,properties:l.properties,type:l.type,sourceLayerIndex:d,index:h,geometry:t?e.geometry:ma(l,n,r),patterns:{},sortKey:s};o.push(a)}i&&o.sort((t,e)=>t.sortKey-e.sortKey);const{lineAtlas:s,featureIndex:a}=e,c=this.addConstantDashes(s);for(const l of o){const{geometry:r,index:i,sourceLayerIndex:o}=l;if(c&&this.addFeatureDashes(l,s),this.hasPattern){const t=_l("line",this.layers,l,this.zoom,e);this.patternFeatures.push(t)}else this.addFeature(l,r,i,n,s.positions,e.availableImages);a.insert(t[i].feature,r,i,o,this.index)}}addConstantDashes(t){let e=!1;for(const n of this.layers){const r=n.paint.get("line-dasharray").value,i=n.layout.get("line-cap").value;if("constant"!==r.kind||"constant"!==i.kind)e=!0;else{const e=i.value,n=r.value;if(!n)continue;t.addDash(n.from,e),t.addDash(n.to,e),n.other&&t.addDash(n.other,e)}}return e}addFeatureDashes(t,e){const n=this.zoom;for(const r of this.layers){const i=r.paint.get("line-dasharray").value,o=r.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===o.kind)continue;let s,a,c,l,u,h;if("constant"===i.kind){const t=i.value;if(!t)continue;s=t.other||t.to,a=t.to,c=t.from}else s=i.evaluate({zoom:n-1},t),a=i.evaluate({zoom:n},t),c=i.evaluate({zoom:n+1},t);"constant"===o.kind?l=u=h=o.value:(l=o.evaluate({zoom:n-1},t),u=o.evaluate({zoom:n},t),h=o.evaluate({zoom:n+1},t)),e.addDash(s,l),e.addDash(a,u),e.addDash(c,h);const d=e.getKey(s,l),p=e.getKey(a,u),f=e.getKey(c,h);t.patterns[r.id]={min:d,mid:p,max:f}}}update(t,e,n,r){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(t,e,this.stateDependentLayers,n,r)}addFeatures(t,e,n,r,i){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,e,n,r)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,Xl)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Zl),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,e,n,r,i,o){const s=this.layers[0].layout,a=s.get("line-join").evaluate(t,{}),c=s.get("line-cap").evaluate(t,{}),l=s.get("line-miter-limit"),u=s.get("line-round-limit");this.lineClips=this.lineFeatureClips(t);for(const h of e)this.addLine(h,t,a,c,l,u);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,i,o,r)}addLine(t,e,n,r,i,o){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineSoFar=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(let e=0;e<t.length-1;e++)this.totalDistance+=t[e].dist(t[e+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}const s="Polygon"===Yl[e.type];let a=t.length;for(;a>=2&&t[a-1].equals(t[a-2]);)a--;let c=0;for(;c<a-1&&t[c].equals(t[c+1]);)c++;if(a<(s?3:2))return;"bevel"===n&&(i=1.05);const l=this.overscaling<=16?122880/(512*this.overscaling):0,u=this.segments.prepareSegment(10*a,this.layoutVertexArray,this.indexArray);let h,d,p,f,m;this.e1=this.e2=-1,s&&(h=t[a-2],m=t[c].sub(h)._unit()._perp());for(let g=c;g<a;g++){if(p=g===a-1?s?t[c+1]:void 0:t[g+1],p&&t[g].equals(p))continue;m&&(f=m),h&&(d=h),h=t[g],m=p?p.sub(h)._unit()._perp():f,f=f||m;let e=f.add(m);0===e.x&&0===e.y||e._unit();const _=f.x*m.x+f.y*m.y,y=e.x*m.x+e.y*m.y,v=0!==y?1/y:1/0,b=2*Math.sqrt(2-2*y),x=y<Ql&&d&&p,w=f.x*m.y-f.y*m.x>0;if(x&&g>c){const t=h.dist(d);if(t>2*l){const e=h.sub(h.sub(d)._mult(l/t)._round());this.updateDistance(d,e),this.addCurrentVertex(e,f,0,0,u),d=e}}const T=d&&p;let C=T?n:s?"butt":r;if(T&&"round"===C&&(v<o?C="miter":v<=2&&(C="fakeround")),"miter"===C&&v>i&&(C="bevel"),"bevel"===C&&(v>2&&(C="flipbevel"),v<i&&(C="miter")),d&&this.updateDistance(d,h),"miter"===C)e._mult(v),this.addCurrentVertex(h,e,0,0,u);else if("flipbevel"===C){if(v>100)e=m.mult(-1);else{const t=v*f.add(m).mag()/f.sub(m).mag();e._perp()._mult(t*(w?-1:1))}this.addCurrentVertex(h,e,0,0,u),this.addCurrentVertex(h,e.mult(-1),0,0,u)}else if("bevel"===C||"fakeround"===C){const t=-Math.sqrt(v*v-1),e=w?t:0,n=w?0:t;if(d&&this.addCurrentVertex(h,f,e,n,u),"fakeround"===C){const t=Math.round(180*b/Math.PI/20);for(let e=1;e<t;e++){let n=e/t;if(.5!==n){const t=n-.5;n+=n*t*(n-1)*((1.0904+_*(_*(3.55645-1.43519*_)-3.2452))*t*t+(.848013+_*(.215638*_-1.06021)))}const r=m.sub(f)._mult(n)._add(f)._unit()._mult(w?-1:1);this.addHalfVertex(h,r.x,r.y,!1,w,0,u)}}p&&this.addCurrentVertex(h,m,-e,-n,u)}else if("butt"===C)this.addCurrentVertex(h,e,0,0,u);else if("square"===C){const t=d?1:-1;d||this.addCurrentVertex(h,e,t,t,u),this.addCurrentVertex(h,e,0,0,u),d&&this.addCurrentVertex(h,e,t,t,u)}else"round"===C&&(d&&(this.addCurrentVertex(h,f,0,0,u),this.addCurrentVertex(h,f,1,1,u,!0)),p&&(this.addCurrentVertex(h,m,-1,-1,u,!0),this.addCurrentVertex(h,m,0,0,u)));if(x&&g<a-1){const t=h.dist(p);if(t>2*l){const e=h.add(p.sub(h)._mult(l/t)._round());this.updateDistance(h,e),this.addCurrentVertex(e,m,0,0,u),h=e}}}}addCurrentVertex(t,e,n,r,i,o=!1){const s=e.y*r-e.x,a=-e.y-e.x*r;this.addHalfVertex(t,e.x+e.y*n,e.y-e.x*n,o,!1,n,i),this.addHalfVertex(t,s,a,o,!0,-r,i)}addHalfVertex({x:t,y:e},n,r,i,o,s,a){this.layoutVertexArray.emplaceBack((t<<1)+(i?1:0),(e<<1)+(o?1:0),Math.round(63*n)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar),this.lineClips&&this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,this.lineSoFar);const c=a.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,c),a.primitiveLength++),o?this.e2=c:this.e1=c}updateScaledDistance(){if(this.lineClips){const t=this.totalDistance/(this.lineClips.end-this.lineClips.start);this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=t*this.lineClips.start+this.distance}else this.lineSoFar=this.distance}updateDistance(t,e){this.distance+=t.dist(e),this.updateScaledDistance()}}si(Jl,"LineBucket",{omit:["layers","patternFeatures"]});const tu=new bo({"line-cap":new go(Bt.layout_line["line-cap"]),"line-join":new go(Bt.layout_line["line-join"]),"line-miter-limit":new mo(Bt.layout_line["line-miter-limit"]),"line-round-limit":new mo(Bt.layout_line["line-round-limit"]),"line-sort-key":new go(Bt.layout_line["line-sort-key"])});var eu={paint:new bo({"line-opacity":new go(Bt.paint_line["line-opacity"]),"line-color":new go(Bt.paint_line["line-color"]),"line-translate":new mo(Bt.paint_line["line-translate"]),"line-translate-anchor":new mo(Bt.paint_line["line-translate-anchor"]),"line-width":new go(Bt.paint_line["line-width"]),"line-gap-width":new go(Bt.paint_line["line-gap-width"]),"line-offset":new go(Bt.paint_line["line-offset"]),"line-blur":new go(Bt.paint_line["line-blur"]),"line-dasharray":new _o(Bt.paint_line["line-dasharray"]),"line-pattern":new _o(Bt.paint_line["line-pattern"]),"line-gradient":new vo(Bt.paint_line["line-gradient"])}),layout:tu};const nu=new class extends go{possiblyEvaluate(t,e){return e=new oo(Math.floor(e.zoom),{now:e.now,fadeDuration:e.fadeDuration,zoomHistory:e.zoomHistory,transition:e.transition}),super.possiblyEvaluate(t,e)}evaluate(t,e,n,r){return e=b({},e,{zoom:Math.floor(e.zoom)}),super.evaluate(t,e,n,r)}}(eu.paint.properties["line-width"].specification);function ru(t,e){return e>0?e+2*t:t}nu.useIntegerZoom=!0;const iu=Eo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"},{name:"a_z_tile_anchor",components:4,type:"Int16"}],4),ou=Eo([{name:"a_projected_pos",components:3,type:"Float32"}],4);Eo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const su=Eo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}]),au=Eo([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"}]);Eo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const cu=Eo([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),lu=Eo([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);Eo([{name:"triangle",components:3,type:"Uint16"}]),Eo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),Eo([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),Eo([{type:"Float32",name:"offsetX"}]),Eo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var uu=24;const hu=128;function du(t,e){const{expression:n}=e;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new oo(t+1))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:e,interpolationType:r}=n;let i=0;for(;i<e.length&&e[i]<=t;)i++;i=Math.max(0,i-1);let o=i;for(;o<e.length&&e[o]<t+1;)o++;o=Math.min(e.length-1,o);const s=e[i],a=e[o];return"composite"===n.kind?{kind:"composite",minZoom:s,maxZoom:a,interpolationType:r}:{kind:"camera",minZoom:s,maxZoom:a,minSize:n.evaluate(new oo(s)),maxSize:n.evaluate(new oo(a)),interpolationType:r}}}function pu(t,{uSize:e,uSizeT:n},{lowerSize:r,upperSize:i}){return"source"===t.kind?r/hu:"composite"===t.kind?nn(r/hu,i/hu,n):e}function fu(t,e){let n=0,r=0;if("constant"===t.kind)r=t.layoutSize;else if("source"!==t.kind){const{interpolationType:i,minZoom:o,maxZoom:s}=t,a=i?m(wn.interpolationFactor(i,e,o,s),0,1):0;"camera"===t.kind?r=nn(t.minSize,t.maxSize,a):n=a}return{uSizeT:n,uSize:r}}var mu=Object.freeze({__proto__:null,getSizeData:du,evaluateSizeForFeature:pu,evaluateSizeForZoom:fu,SIZE_PACK_FACTOR:hu});function gu(t,e,n){return t.sections.forEach(t=>{t.text=function(t,e,n){const r=e.layout.get("text-transform").evaluate(n,{});return"uppercase"===r?t=t.toLocaleUpperCase():"lowercase"===r&&(t=t.toLocaleLowerCase()),io.applyArabicShaping&&(t=io.applyArabicShaping(t)),t}(t.text,e,n)}),t}const _u={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42"};function yu(t){return"\ufe36"===t||"\ufe48"===t||"\ufe38"===t||"\ufe44"===t||"\ufe42"===t||"\ufe3e"===t||"\ufe3c"===t||"\ufe3a"===t||"\ufe18"===t||"\ufe40"===t||"\ufe10"===t||"\ufe13"===t||"\ufe14"===t||"\uff40"===t||"\uffe3"===t||"\ufe11"===t||"\ufe12"===t}function vu(t){return"\ufe35"===t||"\ufe47"===t||"\ufe37"===t||"\ufe43"===t||"\ufe41"===t||"\ufe3d"===t||"\ufe3b"===t||"\ufe39"===t||"\ufe17"===t||"\ufe3f"===t}var bu=function(t,e,n,r,i){var o,s,a=8*i-r-1,c=(1<<a)-1,l=c>>1,u=-7,h=n?i-1:0,d=n?-1:1,p=t[e+h];for(h+=d,o=p&(1<<-u)-1,p>>=-u,u+=a;u>0;o=256*o+t[e+h],h+=d,u-=8);for(s=o&(1<<-u)-1,o>>=-u,u+=r;u>0;s=256*s+t[e+h],h+=d,u-=8);if(0===o)o=1-l;else{if(o===c)return s?NaN:1/0*(p?-1:1);s+=Math.pow(2,r),o-=l}return(p?-1:1)*s*Math.pow(2,o-r)},xu=function(t,e,n,r,i,o){var s,a,c,l=8*o-i-1,u=(1<<l)-1,h=u>>1,d=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,p=r?0:o-1,f=r?1:-1,m=e<0||0===e&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,s=u):(s=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-s))<1&&(s--,c*=2),(e+=s+h>=1?d/c:d*Math.pow(2,1-h))*c>=2&&(s++,c/=2),s+h>=u?(a=0,s=u):s+h>=1?(a=(e*c-1)*Math.pow(2,i),s+=h):(a=e*Math.pow(2,h-1)*Math.pow(2,i),s=0));i>=8;t[n+p]=255&a,p+=f,a/=256,i-=8);for(s=s<<i|a,l+=i;l>0;t[n+p]=255&s,p+=f,s/=256,l-=8);t[n+p-f]|=128*m},wu=Tu;function Tu(t){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(t)?t:new Uint8Array(t||0),this.pos=0,this.type=0,this.length=this.buf.length}Tu.Varint=0,Tu.Fixed64=1,Tu.Bytes=2,Tu.Fixed32=5;var Cu=4294967296,Eu=1/Cu,Su="undefined"==typeof TextDecoder?null:new TextDecoder("utf8");function Iu(t){return t.type===Tu.Bytes?t.readVarint()+t.pos:t.pos+1}function ku(t,e,n){return n?4294967296*e+(t>>>0):4294967296*(e>>>0)+(t>>>0)}function Au(t,e,n){var r=e<=16383?1:e<=2097151?2:e<=268435455?3:Math.floor(Math.log(e)/(7*Math.LN2));n.realloc(r);for(var i=n.pos-1;i>=t;i--)n.buf[i+r]=n.buf[i]}function Mu(t,e){for(var n=0;n<t.length;n++)e.writeVarint(t[n])}function Ou(t,e){for(var n=0;n<t.length;n++)e.writeSVarint(t[n])}function Pu(t,e){for(var n=0;n<t.length;n++)e.writeFloat(t[n])}function Du(t,e){for(var n=0;n<t.length;n++)e.writeDouble(t[n])}function Ru(t,e){for(var n=0;n<t.length;n++)e.writeBoolean(t[n])}function Nu(t,e){for(var n=0;n<t.length;n++)e.writeFixed32(t[n])}function Lu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed32(t[n])}function ju(t,e){for(var n=0;n<t.length;n++)e.writeFixed64(t[n])}function zu(t,e){for(var n=0;n<t.length;n++)e.writeSFixed64(t[n])}function Fu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+16777216*t[e+3]}function Bu(t,e,n){t[n]=e,t[n+1]=e>>>8,t[n+2]=e>>>16,t[n+3]=e>>>24}function Uu(t,e){return(t[e]|t[e+1]<<8|t[e+2]<<16)+(t[e+3]<<24)}function Vu(t,e,n){e.glyphs=[],1===t&&n.readMessage(qu,e)}function qu(t,e,n){if(3===t){const{id:t,bitmap:r,width:i,height:o,left:s,top:a,advance:c}=n.readMessage(Gu,{});e.glyphs.push({id:t,bitmap:new Ac({width:i+6,height:o+6},r),metrics:{width:i,height:o,left:s,top:a,advance:c}})}else 4===t?e.ascender=n.readSVarint():5===t&&(e.descender=n.readSVarint())}function Gu(t,e,n){1===t?e.id=n.readVarint():2===t?e.bitmap=n.readBytes():3===t?e.width=n.readVarint():4===t?e.height=n.readVarint():5===t?e.left=n.readSVarint():6===t?e.top=n.readSVarint():7===t&&(e.advance=n.readVarint())}function $u(t){let e=0,n=0;for(const s of t)e+=s.w*s.h,n=Math.max(n,s.w);t.sort((t,e)=>e.h-t.h);const r=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(e/.95)),n),h:1/0}];let i=0,o=0;for(const s of t)for(let t=r.length-1;t>=0;t--){const e=r[t];if(!(s.w>e.w||s.h>e.h)){if(s.x=e.x,s.y=e.y,o=Math.max(o,s.y+s.h),i=Math.max(i,s.x+s.w),s.w===e.w&&s.h===e.h){const e=r.pop();t<r.length&&(r[t]=e)}else s.h===e.h?(e.x+=s.w,e.w-=s.w):s.w===e.w?(e.y+=s.h,e.h-=s.h):(r.push({x:e.x+s.w,y:e.y,w:e.w-s.w,h:s.h}),e.y+=s.h,e.h-=s.h);break}}return{w:i,h:o,fill:e/(i*o)||0}}Tu.prototype={destroy:function(){this.buf=null},readFields:function(t,e,n){for(n=n||this.length;this.pos<n;){var r=this.readVarint(),i=r>>3,o=this.pos;this.type=7&r,t(i,e,this),this.pos===o&&this.skip(r)}return e},readMessage:function(t,e){return this.readFields(t,e,this.readVarint()+this.pos)},readFixed32:function(){var t=Fu(this.buf,this.pos);return this.pos+=4,t},readSFixed32:function(){var t=Uu(this.buf,this.pos);return this.pos+=4,t},readFixed64:function(){var t=Fu(this.buf,this.pos)+Fu(this.buf,this.pos+4)*Cu;return this.pos+=8,t},readSFixed64:function(){var t=Fu(this.buf,this.pos)+Uu(this.buf,this.pos+4)*Cu;return this.pos+=8,t},readFloat:function(){var t=bu(this.buf,this.pos,!0,23,4);return this.pos+=4,t},readDouble:function(){var t=bu(this.buf,this.pos,!0,52,8);return this.pos+=8,t},readVarint:function(t){var e,n,r=this.buf;return e=127&(n=r[this.pos++]),n<128?e:(e|=(127&(n=r[this.pos++]))<<7,n<128?e:(e|=(127&(n=r[this.pos++]))<<14,n<128?e:(e|=(127&(n=r[this.pos++]))<<21,n<128?e:function(t,e,n){var r,i,o=n.buf;if(r=(112&(i=o[n.pos++]))>>4,i<128)return ku(t,r,e);if(r|=(127&(i=o[n.pos++]))<<3,i<128)return ku(t,r,e);if(r|=(127&(i=o[n.pos++]))<<10,i<128)return ku(t,r,e);if(r|=(127&(i=o[n.pos++]))<<17,i<128)return ku(t,r,e);if(r|=(127&(i=o[n.pos++]))<<24,i<128)return ku(t,r,e);if(r|=(1&(i=o[n.pos++]))<<31,i<128)return ku(t,r,e);throw new Error("Expected varint not more than 10 bytes")}(e|=(15&(n=r[this.pos]))<<28,t,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var t=this.readVarint();return t%2==1?(t+1)/-2:t/2},readBoolean:function(){return Boolean(this.readVarint())},readString:function(){var t=this.readVarint()+this.pos,e=this.pos;return this.pos=t,t-e>=12&&Su?function(t,e,n){return Su.decode(t.subarray(e,n))}(this.buf,e,t):function(t,e,n){for(var r="",i=e;i<n;){var o,s,a,c=t[i],l=null,u=c>239?4:c>223?3:c>191?2:1;if(i+u>n)break;1===u?c<128&&(l=c):2===u?128==(192&(o=t[i+1]))&&(l=(31&c)<<6|63&o)<=127&&(l=null):3===u?(s=t[i+2],128==(192&(o=t[i+1]))&&128==(192&s)&&((l=(15&c)<<12|(63&o)<<6|63&s)<=2047||l>=55296&&l<=57343)&&(l=null)):4===u&&(s=t[i+2],a=t[i+3],128==(192&(o=t[i+1]))&&128==(192&s)&&128==(192&a)&&((l=(15&c)<<18|(63&o)<<12|(63&s)<<6|63&a)<=65535||l>=1114112)&&(l=null)),null===l?(l=65533,u=1):l>65535&&(l-=65536,r+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),r+=String.fromCharCode(l),i+=u}return r}(this.buf,e,t)},readBytes:function(){var t=this.readVarint()+this.pos,e=this.buf.subarray(this.pos,t);return this.pos=t,e},readPackedVarint:function(t,e){if(this.type!==Tu.Bytes)return t.push(this.readVarint(e));var n=Iu(this);for(t=t||[];this.pos<n;)t.push(this.readVarint(e));return t},readPackedSVarint:function(t){if(this.type!==Tu.Bytes)return t.push(this.readSVarint());var e=Iu(this);for(t=t||[];this.pos<e;)t.push(this.readSVarint());return t},readPackedBoolean:function(t){if(this.type!==Tu.Bytes)return t.push(this.readBoolean());var e=Iu(this);for(t=t||[];this.pos<e;)t.push(this.readBoolean());return t},readPackedFloat:function(t){if(this.type!==Tu.Bytes)return t.push(this.readFloat());var e=Iu(this);for(t=t||[];this.pos<e;)t.push(this.readFloat());return t},readPackedDouble:function(t){if(this.type!==Tu.Bytes)return t.push(this.readDouble());var e=Iu(this);for(t=t||[];this.pos<e;)t.push(this.readDouble());return t},readPackedFixed32:function(t){if(this.type!==Tu.Bytes)return t.push(this.readFixed32());var e=Iu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed32());return t},readPackedSFixed32:function(t){if(this.type!==Tu.Bytes)return t.push(this.readSFixed32());var e=Iu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed32());return t},readPackedFixed64:function(t){if(this.type!==Tu.Bytes)return t.push(this.readFixed64());var e=Iu(this);for(t=t||[];this.pos<e;)t.push(this.readFixed64());return t},readPackedSFixed64:function(t){if(this.type!==Tu.Bytes)return t.push(this.readSFixed64());var e=Iu(this);for(t=t||[];this.pos<e;)t.push(this.readSFixed64());return t},skip:function(t){var e=7&t;if(e===Tu.Varint)for(;this.buf[this.pos++]>127;);else if(e===Tu.Bytes)this.pos=this.readVarint()+this.pos;else if(e===Tu.Fixed32)this.pos+=4;else{if(e!==Tu.Fixed64)throw new Error("Unimplemented type: "+e);this.pos+=8}},writeTag:function(t,e){this.writeVarint(t<<3|e)},realloc:function(t){for(var e=this.length||16;e<this.pos+t;)e*=2;if(e!==this.length){var n=new Uint8Array(e);n.set(this.buf),this.buf=n,this.length=e}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(t){this.realloc(4),Bu(this.buf,t,this.pos),this.pos+=4},writeSFixed32:function(t){this.realloc(4),Bu(this.buf,t,this.pos),this.pos+=4},writeFixed64:function(t){this.realloc(8),Bu(this.buf,-1&t,this.pos),Bu(this.buf,Math.floor(t*Eu),this.pos+4),this.pos+=8},writeSFixed64:function(t){this.realloc(8),Bu(this.buf,-1&t,this.pos),Bu(this.buf,Math.floor(t*Eu),this.pos+4),this.pos+=8},writeVarint:function(t){(t=+t||0)>268435455||t<0?function(t,e){var n,r;if(t>=0?(n=t%4294967296|0,r=t/4294967296|0):(r=~(-t/4294967296),4294967295^(n=~(-t%4294967296))?n=n+1|0:(n=0,r=r+1|0)),t>=0x10000000000000000||t<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");e.realloc(10),function(t,e,n){n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,t>>>=7,n.buf[n.pos++]=127&t|128,n.buf[n.pos]=127&(t>>>=7)}(n,0,e),function(t,e){var n=(7&t)<<4;e.buf[e.pos++]|=n|((t>>>=3)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t|((t>>>=7)?128:0),t&&(e.buf[e.pos++]=127&t)))))}(r,e)}(t,this):(this.realloc(4),this.buf[this.pos++]=127&t|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=127&(t>>>=7)|(t>127?128:0),t<=127||(this.buf[this.pos++]=t>>>7&127))))},writeSVarint:function(t){this.writeVarint(t<0?2*-t-1:2*t)},writeBoolean:function(t){this.writeVarint(Boolean(t))},writeString:function(t){t=String(t),this.realloc(4*t.length),this.pos++;var e=this.pos;this.pos=function(t,e,n){for(var r,i,o=0;o<e.length;o++){if((r=e.charCodeAt(o))>55295&&r<57344){if(!i){r>56319||o+1===e.length?(t[n++]=239,t[n++]=191,t[n++]=189):i=r;continue}if(r<56320){t[n++]=239,t[n++]=191,t[n++]=189,i=r;continue}r=i-55296<<10|r-56320|65536,i=null}else i&&(t[n++]=239,t[n++]=191,t[n++]=189,i=null);r<128?t[n++]=r:(r<2048?t[n++]=r>>6|192:(r<65536?t[n++]=r>>12|224:(t[n++]=r>>18|240,t[n++]=r>>12&63|128),t[n++]=r>>6&63|128),t[n++]=63&r|128)}return n}(this.buf,t,this.pos);var n=this.pos-e;n>=128&&Au(e,n,this),this.pos=e-1,this.writeVarint(n),this.pos+=n},writeFloat:function(t){this.realloc(4),xu(this.buf,t,this.pos,!0,23,4),this.pos+=4},writeDouble:function(t){this.realloc(8),xu(this.buf,t,this.pos,!0,52,8),this.pos+=8},writeBytes:function(t){var e=t.length;this.writeVarint(e),this.realloc(e);for(var n=0;n<e;n++)this.buf[this.pos++]=t[n]},writeRawMessage:function(t,e){this.pos++;var n=this.pos;t(e,this);var r=this.pos-n;r>=128&&Au(n,r,this),this.pos=n-1,this.writeVarint(r),this.pos+=r},writeMessage:function(t,e,n){this.writeTag(t,Tu.Bytes),this.writeRawMessage(e,n)},writePackedVarint:function(t,e){e.length&&this.writeMessage(t,Mu,e)},writePackedSVarint:function(t,e){e.length&&this.writeMessage(t,Ou,e)},writePackedBoolean:function(t,e){e.length&&this.writeMessage(t,Ru,e)},writePackedFloat:function(t,e){e.length&&this.writeMessage(t,Pu,e)},writePackedDouble:function(t,e){e.length&&this.writeMessage(t,Du,e)},writePackedFixed32:function(t,e){e.length&&this.writeMessage(t,Nu,e)},writePackedSFixed32:function(t,e){e.length&&this.writeMessage(t,Lu,e)},writePackedFixed64:function(t,e){e.length&&this.writeMessage(t,ju,e)},writePackedSFixed64:function(t,e){e.length&&this.writeMessage(t,zu,e)},writeBytesField:function(t,e){this.writeTag(t,Tu.Bytes),this.writeBytes(e)},writeFixed32Field:function(t,e){this.writeTag(t,Tu.Fixed32),this.writeFixed32(e)},writeSFixed32Field:function(t,e){this.writeTag(t,Tu.Fixed32),this.writeSFixed32(e)},writeFixed64Field:function(t,e){this.writeTag(t,Tu.Fixed64),this.writeFixed64(e)},writeSFixed64Field:function(t,e){this.writeTag(t,Tu.Fixed64),this.writeSFixed64(e)},writeVarintField:function(t,e){this.writeTag(t,Tu.Varint),this.writeVarint(e)},writeSVarintField:function(t,e){this.writeTag(t,Tu.Varint),this.writeSVarint(e)},writeStringField:function(t,e){this.writeTag(t,Tu.Bytes),this.writeString(e)},writeFloatField:function(t,e){this.writeTag(t,Tu.Fixed32),this.writeFloat(e)},writeDoubleField:function(t,e){this.writeTag(t,Tu.Fixed64),this.writeDouble(e)},writeBooleanField:function(t,e){this.writeVarintField(t,Boolean(e))}};class Wu{constructor(t,{pixelRatio:e,version:n,stretchX:r,stretchY:i,content:o}){this.paddedRect=t,this.pixelRatio=e,this.stretchX=r,this.stretchY=i,this.content=o,this.version=n}get tl(){return[this.paddedRect.x+1,this.paddedRect.y+1]}get br(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]}get displaySize(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]}}class Hu{constructor(t,e){const n={},r={};this.haveRenderCallbacks=[];const i=[];this.addImages(t,n,i),this.addImages(e,r,i);const{w:o,h:s}=$u(i),a=new Mc({width:o||1,height:s||1});for(const c in t){const e=t[c],r=n[c].paddedRect;Mc.copy(e.data,a,{x:0,y:0},{x:r.x+1,y:r.y+1},e.data)}for(const c in e){const t=e[c],n=r[c].paddedRect,i=n.x+1,o=n.y+1,s=t.data.width,l=t.data.height;Mc.copy(t.data,a,{x:0,y:0},{x:i,y:o},t.data),Mc.copy(t.data,a,{x:0,y:l-1},{x:i,y:o-1},{width:s,height:1}),Mc.copy(t.data,a,{x:0,y:0},{x:i,y:o+l},{width:s,height:1}),Mc.copy(t.data,a,{x:s-1,y:0},{x:i-1,y:o},{width:1,height:l}),Mc.copy(t.data,a,{x:0,y:0},{x:i+s,y:o},{width:1,height:l})}this.image=a,this.iconPositions=n,this.patternPositions=r}addImages(t,e,n){for(const r in t){const i=t[r],o={x:0,y:0,w:i.data.width+2,h:i.data.height+2};n.push(o),e[r]=new Wu(o,i),i.hasRenderCallback&&this.haveRenderCallbacks.push(r)}}patchUpdatedImages(t,e){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(e=>t.hasImage(e)),t.dispatchRenderCallbacks(this.haveRenderCallbacks);for(const n in t.updatedImages)this.patchUpdatedImage(this.iconPositions[n],t.getImage(n),e),this.patchUpdatedImage(this.patternPositions[n],t.getImage(n),e)}patchUpdatedImage(t,e,n){if(!t||!e)return;if(t.version===e.version)return;t.version=e.version;const[r,i]=t.tl;n.update(e.data,void 0,{x:r,y:i})}}si(Wu,"ImagePosition"),si(Hu,"ImageAtlas");const Zu={horizontal:1,vertical:2,horizontalOnly:3};class Ku{constructor(){this.scale=1,this.fontStack="",this.imageName=null}static forText(t,e){const n=new Ku;return n.scale=t||1,n.fontStack=e,n}static forImage(t){const e=new Ku;return e.imageName=t,e}}class Xu{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,e){const n=new Xu;for(let r=0;r<t.sections.length;r++){const i=t.sections[r];i.image?n.addImageSection(i):n.addTextSection(i,e)}return n}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCharCode(t){return this.text.charCodeAt(t)}verticalizePunctuation(t){this.text=function(t,e){let n="";for(let r=0;r<t.length;r++){const i=t.charCodeAt(r+1)||null,o=t.charCodeAt(r-1)||null;n+=!e&&(i&&qi(i)&&!_u[t[r+1]]||o&&qi(o)&&!_u[t[r-1]])||!_u[t[r]]?t[r]:_u[t[r]]}return n}(this.text,t)}trim(){let t=0;for(let n=0;n<this.text.length&&Qu[this.text.charCodeAt(n)];n++)t++;let e=this.text.length;for(let n=this.text.length-1;n>=0&&n>=t&&Qu[this.text.charCodeAt(n)];n--)e--;this.text=this.text.substring(t,e),this.sectionIndex=this.sectionIndex.slice(t,e)}substring(t,e){const n=new Xu;return n.text=this.text.substring(t,e),n.sectionIndex=this.sectionIndex.slice(t,e),n.sections=this.sections,n}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,e)=>Math.max(t,this.sections[e].scale),0)}addTextSection(t,e){this.text+=t.text,this.sections.push(Ku.forText(t.scale,t.fontStack||e));const n=this.sections.length-1;for(let r=0;r<t.text.length;++r)this.sectionIndex.push(n)}addImageSection(t){const e=t.image?t.image.name:"";if(0===e.length)return void P("Can't add FormattedSection with an empty image.");const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCharCode(n),this.sections.push(Ku.forImage(e)),this.sectionIndex.push(this.sections.length-1)):P("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Yu(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m){const g=Xu.fromFeature(t,i);let _;h===Zu.vertical&&g.verticalizePunctuation(d);const{processBidirectionalText:y,processStyledBidirectionalText:v}=io;if(y&&1===g.sections.length){_=[];const t=y(g.toString(),oh(g,l,o,e,r,p,f));for(const e of t){const t=new Xu;t.text=e,t.sections=g.sections;for(let n=0;n<e.length;n++)t.sectionIndex.push(0);_.push(t)}}else if(v){_=[];const t=v(g.text,g.sectionIndex,oh(g,l,o,e,r,p,f));for(const e of t){const t=new Xu;t.text=e[0],t.sectionIndex=e[1],t.sections=g.sections,_.push(t)}}else _=function(t,e){const n=[],r=t.text;let i=0;for(const o of e)n.push(t.substring(i,o)),i=o;return i<r.length&&n.push(t.substring(i,r.length)),n}(g,oh(g,l,o,e,r,p,f));const b=[],x={positionedLines:b,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:h,iconsInText:!1,verticalizable:!1,hasBaseline:!1};return function(t,e,n,r,i,o,s,a,c,l,u,h){let d=0,p=0,f=0;const m="right"===a?1:"left"===a?0:.5;let g=!1;for(const w of i){const t=w.getSections();for(const n of t){if(n.imageName)continue;const t=e[n.fontStack];if(t&&(g=void 0!==t.ascender&&void 0!==t.descender,!g))break}if(!g)break}let _=0;for(const w of i){w.trim();const i=w.getMaxScale(),s=(i-1)*uu,a={positionedGlyphs:[],lineOffset:0};t.positionedLines[_]=a;const v=a.positionedGlyphs;let b=0;if(!w.length()){p+=o,++_;continue}let x=0,T=0;for(let o=0;o<w.length();o++){const s=w.getSection(o),a=w.getSectionIndex(o),f=w.getCharCode(o);let m=s.scale,_=null,C=null,E=null,S=uu,I=0;const k=!(c===Zu.horizontal||!u&&!Vi(f)||u&&(Qu[f]||(y=f,di(y)||pi(y)||fi(y)||Di(y)||ji(y))));if(s.imageName){const e=r[s.imageName];if(!e)continue;E=s.imageName,t.iconsInText=t.iconsInText||!0,C=e.paddedRect;const n=e.displaySize;m=m*uu/h,_={width:n[0],height:n[1],left:1,top:-3,advance:k?n[1]:n[0],localGlyph:!1},I=g?-_.height*m:i*uu-17-n[1]*m,S=_.advance;const o=(k?n[0]:n[1])*m-uu*i;o>0&&o>b&&(b=o)}else{const t=n[s.fontStack];if(!t)continue;t[f]&&(C=t[f]);const r=e[s.fontStack];if(!r)continue;const o=r.glyphs[f];if(!o)continue;if(_=o.metrics,S=8203!==f?uu:0,g){const t=void 0!==r.ascender?Math.abs(r.ascender):0,e=void 0!==r.descender?Math.abs(r.descender):0,n=(t+e)*m;x<n&&(x=n,T=(t-e)/2*m),I=-t*m}else I=(i-m)*uu-17}k?(t.verticalizable=!0,v.push({glyph:f,imageName:E,x:d,y:p+I,vertical:k,scale:m,localGlyph:_.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:_,rect:C}),d+=S*m+l):(v.push({glyph:f,imageName:E,x:d,y:p+I,vertical:k,scale:m,localGlyph:_.localGlyph,fontStack:s.fontStack,sectionIndex:a,metrics:_,rect:C}),d+=_.advance*m+l)}0!==v.length&&(f=Math.max(d-l,f),g?ah(v,m,b,T,o*i/2):ah(v,m,b,0,o/2)),d=0;const C=o*i+b;a.lineOffset=Math.max(b,s),p+=C,++_}var y;const v=p,{horizontalAlign:b,verticalAlign:x}=sh(s);(function(t,e,n,r,i,o){const s=(e-n)*i,a=-o*r;for(const c of t)for(const t of c.positionedGlyphs)t.x+=s,t.y+=a})(t.positionedLines,m,b,x,f,v),t.top+=-x*v,t.bottom=t.top+v,t.left+=-b*f,t.right=t.left+f,t.hasBaseline=g}(x,e,n,r,_,s,a,c,h,l,d,m),!function(t){for(const e of t)if(0!==e.positionedGlyphs.length)return!1;return!0}(b)&&x}const Qu={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Ju={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function th(t,e,n,r,i,o){if(e.imageName){const t=r[e.imageName];return t?t.displaySize[0]*e.scale*uu/o+i:0}{const r=n[e.fontStack],o=r&&r.glyphs[t];return o?o.metrics.advance*e.scale+i:0}}function eh(t,e,n,r){const i=Math.pow(t-e,2);return r?t<e?i/2:2*i:i+Math.abs(n)*n}function nh(t,e,n){let r=0;return 10===t&&(r-=1e4),n&&(r+=150),40!==t&&65288!==t||(r+=50),41!==e&&65289!==e||(r+=50),r}function rh(t,e,n,r,i,o){let s=null,a=eh(e,n,i,o);for(const c of r){const t=eh(e-c.x,n,i,o)+c.badness;t<=a&&(s=c,a=t)}return{index:t,x:e,priorBreak:s,badness:a}}function ih(t){return t?ih(t.priorBreak).concat(t.index):[]}function oh(t,e,n,r,i,o,s){if("point"!==o)return[];if(!t)return[];const a=[],c=function(t,e,n,r,i,o){let s=0;for(let a=0;a<t.length();a++){const n=t.getSection(a);s+=th(t.getCharCode(a),n,r,i,e,o)}return s/Math.max(1,Math.ceil(s/n))}(t,e,n,r,i,s),l=t.text.indexOf("\u200b")>=0;let u=0;for(let d=0;d<t.length();d++){const n=t.getSection(d),o=t.getCharCode(d);if(Qu[o]||(u+=th(o,n,r,i,e,s)),d<t.length()-1){const e=!((h=o)<11904||!(wi(h)||xi(h)||Ni(h)||Pi(h)||Si(h)||mi(h)||Ti(h)||yi(h)||Ii(h)||ki(h)||Ei(h)||zi(h)||vi(h)||_i(h)||gi(h)||Ci(h)||bi(h)||Ri(h)||Mi(h)||Ai(h)));(Ju[o]||e||n.imageName)&&a.push(rh(d+1,u,c,a,nh(o,t.getCharCode(d+1),e&&l),!1))}}var h;return ih(rh(t.length(),u,c,a,0,!0))}function sh(t){let e=.5,n=.5;switch(t){case"right":case"top-right":case"bottom-right":e=1;break;case"left":case"top-left":case"bottom-left":e=0}switch(t){case"bottom":case"bottom-right":case"bottom-left":n=1;break;case"top":case"top-right":case"top-left":n=0}return{horizontalAlign:e,verticalAlign:n}}function ah(t,e,n,r,i){if(!(e||n||r||i))return;const o=t.length-1,s=t[o],a=(s.x+s.metrics.advance*s.scale)*e;for(let c=0;c<=o;c++)t[c].x-=a,t[c].y+=n+r+i}function ch(t,e,n){const{horizontalAlign:r,verticalAlign:i}=sh(n),o=e[0]-t.displaySize[0]*r,s=e[1]-t.displaySize[1]*i;return{image:t,top:s,bottom:s+t.displaySize[1],left:o,right:o+t.displaySize[0]}}function lh(t,e,n,r,i,o){const s=t.image;let a;if(s.content){const t=s.content,e=s.pixelRatio||1;a=[t[0]/e,t[1]/e,s.displaySize[0]-t[2]/e,s.displaySize[1]-t[3]/e]}const c=e.left*o,l=e.right*o;let u,h,d,p;"width"===n||"both"===n?(p=i[0]+c-r[3],h=i[0]+l+r[1]):(p=i[0]+(c+l-s.displaySize[0])/2,h=p+s.displaySize[0]);const f=e.top*o,m=e.bottom*o;return"height"===n||"both"===n?(u=i[1]+f-r[0],d=i[1]+m+r[2]):(u=i[1]+(f+m-s.displaySize[1])/2,d=u+s.displaySize[1]),{image:s,top:u,right:h,bottom:d,left:p,collisionPadding:a}}class uh extends i{constructor(t,e,n,r,i){super(t,e),this.angle=r,this.z=n,void 0!==i&&(this.segment=i)}clone(){return new uh(this.x,this.y,this.z,this.angle,this.segment)}}function hh(t,e,n,r,i){if(void 0===e.segment)return!0;let o=e,s=e.segment+1,a=0;for(;a>-n/2;){if(s--,s<0)return!1;a-=t[s].dist(o),o=t[s]}a+=t[s].dist(t[s+1]),s++;const c=[];let l=0;for(;a<n/2;){const e=t[s],n=t[s+1];if(!n)return!1;let o=t[s-1].angleTo(e)-e.angleTo(n);for(o=Math.abs((o+3*Math.PI)%(2*Math.PI)-Math.PI),c.push({distance:a,angleDelta:o}),l+=o;a-c[0].distance>r;)l-=c.shift().angleDelta;if(l>i)return!1;s++,a+=e.dist(n)}return!0}function dh(t){let e=0;for(let n=0;n<t.length-1;n++)e+=t[n].dist(t[n+1]);return e}function ph(t,e,n){return t?.6*e*n:0}function fh(t,e){return Math.max(t?t.right-t.left:0,e?e.right-e.left:0)}function mh(t,e,n,r,i,o){const s=ph(n,i,o),a=fh(n,r)*o;let c=0;const l=dh(t)/2;for(let u=0;u<t.length-1;u++){const n=t[u],r=t[u+1],i=n.dist(r);if(c+i>l){const o=(l-c)/i,h=nn(n.x,r.x,o),d=nn(n.y,r.y,o),p=new uh(h,d,0,r.angleTo(n),u);return!s||hh(t,p,a,s,e)?p:void 0}c+=i}}function gh(t,e,n,r,i,o,s,a,c){const l=ph(r,o,s),u=fh(r,i),h=u*s,d=0===t[0].x||t[0].x===c||0===t[0].y||t[0].y===c;return e-h<e/4&&(e=h+e/4),_h(t,d?e/2*a%e:(u/2+2*o)*s*a%e,e,l,n,h,d,!1,c)}function _h(t,e,n,r,i,o,s,a,c){const l=o/2,u=dh(t);let h=0,d=e-n,p=[];for(let f=0;f<t.length-1;f++){const e=t[f],s=t[f+1],a=e.dist(s),m=s.angleTo(e);for(;d+n<h+a;){d+=n;const g=(d-h)/a,_=nn(e.x,s.x,g),y=nn(e.y,s.y,g);if(_>=0&&_<c&&y>=0&&y<c&&d-l>=0&&d+l<=u){const e=new uh(_,y,0,m,f);e._round(),r&&!hh(t,e,o,r,i)||p.push(e)}}h+=a}return a||p.length||s||(p=_h(t,h/2,n,r,i,o,s,!0,c)),p}function yh(t,e,n,r,o){const s=[];for(let a=0;a<t.length;a++){const c=t[a];let l;for(let t=0;t<c.length-1;t++){let a=c[t],u=c[t+1];a.x<e&&u.x<e||(a.x<e?a=new i(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x<e&&(u=new i(e,a.y+(e-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y<n&&u.y<n||(a.y<n?a=new i(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round():u.y<n&&(u=new i(a.x+(n-a.y)/(u.y-a.y)*(u.x-a.x),n)._round()),a.x>=r&&u.x>=r||(a.x>=r?a=new i(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round():u.x>=r&&(u=new i(r,a.y+(r-a.x)/(u.x-a.x)*(u.y-a.y))._round()),a.y>=o&&u.y>=o||(a.y>=o?a=new i(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round():u.y>=o&&(u=new i(a.x+(o-a.y)/(u.y-a.y)*(u.x-a.x),o)._round()),l&&a.equals(l[l.length-1])||(l=[a],s.push(l)),l.push(u)))))}}return s}si(uh,"Anchor");const vh=1e20;function bh(t,e,n,r,i,o,s,a,c){for(let l=e;l<e+r;l++)xh(t,n*o+l,o,i,s,a,c);for(let l=n;l<n+i;l++)xh(t,l*o+e,1,r,s,a,c)}function xh(t,e,n,r,i,o,s){o[0]=0,s[0]=-vh,s[1]=vh,i[0]=t[e];for(let a=1,c=0,l=0;a<r;a++){i[a]=t[e+a*n];const r=a*a;do{const t=o[c];l=(i[a]-i[t]+r-t*t)/(a-t)/2}while(l<=s[c]&&--c>-1);c++,o[c]=a,s[c]=l,s[c+1]=vh}for(let a=0,c=0;a<r;a++){for(;s[c+1]<a;)c++;const r=o[c],l=a-r;t[e+a*n]=i[r]+l*l}}const wh={none:0,ideographs:1,all:2};class Th{constructor(t,e,n){this.requestManager=t,this.localGlyphMode=e,this.localFontFamily=n,this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,e){const n=[];for(const r in t)for(const e of t[r])n.push({stack:r,id:e});y(n,({stack:t,id:e},n)=>{let r=this.entries[t];r||(r=this.entries[t]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let i=r.glyphs[e];if(void 0!==i)return void n(null,{stack:t,id:e,glyph:i});if(i=this._tinySDF(r,t,e),i)return r.glyphs[e]=i,void n(null,{stack:t,id:e,glyph:i});const o=Math.floor(e/256);if(256*o>65535)return void n(new Error("glyphs > 65535 not supported"));if(r.ranges[o])return void n(null,{stack:t,id:e,glyph:i});let s=r.requests[o];s||(s=r.requests[o]=[],Th.loadGlyphRange(t,o,this.url,this.requestManager,(t,e)=>{if(e){r.ascender=e.ascender,r.descender=e.descender;for(const t in e.glyphs)this._doesCharSupportLocalGlyph(+t)||(r.glyphs[+t]=e.glyphs[+t]);r.ranges[o]=!0}for(const n of s)n(t,e);delete r.requests[o]})),s.push((r,i)=>{r?n(r):i&&n(null,{stack:t,id:e,glyph:i.glyphs[e]||null})})},(t,n)=>{if(t)e(t);else if(n){const t={};for(const{stack:e,id:r,glyph:i}of n)void 0===t[e]&&(t[e]={}),void 0===t[e].glyphs&&(t[e].glyphs={}),t[e].glyphs[r]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics},t[e].ascender=this.entries[e].ascender,t[e].descender=this.entries[e].descender;e(null,t)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==wh.none&&(this.localGlyphMode===wh.all?!!this.localFontFamily:!!this.localFontFamily&&(ki(t)||Oi(t)||vi(t)||bi(t)||yi(t)))}_tinySDF(t,e,n){const r=this.localFontFamily;if(!r||!this._doesCharSupportLocalGlyph(n))return;let i=t.tinySDF;if(!i){let n="400";/bold/i.test(e)?n="900":/medium/i.test(e)?n="500":/light/i.test(e)&&(n="200"),i=t.tinySDF=new Th.TinySDF({fontFamily:r,fontWeight:n,fontSize:48,buffer:6,radius:16}),i.fontWeight=n}if(this.localGlyphs[i.fontWeight][n])return this.localGlyphs[i.fontWeight][n];const o=String.fromCharCode(n),{data:s,width:a,height:c,glyphWidth:l,glyphHeight:u,glyphLeft:h,glyphTop:d,glyphAdvance:p}=i.draw(o);return this.localGlyphs[i.fontWeight][n]={id:n,bitmap:new Ac({width:a,height:c},s),metrics:{width:l/2,height:u/2,left:h/2,top:d/2-27,advance:p/2,localGlyph:!0}}}}function Ch(t,e,n,r){const o=[],s=t.image,a=s.pixelRatio,c=s.paddedRect.w-2,l=s.paddedRect.h-2,u=t.right-t.left,h=t.bottom-t.top,d=s.stretchX||[[0,c]],p=s.stretchY||[[0,l]],f=(t,e)=>t+e[1]-e[0],m=d.reduce(f,0),g=p.reduce(f,0),_=c-m,y=l-g;let v=0,b=m,x=0,w=g,T=0,C=_,E=0,S=y;if(s.content&&r){const t=s.content;v=Eh(d,0,t[0]),x=Eh(p,0,t[1]),b=Eh(d,t[0],t[2]),w=Eh(p,t[1],t[3]),T=t[0]-v,E=t[1]-x,C=t[2]-t[0]-b,S=t[3]-t[1]-w}const I=(r,o,c,l)=>{const d=Ih(r.stretch-v,b,u,t.left),p=kh(r.fixed-T,C,r.stretch,m),f=Ih(o.stretch-x,w,h,t.top),_=kh(o.fixed-E,S,o.stretch,g),y=Ih(c.stretch-v,b,u,t.left),I=kh(c.fixed-T,C,c.stretch,m),k=Ih(l.stretch-x,w,h,t.top),A=kh(l.fixed-E,S,l.stretch,g),M=new i(d,f),O=new i(y,f),P=new i(y,k),D=new i(d,k),R=new i(p/a,_/a),N=new i(I/a,A/a),L=e*Math.PI/180;if(L){const t=Math.sin(L),e=Math.cos(L),n=[e,-t,t,e];M._matMult(n),O._matMult(n),D._matMult(n),P._matMult(n)}const j=r.stretch+r.fixed,z=o.stretch+o.fixed;return{tl:M,tr:O,bl:D,br:P,tex:{x:s.paddedRect.x+1+j,y:s.paddedRect.y+1+z,w:c.stretch+c.fixed-j,h:l.stretch+l.fixed-z},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:R,pixelOffsetBR:N,minFontScaleX:C/a/u,minFontScaleY:S/a/h,isSDF:n}};if(r&&(s.stretchX||s.stretchY)){const t=Sh(d,_,m),e=Sh(p,y,g);for(let n=0;n<t.length-1;n++){const r=t[n],i=t[n+1];for(let t=0;t<e.length-1;t++)o.push(I(r,e[t],i,e[t+1]))}}else o.push(I({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:c+1},{fixed:0,stretch:l+1}));return o}function Eh(t,e,n){let r=0;for(const i of t)r+=Math.max(e,Math.min(n,i[1]))-Math.max(e,Math.min(n,i[0]));return r}function Sh(t,e,n){const r=[{fixed:-1,stretch:0}];for(const[i,o]of t){const t=r[r.length-1];r.push({fixed:i-t.stretch,stretch:t.stretch}),r.push({fixed:i-t.stretch,stretch:t.stretch+(o-i)})}return r.push({fixed:e+1,stretch:n}),r}function Ih(t,e,n,r){return t/e*n+r}function kh(t,e,n,r){return t-e*n/r}function Ah(t,e,n,r){const i=e+t.positionedLines[r].lineOffset;return 0===r?n+i/2:n+(i+(e+t.positionedLines[r-1].lineOffset))/2}Th.loadGlyphRange=function(t,e,n,r,i){const o=256*e,s=o+255,a=r.transformRequest(r.normalizeGlyphsURL(n).replace("{fontstack}",t).replace("{range}",`${o}-${s}`),Tt.Glyphs);It(a,(t,e)=>{if(t)i(t);else if(e){const t={},n=function(t){return new wu(t).readFields(Vu,{})}(e);for(const e of n.glyphs)t[e.id]=e;i(null,{glyphs:t,ascender:n.ascender,descender:n.descender})}})},Th.TinySDF=class{constructor({fontSize:t=24,buffer:e=3,radius:n=8,cutoff:r=.25,fontFamily:i="sans-serif",fontWeight:o="normal",fontStyle:s="normal"}){this.buffer=e,this.cutoff=r,this.radius=n;const a=this.size=t+4*e,c=this._createCanvas(a),l=this.ctx=c.getContext("2d",{willReadFrequently:!0});l.font=`${s} ${o} ${t}px ${i}`,l.textBaseline="alphabetic",l.textAlign="left",l.fillStyle="black",this.gridOuter=new Float64Array(a*a),this.gridInner=new Float64Array(a*a),this.f=new Float64Array(a),this.z=new Float64Array(a+1),this.v=new Uint16Array(a)}_createCanvas(t){const e=document.createElement("canvas");return e.width=e.height=t,e}draw(t){const{width:e,actualBoundingBoxAscent:n,actualBoundingBoxDescent:r,actualBoundingBoxLeft:i,actualBoundingBoxRight:o}=this.ctx.measureText(t),s=Math.floor(n),a=Math.min(this.size-this.buffer,Math.ceil(o-i)),c=Math.min(this.size-this.buffer,Math.ceil(n)+Math.ceil(r)),l=a+2*this.buffer,u=c+2*this.buffer,h=l*u,d=new Uint8ClampedArray(h),p={data:d,width:l,height:u,glyphWidth:a,glyphHeight:c,glyphTop:s,glyphLeft:0,glyphAdvance:e};if(0===a||0===c)return p;const{ctx:f,buffer:m,gridInner:g,gridOuter:_}=this;f.clearRect(m,m,a,c),f.fillText(t,m,m+s+1);const y=f.getImageData(m,m,a,c);_.fill(vh,0,h),g.fill(0,0,h);for(let v=0;v<c;v++)for(let t=0;t<a;t++){const e=y.data[4*(v*a+t)+3]/255;if(0===e)continue;const n=(v+m)*l+t+m;if(1===e)_[n]=0,g[n]=vh;else{const t=.5-e;_[n]=t>0?t*t:0,g[n]=t<0?t*t:0}}bh(_,0,0,l,u,l,this.f,this.v,this.z),bh(g,m,m,a,c,l,this.f,this.v,this.z);for(let v=0;v<h;v++){const t=Math.sqrt(_[v])-Math.sqrt(g[v]);d[v]=Math.round(255-255*(t/this.radius+this.cutoff))}return p}};class Mh{constructor(t=[],e=Oh){if(this.data=t,this.length=this.data.length,this.compare=e,this.length>0)for(let n=(this.length>>1)-1;n>=0;n--)this._down(n)}push(t){this.data.push(t),this.length++,this._up(this.length-1)}pop(){if(0===this.length)return;const t=this.data[0],e=this.data.pop();return this.length--,this.length>0&&(this.data[0]=e,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:e,compare:n}=this,r=e[t];for(;t>0;){const i=t-1>>1,o=e[i];if(n(r,o)>=0)break;e[t]=o,t=i}e[t]=r}_down(t){const{data:e,compare:n}=this,r=this.length>>1,i=e[t];for(;t<r;){let r=1+(t<<1),o=e[r];const s=r+1;if(s<this.length&&n(e[s],o)<0&&(r=s,o=e[s]),n(o,i)>=0)break;e[t]=o,t=r}e[t]=i}}function Oh(t,e){return t<e?-1:t>e?1:0}function Ph(t,e=1,n=!1){let r=1/0,o=1/0,s=-1/0,a=-1/0;const c=t[0];for(let i=0;i<c.length;i++){const t=c[i];(!i||t.x<r)&&(r=t.x),(!i||t.y<o)&&(o=t.y),(!i||t.x>s)&&(s=t.x),(!i||t.y>a)&&(a=t.y)}const l=Math.min(s-r,a-o);let u=l/2;const h=new Mh([],Dh);if(0===l)return new i(r,o);for(let i=r;i<s;i+=l)for(let e=o;e<a;e+=l)h.push(new Rh(i+u,e+u,u,t));let d=function(t){let e=0,n=0,r=0;const i=t[0];for(let o=0,s=i.length,a=s-1;o<s;a=o++){const t=i[o],s=i[a],c=t.x*s.y-s.x*t.y;n+=(t.x+s.x)*c,r+=(t.y+s.y)*c,e+=3*c}return new Rh(n/e,r/e,0,t)}(t),p=h.length;for(;h.length;){const r=h.pop();(r.d>d.d||!d.d)&&(d=r,n&&console.log("found best %d after %d probes",Math.round(1e4*r.d)/1e4,p)),r.max-d.d<=e||(u=r.h/2,h.push(new Rh(r.p.x-u,r.p.y-u,u,t)),h.push(new Rh(r.p.x+u,r.p.y-u,u,t)),h.push(new Rh(r.p.x-u,r.p.y+u,u,t)),h.push(new Rh(r.p.x+u,r.p.y+u,u,t)),p+=4)}return n&&(console.log(`num probes: ${p}`),console.log(`best distance: ${d.d}`)),d.p}function Dh(t,e){return e.max-t.max}function Rh(t,e,n,r){this.p=new i(t,e),this.h=n,this.d=function(t,e){let n=!1,r=1/0;for(let i=0;i<e.length;i++){const o=e[i];for(let e=0,i=o.length,s=i-1;e<i;s=e++){const i=o[e],a=o[s];i.y>t.y!=a.y>t.y&&t.x<(a.x-i.x)*(t.y-i.y)/(a.y-i.y)+i.x&&(n=!n),r=Math.min(r,Ia(t,i,a))}}return(n?1:-1)*Math.sqrt(r)}(this.p,r),this.max=this.d+this.h*Math.SQRT2}const Nh=Number.POSITIVE_INFINITY,Lh=Math.sqrt(2);function jh(t,e){return e[1]!==Nh?function(t,e,n){let r=0,i=0;switch(e=Math.abs(e),n=Math.abs(n),t){case"top-right":case"top-left":case"top":i=n-7;break;case"bottom-right":case"bottom-left":case"bottom":i=7-n}switch(t){case"top-right":case"bottom-right":case"right":r=-e;break;case"top-left":case"bottom-left":case"left":r=e}return[r,i]}(t,e[0],e[1]):function(t,e){let n=0,r=0;e<0&&(e=0);const i=e/Lh;switch(t){case"top-right":case"top-left":r=i-7;break;case"bottom-right":case"bottom-left":r=7-i;break;case"bottom":r=7-e;break;case"top":r=e-7}switch(t){case"top-right":case"bottom-right":n=-i;break;case"top-left":case"bottom-left":n=i;break;case"left":n=e;break;case"right":n=-e}return[n,r]}(t,e[0])}function zh(t,e,n,r,i,o,s,a,c,l){t.createArrays(),t.tilePixelRatio=Xs/(512*t.overscaling),t.compareText={},t.iconsNeedLinear=!1;const u=t.layers[0].layout,h=t.layers[0]._unevaluatedLayout._values,d={};if("composite"===t.textSizeData.kind){const{minZoom:e,maxZoom:n}=t.textSizeData;d.compositeTextSizes=[h["text-size"].possiblyEvaluate(new oo(e),a),h["text-size"].possiblyEvaluate(new oo(n),a)]}if("composite"===t.iconSizeData.kind){const{minZoom:e,maxZoom:n}=t.iconSizeData;d.compositeIconSizes=[h["icon-size"].possiblyEvaluate(new oo(e),a),h["icon-size"].possiblyEvaluate(new oo(n),a)]}d.layoutTextSize=h["text-size"].possiblyEvaluate(new oo(c+1),a),d.layoutIconSize=h["icon-size"].possiblyEvaluate(new oo(c+1),a),d.textMaxSize=h["text-size"].possiblyEvaluate(new oo(18),a);const p="map"===u.get("text-rotation-alignment")&&"point"!==u.get("symbol-placement"),f=u.get("text-size");for(const m of t.features){const o=u.get("text-font").evaluate(m,{},a).join(","),c=f.evaluate(m,{},a),h=d.layoutTextSize.evaluate(m,{},a),g=(d.layoutIconSize.evaluate(m,{},a),{horizontal:{},vertical:void 0}),_=m.text;let y,v=[0,0];if(_){const r=_.toString(),s=u.get("text-letter-spacing").evaluate(m,{},a)*uu,l=u.get("text-line-height").evaluate(m,{},a)*uu,d=Bi(r)?s:0,f=u.get("text-anchor").evaluate(m,{},a),y=u.get("text-variable-anchor");if(!y){const t=u.get("text-radial-offset").evaluate(m,{},a);v=t?jh(f,[t*uu,Nh]):u.get("text-offset").evaluate(m,{},a).map(t=>t*uu)}let b=p?"center":u.get("text-justify").evaluate(m,{},a);const x=u.get("symbol-placement"),w="point"===x,T="point"===x?u.get("text-max-width").evaluate(m,{},a)*uu:0,C=s=>{t.allowVerticalPlacement&&Fi(r)&&(g.vertical=Yu(_,e,n,i,o,T,l,f,s,d,v,Zu.vertical,!0,x,h,c))};if(!p&&y){const t="auto"===b?y.map(t=>Fh(t)):[b];let r=!1;for(let s=0;s<t.length;s++){const a=t[s];if(!g.horizontal[a])if(r)g.horizontal[a]=g.horizontal[0];else{const t=Yu(_,e,n,i,o,T,l,"center",a,d,v,Zu.horizontal,!1,x,h,c);t&&(g.horizontal[a]=t,r=1===t.positionedLines.length)}}C("left")}else{if("auto"===b&&(b=Fh(f)),w||u.get("text-writing-mode").indexOf("horizontal")>=0||!Fi(r)){const t=Yu(_,e,n,i,o,T,l,f,b,d,v,Zu.horizontal,!1,x,h,c);t&&(g.horizontal[b]=t)}C("point"===x?"left":b)}}let b=!1;if(m.icon&&m.icon.name){const e=r[m.icon.name];e&&(y=ch(i[m.icon.name],u.get("icon-offset").evaluate(m,{},a),u.get("icon-anchor").evaluate(m,{},a)),b=e.sdf,void 0===t.sdfIcons?t.sdfIcons=e.sdf:t.sdfIcons!==e.sdf&&P("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(e.pixelRatio!==t.pixelRatio||0!==u.get("icon-rotate").constantOr(1))&&(t.iconsNeedLinear=!0))}const x=qh(g.horizontal)||g.vertical;t.iconsInText||(t.iconsInText=!!x&&x.iconsInText),(x||y)&&Bh(t,m,g,y,r,d,h,0,v,b,s,a,l)}o&&t.generateCollisionDebugBuffers(c,t.collisionBoxArray)}function Fh(t){switch(t){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function Bh(t,e,n,r,i,o,s,a,c,u,h,d,p){let f=o.textMaxSize.evaluate(e,{},d);void 0===f&&(f=s);const m=t.layers[0].layout,g=m.get("icon-offset").evaluate(e,{},d),_=qh(n.horizontal)||n.vertical,y=s/24,v=t.tilePixelRatio*f/24,b=(k=t.overscaling,t.zoom>18&&k>2&&(k>>=1),Math.max(Xs/(512*k),1)*m.get("symbol-spacing")),x=m.get("text-padding")*t.tilePixelRatio,w=m.get("icon-padding")*t.tilePixelRatio,T=l(m.get("text-max-angle")),C="map"===m.get("text-rotation-alignment")&&"point"!==m.get("symbol-placement"),E="map"===m.get("icon-rotation-alignment")&&"point"!==m.get("symbol-placement"),S=m.get("symbol-placement"),I=b/2;var k;const A=m.get("icon-text-fit");let M;r&&"none"!==A&&(t.allowVerticalPlacement&&n.vertical&&(M=lh(r,n.vertical,A,m.get("icon-text-fit-padding"),g,y)),_&&(r=lh(r,_,A,m.get("icon-text-fit-padding"),g,y)));const O=(s,a,l)=>{if(a.x<0||a.x>=Xs||a.y<0||a.y>=Xs)return;const{x:f,y:m,z:_}=p.projectTilePoint(a.x,a.y,l),y=new uh(f,m,_,0,void 0);!function(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g,_,y,v,b,x,w,T,C){const E=t.addToLineVertexArray(e,r);let S,I,k,A,M,O,D,R=0,N=0,L=0,j=0,z=-1,F=-1;const B={};let U=vs(""),V=0,q=0;if(void 0===c._unevaluatedLayout.getValue("text-radial-offset")?[V,q]=c.layout.get("text-offset").evaluate(b,{},C).map(t=>t*uu):(V=c.layout.get("text-radial-offset").evaluate(b,{},C)*uu,q=Nh),t.allowVerticalPlacement&&i.vertical){const t=i.vertical;if(f)O=$h(t),a&&(D=$h(a));else{const r=c.layout.get("text-rotate").evaluate(b,{},C)+90;k=Gh(l,n,e,u,h,d,t,p,r,m),a&&(A=Gh(l,n,e,u,h,d,a,_,r))}}if(o){const r=c.layout.get("icon-rotate").evaluate(b,{},C),i="none"!==c.layout.get("icon-text-fit"),s=Ch(o,r,w,i),p=a?Ch(a,r,w,i):void 0;I=Gh(l,n,e,u,h,d,o,_,r),R=4*s.length;const f=t.iconSizeData;let m=null;"source"===f.kind?(m=[hu*c.layout.get("icon-size").evaluate(b,{},C)],m[0]>Uh&&P(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)):"composite"===f.kind&&(m=[hu*x.compositeIconSizes[0].evaluate(b,{},C),hu*x.compositeIconSizes[1].evaluate(b,{},C)],(m[0]>Uh||m[1]>Uh)&&P(`${t.layerIds[0]}: Value for "icon-size" is >= 255. Reduce your "icon-size".`)),t.addSymbols(t.icon,s,m,v,y,b,!1,n,e,E.lineStartIndex,E.lineLength,-1,T,C),z=t.icon.placedSymbolArray.length-1,p&&(N=4*p.length,t.addSymbols(t.icon,p,m,v,y,b,Zu.vertical,n,e,E.lineStartIndex,E.lineLength,-1,T,C),F=t.icon.placedSymbolArray.length-1)}for(const P in i.horizontal){const r=i.horizontal[P];S||(U=vs(r.text),f?M=$h(r):S=Gh(l,n,e,u,h,d,r,p,c.layout.get("text-rotate").evaluate(b,{},C),m));const o=1===r.positionedLines.length;if(L+=Vh(t,n,e,r,s,c,f,b,m,E,i.vertical?Zu.horizontal:Zu.horizontalOnly,o?Object.keys(i.horizontal):[P],B,z,x,T,C),o)break}i.vertical&&(j+=Vh(t,n,e,i.vertical,s,c,f,b,m,E,Zu.vertical,["vertical"],B,F,x,T,C));let G=-1;const $=(t,e)=>t?Math.max(t,e):e;G=$(M,G),G=$(O,G),G=$(D,G);const W=G>-1?1:0;t.glyphOffsetArray.length>=td.MAX_GLYPHS&&P("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==b.sortKey&&t.addToSortKeyRanges(t.symbolInstances.length,b.sortKey),t.symbolInstances.emplaceBack(n.x,n.y,n.z,e.x,e.y,B.right>=0?B.right:-1,B.center>=0?B.center:-1,B.left>=0?B.left:-1,B.vertical>=0?B.vertical:-1,z,F,U,void 0!==S?S:t.collisionBoxArray.length,void 0!==S?S+1:t.collisionBoxArray.length,void 0!==k?k:t.collisionBoxArray.length,void 0!==k?k+1:t.collisionBoxArray.length,void 0!==I?I:t.collisionBoxArray.length,void 0!==I?I+1:t.collisionBoxArray.length,A||t.collisionBoxArray.length,A?A+1:t.collisionBoxArray.length,u,L,j,R,N,W,0,V,q,G)}(t,a,y,s,n,r,i,M,t.layers[0],t.collisionBoxArray,e.index,e.sourceLayerIndex,t.index,x,C,c,0,w,E,g,e,o,u,h,d)};if("line"===S)for(const l of yh(e.geometry,0,0,Xs,Xs)){const e=gh(l,b,T,n.vertical||_,r,24,v,t.overscaling,Xs);for(const n of e){const e=_;e&&Wh(t,e.text,I,n)||O(l,n,d)}}else if("line-center"===S){for(const l of e.geometry)if(l.length>1){const t=mh(l,T,n.vertical||_,r,24,v);t&&O(l,t,d)}}else if("Polygon"===e.type)for(const l of fl(e.geometry,0)){const t=Ph(l,16);O(l[0],new uh(t.x,t.y,0,0,void 0),d)}else if("LineString"===e.type)for(const l of e.geometry)O(l,new uh(l[0].x,l[0].y,0,0,void 0),d);else if("Point"===e.type)for(const l of e.geometry)for(const t of l)O([t],new uh(t.x,t.y,0,0,void 0),d)}const Uh=32640;function Vh(t,e,n,r,o,s,a,c,l,u,h,d,p,f,m,g,_){const y=function(t,e,n,r,o,s,a,c){const l=[];if(0===e.positionedLines.length)return l;const u=r.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,h=function(t){const e=t[0],n=t[1],r=e*n;return r>0?[e,-n]:r<0?[-e,n]:0===e?[n,e]:[n,-e]}(n);let d=Math.abs(e.top-e.bottom);for(const i of e.positionedLines)d-=i.lineOffset;const p=e.positionedLines.length,f=d/p;let m=e.top-n[1];for(let g=0;g<p;++g){const t=e.positionedLines[g];m=Ah(e,f,m,g);for(const r of t.positionedGlyphs){if(!r.rect)continue;const t=r.rect||{};let s=4,d=!0,p=1,f=0;if(r.imageName){const t=a[r.imageName];if(!t)continue;if(t.sdf){P("SDF images are not supported in formatted text and will be ignored.");continue}d=!1,p=t.pixelRatio,s=1/p}const g=(o||c)&&r.vertical,_=r.metrics.advance*r.scale/2,y=r.metrics,v=r.rect;if(null===v)continue;c&&e.verticalizable&&(f=r.imageName?_-r.metrics.width*r.scale/2:0);const b=o?[r.x+_,r.y]:[0,0];let x=[0,0],w=[0,0],T=!1;o||(g?(w=[r.x+_+h[0],r.y+h[1]-f],T=!0):x=[r.x+_+n[0],r.y+n[1]-f]);const C=v.w*r.scale/(p*(r.localGlyph?2:1)),E=v.h*r.scale/(p*(r.localGlyph?2:1));let S,I,k,A;if(g){const t=r.y-m,e=new i(-_,_-t),n=-Math.PI/2,o=new i(...w);S=new i(-_+x[0],x[1]),S._rotateAround(n,e)._add(o),S.x+=-t+_,S.y-=(y.left-s)*r.scale;const a=r.imageName?y.advance*r.scale:uu*r.scale,c=String.fromCharCode(r.glyph);yu(c)?S.x+=(1-s)*r.scale:vu(c)?S.x+=a-y.height*r.scale+(-s-1)*r.scale:S.x+=r.imageName||y.width+2*s===v.w&&y.height+2*s===v.h?(a-E)/2:(a-(y.height+2*s)*r.scale)/2,I=new i(S.x,S.y-C),k=new i(S.x+E,S.y),A=new i(S.x+E,S.y-C)}else{const t=(y.left-s)*r.scale-_+x[0],e=(-y.top-s)*r.scale+x[1],n=t+C,o=e+E;S=new i(t,e),I=new i(n,e),k=new i(t,o),A=new i(n,o)}if(u){let t;t=o?new i(0,0):T?new i(h[0],h[1]):new i(n[0],n[1]),S._rotateAround(u,t),I._rotateAround(u,t),k._rotateAround(u,t),A._rotateAround(u,t)}const M=new i(0,0),O=new i(0,0);l.push({tl:S,tr:I,bl:k,br:A,tex:t,writingMode:e.writingMode,glyphOffset:b,sectionIndex:r.sectionIndex,isSDF:d,pixelOffsetTL:M,pixelOffsetBR:O,minFontScaleX:0,minFontScaleY:0})}}return l}(0,r,l,s,a,c,o,t.allowVerticalPlacement),v=t.textSizeData;let b=null;"source"===v.kind?(b=[hu*s.layout.get("text-size").evaluate(c,{},_)],b[0]>Uh&&P(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)):"composite"===v.kind&&(b=[hu*m.compositeTextSizes[0].evaluate(c,{},_),hu*m.compositeTextSizes[1].evaluate(c,{},_)],(b[0]>Uh||b[1]>Uh)&&P(`${t.layerIds[0]}: Value for "text-size" is >= 255. Reduce your "text-size".`)),t.addSymbols(t.text,y,b,l,a,c,h,e,n,u.lineStartIndex,u.lineLength,f,g,_);for(const i of d)p[i]=t.text.placedSymbolArray.length-1;return 4*y.length}function qh(t){for(const e in t)return t[e];return null}function Gh(t,e,n,r,o,s,a,c,u,h){let d=a.top,p=a.bottom,f=a.left,m=a.right;const g=a.collisionPadding;if(g&&(f-=g[0],d-=g[1],m+=g[2],p+=g[3]),u){const t=new i(f,d),e=new i(m,d),n=new i(f,p),r=new i(m,p),o=l(u);let s=new i(0,0);h&&(s=new i(h[0],h[1])),t._rotateAround(o,s),e._rotateAround(o,s),n._rotateAround(o,s),r._rotateAround(o,s),f=Math.min(t.x,e.x,n.x,r.x),m=Math.max(t.x,e.x,n.x,r.x),d=Math.min(t.y,e.y,n.y,r.y),p=Math.max(t.y,e.y,n.y,r.y)}return t.emplaceBack(e.x,e.y,e.z,n.x,n.y,f,d,m,p,c,r,o,s),t.length-1}function $h(t){t.collisionPadding&&(t.top-=t.collisionPadding[1],t.bottom+=t.collisionPadding[3]);const e=t.bottom-t.top;return e>0?Math.max(10,e):null}function Wh(t,e,n,r){const i=t.compareText;if(e in i){const t=i[e];for(let e=t.length-1;e>=0;e--)if(r.dist(t[e])<n)return!0}else i[e]=[];return i[e].push(r),!1}const Hh=Dl.VectorTileFeature.types,Zh=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function Kh(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m){const g=u?Math.min(Uh,Math.round(u[0])):0,_=u?Math.min(Uh,Math.round(u[1])):0;t.emplaceBack(e,n,Math.round(32*s),Math.round(32*a),c,l,(g<<1)+(h?1:0),_,16*d,16*p,256*f,256*m,r,i,o,0)}function Xh(t,e,n){t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n),t.emplaceBack(e.x,e.y,n)}function Yh(t){for(const e of t.sections)if(Wi(e.text))return!0;return!1}class Qh{constructor(t){this.layoutVertexArray=new No,this.indexArray=new Vo,this.programConfigurations=t,this.segments=new Ks,this.dynamicLayoutVertexArray=new Lo,this.opacityVertexArray=new jo,this.placedSymbolArray=new is}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length}upload(t,e,n,r){this.isEmpty()||(n&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,iu.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,e),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,ou.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,Zh,!0),this.opacityVertexBuffer.itemSize=1),(n||r)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())}}si(Qh,"SymbolBuffers");class Jh{constructor(t,e,n){this.layoutVertexArray=new t,this.layoutAttributes=e,this.indexArray=new n,this.segments=new Ks,this.collisionVertexArray=new Uo,this.collisionVertexArrayExt=new Lo}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,su.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,au.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}si(Jh,"CollisionBuffers");class td{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(t=>t.id),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ua([]),this.placementViewportMatrix=Ua([]);const e=this.layers[0]._unevaluatedLayout._values;this.textSizeData=du(this.zoom,e["text-size"]),this.iconSizeData=du(this.zoom,e["icon-size"]);const n=this.layers[0].layout,r=n.get("symbol-sort-key"),i=n.get("symbol-z-order");this.canOverlap=n.get("text-allow-overlap")||n.get("icon-allow-overlap")||n.get("text-ignore-placement")||n.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==r.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=n.get("text-writing-mode").map(t=>Zu[t]),this.stateDependentLayerIds=this.layers.filter(t=>t.isStateDependent()).map(t=>t.id),this.sourceID=t.sourceID,this.projection=t.projection}createArrays(){this.text=new Qh(new Fs(this.layers,this.zoom,t=>/^text/.test(t))),this.icon=new Qh(new Fs(this.layers,this.zoom,t=>/^icon/.test(t))),this.glyphOffsetArray=new as,this.lineVertexArray=new cs,this.symbolInstances=new ss}calculateGlyphDependencies(t,e,n,r,i){for(let o=0;o<t.length;o++)if(e[t.charCodeAt(o)]=!0,r&&i){const n=_u[t.charAt(o)];n&&(e[n.charCodeAt(0)]=!0)}}populate(t,e,n,r){const i=this.layers[0],o=i.layout,s=o.get("text-font"),a=o.get("text-field"),c=o.get("icon-image"),l=("constant"!==a.value.kind||a.value.value instanceof pe&&!a.value.value.isEmpty()||a.value.value.toString().length>0)&&("constant"!==s.value.kind||s.value.value.length>0),u="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,h=o.get("symbol-sort-key");if(this.features=[],!l&&!u)return;const d=e.iconDependencies,p=e.glyphDependencies,f=e.availableImages,m=new oo(this.zoom);for(const{feature:g,id:_,index:y,sourceLayerIndex:v}of t){const t=i._featureFilter.needGeometry,e=ga(g,t);if(!i._featureFilter.filter(m,e,n))continue;let a,c;if(t||(e.geometry=ma(g,n,r)),l){const t=i.getValueAndResolveTokens("text-field",e,n,f),r=pe.factory(t);Yh(r)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===no()||this.hasRTLText&&io.isParsed())&&(a=gu(r,i,e))}if(u){const t=i.getValueAndResolveTokens("icon-image",e,n,f);c=t instanceof fe?t:fe.fromString(t)}if(!a&&!c)continue;const b=this.sortFeaturesByKey?h.evaluate(e,{},n):void 0;if(this.features.push({id:_,text:a,icon:c,index:y,sourceLayerIndex:v,geometry:e.geometry,properties:g.properties,type:Hh[g.type],sortKey:b}),c&&(d[c.name]=!0),a){const t=s.evaluate(e,{},n).join(","),r="map"===o.get("text-rotation-alignment")&&"point"!==o.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(Zu.vertical)>=0;for(const e of a.sections)if(e.image)d[e.image.name]=!0;else{const n=Fi(a.toString()),i=e.fontStack||t,o=p[i]=p[i]||{};this.calculateGlyphDependencies(e.text,o,r,this.allowVerticalPlacement,n)}}}"line"===o.get("symbol-placement")&&(this.features=function(t){const e={},n={},r=[];let i=0;function o(e){r.push(t[e]),i++}function s(t,e,i){const o=n[t];return delete n[t],n[e]=o,r[o].geometry[0].pop(),r[o].geometry[0]=r[o].geometry[0].concat(i[0]),o}function a(t,n,i){const o=e[n];return delete e[n],e[t]=o,r[o].geometry[0].shift(),r[o].geometry[0]=i[0].concat(r[o].geometry[0]),o}function c(t,e,n){const r=n?e[0][e[0].length-1]:e[0][0];return`${t}:${r.x}:${r.y}`}for(let l=0;l<t.length;l++){const u=t[l],h=u.geometry,d=u.text?u.text.toString():null;if(!d){o(l);continue}const p=c(d,h),f=c(d,h,!0);if(p in n&&f in e&&n[p]!==e[f]){const t=a(p,f,h),i=s(p,f,r[t].geometry);delete e[p],delete n[f],n[c(d,r[i].geometry,!0)]=i,r[t].geometry=null}else p in n?s(p,f,h):f in e?a(p,f,h):(o(l),e[p]=i-1,n[f]=i-1)}return r.filter(t=>t.geometry)}(this.features)),this.sortFeaturesByKey&&this.features.sort((t,e)=>t.sortKey-e.sortKey)}update(t,e,n,r){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(t,e,this.layers,n,r),this.icon.programConfigurations.updatePaintArrays(t,e,this.layers,n,r))}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,e){const n=this.lineVertexArray.length,r=t.segment;if(void 0!==r){let n=t.dist(e[r+1]),i=t.dist(e[r]);const o={};for(let t=r+1;t<e.length;t++)o[t]={x:e[t].x,y:e[t].y,tileUnitDistanceFromAnchor:n},t<e.length-1&&(n+=e[t+1].dist(e[t]));for(let t=r||0;t>=0;t--)o[t]={x:e[t].x,y:e[t].y,tileUnitDistanceFromAnchor:i},t>0&&(i+=e[t-1].dist(e[t]));for(let t=0;t<e.length;t++){const e=o[t];this.lineVertexArray.emplaceBack(e.x,e.y,e.tileUnitDistanceFromAnchor)}}return{lineStartIndex:n,lineLength:this.lineVertexArray.length-n}}addSymbols(t,e,n,r,i,o,s,a,c,l,u,h,d,p){const f=t.indexArray,m=t.layoutVertexArray,g=t.segments.prepareSegment(4*e.length,m,f,this.canOverlap?o.sortKey:void 0),_=this.glyphOffsetArray.length,y=g.vertexLength,v=this.allowVerticalPlacement&&s===Zu.vertical?Math.PI/2:0,b=o.text&&o.text.sections;for(let x=0;x<e.length;x++){const{tl:r,tr:i,bl:s,br:l,tex:u,pixelOffsetTL:h,pixelOffsetBR:_,minFontScaleX:y,minFontScaleY:w,glyphOffset:T,isSDF:C,sectionIndex:E}=e[x],S=g.vertexLength,I=T[1];Kh(m,a.x,a.y,a.z,c.x,c.y,r.x,I+r.y,u.x,u.y,n,C,h.x,h.y,y,w),Kh(m,a.x,a.y,a.z,c.x,c.y,i.x,I+i.y,u.x+u.w,u.y,n,C,_.x,h.y,y,w),Kh(m,a.x,a.y,a.z,c.x,c.y,s.x,I+s.y,u.x,u.y+u.h,n,C,h.x,_.y,y,w),Kh(m,a.x,a.y,a.z,c.x,c.y,l.x,I+l.y,u.x+u.w,u.y+u.h,n,C,_.x,_.y,y,w),Xh(t.dynamicLayoutVertexArray,a,v),f.emplaceBack(S,S+1,S+2),f.emplaceBack(S+1,S+2,S+3),g.vertexLength+=4,g.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(T[0]),x!==e.length-1&&E===e[x+1].sectionIndex||t.programConfigurations.populatePaintArrays(m.length,o,o.index,{},d,p,b&&b[E])}t.placedSymbolArray.emplaceBack(a.x,a.y,a.z,c.x,c.y,_,this.glyphOffsetArray.length-_,y,l,u,c.segment,n?n[0]:0,n?n[1]:0,r[0],r[1],s,0,!1,0,h,0)}_commitLayoutVertex(t,e,n,r,i,o,s){t.emplaceBack(e,n,r,i,o,Math.round(s.x),Math.round(s.y))}_addCollisionDebugVertices(t,e,n,r,o,s,a){const c=n.segments.prepareSegment(4,n.layoutVertexArray,n.indexArray),l=c.vertexLength,u=a.tileAnchorX,h=a.tileAnchorY;for(let i=0;i<4;i++)n.collisionVertexArray.emplaceBack(0,0,0,0);n.collisionVertexArrayExt.emplaceBack(e,-t.padding,-t.padding),n.collisionVertexArrayExt.emplaceBack(e,t.padding,-t.padding),n.collisionVertexArrayExt.emplaceBack(e,t.padding,t.padding),n.collisionVertexArrayExt.emplaceBack(e,-t.padding,t.padding),this._commitLayoutVertex(n.layoutVertexArray,r,o,s,u,h,new i(t.x1,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,r,o,s,u,h,new i(t.x2,t.y1)),this._commitLayoutVertex(n.layoutVertexArray,r,o,s,u,h,new i(t.x2,t.y2)),this._commitLayoutVertex(n.layoutVertexArray,r,o,s,u,h,new i(t.x1,t.y2)),c.vertexLength+=4;const d=n.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),c.primitiveLength+=4}_addTextDebugCollisionBoxes(t,e,n,r,i,o){for(let s=r;s<i;s++){const r=n.get(s),i=this.getSymbolInstanceTextSize(t,o,e,s);this._addCollisionDebugVertices(r,i,this.textCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}_addIconDebugCollisionBoxes(t,e,n,r,i,o){for(let s=r;s<i;s++){const r=n.get(s),i=this.getSymbolInstanceIconSize(t,e,s);this._addCollisionDebugVertices(r,i,this.iconCollisionBox,r.projectedAnchorX,r.projectedAnchorY,r.projectedAnchorZ,o)}}generateCollisionDebugBuffers(t,e){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Jh(Fo,cu.members,Ko),this.iconCollisionBox=new Jh(Fo,cu.members,Ko);const n=fu(this.iconSizeData,t),r=fu(this.textSizeData,t);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._addTextDebugCollisionBoxes(r,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._addTextDebugCollisionBoxes(r,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex,o),this._addIconDebugCollisionBoxes(n,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex,o)}}getSymbolInstanceTextSize(t,e,n,r){const i=this.text.placedSymbolArray.get(e.rightJustifiedTextSymbolIndex>=0?e.rightJustifiedTextSymbolIndex:e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.leftJustifiedTextSymbolIndex>=0?e.leftJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex>=0?e.verticalPlacedTextSymbolIndex:r),o=pu(this.textSizeData,t,i)/uu;return this.tilePixelRatio*o}getSymbolInstanceIconSize(t,e,n){const r=this.icon.placedSymbolArray.get(n),i=pu(this.iconSizeData,t,r);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(t,e,n){t.emplaceBack(e,-n,-n),t.emplaceBack(e,n,-n),t.emplaceBack(e,n,n),t.emplaceBack(e,-n,n)}_updateTextDebugCollisionBoxes(t,e,n,r,i,o){for(let s=r;s<i;s++){const r=n.get(s),i=this.getSymbolInstanceTextSize(t,o,e,s);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,r.padding)}}_updateIconDebugCollisionBoxes(t,e,n,r,i){for(let o=r;o<i;o++){const r=n.get(o),i=this.getSymbolInstanceIconSize(t,e,o);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,r.padding)}}updateCollisionDebugBuffers(t,e){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const n=fu(this.iconSizeData,t),r=fu(this.textSizeData,t);for(let i=0;i<this.symbolInstances.length;i++){const o=this.symbolInstances.get(i);this._updateTextDebugCollisionBoxes(r,t,e,o.textBoxStartIndex,o.textBoxEndIndex,o),this._updateTextDebugCollisionBoxes(r,t,e,o.verticalTextBoxStartIndex,o.verticalTextBoxEndIndex,o),this._updateIconDebugCollisionBoxes(n,t,e,o.iconBoxStartIndex,o.iconBoxEndIndex),this._updateIconDebugCollisionBoxes(n,t,e,o.verticalIconBoxStartIndex,o.verticalIconBoxEndIndex)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,e,n,r,i,o,s,a,c){const l={};for(let u=e;u<n;u++){const e=t.get(u);l.textBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,projectedAnchorX:e.projectedAnchorX,projectedAnchorY:e.projectedAnchorY,projectedAnchorZ:e.projectedAnchorZ,tileAnchorX:e.tileAnchorX,tileAnchorY:e.tileAnchorY},l.textFeatureIndex=e.featureIndex;break}for(let u=r;u<i;u++){const e=t.get(u);l.verticalTextBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,projectedAnchorX:e.projectedAnchorX,projectedAnchorY:e.projectedAnchorY,projectedAnchorZ:e.projectedAnchorZ,tileAnchorX:e.tileAnchorX,tileAnchorY:e.tileAnchorY},l.verticalTextFeatureIndex=e.featureIndex;break}for(let u=o;u<s;u++){const e=t.get(u);l.iconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,projectedAnchorX:e.projectedAnchorX,projectedAnchorY:e.projectedAnchorY,projectedAnchorZ:e.projectedAnchorZ,tileAnchorX:e.tileAnchorX,tileAnchorY:e.tileAnchorY},l.iconFeatureIndex=e.featureIndex;break}for(let u=a;u<c;u++){const e=t.get(u);l.verticalIconBox={x1:e.x1,y1:e.y1,x2:e.x2,y2:e.y2,padding:e.padding,projectedAnchorX:e.projectedAnchorX,projectedAnchorY:e.projectedAnchorY,projectedAnchorZ:e.projectedAnchorZ,tileAnchorX:e.tileAnchorX,tileAnchorY:e.tileAnchorY},l.verticalIconFeatureIndex=e.featureIndex;break}return l}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let e=0;e<this.symbolInstances.length;e++){const n=this.symbolInstances.get(e);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,n.textBoxStartIndex,n.textBoxEndIndex,n.verticalTextBoxStartIndex,n.verticalTextBoxEndIndex,n.iconBoxStartIndex,n.iconBoxEndIndex,n.verticalIconBoxStartIndex,n.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}addIndicesForPlacedSymbol(t,e){const n=t.placedSymbolArray.get(e),r=n.vertexStartIndex+4*n.numGlyphs;for(let i=n.vertexStartIndex;i<r;i+=4)t.indexArray.emplaceBack(i,i+1,i+2),t.indexArray.emplaceBack(i+1,i+2,i+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const e=Math.sin(t),n=Math.cos(t),r=[],i=[],o=[];for(let s=0;s<this.symbolInstances.length;++s){o.push(s);const t=this.symbolInstances.get(s);r.push(0|Math.round(e*t.tileAnchorX+n*t.tileAnchorY)),i.push(t.featureIndex)}return o.sort((t,e)=>r[t]-r[e]||i[e]-i[t]),o}addToSortKeyRanges(t,e){const n=this.sortKeyRanges[this.sortKeyRanges.length-1];n&&n.sortKey===e?n.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:e,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const t of this.symbolInstanceIndexes){const e=this.symbolInstances.get(t);this.featureSortOrder.push(e.featureIndex),[e.rightJustifiedTextSymbolIndex,e.centerJustifiedTextSymbolIndex,e.leftJustifiedTextSymbolIndex].forEach((t,e,n)=>{t>=0&&n.indexOf(t)===e&&this.addIndicesForPlacedSymbol(this.text,t)}),e.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,e.verticalPlacedTextSymbolIndex),e.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.placedIconSymbolIndex),e.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,e.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}si(td,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),td.MAX_GLYPHS=65535,td.addDynamicAttributes=Xh;const ed=new bo({"symbol-placement":new mo(Bt.layout_symbol["symbol-placement"]),"symbol-spacing":new mo(Bt.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new mo(Bt.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new go(Bt.layout_symbol["symbol-sort-key"]),"symbol-z-order":new mo(Bt.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new mo(Bt.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new mo(Bt.layout_symbol["icon-ignore-placement"]),"icon-optional":new mo(Bt.layout_symbol["icon-optional"]),"icon-rotation-alignment":new mo(Bt.layout_symbol["icon-rotation-alignment"]),"icon-size":new go(Bt.layout_symbol["icon-size"]),"icon-text-fit":new mo(Bt.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new mo(Bt.layout_symbol["icon-text-fit-padding"]),"icon-image":new go(Bt.layout_symbol["icon-image"]),"icon-rotate":new go(Bt.layout_symbol["icon-rotate"]),"icon-padding":new mo(Bt.layout_symbol["icon-padding"]),"icon-keep-upright":new mo(Bt.layout_symbol["icon-keep-upright"]),"icon-offset":new go(Bt.layout_symbol["icon-offset"]),"icon-anchor":new go(Bt.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new mo(Bt.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new mo(Bt.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new mo(Bt.layout_symbol["text-rotation-alignment"]),"text-field":new go(Bt.layout_symbol["text-field"]),"text-font":new go(Bt.layout_symbol["text-font"]),"text-size":new go(Bt.layout_symbol["text-size"]),"text-max-width":new go(Bt.layout_symbol["text-max-width"]),"text-line-height":new go(Bt.layout_symbol["text-line-height"]),"text-letter-spacing":new go(Bt.layout_symbol["text-letter-spacing"]),"text-justify":new go(Bt.layout_symbol["text-justify"]),"text-radial-offset":new go(Bt.layout_symbol["text-radial-offset"]),"text-variable-anchor":new mo(Bt.layout_symbol["text-variable-anchor"]),"text-anchor":new go(Bt.layout_symbol["text-anchor"]),"text-max-angle":new mo(Bt.layout_symbol["text-max-angle"]),"text-writing-mode":new mo(Bt.layout_symbol["text-writing-mode"]),"text-rotate":new go(Bt.layout_symbol["text-rotate"]),"text-padding":new mo(Bt.layout_symbol["text-padding"]),"text-keep-upright":new mo(Bt.layout_symbol["text-keep-upright"]),"text-transform":new go(Bt.layout_symbol["text-transform"]),"text-offset":new go(Bt.layout_symbol["text-offset"]),"text-allow-overlap":new mo(Bt.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new mo(Bt.layout_symbol["text-ignore-placement"]),"text-optional":new mo(Bt.layout_symbol["text-optional"])});var nd={paint:new bo({"icon-opacity":new go(Bt.paint_symbol["icon-opacity"]),"icon-color":new go(Bt.paint_symbol["icon-color"]),"icon-halo-color":new go(Bt.paint_symbol["icon-halo-color"]),"icon-halo-width":new go(Bt.paint_symbol["icon-halo-width"]),"icon-halo-blur":new go(Bt.paint_symbol["icon-halo-blur"]),"icon-translate":new mo(Bt.paint_symbol["icon-translate"]),"icon-translate-anchor":new mo(Bt.paint_symbol["icon-translate-anchor"]),"text-opacity":new go(Bt.paint_symbol["text-opacity"]),"text-color":new go(Bt.paint_symbol["text-color"],{runtimeType:Xt,getOverride:t=>t.textColor,hasOverride:t=>!!t.textColor}),"text-halo-color":new go(Bt.paint_symbol["text-halo-color"]),"text-halo-width":new go(Bt.paint_symbol["text-halo-width"]),"text-halo-blur":new go(Bt.paint_symbol["text-halo-blur"]),"text-translate":new mo(Bt.paint_symbol["text-translate"]),"text-translate-anchor":new mo(Bt.paint_symbol["text-translate-anchor"])}),layout:ed};class rd{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:Wt,this.defaultValue=t}evaluate(t){if(t.formattedSection){const e=this.defaultValue.property.overrides;if(e&&e.hasOverride(t.formattedSection))return e.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}si(rd,"FormatSectionOverride",{omit:["defaultValue"]});class id extends Ws{constructor(t){super(t,nd)}recalculate(t,e){super.recalculate(t,e),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const n=this.layout.get("text-writing-mode");if(n){const t=[];for(const e of n)t.indexOf(e)<0&&t.push(e);this.layout._values["text-writing-mode"]=t}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getValueAndResolveTokens(t,e,n,r){const i=this.layout.get(t).evaluate(e,{},n,r),o=this._unevaluatedLayout._values[t];return o.isDataDriven()||lr(o.value)||!i?i:function(t,e){return e.replace(/{([^{}]+)}/g,(e,n)=>n in t?String(t[n]):"")}(e.properties,i)}createBucket(t){return new td(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of nd.paint.overridableProperties){if(!id.hasPaintOverride(this.layout,t))continue;const e=this.paint.get(t),n=new rd(e),r=new cr(n,e.property.specification);let i=null;i="constant"===e.value.kind||"source"===e.value.kind?new hr("source",r):new dr("composite",r,e.value.zoomStops,e.value._interpolationType),this.paint._values[t]=new po(e.property,i,e.parameters)}}_handleOverridablePaintPropertyUpdate(t,e,n){return!(!this.layout||e.isDataDriven()||n.isDataDriven())&&id.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,e){const n=t.get("text-field"),r=nd.paint.properties[e];let i=!1;const o=t=>{for(const e of t)if(r.overrides&&r.overrides.hasOverride(e))return void(i=!0)};if("constant"===n.value.kind&&n.value.value instanceof pe)o(n.value.value.sections);else if("source"===n.value.kind){const t=e=>{i||(e instanceof ve&&_e(e.value)===te?o(e.value.sections):e instanceof Te?o(e.sections):e.eachChild(t))},e=n.value;e._styleExpression&&t(e._styleExpression.expression)}return i}getProgramConfiguration(t){return new zs(this,t)}}var od={paint:new bo({"background-color":new mo(Bt.paint_background["background-color"]),"background-pattern":new yo(Bt.paint_background["background-pattern"]),"background-opacity":new mo(Bt.paint_background["background-opacity"])})},sd={paint:new bo({"raster-opacity":new mo(Bt.paint_raster["raster-opacity"]),"raster-hue-rotate":new mo(Bt.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new mo(Bt.paint_raster["raster-brightness-min"]),"raster-brightness-max":new mo(Bt.paint_raster["raster-brightness-max"]),"raster-saturation":new mo(Bt.paint_raster["raster-saturation"]),"raster-contrast":new mo(Bt.paint_raster["raster-contrast"]),"raster-resampling":new mo(Bt.paint_raster["raster-resampling"]),"raster-fade-duration":new mo(Bt.paint_raster["raster-fade-duration"])})};class ad extends Ws{constructor(t){super(t,{}),this.implementation=t}is3D(){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}var cd={paint:new bo({"sky-type":new mo(Bt.paint_sky["sky-type"]),"sky-atmosphere-sun":new mo(Bt.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new mo(Bt.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new mo(Bt.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new mo(Bt.paint_sky["sky-gradient-radius"]),"sky-gradient":new vo(Bt.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new mo(Bt.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new mo(Bt.paint_sky["sky-atmosphere-color"]),"sky-opacity":new mo(Bt.paint_sky["sky-opacity"])})};function ld(t,e,n){const r=[0,0,1],i=gc([]);return function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),c=Math.cos(n);t[0]=r*c-o*a,t[1]=i*c+s*a,t[2]=o*c+r*a,t[3]=s*c-i*a}(i,i,n?-l(t)+Math.PI:l(t)),_c(i,i,-l(e)),lc(r,r,i),oc(r,r)}const ud={circle:class extends Ws{constructor(t){super(t,ja)}createBucket(t){return new va(t)}queryRadius(t){const e=t;return Pa("circle-radius",this,e)+Pa("circle-stroke-width",this,e)+Da(this.paint.get("circle-translate"))}queryIntersectsFeature(t,e,n,r,i,o,s,a){const c=Na(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),l=this.paint.get("circle-radius").evaluate(e,n)+this.paint.get("circle-stroke-width").evaluate(e,n);return bc(t,r,o,s,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),c,l)}getProgramIds(){return["circle"]}getProgramConfiguration(t){return new zs(this,t)}},heatmap:class extends Ws{createBucket(t){return new Ec(t)}constructor(t){super(t,Oc),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"heatmap-color"===t&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Pc({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}queryRadius(t){return Pa("heatmap-radius",this,t)}queryIntersectsFeature(t,e,n,r,o,s,a,c){const l=this.paint.get("heatmap-radius").evaluate(e,n);return bc(t,r,s,a,c,!0,!0,new i(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getProgramConfiguration(t){return new zs(this,t)}},hillshade:class extends Ws{constructor(t){super(t,Dc)}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}},fill:class extends Ws{constructor(t){super(t,bl)}getProgramIds(){const t=this.paint.get("fill-pattern"),e=t&&t.constantOr(1),n=[e?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&n.push(e&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),n}getProgramConfiguration(t){return new zs(this,t)}recalculate(t,e){super.recalculate(t,e);const n=this.paint._values["fill-outline-color"];"constant"===n.value.kind&&void 0===n.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(t){return new yl(t)}queryRadius(){return Da(this.paint.get("fill-translate"))}queryIntersectsFeature(t,e,n,r,i,o){return!t.queryGeometry.isAboveHorizon&&wa(Ra(t.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),o.angle,t.pixelToTileUnitsFactor),r)}isTileClipped(){return!0}},"fill-extrusion":class extends Ws{constructor(t){super(t,Vl)}createBucket(t){return new Bl(t)}queryRadius(){return Da(this.paint.get("fill-extrusion-translate"))}is3D(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}getProgramConfiguration(t){return new zs(this,t)}queryIntersectsFeature(t,e,n,r,o,s,a,c,l){const u=Na(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),h=this.paint.get("fill-extrusion-height").evaluate(e,n),d=this.paint.get("fill-extrusion-base").evaluate(e,n),p=[0,0],f=c&&s.elevation,m=s.elevation?s.elevation.exaggeration():1,g=t.tile.getBucket(this);if(f&&g instanceof Bl){const t=g.centroidVertexArray,e=l+1;if(e<t.length){const n=t.get(e);p[0]=n.a_centroid_pos0,p[1]=n.a_centroid_pos1}}if(0===p[0]&&1===p[1])return!1;const _=function(t,e,n,r,o,s,a,c,l){return s?function(t,e,n,r,i,o,s,a,c){const l=[],u=[],h=[0,0,0,1];for(const d of t){const t=[],p=[];for(const l of d){const u=l.x+r.x,d=l.y+r.y,f=Wl(u,d,e,n,o,s,a,c);h[0]=u,h[1]=d,h[2]=f.base,h[3]=1,fc(h,h,i),h[3]=Math.max(h[3],1e-5);const m=$l([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);h[0]=u,h[1]=d,h[2]=f.top,h[3]=1,fc(h,h,i),h[3]=Math.max(h[3],1e-5);const g=$l([h[0]/h[3],h[1]/h[3],h[2]/h[3]]);t.push(m),p.push(g)}l.push(t),u.push(p)}return[l,u]}(t,e,n,r,o,s,a,c,l):function(t,e,n,r,o){const s=[],a=[],c=o[8]*e,l=o[9]*e,u=o[10]*e,h=o[11]*e,d=o[8]*n,p=o[9]*n,f=o[10]*n,m=o[11]*n;for(const g of t){const t=[],e=[];for(const n of g){const s=n.x+r.x,a=n.y+r.y,g=o[0]*s+o[4]*a+o[12],_=o[1]*s+o[5]*a+o[13],y=o[2]*s+o[6]*a+o[14],v=o[3]*s+o[7]*a+o[15],b=g+c,x=_+l,w=y+u,T=Math.max(v+h,1e-5),C=g+d,E=_+p,S=y+f,I=Math.max(v+m,1e-5),k=new i(b/T,x/T);k.z=w/T,t.push(k);const A=new i(C/I,E/I);A.z=S/I,e.push(A)}s.push(t),a.push(e)}return[s,a]}(t,e,n,r,o)}(r,d,h,u,a,f?c:null,p,m,s.center.lat),y=t.queryGeometry;return function(t,e,n){let r=1/0;wa(n,e)&&(r=Gl(n,e[0]));for(let i=0;i<e.length;i++){const o=e[i],s=t[i];for(let t=0;t<o.length-1;t++){const e=o[t],i=[e,o[t+1],s[t+1],s[t],e];ba(n,i)&&(r=Math.min(r,Gl(n,i)))}}return r!==1/0&&r}(_[0],_[1],y.isPointQuery()?y.screenBounds:y.screenGeometry)}},line:class extends Ws{constructor(t){super(t,eu),this.gradientVersion=0}_handleSpecialPaintPropertyUpdate(t){if("line-gradient"===t){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof en,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}recalculate(t,e){super.recalculate(t,e),this.paint._values["line-floorwidth"]=nu.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,t)}createBucket(t){return new Jl(t)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getProgramConfiguration(t){return new zs(this,t)}queryRadius(t){const e=t,n=ru(Pa("line-width",this,e),Pa("line-gap-width",this,e)),r=Pa("line-offset",this,e);return n/2+Math.abs(r)+Da(this.paint.get("line-translate"))}queryIntersectsFeature(t,e,n,r,o,s){if(t.queryGeometry.isAboveHorizon)return!1;const a=Ra(t.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,t.pixelToTileUnitsFactor),c=t.pixelToTileUnitsFactor/2*ru(this.paint.get("line-width").evaluate(e,n),this.paint.get("line-gap-width").evaluate(e,n)),l=this.paint.get("line-offset").evaluate(e,n);return l&&(r=function(t,e){const n=[],r=new i(0,0);for(let i=0;i<t.length;i++){const o=t[i],s=[];for(let t=0;t<o.length;t++){const n=o[t-1],i=o[t],a=o[t+1],c=0===t?r:i.sub(n)._unit()._perp(),l=t===o.length-1?r:a.sub(i)._unit()._perp(),u=c._add(l)._unit();u._mult(1/(u.x*l.x+u.y*l.y)),s.push(u._mult(e)._add(i))}n.push(s)}return n}(r,l*t.pixelToTileUnitsFactor)),function(t,e,n){for(let r=0;r<e.length;r++){const i=e[r];if(t.length>=3)for(let e=0;e<i.length;e++)if(Aa(t,i[e]))return!0;if(Ta(t,i,n))return!0}return!1}(a,r,c)}isTileClipped(){return!0}},symbol:id,background:class extends Ws{constructor(t){super(t,od)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}},raster:class extends Ws{constructor(t){super(t,sd)}getProgramIds(){return["raster"]}},sky:class extends Ws{constructor(t){super(t,cd),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(t){"sky-gradient"===t?this._updateColorRamp():"sky-atmosphere-sun"!==t&&"sky-atmosphere-halo-color"!==t&&"sky-atmosphere-color"!==t&&"sky-atmosphere-sun-intensity"!==t||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Pc({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(t){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const e=t.style.light.properties.get("position");return this._lightPosition.azimuthal!==e.azimuthal||this._lightPosition.polar!==e.polar}return!1}getCenter(t,e){if("atmosphere"===this.paint.get("sky-type")){const n=this.paint.get("sky-atmosphere-sun"),r=!n,i=t.style.light,o=i.properties.get("position");return r&&"viewport"===i.properties.get("anchor")&&P("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),r?ld(o.azimuthal,90-o.polar,e):ld(n[0],90-n[1],e)}const n=this.paint.get("sky-gradient-center");return ld(n[0],90-n[1],e)}is3D(){return!1}isSky(){return!0}markSkyboxValid(t){this._skyboxInvalidated=!1,this._lightPosition=t.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const t=this.paint.get("sky-type");return"atmosphere"===t?["skyboxCapture","skybox"]:"gradient"===t?["skyboxGradient"]:null}}};class hd{constructor(t,e,n,r){this.context=t,this.format=n,this.texture=t.gl.createTexture(),this.update(e,r)}update(t,e,n){const{width:r,height:i}=t,{context:o}=this,{gl:a}=o,{HTMLImageElement:c,HTMLCanvasElement:l,HTMLVideoElement:u,ImageData:h,ImageBitmap:d}=s;if(a.bindTexture(a.TEXTURE_2D,this.texture),o.pixelStoreUnpackFlipY.set(!1),o.pixelStoreUnpack.set(1),o.pixelStoreUnpackPremultiplyAlpha.set(this.format===a.RGBA&&(!e||!1!==e.premultiply)),n||this.size&&this.size[0]===r&&this.size[1]===i){const{x:e,y:o}=n||{x:0,y:0};t instanceof c||t instanceof l||t instanceof u||t instanceof h||d&&t instanceof d?a.texSubImage2D(a.TEXTURE_2D,0,e,o,a.RGBA,a.UNSIGNED_BYTE,t):a.texSubImage2D(a.TEXTURE_2D,0,e,o,r,i,a.RGBA,a.UNSIGNED_BYTE,t.data)}else this.size=[r,i],t instanceof c||t instanceof l||t instanceof u||t instanceof h||d&&t instanceof d?a.texImage2D(a.TEXTURE_2D,0,this.format,this.format,a.UNSIGNED_BYTE,t):a.texImage2D(a.TEXTURE_2D,0,this.format,r,i,0,this.format,a.UNSIGNED_BYTE,t.data);this.useMipmap=Boolean(e&&e.useMipmap&&this.isSizePowerOfTwo()),this.useMipmap&&a.generateMipmap(a.TEXTURE_2D)}bind(t,e){const{context:n}=this,{gl:r}=n;r.bindTexture(r.TEXTURE_2D,this.texture),t!==this.filter&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,t),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,this.useMipmap?t===r.NEAREST?r.NEAREST_MIPMAP_NEAREST:r.LINEAR_MIPMAP_NEAREST:t),this.filter=t),e!==this.wrap&&(r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,e),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,e),this.wrap=e)}isSizePowerOfTwo(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class dd{constructor(t,e){this.width=t,this.height=e,this.nextRow=0,this.image=new Ac({width:t,height:e}),this.positions={},this.uploaded=!1}getDash(t,e){const n=this.getKey(t,e);return this.positions[n]}trim(){const t=this.width,e=this.height=C(this.nextRow);this.image.resize({width:t,height:e})}getKey(t,e){return t.join(",")+e}getDashRanges(t,e,n){const r=[];let i=t.length%2==1?-t[t.length-1]*n:0,o=t[0]*n,s=!0;r.push({left:i,right:o,isDash:s,zeroLength:0===t[0]});let a=t[0];for(let c=1;c<t.length;c++){s=!s;const e=t[c];i=a*n,a+=e,o=a*n,r.push({left:i,right:o,isDash:s,zeroLength:0===e})}return r}addRoundDash(t,e,n){const r=e/2;for(let i=-n;i<=n;i++){const e=this.width*(this.nextRow+n+i);let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const c=Math.abs(a-s.left),l=Math.abs(a-s.right),u=Math.min(c,l);let h;const d=i/n*(r+1);if(s.isDash){const t=r-Math.abs(d);h=Math.sqrt(u*u+t*t)}else h=r-Math.sqrt(u*u+d*d);this.image.data[e+a]=Math.max(0,Math.min(255,h+128))}}}addRegularDash(t,e){for(let a=t.length-1;a>=0;--a){const e=t[a],n=t[a+1];e.zeroLength?t.splice(a,1):n&&n.isDash===e.isDash&&(n.left=e.left,t.splice(a,1))}const n=t[0],r=t[t.length-1];n.isDash===r.isDash&&(n.left=r.left-this.width,r.right=n.right+this.width);const i=this.width*this.nextRow;let o=0,s=t[o];for(let a=0;a<this.width;a++){a/s.right>1&&(s=t[++o]);const n=Math.abs(a-s.left),r=Math.abs(a-s.right),c=Math.min(n,r);this.image.data[i+a]=Math.max(0,Math.min(255,(s.isDash?c:-c)+e+128))}}addDash(t,e){const n=this.getKey(t,e);if(this.positions[n])return this.positions[n];const r="round"===e,i=r?7:0,o=2*i+1;if(this.nextRow+o>this.height)return P("LineAtlas out of space"),null;0===t.length&&t.push(1);let s=0;for(let l=0;l<t.length;l++)t[l]<0&&(P("Negative value is found in line dasharray, replacing values with 0"),t[l]=0),s+=t[l];if(0!==s){const n=this.width/s,o=this.getDashRanges(t,this.width,n);r?this.addRoundDash(o,n,i):this.addRegularDash(o,"square"===e?.5*n:0)}const a=this.nextRow+i;this.nextRow+=o;const c={tl:[a,i],br:[s,0]};return this.positions[n]=c,c}}si(dd,"LineAtlas");class pd{constructor(t){this._callback=t,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}const fd=s.performance;function md(t){const e=t?t.url.toString():void 0;return fd.getEntriesByName(e)}class gd{constructor(){this.tasks={},this.taskQueue=[],S(["process"],this),this.invoker=new pd(this.process),this.nextId=0}add(t,e){const n=this.nextId++,r=function({type:t,isSymbolTile:e,zoom:n}){return n=n||0,"message"===t?0:"maybePrepare"!==t||e?"parseTile"!==t||e?"parseTile"===t&&e?300-n:"maybePrepare"===t&&e?400-n:500:200-n:100-n}(e);if(0===r){N();try{t()}finally{}return{cancel:()=>{}}}return this.tasks[n]={fn:t,metadata:e,priority:r,id:n},this.taskQueue.push(n),this.invoker.trigger(),{cancel:()=>{delete this.tasks[n]}}}process(){N();try{if(this.taskQueue=this.taskQueue.filter(t=>!!this.tasks[t]),!this.taskQueue.length)return;const t=this.pick();if(null===t)return;const e=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!e)return;e.fn()}finally{}}pick(){let t=null,e=1/0;for(let r=0;r<this.taskQueue.length;r++){const n=this.tasks[this.taskQueue[r]];n.priority<e&&(e=n.priority,t=r)}if(null===t)return null;const n=this.taskQueue[t];return this.taskQueue.splice(t,1),n}remove(){this.invoker.remove()}}const _d=Eo([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_merc_pos",components:2},{type:"Float32",name:"a_uv",components:2}]),yd=Eo([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:vd}=_d,bd=Eo([{name:"a_pos_3",components:3,type:"Int16"}]);var xd=Eo([{name:"a_pos",type:"Int16",components:2}]);const wd=Xs/Math.PI/2,Td=-wd,Cd=wd,Ed=[new vc([Td,Td,Td],[Cd,Cd,Cd]),new vc([Td,Td,Td],[0,0,Cd]),new vc([0,Td,Td],[Cd,0,Cd]),new vc([Td,0,Td],[0,Cd,Cd]),new vc([0,0,Td],[Cd,Cd,Cd])];class Sd{constructor(t,e,n){this.a=hc([],t,n),this.b=hc([],e,n),this.center=n;const r=oc([],this.a),i=oc([],this.b);this.angle=Math.acos(sc(r,i))}}function Id(t,e){if(0===t.angle)return null;let n;return n=0===t.a[e]?1/t.angle*.5*Math.PI:1/t.angle*Math.atan(t.b[e]/t.a[e]/Math.sin(t.angle)-1/Math.tan(t.angle)),n<0||n>1?null:function(t,e,n,r){const i=Math.sin(n);return t*(Math.sin((1-r)*n)/i)+e*(Math.sin(r*n)/i)}(t.a[e],t.b[e],t.angle,m(n,0,1))+t.center[e]}function kd(t){if(t.z<=1)return Ed[t.z+2*t.y+t.x];const[e,n]=Md(t),r=[Pd(e[0],e[1]),Pd(e[0],n[1]),Pd(n[0],e[1]),Pd(n[0],n[1])],i=[Cd,Cd,Cd],o=[Td,Td,Td];for(const s of r)i[0]=Math.min(i[0],s[0]),i[1]=Math.min(i[1],s[1]),i[2]=Math.min(i[2],s[2]),o[0]=Math.max(o[0],s[0]),o[1]=Math.max(o[1],s[1]),o[2]=Math.max(o[2],s[2]);return new vc(i,o)}function Ad(t,e,n){const r=e/t.worldSize,i=(t,e)=>{rc(t,t,r),rc(e,e,r)},o=Number.MAX_VALUE,s=[-o,-o,-o],a=[o,o,o],c=jd(t);if(n.z<=1){const t=kd(n).getCorners();for(let e=0;e<t.length;e++)cc(t[e],t[e],c),ec(a,a,t[e]),nc(s,s,t[e]);return i(a,s),new vc(a,s)}const[u,h]=Md(n),d=new Ys;d.setSouthWest([u[1],h[0]]),d.setNorthEast([h[1],u[0]]);const p=[Pd(d.getSouth(),d.getWest()),Pd(d.getSouth(),d.getEast()),Pd(d.getNorth(),d.getEast()),Pd(d.getNorth(),d.getWest())];for(let l=0;l<p.length;l++)cc(p[l],p[l],c),ec(a,a,p[l]),nc(s,s,p[l]);if(d.contains(t.center))return s[2]=0,i(a,s),new vc(a,s);const f=[c[12],c[13],c[14]],g=t.center.lng,_=m(t.center.lat,-85.051129,ca),y=[na(g),ra(_)],v=d.getCenter().lng,b=m(d.getCenter().lat,-85.051129,ca),x=[na(v),ra(b)];let w=new Array(3),T=0;const C=y[0]-x[0],E=y[1]-x[1];if(Math.abs(C)>Math.abs(E))T=C>=0?1:3,w=f;else{T=E>=0?0:2;const t=[c[4],c[5],c[6]];let e;e=E>=0?-Math.sin(l(d.getSouth()))*wd:-Math.sin(l(d.getNorth()))*wd,w=ic(w,f,t,e)}const S=p[T],I=p[(T+1)%4],k=new Sd(S,I,w),A=[Id(k,0)||S[0],Id(k,1)||S[1],Id(k,2)||S[2]];return a[2]=Math.min(S[2],I[2]),ec(a,a,A),nc(s,s,A),i(a,s),new vc(a,s)}function Md(t){const e=1<<t.z,n=t.x/e,r=(t.x+1)/e,i=(t.y+1)/e;return[[sa(t.y/e),oa(n)],[sa(i),oa(r)]]}function Od(t,e,n,r=wd){return n=l(n),[t*Math.sin(n)*r,-e*r,t*Math.cos(n)*r]}function Pd(t,e,n){return Od(Math.cos(l(t)),Math.sin(l(t)),e,n)}function Dd(t,e,n){const r=Math.pow(2,n.z),i=(t/Xs+n.x)/r;return Pd(sa((e/Xs+n.y)/r),oa(i))}function Rd(t){return 16383/Math.max(...hc([],t.max,t.min))}function Nd(t){const e=Ua(new Float64Array(16)),n=Rd(t);var r,i;return Ga(e,e,[n,n,n]),qa(e,e,((r=[])[0]=-(i=t.min)[0],r[1]=-i[1],r[2]=-i[2],r)),e}function Ld(t,e,n,r,i){const o=function(t){const e=Xs/(2*Math.PI);return t/(2*Math.PI)/e}(n),s=[t,e,-n/(2*Math.PI)],a=Ua(new Float64Array(16));return qa(a,a,s),Ga(a,a,[o,o,o]),$a(a,a,l(-i)),Wa(a,a,l(-r)),a}function jd(t){const{x:e,y:n}=t.point,{lng:r,lat:i}=t._center;return Ld(e,n,t.worldSize,r,i)}const zd=l(85),Fd=Math.cos(zd),Bd=Math.sin(zd);function Ud(t,e,n){var r=2*Math.PI*6378137/256/Math.pow(2,n);return[t*r-2*Math.PI*6378137/2,e*r-2*Math.PI*6378137/2]}class Vd{constructor(t,e,n){this.z=t,this.x=e,this.y=n,this.key=$d(0,t,t,e,n)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}url(t,e){const n=function(t,e,n){var r=Ud(256*t,256*(e=Math.pow(2,n)-e-1),n),i=Ud(256*(t+1),256*(e+1),n);return r[0]+","+r[1]+","+i[0]+","+i[1]}(this.x,this.y,this.z),r=function(t,e,n){let r,i="";for(let o=t;o>0;o--)r=1<<o-1,i+=(e&r?1:0)+(n&r?2:0);return i}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String("tms"===e?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",r).replace("{bbox-epsg-3857}",n)}toString(){return`${this.z}/${this.x}/${this.y}`}}class qd{constructor(t,e){this.wrap=t,this.canonical=e,this.key=$d(t,e.z,e.z,e.x,e.y)}}class Gd{constructor(t,e,n,r,i){this.overscaledZ=t,this.wrap=e,this.canonical=new Vd(n,+r,+i),this.key=0===e&&t===n?this.canonical.key:$d(e,t,n,r,i)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const e=this.canonical.z-t;return t>this.canonical.z?new Gd(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Gd(t,this.wrap,t,this.canonical.x>>e,this.canonical.y>>e)}calculateScaledKey(t,e=!0){if(this.overscaledZ===t&&e)return this.key;if(t>this.canonical.z)return $d(this.wrap*+e,t,this.canonical.z,this.canonical.x,this.canonical.y);{const n=this.canonical.z-t;return $d(this.wrap*+e,t,t,this.canonical.x>>n,this.canonical.y>>n)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const e=this.canonical.z-t.canonical.z;return 0===t.overscaledZ||t.overscaledZ<this.overscaledZ&&t.canonical.x===this.canonical.x>>e&&t.canonical.y===this.canonical.y>>e}children(t){if(this.overscaledZ>=t)return[new Gd(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const e=this.canonical.z+1,n=2*this.canonical.x,r=2*this.canonical.y;return[new Gd(e,this.wrap,e,n,r),new Gd(e,this.wrap,e,n+1,r),new Gd(e,this.wrap,e,n,r+1),new Gd(e,this.wrap,e,n+1,r+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Gd(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Gd(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new qd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function $d(t,e,n,r,i){const o=1<<Math.min(n,22);let s=o*(i%o)+r%o;return t&&n<22&&(s+=o*o*((t<0?-2*t-1:2*t)%(1<<2*(22-n)))),16*(32*s+n)+(e-n)}function Wd(t,e){if(!e.isReprojectedInTileSpace)return{scale:1<<t.z,x:t.x,y:t.y,x2:t.x+1,y2:t.y+1,projection:e};const n=Math.pow(2,-t.z),r=t.x*n,i=(t.x+1)*n,o=t.y*n,s=(t.y+1)*n,a=oa(r),c=oa(i),l=sa(o),u=sa(s),h=e.project(a,l),d=e.project(c,l),p=e.project(c,u),f=e.project(a,u);let m=Math.min(h.x,d.x,p.x,f.x),g=Math.min(h.y,d.y,p.y,f.y),_=Math.max(h.x,d.x,p.x,f.x),y=Math.max(h.y,d.y,p.y,f.y);const v=n/16;function b(t,n,r,i,o,s){const a=(r+o)/2,c=(i+s)/2,l=e.project(oa(a),sa(c)),u=Math.max(0,m-l.x,g-l.y,l.x-_,l.y-y);m=Math.min(m,l.x),_=Math.max(_,l.x),g=Math.min(g,l.y),y=Math.max(y,l.y),u>v&&(b(t,l,r,i,a,c),b(l,n,a,c,o,s))}b(h,d,r,o,i,o),b(d,p,i,o,i,s),b(p,f,i,s,r,s),b(f,h,r,s,r,o),m-=v,g-=v,_+=v,y+=v;const x=1/Math.max(_-m,y-g);return{scale:x,x:m*x,y:g*x,x2:_*x,y2:y*x,projection:e}}si(Vd,"CanonicalTileID"),si(Gd,"OverscaledTileID",{omit:["projMatrix"]});class Hd{constructor(t){this._stringToNumber={},this._numberToString=[];for(let e=0;e<t.length;e++){const n=t[e];this._stringToNumber[n]=e,this._numberToString[e]=n}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const Zd=["tile","layer","source","sourceLayer","state"];class Kd{constructor(t,e,n,r,i){this.type="Feature",this._vectorTileFeature=t,this._z=e,this._x=n,this._y=r,this.properties=t.properties,this.id=i}get geometry(){return void 0===this._geometry&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",geometry:this.geometry,properties:this.properties};void 0!==this.id&&(t.id=this.id);for(const e of Zd)void 0!==this[e]&&(t[e]=this[e]);return t}}const Xd=32,Yd=33,Qd=new Uint16Array(8184);for(let nf=0;nf<2046;nf++){let t=nf+2,e=0,n=0,r=0,i=0,o=0,s=0;for(1&t?r=i=o=Xd:e=n=s=Xd;(t>>=1)>1;){const a=e+r>>1,c=n+i>>1;1&t?(r=e,i=n,e=o,n=s):(e=r,n=i,r=o,i=s),o=a,s=c}const a=4*nf;Qd[a+0]=e,Qd[a+1]=n,Qd[a+2]=r,Qd[a+3]=i}const Jd=new Uint16Array(2178),tp=new Uint8Array(1089),ep=new Uint16Array(1089);function np(t){return 0===t?-.03125:32===t?.03125:0}var rp=Eo([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);const ip={type:2,extent:Xs,loadGeometry:()=>[[new i(0,0),new i(8193,0),new i(8193,8193),new i(0,8193),new i(0,0)]]};class op{constructor(t,e,n,r,i){this.tileID=t,this.uid=w(),this.uses=0,this.tileSize=e,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=i,this.expiredRequestCount=0,this.state="loading",r&&r.transform&&(this.projection=r.transform.projection)}registerFadeDuration(t){const e=t+this.timeAdded;e<G.now()||this.fadeEndTime&&e<this.fadeEndTime||(this.fadeEndTime=e)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=Wd(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,e,n){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=function(t,e){const n={};if(!e)return n;for(const r of t){const t=r.layerIds.map(t=>e.getLayer(t)).filter(Boolean);if(0!==t.length){r.layers=t,r.stateDependentLayerIds&&(r.stateDependentLayers=r.stateDependentLayerIds.map(e=>t.filter(t=>t.id===e)[0]));for(const e of t)n[e.id]=r}}return n}(t.buckets,e.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const e=this.buckets[t];if(e instanceof td){if(this.hasSymbolBuckets=!0,!n)break;e.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const e=this.buckets[t];if(e instanceof td&&e.hasRTLText){this.hasRTLText=!0,io.isLoading()||io.isLoaded()||"deferred"!==no()||ro();break}}this.queryPadding=0;for(const t in this.buckets){const n=this.buckets[t];this.queryPadding=Math.max(this.queryPadding,e.style.getLayer(t).queryRadius(n))}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas)}else this.collisionBoxArray=new ns}unloadVectorData(){if(this.hasData()){for(const t in this.buckets)this.buckets[t].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugIndexBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}getBucket(t){return this.buckets[t.id]}upload(t){for(const n in this.buckets){const e=this.buckets[n];e.uploadPending()&&e.upload(t)}const e=t.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new hd(t,this.imageAtlas.image,e.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new hd(t,this.glyphAtlasImage,e.ALPHA),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new hd(t,this.lineAtlas.image,e.ALPHA),this.lineAtlas.uploaded=!0)}prepare(t){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(t,this.imageAtlasTexture)}queryRenderedFeatures(t,e,n,r,i,o,s,a){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({tileResult:r,pixelPosMatrix:s,transform:o,params:i,tileTransform:this.tileTransform},t,e,n):{}}querySourceFeatures(t,e){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const r=n.loadVTLayers(),i=e?e.sourceLayer:"",o=r._geojsonTileLayer||r[i];if(!o)return;const s=Er(e&&e.filter),{z:a,x:c,y:l}=this.tileID.canonical,u={z:a,x:c,y:l};for(let h=0;h<o.length;h++){const e=o.feature(h);if(s.needGeometry){const t=ga(e,!0);if(!s.filter(new oo(this.tileID.overscaledZ),t,this.tileID.canonical))continue}else if(!s.filter(new oo(this.tileID.overscaledZ),e))continue;const r=n.getId(e,i),d=new Kd(e,a,c,l,r);d.tile=u,t.push(d)}}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length}setExpiryData(t){const e=this.expirationTime;if(t.cacheControl){const e=L(t.cacheControl);e["max-age"]&&(this.expirationTime=Date.now()+1e3*e["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const t=Date.now();let n=!1;if(this.expirationTime>t)n=!1;else if(e)if(this.expirationTime<e)n=!0;else{const r=this.expirationTime-e;r?this.expirationTime=t+Math.max(r,3e4):n=!0}else n=!0;n?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}setFeatureState(t,e){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData||0===Object.keys(t).length||!e)return;const n=this.latestFeatureIndex.loadVTLayers(),r=e.style.listImages();for(const i in this.buckets){if(!e.style.hasLayer(i))continue;const o=this.buckets[i],s=o.layers[0].sourceLayer||"_geojsonTileLayer",a=n[s],c=t[s];if(!a||!c||0===Object.keys(c).length)continue;if(o.update(c,a,r,this.imageAtlas&&this.imageAtlas.patternPositions||{}),o instanceof Jl||o instanceof yl){const t=e.style._getSourceCache(o.layers[0].source);e._terrain&&e._terrain.enabled&&t&&o.programConfigurations.needsUpload&&e._terrain._clearRenderCacheForTile(t.id,this.tileID)}const l=e&&e.style&&e.style.getLayer(i);l&&(this.queryPadding=Math.max(this.queryPadding,l.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<G.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=G.now()+t}setTexture(t,e){const n=e.context,r=n.gl;this.texture=e.getTileTexture(t.width),this.texture?this.texture.update(t,{useMipmap:!0}):(this.texture=new hd(n,t,r.RGBA,{useMipmap:!0}),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),n.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,n.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,n.extTextureFilterAnisotropicMax))}setDependencies(t,e){const n={};for(const r of e)n[r]=!0;this.dependencies[t]=n}hasDependency(t,e){for(const n of t){const t=this.dependencies[n];if(t)for(const n of e)if(t[n])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,e){if(!e||"mercator"===e.name||this._tileDebugBuffer)return;const n=ma(ip,this.tileID.canonical,this.tileTransform)[0],r=new Io,i=new Xo;for(let o=0;o<n.length;o++){const{x:t,y:e}=n[o];r.emplaceBack(t,e),i.emplaceBack(o)}i.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(i),this._tileDebugBuffer=t.createVertexBuffer(r,xd.members),this._tileDebugSegments=Ks.simpleSegment(0,0,r.length,i.length)}_makeTileBoundsBuffers(t,e){if(this._tileBoundsBuffer||!e||"mercator"===e.name)return;const n=ma(ip,this.tileID.canonical,this.tileTransform)[0];let r,i;if(this.isRaster){const t=function(t,e){const n=Wd(t,e),r=Math.pow(2,t.z);for(let l=0;l<Yd;l++)for(let i=0;i<Yd;i++){const o=oa((t.x+(i+np(i))/Xd)/r),s=sa((t.y+(l+np(l))/Xd)/r),a=e.project(o,s),c=l*Yd+i;Jd[2*c+0]=Math.round((a.x*n.scale-n.x)*Xs),Jd[2*c+1]=Math.round((a.y*n.scale-n.y)*Xs)}tp.fill(0),ep.fill(0);for(let l=2045;l>=0;l--){const t=4*l,e=Qd[t+0],n=Qd[t+1],r=Qd[t+2],i=Qd[t+3],o=e+r>>1,s=n+i>>1,a=o+s-n,c=s+e-o,u=n*Yd+e,h=i*Yd+r,d=s*Yd+o,p=Math.hypot((Jd[2*u+0]+Jd[2*h+0])/2-Jd[2*d+0],(Jd[2*u+1]+Jd[2*h+1])/2-Jd[2*d+1])>=16;if(tp[d]=tp[d]||(p?1:0),l<1022){const t=(n+c>>1)*Yd+(e+a>>1),o=(i+c>>1)*Yd+(r+a>>1);tp[d]=tp[d]||tp[t]||tp[o]}}const i=new Ao,o=new Vo;let s=0;function a(t,e){const n=e*Yd+t;return 0===ep[n]&&(i.emplaceBack(Jd[2*n+0],Jd[2*n+1],t*Xs/Xd,e*Xs/Xd),ep[n]=++s),ep[n]-1}function c(t,e,n,r,i,s){const l=t+n>>1,u=e+r>>1;if(Math.abs(t-i)+Math.abs(e-s)>1&&tp[u*Yd+l])c(i,s,t,e,l,u),c(n,r,i,s,l,u);else{const c=a(t,e),l=a(n,r),u=a(i,s);o.emplaceBack(c,l,u)}}return c(0,0,Xd,Xd,Xd,0),c(Xd,Xd,0,0,0,Xd),{vertices:i,indices:o}}(this.tileID.canonical,e);r=t.vertices,i=t.indices}else{r=new Ao,i=new Vo;for(const{x:e,y:i}of n)r.emplaceBack(e,i,0,0);const t=Lc(r.int16,void 0,4);for(let e=0;e<t.length;e+=3)i.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(r,rp.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(i),this._tileBoundsSegments=Ks.simpleSegment(0,0,r.length,i.length)}_makeGlobeTileDebugBuffers(t,e){if(this._globeTileDebugBorderBuffer||this._globeTileDebugTextBuffer||!e||"globe"!==e.name)return;const n=this.tileID.canonical,r=Nd(kd(n));this._makeGlobeTileDebugBorderBuffer(t,n,r),this._makeGlobeTileDebugTextBuffer(t,n,r)}_makeGlobeTileDebugBorderBuffer(t,e,n){const r=new Io,i=new Xo,o=new ko,s=(t,s,a,c,l)=>{const u=(a-t)/(l-1),h=(c-s)/(l-1),d=r.length;for(let p=0;p<l;p++){const a=t+p*u,c=s+p*h;r.emplaceBack(a,c);const l=Dd(a,c,e),f=cc(l,l,n);o.emplaceBack(f[0],f[1],f[2]),i.emplaceBack(d+p)}},a=Xs;s(0,0,a,0,16),s(a,0,a,a,16),s(a,a,0,a,16),s(0,a,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(i),this._tileDebugBuffer=t.createVertexBuffer(r,xd.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(o,bd.members),this._tileDebugSegments=Ks.simpleSegment(0,0,r.length,i.length)}_makeGlobeTileDebugTextBuffer(t,e,n){const r=new Io,i=new Vo,o=new ko,s=25;i.reserve(32),r.reserve(s),o.reserve(s);const a=(t,e)=>s*t+e;for(let c=0;c<s;c++){const t=2048*c;for(let i=0;i<s;i++){const s=2048*i;r.emplaceBack(s,t);const a=Dd(s,t,e),c=cc(a,a,n);o.emplaceBack(c[0],c[1],c[2])}}for(let c=0;c<4;c++)for(let t=0;t<4;t++){const e=a(c,t),n=a(c,t+1),r=a(c+1,t),o=a(c+1,t+1);i.emplaceBack(e,n,r),i.emplaceBack(r,n,o)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(i),this._tileDebugTextBuffer=t.createVertexBuffer(r,xd.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(o,bd.members),this._tileDebugTextSegments=Ks.simpleSegment(0,0,s,32)}}class sp{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(t,e,n){const r=String(e);if(this.stateChanges[t]=this.stateChanges[t]||{},this.stateChanges[t][r]=this.stateChanges[t][r]||{},b(this.stateChanges[t][r],n),null===this.deletedStates[t]){this.deletedStates[t]={};for(const e in this.state[t])e!==r&&(this.deletedStates[t][e]=null)}else if(this.deletedStates[t]&&null===this.deletedStates[t][r]){this.deletedStates[t][r]={};for(const e in this.state[t][r])n[e]||(this.deletedStates[t][r][e]=null)}else for(const i in n)this.deletedStates[t]&&this.deletedStates[t][r]&&null===this.deletedStates[t][r][i]&&delete this.deletedStates[t][r][i]}removeFeatureState(t,e,n){if(null===this.deletedStates[t])return;const r=String(e);if(this.deletedStates[t]=this.deletedStates[t]||{},n&&void 0!==e)null!==this.deletedStates[t][r]&&(this.deletedStates[t][r]=this.deletedStates[t][r]||{},this.deletedStates[t][r][n]=null);else if(void 0!==e)if(this.stateChanges[t]&&this.stateChanges[t][r])for(n in this.deletedStates[t][r]={},this.stateChanges[t][r])this.deletedStates[t][r][n]=null;else this.deletedStates[t][r]=null;else this.deletedStates[t]=null}getState(t,e){const n=String(e),r=b({},(this.state[t]||{})[n],(this.stateChanges[t]||{})[n]);if(null===this.deletedStates[t])return{};if(this.deletedStates[t]){const n=this.deletedStates[t][e];if(null===n)return{};for(const t in n)delete r[t]}return r}initializeTileState(t,e){t.setFeatureState(this.state,e)}coalesceChanges(t,e){const n={};for(const r in this.stateChanges){this.state[r]=this.state[r]||{};const t={};for(const e in this.stateChanges[r])this.state[r][e]||(this.state[r][e]={}),b(this.state[r][e],this.stateChanges[r][e]),t[e]=this.state[r][e];n[r]=t}for(const r in this.deletedStates){this.state[r]=this.state[r]||{};const t={};if(null===this.deletedStates[r])for(const e in this.state[r])t[e]={},this.state[r][e]={};else for(const e in this.deletedStates[r]){if(null===this.deletedStates[r][e])this.state[r][e]={};else for(const t of Object.keys(this.deletedStates[r][e]))delete this.state[r][e][t];t[e]=this.state[r][e]}n[r]=n[r]||{},b(n[r],t)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(n).length)for(const r in t)t[r].setFeatureState(n,e)}}class ap{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,e){const n=this.toIdx(t,e);return{min:this.minimums[n],max:this.maximums[n]}}isLeaf(t,e){return this.leaves[this.toIdx(t,e)]}toIdx(t,e){return e*this.size+t}}function cp(t,e,n,r){let i=0,o=Number.MAX_VALUE;for(let s=0;s<3;s++)if(Math.abs(r[s])<1e-15){if(n[s]<t[s]||n[s]>e[s])return null}else{const a=1/r[s];let c=(t[s]-n[s])*a,l=(e[s]-n[s])*a;if(c>l){const t=c;c=l,l=t}if(c>i&&(i=c),l<o&&(o=l),i>o)return null}return i}function lp(t,e,n,r,i,o,s,a,c,l,u){const h=r-t,d=i-e,p=o-n,f=s-t,m=a-e,g=c-n,_=u[1]*g-u[2]*m,y=u[2]*f-u[0]*g,v=u[0]*m-u[1]*f,b=h*_+d*y+p*v;if(Math.abs(b)<1e-15)return null;const x=1/b,w=l[0]-t,T=l[1]-e,C=l[2]-n,E=(w*_+T*y+C*v)*x;if(E<0||E>1)return null;const S=T*p-C*d,I=C*h-w*p,k=w*d-T*h,A=(u[0]*S+u[1]*I+u[2]*k)*x;return A<0||E+A>1?null:(f*S+m*I+g*k)*x}function up(t,e,n){return(t-e)/(n-e)}function hp(t,e,n,r,i,o,s,a,c){const l=1<<n,u=o-r,h=s-i,d=(t+1)/l*u+r,p=(e+0)/l*h+i,f=(e+1)/l*h+i;a[0]=(t+0)/l*u+r,a[1]=p,c[0]=d,c[1]=f}class dp{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const e=function(t){const e=Math.ceil(Math.log2(t.dim/8)),n=[];let r=Math.ceil(Math.pow(2,e));const i=1/r,o=(t,e,n,r,i)=>{const o=r?1:0,s=(t+1)*n-o,a=e*n,c=(e+1)*n-o;i[0]=t*n,i[1]=a,i[2]=s,i[3]=c};let s=new ap(r);const a=[];for(let c=0;c<r*r;c++){o(c%r,Math.floor(c/r),i,!1,a);const e=fp(a[0],a[1],t),n=fp(a[2],a[1],t),l=fp(a[2],a[3],t),u=fp(a[0],a[3],t);s.minimums.push(Math.min(e,n,l,u)),s.maximums.push(Math.max(e,n,l,u)),s.leaves.push(1)}for(n.push(s),r/=2;r>=1;r/=2){const t=n[n.length-1];s=new ap(r);for(let e=0;e<r*r;e++){o(e%r,Math.floor(e/r),2,!0,a);const n=t.getElevation(a[0],a[1]),i=t.getElevation(a[2],a[1]),c=t.getElevation(a[2],a[3]),l=t.getElevation(a[0],a[3]),u=t.isLeaf(a[0],a[1]),h=t.isLeaf(a[2],a[1]),d=t.isLeaf(a[2],a[3]),p=t.isLeaf(a[0],a[3]),f=Math.min(n.min,i.min,c.min,l.min),m=Math.max(n.max,i.max,c.max,l.max),g=u&&h&&d&&p;s.maximums.push(m),s.minimums.push(f),s.leaves.push(m-f<=5&&g?1:0)}n.push(s)}return n}(this.dem),n=e.length-1,r=e[n];this._addNode(r.minimums[0],r.maximums[0],r.leaves[0]),this._construct(e,0,0,n,0)}raycastRoot(t,e,n,r,i,o,s=1){return cp([t,e,-100],[n,r,this.maximums[0]*s],i,o)}raycast(t,e,n,r,i,o,s=1){if(!this.nodeCount)return null;const a=this.raycastRoot(t,e,n,r,i,o,s);if(null==a)return null;const c=[],l=[],u=[],h=[],d=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;d.length>0;){const{idx:a,t:p,nodex:f,nodey:m,depth:g}=d.pop();if(this.leaves[a]){hp(f,m,g,t,e,n,r,u,h);const a=1<<g,c=(f+0)/a,l=(f+1)/a,d=(m+0)/a,_=(m+1)/a,y=fp(c,d,this.dem)*s,v=fp(l,d,this.dem)*s,b=fp(l,_,this.dem)*s,x=fp(c,_,this.dem)*s,w=lp(u[0],u[1],y,h[0],u[1],v,h[0],h[1],b,i,o),T=lp(h[0],h[1],b,u[0],h[1],x,u[0],u[1],y,i,o),C=Math.min(null!==w?w:Number.MAX_VALUE,null!==T?T:Number.MAX_VALUE);if(C!==Number.MAX_VALUE)return C;{const t=ic([],i,o,p);if(pp(y,v,x,b,up(t[0],u[0],h[0]),up(t[1],u[1],h[1]))>=t[2])return p}continue}let _=0;for(let d=0;d<this._siblingOffset.length;d++){hp((f<<1)+this._siblingOffset[d][0],(m<<1)+this._siblingOffset[d][1],g+1,t,e,n,r,u,h),u[2]=-100,h[2]=this.maximums[this.childOffsets[a]+d]*s;const p=cp(u,h,i,o);if(null!=p){const t=p;c[d]=t;let e=!1;for(let n=0;n<_&&!e;n++)t>=c[l[n]]&&(l.splice(n,0,d),e=!0);e||(l[_]=d),_++}}for(let t=0;t<_;t++){const e=l[t];d.push({idx:this.childOffsets[a]+e,t:c[e],nodex:(f<<1)+this._siblingOffset[e][0],nodey:(m<<1)+this._siblingOffset[e][1],depth:g+1})}}return null}_addNode(t,e,n){return this.minimums.push(t),this.maximums.push(e),this.leaves.push(n),this.childOffsets.push(0),this.nodeCount++}_construct(t,e,n,r,i){if(1===t[r].isLeaf(e,n))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const o=r-1,s=t[o];let a=0,c=0;for(let l=0;l<this._siblingOffset.length;l++){const t=2*e+this._siblingOffset[l][0],r=2*n+this._siblingOffset[l][1],i=s.getElevation(t,r),o=s.isLeaf(t,r),u=this._addNode(i.min,i.max,o);o&&(a|=1<<l),c||(c=u)}for(let l=0;l<this._siblingOffset.length;l++)a&1<<l||this._construct(t,2*e+this._siblingOffset[l][0],2*n+this._siblingOffset[l][1],o,c+l)}}function pp(t,e,n,r,i,o){return nn(nn(t,n,o),nn(e,r,o),i)}function fp(t,e,n){const r=n.dim,i=m(t*r-.5,0,r-1),o=m(e*r-.5,0,r-1),s=Math.floor(i),a=Math.floor(o),c=Math.min(s+1,r-1),l=Math.min(a+1,r-1);return pp(n.get(s,a),n.get(c,a),n.get(s,l),n.get(c,l),i-s,o-a)}const mp={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};class gp{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,e,n,r=!1,i=!1){if(this.uid=t,e.height!==e.width)throw new RangeError("DEM tiles must be square");if(n&&"mapbox"!==n&&"terrarium"!==n)return P(`"${n}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=e.height;const o=this.dim=e.height-2,s=new Uint32Array(e.data.buffer);if(this.pixels=new Uint8Array(e.data.buffer),this.encoding=n||"mapbox",this.borderReady=r,!r){for(let t=0;t<o;t++)s[this._idx(-1,t)]=s[this._idx(0,t)],s[this._idx(o,t)]=s[this._idx(o-1,t)],s[this._idx(t,-1)]=s[this._idx(t,0)],s[this._idx(t,o)]=s[this._idx(t,o-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(o,-1)]=s[this._idx(o-1,0)],s[this._idx(-1,o)]=s[this._idx(0,o-1)],s[this._idx(o,o)]=s[this._idx(o-1,o-1)],i&&this._buildQuadTree()}}_buildQuadTree(){this._tree=new dp(this)}get(t,e,n=!1){n&&(t=m(t,-1,this.dim),e=m(e,-1,this.dim));const r=4*this._idx(t,e);return("terrarium"===this.encoding?this._unpackTerrarium:this._unpackMapbox)(this.pixels[r],this.pixels[r+1],this.pixels[r+2])}static getUnpackVector(t){return mp[t]}get unpackVector(){return mp[this.encoding]}_idx(t,e){if(t<-1||t>=this.dim+1||e<-1||e>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(e+1)*this.stride+(t+1)}_unpackMapbox(t,e,n){return(256*t*256+256*e+n)/10-1e4}_unpackTerrarium(t,e,n){return 256*t+e+n/256-32768}static pack(t,e){const n=[0,0,0,0],r=gp.getUnpackVector(e);let i=Math.floor((t+r[3])/r[2]);return n[2]=i%256,i=Math.floor(i/256),n[1]=i%256,i=Math.floor(i/256),n[0]=i,n}getPixels(){return new Mc({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,e,n){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let r=e*this.dim,i=e*this.dim+this.dim,o=n*this.dim,s=n*this.dim+this.dim;switch(e){case-1:r=i-1;break;case 1:i=r+1}switch(n){case-1:o=s-1;break;case 1:s=o+1}const a=-e*this.dim,c=-n*this.dim;for(let l=o;l<s;l++)for(let e=r;e<i;e++){const n=4*this._idx(e,l),r=4*this._idx(e+a,l+c);this.pixels[n+0]=t.pixels[r+0],this.pixels[n+1]=t.pixels[r+1],this.pixels[n+2]=t.pixels[r+2],this.pixels[n+3]=t.pixels[r+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}si(gp,"DEMData"),si(dp,"DemMinMaxQuadTree",{omit:["dem"]});class _p{constructor(t,e){this.max=t,this.onRemove=e,this.reset()}reset(){for(const t in this.data)for(const e of this.data[t])e.timeout&&clearTimeout(e.timeout),this.onRemove(e.value);return this.data={},this.order=[],this}add(t,e,n){const r=t.wrapped().key;void 0===this.data[r]&&(this.data[r]=[]);const i={value:e,timeout:void 0};if(void 0!==n&&(i.timeout=setTimeout(()=>{this.remove(t,i)},n)),this.data[r].push(i),this.order.push(r),this.order.length>this.max){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}has(t){return t.wrapped().key in this.data}getAndRemove(t){return this.has(t)?this._getAndRemoveByKey(t.wrapped().key):null}_getAndRemoveByKey(t){const e=this.data[t].shift();return e.timeout&&clearTimeout(e.timeout),0===this.data[t].length&&delete this.data[t],this.order.splice(this.order.indexOf(t),1),e.value}getByKey(t){const e=this.data[t];return e?e[0].value:null}get(t){return this.has(t)?this.data[t.wrapped().key][0].value:null}remove(t,e){if(!this.has(t))return this;const n=t.wrapped().key,r=void 0===e?0:this.data[n].indexOf(e),i=this.data[n][r];return this.data[n].splice(r,1),i.timeout&&clearTimeout(i.timeout),0===this.data[n].length&&delete this.data[n],this.onRemove(i.value),this.order.splice(this.order.indexOf(n),1),this}setMaxSize(t){for(this.max=t;this.order.length>this.max;){const t=this._getAndRemoveByKey(this.order[0]);t&&this.onRemove(t)}return this}filter(t){const e=[];for(const n in this.data)for(const r of this.data[n])t(r.value)||e.push(r);for(const n of e)this.remove(n.value.tileID,n)}}class yp{constructor(t,e,n){this.func=t,this.mask=e,this.range=n}}yp.ReadOnly=!1,yp.ReadWrite=!0,yp.disabled=new yp(519,yp.ReadOnly,[0,1]);const vp=7680;class bp{constructor(t,e,n,r,i,o){this.test=t,this.ref=e,this.mask=n,this.fail=r,this.depthFail=i,this.pass=o}}bp.disabled=new bp({func:519,mask:0},0,0,vp,vp,vp);class xp{constructor(t,e,n){this.blendFunction=t,this.blendColor=e,this.mask=n}}xp.Replace=[1,0],xp.disabled=new xp(xp.Replace,ue.transparent,[!1,!1,!1,!1]),xp.unblended=new xp(xp.Replace,ue.transparent,[!0,!0,!0,!0]),xp.alphaBlended=new xp([1,771],ue.transparent,[!0,!0,!0,!0]);const wp=1029,Tp=2305;class Cp{constructor(t,e,n){this.enable=t,this.mode=e,this.frontFace=n}}Cp.disabled=new Cp(!1,wp,Tp),Cp.backCCW=new Cp(!0,wp,Tp),Cp.backCW=new Cp(!0,wp,2304),Cp.frontCW=new Cp(!0,1028,2304),Cp.frontCCW=new Cp(!0,1028,Tp);class Ep extends Ft{constructor(t,e,n){super(),this.id=t,this._onlySymbols=n,e.on("data",t=>{"source"===t.dataType&&"metadata"===t.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===t.dataType&&"content"===t.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),e.on("error",()=>{this._sourceErrored=!0}),this._source=e,this._tiles={},this._cache=new _p(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._loadedParentTiles={},this._coveredTiles={},this._state=new sp,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(t){this.map=t,this._minTileCacheSize=void 0===this._minTileCacheSize&&t?t._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&t?t._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const t in this._tiles){const e=this._tiles[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const t=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,t&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(t,e){return t.isSymbolTile=this._onlySymbols,this._source.loadTile(t,e)}_unloadTile(t){if(this._source.unloadTile)return this._source.unloadTile(t,()=>{})}_abortTile(t){if(this._source.abortTile)return this._source.abortTile(t,()=>{})}serialize(){return this._source.serialize()}prepare(t){if(this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._source.prepareTile)for(const e in this._tiles){const n=this._tiles[e];this._source.prepareTile(n)&&this.map.painter.terrain&&this.map.painter.terrain._clearRenderCacheForTile(this.id,n.tileID),n.upload(t),n.prepare(this.map.style.imageManager)}else for(const e in this._tiles){const n=this._tiles[e];n.upload(t),n.prepare(this.map.style.imageManager)}}getIds(){return v(this._tiles).map(t=>t.tileID).sort(Sp).map(t=>t.key)}getRenderableIds(t){const e=[];for(const n in this._tiles)this._isIdRenderable(+n,t)&&e.push(this._tiles[n]);return t?e.sort((t,e)=>{const n=t.tileID,r=e.tileID,o=new i(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),s=new i(r.canonical.x,r.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-r.overscaledZ||s.y-o.y||s.x-o.x}).map(t=>t.tileID.key):e.map(t=>t.tileID).sort(Sp).map(t=>t.key)}hasRenderableParent(t){const e=this.findLoadedParent(t,0);return!!e&&this._isIdRenderable(e.tileID.key)}_isIdRenderable(t,e){return this._tiles[t]&&this._tiles[t].hasData()&&!this._coveredTiles[t]&&(e||!this._tiles[t].holdingForFade())}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const t in this._tiles)"errored"!==this._tiles[t].state&&this._reloadTile(+t,"reloading")}}_reloadTile(t,e){const n=this._tiles[t];n&&("loading"!==n.state&&(n.state=e),this._loadTile(n,this._tileLoaded.bind(this,n,t,e)))}_tileLoaded(t,e,n,r){if(r)if(t.state="errored",404!==r.status)this._source.fire(new zt(r,{tile:t}));else if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const t=this.map.painter.terrain;this.update(this.transform,t.getScaledDemTileSize(),!0),t.resetTileLookupCache(this.id)}else this.update(this.transform);else t.timeAdded=G.now(),"expired"===n&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(e,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null),this._source.fire(new jt("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id}))}_backfillDEM(t){const e=this.getRenderableIds();for(let r=0;r<e.length;r++){const i=e[r];if(t.neighboringTiles&&t.neighboringTiles[i]){const e=this.getTileByID(i);n(t,e),n(e,t)}}function n(t,e){if(!t.dem||t.dem.borderReady)return;t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0;let n=e.tileID.canonical.x-t.tileID.canonical.x;const r=e.tileID.canonical.y-t.tileID.canonical.y,i=Math.pow(2,t.tileID.canonical.z),o=e.tileID.key;0===n&&0===r||Math.abs(r)>1||(Math.abs(n)>1&&(1===Math.abs(n+i)?n+=i:1===Math.abs(n-i)&&(n-=i)),e.dem&&t.dem&&(t.dem.backfillBorder(e.dem,n,r),t.neighboringTiles&&t.neighboringTiles[o]&&(t.neighboringTiles[o].backfilled=!0)))}}getTile(t){return this.getTileByID(t.key)}getTileByID(t){return this._tiles[t]}_retainLoadedChildren(t,e,n,r){for(const i in this._tiles){let o=this._tiles[i];if(r[i]||!o.hasData()||o.tileID.overscaledZ<=e||o.tileID.overscaledZ>n)continue;let s=o.tileID;for(;o&&o.tileID.overscaledZ>e+1;){const t=o.tileID.scaledTo(o.tileID.overscaledZ-1);o=this._tiles[t.key],o&&o.hasData()&&(s=t)}let a=s;for(;a.overscaledZ>e;)if(a=a.scaledTo(a.overscaledZ-1),t[a.key]){r[s.key]=s;break}}}findLoadedParent(t,e){if(t.key in this._loadedParentTiles){const n=this._loadedParentTiles[t.key];return n&&n.tileID.overscaledZ>=e?n:null}for(let n=t.overscaledZ-1;n>=e;n--){const e=t.scaledTo(n),r=this._getLoadedTile(e);if(r)return r}}_getLoadedTile(t){const e=this._tiles[t.key];return e&&e.hasData()?e:this._cache.getByKey(this._source.reparseOverscaled?t.wrapped().key:t.canonical.key)}updateCacheSize(t,e){e=e||this._source.tileSize;const n=Math.ceil(t.width/e)+1,r=Math.ceil(t.height/e)+1,i=Math.floor(n*r*5),o="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,i):i,s="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,o):o;this._cache.setMaxSize(s)}handleWrapJump(t){const e=Math.round((t-(void 0===this._prevLng?t:this._prevLng))/360);if(this._prevLng=t,e){const t={};for(const n in this._tiles){const r=this._tiles[n];r.tileID=r.tileID.unwrapTo(r.tileID.wrap+e),t[r.tileID.key]=r}this._tiles=t;for(const e in this._timers)clearTimeout(this._timers[e]),delete this._timers[e];for(const e in this._tiles)this._setTileReloadTimer(+e,this._tiles[e])}}update(t,e,n){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;let r;this.updateCacheSize(t,e),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used||this.usedForTerrain?this._source.tileID?r=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new Gd(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y)):(r=t.coveringTiles({tileSize:e||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain}),this._source.hasTile&&(r=r.filter(t=>this._source.hasTile(t)))):r=[];const i=this._updateRetainedTiles(r);if(Ip(this._source.type)&&0!==r.length){const t={},e={},n=Object.keys(i);for(const r of n){const n=i[r],o=this._tiles[r];if(!o||o.fadeEndTime&&o.fadeEndTime<=G.now())continue;const s=this.findLoadedParent(n,Math.max(n.overscaledZ-Ep.maxOverzooming,this._source.minzoom));s&&(this._addTile(s.tileID),t[s.tileID.key]=s.tileID),e[r]=n}const o=r[r.length-1].overscaledZ;for(const r in this._tiles){const t=this._tiles[r];if(i[r]||!t.hasData())continue;let n=t.tileID;for(;n.overscaledZ>o;){n=n.scaledTo(n.overscaledZ-1);const o=this._tiles[n.key];if(o&&o.hasData()&&e[n.key]){i[r]=t.tileID;break}}}for(const r in t)i[r]||(this._coveredTiles[r]=!0,i[r]=t[r])}for(const s in i)this._tiles[s].clearFadeHold();const o=function(t,e){const n=[];for(const r in t)r in e||n.push(r);return n}(this._tiles,i);for(const s of o){const t=this._tiles[s];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+s)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const t in this._tiles)this._tiles[t].holdingForFade()&&this._removeTile(+t)}_updateRetainedTiles(t){const e={};if(0===t.length)return e;const n={},r=t.reduce((t,e)=>Math.min(t,e.overscaledZ),1/0),i=t[0].overscaledZ,o=Math.max(i-Ep.maxOverzooming,this._source.minzoom),s=Math.max(i+Ep.maxUnderzooming,this._source.minzoom),a={};for(const c of t){const t=this._addTile(c);e[c.key]=c,t.hasData()||r<this._source.maxzoom&&(a[c.key]=c)}this._retainLoadedChildren(a,r,s,e);for(const c of t){let t=this._tiles[c.key];if(t.hasData())continue;if(c.canonical.z>=this._source.maxzoom){const t=c.children(this._source.maxzoom)[0],n=this.getTile(t);if(n&&n.hasData()){e[t.key]=t;continue}}else{const t=c.children(this._source.maxzoom);if(e[t[0].key]&&e[t[1].key]&&e[t[2].key]&&e[t[3].key])continue}let r=t.wasRequested();for(let i=c.overscaledZ-1;i>=o;--i){const o=c.scaledTo(i);if(n[o.key])break;if(n[o.key]=!0,t=this.getTile(o),!t&&r&&(t=this._addTile(o)),t&&(e[o.key]=o,r=t.wasRequested(),t.hasData()))break}}return e}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const t in this._tiles){const e=[];let n,r=this._tiles[t].tileID;for(;r.overscaledZ>0;){if(r.key in this._loadedParentTiles){n=this._loadedParentTiles[r.key];break}e.push(r.key);const t=r.scaledTo(r.overscaledZ-1);if(n=this._getLoadedTile(t),n)break;r=t}for(const t of e)this._loadedParentTiles[t]=n}}_addTile(t){let e=this._tiles[t.key];if(e)return this._source.prepareTile&&this._source.prepareTile(e),e;e=this._cache.getAndRemove(t),e&&(this._setTileReloadTimer(t.key,e),e.tileID=t,this._state.initializeTileState(e,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,e)));const n=Boolean(e);if(!n){const n=this.map?this.map.painter:null;e=new op(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,n,this._isRaster),this._source.prepareTile&&this._source.prepareTile(e)||this._loadTile(e,this._tileLoaded.bind(this,e,t.key,e.state))}return e?(e.uses++,this._tiles[t.key]=e,n||this._source.fire(new jt("dataloading",{tile:e,coord:e.tileID,dataType:"source"})),e):null}_setTileReloadTimer(t,e){t in this._timers&&(clearTimeout(this._timers[t]),delete this._timers[t]);const n=e.getExpiryTimeout();n&&(this._timers[t]=setTimeout(()=>{this._reloadTile(t,"expired"),delete this._timers[t]},n))}_removeTile(t){const e=this._tiles[t];e&&(e.uses--,delete this._tiles[t],this._timers[t]&&(clearTimeout(this._timers[t]),delete this._timers[t]),e.uses>0||(e.hasData()&&"reloading"!==e.state?this._cache.add(e.tileID,e,e.getExpiryTimeout()):(e.aborted=!0,this._abortTile(e),this._unloadTile(e))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const t in this._tiles)this._removeTile(+t);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,e,n){const r=[],i=this.transform;if(!i)return r;for(const o in this._tiles){const s=this._tiles[o];if(n&&s.clearQueryDebugViz(),s.holdingForFade())continue;const a=t.containsTile(s,i,e);a&&r.push(a)}return r}getVisibleCoordinates(t){const e=this.getRenderableIds(t).map(t=>this._tiles[t].tileID);for(const n of e)n.projMatrix=this.transform.calculateProjMatrix(n.toUnwrapped());return e}hasTransition(){if(this._source.hasTransition())return!0;if(Ip(this._source.type))for(const t in this._tiles){const e=this._tiles[t];if(void 0!==e.fadeEndTime&&e.fadeEndTime>=G.now())return!0}return!1}setFeatureState(t,e,n){this._state.updateState(t=t||"_geojsonTileLayer",e,n)}removeFeatureState(t,e,n){this._state.removeFeatureState(t=t||"_geojsonTileLayer",e,n)}getFeatureState(t,e){return this._state.getState(t=t||"_geojsonTileLayer",e)}setDependencies(t,e,n){const r=this._tiles[t];r&&r.setDependencies(e,n)}reloadTilesForDependencies(t,e){for(const n in this._tiles)this._tiles[n].hasDependency(t,e)&&this._reloadTile(+n,"reloading");this._cache.filter(n=>!n.hasDependency(t,e))}_preloadTiles(t,e){const n=new Map,r=Array.isArray(t)?t:[t],i=this.map.painter.terrain,o=this.usedForTerrain&&i?i.getScaledDemTileSize():this._source.tileSize;for(const s of r){const t=s.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)n.set(e.key,e);this.usedForTerrain&&s.updateElevation(!1)}y(Array.from(n.values()),(t,e)=>{const n=new op(t,this._source.tileSize*t.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster);this._loadTile(n,t=>{"raster-dem"===this._source.type&&n.dem&&this._backfillDEM(n),e(t,n)})},e)}}function Sp(t,e){const n=Math.abs(2*t.wrap)-+(t.wrap<0),r=Math.abs(2*e.wrap)-+(e.wrap<0);return t.overscaledZ-e.overscaledZ||r-n||e.canonical.y-t.canonical.y||e.canonical.x-t.canonical.x}function Ip(t){return"raster"===t||"image"===t||"video"===t}Ep.maxOverzooming=10,Ep.maxUnderzooming=3;class kp{constructor(t,e,n){this._demTile=t,this._dem=this._demTile.dem,this._scale=e,this._offset=n}static create(t,e,n){const r=n||t.findDEMTileFor(e);if(!r||!r.dem)return;const i=r.dem,o=r.tileID,s=1<<e.canonical.z-o.canonical.z;return new kp(r,r.tileSize/Xs/s,[(e.canonical.x/s-o.canonical.x)*i.dim,(e.canonical.y/s-o.canonical.y)*i.dim])}tileCoordToPixel(t,e){const n=e*this._scale+this._offset[1],r=Math.floor(t*this._scale+this._offset[0]),o=Math.floor(n);return new i(r,o)}getElevationAt(t,e,n,r){const i=t*this._scale+this._offset[0],o=e*this._scale+this._offset[1],s=Math.floor(i),a=Math.floor(o),c=this._dem;return r=!!r,n?nn(nn(c.get(s,a,r),c.get(s,a+1,r),o-a),nn(c.get(s+1,a,r),c.get(s+1,a+1,r),o-a),i-s):c.get(s,a,r)}getElevationAtPixel(t,e,n){return this._dem.get(t,e,!!n)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ia(1,t)*this._dem.stride}}class Ap{constructor(t,e){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new ri(Xs,16,0),this.featureIndexArray=new us,this.promoteId=e}insert(t,e,n,r,i,o=0){const s=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(n,r,i,o);const a=this.grid;for(let c=0;c<e.length;c++){const t=e[c],n=[1/0,1/0,-1/0,-1/0];for(let e=0;e<t.length;e++){const r=t[e];n[0]=Math.min(n[0],r.x),n[1]=Math.min(n[1],r.y),n[2]=Math.max(n[2],r.x),n[3]=Math.max(n[3],r.y)}n[0]<Xs&&n[1]<Xs&&n[2]>=0&&n[3]>=0&&a.insert(s,n[0],n[1],n[2],n[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Dl.VectorTile(new wu(this.rawTileData)).layers,this.sourceLayerCoder=new Hd(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,e,n,r){this.loadVTLayers();const i=t.params||{},o=Er(i.filter),s=t.tileResult,a=t.transform,c=s.bufferedTilespaceBounds,l=this.grid.query(c.min.x,c.min.y,c.max.x,c.max.y,(t,e,n,r)=>Ma(s.bufferedTilespaceGeometry,t,e,n,r));l.sort(Op);let u=null;a.elevation&&l.length>0&&(u=kp.create(a.elevation,this.tileID));const h={};let d;for(let p=0;p<l.length;p++){const a=l[p];if(a===d)continue;d=a;const c=this.featureIndexArray.get(a);let f=null;this.loadMatchingFeature(h,c,o,i.layers,i.availableImages,e,n,r,(e,n,r,i=0)=>(f||(f=ma(e,this.tileID.canonical,t.tileTransform)),n.queryIntersectsFeature(s,e,r,f,this.z,t.transform,t.pixelPosMatrix,u,i)))}return h}loadMatchingFeature(t,e,n,r,i,o,s,a,c){const{featureIndex:l,bucketIndex:u,sourceLayerIndex:h,layoutVertexArrayOffset:d}=e,p=this.bucketLayerIDs[u];if(r&&!function(t,e){for(let n=0;n<t.length;n++)if(e.indexOf(t[n])>=0)return!0;return!1}(r,p))return;const f=this.sourceLayerCoder.decode(h),m=this.vtLayers[f].feature(l);if(n.needGeometry){const t=ga(m,!0);if(!n.filter(new oo(this.tileID.overscaledZ),t,this.tileID.canonical))return}else if(!n.filter(new oo(this.tileID.overscaledZ),m))return;const g=this.getId(m,f);for(let _=0;_<p.length;_++){const e=p[_];if(r&&r.indexOf(e)<0)continue;const n=o[e];if(!n)continue;let u={};void 0!==g&&a&&(u=a.getState(n.sourceLayer||"_geojsonTileLayer",g));const h=b({},s[e]);h.paint=Mp(h.paint,n.paint,m,u,i),h.layout=Mp(h.layout,n.layout,m,u,i);const f=!c||c(m,n,u,d);if(!f)continue;const y=new Kd(m,this.z,this.x,this.y,g);y.layer=h;let v=t[e];void 0===v&&(v=t[e]=[]),v.push({featureIndex:l,feature:y,intersectionZ:f})}}lookupSymbolFeatures(t,e,n,r,i,o,s,a){const c={};this.loadVTLayers();const l=Er(i);for(const u of t)this.loadMatchingFeature(c,{bucketIndex:n,sourceLayerIndex:r,featureIndex:u,layoutVertexArrayOffset:0},l,o,s,a,e);return c}loadFeature(t){const{featureIndex:e,sourceLayerIndex:n}=t;this.loadVTLayers();const r=this.sourceLayerCoder.decode(n),i=this.vtFeatures[r];if(i[e])return i[e];const o=this.vtLayers[r].feature(e);return i[e]=o,o}hasLayer(t){for(const e of this.bucketLayerIDs)for(const n of e)if(t===n)return!0;return!1}getId(t,e){let n=t.id;return this.promoteId&&(n=t.properties["string"==typeof this.promoteId?this.promoteId:this.promoteId[e]],"boolean"==typeof n&&(n=Number(n))),n}}function Mp(t,e,n,r,i){return k(t,(t,o)=>{const s=e instanceof fo?e.get(o):null;return s&&s.evaluate?s.evaluate(n,r,i):s})}function Op(t,e){return e-t}si(Ap,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});class Pp{constructor(t){const e={},n=[];for(const s in t){const r=t[s],i=e[s]={};for(const t in r.glyphs){const e=r.glyphs[+t];if(!e||0===e.bitmap.width||0===e.bitmap.height)continue;const o=e.metrics.localGlyph?2:1,s={x:0,y:0,w:e.bitmap.width+2*o,h:e.bitmap.height+2*o};n.push(s),i[t]=s}}const{w:r,h:i}=$u(n),o=new Ac({width:r||1,height:i||1});for(const s in t){const n=t[s];for(const t in n.glyphs){const r=n.glyphs[+t];if(!r||0===r.bitmap.width||0===r.bitmap.height)continue;const i=e[s][t],a=r.metrics.localGlyph?2:1;Ac.copy(r.bitmap,o,{x:0,y:0},{x:i.x+a,y:i.y+a},r.bitmap)}}this.image=o,this.positions=e}}si(Pp,"GlyphAtlas");class Dp{constructor(t){this.tileID=new Gd(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.collectResourceTiming,this.returnDependencies=!!t.returnDependencies,this.promoteId=t.promoteId,this.enableTerrain=!!t.enableTerrain,this.isSymbolTile=t.isSymbolTile,this.tileTransform=Wd(t.tileID.canonical,t.projection),this.projection=t.projection}parse(t,e,n,r,i){this.status="parsing",this.data=t,this.collisionBoxArray=new ns;const o=new Hd(Object.keys(t.layers).sort()),s=new Ap(this.tileID,this.promoteId);s.bucketLayerIDs=[];const a={},c=new dd(256,256),l={featureIndex:s,iconDependencies:{},patternDependencies:{},glyphDependencies:{},lineAtlas:c,availableImages:n},u=e.familiesBySource[this.source];for(const v in u){const e=t.layers[v];if(!e)continue;let r=!1,i=!1;for(const t of u[v])"symbol"===t[0].type?r=!0:i=!0;if(!0===this.isSymbolTile&&!r)continue;if(!1===this.isSymbolTile&&!i)continue;1===e.version&&P(`Vector tile source "${this.source}" layer "${v}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const c=o.encode(v),h=[];for(let t=0;t<e.length;t++){const n=e.feature(t),r=s.getId(n,v);h.push({feature:n,id:r,index:t,sourceLayerIndex:c})}for(const t of u[v]){const e=t[0];void 0!==this.isSymbolTile&&"symbol"===e.type!==this.isSymbolTile||e.minzoom&&this.zoom<Math.floor(e.minzoom)||e.maxzoom&&this.zoom>=e.maxzoom||"none"!==e.visibility&&(Rp(t,this.zoom,n),(a[e.id]=e.createBucket({index:s.bucketLayerIDs.length,layers:t,zoom:this.zoom,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:c,sourceID:this.source,enableTerrain:this.enableTerrain,projection:this.projection.name,availableImages:n})).populate(h,l,this.tileID.canonical,this.tileTransform),s.bucketLayerIDs.push(t.map(t=>t.id)))}}let h,d,p,f;c.trim();const m={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},g=k(l.glyphDependencies,t=>Object.keys(t).map(Number));Object.keys(g).length?r.send("getGlyphs",{uid:this.uid,stacks:g},(t,e)=>{h||(h=t,d=e,b.call(this))},void 0,!1,m):d={};const _=Object.keys(l.iconDependencies);_.length?r.send("getImages",{icons:_,source:this.source,tileID:this.tileID,type:"icons"},(t,e)=>{h||(h=t,p=e,b.call(this))},void 0,!1,m):p={};const y=Object.keys(l.patternDependencies);function b(){if(h)return i(h);if(d&&p&&f){const t=new Pp(d),e=new Hu(p,f);for(const r in a){const i=a[r];i instanceof td?(Rp(i.layers,this.zoom,n),zh(i,d,t.positions,p,e.iconPositions,this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection)):i.hasPattern&&(i instanceof Jl||i instanceof yl||i instanceof Bl)&&(Rp(i.layers,this.zoom,n),i.addFeatures(l,this.tileID.canonical,e.patternPositions,n,this.tileTransform))}this.status="done",i(null,{buckets:v(a).filter(t=>!t.isEmpty()),featureIndex:s,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:t.image,lineAtlas:c,imageAtlas:e,glyphMap:this.returnDependencies?d:null,iconMap:this.returnDependencies?p:null,glyphPositions:this.returnDependencies?t.positions:null})}}y.length?r.send("getImages",{icons:y,source:this.source,tileID:this.tileID,type:"patterns"},(t,e)=>{h||(h=t,f=e,b.call(this))},void 0,!1,m):f={},b.call(this)}}function Rp(t,e,n){const r=new oo(e);for(const i of t)i.recalculate(r,n)}class Np{constructor(t){this.entries={},this.scheduler=t}request(t,e,n,r){const i=this.entries[t]=this.entries[t]||{callbacks:[]};if(i.result){const[t,n]=i.result;return this.scheduler?this.scheduler.add(()=>{r(t,n)},e):r(t,n),()=>{}}return i.callbacks.push(r),i.cancel||(i.cancel=n((n,r)=>{i.result=[n,r];for(const t of i.callbacks)this.scheduler?this.scheduler.add(()=>{t(n,r)},e):t(n,r);setTimeout(()=>delete this.entries[t],3e3)})),()=>{i.result||(i.callbacks=i.callbacks.filter(t=>t!==r),i.callbacks.length||(i.cancel(),delete this.entries[t]))}}}function Lp(t,e,n){const r=JSON.stringify(t.request);return t.data&&(this.deduped.entries[r]={result:[null,t.data]}),this.deduped.request(r,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom},e=>{const r=It(t.request,(t,r,i,o)=>{t?e(t):r&&e(null,{vectorTile:n?void 0:new Dl.VectorTile(new wu(r)),rawData:r,cacheControl:i,expires:o})});return()=>{r.cancel(),e()}},e)}const jp=Ua(new Float32Array(16));class zp{constructor(t){this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,e){return{x:0,y:0,z:0}}unproject(t,e){return new Js(0,0)}projectTilePoint(t,e,n){return{x:t,y:e,z:0}}locationPoint(t,e){return t._coordinatePoint(t.locationCoordinate(e),!1)}pixelsPerMeter(t,e){return ia(1,t)*e}farthestPixelDistance(t){return function(t,e){const n=t.fovAboveCenter,r=t.elevation?t.elevation.getMinElevationBelowMSL()*e:0,i=(t._camera.position[2]*t.worldSize-r)/Math.cos(t._pitch),o=Math.sin(n)*i/Math.sin(Math.max(Math.PI/2-t._pitch-n,.01)),s=Math.sin(t._pitch)*o+i;return Math.min(1.01*s,i*(1/t._horizonShift))}(t,t.pixelsPerMeter)}pointCoordinate(t,e,n,r){const o=t.horizonLineFromTop(!1),s=new i(e,Math.max(o,n));return t.rayIntersectionCoordinate(t.pointRayIntersection(s,r))}createInversionMatrix(t,e){return jp}createTileMatrix(t,e,n){let r,i,o;const s=n.canonical,a=Ua(new Float64Array(16));if(this.isReprojectedInTileSpace){const c=Wd(s,this);r=1,i=c.x+n.wrap*c.scale,o=c.y,Ga(a,a,[r/c.scale,r/c.scale,t.pixelsPerMeter/e])}else r=e/t.zoomScale(s.z),i=(s.x+Math.pow(2,s.z)*n.wrap)*r,o=s.y*r;return qa(a,a,[i,o,0]),Ga(a,a,[r/Xs,r/Xs,1]),a}upVector(t,e,n){return[0,0,1]}upVectorScale(t,e,n){return{metersToTile:1,metersToLabelSpace:1}}}class Fp extends zp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,e){return{x:na(t),y:ra(e),z:0}}unproject(t,e){const n=oa(t),r=sa(e);return new Js(n,r)}}class Bp extends zp{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[e,n]=this.parallels=t.parallels||[29.5,45.5],r=Math.sin(l(e));this.n=(r+Math.sin(l(n)))/2,this.c=1+r*(2*this.n-r),this.r0=Math.sqrt(this.c)/this.n}project(t,e){const{n:n,c:r,r0:i}=this,o=l(t-this.center[0]),s=l(e),a=Math.sqrt(r-2*n*Math.sin(s))/n;return{x:a*Math.sin(o*n),y:a*Math.cos(o*n)-i,z:0}}unproject(t,e){const{n:n,c:r,r0:i}=this,o=i+e;let s=Math.atan2(t,Math.abs(o))*Math.sign(o);o*n<0&&(s-=Math.PI*Math.sign(t)*Math.sign(o));const a=l(this.center[0])*n;s=_(s,-Math.PI-a,Math.PI-a);const c=u(s/n)+this.center[0],h=Math.asin(m((r-(t*t+o*o)*n*n)/(2*n),-1,1)),d=m(u(h),-85.051129,ca);return new Js(c,d)}}const Up=1.340264,Vp=-.081106,qp=893e-6,Gp=.003796,$p=Math.sqrt(3)/2;class Wp extends zp{project(t,e){e=e/180*Math.PI,t=t/180*Math.PI;const n=Math.asin($p*Math.sin(e)),r=n*n,i=r*r*r;return{x:.5*(t*Math.cos(n)/($p*(Up+3*Vp*r+i*(7*qp+9*Gp*r)))/Math.PI+.5),y:1-.5*(n*(Up+Vp*r+i*(qp+Gp*r))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let n=e=(2*(1-e)-1)*Math.PI,r=n*n,i=r*r*r;for(let l,u,h,d=0;d<12&&(u=n*(Up+Vp*r+i*(qp+Gp*r))-e,h=Up+3*Vp*r+i*(7*qp+9*Gp*r),l=u/h,n=m(n-l,-Math.PI/3,Math.PI/3),r=n*n,i=r*r*r,!(Math.abs(l)<1e-12));++d);const o=$p*t*(Up+3*Vp*r+i*(7*qp+9*Gp*r))/Math.cos(n),s=Math.asin(Math.sin(n)/$p),a=m(180*o/Math.PI,-180,180),c=m(180*s/Math.PI,-85.051129,ca);return new Js(a,c)}}class Hp extends zp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){return{x:.5+t/360,y:.5-e/360,z:0}}unproject(t,e){const n=360*(t-.5),r=m(360*(.5-e),-85.051129,ca);return new Js(n,r)}}const Zp=Math.PI/2;function Kp(t){return Math.tan((Zp+t)/2)}class Xp extends zp{constructor(t){super(t),this.center=t.center||[0,30];const[e,n]=this.parallels=t.parallels||[30,30],r=l(e),i=l(n),o=Math.cos(r);this.n=r===i?Math.sin(r):Math.log(o/Math.cos(i))/Math.log(Kp(i)/Kp(r)),this.f=o*Math.pow(Kp(r),this.n)/this.n}project(t,e){e=l(e),t=l(t-this.center[0]);const n=1e-6,{n:r,f:i}=this;i>0?e<-Zp+n&&(e=-Zp+n):e>Zp-n&&(e=Zp-n);const o=i/Math.pow(Kp(e),r),s=o*Math.sin(r*t),a=i-o*Math.cos(r*t);return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+.5),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI,e=(2*(1-e)-.5)*Math.PI;const{n:n,f:r}=this,i=r-e,o=Math.sign(i),s=Math.sign(n)*Math.sqrt(t*t+i*i);let a=Math.atan2(t,Math.abs(i))*o;i*n<0&&(a-=Math.PI*Math.sign(t)*o);const c=m(u(a/n)+this.center[0],-180,180),l=m(u(2*Math.atan(Math.pow(r/s,1/n))-Zp),-85.051129,ca);return new Js(c,l)}}const Yp=l(ca);class Qp extends zp{project(t,e){const n=(e=l(e))*e,r=n*n;return{x:.5*((t=l(t))*(.8707-.131979*n+r*(r*(.003971*n-.001529*r)-.013791))/Math.PI+.5),y:1-.5*(e*(1.007226+n*(.015085+r*(.028874*n-.044475-.005916*r)))/Math.PI+1),z:0}}unproject(t,e){t=(2*t-.5)*Math.PI;let n=e=(2*(1-e)-1)*Math.PI,r=25,i=0,o=n*n;do{o=n*n;const t=o*o;i=(n*(1.007226+o*(.015085+t*(.028874*o-.044475-.005916*t)))-e)/(1.007226+o*(.045255+t*(.259866*o-.311325-.005916*11*t))),n=m(n-i,-Yp,Yp)}while(Math.abs(i)>1e-6&&--r>0);o=n*n;const s=m(u(t/(.8707+o*(o*(o*o*o*(.003971-.001529*o)-.013791)-.131979))),-180,180),a=u(n);return new Js(s,a)}}const Jp=l(ca);class tf extends zp{project(t,e){e=l(e),t=l(t);const n=Math.cos(e),r=2/Math.PI,i=Math.acos(n*Math.cos(t/2)),o=Math.sin(i)/i,s=.5*(t*r+2*n*Math.sin(t/2)/o)||0,a=.5*(e+Math.sin(e)/o)||0;return{x:.5*(s/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(t,e){let n=t=(2*t-.5)*Math.PI,r=e=(2*(1-e)-1)*Math.PI,i=25;const o=1e-6;let s=0,a=0;do{const i=Math.cos(r),o=Math.sin(r),c=2*o*i,l=o*o,u=i*i,h=Math.cos(n/2),d=Math.sin(n/2),p=2*h*d,f=d*d,g=1-u*h*h,_=g?1/g:0,y=g?Math.acos(i*h)*Math.sqrt(1/g):0,v=.5*(2*y*i*d+2*n/Math.PI)-t,b=.5*(y*o+r)-e,x=.5*_*(u*f+y*i*h*l)+1/Math.PI,w=_*(p*c/4-y*o*d),T=.125*_*(c*d-y*o*u*p),C=.5*_*(l*h+y*f*i)+.5,E=w*T-C*x;s=(b*w-v*C)/E,a=(v*T-b*x)/E,n=m(n-s,-Math.PI,Math.PI),r=m(r-a,-Jp,Jp)}while((Math.abs(s)>o||Math.abs(a)>o)&&--i>0);return new Js(u(n),u(r))}}class ef extends zp{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(l(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,e){const{scale:n,cosPhi:r}=this;return{x:l(t)*r*n+.5,y:-Math.sin(l(e))/r*n+.5,z:0}}unproject(t,e){const{scale:n,cosPhi:r}=this,i=-(e-.5)/n,o=m(u((t-.5)/n)/r,-180,180),s=Math.asin(m(i*r,-1,1)),a=m(u(s),-85.051129,ca);return new Js(o,a)}}t.ARRAY_TYPE=Fa,t.AUTH_ERR_MSG=tt,t.Aabb=vc,t.Actor=class{constructor(t,e,n){this.target=t,this.parent=e,this.mapId=n,this.callbacks={},this.cancelCallbacks={},S(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.globalScope=N()?t:s,this.scheduler=new gd}send(t,e,n,r,i=!1,o){const s=Math.round(1e18*Math.random()).toString(36).substring(0,10);n&&(n.metadata=o,this.callbacks[s]=n);const a=V(this.globalScope)?void 0:[];return this.target.postMessage({id:s,type:t,hasCallback:!!n,targetMapId:r,mustQueue:i,sourceMapId:this.mapId,data:li(e,a)},a),{cancel:()=>{n&&delete this.callbacks[s],this.target.postMessage({id:s,type:"<cancel>",targetMapId:r,sourceMapId:this.mapId})}}}receive(t){const e=t.data,n=e.id;if(n&&(!e.targetMapId||this.mapId===e.targetMapId))if("<cancel>"===e.type){const t=this.cancelCallbacks[n];delete this.cancelCallbacks[n],t&&t.cancel()}else if(e.mustQueue||N()){const t=this.callbacks[n];this.cancelCallbacks[n]=this.scheduler.add(()=>this.processTask(n,e),t&&t.metadata||{type:"message"})}else this.processTask(n,e)}processTask(t,e){if("<response>"===e.type){const n=this.callbacks[t];delete this.callbacks[t],n&&(e.error?n(ui(e.error)):n(null,ui(e.data)))}else{const n=V(this.globalScope)?void 0:[],r=e.hasCallback?(e,r)=>{delete this.cancelCallbacks[t],this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:e?li(e):null,data:li(r,n)},n)}:t=>{},i=ui(e.data);if(this.parent[e.type])this.parent[e.type](e.sourceMapId,i,r);else if(this.parent.getWorkerSource){const t=e.type.split(".");this.parent.getWorkerSource(e.sourceMapId,t[0],i.source)[t[1]](i,r)}else r(new Error(`Could not find function ${e.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}},t.CanonicalTileID=Vd,t.Color=ue,t.ColorMode=xp,t.CullFaceMode=Cp,t.DEMData=gp,t.DataConstantProperty=mo,t.DedupedRequest=Np,t.DepthMode=yp,t.EXTENT=Xs,t.Elevation=class{isDataAvailableAtPoint(t){const e=this._source();if(!e||t.y<0||t.y>1)return!1;const n=e.getSource().maxzoom,r=1<<n,i=Math.floor(t.x),o=Math.floor((t.x-i)*r),s=Math.floor(t.y*r),a=this.findDEMTileFor(new Gd(n,i,n,o,s));return!(!a||!a.dem)}getAtPointOrZero(t,e=0){return this.getAtPoint(t,e)||0}getAtPoint(t,e,n=!0){null==e&&(e=null);const r=this._source();if(!r)return e;if(t.y<0||t.y>1)return e;const i=r.getSource().maxzoom,o=1<<i,s=Math.floor(t.x),a=t.x-s,c=new Gd(i,s,i,Math.floor(a*o),Math.floor(t.y*o)),l=this.findDEMTileFor(c);if(!l||!l.dem)return e;const u=l.dem,h=1<<l.tileID.canonical.z,d=(a*h-l.tileID.canonical.x)*u.dim,p=(t.y*h-l.tileID.canonical.y)*u.dim,f=Math.floor(d),m=Math.floor(p);return(n?this.exaggeration():1)*nn(nn(u.get(f,m),u.get(f,m+1),p-m),nn(u.get(f+1,m),u.get(f+1,m+1),p-m),d-f)}getAtTileOffset(t,e,n){const r=1<<t.canonical.z;return this.getAtPointOrZero(new la(t.wrap+(t.canonical.x+e/Xs)/r,(t.canonical.y+n/Xs)/r))}getAtTileOffsetFunc(t,e,n,r){return i=>{const o=this.getAtTileOffset(t,i.x,i.y),s=r.upVector(t.canonical,i.x,i.y);return rc(s,s,o*r.upVectorScale(t.canonical,e,n).metersToTile),s}}getForTilePoints(t,e,n,r){const i=kp.create(this,t,r);return!!i&&(e.forEach(t=>{t[2]=this.exaggeration()*i.getElevationAt(t[0],t[1],n)}),!0)}getMinMaxForTile(t){const e=this.findDEMTileFor(t);if(!e||!e.dem)return null;const n=e.dem.tree,r=e.tileID,i=1<<t.canonical.z-r.canonical.z;let o=t.canonical.x/i-r.canonical.x,s=t.canonical.y/i-r.canonical.y,a=0;for(let c=0;c<t.canonical.z-r.canonical.z&&!n.leaves[a];c++){o*=2,s*=2;const t=2*Math.floor(s)+Math.floor(o);a=n.childOffsets[a]+t,o%=1,s%=1}return{min:this.exaggeration()*n.minimums[a],max:this.exaggeration()*n.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(t,e,n){throw new Error("Pure virtual method called.")}pointCoordinate(t){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(t){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}},t.ErrorEvent=zt,t.EvaluationParameters=oo,t.Event=jt,t.Evented=Ft,t.FillExtrusionBucket=Bl,t.Frustum=yc,t.GLOBE_RADIUS=wd,t.GlobeSharedBuffers=class{constructor(t){this._createGrid(t),this._createPoles(t),this._createAtmosphere(t)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const t of this._poleSegments)t.destroy();this._gridSegments.destroy(),this.atmosphereVertexBuffer.destroy(),this.atmosphereIndexBuffer.destroy(),this.atmosphereSegments.destroy(),this._wireframeIndexBuffer&&(this._wireframeIndexBuffer.destroy(),this._wireframeSegments.destroy())}_createGrid(t){const e=new Io,n=new Vo,r=65;for(let i=0;i<r;i++)for(let t=0;t<r;t++)e.emplaceBack(t,i);for(let i=0;i<64;i++)for(let t=0;t<64;t++){const e=i*r+t;n.emplaceBack(e+1,e,e+r),n.emplaceBack(e+r,e+r+1,e+1)}this._gridBuffer=t.createVertexBuffer(e,xd.members),this._gridIndexBuffer=t.createIndexBuffer(n,!0),this._gridSegments=Ks.simpleSegment(0,0,4225,8192)}_createPoles(t){const e=new Vo;for(let i=0;i<=64;i++)e.emplaceBack(0,i+1,i+2);this._poleIndexBuffer=t.createIndexBuffer(e,!0);const n=new Wo,r=new Wo;this._poleSegments=[];for(let i=0,o=0;i<5;i++){const t=1<<i,e=512*t/Math.PI/2,s=360/t;n.emplaceBack(0,-e,0,0,0,.5,0),r.emplaceBack(0,-e,0,0,0,.5,1);for(let i=0;i<=64;i++){const t=i/64,o=nn(0,s,t),[a,c,l]=Od(Fd,Bd,o,e);n.emplaceBack(a,c,l,0,0,t,0),r.emplaceBack(a,c,l,0,0,t,1)}this._poleSegments.push(Ks.simpleSegment(o,0,66,64)),o+=66}this._poleNorthVertexBuffer=t.createVertexBuffer(n,vd,!1),this._poleSouthVertexBuffer=t.createVertexBuffer(r,vd,!1)}_createAtmosphere(t){const e=new Ho;e.emplaceBack(-1,1,1,0,0),e.emplaceBack(1,1,1,1,0),e.emplaceBack(1,-1,1,1,1),e.emplaceBack(-1,-1,1,0,1);const n=new Vo;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.atmosphereVertexBuffer=t.createVertexBuffer(e,yd.members),this.atmosphereIndexBuffer=t.createIndexBuffer(n),this.atmosphereSegments=Ks.simpleSegment(0,0,4,2)}getGridBuffers(){return[this._gridBuffer,this._gridIndexBuffer,this._gridSegments]}getPoleBuffers(t){return[this._poleNorthVertexBuffer,this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[t]]}getWirefameBuffers(t){if(!this._wireframeSegments){const e=new Ko,n=64,r=n+1;for(let t=0;t<n;t++)for(let i=0;i<n;i++){const n=t*r+i;e.emplaceBack(n,n+1),e.emplaceBack(n,n+r),e.emplaceBack(n,n+r+1)}this._wireframeIndexBuffer=t.createIndexBuffer(e),this._wireframeSegments=Ks.simpleSegment(0,0,n*n,e.length)}return[this._gridBuffer,this._wireframeIndexBuffer,this._wireframeSegments]}},t.GlyphManager=Th,t.ImagePosition=Wu,t.LineAtlas=dd,t.LngLat=Js,t.LngLatBounds=Ys,t.LocalGlyphMode=wh,t.MAX_MERCATOR_LATITUDE=ca,t.MercatorCoordinate=la,t.ONE_EM=uu,t.OverscaledTileID=Gd,t.Properties=bo,t.RGBAImage=Mc,t.Ray=class{constructor(t,e){this.pos=t,this.dir=e}intersectsPlane(t,e,n){const r=sc(e,this.dir);if(Math.abs(r)<1e-6)return!1;const i=((t[0]-this.pos[0])*e[0]+(t[1]-this.pos[1])*e[1]+(t[2]-this.pos[2])*e[2])/r;return n[0]=this.pos[0]+this.dir[0]*i,n[1]=this.pos[1]+this.dir[1]*i,n[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(t,e,n){if(function(t,e){var n=t[0],r=t[1],i=t[2],o=e[0],s=e[1],a=e[2];return Math.abs(n-o)<=za*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(r-s)<=za*Math.max(1,Math.abs(r),Math.abs(s))&&Math.abs(i-a)<=za*Math.max(1,Math.abs(i),Math.abs(a))}(this.pos,t)||0===e)return n[0]=n[1]=n[2]=0,!1;const[r,i,o]=this.dir,s=this.pos[0]-t[0],a=this.pos[1]-t[1],c=this.pos[2]-t[2],l=r*r+i*i+o*o,u=2*(s*r+a*i+c*o),h=u*u-4*l*(s*s+a*a+c*c-e*e);if(h<0){const t=Math.max(-u/2,0),l=s+r*t,h=a+i*t,d=c+o*t,p=Math.hypot(l,h,d);return n[0]=l*e/p,n[1]=h*e/p,n[2]=d*e/p,!1}{const t=(-u-Math.sqrt(h))/(2*l);if(t<0){const t=Math.hypot(s,a,c);return n[0]=s*e/t,n[1]=a*e/t,n[2]=c*e/t,!1}return n[0]=s+r*t,n[1]=a+i*t,n[2]=c+o*t,!0}}},t.RequestManager=class{constructor(t,e,n){this._transformRequestFn=t,this._customAccessToken=e,this._silenceAuthErrors=!!n,this._createSkuToken()}_createSkuToken(){const t=function(){let t="";for(let e=0;e<10;e++)t+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",J,t].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=t.token,this._skuTokenExpiresAt=t.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(t,e){return this._transformRequestFn&&this._transformRequestFn(t,e)||{url:t}}normalizeStyleURL(t,e){if(!et(t))return t;const n=it(t);return n.path=`/styles/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeGlyphsURL(t,e){if(!et(t))return t;const n=it(t);return n.path=`/fonts/v1${n.path}`,this._makeAPIURL(n,this._customAccessToken||e)}normalizeSourceURL(t,e){if(!et(t))return t;const n=it(t);return n.path=`/v4/${n.authority}.json`,n.params.push("secure"),this._makeAPIURL(n,this._customAccessToken||e)}normalizeSpriteURL(t,e,n,r){const i=it(t);return et(t)?(i.path=`/styles/v1${i.path}/sprite${e}${n}`,this._makeAPIURL(i,this._customAccessToken||r)):(i.path+=`${e}${n}`,ot(i))}normalizeTileURL(t,e,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!et(t))return t;const r=it(t);r.path=r.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${e||n&&"raster"!==r.authority&&512===n?"@2x":""}${H.supported?".webp":"$1"}`),"raster"===r.authority?r.path=`/${W.RASTER_URL_PREFIX}${r.path}`:(r.path=r.path.replace(/^.+\/v4\//,"/"),r.path=`/${W.TILE_URL_VERSION}${r.path}`);const i=this._customAccessToken||function(t){for(const e of t){const t=e.match(/^access_token=(.*)$/);if(t)return t[1]}return null}(r.params)||W.ACCESS_TOKEN;return W.REQUIRE_ACCESS_TOKEN&&i&&this._skuToken&&r.params.push(`sku=${this._skuToken}`),this._makeAPIURL(r,i)}canonicalizeTileURL(t,e){const n=it(t);if(!n.path.match(/^(\/v4\/|\/raster\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let r="mapbox://";n.path.match(/^\/raster\/v1\//)?r+=`raster/${n.path.replace(`/${W.RASTER_URL_PREFIX}/`,"")}`:r+=`tiles/${n.path.replace(`/${W.TILE_URL_VERSION}/`,"")}`;let i=n.params;return e&&(i=i.filter(t=>!t.match(/^access_token=/))),i.length&&(r+=`?${i.join("&")}`),r}canonicalizeTileset(t,e){const n=!!e&&et(e),r=[];for(const i of t.tiles||[])nt(i)?r.push(this.canonicalizeTileURL(i,n)):r.push(i);return r}_makeAPIURL(t,e){const n="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",r=it(W.API_URL);if(t.protocol=r.protocol,t.authority=r.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==r.path&&(t.path=`${r.path}${t.path}`),!W.REQUIRE_ACCESS_TOKEN)return ot(t);if(e=e||W.ACCESS_TOKEN,!this._silenceAuthErrors){if(!e)throw new Error(`An API access token is required to use Mapbox GL. ${n}`);if("s"===e[0])throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${n}`)}return t.params=t.params.filter(t=>-1===t.indexOf("access_token")),t.params.push(`access_token=${e||""}`),ot(t)}},t.ResourceType=Tt,t.SegmentVector=Ks,t.SourceCache=Ep,t.StencilMode=bp,t.StructArrayLayout1ui2=Xo,t.StructArrayLayout2f1f2i16=Bo,t.StructArrayLayout2i4=Io,t.StructArrayLayout2ui4=Ko,t.StructArrayLayout3f12=Lo,t.StructArrayLayout3ui6=Vo,t.StructArrayLayout4i8=Ao,t.Texture=hd,t.Tile=op,t.Transitionable=co,t.Uniform1f=Ss,t.Uniform1i=class extends Es{constructor(t,e){super(t,e),this.current=0}set(t){this.current!==t&&(this.current=t,this.gl.uniform1i(this.location,t))}},t.Uniform2f=class extends Es{constructor(t,e){super(t,e),this.current=[0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]||(this.current=t,this.gl.uniform2f(this.location,t[0],t[1]))}},t.Uniform3f=class extends Es{constructor(t,e){super(t,e),this.current=[0,0,0]}set(t){t[0]===this.current[0]&&t[1]===this.current[1]&&t[2]===this.current[2]||(this.current=t,this.gl.uniform3f(this.location,t[0],t[1],t[2]))}},t.Uniform4f=Is,t.UniformColor=ks,t.UniformMatrix2f=class extends Es{constructor(t,e){super(t,e),this.current=Os}set(t){for(let e=0;e<4;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix2fv(this.location,!1,t);break}}},t.UniformMatrix3f=class extends Es{constructor(t,e){super(t,e),this.current=Ms}set(t){for(let e=0;e<9;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix3fv(this.location,!1,t);break}}},t.UniformMatrix4f=class extends Es{constructor(t,e){super(t,e),this.current=As}set(t){if(t[12]!==this.current[12]||t[0]!==this.current[0])return this.current=t,void this.gl.uniformMatrix4fv(this.location,!1,t);for(let e=1;e<16;e++)if(t[e]!==this.current[e]){this.current=t,this.gl.uniformMatrix4fv(this.location,!1,t);break}}},t.UnwrappedTileID=qd,t.ValidationError=gr,t.VectorTileWorkerSource=class extends Ft{constructor(t,e,n,r,i){super(),this.actor=t,this.layerIndex=e,this.availableImages=n,this.loadVectorData=i||Lp,this.loading={},this.loaded={},this.deduped=new Np(t.scheduler),this.isSpriteLoaded=r,this.scheduler=t.scheduler}loadTile(t,e){const n=t.uid,r=t&&t.request,i=r&&r.collectResourceTiming,o=this.loading[n]=new Dp(t);o.abort=this.loadVectorData(t,(s,a)=>{const c=!this.loading[n];if(delete this.loading[n],c||s||!a)return o.status="done",c||(this.loaded[n]=o),e(s);const l=a.rawData,u={};a.expires&&(u.expires=a.expires),a.cacheControl&&(u.cacheControl=a.cacheControl),o.vectorTile=a.vectorTile||new Dl.VectorTile(new wu(l));const h=()=>{o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,(t,n)=>{if(t||!n)return e(t);const o={};if(i){const t=md(r);t.length>0&&(o.resourceTiming=JSON.parse(JSON.stringify(t)))}e(null,b({rawTileData:l.slice(0)},n,u,o))})};this.isSpriteLoaded?h():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(h,{type:"parseTile",isSymbolTile:t.isSymbolTile,zoom:t.tileZoom}):h()}),this.loaded=this.loaded||{},this.loaded[n]=o})}reloadTile(t,e){const n=this.loaded,r=t.uid,i=this;if(n&&n[r]){const o=n[r];o.showCollisionBoxes=t.showCollisionBoxes,o.enableTerrain=!!t.enableTerrain,o.projection=t.projection,o.tileTransform=Wd(t.tileID.canonical,t.projection);const s=(t,n)=>{const r=o.reloadCallback;r&&(delete o.reloadCallback,o.parse(o.vectorTile,i.layerIndex,this.availableImages,i.actor,r)),e(t,n)};"parsing"===o.status?o.reloadCallback=s:"done"===o.status&&(o.vectorTile?o.parse(o.vectorTile,this.layerIndex,this.availableImages,this.actor,s):s())}}abortTile(t,e){const n=t.uid,r=this.loading[n];r&&(r.abort&&r.abort(),delete this.loading[n]),e()}removeTile(t,e){const n=this.loaded,r=t.uid;n&&n[r]&&delete n[r],e()}},t.WritingMode=Zu,t.ZoomHistory=hi,t.add=Qa,t.addDynamicAttributes=Xh,t.adjoint=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],l=e[7],u=e[8];return t[0]=s*u-a*l,t[1]=i*l-r*u,t[2]=r*a-i*s,t[3]=a*c-o*u,t[4]=n*u-i*c,t[5]=i*o-n*a,t[6]=o*l-s*c,t[7]=r*c-n*l,t[8]=n*s-r*o,t},t.asyncAll=y,t.bezier=p,t.bindAll=S,t.boundsAttributes=rp,t.bufferConvexPolygon=function(t,e){const n=[];for(let r=0;r<t.length;r++){const i=_(r-1,-1,t.length-1),o=_(r+1,-1,t.length-1),s=t[r],a=t[o],c=t[i].sub(s).unit(),l=a.sub(s).unit(),u=l.angleWithSep(c.x,c.y),h=c.add(l).unit().mult(-1*e/Math.sin(u/2));n.push(s.add(h))}return n},t.cacheEntryPossiblyAdded=function(t){wt++,wt>vt&&(t.getActor().send("enforceCacheSizeLimit",yt),wt=0)},t.calculateGlobeLabelMatrix=function(t,e){const{lng:n,lat:r}=t._center,i=Ld(0,0,t.worldSize/t._projectionScaler,n,r);return Va(i,i,function(t){const e=Ua(new Float64Array(16)),n=1/Rd(t);return qa(e,e,t.min),Ga(e,e,[n,n,n]),e}(kd(e)))},t.calculateGlobeMatrix=jd,t.calculateGlobeMercatorMatrix=function(t){const e=t.worldSize,n=t.point,r=ia(1,t.center.lat)*e,i=t.pixelsPerMeter,o=e/(r/t.pixelsPerMeter),s=Ua(new Float64Array(16));return qa(s,s,[n.x,n.y,0]),Ga(s,s,[o,o,i]),Float32Array.from(s)},t.circumferenceAtLatitude=ea,t.clamp=m,t.clearTileCache=function(t){const e=s.caches.delete(mt);t&&e.catch(t).then(()=>t())},t.clipLine=yh,t.clone=function(t){var e=new Fa(16);return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e},t.clone$1=M,t.collisionCircleLayout=lu,t.config=W,t.conjugate=function(t,e){return t[0]=-e[0],t[1]=-e[1],t[2]=-e[2],t[3]=e[3],t},t.create=function(){var t=new Fa(16);return Fa!=Float32Array&&(t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0),t[0]=1,t[5]=1,t[10]=1,t[15]=1,t},t.create$1=Ba,t.createExpression=ur,t.createLayout=Eo,t.createStyleLayer=function(t){return"custom"===t.type?new ad(t):new ud[t.type](t)},t.cross=ac,t.degToRad=l,t.div=function(t,e,n){return t[0]=e[0]/n[0],t[1]=e[1]/n[1],t[2]=e[2]/n[2],t},t.dot=sc,t.earthRadius=Qs,t.ease=f,t.easeCubicInOut=d,t.emitValidationErrors=ni,t.endsWith=I,t.enforceCacheSizeLimit=function(t){bt(),gt&&gt.then(e=>{e.keys().then(n=>{for(let r=0;r<n.length-t;r++)e.delete(n[r])})})},t.evaluateSizeForFeature=pu,t.evaluateSizeForZoom=fu,t.evaluateVariableOffset=jh,t.evented=eo,t.exactEquals=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]&&t[3]===e[3]},t.exactEquals$1=function(t,e){return t[0]===e[0]&&t[1]===e[1]&&t[2]===e[2]},t.exported=G,t.exported$1=H,t.extend=b,t.extend$1=Ut,t.filterObject=A,t.fromMat4=function(t,e){return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[4],t[4]=e[5],t[5]=e[6],t[6]=e[8],t[7]=e[9],t[8]=e[10],t},t.fromQuat=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n+n,a=r+r,c=i+i,l=n*s,u=r*s,h=r*a,d=i*s,p=i*a,f=i*c,m=o*s,g=o*a,_=o*c;return t[0]=1-h-f,t[1]=u+_,t[2]=d-g,t[3]=0,t[4]=u-_,t[5]=1-l-f,t[6]=p+m,t[7]=0,t[8]=d+g,t[9]=p-m,t[10]=1-l-h,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.fromRotation=function(t,e){var n=Math.sin(e),r=Math.cos(e);return t[0]=r,t[1]=n,t[2]=0,t[3]=-n,t[4]=r,t[5]=0,t[6]=0,t[7]=0,t[8]=1,t},t.fromScaling=function(t,e){return t[0]=e[0],t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=e[1],t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=e[2],t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,t},t.furthestTileCorner=function(t){const e=Math.round((t+45+360)%360/90)%4;return h[e]},t.getAABBPointSquareDist=function(t,e,n){let r=0;for(let i=0;i<2;++i){const o=n?n[i]:0;t[i]>o&&(r+=(t[i]-o)*(t[i]-o)),e[i]<o&&(r+=(o-e[i])*(o-e[i]))}return r},t.getAnchorAlignment=sh,t.getAnchorJustification=Fh,t.getBounds=function(t){let e=1/0,n=1/0,r=-1/0,o=-1/0;for(const i of t)e=Math.min(e,i.x),n=Math.min(n,i.y),r=Math.max(r,i.x),o=Math.max(o,i.y);return{min:new i(e,n),max:new i(r,o)}},t.getColumn=function(t,e){return[t[4*e],t[4*e+1],t[4*e+2],t[4*e+3]]},t.getGridMatrix=function(t,e){const[n,r]=e,i=.015625;return[0,(r[1]-n[1])*i,1<<t.z,(r[0]-n[0])*i,0,t.y,n[0],n[1],i]},t.getImage=Rt,t.getJSON=function(t,e){return St(b(t,{type:"json"}),e)},t.getMapSessionAPI=pt,t.getPerformanceMeasurement=md,t.getProjection=function(t){const e=t.parallels,n=!!e&&Math.abs(e[0]+e[1])<.01;switch(t.name){case"mercator":return new Fp(t);case"equirectangular":return new Hp(t);case"naturalEarth":return new Qp(t);case"equalEarth":return new Wp(t);case"winkelTripel":return new tf(t);case"albers":return n?new ef(t):new Bp(t);case"lambertConformalConic":return n?new ef(t):new Xp(t)}throw new Error(`Invalid projection name: ${t.name}`)},t.getRTLTextPluginStatus=no,t.getReferrer=Et,t.getTilePoint=function(t,{x:e,y:n},r=0){return new i(((e-r)*t.scale-t.x)*Xs,(n*t.scale-t.y)*Xs)},t.getTileVec3=function(t,e,n=0){return Ya(((e.x-n)*t.scale-t.x)*Xs,(e.y*t.scale-t.y)*Xs,aa(e.z,e.y))},t.getVideo=function(t,e){const n=s.document.createElement("video");n.muted=!0,n.onloadstart=function(){e(null,n)};for(let r=0;r<t.length;r++){const e=s.document.createElement("source");Mt(t[r])||(n.crossOrigin="Anonymous"),e.src=t[r],n.appendChild(e)}return{cancel:()=>{}}},t.globeECEFOrigin=function(t,e){const n=[0,0,0];return cc(n,n,Nd(kd(e.canonical))),cc(n,n,t),n},t.globePixelsToTileUnits=function(t,e){return Xs/(512*Math.pow(2,t))*Rd(kd(e))},t.globePoleMatrixForTile=function(t,e,n){const r=Ua(new Float64Array(16)),i=1<<t,o=360*(e/i-.5),s=n.point,a=n.worldSize/(n.tileSize*i);return qa(r,r,[s.x,s.y,-n.worldSize/Math.PI/2]),Ga(r,r,[a,a,a]),$a(r,r,l(-n._center.lat)),Wa(r,r,l(-n._center.lng+o)),Float32Array.from(r)},t.globeTileLatLngCorners=Md,t.globeToMercatorTransition=function(t){return g(5,6,t)},t.identity=Ua,t.identity$1=gc,t.invert=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=e[4],a=e[5],c=e[6],l=e[7],u=e[8],h=e[9],d=e[10],p=e[11],f=e[12],m=e[13],g=e[14],_=e[15],y=n*a-r*s,v=n*c-i*s,b=n*l-o*s,x=r*c-i*a,w=r*l-o*a,T=i*l-o*c,C=u*m-h*f,E=u*g-d*f,S=u*_-p*f,I=h*g-d*m,k=h*_-p*m,A=d*_-p*g,M=y*A-v*k+b*I+x*S-w*E+T*C;return M?(t[0]=(a*A-c*k+l*I)*(M=1/M),t[1]=(i*k-r*A-o*I)*M,t[2]=(m*T-g*w+_*x)*M,t[3]=(d*w-h*T-p*x)*M,t[4]=(c*S-s*A-l*E)*M,t[5]=(n*A-i*S+o*E)*M,t[6]=(g*b-f*T-_*v)*M,t[7]=(u*T-d*b+p*v)*M,t[8]=(s*k-a*S+l*C)*M,t[9]=(r*S-n*k-o*C)*M,t[10]=(f*w-m*b+_*y)*M,t[11]=(h*b-u*w-p*y)*M,t[12]=(a*E-s*I-c*C)*M,t[13]=(n*I-r*E+i*C)*M,t[14]=(m*v-f*x-g*y)*M,t[15]=(u*x-h*v+d*y)*M,t):null},t.isMapAuthenticated=function(t){return ft.has(t)},t.isMapboxURL=et,t.isSafariWithAntialiasingBug=function(t){const e=t.navigator?t.navigator.userAgent:null;return!!V(t)&&e&&(e.match("Version/15.4")||e.match("Version/15.5")||e.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/))},t.latFromMercatorY=sa,t.len=pc,t.length=Xa,t.length$1=function(t){return Math.hypot(t[0],t[1],t[2],t[3])},t.loadVectorTile=Lp,t.makeRequest=St,t.mercatorXfromLng=na,t.mercatorYfromLat=ra,t.mercatorZfromAltitude=ia,t.mul=Ha,t.mul$1=dc,t.multiply=function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=e[4],c=e[5],l=e[6],u=e[7],h=e[8],d=n[0],p=n[1],f=n[2],m=n[3],g=n[4],_=n[5],y=n[6],v=n[7],b=n[8];return t[0]=d*r+p*s+f*l,t[1]=d*i+p*a+f*u,t[2]=d*o+p*c+f*h,t[3]=m*r+g*s+_*l,t[4]=m*i+g*a+_*u,t[5]=m*o+g*c+_*h,t[6]=y*r+v*s+b*l,t[7]=y*i+v*a+b*u,t[8]=y*o+v*c+b*h,t},t.multiply$1=Va,t.multiply$2=tc,t.nextPowerOfTwo=C,t.normalize=oc,t.normalize$1=function(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*n+r*r+i*i+o*o;return s>0&&(s=1/Math.sqrt(s)),t[0]=n*s,t[1]=r*s,t[2]=i*s,t[3]=o*s,t},t.number=nn,t.ortho=function(t,e,n,r,i,o,s){var a=1/(e-n),c=1/(r-i),l=1/(o-s);return t[0]=-2*a,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=-2*c,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[10]=2*l,t[11]=0,t[12]=(e+n)*a,t[13]=(i+r)*c,t[14]=(s+o)*l,t[15]=1,t},t.pbf=wu,t.perspective=function(t,e,n,r,i){var o,s=1/Math.tan(e/2);return t[0]=s/n,t[1]=0,t[2]=0,t[3]=0,t[4]=0,t[5]=s,t[6]=0,t[7]=0,t[8]=0,t[9]=0,t[11]=-1,t[12]=0,t[13]=0,t[15]=0,null!=i&&i!==1/0?(t[10]=(i+r)*(o=1/(r-i)),t[14]=2*i*r*o):(t[10]=-1,t[14]=-2*r),t},t.pick=function(t,e){const n={};for(let r=0;r<e.length;r++){const i=e[r];i in t&&(n[i]=t[i])}return n},t.plugin=io,t.pointGeometry=i,t.polygonIntersectsBox=Ma,t.polygonIntersectsPolygon=ba,t.polygonizeBounds=function(t,e,n=0,r=!0){const o=new i(n,n),s=t.sub(o),a=e.add(o),c=[s,new i(a.x,s.y),a,new i(s.x,a.y)];return r&&c.push(s),c},t.posAttributes=xd,t.postMapLoadEvent=ht,t.postTurnstileEvent=lt,t.potpack=$u,t.prevPowerOfTwo=function(t){return t<=1?1:Math.pow(2,Math.floor(Math.log(t)/Math.LN2))},t.radToDeg=u,t.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],t.registerForPluginStateChange=function(t){return t({pluginStatus:Yi,pluginURL:Qi}),eo.on("pluginStateChange",t),t},t.removeAuthState=function(t){ft.delete(t)},t.renderColorRamp=Pc,t.rotateX=$a,t.rotateX$1=_c,t.rotateY=Wa,t.rotateZ=function(t,e,n){var r=Math.sin(n),i=Math.cos(n),o=e[0],s=e[1],a=e[2],c=e[3],l=e[4],u=e[5],h=e[6],d=e[7];return e!==t&&(t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15]),t[0]=o*i+l*r,t[1]=s*i+u*r,t[2]=a*i+h*r,t[3]=c*i+d*r,t[4]=l*i-o*r,t[5]=u*i-s*r,t[6]=h*i-a*r,t[7]=d*i-c*r,t},t.rotateZ$1=function(t,e,n){n*=.5;var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),c=Math.cos(n);return t[0]=r*c+i*a,t[1]=i*c-r*a,t[2]=o*c+s*a,t[3]=s*c-o*a,t},t.scale=Ga,t.scale$1=function(t,e,n){return t[0]=e[0]*n,t[1]=e[1]*n,t[2]=e[2]*n,t[3]=e[3]*n,t},t.scale$2=rc,t.scaleAndAdd=ic,t.setCacheLimits=function(t,e){yt=t,vt=e},t.setColumn=function(t,e,n){t[4*e+0]=n[0],t[4*e+1]=n[1],t[4*e+2]=n[2],t[4*e+3]=n[3]},t.setRTLTextPlugin=function(t,e,n=!1){if(Yi===Hi||Yi===Zi||Yi===Ki)throw new Error("setRTLTextPlugin cannot be called multiple times.");Qi=G.resolveURL(t),Yi=Hi,Xi=e,to(),n||ro()},t.smoothstep=g,t.spec=Bt,t.storeAuthState=function(t,e){e?ft.add(t):ft.delete(t)},t.sub=hc,t.subtract=Ja,t.symbolSize=mu,t.tileAABB=function(t,e,n,r,i,o,s,a,c){if("globe"===c.name)return Ad(t,e,new Vd(n,r,i));const l=Wd({z:n,x:r,y:i},c);return new vc([(o+l.x/l.scale)*e,e*(l.y/l.scale),s],[(o+l.x2/l.scale)*e,e*(l.y2/l.scale),a])},t.tileTransform=Wd,t.transformMat3=function(t,e,n){var r=e[0],i=e[1],o=e[2];return t[0]=r*n[0]+i*n[3]+o*n[6],t[1]=r*n[1]+i*n[4]+o*n[7],t[2]=r*n[2]+i*n[5]+o*n[8],t},t.transformMat4=cc,t.transformMat4$1=fc,t.transformQuat=lc,t.translate=qa,t.transpose=function(t,e){if(t===e){var n=e[1],r=e[2],i=e[5];t[1]=e[3],t[2]=e[6],t[3]=n,t[5]=e[7],t[6]=r,t[7]=i}else t[0]=e[0],t[1]=e[3],t[2]=e[6],t[3]=e[1],t[4]=e[4],t[5]=e[7],t[6]=e[2],t[7]=e[5],t[8]=e[8];return t},t.triggerPluginCompletionEvent=Ji,t.uniqueId=w,t.validateCustomStyleLayer=function(t){const e=[],n=t.id;return void 0===n&&e.push({message:`layers.${n}: missing required property "id"`}),void 0===t.render&&e.push({message:`layers.${n}: missing required method "render"`}),t.renderingMode&&"2d"!==t.renderingMode&&"3d"!==t.renderingMode&&e.push({message:`layers.${n}: property "renderingMode" must be either "2d" or "3d"`}),e},t.validateFilter=t=>ei(jr(t)),t.validateFog=t=>ei(Zr(t)),t.validateLayer=t=>ei(Vr(t)),t.validateLight=t=>ei(Wr(t)),t.validateSource=t=>ei($r(t)),t.validateStyle=Qr,t.validateTerrain=t=>ei(Hr(t)),t.values=v,t.vectorTile=Dl,t.version=e,t.warnOnce=P,t.window=s,t.wrap=_}),r(0,function(t){function e(t){if("number"==typeof t||"boolean"==typeof t||"string"==typeof t||null==t)return JSON.stringify(t);if(Array.isArray(t)){let n="[";for(const r of t)n+=`${e(r)},`;return`${n}]`}let n="{";for(const r of Object.keys(t).sort())n+=`${r}:${e(t[r])},`;return`${n}}`}function n(n){let r="";for(const i of t.refProperties)r+=`/${e(n[i])}`;return r}class r{constructor(t){this.keyCache={},t&&this.replace(t)}replace(t){this._layerConfigs={},this._layers={},this.update(t,[])}update(e,r){for(const n of e)this._layerConfigs[n.id]=n,(this._layers[n.id]=t.createStyleLayer(n)).compileFilter(),this.keyCache[n.id]&&delete this.keyCache[n.id];for(const t of r)delete this.keyCache[t],delete this._layerConfigs[t],delete this._layers[t];this.familiesBySource={};const i=function(t,e){const r={};for(let o=0;o<t.length;o++){const i=e&&e[t[o].id]||n(t[o]);e&&(e[t[o].id]=i);let s=r[i];s||(s=r[i]=[]),s.push(t[o])}const i=[];for(const n in r)i.push(r[n]);return i}(t.values(this._layerConfigs),this.keyCache);for(const t of i){const e=t.map(t=>this._layers[t.id]),n=e[0];if("none"===n.visibility)continue;const r=n.source||"";let i=this.familiesBySource[r];i||(i=this.familiesBySource[r]={});const o=n.sourceLayer||"_geojsonTileLayer";let s=i[o];s||(s=i[o]=[]),s.push(e)}}}class i{loadTile(e,n){const{uid:r,encoding:i,rawImageData:o,padding:s,buildQuadTree:a}=e,c=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap?this.getImageData(o,s):o;n(null,new t.DEMData(r,c,i,s<1,a))}getImageData(t,e){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(t.width,t.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=t.width,this.offscreenCanvas.height=t.height,this.offscreenCanvasContext.drawImage(t,0,0,t.width,t.height);const n=this.offscreenCanvasContext.getImageData(-e,-e,t.width+2*e,t.height+2*e);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),n}}var o=function t(e,n){var r,i=e&&e.type;if("FeatureCollection"===i)for(r=0;r<e.features.length;r++)t(e.features[r],n);else if("GeometryCollection"===i)for(r=0;r<e.geometries.length;r++)t(e.geometries[r],n);else if("Feature"===i)t(e.geometry,n);else if("Polygon"===i)s(e.coordinates,n);else if("MultiPolygon"===i)for(r=0;r<e.coordinates.length;r++)s(e.coordinates[r],n);return e};function s(t,e){if(0!==t.length){a(t[0],e);for(var n=1;n<t.length;n++)a(t[n],!e)}}function a(t,e){for(var n=0,r=0,i=0,o=t.length,s=o-1;i<o;s=i++){var a=(t[i][0]-t[s][0])*(t[s][1]+t[i][1]),c=n+a;r+=Math.abs(n)>=Math.abs(a)?n-c+a:a-c+n,n=c}n+r>=0!=!!e&&t.reverse()}const c=t.vectorTile.VectorTileFeature.prototype.toGeoJSON;class l{constructor(e){this._feature=e,this.extent=t.EXTENT,this.type=e.type,this.properties=e.tags,"id"in e&&!isNaN(e.id)&&(this.id=parseInt(e.id,10))}loadGeometry(){if(1===this._feature.type){const e=[];for(const n of this._feature.geometry)e.push([new t.pointGeometry(n[0],n[1])]);return e}{const e=[];for(const n of this._feature.geometry){const r=[];for(const e of n)r.push(new t.pointGeometry(e[0],e[1]));e.push(r)}return e}}toGeoJSON(t,e,n){return c.call(this,t,e,n)}}class u{constructor(e){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=t.EXTENT,this.length=e.length,this._features=e}feature(t){return new l(this._features[t])}}var h=t.vectorTile.VectorTileFeature,d=p;function p(t,e){this.options=e||{},this.features=t,this.length=t.length}function f(t,e){this.id="number"==typeof t.id?t.id:void 0,this.type=t.type,this.rawGeometry=1===t.type?[t.geometry]:t.geometry,this.properties=t.tags,this.extent=e||4096}p.prototype.feature=function(t){return new f(this.features[t],this.options.extent)},f.prototype.loadGeometry=function(){var e=this.rawGeometry;this.geometry=[];for(var n=0;n<e.length;n++){for(var r=e[n],i=[],o=0;o<r.length;o++)i.push(new t.pointGeometry(r[o][0],r[o][1]));this.geometry.push(i)}return this.geometry},f.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var t=this.geometry,e=1/0,n=-1/0,r=1/0,i=-1/0,o=0;o<t.length;o++)for(var s=t[o],a=0;a<s.length;a++){var c=s[a];e=Math.min(e,c.x),n=Math.max(n,c.x),r=Math.min(r,c.y),i=Math.max(i,c.y)}return[e,r,n,i]},f.prototype.toGeoJSON=h.prototype.toGeoJSON;var m=_,g=d;function _(e){var n=new t.pbf;return function(t,e){for(var n in t.layers)e.writeMessage(3,y,t.layers[n])}(e,n),n.finish()}function y(t,e){var n;e.writeVarintField(15,t.version||1),e.writeStringField(1,t.name||""),e.writeVarintField(5,t.extent||4096);var r={keys:[],values:[],keycache:{},valuecache:{}};for(n=0;n<t.length;n++)r.feature=t.feature(n),e.writeMessage(2,v,r);var i=r.keys;for(n=0;n<i.length;n++)e.writeStringField(3,i[n]);var o=r.values;for(n=0;n<o.length;n++)e.writeMessage(4,C,o[n])}function v(t,e){var n=t.feature;void 0!==n.id&&e.writeVarintField(1,n.id),e.writeMessage(2,b,t),e.writeVarintField(3,n.type),e.writeMessage(4,T,n)}function b(t,e){var n=t.feature,r=t.keys,i=t.values,o=t.keycache,s=t.valuecache;for(var a in n.properties){var c=n.properties[a],l=o[a];if(null!==c){void 0===l&&(r.push(a),o[a]=l=r.length-1),e.writeVarint(l);var u=typeof c;"string"!==u&&"boolean"!==u&&"number"!==u&&(c=JSON.stringify(c));var h=u+":"+c,d=s[h];void 0===d&&(i.push(c),s[h]=d=i.length-1),e.writeVarint(d)}}}function x(t,e){return(e<<3)+(7&t)}function w(t){return t<<1^t>>31}function T(t,e){for(var n=t.loadGeometry(),r=t.type,i=0,o=0,s=n.length,a=0;a<s;a++){var c=n[a],l=1;1===r&&(l=c.length),e.writeVarint(x(1,l));for(var u=3===r?c.length-1:c.length,h=0;h<u;h++){1===h&&1!==r&&e.writeVarint(x(2,u-1));var d=c[h].x-i,p=c[h].y-o;e.writeVarint(w(d)),e.writeVarint(w(p)),i+=d,o+=p}3===r&&e.writeVarint(x(7,1))}}function C(t,e){var n=typeof t;"string"===n?e.writeStringField(1,t):"boolean"===n?e.writeBooleanField(7,t):"number"===n&&(t%1!=0?e.writeDoubleField(3,t):t<0?e.writeSVarintField(6,t):e.writeVarintField(5,t))}function E(t,e,n,r,i,o){if(i-r<=n)return;const s=r+i>>1;S(t,e,s,r,i,o%2),E(t,e,n,r,s-1,o+1),E(t,e,n,s+1,i,o+1)}function S(t,e,n,r,i,o){for(;i>r;){if(i-r>600){const s=i-r+1,a=n-r+1,c=Math.log(s),l=.5*Math.exp(2*c/3),u=.5*Math.sqrt(c*l*(s-l)/s)*(a-s/2<0?-1:1);S(t,e,n,Math.max(r,Math.floor(n-a*l/s+u)),Math.min(i,Math.floor(n+(s-a)*l/s+u)),o)}const s=e[2*n+o];let a=r,c=i;for(I(t,e,r,n),e[2*i+o]>s&&I(t,e,r,i);a<c;){for(I(t,e,a,c),a++,c--;e[2*a+o]<s;)a++;for(;e[2*c+o]>s;)c--}e[2*r+o]===s?I(t,e,r,c):(c++,I(t,e,c,i)),c<=n&&(r=c+1),n<=c&&(i=c-1)}}function I(t,e,n,r){k(t,n,r),k(e,2*n,2*r),k(e,2*n+1,2*r+1)}function k(t,e,n){const r=t[e];t[e]=t[n],t[n]=r}function A(t,e,n,r){const i=t-n,o=e-r;return i*i+o*o}m.fromVectorTileJs=_,m.fromGeojsonVt=function(t,e){e=e||{};var n={};for(var r in t)n[r]=new d(t[r].features,e),n[r].name=r,n[r].version=e.version,n[r].extent=e.extent;return _({layers:n})},m.GeoJSONWrapper=g;const M=t=>t[0],O=t=>t[1];class P{constructor(t,e=M,n=O,r=64,i=Float64Array){this.nodeSize=r,this.points=t;const o=t.length<65536?Uint16Array:Uint32Array,s=this.ids=new o(t.length),a=this.coords=new i(2*t.length);for(let c=0;c<t.length;c++)s[c]=c,a[2*c]=e(t[c]),a[2*c+1]=n(t[c]);E(s,a,r,0,s.length-1,0)}range(t,e,n,r){return function(t,e,n,r,i,o,s){const a=[0,t.length-1,0],c=[];let l,u;for(;a.length;){const h=a.pop(),d=a.pop(),p=a.pop();if(d-p<=s){for(let s=p;s<=d;s++)l=e[2*s],u=e[2*s+1],l>=n&&l<=i&&u>=r&&u<=o&&c.push(t[s]);continue}const f=Math.floor((p+d)/2);l=e[2*f],u=e[2*f+1],l>=n&&l<=i&&u>=r&&u<=o&&c.push(t[f]);const m=(h+1)%2;(0===h?n<=l:r<=u)&&(a.push(p),a.push(f-1),a.push(m)),(0===h?i>=l:o>=u)&&(a.push(f+1),a.push(d),a.push(m))}return c}(this.ids,this.coords,t,e,n,r,this.nodeSize)}within(t,e,n){return function(t,e,n,r,i,o){const s=[0,t.length-1,0],a=[],c=i*i;for(;s.length;){const l=s.pop(),u=s.pop(),h=s.pop();if(u-h<=o){for(let i=h;i<=u;i++)A(e[2*i],e[2*i+1],n,r)<=c&&a.push(t[i]);continue}const d=Math.floor((h+u)/2),p=e[2*d],f=e[2*d+1];A(p,f,n,r)<=c&&a.push(t[d]);const m=(l+1)%2;(0===l?n-i<=p:r-i<=f)&&(s.push(h),s.push(d-1),s.push(m)),(0===l?n+i>=p:r+i>=f)&&(s.push(d+1),s.push(u),s.push(m))}return a}(this.ids,this.coords,t,e,n,this.nodeSize)}}const D={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:t=>t},R=Math.fround||(N=new Float32Array(1),t=>(N[0]=+t,N[0]));var N;class L{constructor(t){this.options=G(Object.create(D),t),this.trees=new Array(this.options.maxZoom+1)}load(t){const{log:e,minZoom:n,maxZoom:r,nodeSize:i}=this.options;e&&console.time("total time");const o=`prepare ${t.length} points`;e&&console.time(o),this.points=t;let s=[];for(let a=0;a<t.length;a++)t[a].geometry&&s.push(z(t[a],a));this.trees[r+1]=new P(s,$,W,i,Float32Array),e&&console.timeEnd(o);for(let a=r;a>=n;a--){const t=+Date.now();s=this._cluster(s,a),this.trees[a]=new P(s,$,W,i,Float32Array),e&&console.log("z%d: %d clusters in %dms",a,s.length,+Date.now()-t)}return e&&console.timeEnd("total time"),this}getClusters(t,e){let n=((t[0]+180)%360+360)%360-180;const r=Math.max(-90,Math.min(90,t[1]));let i=180===t[2]?180:((t[2]+180)%360+360)%360-180;const o=Math.max(-90,Math.min(90,t[3]));if(t[2]-t[0]>=360)n=-180,i=180;else if(n>i){const t=this.getClusters([n,r,180,o],e),s=this.getClusters([-180,r,i,o],e);return t.concat(s)}const s=this.trees[this._limitZoom(e)],a=s.range(U(n),V(o),U(i),V(r)),c=[];for(const l of a){const t=s.points[l];c.push(t.numPoints?F(t):this.points[t.index])}return c}getChildren(t){const e=this._getOriginId(t),n=this._getOriginZoom(t),r="No cluster with the specified id.",i=this.trees[n];if(!i)throw new Error(r);const o=i.points[e];if(!o)throw new Error(r);const s=this.options.radius/(this.options.extent*Math.pow(2,n-1)),a=i.within(o.x,o.y,s),c=[];for(const l of a){const e=i.points[l];e.parentId===t&&c.push(e.numPoints?F(e):this.points[e.index])}if(0===c.length)throw new Error(r);return c}getLeaves(t,e,n){const r=[];return this._appendLeaves(r,t,e=e||10,n=n||0,0),r}getTile(t,e,n){const r=this.trees[this._limitZoom(t)],i=Math.pow(2,t),{extent:o,radius:s}=this.options,a=s/o,c=(n-a)/i,l=(n+1+a)/i,u={features:[]};return this._addTileFeatures(r.range((e-a)/i,c,(e+1+a)/i,l),r.points,e,n,i,u),0===e&&this._addTileFeatures(r.range(1-a/i,c,1,l),r.points,i,n,i,u),e===i-1&&this._addTileFeatures(r.range(0,c,a/i,l),r.points,-1,n,i,u),u.features.length?u:null}getClusterExpansionZoom(t){let e=this._getOriginZoom(t)-1;for(;e<=this.options.maxZoom;){const n=this.getChildren(t);if(e++,1!==n.length)break;t=n[0].properties.cluster_id}return e}_appendLeaves(t,e,n,r,i){const o=this.getChildren(e);for(const s of o){const e=s.properties;if(e&&e.cluster?i+e.point_count<=r?i+=e.point_count:i=this._appendLeaves(t,e.cluster_id,n,r,i):i<r?i++:t.push(s),t.length===n)break}return i}_addTileFeatures(t,e,n,r,i,o){for(const s of t){const t=e[s],a=t.numPoints;let c,l,u;if(a)c=B(t),l=t.x,u=t.y;else{const e=this.points[t.index];c=e.properties,l=U(e.geometry.coordinates[0]),u=V(e.geometry.coordinates[1])}const h={type:1,geometry:[[Math.round(this.options.extent*(l*i-n)),Math.round(this.options.extent*(u*i-r))]],tags:c};let d;a?d=t.id:this.options.generateId?d=t.index:this.points[t.index].id&&(d=this.points[t.index].id),void 0!==d&&(h.id=d),o.features.push(h)}}_limitZoom(t){return Math.max(this.options.minZoom,Math.min(+t,this.options.maxZoom+1))}_cluster(t,e){const n=[],{radius:r,extent:i,reduce:o,minPoints:s}=this.options,a=r/(i*Math.pow(2,e));for(let c=0;c<t.length;c++){const r=t[c];if(r.zoom<=e)continue;r.zoom=e;const i=this.trees[e+1],l=i.within(r.x,r.y,a),u=r.numPoints||1;let h=u;for(const t of l){const n=i.points[t];n.zoom>e&&(h+=n.numPoints||1)}if(h>u&&h>=s){let t=r.x*u,s=r.y*u,a=o&&u>1?this._map(r,!0):null;const d=(c<<5)+(e+1)+this.points.length;for(const n of l){const c=i.points[n];if(c.zoom<=e)continue;c.zoom=e;const l=c.numPoints||1;t+=c.x*l,s+=c.y*l,c.parentId=d,o&&(a||(a=this._map(r,!0)),o(a,this._map(c)))}r.parentId=d,n.push(j(t/h,s/h,d,h,a))}else if(n.push(r),h>1)for(const t of l){const r=i.points[t];r.zoom<=e||(r.zoom=e,n.push(r))}}return n}_getOriginId(t){return t-this.points.length>>5}_getOriginZoom(t){return(t-this.points.length)%32}_map(t,e){if(t.numPoints)return e?G({},t.properties):t.properties;const n=this.points[t.index].properties,r=this.options.map(n);return e&&r===n?G({},r):r}}function j(t,e,n,r,i){return{x:R(t),y:R(e),zoom:1/0,id:n,parentId:-1,numPoints:r,properties:i}}function z(t,e){const[n,r]=t.geometry.coordinates;return{x:R(U(n)),y:R(V(r)),zoom:1/0,index:e,parentId:-1}}function F(t){return{type:"Feature",id:t.id,properties:B(t),geometry:{type:"Point",coordinates:[(e=t.x,360*(e-.5)),q(t.y)]}};var e}function B(t){const e=t.numPoints,n=e>=1e4?`${Math.round(e/1e3)}k`:e>=1e3?Math.round(e/100)/10+"k":e;return G(G({},t.properties),{cluster:!0,cluster_id:t.id,point_count:e,point_count_abbreviated:n})}function U(t){return t/360+.5}function V(t){const e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function q(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function G(t,e){for(const n in e)t[n]=e[n];return t}function $(t){return t.x}function W(t){return t.y}function H(t,e,n,r){for(var i,o=r,s=n-e>>1,a=n-e,c=t[e],l=t[e+1],u=t[n],h=t[n+1],d=e+3;d<n;d+=3){var p=Z(t[d],t[d+1],c,l,u,h);if(p>o)i=d,o=p;else if(p===o){var f=Math.abs(d-s);f<a&&(i=d,a=f)}}o>r&&(i-e>3&&H(t,e,i,r),t[i+2]=o,n-i>3&&H(t,i,n,r))}function Z(t,e,n,r,i,o){var s=i-n,a=o-r;if(0!==s||0!==a){var c=((t-n)*s+(e-r)*a)/(s*s+a*a);c>1?(n=i,r=o):c>0&&(n+=s*c,r+=a*c)}return(s=t-n)*s+(a=e-r)*a}function K(t,e,n,r){var i={id:void 0===t?null:t,type:e,geometry:n,tags:r,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(t){var e=t.geometry,n=t.type;if("Point"===n||"MultiPoint"===n||"LineString"===n)X(t,e);else if("Polygon"===n||"MultiLineString"===n)for(var r=0;r<e.length;r++)X(t,e[r]);else if("MultiPolygon"===n)for(r=0;r<e.length;r++)for(var i=0;i<e[r].length;i++)X(t,e[r][i])}(i),i}function X(t,e){for(var n=0;n<e.length;n+=3)t.minX=Math.min(t.minX,e[n]),t.minY=Math.min(t.minY,e[n+1]),t.maxX=Math.max(t.maxX,e[n]),t.maxY=Math.max(t.maxY,e[n+1])}function Y(t,e,n,r){if(e.geometry){var i=e.geometry.coordinates,o=e.geometry.type,s=Math.pow(n.tolerance/((1<<n.maxZoom)*n.extent),2),a=[],c=e.id;if(n.promoteId?c=e.properties[n.promoteId]:n.generateId&&(c=r||0),"Point"===o)Q(i,a);else if("MultiPoint"===o)for(var l=0;l<i.length;l++)Q(i[l],a);else if("LineString"===o)J(i,a,s,!1);else if("MultiLineString"===o){if(n.lineMetrics){for(l=0;l<i.length;l++)J(i[l],a=[],s,!1),t.push(K(c,"LineString",a,e.properties));return}tt(i,a,s,!1)}else if("Polygon"===o)tt(i,a,s,!0);else{if("MultiPolygon"!==o){if("GeometryCollection"===o){for(l=0;l<e.geometry.geometries.length;l++)Y(t,{id:c,geometry:e.geometry.geometries[l],properties:e.properties},n,r);return}throw new Error("Input data is not a valid GeoJSON object.")}for(l=0;l<i.length;l++){var u=[];tt(i[l],u,s,!0),a.push(u)}}t.push(K(c,o,a,e.properties))}}function Q(t,e){e.push(et(t[0])),e.push(nt(t[1])),e.push(0)}function J(t,e,n,r){for(var i,o,s=0,a=0;a<t.length;a++){var c=et(t[a][0]),l=nt(t[a][1]);e.push(c),e.push(l),e.push(0),a>0&&(s+=r?(i*l-c*o)/2:Math.sqrt(Math.pow(c-i,2)+Math.pow(l-o,2))),i=c,o=l}var u=e.length-3;e[2]=1,H(e,0,u,n),e[u+2]=1,e.size=Math.abs(s),e.start=0,e.end=e.size}function tt(t,e,n,r){for(var i=0;i<t.length;i++){var o=[];J(t[i],o,n,r),e.push(o)}}function et(t){return t/360+.5}function nt(t){var e=Math.sin(t*Math.PI/180),n=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return n<0?0:n>1?1:n}function rt(t,e,n,r,i,o,s,a){if(r/=e,o>=(n/=e)&&s<r)return t;if(s<n||o>=r)return null;for(var c=[],l=0;l<t.length;l++){var u=t[l],h=u.geometry,d=u.type,p=0===i?u.minX:u.minY,f=0===i?u.maxX:u.maxY;if(p>=n&&f<r)c.push(u);else if(!(f<n||p>=r)){var m=[];if("Point"===d||"MultiPoint"===d)it(h,m,n,r,i);else if("LineString"===d)ot(h,m,n,r,i,!1,a.lineMetrics);else if("MultiLineString"===d)at(h,m,n,r,i,!1);else if("Polygon"===d)at(h,m,n,r,i,!0);else if("MultiPolygon"===d)for(var g=0;g<h.length;g++){var _=[];at(h[g],_,n,r,i,!0),_.length&&m.push(_)}if(m.length){if(a.lineMetrics&&"LineString"===d){for(g=0;g<m.length;g++)c.push(K(u.id,d,m[g],u.tags));continue}"LineString"!==d&&"MultiLineString"!==d||(1===m.length?(d="LineString",m=m[0]):d="MultiLineString"),"Point"!==d&&"MultiPoint"!==d||(d=3===m.length?"Point":"MultiPoint"),c.push(K(u.id,d,m,u.tags))}}}return c.length?c:null}function it(t,e,n,r,i){for(var o=0;o<t.length;o+=3){var s=t[o+i];s>=n&&s<=r&&(e.push(t[o]),e.push(t[o+1]),e.push(t[o+2]))}}function ot(t,e,n,r,i,o,s){for(var a,c,l=st(t),u=0===i?lt:ut,h=t.start,d=0;d<t.length-3;d+=3){var p=t[d],f=t[d+1],m=t[d+2],g=t[d+3],_=t[d+4],y=0===i?p:f,v=0===i?g:_,b=!1;s&&(a=Math.sqrt(Math.pow(p-g,2)+Math.pow(f-_,2))),y<n?v>n&&(c=u(l,p,f,g,_,n),s&&(l.start=h+a*c)):y>r?v<r&&(c=u(l,p,f,g,_,r),s&&(l.start=h+a*c)):ct(l,p,f,m),v<n&&y>=n&&(c=u(l,p,f,g,_,n),b=!0),v>r&&y<=r&&(c=u(l,p,f,g,_,r),b=!0),!o&&b&&(s&&(l.end=h+a*c),e.push(l),l=st(t)),s&&(h+=a)}var x=t.length-3;p=t[x],f=t[x+1],m=t[x+2],(y=0===i?p:f)>=n&&y<=r&&ct(l,p,f,m),x=l.length-3,o&&x>=3&&(l[x]!==l[0]||l[x+1]!==l[1])&&ct(l,l[0],l[1],l[2]),l.length&&e.push(l)}function st(t){var e=[];return e.size=t.size,e.start=t.start,e.end=t.end,e}function at(t,e,n,r,i,o){for(var s=0;s<t.length;s++)ot(t[s],e,n,r,i,o,!1)}function ct(t,e,n,r){t.push(e),t.push(n),t.push(r)}function lt(t,e,n,r,i,o){var s=(o-e)/(r-e);return t.push(o),t.push(n+(i-n)*s),t.push(1),s}function ut(t,e,n,r,i,o){var s=(o-n)/(i-n);return t.push(e+(r-e)*s),t.push(o),t.push(1),s}function ht(t,e){for(var n=[],r=0;r<t.length;r++){var i,o=t[r],s=o.type;if("Point"===s||"MultiPoint"===s||"LineString"===s)i=dt(o.geometry,e);else if("MultiLineString"===s||"Polygon"===s){i=[];for(var a=0;a<o.geometry.length;a++)i.push(dt(o.geometry[a],e))}else if("MultiPolygon"===s)for(i=[],a=0;a<o.geometry.length;a++){for(var c=[],l=0;l<o.geometry[a].length;l++)c.push(dt(o.geometry[a][l],e));i.push(c)}n.push(K(o.id,s,i,o.tags))}return n}function dt(t,e){var n=[];n.size=t.size,void 0!==t.start&&(n.start=t.start,n.end=t.end);for(var r=0;r<t.length;r+=3)n.push(t[r]+e,t[r+1],t[r+2]);return n}function pt(t,e){if(t.transformed)return t;var n,r,i,o=1<<t.z,s=t.x,a=t.y;for(n=0;n<t.features.length;n++){var c=t.features[n],l=c.geometry,u=c.type;if(c.geometry=[],1===u)for(r=0;r<l.length;r+=2)c.geometry.push(ft(l[r],l[r+1],e,o,s,a));else for(r=0;r<l.length;r++){var h=[];for(i=0;i<l[r].length;i+=2)h.push(ft(l[r][i],l[r][i+1],e,o,s,a));c.geometry.push(h)}}return t.transformed=!0,t}function ft(t,e,n,r,i,o){return[Math.round(n*(t*r-i)),Math.round(n*(e*r-o))]}function mt(t,e,n,r,i){for(var o=e===i.maxZoom?0:i.tolerance/((1<<e)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:n,y:r,z:e,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},a=0;a<t.length;a++){s.numFeatures++,gt(s,t[a],o,i);var c=t[a].minX,l=t[a].minY,u=t[a].maxX,h=t[a].maxY;c<s.minX&&(s.minX=c),l<s.minY&&(s.minY=l),u>s.maxX&&(s.maxX=u),h>s.maxY&&(s.maxY=h)}return s}function gt(t,e,n,r){var i=e.geometry,o=e.type,s=[];if("Point"===o||"MultiPoint"===o)for(var a=0;a<i.length;a+=3)s.push(i[a]),s.push(i[a+1]),t.numPoints++,t.numSimplified++;else if("LineString"===o)_t(s,i,t,n,!1,!1);else if("MultiLineString"===o||"Polygon"===o)for(a=0;a<i.length;a++)_t(s,i[a],t,n,"Polygon"===o,0===a);else if("MultiPolygon"===o)for(var c=0;c<i.length;c++){var l=i[c];for(a=0;a<l.length;a++)_t(s,l[a],t,n,!0,0===a)}if(s.length){var u=e.tags||null;if("LineString"===o&&r.lineMetrics){for(var h in u={},e.tags)u[h]=e.tags[h];u.mapbox_clip_start=i.start/i.size,u.mapbox_clip_end=i.end/i.size}var d={geometry:s,type:"Polygon"===o||"MultiPolygon"===o?3:"LineString"===o||"MultiLineString"===o?2:1,tags:u};null!==e.id&&(d.id=e.id),t.features.push(d)}}function _t(t,e,n,r,i,o){var s=r*r;if(r>0&&e.size<(i?s:r))n.numPoints+=e.length/3;else{for(var a=[],c=0;c<e.length;c+=3)(0===r||e[c+2]>s)&&(n.numSimplified++,a.push(e[c]),a.push(e[c+1])),n.numPoints++;i&&function(t,e){for(var n=0,r=0,i=t.length,o=i-2;r<i;o=r,r+=2)n+=(t[r]-t[o])*(t[r+1]+t[o+1]);if(n>0===e)for(r=0,i=t.length;r<i/2;r+=2){var s=t[r],a=t[r+1];t[r]=t[i-2-r],t[r+1]=t[i-1-r],t[i-2-r]=s,t[i-1-r]=a}}(a,o),t.push(a)}}function yt(t,e){var n=(e=this.options=function(t,e){for(var n in e)t[n]=e[n];return t}(Object.create(this.options),e)).debug;if(n&&console.time("preprocess data"),e.maxZoom<0||e.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(e.promoteId&&e.generateId)throw new Error("promoteId and generateId cannot be used together.");var r=function(t,e){var n=[];if("FeatureCollection"===t.type)for(var r=0;r<t.features.length;r++)Y(n,t.features[r],e,r);else Y(n,"Feature"===t.type?t:{geometry:t},e);return n}(t,e);this.tiles={},this.tileCoords=[],n&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",e.indexMaxZoom,e.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(r=function(t,e){var n=e.buffer/e.extent,r=t,i=rt(t,1,-1-n,n,0,-1,2,e),o=rt(t,1,1-n,2+n,0,-1,2,e);return(i||o)&&(r=rt(t,1,-n,1+n,0,-1,2,e)||[],i&&(r=ht(i,1).concat(r)),o&&(r=r.concat(ht(o,-1)))),r}(r,e)).length&&this.splitTile(r,0,0,0),n&&(r.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function vt(t,e,n){return 32*((1<<t)*n+e)+t}function bt(t,e){const n=t.tileID.canonical;if(!this._geoJSONIndex)return e(null,null);const r=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!r)return e(null,null);const i=new u(r.features);let o=m(i);0===o.byteOffset&&o.byteLength===o.buffer.byteLength||(o=new Uint8Array(o)),e(null,{vectorTile:i,rawData:o.buffer})}yt.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yt.prototype.splitTile=function(t,e,n,r,i,o,s){for(var a=[t,e,n,r],c=this.options,l=c.debug;a.length;){r=a.pop(),n=a.pop(),e=a.pop(),t=a.pop();var u=1<<e,h=vt(e,n,r),d=this.tiles[h];if(!d&&(l>1&&console.time("creation"),d=this.tiles[h]=mt(t,e,n,r,c),this.tileCoords.push({z:e,x:n,y:r}),l)){l>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",e,n,r,d.numFeatures,d.numPoints,d.numSimplified),console.timeEnd("creation"));var p="z"+e;this.stats[p]=(this.stats[p]||0)+1,this.total++}if(d.source=t,i){if(e===c.maxZoom||e===i)continue;var f=1<<i-e;if(n!==Math.floor(o/f)||r!==Math.floor(s/f))continue}else if(e===c.indexMaxZoom||d.numPoints<=c.indexMaxPoints)continue;if(d.source=null,0!==t.length){l>1&&console.time("clipping");var m,g,_,y,v,b,x=.5*c.buffer/c.extent,w=.5-x,T=.5+x,C=1+x;m=g=_=y=null,v=rt(t,u,n-x,n+T,0,d.minX,d.maxX,c),b=rt(t,u,n+w,n+C,0,d.minX,d.maxX,c),t=null,v&&(m=rt(v,u,r-x,r+T,1,d.minY,d.maxY,c),g=rt(v,u,r+w,r+C,1,d.minY,d.maxY,c),v=null),b&&(_=rt(b,u,r-x,r+T,1,d.minY,d.maxY,c),y=rt(b,u,r+w,r+C,1,d.minY,d.maxY,c),b=null),l>1&&console.timeEnd("clipping"),a.push(m||[],e+1,2*n,2*r),a.push(g||[],e+1,2*n,2*r+1),a.push(_||[],e+1,2*n+1,2*r),a.push(y||[],e+1,2*n+1,2*r+1)}}},yt.prototype.getTile=function(t,e,n){var r=this.options,i=r.extent,o=r.debug;if(t<0||t>24)return null;var s=1<<t,a=vt(t,e=(e%s+s)%s,n);if(this.tiles[a])return pt(this.tiles[a],i);o>1&&console.log("drilling down to z%d-%d-%d",t,e,n);for(var c,l=t,u=e,h=n;!c&&l>0;)l--,u=Math.floor(u/2),h=Math.floor(h/2),c=this.tiles[vt(l,u,h)];return c&&c.source?(o>1&&console.log("found parent tile z%d-%d-%d",l,u,h),o>1&&console.time("drilling down"),this.splitTile(c.source,l,u,h,t,e,n),o>1&&console.timeEnd("drilling down"),this.tiles[a]?pt(this.tiles[a],i):null):null};class xt extends t.VectorTileWorkerSource{constructor(t,e,n,r,i){super(t,e,n,r,bt),i&&(this.loadGeoJSON=i)}loadData(e,n){const r=e&&e.request,i=r&&r.collectResourceTiming;this.loadGeoJSON(e,(s,a)=>{if(s||!a)return n(s);if("object"!=typeof a)return n(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));{o(a,!0);try{if(e.filter){const n=t.createExpression(e.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===n.result)throw new Error(n.value.map(t=>`${t.key}: ${t.message}`).join(", "));const r=a.features.filter(t=>n.value.evaluate({zoom:0},t));a={type:"FeatureCollection",features:r}}this._geoJSONIndex=e.cluster?new L(function({superclusterOptions:e,clusterProperties:n}){if(!n||!e)return e;const r={},i={},o={accumulated:null,zoom:0},s={properties:null},a=Object.keys(n);for(const c of a){const[e,o]=n[c],s=t.createExpression(o),a=t.createExpression("string"==typeof e?[e,["accumulated"],["get",c]]:e);r[c]=s.value,i[c]=a.value}return e.map=t=>{s.properties=t;const e={};for(const n of a)e[n]=r[n].evaluate(o,s);return e},e.reduce=(t,e)=>{s.properties=e;for(const n of a)o.accumulated=t[n],t[n]=i[n].evaluate(o,s)},e}(e)).load(a.features):function(t,e){return new yt(t,e)}(a,e.geojsonVtOptions)}catch(s){return n(s)}this.loaded={};const c={};if(i){const n=t.getPerformanceMeasurement(r);n&&(c.resourceTiming={},c.resourceTiming[e.source]=JSON.parse(JSON.stringify(n)))}n(null,c)}})}reloadTile(t,e){const n=this.loaded;return n&&n[t.uid]?super.reloadTile(t,e):this.loadTile(t,e)}loadGeoJSON(e,n){if(e.request)t.getJSON(e.request,n);else{if("string"!=typeof e.data)return n(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`));try{return n(null,JSON.parse(e.data))}catch(t){return n(new Error(`Input data given to '${e.source}' is not a valid GeoJSON object.`))}}}getClusterExpansionZoom(t,e){try{e(null,this._geoJSONIndex.getClusterExpansionZoom(t.clusterId))}catch(t){e(t)}}getClusterChildren(t,e){try{e(null,this._geoJSONIndex.getChildren(t.clusterId))}catch(t){e(t)}}getClusterLeaves(t,e){try{e(null,this._geoJSONIndex.getLeaves(t.clusterId,t.limit,t.offset))}catch(t){e(t)}}}class wt{constructor(e){this.self=e,this.actor=new t.Actor(e,this),this.layerIndexes={},this.availableImages={},this.isSpriteLoaded={},this.projections={},this.defaultProjection=t.getProjection({name:"mercator"}),this.workerSourceTypes={vector:t.VectorTileWorkerSource,geojson:xt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=(t,e)=>{if(this.workerSourceTypes[t])throw new Error(`Worker source with name "${t}" already registered.`);this.workerSourceTypes[t]=e},this.self.registerRTLTextPlugin=e=>{if(t.plugin.isParsed())throw new Error("RTL text plugin already registered.");t.plugin.applyArabicShaping=e.applyArabicShaping,t.plugin.processBidirectionalText=e.processBidirectionalText,t.plugin.processStyledBidirectionalText=e.processStyledBidirectionalText}}clearCaches(t,e,n){delete this.layerIndexes[t],delete this.availableImages[t],delete this.workerSources[t],delete this.demWorkerSources[t],n()}checkIfReady(t,e,n){n()}setReferrer(t,e){this.referrer=e}spriteLoaded(e,n){this.isSpriteLoaded[e]=n;for(const r in this.workerSources[e]){const i=this.workerSources[e][r];for(const e in i)i[e]instanceof t.VectorTileWorkerSource&&(i[e].isSpriteLoaded=n,i[e].fire(new t.Event("isSpriteLoaded")))}}setImages(t,e,n){this.availableImages[t]=e;for(const r in this.workerSources[t]){const n=this.workerSources[t][r];for(const t in n)n[t].availableImages=e}n()}enableTerrain(t,e,n){this.terrain=e,n()}setProjection(e,n){this.projections[e]=t.getProjection(n)}setLayers(t,e,n){this.getLayerIndex(t).replace(e),n()}updateLayers(t,e,n){this.getLayerIndex(t).update(e.layers,e.removedIds),n()}loadTile(e,n,r){const i=this.enableTerrain?t.extend({enableTerrain:this.terrain},n):n;i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,n.type,n.source).loadTile(i,r)}loadDEMTile(e,n,r){const i=this.enableTerrain?t.extend({buildQuadTree:this.terrain},n):n;this.getDEMWorkerSource(e,n.source).loadTile(i,r)}reloadTile(e,n,r){const i=this.enableTerrain?t.extend({enableTerrain:this.terrain},n):n;i.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,n.type,n.source).reloadTile(i,r)}abortTile(t,e,n){this.getWorkerSource(t,e.type,e.source).abortTile(e,n)}removeTile(t,e,n){this.getWorkerSource(t,e.type,e.source).removeTile(e,n)}removeSource(t,e,n){if(!this.workerSources[t]||!this.workerSources[t][e.type]||!this.workerSources[t][e.type][e.source])return;const r=this.workerSources[t][e.type][e.source];delete this.workerSources[t][e.type][e.source],void 0!==r.removeSource?r.removeSource(e,n):n()}loadWorkerSource(t,e,n){try{this.self.importScripts(e.url),n()}catch(t){n(t.toString())}}syncRTLPluginState(e,n,r){try{t.plugin.setState(n);const e=t.plugin.getPluginURL();if(t.plugin.isLoaded()&&!t.plugin.isParsed()&&null!=e){this.self.importScripts(e);const n=t.plugin.isParsed();r(n?void 0:new Error(`RTL Text Plugin failed to import scripts from ${e}`),n)}}catch(t){r(t.toString())}}getAvailableImages(t){let e=this.availableImages[t];return e||(e=[]),e}getLayerIndex(t){let e=this.layerIndexes[t];return e||(e=this.layerIndexes[t]=new r),e}getWorkerSource(t,e,n){return this.workerSources[t]||(this.workerSources[t]={}),this.workerSources[t][e]||(this.workerSources[t][e]={}),this.workerSources[t][e][n]||(this.workerSources[t][e][n]=new this.workerSourceTypes[e]({send:(e,n,r,i,o,s)=>{this.actor.send(e,n,r,t,o,s)},scheduler:this.actor.scheduler},this.getLayerIndex(t),this.getAvailableImages(t),this.isSpriteLoaded[t])),this.workerSources[t][e][n]}getDEMWorkerSource(t,e){return this.demWorkerSources[t]||(this.demWorkerSources[t]={}),this.demWorkerSources[t][e]||(this.demWorkerSources[t][e]=new i),this.demWorkerSources[t][e]}enforceCacheSizeLimit(e,n){t.enforceCacheSizeLimit(n)}getWorkerPerformanceMetrics(t,e,n){n(void 0,void 0)}}return"undefined"!=typeof WorkerGlobalScope&&"undefined"!=typeof self&&self instanceof WorkerGlobalScope&&(self.worker=new wt(self)),wt}),r(0,function(t){var e=n;function n(t){return!function(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var t,e,n=new Blob([""],{type:"text/javascript"}),r=URL.createObjectURL(n);try{e=new Worker(r),t=!0}catch(e){t=!1}return e&&e.terminate(),URL.revokeObjectURL(r),t}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var t=document.createElement("canvas");t.width=t.height=1;var e=t.getContext("2d");if(!e)return!1;var n=e.getImageData(0,0,1,1);return n&&n.width===t.width}()?(void 0===r[e=t&&t.failIfMajorPerformanceCaveat]&&(r[e]=function(t){var e,r=function(t){var e=document.createElement("canvas"),r=Object.create(n.webGLContextAttributes);return r.failIfMajorPerformanceCaveat=t,e.getContext("webgl",r)||e.getContext("experimental-webgl",r)}(t);if(!r)return!1;try{e=r.createShader(r.VERTEX_SHADER)}catch(t){return!1}return!(!e||r.isContextLost())&&(r.shaderSource(e,"void main() {}"),r.compileShader(e),!0===r.getShaderParameter(e,r.COMPILE_STATUS))}(e)),r[e]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var e}(t)}var r={};function i(t,e){if(Array.isArray(t)){if(!Array.isArray(e)||t.length!==e.length)return!1;for(let n=0;n<t.length;n++)if(!i(t[n],e[n]))return!1;return!0}if("object"==typeof t&&null!==t&&null!==e){if("object"!=typeof e)return!1;if(Object.keys(t).length!==Object.keys(e).length)return!1;for(const n in t)if(!i(t[n],e[n]))return!1;return!0}return t===e}function o(e,n,r){const i=t.window.document.createElement(e);return void 0!==n&&(i.className=n),r&&r.appendChild(i),i}function s(e,n,r){const i=t.window.document.createElementNS("http://www.w3.org/2000/svg",e);for(const t of Object.keys(n))i.setAttributeNS(null,t,n[t]);return r&&r.appendChild(i),i}n.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0};const a=t.window.document&&t.window.document.documentElement.style,c=a&&void 0!==a.userSelect?"userSelect":"WebkitUserSelect";let l;function u(){a&&c&&(l=a[c],a[c]="none")}function h(){a&&c&&(a[c]=l)}function d(e){e.preventDefault(),e.stopPropagation(),t.window.removeEventListener("click",d,!0)}function p(){t.window.addEventListener("click",d,!0),t.window.setTimeout(()=>{t.window.removeEventListener("click",d,!0)},0)}function f(t,e){const n=t.getBoundingClientRect();return _(t,n,e)}function m(t,e){const n=t.getBoundingClientRect(),r=[];for(let i=0;i<e.length;i++)r.push(_(t,n,e[i]));return r}function g(e){return void 0!==t.window.InstallTrigger&&2===e.button&&e.ctrlKey&&t.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:e.button}function _(e,n,r){const i=e.offsetWidth===n.width?1:e.offsetWidth/n.width;return new t.pointGeometry((r.clientX-n.left)*i,(r.clientY-n.top)*i)}function y(t,e){var n=e[0],r=e[1],i=e[2],o=e[3],s=n*o-i*r;return s?(t[0]=o*(s=1/s),t[1]=-r*s,t[2]=-i*s,t[3]=n*s,t):null}function v(t){const{userImage:e}=t;return!!(e&&e.render&&e.render())&&(t.data.replace(new Uint8Array(e.data.buffer)),!0)}class b extends t.Evented{constructor(){super(),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new t.RGBAImage({width:1,height:1}),this.dirty=!0}isLoaded(){return this.loaded}setLoaded(t){if(this.loaded!==t&&(this.loaded=t,t)){for(const{ids:t,callback:e}of this.requestors)this._notify(t,e);this.requestors=[]}}hasImage(t){return!!this.getImage(t)}getImage(t){return this.images[t]}addImage(t,e){this._validate(t,e)&&(this.images[t]=e)}_validate(e,n){let r=!0;return this._validateStretch(n.stretchX,n.data&&n.data.width)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchX" value`))),r=!1),this._validateStretch(n.stretchY,n.data&&n.data.height)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "stretchY" value`))),r=!1),this._validateContent(n.content,n)||(this.fire(new t.ErrorEvent(new Error(`Image "${e}" has invalid "content" value`))),r=!1),r}_validateStretch(t,e){if(!t)return!0;let n=0;for(const r of t){if(r[0]<n||r[1]<r[0]||e<r[1])return!1;n=r[1]}return!0}_validateContent(t,e){return!(t&&(4!==t.length||t[0]<0||e.data.width<t[0]||t[1]<0||e.data.height<t[1]||t[2]<0||e.data.width<t[2]||t[3]<0||e.data.height<t[3]||t[2]<t[0]||t[3]<t[1]))}updateImage(t,e){e.version=this.images[t].version+1,this.images[t]=e,this.updatedImages[t]=!0}removeImage(t){const e=this.images[t];delete this.images[t],delete this.patterns[t],e.userImage&&e.userImage.onRemove&&e.userImage.onRemove()}listImages(){return Object.keys(this.images)}getImages(t,e){let n=!0;if(!this.isLoaded())for(const r of t)this.images[r]||(n=!1);this.isLoaded()||n?this._notify(t,e):this.requestors.push({ids:t,callback:e})}_notify(e,n){const r={};for(const i of e){this.images[i]||this.fire(new t.Event("styleimagemissing",{id:i}));const e=this.images[i];e?r[i]={data:e.data.clone(),pixelRatio:e.pixelRatio,sdf:e.sdf,version:e.version,stretchX:e.stretchX,stretchY:e.stretchY,content:e.content,hasRenderCallback:Boolean(e.userImage&&e.userImage.render)}:t.warnOnce(`Image "${i}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`)}n(null,r)}getPixelSize(){const{width:t,height:e}=this.atlasImage;return{width:t,height:e}}getPattern(e){const n=this.patterns[e],r=this.getImage(e);if(!r)return null;if(n&&n.position.version===r.version)return n.position;if(n)n.position.version=r.version;else{const n={w:r.data.width+2,h:r.data.height+2,x:0,y:0},i=new t.ImagePosition(n,r);this.patterns[e]={bin:n,position:i}}return this._updatePatternAtlas(),this.patterns[e].position}bind(e){const n=e.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new t.Texture(e,this.atlasImage,n.RGBA),this.atlasTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(){const e=[];for(const t in this.patterns)e.push(this.patterns[t].bin);const{w:n,h:r}=t.potpack(e),i=this.atlasImage;i.resize({width:n||1,height:r||1});for(const o in this.patterns){const{bin:e}=this.patterns[o],n=e.x+1,r=e.y+1,s=this.images[o].data,a=s.width,c=s.height;t.RGBAImage.copy(s,i,{x:0,y:0},{x:n,y:r},{width:a,height:c}),t.RGBAImage.copy(s,i,{x:0,y:c-1},{x:n,y:r-1},{width:a,height:1}),t.RGBAImage.copy(s,i,{x:0,y:0},{x:n,y:r+c},{width:a,height:1}),t.RGBAImage.copy(s,i,{x:a-1,y:0},{x:n-1,y:r},{width:1,height:c}),t.RGBAImage.copy(s,i,{x:0,y:0},{x:n+a,y:r},{width:1,height:c})}this.dirty=!0}beginFrame(){this.callbackDispatchedThisFrame={}}dispatchRenderCallbacks(t){for(const e of t){if(this.callbackDispatchedThisFrame[e])continue;this.callbackDispatchedThisFrame[e]=!0;const t=this.images[e];v(t)&&this.updateImage(e,t)}}}const x=new t.Properties({anchor:new t.DataConstantProperty(t.spec.light.anchor),position:new class{constructor(){this.specification=t.spec.light.position}possiblyEvaluate(e,n){return function([e,n,r]){const i=t.degToRad(n+90),o=t.degToRad(r);return{x:e*Math.cos(i)*Math.sin(o),y:e*Math.sin(i)*Math.sin(o),z:e*Math.cos(o),azimuthal:n,polar:r}}(e.expression.evaluate(n))}interpolate(e,n,r){return{x:t.number(e.x,n.x,r),y:t.number(e.y,n.y,r),z:t.number(e.z,n.z,r),azimuthal:t.number(e.azimuthal,n.azimuthal,r),polar:t.number(e.polar,n.polar,r)}}},color:new t.DataConstantProperty(t.spec.light.color),intensity:new t.DataConstantProperty(t.spec.light.intensity)}),w="-transition";class T extends t.Evented{constructor(e){super(),this._transitionable=new t.Transitionable(x),this.setLight(e),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,n={}){if(!this._validate(t.validateLight,e,n))for(const r in e){const n=e[r];t.endsWith(r,w)?this._transitionable.setTransition(r.slice(0,-w.length),n):this._transitionable.setValue(r,n)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,n,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}const C=new t.Properties({source:new t.DataConstantProperty(t.spec.terrain.source),exaggeration:new t.DataConstantProperty(t.spec.terrain.exaggeration)}),E="-transition";class S extends t.Evented{constructor(e,n){super(),this._transitionable=new t.Transitionable(C),this.set(e),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=n}get(){return this._transitionable.serialize()}set(e){for(const n in e){const r=e[n];t.endsWith(n,E)?this._transitionable.setTransition(n.slice(0,-E.length),r):this._transitionable.setValue(n,r)}}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}}function I(e,n,r,i){const o=t.smoothstep(45,65,r),[s,a]=k(e,i),c=t.length(n);let l=1-Math.min(1,Math.exp((c-s)/(a-s)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*o*e.alpha}function k(t,e){const n=.5/Math.tan(.5*e);return[t.range[0]+n,t.range[1]+n]}const A=new t.Properties({range:new t.DataConstantProperty(t.spec.fog.range),color:new t.DataConstantProperty(t.spec.fog.color),"horizon-blend":new t.DataConstantProperty(t.spec.fog["horizon-blend"])}),M="-transition";class O extends t.Evented{constructor(e,n){super(),this._transitionable=new t.Transitionable(A),this.set(e),this._transitioning=this._transitionable.untransitioned(),this._transform=n}get state(){return{range:this.properties.get("range"),horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,n={}){if(!this._validate(t.validateFog,e,n))for(const r in e){const n=e[r];t.endsWith(r,M)?this._transitionable.setTransition(r.slice(0,-M.length),n):this._transitionable.setValue(r,n)}}getOpacity(e){if(!this._transform.projection.supportsFog)return 0;const n=this.properties&&this.properties.get("color")||1;return t.smoothstep(45,65,e)*n.a}getOpacityAtLatLng(e,n){return this._transform.projection.supportsFog?function(e,n,r){const i=t.MercatorCoordinate.fromLngLat(n),o=r.elevation?r.elevation.getAtPointOrZero(i):0,s=[i.x,i.y,o];return t.transformMat4(s,s,r.mercatorFogMatrix),I(e,s,r.pitch,r._fov)}(this.state,e,n):0}getFovAdjustedRange(t){return this._transform.projection.supportsFog?k(this.state,t):[0,1]}updateTransitions(t){this._transitioning=this._transitionable.transitioned(t,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(t){this.properties=this._transitioning.possiblyEvaluate(t)}_validate(e,n,r){return(!r||!1!==r.validate)&&t.emitValidationErrors(this,e.call(t.validateStyle,t.extend({value:n,style:{glyphs:!0,sprite:!0},styleSpec:t.spec})))}}class P{constructor(e,n){this.workerPool=e,this.actors=[],this.currentActor=0,this.id=t.uniqueId();const r=this.workerPool.acquire(this.id);for(let t=0;t<r.length;t++){const e=new P.Actor(r[t],n,this.id);e.name=`Worker ${t}`,this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,n,r){t.asyncAll(this.actors,(t,r)=>{t.send(e,n,r)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}function D(e,n,r){return n*(t.EXTENT/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}P.Actor=t.Actor;class R{constructor(t,e,n,r){this.screenBounds=t,this.cameraPoint=e,this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=n,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this.screenGeometry.map(t=>r.pointCoordinate3D(t)),this.cameraGeometry=this.bufferedCameraGeometry(0)}static createFromScreenPoints(e,n){let r,i;if(e instanceof t.pointGeometry||"number"==typeof e[0]){const o=t.pointGeometry.convert(e);r=[t.pointGeometry.convert(e)],i=n.isPointAboveHorizon(o)}else{const o=t.pointGeometry.convert(e[0]),s=t.pointGeometry.convert(e[1]);r=[o,s],i=t.polygonizeBounds(o,s).every(t=>n.isPointAboveHorizon(t))}return new R(r,n.getCameraPoint(),i,n)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(e){return t.polygonizeBounds(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],e)}bufferedCameraGeometry(e){const n=this.screenBounds[0],r=1===this.screenBounds.length?this.screenBounds[0].add(new t.pointGeometry(1,1)):this.screenBounds[1],i=t.polygonizeBounds(n,r,0,!1);return this.cameraPoint.y>r.y&&(this.cameraPoint.x>n.x&&this.cameraPoint.x<r.x?i.splice(3,0,this.cameraPoint):this.cameraPoint.x>=r.x?i[2]=this.cameraPoint:this.cameraPoint.x<=n.x&&(i[3]=this.cameraPoint)),t.bufferConvexPolygon(i,e)}containsTile(e,n,r){const i=e.queryPadding+1,o=e.tileID.wrap,s=r?this._bufferedCameraMercator(i,n).map(n=>t.getTilePoint(e.tileTransform,n,o)):this._bufferedScreenMercator(i,n).map(n=>t.getTilePoint(e.tileTransform,n,o)),a=this.screenGeometryMercator.map(n=>t.getTileVec3(e.tileTransform,n,o)),c=a.map(e=>new t.pointGeometry(e[0],e[1])),l=n.getFreeCameraOptions().position||new t.MercatorCoordinate(0,0,0),u=t.getTileVec3(e.tileTransform,l,o),h=a.map(e=>{const n=t.sub(e,e,u);return t.normalize(n,n),new t.Ray(u,n)}),d=D(e,1,n.zoom);if(t.polygonIntersectsBox(s,0,0,t.EXTENT,t.EXTENT))return{queryGeometry:this,tilespaceGeometry:c,tilespaceRays:h,bufferedTilespaceGeometry:s,bufferedTilespaceBounds:(p=t.getBounds(s),p.min.x=t.clamp(p.min.x,0,t.EXTENT),p.min.y=t.clamp(p.min.y,0,t.EXTENT),p.max.x=t.clamp(p.max.x,0,t.EXTENT),p.max.y=t.clamp(p.max.y,0,t.EXTENT),p),tile:e,tileID:e.tileID,pixelToTileUnitsFactor:d};var p}_bufferedScreenMercator(t,e){const n=N(t);if(this._screenRaycastCache[n])return this._screenRaycastCache[n];{const r=this.bufferedScreenGeometry(t).map(t=>e.pointCoordinate3D(t));return this._screenRaycastCache[n]=r,r}}_bufferedCameraMercator(t,e){const n=N(t);if(this._cameraRaycastCache[n])return this._cameraRaycastCache[n];{const r=this.bufferedCameraGeometry(t).map(t=>e.pointCoordinate3D(t));return this._cameraRaycastCache[n]=r,r}}}function N(t){return 100*t|0}function L(e,n,r){const i=function(i,o){if(i)return r(i);if(o){const i=t.pick(t.extend(o,e),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);o.vector_layers&&(i.vectorLayers=o.vector_layers,i.vectorLayerIds=i.vectorLayers.map(t=>t.id)),i.tiles=n.canonicalizeTileset(i,e.url),r(null,i)}};return e.url?t.getJSON(n.transformRequest(n.normalizeSourceURL(e.url),t.ResourceType.Source),i):t.exported.frame(()=>i(null,e))}class j{constructor(e,n,r){this.bounds=t.LngLatBounds.convert(this.validateBounds(e)),this.minzoom=n||0,this.maxzoom=r||24}validateBounds(t){return Array.isArray(t)&&4===t.length?[Math.max(-180,t[0]),Math.max(-90,t[1]),Math.min(180,t[2]),Math.min(90,t[3])]:[-180,-90,180,90]}contains(e){const n=Math.pow(2,e.z),r=Math.floor(t.mercatorXfromLng(this.bounds.getWest())*n),i=Math.floor(t.mercatorYfromLat(this.bounds.getNorth())*n),o=Math.ceil(t.mercatorXfromLng(this.bounds.getEast())*n),s=Math.ceil(t.mercatorYfromLat(this.bounds.getSouth())*n);return e.x>=r&&e.x<o&&e.y>=i&&e.y<s}}class z{constructor(t,e,n){this.context=t;const r=t.gl;this.buffer=r.createBuffer(),this.dynamicDraw=Boolean(n),this.context.unbindVAO(),t.bindElementBuffer.set(this.buffer),r.bufferData(r.ELEMENT_ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?r.DYNAMIC_DRAW:r.STATIC_DRAW),this.dynamicDraw||e.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.context.unbindVAO(),this.bind(),e.bufferSubData(e.ELEMENT_ARRAY_BUFFER,0,t.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}const F={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class B{constructor(t,e,n,r){this.length=e.length,this.attributes=n,this.itemSize=e.bytesPerElement,this.dynamicDraw=r,this.context=t;const i=t.gl;this.buffer=i.createBuffer(),t.bindVertexBuffer.set(this.buffer),i.bufferData(i.ARRAY_BUFFER,e.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||e.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(t){const e=this.context.gl;this.bind(),e.bufferSubData(e.ARRAY_BUFFER,0,t.arrayBuffer)}enableAttributes(t,e){for(let n=0;n<this.attributes.length;n++){const r=e.attributes[this.attributes[n].name];void 0!==r&&t.enableVertexAttribArray(r)}}setVertexAttribPointers(t,e,n){for(let r=0;r<this.attributes.length;r++){const i=this.attributes[r],o=e.attributes[i.name];void 0!==o&&t.vertexAttribPointer(o,i.components,t[F[i.type]],!1,this.itemSize,i.offset+this.itemSize*(n||0))}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class U{constructor(t){this.gl=t.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(t){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class V extends U{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.clearColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class q extends U{getDefault(){return 1}set(t){(t!==this.current||this.dirty)&&(this.gl.clearDepth(t),this.current=t,this.dirty=!1)}}class G extends U{getDefault(){return 0}set(t){(t!==this.current||this.dirty)&&(this.gl.clearStencil(t),this.current=t,this.dirty=!1)}}class $ extends U{getDefault(){return[!0,!0,!0,!0]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.colorMask(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class W extends U{getDefault(){return!0}set(t){(t!==this.current||this.dirty)&&(this.gl.depthMask(t),this.current=t,this.dirty=!1)}}class H extends U{getDefault(){return 255}set(t){(t!==this.current||this.dirty)&&(this.gl.stencilMask(t),this.current=t,this.dirty=!1)}}class Z extends U{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(t){const e=this.current;(t.func!==e.func||t.ref!==e.ref||t.mask!==e.mask||this.dirty)&&(this.gl.stencilFunc(t.func,t.ref,t.mask),this.current=t,this.dirty=!1)}}class K extends U{getDefault(){const t=this.gl;return[t.KEEP,t.KEEP,t.KEEP]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||this.dirty)&&(this.gl.stencilOp(t[0],t[1],t[2]),this.current=t,this.dirty=!1)}}class X extends U{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.STENCIL_TEST):e.disable(e.STENCIL_TEST),this.current=t,this.dirty=!1}}class Y extends U{getDefault(){return[0,1]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.depthRange(t[0],t[1]),this.current=t,this.dirty=!1)}}class Q extends U{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.DEPTH_TEST):e.disable(e.DEPTH_TEST),this.current=t,this.dirty=!1}}class J extends U{getDefault(){return this.gl.LESS}set(t){(t!==this.current||this.dirty)&&(this.gl.depthFunc(t),this.current=t,this.dirty=!1)}}class tt extends U{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.BLEND):e.disable(e.BLEND),this.current=t,this.dirty=!1}}class et extends U{getDefault(){const t=this.gl;return[t.ONE,t.ZERO]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||this.dirty)&&(this.gl.blendFunc(t[0],t[1]),this.current=t,this.dirty=!1)}}class nt extends U{getDefault(){return t.Color.transparent}set(t){const e=this.current;(t.r!==e.r||t.g!==e.g||t.b!==e.b||t.a!==e.a||this.dirty)&&(this.gl.blendColor(t.r,t.g,t.b,t.a),this.current=t,this.dirty=!1)}}class rt extends U{getDefault(){return this.gl.FUNC_ADD}set(t){(t!==this.current||this.dirty)&&(this.gl.blendEquation(t),this.current=t,this.dirty=!1)}}class it extends U{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;t?e.enable(e.CULL_FACE):e.disable(e.CULL_FACE),this.current=t,this.dirty=!1}}class ot extends U{getDefault(){return this.gl.BACK}set(t){(t!==this.current||this.dirty)&&(this.gl.cullFace(t),this.current=t,this.dirty=!1)}}class st extends U{getDefault(){return this.gl.CCW}set(t){(t!==this.current||this.dirty)&&(this.gl.frontFace(t),this.current=t,this.dirty=!1)}}class at extends U{getDefault(){return null}set(t){(t!==this.current||this.dirty)&&(this.gl.useProgram(t),this.current=t,this.dirty=!1)}}class ct extends U{getDefault(){return this.gl.TEXTURE0}set(t){(t!==this.current||this.dirty)&&(this.gl.activeTexture(t),this.current=t,this.dirty=!1)}}class lt extends U{getDefault(){const t=this.gl;return[0,0,t.drawingBufferWidth,t.drawingBufferHeight]}set(t){const e=this.current;(t[0]!==e[0]||t[1]!==e[1]||t[2]!==e[2]||t[3]!==e[3]||this.dirty)&&(this.gl.viewport(t[0],t[1],t[2],t[3]),this.current=t,this.dirty=!1)}}class ut extends U{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindFramebuffer(e.FRAMEBUFFER,t),this.current=t,this.dirty=!1}}class ht extends U{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindRenderbuffer(e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class dt extends U{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindTexture(e.TEXTURE_2D,t),this.current=t,this.dirty=!1}}class pt extends U{getDefault(){return null}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.bindBuffer(e.ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class ft extends U{getDefault(){return null}set(t){const e=this.gl;e.bindBuffer(e.ELEMENT_ARRAY_BUFFER,t),this.current=t,this.dirty=!1}}class mt extends U{constructor(t){super(t),this.vao=t.extVertexArrayObject}getDefault(){return null}set(t){this.vao&&(t!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(t),this.current=t,this.dirty=!1)}}class gt extends U{getDefault(){return 4}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_ALIGNMENT,t),this.current=t,this.dirty=!1}}class _t extends U{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_PREMULTIPLY_ALPHA_WEBGL,t),this.current=t,this.dirty=!1}}class yt extends U{getDefault(){return!1}set(t){if(t===this.current&&!this.dirty)return;const e=this.gl;e.pixelStorei(e.UNPACK_FLIP_Y_WEBGL,t),this.current=t,this.dirty=!1}}class vt extends U{constructor(t,e){super(t),this.context=t,this.parent=e}getDefault(){return null}}class bt extends vt{setDirty(){this.dirty=!0}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferTexture2D(e.FRAMEBUFFER,e.COLOR_ATTACHMENT0,e.TEXTURE_2D,t,0),this.current=t,this.dirty=!1}}class xt extends vt{attachment(){return this.gl.DEPTH_ATTACHMENT}set(t){if(t===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const e=this.gl;e.framebufferRenderbuffer(e.FRAMEBUFFER,this.attachment(),e.RENDERBUFFER,t),this.current=t,this.dirty=!1}}class wt extends xt{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}class Tt{constructor(t,e,n,r){this.context=t,this.width=e,this.height=n;const i=this.framebuffer=t.gl.createFramebuffer();this.colorAttachment=new bt(t,i),r&&(this.depthAttachment=new xt(t,i))}destroy(){const t=this.context.gl,e=this.colorAttachment.get();if(e&&t.deleteTexture(e),this.depthAttachment){const e=this.depthAttachment.get();e&&t.deleteRenderbuffer(e)}t.deleteFramebuffer(this.framebuffer)}}class Ct{constructor(t){this.gl=t,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new V(this),this.clearDepth=new q(this),this.clearStencil=new G(this),this.colorMask=new $(this),this.depthMask=new W(this),this.stencilMask=new H(this),this.stencilFunc=new Z(this),this.stencilOp=new K(this),this.stencilTest=new X(this),this.depthRange=new Y(this),this.depthTest=new Q(this),this.depthFunc=new J(this),this.blend=new tt(this),this.blendFunc=new et(this),this.blendColor=new nt(this),this.blendEquation=new rt(this),this.cullFace=new it(this),this.cullFaceSide=new ot(this),this.frontFace=new st(this),this.program=new at(this),this.activeTexture=new ct(this),this.viewport=new lt(this),this.bindFramebuffer=new ut(this),this.bindRenderbuffer=new ht(this),this.bindTexture=new dt(this),this.bindVertexBuffer=new pt(this),this.bindElementBuffer=new ft(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new mt(this),this.pixelStoreUnpack=new gt(this),this.pixelStoreUnpackPremultiplyAlpha=new _t(this),this.pixelStoreUnpackFlipY=new yt(this),this.extTextureFilterAnisotropic=t.getExtension("EXT_texture_filter_anisotropic")||t.getExtension("MOZ_EXT_texture_filter_anisotropic")||t.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=t.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureFilterAnisotropicForceOff=!1,this.extTextureHalfFloat=t.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(t.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=t.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=t.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=t.getParameter(t.MAX_TEXTURE_SIZE)}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(t,e){return new z(this,t,e)}createVertexBuffer(t,e,n){return new B(this,t,e,n)}createRenderbuffer(t,e,n){const r=this.gl,i=r.createRenderbuffer();return this.bindRenderbuffer.set(i),r.renderbufferStorage(r.RENDERBUFFER,t,e,n),this.bindRenderbuffer.set(null),i}createFramebuffer(t,e,n){return new Tt(this,t,e,n)}clear({color:t,depth:e,stencil:n}){const r=this.gl;let i=0;t&&(i|=r.COLOR_BUFFER_BIT,this.clearColor.set(t),this.colorMask.set([!0,!0,!0,!0])),void 0!==e&&(i|=r.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(e),this.depthMask.set(!0)),void 0!==n&&(i|=r.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),r.clear(i)}setCullFace(t){!1===t.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(t.mode),this.frontFace.set(t.frontFace))}setDepthMode(t){t.func!==this.gl.ALWAYS||t.mask?(this.depthTest.set(!0),this.depthFunc.set(t.func),this.depthMask.set(t.mask),this.depthRange.set(t.range)):this.depthTest.set(!1)}setStencilMode(t){t.test.func!==this.gl.ALWAYS||t.mask?(this.stencilTest.set(!0),this.stencilMask.set(t.mask),this.stencilOp.set([t.fail,t.depthFail,t.pass]),this.stencilFunc.set({func:t.test.func,ref:t.ref,mask:t.test.mask})):this.stencilTest.set(!1)}setColorMode(e){i(e.blendFunction,t.ColorMode.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(e.blendFunction),this.blendColor.set(e.blendColor)),this.colorMask.set(e.mask)}unbindVAO(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)}}class Et extends t.Evented{constructor(e,n,r,i){super(),this.id=e,this.dispatcher=r,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=t.extend({type:"raster"},n),t.extend(this,t.pick(n,["url","scheme","tileSize"]))}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=L(this._options,this.map._requestManager,(e,n)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(t.extend(this,n),n.bounds&&(this.tileBounds=new j(n.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(n.tiles),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}onAdd(t){this.map=t,this.load()}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,n){const r=t.exported.devicePixelRatio>=2,i=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),r,this.tileSize);e.request=t.getImage(this.map._requestManager.transformRequest(i,t.ResourceType.Tile),(r,i,o,s)=>(delete e.request,e.aborted?(e.state="unloaded",n(null)):r?(e.state="errored",n(r)):i?(this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:o,expires:s}),e.setTexture(i,this.map.painter),e.state="loaded",t.cacheEntryPossiblyAdded(this.dispatcher),void n(null)):n(null)))}static loadTileData(t,e,n){t.setTexture(e,n)}static unloadTileData(t,e){t.texture&&e.saveTileTexture(t.texture)}abortTile(t,e){t.request&&(t.request.cancel(),delete t.request),e()}unloadTile(t,e){t.texture&&this.map.painter.saveTileTexture(t.texture),e()}hasTransition(){return!1}}let St;function It(e,n,r,i,o,s,a,c){const l=[e,r,o,n,i,s,1,1,1],u=[a,c,1],h=t.adjoint([],l),[d,p,f]=t.transformMat3(u,u,t.transpose(h,h));return t.multiply(l,[d,0,0,0,p,0,0,0,f],l)}class kt extends t.Evented{constructor(t,e,n,r){super(),this.id=t,this.dispatcher=n,this.coordinates=e.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(r),this.options=e}load(e){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this.url=this.options.url,t.getImage(this.map._requestManager.transformRequest(this.url,t.ResourceType.Image),(n,r)=>{if(this._loaded=!0,n)this.fire(new t.ErrorEvent(n));else if(r){const{HTMLImageElement:n}=t.window;this.image=r instanceof n?t.exported.getImageData(r):r,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading()}})}loaded(){return this._loaded}updateImage(t){return this.image&&t.url?(this.options.url=t.url,this.load(t.coordinates),this):this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(){this.texture&&this.texture.destroy()}setCoordinates(e){this.coordinates=e,this._boundsArray=void 0;const n=e.map(t.MercatorCoordinate.fromLngLat);return this.tileID=function(e){let n=1/0,r=1/0,i=-1/0,o=-1/0;for(const t of e)n=Math.min(n,t.x),r=Math.min(r,t.y),i=Math.max(i,t.x),o=Math.max(o,t.y);const s=Math.max(i-n,o-r),a=Math.max(0,Math.floor(-Math.log(s)/Math.LN2)),c=Math.pow(2,a);return new t.CanonicalTileID(a,Math.floor((n+i)/2*c),Math.floor((r+o)/2*c))}(n),this.minzoom=this.maxzoom=this.tileID.z,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){this._boundsArray=void 0}_prepareData(e){for(const t in this.tiles){const e=this.tiles[t];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray)return;const n=t.tileTransform(this.tileID,this.map.transform.projection),[r,i,o,s]=this.coordinates.map(e=>{const r=n.projection.project(e[0],e[1]);return t.getTilePoint(n,r)._round()});this.perspectiveTransform=function(e,n,r,i,o,s,a,c,l,u){const h=It(0,0,e,0,0,n,e,n),d=It(r,i,o,s,a,c,l,u);return t.multiply(d,t.adjoint(h,h),d),[d[6]/d[8]*e/t.EXTENT,d[7]/d[8]*n/t.EXTENT]}(this.width,this.height,r.x,r.y,i.x,i.y,s.x,s.y,o.x,o.y);const a=this._boundsArray=new t.StructArrayLayout4i8;a.emplaceBack(r.x,r.y,0,0),a.emplaceBack(i.x,i.y,t.EXTENT,0),a.emplaceBack(s.x,s.y,0,t.EXTENT),a.emplaceBack(o.x,o.y,t.EXTENT,t.EXTENT),this.boundsBuffer&&this.boundsBuffer.destroy(),this.boundsBuffer=e.createVertexBuffer(a,t.boundsAttributes.members),this.boundsSegments=t.SegmentVector.simpleSegment(0,0,4,2)}prepare(){if(0===Object.keys(this.tiles).length||!this.image)return;const e=this.map.painter.context,n=e.gl;this.texture?this.texture.update(this.image):(this.texture=new t.Texture(e,this.image,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE)),this._prepareData(e)}loadTile(t,e){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},e(null)):(t.state="errored",e(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}}const At={vector:class extends t.Evented{constructor(e,n,r,i){if(super(),this.id=e,this.dispatcher=r,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,t.extend(this,t.pick(n,["url","scheme","tileSize","promoteId"])),this._options=t.extend({type:"vector"},n),this._collectResourceTiming=n.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i),this._tileWorkers={},this._deduped=new t.DedupedRequest}load(){this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=L(this._options,this.map._requestManager,(e,n)=>{this._tileJSONRequest=null,this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(t.extend(this,n),n.bounds&&(this.tileBounds=new j(n.bounds,this.minzoom,this.maxzoom)),t.postTurnstileEvent(n.tiles,this.map._requestManager._customAccessToken),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"})))})}loaded(){return this._loaded}hasTile(t){return!this.tileBounds||this.tileBounds.contains(t.canonical)}onAdd(t){this.map=t,this.load()}setSourceProperty(t){this._tileJSONRequest&&this._tileJSONRequest.cancel(),t();const e=this.map.style._getSourceCaches(this.id);for(const n of e)n.clearTiles();this.load()}setTiles(t){return this.setSourceProperty(()=>{this._options.tiles=t}),this}setUrl(t){return this.setSourceProperty(()=>{this.url=t,this._options.url=t}),this}onRemove(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}serialize(){return t.extend({},this._options)}loadTile(e,n){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(r,t.ResourceType.Tile),data:void 0,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,tileSize:this.tileSize*e.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:e.isSymbolTile};if(i.request.collectResourceTiming=this._collectResourceTiming,e.actor&&"expired"!==e.state)"loading"===e.state?e.reloadCallback=n:e.request=e.actor.send("reloadTile",i,o.bind(this));else if(e.actor=this._tileWorkers[r]=this._tileWorkers[r]||this.dispatcher.getActor(),this.dispatcher.ready)e.request=e.actor.send("loadTile",i,o.bind(this),void 0,!0);else{const n=t.loadVectorTile.call({deduped:this._deduped},i,(t,n)=>{t||!n?o.call(this,t):(i.data={cacheControl:n.cacheControl,expires:n.expires,rawData:n.rawData.slice(0)},e.actor&&e.actor.send("loadTile",i,o.bind(this),void 0,!0))},!0);e.request={cancel:n}}function o(r,i){return delete e.request,e.aborted?n(null):r&&404!==r.status?n(r):(i&&i.resourceTiming&&(e.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&e.setExpiryData(i),e.loadVectorData(i,this.map.painter),t.cacheEntryPossiblyAdded(this.dispatcher),n(null),void(e.reloadCallback&&(this.loadTile(e,e.reloadCallback),e.reloadCallback=null)))}}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.actor&&t.actor.send("abortTile",{uid:t.uid,type:this.type,source:this.id})}unloadTile(t){t.unloadVectorData(),t.actor&&t.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}},raster:Et,"raster-dem":class extends Et{constructor(e,n,r,i){super(e,n,r,i),this.type="raster-dem",this.maxzoom=22,this._options=t.extend({type:"raster-dem"},n),this.encoding=n.encoding||"mapbox"}loadTile(e,n){const r=this.map._requestManager.normalizeTileURL(e.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function i(t,r){t&&(e.state="errored",n(t)),r&&(e.dem=r,e.dem.onDeserialize(),e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0,e.state="loaded",n(null))}e.request=t.getImage(this.map._requestManager.transformRequest(r,t.ResourceType.Tile),(function(r,o,s,a){if(delete e.request,e.aborted)e.state="unloaded",n(null);else if(r)e.state="errored",n(r);else if(o){this.map._refreshExpiredTiles&&e.setExpiryData({cacheControl:s,expires:a});const n=t.window.ImageBitmap&&o instanceof t.window.ImageBitmap&&(null==St&&(St=t.window.OffscreenCanvas&&new t.window.OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof t.window.createImageBitmap),St),r=1-(o.width-t.prevPowerOfTwo(o.width))/2;r<1||e.neighboringTiles||(e.neighboringTiles=this._getNeighboringTiles(e.tileID));const c=n?o:t.exported.getImageData(o,r),l={uid:e.uid,coord:e.tileID,source:this.id,rawImageData:c,encoding:this.encoding,padding:r};e.actor&&"expired"!==e.state||(e.actor=this.dispatcher.getActor(),e.actor.send("loadDEMTile",l,i.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(e){const n=e.canonical,r=Math.pow(2,n.z),i=(n.x-1+r)%r,o=0===n.x?e.wrap-1:e.wrap,s=(n.x+1+r)%r,a=n.x+1===r?e.wrap+1:e.wrap,c={};return c[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y).key]={backfilled:!1},c[new t.OverscaledTileID(e.overscaledZ,a,n.z,s,n.y).key]={backfilled:!1},n.y>0&&(c[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y-1).key]={backfilled:!1},c[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y-1).key]={backfilled:!1},c[new t.OverscaledTileID(e.overscaledZ,a,n.z,s,n.y-1).key]={backfilled:!1}),n.y+1<r&&(c[new t.OverscaledTileID(e.overscaledZ,o,n.z,i,n.y+1).key]={backfilled:!1},c[new t.OverscaledTileID(e.overscaledZ,e.wrap,n.z,n.x,n.y+1).key]={backfilled:!1},c[new t.OverscaledTileID(e.overscaledZ,a,n.z,s,n.y+1).key]={backfilled:!1}),c}unloadTile(t){t.demTexture&&this.map.painter.saveTileTexture(t.demTexture),t.fbo&&(t.fbo.destroy(),delete t.fbo),t.dem&&delete t.dem,delete t.neighboringTiles,t.state="unloaded"}},geojson:class extends t.Evented{constructor(e,n,r,i){super(),this.id=e,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=r.getActor(),this.setEventedParent(i),this._data=n.data,this._options=t.extend({},n),this._collectResourceTiming=n.collectResourceTiming,void 0!==n.maxzoom&&(this.maxzoom=n.maxzoom),n.type&&(this.type=n.type),n.attribution&&(this.attribution=n.attribution),this.promoteId=n.promoteId;const o=t.EXTENT/this.tileSize;this.workerOptions=t.extend({source:this.id,cluster:n.cluster||!1,geojsonVtOptions:{buffer:(void 0!==n.buffer?n.buffer:128)*o,tolerance:(void 0!==n.tolerance?n.tolerance:.375)*o,extent:t.EXTENT,maxZoom:this.maxzoom,lineMetrics:n.lineMetrics||!1,generateId:n.generateId||!1},superclusterOptions:{maxZoom:void 0!==n.clusterMaxZoom?n.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,n.clusterMinPoints||2),extent:t.EXTENT,radius:(void 0!==n.clusterRadius?n.clusterRadius:50)*o,log:!1,generateId:n.generateId||!1},clusterProperties:n.clusterProperties,filter:n.filter},n.workerOptions)}onAdd(t){this.map=t,this.setData(this._data)}setData(t){return this._data=t,this._updateWorkerData(),this}getClusterExpansionZoom(t,e){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:t,source:this.id},e),this}getClusterChildren(t,e){return this.actor.send("geojson.getClusterChildren",{clusterId:t,source:this.id},e),this}getClusterLeaves(t,e,n,r){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:t,limit:e,offset:n},r),this}_updateWorkerData(){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new t.Event("dataloading",{dataType:"source"})),this._loaded=!1;const e=t.extend({},this.workerOptions),n=this._data;"string"==typeof n?(e.request=this.map._requestManager.transformRequest(t.exported.resolveURL(n),t.ResourceType.Source),e.request.collectResourceTiming=this._collectResourceTiming):e.data=JSON.stringify(n),this._pendingLoad=this.actor.send(`${this.type}.loadData`,e,(e,n)=>{if(this._loaded=!0,this._pendingLoad=null,e)this.fire(new t.ErrorEvent(e));else{const e={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(e.resourceTiming=n.resourceTiming[this.id]),this.fire(new t.Event("data",e)),this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(),this._coalesce=!1)})}loaded(){return this._loaded}loadTile(e,n){const r=e.actor?"reloadTile":"loadTile";e.actor=this.actor,e.request=this.actor.send(r,{type:this.type,uid:e.uid,tileID:e.tileID,tileZoom:e.tileZoom,zoom:e.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:t.exported.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},(t,i)=>(delete e.request,e.unloadVectorData(),e.aborted?n(null):t?n(t):(e.loadVectorData(i,this.map.painter,"reloadTile"===r),n(null))),void 0,"loadTile"===r)}abortTile(t){t.request&&(t.request.cancel(),delete t.request),t.aborted=!0}unloadTile(t){t.unloadVectorData(),this.actor.send("removeTile",{uid:t.uid,type:this.type,source:this.id})}onRemove(){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return t.extend({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends kt{constructor(t,e,n,r){super(t,e,n,r),this.roundZoom=!0,this.type="video",this.options=e}load(){this._loaded=!1;const e=this.options;this.urls=[];for(const n of e.urls)this.urls.push(this.map._requestManager.transformRequest(n,t.ResourceType.Source).url);t.getVideo(this.urls,(e,n)=>{this._loaded=!0,e?this.fire(new t.ErrorEvent(e)):n&&(this.video=n,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(e){if(this.video){const n=this.video.seekable;e<n.start(0)||e>n.end(0)?this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${this.id}`,null,`Playback for this video can be set only between the ${n.start(0)} and ${n.end(0)}-second mark.`))):this.video.currentTime=e}}getVideo(){return this.video}onAdd(t){this.map||(this.map=t,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const e=this.map.painter.context,n=e.gl;this.texture?this.video.paused||(this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),n.texSubImage2D(n.TEXTURE_2D,0,0,0,n.RGBA,n.UNSIGNED_BYTE,this.video)):(this.texture=new t.Texture(e,this.video,n.RGBA),this.texture.bind(n.LINEAR,n.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(e)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:kt,canvas:class extends kt{constructor(e,n,r,i){super(e,n,r,i),n.coordinates?Array.isArray(n.coordinates)&&4===n.coordinates.length&&!n.coordinates.some(t=>!Array.isArray(t)||2!==t.length||t.some(t=>"number"!=typeof t))||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "coordinates"'))),n.animate&&"boolean"!=typeof n.animate&&this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'optional "animate" property must be a boolean value'))),n.canvas?"string"==typeof n.canvas||n.canvas instanceof t.window.HTMLCanvasElement||this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new t.ErrorEvent(new t.ValidationError(`sources.${e}`,null,'missing required property "canvas"'))),this.options=n,this.animate=void 0===n.animate||n.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof t.window.HTMLCanvasElement?this.options.canvas:t.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new t.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(t){this.map=t,this.load(),this.canvas&&this.animate&&this.play()}onRemove(){this.pause()}prepare(){let e=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,e=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,e=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const n=this.map.painter.context;this.texture?(e||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new t.Texture(n,this.canvas,n.gl.RGBA,{premultiply:!0}),this._prepareData(n)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const t of[this.canvas.width,this.canvas.height])if(isNaN(t)||t<=0)return!0;return!1}},custom:class extends t.Evented{constructor(e,n,r,i){super(),this.id=e,this.type="custom",this._dataType="raster",this._dispatcher=r,this._implementation=n,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new t.ErrorEvent(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new t.ErrorEvent(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new j(this._implementation.bounds,this.minzoom,this.maxzoom)),n.update=this._update.bind(this),n.coveringTiles=this._coveringTiles.bind(this),t.extend(this,t.pick(n,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return t.pick(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new t.Event("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(e){this._map=e,this._loaded=!1,this.fire(new t.Event("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(e),this.load()}onRemove(t){this._implementation.onRemove&&this._implementation.onRemove(t)}hasTile(t){if(this._implementation.hasTile){const{x:e,y:n,z:r}=t.canonical;return this._implementation.hasTile({x:e,y:n,z:r})}return!this.tileBounds||this.tileBounds.contains(t.canonical)}loadTile(e,n){const{x:r,y:i,z:o}=e.tileID.canonical,s=new t.window.AbortController,a=this._implementation.loadTile({x:r,y:i,z:o},{signal:s.signal});if(!a)return this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",n(null);a.cancel=()=>s.abort(),e.request=a.then((function(r){return delete e.request,e.aborted?(e.state="unloaded",n(null)):r?function(e){return e instanceof t.window.ImageData||e instanceof t.window.ImageBitmap||e instanceof t.window.HTMLCanvasElement}(r)?(this.loadTileData(e,r),e.state="loaded",void n(null)):(e.state="errored",n(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`))):(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",n(null))}).bind(this)).catch(t=>{20!==t.code&&(e.state="errored",n(t))})}loadTileData(t,e){Et.loadTileData(t,e,this._map.painter)}unloadTileData(t){Et.unloadTileData(t,this._map.painter)}prepareTile(t){if(!this._implementation.prepareTile)return null;const{x:e,y:n,z:r}=t.tileID.canonical,i=this._implementation.prepareTile({x:e,y:n,z:r});return i?(this.loadTileData(t,i),t.state="loaded",i):null}unloadTile(t,e){if(this.unloadTileData(t),this._implementation.unloadTile){const{x:e,y:n,z:r}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:n,z:r})}e()}abortTile(t,e){t.request&&t.request.cancel&&(t.request.cancel(),delete t.request),e()}hasTransition(){return!1}_coveringTiles(){return this._map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(t=>({x:t.canonical.x,y:t.canonical.y,z:t.canonical.z}))}_update(){this.fire(new t.Event("data",{dataType:"source",sourceDataType:"content"}))}}},Mt=function(e,n,r,i){const o=new At[n.type](e,n,r,i);if(o.id!==e)throw new Error(`Expected Source id to be ${e} instead of ${o.id}`);return t.bindAll(["load","abort","unload","serialize","prepare"],o),o};function Ot(e,n){const r=t.identity([]);return t.scale(r,r,[.5*e.width,.5*-e.height,1]),t.translate(r,r,[1,-1,0]),t.multiply$1(r,r,e.calculateProjMatrix(n.toUnwrapped())),Float32Array.from(r)}function Pt(t,e,n,r,i,o,s,a=!1){const c=t.tilesIn(r,s,a);c.sort(Rt);const l=[];for(const h of c)l.push({wrappedTileID:h.tile.tileID.wrapped().key,queryResults:h.tile.queryRenderedFeatures(e,n,t._state,h,i,o,Ot(t.transform,h.tile.tileID),a)});const u=function(t){const e={},n={};for(const r of t){const t=r.queryResults,i=r.wrappedTileID,o=n[i]=n[i]||{};for(const n in t){const r=t[n],i=o[n]=o[n]||{},s=e[n]=e[n]||[];for(const t of r)i[t.featureIndex]||(i[t.featureIndex]=!0,s.push(t))}}return e}(l);for(const h in u)u[h].forEach(e=>{const n=e.feature,r=n.layer;r&&"background"!==r.type&&"sky"!==r.type&&(n.source=r.source,r["source-layer"]&&(n.sourceLayer=r["source-layer"]),n.state=void 0!==n.id?t.getFeatureState(r["source-layer"],n.id):{})});return u}function Dt(t,e){const n=t.getRenderableIds().map(e=>t.getTileByID(e)),r=[],i={};for(let o=0;o<n.length;o++){const t=n[o],s=t.tileID.canonical.key;i[s]||(i[s]=!0,t.querySourceFeatures(r,e))}return r}function Rt(t,e){const n=t.tileID,r=e.tileID;return n.overscaledZ-r.overscaledZ||n.canonical.y-r.canonical.y||n.wrap-r.wrap||n.canonical.x-r.canonical.x}function Nt(){return null!=ao.workerClass?new ao.workerClass:new t.window.Worker(ao.workerUrl)}const Lt="mapboxgl_preloaded_worker_pool";class jt{constructor(){this.active={}}acquire(t){if(!this.workers)for(this.workers=[];this.workers.length<jt.workerCount;)this.workers.push(new Nt);return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],0===this.numActive()&&(this.workers.forEach(t=>{t.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Lt]}numActive(){return Object.keys(this.active).length}}let zt;function Ft(){return zt||(zt=new jt),zt}function Bt(e,n){const r={};for(const t in e)"ref"!==t&&(r[t]=e[t]);return t.refProperties.forEach(t=>{t in n&&(r[t]=n[t])}),r}function Ut(t){t=t.slice();const e=Object.create(null);for(let n=0;n<t.length;n++)e[t[n].id]=t[n];for(let n=0;n<t.length;n++)"ref"in t[n]&&(t[n]=Bt(t[n],e[t[n].ref]));return t}jt.workerCount=2;const Vt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setProjection:"setProjection"};function qt(t,e,n){n.push({command:Vt.addSource,args:[t,e[t]]})}function Gt(t,e,n){e.push({command:Vt.removeSource,args:[t]}),n[t]=!0}function $t(t,e,n,r){Gt(t,n,r),qt(t,e,n)}function Wt(t,e,n){let r;for(r in t[n])if(t[n].hasOwnProperty(r)&&"data"!==r&&!i(t[n][r],e[n][r]))return!1;for(r in e[n])if(e[n].hasOwnProperty(r)&&"data"!==r&&!i(t[n][r],e[n][r]))return!1;return!0}function Ht(t,e,n,r,o,s){let a;for(a in e=e||{},t=t||{})t.hasOwnProperty(a)&&(i(t[a],e[a])||n.push({command:s,args:[r,a,e[a],o]}));for(a in e)e.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(i(t[a],e[a])||n.push({command:s,args:[r,a,e[a],o]}))}function Zt(t){return t.id}function Kt(t,e){return t[e.id]=e,t}class Xt{constructor(t,e){this.reset(t,e)}reset(t,e){this.points=t||[],this._distances=[0];for(let n=1;n<this.points.length;n++)this._distances[n]=this._distances[n-1]+this.points[n].dist(this.points[n-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(e||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(e){if(1===this.points.length)return this.points[0];e=t.clamp(e,0,1);let n=1,r=this._distances[n];const i=e*this.paddedLength+this.padding;for(;r<i&&n<this._distances.length;)r=this._distances[++n];const o=n-1,s=this._distances[o],a=r-s,c=a>0?(i-s)/a:0;return this.points[o].mult(1-c).add(this.points[n].mult(c))}}class Yt{constructor(t,e,n){const r=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(t/n),this.yCellCount=Math.ceil(e/n);for(let o=0;o<this.xCellCount*this.yCellCount;o++)r.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=t,this.height=e,this.xScale=this.xCellCount/t,this.yScale=this.yCellCount/e,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(t,e,n,r,i){this._forEachCell(e,n,r,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(e),this.bboxes.push(n),this.bboxes.push(r),this.bboxes.push(i)}insertCircle(t,e,n,r){this._forEachCell(e-r,n-r,e+r,n+r,this._insertCircleCell,this.circleUid++),this.circleKeys.push(t),this.circles.push(e),this.circles.push(n),this.circles.push(r)}_insertBoxCell(t,e,n,r,i,o){this.boxCells[i].push(o)}_insertCircleCell(t,e,n,r,i,o){this.circleCells[i].push(o)}_query(t,e,n,r,i,o){if(n<0||t>this.width||r<0||e>this.height)return!i&&[];const s=[];if(t<=0&&e<=0&&this.width<=n&&this.height<=r){if(i)return!0;for(let t=0;t<this.boxKeys.length;t++)s.push({key:this.boxKeys[t],x1:this.bboxes[4*t],y1:this.bboxes[4*t+1],x2:this.bboxes[4*t+2],y2:this.bboxes[4*t+3]});for(let t=0;t<this.circleKeys.length;t++){const e=this.circles[3*t],n=this.circles[3*t+1],r=this.circles[3*t+2];s.push({key:this.circleKeys[t],x1:e-r,y1:n-r,x2:e+r,y2:n+r})}return o?s.filter(o):s}return this._forEachCell(t,e,n,r,this._queryCell,s,{hitTest:i,seenUids:{box:{},circle:{}}},o),i?s.length>0:s}_queryCircle(t,e,n,r,i){const o=t-n,s=t+n,a=e-n,c=e+n;if(s<0||o>this.width||c<0||a>this.height)return!r&&[];const l=[];return this._forEachCell(o,a,s,c,this._queryCellCircle,l,{hitTest:r,circle:{x:t,y:e,radius:n},seenUids:{box:{},circle:{}}},i),r?l.length>0:l}query(t,e,n,r,i){return this._query(t,e,n,r,!1,i)}hitTest(t,e,n,r,i){return this._query(t,e,n,r,!0,i)}hitTestCircle(t,e,n,r){return this._queryCircle(t,e,n,!0,r)}_queryCell(t,e,n,r,i,o,s,a){const c=s.seenUids,l=this.boxCells[i];if(null!==l){const i=this.bboxes;for(const u of l)if(!c.box[u]){c.box[u]=!0;const l=4*u;if(t<=i[l+2]&&e<=i[l+3]&&n>=i[l+0]&&r>=i[l+1]&&(!a||a(this.boxKeys[u]))){if(s.hitTest)return o.push(!0),!0;o.push({key:this.boxKeys[u],x1:i[l],y1:i[l+1],x2:i[l+2],y2:i[l+3]})}}}const u=this.circleCells[i];if(null!==u){const i=this.circles;for(const l of u)if(!c.circle[l]){c.circle[l]=!0;const u=3*l;if(this._circleAndRectCollide(i[u],i[u+1],i[u+2],t,e,n,r)&&(!a||a(this.circleKeys[l]))){if(s.hitTest)return o.push(!0),!0;{const t=i[u],e=i[u+1],n=i[u+2];o.push({key:this.circleKeys[l],x1:t-n,y1:e-n,x2:t+n,y2:e+n})}}}}}_queryCellCircle(t,e,n,r,i,o,s,a){const c=s.circle,l=s.seenUids,u=this.boxCells[i];if(null!==u){const t=this.bboxes;for(const e of u)if(!l.box[e]){l.box[e]=!0;const n=4*e;if(this._circleAndRectCollide(c.x,c.y,c.radius,t[n+0],t[n+1],t[n+2],t[n+3])&&(!a||a(this.boxKeys[e])))return o.push(!0),!0}}const h=this.circleCells[i];if(null!==h){const t=this.circles;for(const e of h)if(!l.circle[e]){l.circle[e]=!0;const n=3*e;if(this._circlesCollide(t[n],t[n+1],t[n+2],c.x,c.y,c.radius)&&(!a||a(this.circleKeys[e])))return o.push(!0),!0}}}_forEachCell(t,e,n,r,i,o,s,a){const c=this._convertToXCellCoord(t),l=this._convertToYCellCoord(e),u=this._convertToXCellCoord(n),h=this._convertToYCellCoord(r);for(let d=c;d<=u;d++)for(let c=l;c<=h;c++)if(i.call(this,t,e,n,r,this.xCellCount*c+d,o,s,a))return}_convertToXCellCoord(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}_convertToYCellCoord(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}_circlesCollide(t,e,n,r,i,o){const s=r-t,a=i-e,c=n+o;return c*c>s*s+a*a}_circleAndRectCollide(t,e,n,r,i,o,s){const a=(o-r)/2,c=Math.abs(t-(r+a));if(c>a+n)return!1;const l=(s-i)/2,u=Math.abs(e-(i+l));if(u>l+n)return!1;if(c<=a||u<=l)return!0;const h=c-a,d=u-l;return h*h+d*d<=n*n}}const Qt=Math.tan(85*Math.PI/180);function Jt(e,n,r,i,o,s){const a=t.create();if(r){if("globe"===o.projection.name)t.multiply$1(a,a,t.calculateGlobeLabelMatrix(o,n));else{const t=y([],s);a[0]=t[0],a[1]=t[1],a[4]=t[2],a[5]=t[3]}i||t.rotateZ(a,a,o.angle)}else t.multiply$1(a,o.labelPlaneMatrix,e);return a}function te(e,n,r,i,o,s){if(r){if("globe"===o.projection.name){const a=Jt(e,n,r,i,o,s);return t.invert(a,a),t.multiply$1(a,e,a),a}{const n=t.clone(e),r=t.identity([]);return r[0]=s[0],r[1]=s[1],r[4]=s[2],r[5]=s[3],t.multiply$1(n,n,r),i||t.rotateZ(n,n,-o.angle),n}}return o.glCoordMatrix}function ee(e,n,r=0){const i=[e.x,e.y,r,1];r?t.transformMat4$1(i,i,n):fe(i,i,n);const o=i[3];return{point:new t.pointGeometry(i[0]/o,i[1]/o),signedDistanceFromCamera:o}}function ne(e,n){const r=[e[0],e[1],e[2],1];t.transformMat4$1(r,r,n);const i=r[3];return{point:new t.pointGeometry(r[0]/i,r[1]/i),signedDistanceFromCamera:i}}function re(t,e){return Math.min(.5+t/e*.5,1.5)}function ie(t,e){const n=t[0]/t[3],r=t[1]/t[3];return n>=-e[0]&&n<=e[0]&&r>=-e[1]&&r<=e[1]}function oe(e,n,r,i,o,s,a,c,l,u){const h=r.transform,d=i?e.textSizeData:e.iconSizeData,p=t.evaluateSizeForZoom(d,r.transform.zoom),f=[256/r.width*2+1,256/r.height*2+1],m=i?e.text.dynamicLayoutVertexArray:e.icon.dynamicLayoutVertexArray;m.clear();const g=e.lineVertexArray,_=i?e.text.placedSymbolArray:e.icon.placedSymbolArray,y=r.transform.width/r.transform.height;let v=!1;for(let b=0;b<_.length;b++){const i=_.get(b);if(i.writingMode!==t.WritingMode.vertical||v||0!==b&&_.get(b-1).writingMode===t.WritingMode.horizontal||(v=!0),(i.hidden||i.writingMode===t.WritingMode.vertical)&&!v){pe(i.numGlyphs,m);continue}v=!1;const x=new t.pointGeometry(i.tileAnchorX,i.tileAnchorY),w=l?l(x):[0,0,0],T=h.projection.projectTilePoint(x.x,x.y,u.canonical),C=[T.x+w[0],T.y+w[1],T.z+w[2]],E=[...C,1];if(t.transformMat4$1(E,E,n),!ie(E,f)){pe(i.numGlyphs,m);continue}const S=re(r.transform.cameraToCenterDistance,E[3]),I=t.evaluateSizeForFeature(d,p,i),k=a?I/S:I*S,A=ee(new t.pointGeometry(C[0],C[1]),o,C[2]);if(A.signedDistanceFromCamera<=0){pe(i.numGlyphs,m);continue}let M={};const O=a?null:l,P=ce(i,k,!1,c,n,o,s,e.glyphOffsetArray,g,m,A.point,x,M,y,O,h.projection,u);v=P.useVertical,O&&P.needsFlipping&&(M={}),(P.notEnoughRoom||v||P.needsFlipping&&ce(i,k,!0,c,n,o,s,e.glyphOffsetArray,g,m,A.point,x,M,y,O,h.projection,u).notEnoughRoom)&&pe(i.numGlyphs,m)}i?e.text.dynamicLayoutVertexBuffer.updateData(m):e.icon.dynamicLayoutVertexBuffer.updateData(m)}function se(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f){const m=a.glyphStartIndex+a.numGlyphs,g=a.lineStartIndex,_=a.lineStartIndex+a.lineLength,y=e.getoffsetX(a.glyphStartIndex),v=e.getoffsetX(m-1),b=he(t*y,n,r,i,o,s,a.segment,g,_,c,l,u,h,d,!0,p,f);if(!b)return null;const x=he(t*v,n,r,i,o,s,a.segment,g,_,c,l,u,h,d,!0,p,f);return x?{first:b,last:x}:null}function ae(e,n,r,i){return e.writingMode===t.WritingMode.horizontal&&Math.abs(r.y-n.y)>Math.abs(r.x-n.x)*i?{useVertical:!0}:e.writingMode===t.WritingMode.vertical?n.y<r.y?{needsFlipping:!0}:null:0!==e.flipState&&function(t,e,n){const r=(e.x-t.x)*n;return 0===r||Math.abs((e.y-t.y)/r)>Qt}(n,r,i)?1===e.flipState?{needsFlipping:!0}:null:n.x>r.x?{needsFlipping:!0}:null}function ce(e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g,_){const y=n/24,v=e.lineOffsetX*y,b=e.lineOffsetY*y;let x;if(e.numGlyphs>1){const t=e.glyphStartIndex+e.numGlyphs,n=e.lineStartIndex,o=e.lineStartIndex+e.lineLength,u=se(y,c,v,b,r,h,d,e,l,s,p,m,!1,g,_);if(!u)return{notEnoughRoom:!0};const w=ee(u.first.point,a).point,T=ee(u.last.point,a).point;if(i&&!r){const t=ae(e,w,T,f);if(e.flipState=t&&t.needsFlipping?1:2,t)return t}x=[u.first];for(let i=e.glyphStartIndex+1;i<t-1;i++)x.push(he(y*c.getoffsetX(i),v,b,r,h,d,e.segment,n,o,l,s,p,m,!1,!1,g,_));x.push(u.last)}else{if(i&&!r){const n=ee(d,o).point,r=e.lineStartIndex+e.segment+1,i=new t.pointGeometry(l.getx(r),l.gety(r)),s=ee(i,o),a=ae(e,n,s.signedDistanceFromCamera>0?s.point:ue(d,i,n,1,o,void 0,g,_.canonical),f);if(e.flipState=a&&a.needsFlipping?1:2,a)return a}const n=he(y*c.getoffsetX(e.glyphStartIndex),v,b,r,h,d,e.segment,e.lineStartIndex,e.lineStartIndex+e.lineLength,l,s,p,m,!1,!1,g,_);if(!n)return{notEnoughRoom:!0};x=[n]}for(const w of x)t.addDynamicAttributes(u,w.point,w.angle);return{}}function le(e,n,r,i,o){const s=i.projectTilePoint(e.x,e.y,n);if(!o)return ee(s,r,s.z);const a=o(e);return ee(new t.pointGeometry(s.x+a[0],s.y+a[1]),r,s.z+a[2])}function ue(t,e,n,r,i,o,s,a){const c=le(t.add(t.sub(e)._unit()),a,i,s,o).point,l=n.sub(c);return n.add(l._mult(r/l.mag()))}function he(e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g,_){const y=i?e-n:e+n;let v=y>0?1:-1,b=0;i&&(v*=-1,b=Math.PI),v<0&&(b+=Math.PI);let x=v>0?c+a:c+a+1,w=o,T=o,C=0,E=0;const S=Math.abs(y),I=[],k=[];let A=s;const M=()=>{const e=x-v;return 0===C?s:new t.pointGeometry(u.getx(e),u.gety(e))},O=()=>ue(M(),A,T,S-C+1,h,p,g,_.canonical);for(;C+E<=S;){if(x+=v,x<c||x>=l)return null;if(T=w,I.push(w),f&&k.push(A||M()),w=d[x],void 0===w){A=new t.pointGeometry(u.getx(x),u.gety(x));const e=le(A,_.canonical,h,g,p);w=e.signedDistanceFromCamera>0?d[x]=e.point:O()}else A=null;C+=E,E=T.dist(w)}m&&p&&(A=A||new t.pointGeometry(u.getx(x),u.gety(x)),d[x]=w=void 0===d[x]?w:O(),E=T.dist(w));const P=(S-C)/E,D=w.sub(T),R=D.mult(P)._add(T);r&&R._add(D._unit()._perp()._mult(r*v));const N=b+Math.atan2(w.y-T.y,w.x-T.x);return I.push(R),f&&(A=A||new t.pointGeometry(u.getx(x),u.gety(x)),k.push(function(e,n,r){const i=1-r;return new t.pointGeometry(e.x*i+n.x*r,e.y*i+n.y*r)}(k.length>0?k[k.length-1]:A,A,P))),{point:R,angle:N,path:I,tilePath:k}}const de=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function pe(t,e){for(let n=0;n<t;n++){const t=e.length;e.resize(t+4),e.float32.set(de,3*t)}}function fe(t,e,n){const r=e[0],i=e[1];return t[0]=n[0]*r+n[4]*i+n[12],t[1]=n[1]*r+n[5]*i+n[13],t[3]=n[3]*r+n[7]*i+n[15],t}const me=100;class ge{constructor(t,e,n=new Yt(t.width+200,t.height+200,25),r=new Yt(t.width+200,t.height+200,25)){this.transform=t,this.grid=n,this.ignoredGrid=r,this.pitchfactor=Math.cos(t._pitch)*t.cameraToCenterDistance,this.screenRightBoundary=t.width+me,this.screenBottomBoundary=t.height+me,this.gridRightBoundary=t.width+200,this.gridBottomBoundary=t.height+200,this.fogState=e}placeCollisionBox(t,e,n,r,i,o,s){let a=e.projectedAnchorX,c=e.projectedAnchorY,l=e.projectedAnchorZ;const u=e.elevation,h=e.tileID;if(u&&h){const t=this.transform.projection.upVector(h.canonical,e.tileAnchorX,e.tileAnchorY),n=this.transform.projection.upVectorScale(h.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;a+=t[0]*u*n,c+=t[1]*u*n,l+=t[2]*u*n}const d=this.projectAndGetPerspectiveRatio(o,[a,c,l],e.tileID,"globe"===this.transform.projection.name||!!u||this.transform.pitch>0),p=i*d.perspectiveRatio,f=(e.x1*t+n.x-e.padding)*p+d.point.x,m=(e.y1*t+n.y-e.padding)*p+d.point.y,g=(e.x2*t+n.x+e.padding)*p+d.point.x,_=(e.y2*t+n.y+e.padding)*p+d.point.y,y=d.perspectiveRatio<=.55||d.occluded;return!this.isInsideGrid(f,m,g,_)||!r&&this.grid.hitTest(f,m,g,_,s)||y?{box:[],offscreen:!1,occluded:d.occluded}:{box:[f,m,g,_],offscreen:this.isOffscreen(f,m,g,_),occluded:!1}}placeCollisionCircles(e,n,r,i,o,s,a,c,l,u,h,d,p,f){const m=[],g=this.transform.elevation,_=g?g.getAtTileOffsetFunc(f,this.transform.center.lat,this.transform.worldSize,this.transform.projection):t=>[0,0,0],y=new t.pointGeometry(n.tileAnchorX,n.tileAnchorY),v=this.transform.projection.projectTilePoint(n.tileAnchorX,n.tileAnchorY,f.canonical),b=_(y),x=[v.x+b[0],v.y+b[1],v.z+b[2]],w=this.projectAndGetPerspectiveRatio(s,[x[0],x[1],x[2]],f,"globe"===this.transform.projection.name||!!g||this.transform.pitch>0),{perspectiveRatio:T}=w,C=(u?o/T:o*T)/t.ONE_EM,E=ee(new t.pointGeometry(x[0],x[1]),a,x[2]).point,S=w.signedDistanceFromCamera>0?se(C,i,n.lineOffsetX*C,n.lineOffsetY*C,!1,E,y,n,r,a,{},g&&!u?_:null,u&&!!g,this.transform.projection,f):null;let I=!1,k=!1,A=!0;if(S&&!w.occluded){const n=.5*d*T+p,r=new t.pointGeometry(-100,-100),i=new t.pointGeometry(this.screenRightBoundary,this.screenBottomBoundary),o=new Xt,s=S.first,a=S.last;let u=[];for(let t=s.path.length-1;t>=1;t--)u.push(s.path[t]);for(let t=1;t<a.path.length;t++)u.push(a.path[t]);const f=2.5*n;if(c){const t=u.map(g?(t,e)=>{const n=_(e<s.path.length-1?s.tilePath[s.path.length-1-e]:a.tilePath[e-s.path.length+2]);return ee(t,c,n[2])}:t=>ee(t,c));u=t.some(t=>t.signedDistanceFromCamera<=0)?[]:t.map(t=>t.point)}let y=[];if(u.length>0){const e=u[0].clone(),n=u[0].clone();for(let t=1;t<u.length;t++)e.x=Math.min(e.x,u[t].x),e.y=Math.min(e.y,u[t].y),n.x=Math.max(n.x,u[t].x),n.y=Math.max(n.y,u[t].y);y=e.x>=r.x&&n.x<=i.x&&e.y>=r.y&&n.y<=i.y?[u]:n.x<r.x||e.x>i.x||n.y<r.y||e.y>i.y?[]:t.clipLine([u],r.x,r.y,i.x,i.y)}for(const t of y){o.reset(t,.25*n);let r=0;r=o.length<=.5*n?1:Math.ceil(o.paddedLength/f)+1;for(let t=0;t<r;t++){const i=t/Math.max(r-1,1),s=o.lerp(i),a=s.x+me,c=s.y+me;m.push(a,c,n,0);const u=a-n,d=c-n,p=a+n,f=c+n;if(A=A&&this.isOffscreen(u,d,p,f),k=k||this.isInsideGrid(u,d,p,f),!e&&this.grid.hitTestCircle(a,c,n,h)&&(I=!0,!l))return{circles:[],offscreen:!1,collisionDetected:I,occluded:!1}}}}return{circles:!l&&I||!k?[]:m,offscreen:A,collisionDetected:I,occluded:w.occluded}}queryRenderedSymbols(e){if(0===e.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const n=[];let r=1/0,i=1/0,o=-1/0,s=-1/0;for(const u of e){const e=new t.pointGeometry(u.x+me,u.y+me);r=Math.min(r,e.x),i=Math.min(i,e.y),o=Math.max(o,e.x),s=Math.max(s,e.y),n.push(e)}const a=this.grid.query(r,i,o,s).concat(this.ignoredGrid.query(r,i,o,s)),c={},l={};for(const u of a){const e=u.key;if(void 0===c[e.bucketInstanceId]&&(c[e.bucketInstanceId]={}),c[e.bucketInstanceId][e.featureIndex])continue;const r=[new t.pointGeometry(u.x1,u.y1),new t.pointGeometry(u.x2,u.y1),new t.pointGeometry(u.x2,u.y2),new t.pointGeometry(u.x1,u.y2)];t.polygonIntersectsPolygon(n,r)&&(c[e.bucketInstanceId][e.featureIndex]=!0,void 0===l[e.bucketInstanceId]&&(l[e.bucketInstanceId]=[]),l[e.bucketInstanceId].push(e.featureIndex))}return l}insertCollisionBox(t,e,n,r,i){(e?this.ignoredGrid:this.grid).insert({bucketInstanceId:n,featureIndex:r,collisionGroupID:i},t[0],t[1],t[2],t[3])}insertCollisionCircles(t,e,n,r,i){const o=e?this.ignoredGrid:this.grid,s={bucketInstanceId:n,featureIndex:r,collisionGroupID:i};for(let a=0;a<t.length;a+=4)o.insertCircle(s,t[a],t[a+1],t[a+2])}projectAndGetPerspectiveRatio(e,n,r,i){const o=[n[0],n[1],n[2],1];let s=!1;return n[2]||this.transform.pitch>0?(t.transformMat4$1(o,o,e),this.fogState&&r&&(s=function(e,n,r,i,o,s){const a=s.calculateFogTileMatrix(o),c=[n,r,i];return t.transformMat4(c,c,a),I(e,c,s.pitch,s._fov)}(this.fogState,n[0],n[1],n[2],r.toUnwrapped(),this.transform)>.9)):fe(o,o,e),{point:new t.pointGeometry((o[0]/o[3]+1)/2*this.transform.width+me,(-o[1]/o[3]+1)/2*this.transform.height+me),perspectiveRatio:Math.min(.5+this.transform.cameraToCenterDistance/o[3]*.5,1.5),signedDistanceFromCamera:o[3],occluded:i&&o[2]>o[3]||s}}isOffscreen(t,e,n,r){return n<me||t>=this.screenRightBoundary||r<me||e>this.screenBottomBoundary}isInsideGrid(t,e,n,r){return n>=0&&t<this.gridRightBoundary&&r>=0&&e<this.gridBottomBoundary}getViewportMatrix(){const e=t.identity([]);return t.translate(e,e,[-100,-100,0]),e}}class _e{constructor(t,e,n,r){this.opacity=t?Math.max(0,Math.min(1,t.opacity+(t.placed?e:-e))):r&&n?1:0,this.placed=n}isHidden(){return 0===this.opacity&&!this.placed}}class ye{constructor(t,e,n,r,i,o=!1){this.text=new _e(t?t.text:null,e,n,i),this.icon=new _e(t?t.icon:null,e,r,i),this.clipped=o}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ve{constructor(t,e,n,r=!1){this.text=t,this.icon=e,this.skipFade=n,this.clipped=r}}class be{constructor(){this.invProjMatrix=t.create(),this.viewportMatrix=t.create(),this.circles=[]}}class xe{constructor(t,e,n,r,i){this.bucketInstanceId=t,this.featureIndex=e,this.sourceLayerIndex=n,this.bucketIndex=r,this.tileID=i}}class we{constructor(t){this.crossSourceCollisions=t,this.maxGroupID=0,this.collisionGroups={}}get(t){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[t]){const e=++this.maxGroupID;this.collisionGroups[t]={ID:e,predicate:t=>t.collisionGroupID===e}}return this.collisionGroups[t]}}function Te(e,n,r,i,o){const{horizontalAlign:s,verticalAlign:a}=t.getAnchorAlignment(e),c=-(s-.5)*n,l=-(a-.5)*r,u=t.evaluateVariableOffset(e,i);return new t.pointGeometry(c+u[0]*o,l+u[1]*o)}function Ce(e,n,r,i,o){const s=new t.pointGeometry(e,n);return r&&s._rotate(i?o:-o),s}class Ee{constructor(t,e,n,r,i){this.transform=t.clone(),this.collisionIndex=new ge(this.transform,i),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=e,this.retainedQueryData={},this.collisionGroups=new we(n),this.collisionCircleArrays={},this.prevPlacement=r,r&&(r.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(e,n,r,i){const o=r.getBucket(n),s=r.latestFeatureIndex;if(!o||!s||n.id!==o.layerIds[0])return;const a=o.layers[0].layout,c=r.collisionBoxArray,l=Math.pow(2,this.transform.zoom-r.tileID.overscaledZ),u=r.tileSize/t.EXTENT,h=r.tileID.toUnwrapped(),d=this.transform.calculateProjMatrix(h),p="map"===a.get("text-pitch-alignment"),f="map"===a.get("text-rotation-alignment");n.compileFilter();const m=n.dynamicFilter(),g=n.dynamicFilterNeedsFeature(),_=this.transform.calculatePixelsToTileUnitsMatrix(r),y=Jt(d,r.tileID.canonical,p,f,this.transform,_);let v=null;if(p){const e=te(d,r.tileID.canonical,p,f,this.transform,_);v=t.multiply$1([],this.transform.labelPlaneMatrix,e)}let b=null;m&&r.latestFeatureIndex&&(b={unwrappedTileID:h,dynamicFilter:m,dynamicFilterNeedsFeature:g,featureIndex:r.latestFeatureIndex}),this.retainedQueryData[o.bucketInstanceId]=new xe(o.bucketInstanceId,s,o.sourceLayerIndex,o.index,r.tileID);const x={bucket:o,layout:a,posMatrix:d,textLabelPlaneMatrix:y,labelToScreenMatrix:v,clippingData:b,scale:l,textPixelRatio:u,holdingForFade:r.holdingForFade(),collisionBoxArray:c,partiallyEvaluatedTextSize:t.evaluateSizeForZoom(o.textSizeData,this.transform.zoom),partiallyEvaluatedIconSize:t.evaluateSizeForZoom(o.iconSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(o.sourceID)};if(i)for(const t of o.sortKeyRanges){const{sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i}=t;e.push({sortKey:n,symbolInstanceStart:r,symbolInstanceEnd:i,parameters:x})}else e.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:x})}attemptAnchorPlacement(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m,g,_){const y=[h.textOffset0,h.textOffset1],v=Te(t,n,r,y,i),b=this.collisionIndex.placeCollisionBox(i,e,Ce(v.x,v.y,o,s,this.transform.angle),u,a,c,l.predicate);if((!m||0!==this.collisionIndex.placeCollisionBox(p.getSymbolInstanceIconSize(_,this.transform.zoom,d),m,Ce(v.x,v.y,o,s,this.transform.angle),u,a,c,l.predicate).box.length)&&b.box.length>0){let e;return this.prevPlacement&&this.prevPlacement.variableOffsets[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID]&&this.prevPlacement.placements[h.crossTileID].text&&(e=this.prevPlacement.variableOffsets[h.crossTileID].anchor),this.variableOffsets[h.crossTileID]={textOffset:y,width:n,height:r,anchor:t,textScale:i,prevAnchor:e},this.markUsedJustification(p,t,h,f),p.allowVerticalPlacement&&(this.markUsedOrientation(p,f,h),this.placedOrientations[h.crossTileID]=f),{shift:v,placedGlyphBoxes:b}}}placeLayerBucketPart(e,n,r,i){const{bucket:o,layout:s,posMatrix:a,textLabelPlaneMatrix:c,labelToScreenMatrix:l,clippingData:u,textPixelRatio:h,holdingForFade:d,collisionBoxArray:p,partiallyEvaluatedTextSize:f,partiallyEvaluatedIconSize:m,collisionGroup:g}=e.parameters,_=s.get("text-optional"),y=s.get("icon-optional"),v=s.get("text-allow-overlap"),b=s.get("icon-allow-overlap"),x="map"===s.get("text-rotation-alignment"),w="map"===s.get("text-pitch-alignment"),T="none"!==s.get("icon-text-fit"),C="viewport-y"===s.get("symbol-z-order");let E=v&&(b||!o.hasIconData()||y),S=b&&(v||!o.hasTextData()||_);!o.collisionArrays&&p&&o.deserializeCollisionBoxes(p),r&&i&&o.updateCollisionDebugBuffers(this.transform.zoom,p);const I=(e,i,p)=>{if(u){const r={zoom:this.transform.zoom,pitch:this.transform.pitch};let i=null;if(u.dynamicFilterNeedsFeature){const t=this.retainedQueryData[o.bucketInstanceId];i=u.featureIndex.loadFeature({featureIndex:e.featureIndex,bucketIndex:t.bucketIndex,sourceLayerIndex:t.sourceLayerIndex,layoutVertexArrayOffset:0})}if(!(0,u.dynamicFilter)(r,i,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new t.pointGeometry(e.tileAnchorX,e.tileAnchorY),this.transform.calculateDistanceTileData(u.unwrappedTileID)))return this.placements[e.crossTileID]=new ve(!1,!1,!1,!0),void(n[e.crossTileID]=!0)}if(n[e.crossTileID])return;if(d)return void(this.placements[e.crossTileID]=new ve(!1,!1,!1));let C=!1,I=!1,k=!0,A=!1,M=!1,O=null,P={box:null,offscreen:null,occluded:null},D={box:null,offscreen:null,occluded:null},R=null,N=null,L=null,j=0,z=0,F=0;p.textFeatureIndex?j=p.textFeatureIndex:e.useRuntimeCollisionCircles&&(j=e.featureIndex),p.verticalTextFeatureIndex&&(z=p.verticalTextFeatureIndex);const B=t=>{t.tileID=this.retainedQueryData[o.bucketInstanceId].tileID,(this.transform.elevation||t.elevation)&&(t.elevation=this.transform.elevation?this.transform.elevation.getAtTileOffset(this.retainedQueryData[o.bucketInstanceId].tileID,t.tileAnchorX,t.tileAnchorY):0)},U=p.textBox;if(U){B(U);const n=n=>{let r=t.WritingMode.horizontal;if(o.allowVerticalPlacement&&!n&&this.prevPlacement){const t=this.prevPlacement.placedOrientations[e.crossTileID];t&&(this.placedOrientations[e.crossTileID]=t,r=t,this.markUsedOrientation(o,r,e))}return r},r=(n,r)=>{if(o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&p.verticalTextBox){for(const e of o.writingModes)if(e===t.WritingMode.vertical?(P=r(),D=P):P=n(),P&&P.box&&P.box.length)break}else P=n()};if(s.get("text-variable-anchor")){let c=s.get("text-variable-anchor");if(this.prevPlacement&&this.prevPlacement.variableOffsets[e.crossTileID]){const t=this.prevPlacement.variableOffsets[e.crossTileID];c.indexOf(t.anchor)>0&&(c=c.filter(e=>e!==t.anchor),c.unshift(t.anchor))}const l=(t,n,r)=>{const s=o.getSymbolInstanceTextSize(f,e,this.transform.zoom,i),l=(t.x2-t.x1)*s+2*t.padding,u=(t.y2-t.y1)*s+2*t.padding,d=T&&!b?n:null;d&&B(d);let p={box:[],offscreen:!1,occluded:!1};const _=v?2*c.length:c.length;for(let y=0;y<_;++y){const n=this.attemptAnchorPlacement(c[y%c.length],t,l,u,s,x,w,h,a,g,y>=c.length,e,i,o,r,d,f,m);if(n&&(p=n.placedGlyphBoxes,p&&p.box&&p.box.length)){C=!0,O=n.shift;break}}return p};r(()=>l(U,p.iconBox,t.WritingMode.horizontal),()=>{const n=p.verticalTextBox;return n&&B(n),o.allowVerticalPlacement&&!(P&&P.box&&P.box.length)&&e.numVerticalGlyphVertices>0&&n?l(n,p.verticalIconBox,t.WritingMode.vertical):{box:null,offscreen:null,occluded:null}}),P&&(C=P.box,k=P.offscreen,A=P.occluded);const u=n(P&&P.box);if(!C&&this.prevPlacement){const t=this.prevPlacement.variableOffsets[e.crossTileID];t&&(this.variableOffsets[e.crossTileID]=t,this.markUsedJustification(o,t.anchor,e,u))}}else{const s=(n,r)=>{const s=o.getSymbolInstanceTextSize(f,e,this.transform.zoom,i),c=this.collisionIndex.placeCollisionBox(s,n,new t.pointGeometry(0,0),v,h,a,g.predicate);return c&&c.box&&c.box.length&&(this.markUsedOrientation(o,r,e),this.placedOrientations[e.crossTileID]=r),c};r(()=>s(U,t.WritingMode.horizontal),()=>{const n=p.verticalTextBox;return o.allowVerticalPlacement&&e.numVerticalGlyphVertices>0&&n?(B(n),s(n,t.WritingMode.vertical)):{box:null,offscreen:null,occluded:null}}),n(P&&P.box&&P.box.length)}}if(R=P,C=R&&R.box&&R.box.length>0,k=R&&R.offscreen,A=R&&R.occluded,e.useRuntimeCollisionCircles){const n=o.text.placedSymbolArray.get(e.centerJustifiedTextSymbolIndex>=0?e.centerJustifiedTextSymbolIndex:e.verticalPlacedTextSymbolIndex),i=t.evaluateSizeForFeature(o.textSizeData,f,n),u=s.get("text-padding");N=this.collisionIndex.placeCollisionCircles(v,n,o.lineVertexArray,o.glyphOffsetArray,i,a,c,l,r,w,g.predicate,e.collisionCircleDiameter*i/t.ONE_EM,u,this.retainedQueryData[o.bucketInstanceId].tileID),C=v||N.circles.length>0&&!N.collisionDetected,k=k&&N.offscreen,A=N.occluded}if(p.iconFeatureIndex&&(F=p.iconFeatureIndex),p.iconBox){const e=e=>{B(e);const n=T&&O?Ce(O.x,O.y,x,w,this.transform.angle):new t.pointGeometry(0,0),r=o.getSymbolInstanceIconSize(m,this.transform.zoom,i);return this.collisionIndex.placeCollisionBox(r,e,n,b,h,a,g.predicate)};D&&D.box&&D.box.length&&p.verticalIconBox?(L=e(p.verticalIconBox),I=L.box.length>0):(L=e(p.iconBox),I=L.box.length>0),k=k&&L.offscreen,M=L.occluded}const V=_||0===e.numHorizontalGlyphVertices&&0===e.numVerticalGlyphVertices,q=y||0===e.numIconVertices;if(V||q?q?V||(I=I&&C):C=I&&C:I=C=I&&C,C&&R&&R.box&&this.collisionIndex.insertCollisionBox(R.box,s.get("text-ignore-placement"),o.bucketInstanceId,D&&D.box&&z?z:j,g.ID),I&&L&&this.collisionIndex.insertCollisionBox(L.box,s.get("icon-ignore-placement"),o.bucketInstanceId,F,g.ID),N&&(C&&this.collisionIndex.insertCollisionCircles(N.circles,s.get("text-ignore-placement"),o.bucketInstanceId,j,g.ID),r)){const t=o.bucketInstanceId;let e=this.collisionCircleArrays[t];void 0===e&&(e=this.collisionCircleArrays[t]=new be);for(let n=0;n<N.circles.length;n+=4)e.circles.push(N.circles[n+0]),e.circles.push(N.circles[n+1]),e.circles.push(N.circles[n+2]),e.circles.push(N.collisionDetected?1:0)}const G="globe"!==this.transform.projection.name;E=E&&(G||!A),S=S&&(G||!M),this.placements[e.crossTileID]=new ve(C||E,I||S,k||o.justReloaded),n[e.crossTileID]=!0};if(C){const t=o.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const n=t[e];I(o.symbolInstances.get(n),n,o.collisionArrays[n])}}else for(let t=e.symbolInstanceStart;t<e.symbolInstanceEnd;t++)I(o.symbolInstances.get(t),t,o.collisionArrays[t]);if(r&&o.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[o.bucketInstanceId];t.invert(e.invProjMatrix,a),e.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(e,n,r,i){let o;o=i===t.WritingMode.vertical?r.verticalPlacedTextSymbolIndex:{left:r.leftJustifiedTextSymbolIndex,center:r.centerJustifiedTextSymbolIndex,right:r.rightJustifiedTextSymbolIndex}[t.getAnchorJustification(n)];const s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex,r.verticalPlacedTextSymbolIndex];for(const t of s)t>=0&&(e.text.placedSymbolArray.get(t).crossTileID=o>=0&&t!==o?0:r.crossTileID)}markUsedOrientation(e,n,r){const i=n===t.WritingMode.horizontal||n===t.WritingMode.horizontalOnly?n:0,o=n===t.WritingMode.vertical?n:0,s=[r.leftJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.rightJustifiedTextSymbolIndex];for(const t of s)e.text.placedSymbolArray.get(t).placedOrientation=i;r.verticalPlacedTextSymbolIndex&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).placedOrientation=o)}commit(t){this.commitTime=t,this.zoomAtLastRecencyCheck=this.transform.zoom;const e=this.prevPlacement;let n=!1;this.prevZoomAdjustment=e?e.zoomAdjustment(this.transform.zoom):0;const r=e?e.symbolFadeChange(t):1,i=e?e.opacities:{},o=e?e.variableOffsets:{},s=e?e.placedOrientations:{};for(const a in this.placements){const t=this.placements[a],e=i[a];e?(this.opacities[a]=new ye(e,r,t.text,t.icon,null,t.clipped),n=n||t.text!==e.text.placed||t.icon!==e.icon.placed):(this.opacities[a]=new ye(null,r,t.text,t.icon,t.skipFade,t.clipped),n=n||t.text||t.icon)}for(const a in i){const t=i[a];if(!this.opacities[a]){const e=new ye(t,r,!1,!1);e.isHidden()||(this.opacities[a]=e,n=n||t.text.placed||t.icon.placed)}}for(const a in o)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=o[a]);for(const a in s)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=s[a]);n?this.lastPlacementChangeTime=t:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=e?e.lastPlacementChangeTime:t)}updateLayerOpacities(t,e){const n={};for(const r of e){const e=r.getBucket(t);e&&r.latestFeatureIndex&&t.id===e.layerIds[0]&&this.updateBucketOpacities(e,n,r.collisionBoxArray)}}updateBucketOpacities(e,n,r){e.hasTextData()&&e.text.opacityVertexArray.clear(),e.hasIconData()&&e.icon.opacityVertexArray.clear(),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexArray.clear(),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexArray.clear();const i=e.layers[0].layout,o=!!e.layers[0].dynamicFilter(),s=new ye(null,0,!1,!1,!0),a=i.get("text-allow-overlap"),c=i.get("icon-allow-overlap"),l=i.get("text-variable-anchor"),u="map"===i.get("text-rotation-alignment"),h="map"===i.get("text-pitch-alignment"),d="none"!==i.get("icon-text-fit"),p=new ye(null,0,a&&(c||!e.hasIconData()||i.get("icon-optional")),c&&(a||!e.hasTextData()||i.get("text-optional")),!0);!e.collisionArrays&&r&&(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData())&&e.deserializeCollisionBoxes(r);const f=(t,e,n)=>{for(let r=0;r<e/4;r++)t.opacityVertexArray.emplaceBack(n)};let m=0;for(let g=0;g<e.symbolInstances.length;g++){const r=e.symbolInstances.get(g),{numHorizontalGlyphVertices:i,numVerticalGlyphVertices:a,crossTileID:c}=r;let _=this.opacities[c];n[c]?_=s:_||(_=p,this.opacities[c]=_),n[c]=!0;const y=i>0||a>0,v=r.numIconVertices>0,b=this.placedOrientations[r.crossTileID],x=b===t.WritingMode.vertical,w=b===t.WritingMode.horizontal||b===t.WritingMode.horizontalOnly;if(!y&&!v||_.isHidden()||m++,y){const t=Re(_.text);f(e.text,i,x?Ne:t),f(e.text,a,w?Ne:t);const n=_.text.isHidden();[r.rightJustifiedTextSymbolIndex,r.centerJustifiedTextSymbolIndex,r.leftJustifiedTextSymbolIndex].forEach(t=>{t>=0&&(e.text.placedSymbolArray.get(t).hidden=n||x?1:0)}),r.verticalPlacedTextSymbolIndex>=0&&(e.text.placedSymbolArray.get(r.verticalPlacedTextSymbolIndex).hidden=n||w?1:0);const o=this.variableOffsets[r.crossTileID];o&&this.markUsedJustification(e,o.anchor,r,b);const s=this.placedOrientations[r.crossTileID];s&&(this.markUsedJustification(e,"left",r,s),this.markUsedOrientation(e,s,r))}if(v){const t=Re(_.icon);r.placedIconSymbolIndex>=0&&(f(e.icon,r.numIconVertices,x?Ne:t),e.icon.placedSymbolArray.get(r.placedIconSymbolIndex).hidden=_.icon.isHidden()),r.verticalPlacedIconSymbolIndex>=0&&(f(e.icon,r.numVerticalIconVertices,w?Ne:t),e.icon.placedSymbolArray.get(r.verticalPlacedIconSymbolIndex).hidden=_.icon.isHidden())}if(e.hasIconCollisionBoxData()||e.hasTextCollisionBoxData()){const n=e.collisionArrays[g];if(n){let r=new t.pointGeometry(0,0),i=!0;if(n.textBox||n.verticalTextBox){if(l){const t=this.variableOffsets[c];t?(r=Te(t.anchor,t.width,t.height,t.textOffset,t.textScale),u&&r._rotate(h?this.transform.angle:-this.transform.angle)):i=!1}o&&(i=!_.clipped),n.textBox&&Se(e.textCollisionBox.collisionVertexArray,_.text.placed,!i||x,r.x,r.y),n.verticalTextBox&&Se(e.textCollisionBox.collisionVertexArray,_.text.placed,!i||w,r.x,r.y)}const s=i&&Boolean(!w&&n.verticalIconBox);n.iconBox&&Se(e.iconCollisionBox.collisionVertexArray,_.icon.placed,s,d?r.x:0,d?r.y:0),n.verticalIconBox&&Se(e.iconCollisionBox.collisionVertexArray,_.icon.placed,!s,d?r.x:0,d?r.y:0)}}}if(e.fullyClipped=0===m,e.sortFeatures(this.transform.angle),this.retainedQueryData[e.bucketInstanceId]&&(this.retainedQueryData[e.bucketInstanceId].featureSortOrder=e.featureSortOrder),e.hasTextData()&&e.text.opacityVertexBuffer&&e.text.opacityVertexBuffer.updateData(e.text.opacityVertexArray),e.hasIconData()&&e.icon.opacityVertexBuffer&&e.icon.opacityVertexBuffer.updateData(e.icon.opacityVertexArray),e.hasIconCollisionBoxData()&&e.iconCollisionBox.collisionVertexBuffer&&e.iconCollisionBox.collisionVertexBuffer.updateData(e.iconCollisionBox.collisionVertexArray),e.hasTextCollisionBoxData()&&e.textCollisionBox.collisionVertexBuffer&&e.textCollisionBox.collisionVertexBuffer.updateData(e.textCollisionBox.collisionVertexArray),e.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[e.bucketInstanceId];e.placementInvProjMatrix=t.invProjMatrix,e.placementViewportMatrix=t.viewportMatrix,e.collisionCircleArray=t.circles,delete this.collisionCircleArrays[e.bucketInstanceId]}}symbolFadeChange(t){return 0===this.fadeDuration?1:(t-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(t){return Math.max(0,(this.transform.zoom-t)/1.5)}hasTransitions(t){return this.stale||t-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(t,e){const n=this.zoomAtLastRecencyCheck===e?1-this.zoomAdjustment(e):1;return this.zoomAtLastRecencyCheck=e,this.commitTime+this.fadeDuration*n>t}setStale(){this.stale=!0}}function Se(t,e,n,r,i){t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0),t.emplaceBack(e?1:0,n?1:0,r||0,i||0)}const Ie=Math.pow(2,25),ke=Math.pow(2,24),Ae=Math.pow(2,17),Me=Math.pow(2,16),Oe=Math.pow(2,9),Pe=Math.pow(2,8),De=Math.pow(2,1);function Re(t){if(0===t.opacity&&!t.placed)return 0;if(1===t.opacity&&t.placed)return 4294967295;const e=t.placed?1:0,n=Math.floor(127*t.opacity);return n*Ie+e*ke+n*Ae+e*Me+n*Oe+e*Pe+n*De+e}const Ne=0;class Le{constructor(t){this._sortAcrossTiles="viewport-y"!==t.layout.get("symbol-z-order")&&void 0!==t.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]}continuePlacement(t,e,n,r,i){const o=this._bucketParts;for(;this._currentTileIndex<t.length;)if(e.getBucketParts(o,r,t[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((t,e)=>t.sortKey-e.sortKey));this._currentPartIndex<o.length;){const t=o[this._currentPartIndex];if(e.placeLayerBucketPart(t,this._seenCrossTileIDs,n,0===t.symbolInstanceStart),this._currentPartIndex++,i())return!0}return!1}}class je{constructor(t,e,n,r,i,o,s,a){this.placement=new Ee(t,i,o,s,a),this._currentPlacementIndex=e.length-1,this._forceFullPlacement=n,this._showCollisionBoxes=r,this._done=!1}isDone(){return this._done}continuePlacement(e,n,r){const i=t.exported.now(),o=()=>{const e=t.exported.now()-i;return!this._forceFullPlacement&&e>2};for(;this._currentPlacementIndex>=0;){const t=n[e[this._currentPlacementIndex]],i=this.placement.collisionIndex.transform.zoom;if("symbol"===t.type&&(!t.minzoom||t.minzoom<=i)&&(!t.maxzoom||t.maxzoom>i)){if(this._inProgressLayer||(this._inProgressLayer=new Le(t)),this._inProgressLayer.continuePlacement(r[t.source],this.placement,this._showCollisionBoxes,t,o))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(t){return this.placement.commit(t),this.placement}}const ze=512/t.EXTENT/2;class Fe{constructor(t,e,n){this.tileID=t,this.indexedSymbolInstances={},this.bucketInstanceId=n;for(let r=0;r<e.length;r++){const n=e.get(r),i=n.key;this.indexedSymbolInstances[i]||(this.indexedSymbolInstances[i]=[]),this.indexedSymbolInstances[i].push({crossTileID:n.crossTileID,coord:this.getScaledCoordinates(n,t)})}}getScaledCoordinates(e,n){const r=ze/Math.pow(2,n.canonical.z-this.tileID.canonical.z);return{x:Math.floor((n.canonical.x*t.EXTENT+e.tileAnchorX)*r),y:Math.floor((n.canonical.y*t.EXTENT+e.tileAnchorY)*r)}}findMatches(t,e,n){const r=this.tileID.canonical.z<e.canonical.z?1:Math.pow(2,this.tileID.canonical.z-e.canonical.z);for(let i=0;i<t.length;i++){const o=t.get(i);if(o.crossTileID)continue;const s=this.indexedSymbolInstances[o.key];if(!s)continue;const a=this.getScaledCoordinates(o,e);for(const t of s)if(Math.abs(t.coord.x-a.x)<=r&&Math.abs(t.coord.y-a.y)<=r&&!n[t.crossTileID]){n[t.crossTileID]=!0,o.crossTileID=t.crossTileID;break}}}}class Be{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ue{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(t){const e=Math.round((t-this.lng)/360);if(0!==e)for(const n in this.indexes){const t=this.indexes[n],r={};for(const n in t){const i=t[n];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+e),r[i.tileID.key]=i}this.indexes[n]=r}this.lng=t}addBucket(t,e,n){if(this.indexes[t.overscaledZ]&&this.indexes[t.overscaledZ][t.key]){if(this.indexes[t.overscaledZ][t.key].bucketInstanceId===e.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(t.overscaledZ,this.indexes[t.overscaledZ][t.key])}for(let i=0;i<e.symbolInstances.length;i++)e.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[t.overscaledZ]||(this.usedCrossTileIDs[t.overscaledZ]={});const r=this.usedCrossTileIDs[t.overscaledZ];for(const i in this.indexes){const n=this.indexes[i];if(Number(i)>t.overscaledZ)for(const i in n){const o=n[i];o.tileID.isChildOf(t)&&o.findMatches(e.symbolInstances,t,r)}else{const o=n[t.scaledTo(Number(i)).key];o&&o.findMatches(e.symbolInstances,t,r)}}for(let i=0;i<e.symbolInstances.length;i++){const t=e.symbolInstances.get(i);t.crossTileID||(t.crossTileID=n.generate(),r[t.crossTileID]=!0)}return void 0===this.indexes[t.overscaledZ]&&(this.indexes[t.overscaledZ]={}),this.indexes[t.overscaledZ][t.key]=new Fe(t,e.symbolInstances,e.bucketInstanceId),!0}removeBucketCrossTileIDs(t,e){for(const n in e.indexedSymbolInstances)for(const r of e.indexedSymbolInstances[n])delete this.usedCrossTileIDs[t][r.crossTileID]}removeStaleBuckets(t){let e=!1;for(const n in this.indexes){const r=this.indexes[n];for(const i in r)t[r[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(n,r[i]),delete r[i],e=!0)}return e}}class Ve{constructor(){this.layerIndexes={},this.crossTileIDs=new Be,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(t,e,n,r){let i=this.layerIndexes[t.id];void 0===i&&(i=this.layerIndexes[t.id]=new Ue);let o=!1;const s={};"globe"!==r.name&&i.handleWrapJump(n);for(const a of e){const e=a.getBucket(t);e&&t.id===e.layerIds[0]&&(e.bucketInstanceId||(e.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(a.tileID,e,this.crossTileIDs)&&(o=!0),s[e.bucketInstanceId]=!0)}return i.removeStaleBuckets(s)&&(o=!0),o}pruneUnusedLayers(t){const e={};t.forEach(t=>{e[t]=!0});for(const n in this.layerIndexes)e[n]||delete this.layerIndexes[n]}}const qe=(e,n)=>t.emitValidationErrors(e,n&&n.filter(t=>"source.canvas"!==t.identifier)),Ge=t.pick(Vt,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setProjection"]),$e=t.pick(Vt,["setCenter","setZoom","setBearing","setPitch"]),We={version:8,layers:[],sources:{}},He={fill:!0,line:!0,background:!0,hillshade:!0,raster:!0};class Ze extends t.Evented{constructor(e,n={}){super(),this.map=e,this.dispatcher=new P(Ft(),this),this.imageManager=new b,this.imageManager.setEventedParent(this),this.glyphManager=new t.GlyphManager(e._requestManager,n.localFontFamily?t.LocalGlyphMode.all:n.localIdeographFontFamily?t.LocalGlyphMode.ideographs:t.LocalGlyphMode.none,n.localFontFamily||n.localIdeographFontFamily),this.lineAtlas=new t.LineAtlas(256,512),this.crossTileSymbolIndex=new Ve,this._layers={},this._num3DLayers=0,this._numSymbolLayers=0,this._numCircleLayers=0,this._serializedLayers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this.zoomHistory=new t.ZoomHistory,this._loaded=!1,this._availableImages=[],this._order=[],this._drapedFirstOrder=[],this._markersNeedUpdate=!1,this._resetUpdates(),this.dispatcher.broadcast("setReferrer",t.getReferrer());const r=this;this._rtlTextPluginCallback=Ze.registerForPluginStateChange(e=>{r.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:e.pluginStatus,pluginURL:e.pluginURL},(e,n)=>{if(t.triggerPluginCompletionEvent(e),n&&n.every(t=>t))for(const t in r._sourceCaches){const e=r._sourceCaches[t],n=e.getSource().type;"vector"!==n&&"geojson"!==n||e.reload()}})}),this.on("data",t=>{if("source"!==t.dataType||"metadata"!==t.sourceDataType)return;const e=this.getSource(t.sourceId);if(e&&e.vectorLayerIds)for(const n in this._layers){const t=this._layers[n];t.source===e.id&&this._validateLayer(t)}})}loadURL(e,n={}){this.fire(new t.Event("dataloading",{dataType:"style"}));const r="boolean"==typeof n.validate?n.validate:!t.isMapboxURL(e);e=this.map._requestManager.normalizeStyleURL(e,n.accessToken);const i=this.map._requestManager.transformRequest(e,t.ResourceType.Style);this._request=t.getJSON(i,(e,n)=>{this._request=null,e?this.fire(new t.ErrorEvent(e)):n&&this._load(n,r)})}loadJSON(e,n={}){this.fire(new t.Event("dataloading",{dataType:"style"})),this._request=t.exported.frame(()=>{this._request=null,this._load(e,!1!==n.validate)})}loadEmpty(){this.fire(new t.Event("dataloading",{dataType:"style"})),this._load(We,!1)}_updateLayerCount(t,e){const n=e?1:-1;t.is3D()&&(this._num3DLayers+=n),"circle"===t.type&&(this._numCircleLayers+=n),"symbol"===t.type&&(this._numSymbolLayers+=n)}_load(e,n){if(n&&qe(this,t.validateStyle(e)))return;this._loaded=!0,this.stylesheet=e,this._updateMapProjection();for(const t in e.sources)this.addSource(t,e.sources[t],{validate:!1});this._changed=!1,e.sprite?this._loadSprite(e.sprite):(this.imageManager.setLoaded(!0),this.dispatcher.broadcast("spriteLoaded",!0)),this.glyphManager.setURL(e.glyphs);const r=Ut(this.stylesheet.layers);this._order=r.map(t=>t.id),this._layers={},this._serializedLayers={};for(let i of r)i=t.createStyleLayer(i),i.setEventedParent(this,{layer:{id:i.id}}),this._layers[i.id]=i,this._serializedLayers[i.id]=i.serialize(),this._updateLayerCount(i,!0);this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new T(this.stylesheet.light),this.stylesheet.terrain&&!this.terrainSetForDrapingOnly()&&this._createTerrain(this.stylesheet.terrain,1),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this._updateDrapeFirstLayers(),this.fire(new t.Event("data",{dataType:"style"})),this.fire(new t.Event("style.load"))}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}setProjection(t){t?this.stylesheet.projection=t:delete this.stylesheet.projection,this.map._explicitProjection||this.map._updateProjection()}_updateMapProjection(){this.map._explicitProjection?this.applyProjectionUpdate():this.map._updateProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?this.getTerrain()||this.stylesheet.terrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null))}_loadSprite(e){this._spriteRequest=function(e,n,r){let i,o,s;const a=t.exported.devicePixelRatio>1?"@2x":"";let c=t.getJSON(n.transformRequest(n.normalizeSpriteURL(e,a,".json"),t.ResourceType.SpriteJSON),(t,e)=>{c=null,s||(s=t,i=e,u())}),l=t.getImage(n.transformRequest(n.normalizeSpriteURL(e,a,".png"),t.ResourceType.SpriteImage),(t,e)=>{l=null,s||(s=t,o=e,u())});function u(){if(s)r(s);else if(i&&o){const e=t.exported.getImageData(o),n={};for(const r in i){const{width:o,height:s,x:a,y:c,sdf:l,pixelRatio:u,stretchX:h,stretchY:d,content:p}=i[r],f=new t.RGBAImage({width:o,height:s});t.RGBAImage.copy(e,f,{x:a,y:c},{x:0,y:0},{width:o,height:s}),n[r]={data:f,pixelRatio:u,sdf:l,stretchX:h,stretchY:d,content:p}}r(null,n)}}return{cancel(){c&&(c.cancel(),c=null),l&&(l.cancel(),l=null)}}}(e,this.map._requestManager,(e,n)=>{if(this._spriteRequest=null,e)this.fire(new t.ErrorEvent(e));else if(n)for(const t in n)this.imageManager.addImage(t,n[t]);this.imageManager.setLoaded(!0),this._availableImages=this.imageManager.listImages(),this.dispatcher.broadcast("setImages",this._availableImages),this.dispatcher.broadcast("spriteLoaded",!0),this.fire(new t.Event("data",{dataType:"style"}))})}_validateLayer(e){const n=this.getSource(e.source);if(!n)return;const r=e.sourceLayer;r&&("geojson"===n.type||n.vectorLayerIds&&-1===n.vectorLayerIds.indexOf(r))&&this.fire(new t.ErrorEvent(new Error(`Source layer "${r}" does not exist on source "${n.id}" as specified by style layer "${e.id}"`)))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._updatedSources).length)return!1;for(const t in this._sourceCaches)if(!this._sourceCaches[t].loaded())return!1;return!!this.imageManager.isLoaded()}_serializeLayers(t){const e=[];for(const n of t){const t=this._layers[n];"custom"!==t.type&&e.push(t.serialize())}return e}hasTransitions(){if(this.light&&this.light.hasTransition())return!0;if(this.fog&&this.fog.hasTransition())return!0;for(const t in this._sourceCaches)if(this._sourceCaches[t].hasTransition())return!0;for(const t in this._layers)if(this._layers[t].hasTransition())return!0;return!1}get order(){return this.map._optimizeForTerrain&&this.terrain?this._drapedFirstOrder:this._order}isLayerDraped(t){return!!this.terrain&&He[t.type]}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}update(e){if(!this._loaded)return;const n=this._changed;if(this._changed){const t=Object.keys(this._updatedLayers),n=Object.keys(this._removedLayers);(t.length||n.length)&&this._updateWorkerLayers(t,n);for(const e in this._updatedSources){const t=this._updatedSources[e];"reload"===t?this._reloadSource(e):"clear"===t&&this._clearSource(e)}this._updateTilesForChangedImages();for(const r in this._updatedPaintProps)this._layers[r].updateTransitions(e);this.light.updateTransitions(e),this.fog&&this.fog.updateTransitions(e),this._resetUpdates()}const r={};for(const t in this._sourceCaches){const e=this._sourceCaches[t];r[t]=e.used,e.used=!1}for(const t of this._order){const n=this._layers[t];if(n.recalculate(e,this._availableImages),!n.isHidden(e.zoom)){const t=this._getLayerSourceCache(n);t&&(t.used=!0)}const r=this.map.painter;if(r){const t=n.getProgramIds();if(!t)continue;const i=n.getProgramConfiguration(e.zoom);for(const e of t)r.useProgram(e,i)}}for(const i in r){const e=this._sourceCaches[i];r[i]!==e.used&&e.getSource().fire(new t.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:e.getSource().id}))}this.light.recalculate(e),this.terrain&&this.terrain.recalculate(e),this.fog&&this.fog.recalculate(e),this.z=e.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),n&&this.fire(new t.Event("data",{dataType:"style"}))}_updateTilesForChangedImages(){const t=Object.keys(this._changedImages);if(t.length){for(const e in this._sourceCaches)this._sourceCaches[e].reloadTilesForDependencies(["icons","patterns"],t);this._changedImages={}}}_updateWorkerLayers(t,e){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(t),removedIds:e})}_resetUpdates(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}}setState(e){if(this._checkLoaded(),qe(this,t.validateStyle(e)))return!1;(e=t.clone$1(e)).layers=Ut(e.layers);const n=function(t,e){if(!t)return[{command:Vt.setStyle,args:[e]}];let n=[];try{if(!i(t.version,e.version))return[{command:Vt.setStyle,args:[e]}];i(t.center,e.center)||n.push({command:Vt.setCenter,args:[e.center]}),i(t.zoom,e.zoom)||n.push({command:Vt.setZoom,args:[e.zoom]}),i(t.bearing,e.bearing)||n.push({command:Vt.setBearing,args:[e.bearing]}),i(t.pitch,e.pitch)||n.push({command:Vt.setPitch,args:[e.pitch]}),i(t.sprite,e.sprite)||n.push({command:Vt.setSprite,args:[e.sprite]}),i(t.glyphs,e.glyphs)||n.push({command:Vt.setGlyphs,args:[e.glyphs]}),i(t.transition,e.transition)||n.push({command:Vt.setTransition,args:[e.transition]}),i(t.light,e.light)||n.push({command:Vt.setLight,args:[e.light]}),i(t.fog,e.fog)||n.push({command:Vt.setFog,args:[e.fog]}),i(t.projection,e.projection)||n.push({command:Vt.setProjection,args:[e.projection]});const r={},o=[];!function(t,e,n,r){let o;for(o in e=e||{},t=t||{})t.hasOwnProperty(o)&&(e.hasOwnProperty(o)||Gt(o,n,r));for(o in e)e.hasOwnProperty(o)&&(t.hasOwnProperty(o)?i(t[o],e[o])||("geojson"===t[o].type&&"geojson"===e[o].type&&Wt(t,e,o)?n.push({command:Vt.setGeoJSONSourceData,args:[o,e[o].data]}):$t(o,e,n,r)):qt(o,e,n))}(t.sources,e.sources,o,r);const s=[];t.layers&&t.layers.forEach(t=>{t.source&&r[t.source]?n.push({command:Vt.removeLayer,args:[t.id]}):s.push(t)});let a=t.terrain;a&&r[a.source]&&(n.push({command:Vt.setTerrain,args:[void 0]}),a=void 0),n=n.concat(o),i(a,e.terrain)||n.push({command:Vt.setTerrain,args:[e.terrain]}),function(t,e,n){e=e||[];const r=(t=t||[]).map(Zt),o=e.map(Zt),s=t.reduce(Kt,{}),a=e.reduce(Kt,{}),c=r.slice(),l=Object.create(null);let u,h,d,p,f,m,g;for(u=0,h=0;u<r.length;u++)d=r[u],a.hasOwnProperty(d)?h++:(n.push({command:Vt.removeLayer,args:[d]}),c.splice(c.indexOf(d,h),1));for(u=0,h=0;u<o.length;u++)d=o[o.length-1-u],c[c.length-1-u]!==d&&(s.hasOwnProperty(d)?(n.push({command:Vt.removeLayer,args:[d]}),c.splice(c.lastIndexOf(d,c.length-h),1)):h++,m=c[c.length-u],n.push({command:Vt.addLayer,args:[a[d],m]}),c.splice(c.length-u,0,d),l[d]=!0);for(u=0;u<o.length;u++)if(d=o[u],p=s[d],f=a[d],!l[d]&&!i(p,f))if(i(p.source,f.source)&&i(p["source-layer"],f["source-layer"])&&i(p.type,f.type)){for(g in Ht(p.layout,f.layout,n,d,null,Vt.setLayoutProperty),Ht(p.paint,f.paint,n,d,null,Vt.setPaintProperty),i(p.filter,f.filter)||n.push({command:Vt.setFilter,args:[d,f.filter]}),i(p.minzoom,f.minzoom)&&i(p.maxzoom,f.maxzoom)||n.push({command:Vt.setLayerZoomRange,args:[d,f.minzoom,f.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Ht(p[g],f[g],n,d,g.slice(6),Vt.setPaintProperty):i(p[g],f[g])||n.push({command:Vt.setLayerProperty,args:[d,g,f[g]]}));for(g in f)f.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&(0===g.indexOf("paint.")?Ht(p[g],f[g],n,d,g.slice(6),Vt.setPaintProperty):i(p[g],f[g])||n.push({command:Vt.setLayerProperty,args:[d,g,f[g]]}))}else n.push({command:Vt.removeLayer,args:[d]}),m=c[c.lastIndexOf(d)+1],n.push({command:Vt.addLayer,args:[f,m]})}(s,e.layers,n)}catch(t){console.warn("Unable to compute style diff:",t),n=[{command:Vt.setStyle,args:[e]}]}return n}(this.serialize(),e).filter(t=>!(t.command in $e));if(0===n.length)return!1;const r=n.filter(t=>!(t.command in Ge));if(r.length>0)throw new Error(`Unimplemented: ${r.map(t=>t.command).join(", ")}.`);return n.forEach(t=>{"setTransition"!==t.command&&this[t.command].apply(this,t.args)}),this.stylesheet=e,this._updateMapProjection(),!0}addImage(e,n){return this.getImage(e)?this.fire(new t.ErrorEvent(new Error("An image with this name already exists."))):(this.imageManager.addImage(e,n),this._afterImageUpdated(e),this)}updateImage(t,e){this.imageManager.updateImage(t,e)}getImage(t){return this.imageManager.getImage(t)}removeImage(e){return this.getImage(e)?(this.imageManager.removeImage(e),this._afterImageUpdated(e),this):this.fire(new t.ErrorEvent(new Error("No image with this name exists.")))}_afterImageUpdated(e){this._availableImages=this.imageManager.listImages(),this._changedImages[e]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new t.Event("data",{dataType:"style"}))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addSource(e,n,r={}){if(this._checkLoaded(),void 0!==this.getSource(e))throw new Error("There is already a source with this ID");if(!n.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(n).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(n.type)>=0&&this._validate(t.validateSource,`sources.${e}`,n,null,r))return;this.map&&this.map._collectResourceTiming&&(n.collectResourceTiming=!0);const i=Mt(e,n,this.dispatcher,this);i.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(e),source:i.serialize(),sourceId:e}));const o=n=>{const r=(n?"symbol:":"other:")+e,o=this._sourceCaches[r]=new t.SourceCache(r,i,n);(n?this._symbolSourceCaches:this._otherSourceCaches)[e]=o,o.style=this,o.onAdd(this.map)};o(!1),"vector"!==n.type&&"geojson"!==n.type||o(!0),i.onAdd&&i.onAdd(this.map),this._changed=!0}removeSource(e){this._checkLoaded();const n=this.getSource(e);if(!n)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while layer "${i}" is using it.`)));if(this.terrain&&this.terrain.get().source===e)return this.fire(new t.ErrorEvent(new Error(`Source "${e}" cannot be removed while terrain is using it.`)));const r=this._getSourceCaches(e);for(const i of r)delete this._sourceCaches[i.id],delete this._updatedSources[i.id],i.fire(new t.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:i.getSource().id})),i.setEventedParent(null),i.clearTiles();return delete this._otherSourceCaches[e],delete this._symbolSourceCaches[e],n.setEventedParent(null),n.onRemove&&n.onRemove(this.map),this._changed=!0,this}setGeoJSONSourceData(t,e){this._checkLoaded(),this.getSource(t).setData(e),this._changed=!0}getSource(t){const e=this._getSourceCache(t);return e&&e.getSource()}addLayer(e,n,r={}){this._checkLoaded();const i=e.id;if(this.getLayer(i))return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${i}" already exists on this map`)));let o;if("custom"===e.type){if(qe(this,t.validateCustomStyleLayer(e)))return;o=t.createStyleLayer(e)}else{if("object"==typeof e.source&&(this.addSource(i,e.source),e=t.clone$1(e),e=t.extend(e,{source:i})),this._validate(t.validateLayer,`layers.${i}`,e,{arrayIndex:-1},r))return;o=t.createStyleLayer(e),this._validateLayer(o),o.setEventedParent(this,{layer:{id:i}}),this._serializedLayers[o.id]=o.serialize(),this._updateLayerCount(o,!0)}const s=n?this._order.indexOf(n):this._order.length;if(n&&-1===s)return void this.fire(new t.ErrorEvent(new Error(`Layer with id "${n}" does not exist on this map.`)));this._order.splice(s,0,i),this._layerOrderChanged=!0,this._layers[i]=o;const a=this._getLayerSourceCache(o);if(this._removedLayers[i]&&o.source&&a&&"custom"!==o.type){const t=this._removedLayers[i];delete this._removedLayers[i],t.type!==o.type?this._updatedSources[o.source]="clear":(this._updatedSources[o.source]="reload",a.pause())}this._updateLayer(o),o.onAdd&&o.onAdd(this.map),this._updateDrapeFirstLayers()}moveLayer(e,n){if(this._checkLoaded(),this._changed=!0,!this._layers[e])return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be moved.`)));if(e===n)return;const r=this._order.indexOf(e);this._order.splice(r,1);const i=n?this._order.indexOf(n):this._order.length;n&&-1===i?this.fire(new t.ErrorEvent(new Error(`Layer with id "${n}" does not exist on this map.`))):(this._order.splice(i,0,e),this._layerOrderChanged=!0,this._updateDrapeFirstLayers())}removeLayer(e){this._checkLoaded();const n=this._layers[e];if(!n)return void this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be removed.`)));n.setEventedParent(null),this._updateLayerCount(n,!1);const r=this._order.indexOf(e);this._order.splice(r,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[e]=n,delete this._layers[e],delete this._serializedLayers[e],delete this._updatedLayers[e],delete this._updatedPaintProps[e],n.onRemove&&n.onRemove(this.map),this._updateDrapeFirstLayers()}getLayer(t){return this._layers[t]}hasLayer(t){return t in this._layers}hasLayerType(t){for(const e in this._layers)if(this._layers[e].type===t)return!0;return!1}setLayerZoomRange(e,n,r){this._checkLoaded();const i=this.getLayer(e);i?i.minzoom===n&&i.maxzoom===r||(null!=n&&(i.minzoom=n),null!=r&&(i.maxzoom=r),this._updateLayer(i)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot have zoom extent.`)))}setFilter(e,n,r={}){this._checkLoaded();const o=this.getLayer(e);if(o){if(!i(o.filter,n))return null==n?(o.filter=void 0,void this._updateLayer(o)):void(this._validate(t.validateFilter,`layers.${o.id}.filter`,n,{layerType:o.type},r)||(o.filter=t.clone$1(n),this._updateLayer(o)))}else this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be filtered.`)))}getFilter(e){const n=this.getLayer(e);return n&&t.clone$1(n.filter)}setLayoutProperty(e,n,r,o={}){this._checkLoaded();const s=this.getLayer(e);s?i(s.getLayoutProperty(n),r)||(s.setLayoutProperty(n,r,o),this._updateLayer(s)):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getLayoutProperty(e,n){const r=this.getLayer(e);if(r)return r.getLayoutProperty(n);this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style.`)))}setPaintProperty(e,n,r,o={}){this._checkLoaded();const s=this.getLayer(e);s?i(s.getPaintProperty(n),r)||(s.setPaintProperty(n,r,o)&&this._updateLayer(s),this._changed=!0,this._updatedPaintProps[e]=!0):this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be styled.`)))}getPaintProperty(t,e){const n=this.getLayer(t);return n&&n.getPaintProperty(e)}setFeatureState(e,n){this._checkLoaded();const r=e.source,i=e.sourceLayer,o=this.getSource(r);if(!o)return void this.fire(new t.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const s=o.type;if("geojson"===s&&i)return void this.fire(new t.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===s&&!i)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided.")));const a=this._getSourceCaches(r);for(const t of a)t.setFeatureState(i,e.id,n)}removeFeatureState(e,n){this._checkLoaded();const r=e.source,i=this.getSource(r);if(!i)return void this.fire(new t.ErrorEvent(new Error(`The source '${r}' does not exist in the map's style.`)));const o=i.type,s="vector"===o?e.sourceLayer:void 0;if("vector"===o&&!s)return void this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")));if(n&&"string"!=typeof e.id&&"number"!=typeof e.id)return void this.fire(new t.ErrorEvent(new Error("A feature id is required to remove its specific state property.")));const a=this._getSourceCaches(r);for(const t of a)t.removeFeatureState(s,e.id,n)}getFeatureState(e){this._checkLoaded();const n=e.source,r=e.sourceLayer,i=this.getSource(n);if(i){if("vector"!==i.type||r)return void 0===e.id&&this.fire(new t.ErrorEvent(new Error("The feature id parameter must be provided."))),this._getSourceCaches(n)[0].getFeatureState(r,e.id);this.fire(new t.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new t.ErrorEvent(new Error(`The source '${n}' does not exist in the map's style.`)))}getTransition(){return t.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)}serialize(){const e={};for(const t in this._sourceCaches){const n=this._sourceCaches[t].getSource();e[n.id]||(e[n.id]=n.serialize())}return t.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,terrain:this.stylesheet.terrain,fog:this.stylesheet.fog,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:e,layers:this._serializeLayers(this._order)},t=>void 0!==t)}_updateLayer(t){this._updatedLayers[t.id]=!0;const e=this._getLayerSourceCache(t);t.source&&!this._updatedSources[t.source]&&e&&"raster"!==e.getSource().type&&(this._updatedSources[t.source]="reload",e.pause()),this._changed=!0,t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(t){const e=t=>"fill-extrusion"===this._layers[t].type,n={},r=[];for(let o=this._order.length-1;o>=0;o--){const i=this._order[o];if(e(i)){n[i]=o;for(const e of t){const t=e[i];if(t)for(const e of t)r.push(e)}}}r.sort((t,e)=>e.intersectionZ-t.intersectionZ);const i=[];for(let o=this._order.length-1;o>=0;o--){const s=this._order[o];if(e(s))for(let t=r.length-1;t>=0;t--){const e=r[t].feature;if(n[e.layer.id]<o)break;i.push(e),r.pop()}else for(const e of t){const t=e[s];if(t)for(const e of t)i.push(e.feature)}}return i}queryRenderedFeatures(e,n,r){n&&n.filter&&this._validate(t.validateFilter,"queryRenderedFeatures.filter",n.filter,null,n);const i={};if(n&&n.layers){if(!Array.isArray(n.layers))return this.fire(new t.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(const e of n.layers){const n=this._layers[e];if(!n)return this.fire(new t.ErrorEvent(new Error(`The layer '${e}' does not exist in the map's style and cannot be queried for features.`))),[];i[n.source]=!0}}const o=[];n.availableImages=this._availableImages;const s=n&&n.layers?n.layers.some(t=>{const e=this.getLayer(t);return e&&e.is3D()}):this.has3DLayers(),a=R.createFromScreenPoints(e,r);for(const t in this._sourceCaches){const e=this._sourceCaches[t].getSource().id;n.layers&&!i[e]||o.push(Pt(this._sourceCaches[t],this._layers,this._serializedLayers,a,n,r,s,!!this.map._showQueryGeometry))}return this.placement&&o.push(function(t,e,n,r,i,o,s){const a={},c=o.queryRenderedSymbols(r),l=[];for(const u of Object.keys(c).map(Number))l.push(s[u]);l.sort(Rt);for(const u of l){const n=u.featureIndex.lookupSymbolFeatures(c[u.bucketInstanceId],e,u.bucketIndex,u.sourceLayerIndex,i.filter,i.layers,i.availableImages,t);for(const t in n){const e=a[t]=a[t]||[],r=n[t];r.sort((t,e)=>{const n=u.featureSortOrder;if(n){const r=n.indexOf(t.featureIndex);return n.indexOf(e.featureIndex)-r}return e.featureIndex-t.featureIndex});for(const t of r)e.push(t)}}for(const u in a)a[u].forEach(e=>{const r=e.feature,i=n(t[u]).getFeatureState(r.layer["source-layer"],r.id);r.source=r.layer.source,r.layer["source-layer"]&&(r.sourceLayer=r.layer["source-layer"]),r.state=i});return a}(this._layers,this._serializedLayers,this._getLayerSourceCache.bind(this),a.screenGeometry,n,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(o)}querySourceFeatures(e,n){n&&n.filter&&this._validate(t.validateFilter,"querySourceFeatures.filter",n.filter,null,n);const r=this._getSourceCaches(e);let i=[];for(const t of r)i=i.concat(Dt(t,n));return i}addSourceType(t,e,n){return Ze.getSourceType(t)?n(new Error(`A source type called "${t}" already exists.`)):(Ze.setSourceType(t,e),e.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:t,url:e.workerSourceURL},n):n(null,null))}getLight(){return this.light.getLight()}setLight(e,n={}){this._checkLoaded();const r=this.light.getLight();let o=!1;for(const t in e)if(!i(e[t],r[t])){o=!0;break}if(!o)return;const s={now:t.exported.now(),transition:t.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(e,n),this.light.updateTransitions(s)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}setTerrain(e,n=1){if(this._checkLoaded(),!e)return delete this.terrain,delete this.stylesheet.terrain,this.dispatcher.broadcast("enableTerrain",!1),this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);if(1===n){if("object"==typeof e.source){const n="terrain-dem-src";this.addSource(n,e.source),e=t.clone$1(e),e=t.extend(e,{source:n})}if(this._validate(t.validateTerrain,"terrain",e))return}if(!this.terrain||this.terrain&&n!==this.terrain.drapeRenderMode)this._createTerrain(e,n);else{const n=this.terrain,r=n.get();for(const o in e)if(!i(e[o],r[o])){n.set(e),this.stylesheet.terrain=e;const r={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(r);break}}this._updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const n=this.fog=new O(e,this.map.transform);this.stylesheet.fog=e;const r={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(r)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const t of this.map._markers)t._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(e){if(this._checkLoaded(),!e)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const n=this.fog,r=n.get();for(const o in e)if(!i(e[o],r[o])){n.set(e),this.stylesheet.fog=e;const r={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};n.updateTransitions(r);break}}else this._createFog(e);this._markersNeedUpdate=!0}_updateDrapeFirstLayers(){if(!this.map._optimizeForTerrain||!this.terrain)return;const t=this._order.filter(t=>this.isLayerDraped(this._layers[t])),e=this._order.filter(t=>!this.isLayerDraped(this._layers[t]));this._drapedFirstOrder=[],this._drapedFirstOrder.push(...t),this._drapedFirstOrder.push(...e)}_createTerrain(e,n){const r=this.terrain=new S(e,n);this.stylesheet.terrain=e,this.dispatcher.broadcast("enableTerrain",!this.terrainSetForDrapingOnly()),this._force3DLayerUpdate();const i={now:t.exported.now(),transition:t.extend({duration:0},this.stylesheet.transition)};r.updateTransitions(i)}_force3DLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"fill-extrusion"===e.type&&this._updateLayer(e)}}_forceSymbolLayerUpdate(){for(const t in this._layers){const e=this._layers[t];"symbol"===e.type&&this._updateLayer(e)}}_validate(e,n,r,i,o={}){return(!o||!1!==o.validate)&&qe(this,e.call(t.validateStyle,t.extend({key:n,style:this.serialize(),value:r,styleSpec:t.spec},i)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),t.evented.off("pluginStateChange",this._rtlTextPluginCallback);for(const t in this._layers)this._layers[t].setEventedParent(null);for(const t in this._sourceCaches)this._sourceCaches[t].clearTiles(),this._sourceCaches[t].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()}_clearSource(t){const e=this._getSourceCaches(t);for(const n of e)n.clearTiles()}_reloadSource(t){const e=this._getSourceCaches(t);for(const n of e)n.resume(),n.reload()}_updateSources(t){for(const e in this._sourceCaches)this._sourceCaches[e].update(t)}_generateCollisionBoxes(){for(const t in this._sourceCaches){const e=this._sourceCaches[t];e.resume(),e.reload()}}_updatePlacement(e,n,r,i,o=!1){let s=!1,a=!1;const c={};for(const t of this._order){const n=this._layers[t];if("symbol"!==n.type)continue;if(!c[n.source]){const t=this._getLayerSourceCache(n);if(!t)continue;c[n.source]=t.getRenderableIds(!0).map(e=>t.getTileByID(e)).sort((t,e)=>e.tileID.overscaledZ-t.tileID.overscaledZ||(t.tileID.isLessThan(e.tileID)?-1:1))}const r=this.crossTileSymbolIndex.addLayer(n,c[n.source],e.center.lng,e.projection);s=s||r}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),o=o||this._layerOrderChanged||0===r,this._layerOrderChanged&&this.fire(new t.Event("neworder")),(o||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(t.exported.now(),e.zoom))&&(this.pauseablePlacement=new je(e,this._order,o,n,r,i,this.placement,this.fog&&e.projection.supportsFog?this.fog.state:null),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,c),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(t.exported.now()),a=!0),s&&this.pauseablePlacement.placement.setStale()),a||s)for(const t of this._order){const e=this._layers[t];"symbol"===e.type&&this.placement.updateLayerOpacities(e,c[e.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(t.exported.now())}_releaseSymbolFadeTiles(){for(const t in this._sourceCaches)this._sourceCaches[t].releaseSymbolFadeTiles()}getImages(t,e,n){this.imageManager.getImages(e.icons,n),this._updateTilesForChangedImages();const r=t=>{t&&t.setDependencies(e.tileID.key,e.type,e.icons)};r(this._otherSourceCaches[e.source]),r(this._symbolSourceCaches[e.source])}getGlyphs(t,e,n){this.glyphManager.getGlyphs(e.stacks,n)}getResource(e,n,r){return t.makeRequest(n,r)}_getSourceCache(t){return this._otherSourceCaches[t]}_getLayerSourceCache(t){return"symbol"===t.type?this._symbolSourceCaches[t.source]:this._otherSourceCaches[t.source]}_getSourceCaches(t){const e=[];return this._otherSourceCaches[t]&&e.push(this._otherSourceCaches[t]),this._symbolSourceCaches[t]&&e.push(this._symbolSourceCaches[t]),e}_isSourceCacheLoaded(e){const n=this._getSourceCaches(e);return 0===n.length?(this.fire(new t.ErrorEvent(new Error(`There is no source with ID '${e}'`))),!1):n.every(t=>t.loaded())}has3DLayers(){return this._num3DLayers>0}hasSymbolLayers(){return this._numSymbolLayers>0}hasCircleLayers(){return this._numCircleLayers>0}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Ze.getSourceType=function(t){return At[t]},Ze.setSourceType=function(t,e){At[t]=e},Ze.registerForPluginStateChange=t.registerForPluginStateChange;var Ke="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#define EXTENT 8192.0\n#define HALF_PI PI/2.0\n#define QUARTER_PI PI/4.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\n#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;varying vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}\n#endif",Xe="attribute highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;varying highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}";let Ye={},Qe={};Ye=nn("","\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;\n#else\nuniform sampler2D u_dem;uniform sampler2D u_dem_prev;\n#endif\nuniform vec4 u_dem_unpack;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;uniform sampler2D u_depth;uniform vec2 u_depth_size_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float decodeElevation(vec4 v) {return dot(vec4(v.xyz*255.0,-1.0),u_dem_unpack);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem,pos));\n#ifdef TERRAIN_DEM_NEAREST_FILTER\nreturn u_exaggeration*tl;\n#endif\nfloat tr=decodeElevation(texture2D(u_dem,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture2D(u_dem_prev,pos).a;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=decodeElevation(texture2D(u_dem_prev,pos));float tr=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,0.0)));float bl=decodeElevation(texture2D(u_dem_prev,pos+vec2(0.0,dd)));float br=decodeElevation(texture2D(u_dem_prev,pos+vec2(dd,dd)));return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {return currentElevation(apos);}\n#endif\nfloat unpack_depth(vec4 rgba_depth)\n{const vec4 bit_shift=vec4(1.0/(256.0*256.0*256.0),1.0/(256.0*256.0),1.0/256.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;float depth=unpack_depth(texture2D(u_depth,(coord.xy+1.0)*0.5));return coord.z > depth+0.0005;}float occlusionFade(vec4 frag) {vec3 coord=frag.xyz/frag.w;vec3 df=vec3(5.0*u_depth_size_inv,0.0);vec2 uv=0.5*coord.xy+0.5;vec4 depth=vec4(\nunpack_depth(texture2D(u_depth,uv-df.xz)),unpack_depth(texture2D(u_depth,uv+df.xz)),unpack_depth(texture2D(u_depth,uv-df.zy)),unpack_depth(texture2D(u_depth,uv+df.zy))\n);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z-0.001)-depth),0.0,1.0));}vec4 fourSample(vec2 pos,vec2 off) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nfloat tl=texture2D(u_dem,pos).a;float tr=texture2D(u_dem,pos+vec2(off.x,0.0)).a;float bl=texture2D(u_dem,pos+vec2(0.0,off.y)).a;float br=texture2D(u_dem,pos+off).a;\n#else\nvec4 demtl=vec4(texture2D(u_dem,pos).xyz*255.0,-1.0);float tl=dot(demtl,u_dem_unpack);vec4 demtr=vec4(texture2D(u_dem,pos+vec2(off.x,0.0)).xyz*255.0,-1.0);float tr=dot(demtr,u_dem_unpack);vec4 dembl=vec4(texture2D(u_dem,pos+vec2(0.0,off.y)).xyz*255.0,-1.0);float bl=dot(dembl,u_dem_unpack);vec4 dembr=vec4(texture2D(u_dem,pos+off).xyz*255.0,-1.0);float br=dot(dembr,u_dem_unpack);\n#endif\nreturn vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;vec4 bounds=vec4(d,vec2(1.0)-d);h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }bool isOccluded(vec4 frag) { return false; }float occlusionFade(vec4 frag) { return 1.0; }\n#endif",!0),Qe=nn("#ifdef FOG\nuniform float u_fog_temporal_offset;float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);return mix(color,u_fog_color.rgb,opacity);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec3 fog_dither(vec3 color) {vec2 dither_seed=gl_FragCoord.xy+u_fog_temporal_offset;return dither(color,dither_seed);}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif","#ifdef FOG\nuniform mat4 u_fog_matrix;vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",!0);const Je=nn("\nhighp vec3 hash(highp vec2 p) {highp vec3 p3=fract(p.xyx*vec3(443.8975,397.2973,491.1871));p3+=dot(p3,p3.yxz+19.19);return fract((p3.xxy+p3.yzz)*p3.zyx);}vec3 dither(vec3 color,highp vec2 seed) {vec3 rnd=hash(seed)+hash(seed+0.59374)-0.5;return color+rnd/255.0;}\n#ifdef TERRAIN\nhighp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(256.0*256.0*256.0,256.0*256.0,256.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/256.0,1.0/256.0,1.0/256.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#endif","\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);//Normalized device coordinate that is not rendered."),tn=Ke;var en={background:nn("uniform vec4 u_color;uniform float u_opacity;void main() {vec4 out_color=u_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),backgroundPattern:nn("uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_mix);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),circle:nn("varying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\ngl_FragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec3 v_data;varying float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main(void) {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nvec2 scaled_extrude=extrude*a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=scaled_extrude.x*surface_vectors[0]+scaled_extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);vec4 world_center=vec4(pos,1);\n#else \nmat3 surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);vec4 world_center=vec4(circle_center,height,1);\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\n#if defined(SCALE_WITH_MAP) && defined(PROJECTION_GLOBE_VIEW)\nview_scale*=a_scale;\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);vec4 occlusion_world_center=vec4(circle_center,cantilevered_height,1);vec4 occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nvec4 occlusion_world_center=world_center;vec4 occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}"),clippingMask:nn("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:nn("uniform highp float u_intensity;varying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\ngl_FragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;attribute float a_scale;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nvarying vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main(void) {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);\n#ifdef PROJECTION_GLOBE_VIEW\nextrude*=a_scale;vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\nvec3 pos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),heatmapTexture:nn("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(0.0);\n#endif\n}","attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:nn("varying float v_placed;varying float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);gl_FragColor =mix(red,blue,step(0.5,v_placed))*0.5;gl_FragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}","attribute vec3 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;attribute float a_size_scale;attribute vec2 a_padding;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_pos+elevationVector(a_anchor_pos)*elevation(a_anchor_pos),1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),collisionCircle:nn("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos_2f;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:nn("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;\n#endif\nvarying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}"),fill:nn("#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutline:nn("varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\ngl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillOutlinePattern:nn("uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillPattern:nn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color*opacity;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),fillExtrusion:nn("varying vec4 v_color;void main() {vec4 color=v_color;\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec4 v_color;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\nvec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 pos=vec3(pos_nx.xy,h);\n#else\nvec3 pos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(pos.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.rgb+=clamp(color.rgb*directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),fillExtrusionPattern:nn("uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 out_color=mix(color1,color2,u_fade);out_color=out_color*v_lighting;\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\ngl_FragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec4 a_pos_normal_ed;attribute vec2 a_centroid_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nattribute vec3 a_pos_3;attribute vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\nvarying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;\n#pragma mapbox: define lowp float base\n#pragma mapbox: define lowp float height\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float base\n#pragma mapbox: initialize lowp float height\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\n#ifdef TERRAIN\nbool flat_roof=centroid_pos.x !=0.0 && t > 0.0;float ele=elevation(pos_nx.xy);float c_ele=flat_roof ? centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos) : ele;float h=flat_roof ? max(c_ele+height,ele+base+2.0) : ele+(t > 0.0 ? height : base==0.0 ?-5.0 : base);vec3 p=vec3(pos_nx.xy,h);\n#else\nvec3 p=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat hidden=float(centroid_pos.x==0.0 && centroid_pos.y==1.0);gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}"),hillshadePrepare:nn("#ifdef GL_ES\nprecision highp float;\n#endif\nuniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nreturn texture2D(u_image,coord).a/4.0;\n#else\nvec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;\n#endif\n}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos);float f=getElevation(v_pos+vec2(epsilon.x,0));float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float h=getElevation(v_pos+vec2(0,epsilon.y));float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:nn("uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef FOG\ngl_FragColor=fog_dither(fog_apply_premultiplied(gl_FragColor,v_fog_pos));\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),line:nn("uniform lowp float u_device_pixel_ratio;uniform float u_alpha_discard_threshold;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;uniform float u_mix;uniform vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);\n#ifdef RENDER_LINE_DASH\nfloat sdfdist_a=texture2D(u_dash_image,v_tex_a).a;float sdfdist_b=texture2D(u_dash_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);float sdfwidth=min(dash_from.z*u_scale.y,dash_to.z*u_scale.z);float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/sdfwidth;alpha*=smoothstep(0.5-sdfgamma/floorwidth,0.5+sdfgamma/floorwidth,sdfdist);\n#endif\n#ifdef RENDER_LINE_GRADIENT\nvec4 out_color=texture2D(u_gradient_image,v_uv);\n#else\nvec4 out_color=color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef RENDER_LINE_ALPHA_DISCARD\nif (alpha < u_alpha_discard_threshold) {discard;}\n#endif\ngl_FragColor=out_color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define EXTRUDE_SCALE 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;\n#ifdef RENDER_LINE_GRADIENT\nattribute vec3 a_packed;\n#else\nattribute float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform mediump vec3 u_scale;varying vec2 v_tex_a;varying vec2 v_tex_b;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;varying highp vec2 v_uv;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash_from\n#pragma mapbox: define lowp vec4 dash_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash_from\n#pragma mapbox: initialize lowp vec4 dash_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nfloat a_uv_x=a_packed[0];float a_split_index=a_packed[1];float a_linesofar=a_packed[2];highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);\n#endif\n#ifdef RENDER_LINE_DASH\nfloat tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;float scaleA=dash_from.z==0.0 ? 0.0 : tileZoomRatio/(dash_from.z*fromScale);float scaleB=dash_to.z==0.0 ? 0.0 : tileZoomRatio/(dash_to.z*toScale);float heightA=dash_from.y;float heightB=dash_to.y;v_tex_a=vec2(a_linesofar*scaleA/floorwidth,(-normal.y*heightA+dash_from.x+0.5)/u_texsize.y);v_tex_b=vec2(a_linesofar*scaleB/floorwidth,(-normal.y*heightB+dash_to.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),linePattern:nn("uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\nvec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ngl_FragColor=color*(alpha*opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","\n#define scale 0.015873016\nattribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_linesofar;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 pattern_from\n#pragma mapbox: define lowp vec4 pattern_to\n#pragma mapbox: define lowp float pixel_ratio_from\n#pragma mapbox: define lowp float pixel_ratio_to\nvoid main() {\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern_from\n#pragma mapbox: initialize mediump vec4 pattern_to\n#pragma mapbox: initialize lowp float pixel_ratio_from\n#pragma mapbox: initialize lowp float pixel_ratio_to\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist*u_pixels_to_tile_units,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude;\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;\n#else\nv_gamma_scale=1.0;\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}"),raster:nn("uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef FOG\nout_color=fog_dither(fog_apply(out_color,v_fog_pos));\n#endif\ngl_FragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {float w=1.0+dot(a_texture_pos,u_perspective_transform);gl_Position=u_matrix*vec4(a_pos*w,0,w);v_pos0=a_texture_pos/8192.0;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}"),symbolIcon:nn("uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nlowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_tex;varying float v_fade_opacity;\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetProjected_point.xy/offsetProjected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change))*projection_transition_fade;}"),symbolSDF:nn("#define SDF_PX 8.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_pixeloffset;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec2 v_data0;varying vec3 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nvec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade);}"),symbolTextAndIcon:nn("#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nfloat fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\nreturn;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","attribute vec4 a_pos_offset;attribute vec4 a_tex_size;attribute vec4 a_z_tile_anchor;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nvarying vec4 v_data0;varying vec4 v_data1;\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}float anchor_z=a_z_tile_anchor.x;vec2 tile_anchor=a_z_tile_anchor.yz;vec3 h=elevationVector(tile_anchor)*elevation(tile_anchor);\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);vec3 world_pos=mix_globe_mercator(vec3(a_pos,anchor_z)+h,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;float globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nvec3 world_pos=vec3(a_pos,anchor_z)+h;float globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offset_projected_point=u_matrix*vec4(a_pos+vec2(1,0),anchor_z,1);vec2 a=projected_point.xy/projected_point.w;vec2 b=offset_projected_point.xy/offset_projected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 proj_pos=mix_globe_mercator(vec3(a_projected_pos.xy,anchor_z),mercator_pos,u_zoom_transition);\n#else\nvec3 proj_pos=vec3(a_projected_pos.xy,anchor_z);\n#endif\n#ifdef PROJECTED_POS_ON_VIEWPORT\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xy,0.0,1.0);\n#else\nvec4 projected_pos=u_label_plane_matrix*vec4(proj_pos.xyz+h,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*font_scale);\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\nfloat occlusion_fade=occlusionFade(projected_point)*globe_occlusion_fade;gl_Position=mix(u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+offset,z,1.0),AWAY,float(projected_point.w <=0.0 || occlusion_fade==0.0));float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));float projection_transition_fade=1.0;\n#if defined(PROJECTED_POS_ON_VIEWPORT) && defined(PROJECTION_GLOBE_VIEW)\nprojection_transition_fade=1.0-step(EPSILON,u_zoom_transition);\n#endif\nv_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity*projection_transition_fade,is_sdf);}"),terrainRaster:nn("uniform sampler2D u_image0;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nvoid main() {vec4 color=texture2D(u_image0,v_pos0);\n#ifdef FOG\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\ngl_FragColor=color;\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_matrix;uniform float u_skirt_height;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;\n#ifdef FOG\nvarying float v_fog_opacity;\n#endif\nconst float skirtOffset=24575.0;const float wireframeOffset=0.00015;void main() {v_pos0=a_texture_pos/8192.0;float skirt=float(a_pos.x >=skirtOffset);float elevation=elevation(a_texture_pos)-skirt*u_skirt_height;\n#ifdef TERRAIN_WIREFRAME\nelevation+=u_skirt_height*u_skirt_height*wireframeOffset;\n#endif\nvec2 decodedPos=a_pos-vec2(skirt*skirtOffset,0.0);gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n}"),terrainDepth:nn("#ifdef GL_ES\nprecision highp float;\n#endif\nvarying float v_depth;void main() {gl_FragColor=pack_depth(v_depth);}","uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying float v_depth;void main() {float elevation=elevation(a_texture_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}"),skybox:nn("\nvarying lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=textureCube(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color.rgb=dither(sky_color.rgb,gl_FragCoord.xy+u_temporal_offset);sky_color+=0.1*sun_disk(v_uv,u_sun_direction);gl_FragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Xe),skyboxGradient:nn("varying highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture2D(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;color.rgb=dither(color.rgb,gl_FragCoord.xy+u_temporal_offset);gl_FragColor=color;\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}",Xe),skyboxCapture:nn("\nvarying highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;\n#ifdef GL_ES\nprecision highp float;\n#endif\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;gl_FragColor=vec4(color,1.0);}","attribute highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;varying highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:nn("uniform sampler2D u_image0;varying vec2 v_pos0;void main() {gl_FragColor=texture2D(u_image0,v_pos0);\n#ifdef TERRAIN_WIREFRAME\ngl_FragColor=vec4(1.0,0.0,0.0,0.8);\n#endif\n#ifdef OVERDRAW_INSPECTOR\ngl_FragColor=vec4(1.0);\n#endif\n}","uniform mat4 u_proj_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;\n#ifdef GLOBE_POLES\nattribute vec3 a_globe_pos;attribute vec2 a_merc_pos;attribute vec2 a_uv;\n#else\nattribute vec2 a_pos;\n#endif\nvarying vec2 v_pos0;const float wireframeOffset=1e3;float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(QUARTER_PI+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 merc_pos=a_merc_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idy=u_grid_matrix[1][2];float S=u_grid_matrix[2][2];vec3 latLng=u_grid_matrix*vec3(a_pos,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=a_pos[0]*S;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;uv=uv*EXTENT;vec4 up_vector=vec4(elevationVector(uv),1.0);float height=elevation(uv);\n#ifdef TERRAIN_WIREFRAME\nheight+=wireframeOffset;\n#endif\nvec4 globe=u_globe_matrix*vec4(globe_pos+up_vector.xyz*height,1.0);vec4 mercator=vec4(0.0);if (u_zoom_transition > 0.0) {mercator=vec4(merc_pos,height,1.0);mercator.xy-=u_merc_center;mercator.x=wrap(mercator.x,-0.5,0.5);mercator=u_merc_matrix*mercator;}vec3 position=mix(globe.xyz,mercator.xyz,u_zoom_transition);gl_Position=u_proj_matrix*vec4(position,1.0);}"),globeAtmosphere:nn("uniform float u_opacity;uniform highp float u_fadeout_range;uniform vec3 u_start_color;uniform vec3 u_end_color;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;varying highp vec3 v_ray_dir;void main() {highp vec3 dir=normalize(v_ray_dir);highp vec3 closest_point=abs(dot(u_globe_pos,dir))*dir;float norm_dist_from_center=length(closest_point-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 1.0)\ndiscard;float t=clamp(1.0-sqrt(norm_dist_from_center-1.0)/u_fadeout_range,0.0,1.0);vec3 color=mix(u_start_color,u_end_color,1.0-t);gl_FragColor=vec4(color*t*u_opacity,u_opacity);}","attribute vec3 a_pos;attribute vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;varying highp vec3 v_ray_dir;void main() {v_ray_dir=mix(mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);gl_Position=vec4(a_pos,1.0);}")};function nn(t,e,n){const r=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,i=/uniform (highp |mediump |lowp )?([\w]+) ([\w]+)([\s]*)([\w]*)/g,o=e.match(/attribute (highp |mediump |lowp )?([\w]+) ([\w]+)/g),s=t.match(i),a=e.match(i),c=Ke.match(i);let l=a?a.concat(s):s;n||(Ye.staticUniforms&&(l=Ye.staticUniforms.concat(l)),Qe.staticUniforms&&(l=Qe.staticUniforms.concat(l))),l&&(l=l.concat(c));const u={};return{fragmentSource:t=t.replace(r,(t,e,n,r,i)=>(u[i]=!0,"define"===e?`\n#ifndef HAS_UNIFORM_u_${i}\nvarying ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:`\n#ifdef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = u_${i};\n#endif\n`)),vertexSource:e=e.replace(r,(t,e,n,r,i)=>{const o="float"===r?"vec2":"vec4",s=i.match(/color/)?"color":o;return u[i]?"define"===e?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${n} ${o} a_${i};\nvarying ${n} ${r} ${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${i} = unpack_mix_${s}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:"define"===e?`\n#ifndef HAS_UNIFORM_u_${i}\nuniform lowp float u_${i}_t;\nattribute ${n} ${o} a_${i};\n#else\nuniform ${n} ${r} u_${i};\n#endif\n`:"vec4"===s?`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = a_${i};\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`:`\n#ifndef HAS_UNIFORM_u_${i}\n    ${n} ${r} ${i} = unpack_mix_${s}(a_${i}, u_${i}_t);\n#else\n    ${n} ${r} ${i} = u_${i};\n#endif\n`}),staticAttributes:o,staticUniforms:l}}class rn{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null}bind(t,e,n,r,i,o,s,a){this.context=t;let c=this.boundPaintVertexBuffers.length!==r.length;for(let l=0;!c&&l<r.length;l++)this.boundPaintVertexBuffers[l]!==r[l]&&(c=!0);t.extVertexArrayObject&&this.vao&&this.boundProgram===e&&this.boundLayoutVertexBuffer===n&&!c&&this.boundIndexBuffer===i&&this.boundVertexOffset===o&&this.boundDynamicVertexBuffer===s&&this.boundDynamicVertexBuffer2===a?(t.bindVertexArrayOES.set(this.vao),s&&s.bind(),i&&i.dynamicDraw&&i.bind(),a&&a.bind()):this.freshBind(e,n,r,i,o,s,a)}freshBind(t,e,n,r,i,o,s){let a;const c=t.numAttributes,l=this.context,u=l.gl;if(l.extVertexArrayObject)this.vao&&this.destroy(),this.vao=l.extVertexArrayObject.createVertexArrayOES(),l.bindVertexArrayOES.set(this.vao),a=0,this.boundProgram=t,this.boundLayoutVertexBuffer=e,this.boundPaintVertexBuffers=n,this.boundIndexBuffer=r,this.boundVertexOffset=i,this.boundDynamicVertexBuffer=o,this.boundDynamicVertexBuffer2=s;else{a=l.currentNumAttributes||0;for(let t=c;t<a;t++)u.disableVertexAttribArray(t)}e.enableAttributes(u,t);for(const h of n)h.enableAttributes(u,t);o&&o.enableAttributes(u,t),s&&s.enableAttributes(u,t),e.bind(),e.setVertexAttribPointers(u,t,i);for(const h of n)h.bind(),h.setVertexAttribPointers(u,t,i);o&&(o.bind(),o.setVertexAttribPointers(u,t,i)),r&&r.bind(),s&&(s.bind(),s.setVertexAttribPointers(u,t,i)),l.currentNumAttributes=c}destroy(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)}}function on(e,n){const r=Math.pow(2,n.canonical.z),i=n.canonical.y;return[new t.MercatorCoordinate(0,i/r).toLngLat().lat,new t.MercatorCoordinate(0,(i+1)/r).toLngLat().lat]}function sn(e,n,r,i,o,s,a){const c=e.context,l=c.gl,u=r.fbo;if(!u)return;e.prepareDrawTile();const h=e.useProgram("hillshade");c.activeTexture.set(l.TEXTURE0),l.bindTexture(l.TEXTURE_2D,u.colorAttachment.get());const d=((t,e,n,r)=>{const i=n.paint.get("hillshade-shadow-color"),o=n.paint.get("hillshade-highlight-color"),s=n.paint.get("hillshade-accent-color");let a=n.paint.get("hillshade-illumination-direction")*(Math.PI/180);"viewport"===n.paint.get("hillshade-illumination-anchor")&&(a-=t.transform.angle);const c=!t.options.moving;return{u_matrix:r||t.transform.calculateProjMatrix(e.tileID.toUnwrapped(),c),u_image:0,u_latrange:on(0,e.tileID),u_light:[n.paint.get("hillshade-exaggeration"),a],u_shadow:i,u_highlight:o,u_accent:s}})(e,r,i,e.terrain?n.projMatrix:null);e.prepareDrawProgram(c,h,n.toUnwrapped());const{tileBoundsBuffer:p,tileBoundsIndexBuffer:f,tileBoundsSegments:m}=e.getTileBoundsBuffers(r);h.draw(c,l.TRIANGLES,o,s,a,t.CullFaceMode.disabled,d,i.id,p,f,m)}function an(e,n,r){if(!n.needsDEMTextureUpload)return;const i=e.context,o=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),n.demTexture=n.demTexture||e.getTileTexture(r.stride);const s=r.getPixels();n.demTexture?n.demTexture.update(s,{premultiply:!1}):n.demTexture=new t.Texture(i,s,o.RGBA,{premultiply:!1}),n.needsDEMTextureUpload=!1}function cn(e,n,r,i,o,s){const a=e.context,c=a.gl;if(!n.dem)return;const l=n.dem;if(a.activeTexture.set(c.TEXTURE1),an(e,n,l),!n.demTexture)return;n.demTexture.bind(c.NEAREST,c.CLAMP_TO_EDGE);const u=l.dim;a.activeTexture.set(c.TEXTURE0);let h=n.fbo;if(!h){const e=new t.Texture(a,{width:u,height:u,data:null},c.RGBA);e.bind(c.LINEAR,c.CLAMP_TO_EDGE),h=n.fbo=a.createFramebuffer(u,u,!0),h.colorAttachment.set(e.texture)}a.bindFramebuffer.set(h.framebuffer),a.viewport.set([0,0,u,u]);const{tileBoundsBuffer:d,tileBoundsIndexBuffer:p,tileBoundsSegments:f}=e.getMercatorTileBoundsBuffers();e.useProgram("hillshadePrepare").draw(a,c.TRIANGLES,i,o,s,t.CullFaceMode.disabled,((e,n)=>{const r=n.stride,i=t.create();return t.ortho(i,0,t.EXTENT,-t.EXTENT,0,0,1),t.translate(i,i,[0,-t.EXTENT,0]),{u_matrix:i,u_image:1,u_dimension:[r,r],u_zoom:e.overscaledZ,u_unpack:n.unpackVector}})(n.tileID,l),r.id,d,p,f),n.needsHillshadePrepare=!1}const ln=(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image0:new t.Uniform1i(e,n.u_image0),u_skirt_height:new t.Uniform1f(e,n.u_skirt_height)}),un=(t,e)=>({u_matrix:t,u_image0:0,u_skirt_height:e}),hn=(t,e,n,r,i,o)=>({u_proj_matrix:Float32Array.from(t),u_globe_matrix:e,u_merc_matrix:n,u_zoom_transition:r,u_merc_center:i,u_image0:0,u_grid_matrix:o?Float32Array.from(o):new Float32Array(9)});function dn(t,e){return null!=t&&null!=e&&!(!t.hasData()||!e.hasData())&&null!=t.demTexture&&null!=e.demTexture&&t.tileID.key!==e.tileID.key}const pn=new class{constructor(){this.operations={}}newMorphing(t,e,n,r,i){if(t in this.operations){const e=this.operations[t];e.to.tileID.key!==n.tileID.key&&(e.queued=n)}else this.operations[t]={startTime:r,phase:0,duration:i,from:e,to:n,queued:null}}getMorphValuesForProxy(t){if(!(t in this.operations))return null;const e=this.operations[t];return{from:e.from,to:e.to,phase:e.phase}}update(t){for(const e in this.operations){const n=this.operations[e];for(n.phase=(t-n.startTime)/n.duration;n.phase>=1||!this._validOp(n);)if(!this._nextOp(n,t)){delete this.operations[e];break}}}_nextOp(t,e){return!!t.queued&&(t.from=t.to,t.to=t.queued,t.queued=null,t.phase=0,t.startTime=e,!0)}_validOp(t){return t.from.hasData()&&t.to.hasData()}},fn={0:null,1:"TERRAIN_VERTEX_MORPHING",2:"TERRAIN_WIREFRAME"};function mn(t,e){const n=1<<t.z;return!e&&(0===t.x||t.x===n-1)||0===t.y||t.y===n-1}const gn=t=>({u_matrix:t});function _n(e,n,r,i,o){if(o>0){const s=t.exported.now(),a=(s-e.timeAdded)/o,c=n?(s-n.timeAdded)/o:-1,l=r.getSource(),u=i.coveringZoomLevel({tileSize:l.tileSize,roundZoom:l.roundZoom}),h=!n||Math.abs(n.tileID.overscaledZ-u)>Math.abs(e.tileID.overscaledZ-u),d=h&&e.refreshedUponExpiration?1:t.clamp(h?a:1-c,0,1);return e.refreshedUponExpiration&&a>=1&&(e.refreshedUponExpiration=!1),n?{opacity:1,mix:1-d}:{opacity:d,mix:0}}return{opacity:1,mix:0}}const yn=2*t.mercatorZfromAltitude(1,0)*t.GLOBE_RADIUS*Math.PI;class vn extends t.SourceCache{constructor(t){const e={type:"raster-dem",maxzoom:t.transform.maxZoom},n=new P(Ft(),null),r=Mt("mock-dem",e,n,t.style);super("mock-dem",r,!1),r.setEventedParent(this),this._sourceLoaded=!0}_loadTile(t,e){t.state="loaded",e(null)}}class bn extends t.SourceCache{constructor(t){const e=Mt("proxy",{type:"geojson",maxzoom:t.transform.maxZoom},new P(Ft(),null),t.style);super("proxy",e,!1),e.setEventedParent(this),this.map=this.getSource().map=t,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,n,r){if(e.freezeTileCoverage)return;this.transform=e;const i=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((n,r)=>{if(n[r.key]="",!this._tiles[r.key]){const n=new t.Tile(r,this._source.tileSize*r.overscaleFactor(),e.tileZoom);n.state="loaded",this._tiles[r.key]=n}return n},{});for(const t in this._tiles)t in i||(this.freeFBO(t),this._tiles[t].unloadVectorData(),delete this._tiles[t])}freeFBO(t){const e=this.proxyCachedFBO[t];if(void 0!==e){const n=Object.values(e);this.renderCachePool.push(...n),delete this.proxyCachedFBO[t]}}deallocRenderCache(){this.renderCache.forEach(t=>t.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class xn extends t.OverscaledTileID{constructor(t,e,n){super(t.overscaledZ,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y),this.proxyTileKey=e,this.projMatrix=n}}class wn extends t.Elevation{constructor(e,n){super(),this.painter=e,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[r,i,o]=function(e){const n=new t.StructArrayLayout4i8,r=new t.StructArrayLayout3ui6,i=131;n.reserve(17161),r.reserve(33800);const o=t.EXTENT/128,s=t.EXTENT+o/2,a=s+o;for(let l=-o;l<a;l+=o)for(let e=-o;e<a;e+=o){const r=e<0||e>s||l<0||l>s?24575:0,i=t.clamp(Math.round(e),0,t.EXTENT),o=t.clamp(Math.round(l),0,t.EXTENT);n.emplaceBack(i+r,o,i,o)}const c=(t,e)=>{const n=e*i+t;r.emplaceBack(n+1,n,n+i),r.emplaceBack(n+i,n+i+1,n+1)};for(let t=1;t<129;t++)for(let e=1;e<129;e++)c(e,t);return[0,129].forEach(t=>{for(let e=0;e<130;e++)c(e,t),c(t,e)}),[n,r,32768]}(),s=e.context;this.gridBuffer=s.createVertexBuffer(r,t.boundsAttributes.members),this.gridIndexBuffer=s.createIndexBuffer(i),this.gridSegments=t.SegmentVector.simpleSegment(0,0,r.length,i.length),this.gridNoSkirtSegments=t.SegmentVector.simpleSegment(0,0,r.length,o),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new bn(n.map),this.orthoMatrix=t.create(),t.ortho(this.orthoMatrix,0,t.EXTENT,0,t.EXTENT,0,1);const a=s.gl;this._overlapStencilMode=new t.StencilMode({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=e.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=n,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new vn(n.map)}set style(t){t.on("data",this._onStyleDataEvent.bind(this)),t.on("neworder",this._checkRenderCacheEfficiency.bind(this)),this._style=t,this._checkRenderCacheEfficiency()}update(e,n,r){if(e&&e.terrain){this._style!==e&&(this.style=e),this.enabled=!0;const i=e.terrain.properties;this.sourceCache=0===e.terrain.drapeRenderMode?this._mockSourceCache:e._getSourceCache(i.get("source")),this._exaggeration=i.get("exaggeration");const o=()=>{this.sourceCache.used&&t.warnOnce(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const e=this.getScaledDemTileSize();this.sourceCache.update(n,e,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,o(),this._initializing=!0),o(),n.updateElevation(!r),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(n),this._emptyDEMTextureDirty=!0}else this._disable()}resetTileLookupCache(t){this._findCoveringTileCache[t]={}}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_checkRenderCacheEfficiency(){const e=this.renderCacheEfficiency(this._style);this._style.map._optimizeForTerrain||100!==e.efficiency&&t.warnOnce(`Terrain render cache efficiency is not optimal (${e.efficiency}%) and performance\n                may be affected negatively, consider placing all background, fill and line layers before layer\n                with id '${e.firstUndrapedLayer}' or create a map using optimizeForTerrain: true option.`)}_onStyleDataEvent(t){t.coord&&"source"===t.dataType?this._clearRenderCacheForTile(t.sourceCacheId,t.coord):"style"===t.dataType&&(this._invalidateRenderCache=!0)}_disable(){if(this.enabled&&(this.enabled=!1,this._sharedDepthStencil=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const t in this._style._sourceCaches)this._style._sourceCaches[t].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this._emptyDepthBufferTexture&&this._emptyDepthBufferTexture.destroy(),this.pool.forEach(t=>t.fb.destroy()),this.pool=[],this._depthFBO&&(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0)}_source(){return this.enabled?this.sourceCache:null}exaggeration(){return this._exaggeration}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const t=2*this.proxySourceCache.getSource().tileSize;return[t,t]}set useVertexMorphing(t){this._useVertexMorphing=t}updateTileBinding(e){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const n=this.proxySourceCache,r=this.painter.transform;this._initializing&&(this._initializing=0===r._centerAltitude&&-1===this.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(r.center),-1),this._emptyDEMTextureDirty=!this._initializing);const i=this.proxyCoords=n.getIds().map(t=>{const e=n.getTileByID(t).tileID;return e.projMatrix=r.calculateProjMatrix(e.toUnwrapped()),e});!function(e,n){const r=n.transform.pointCoordinate(n.transform.getCameraPoint()),i=new t.pointGeometry(r.x,r.y);e.sort((e,n)=>{if(n.overscaledZ-e.overscaledZ)return n.overscaledZ-e.overscaledZ;const r=new t.pointGeometry(e.canonical.x+(1<<e.canonical.z)*e.wrap,e.canonical.y),o=new t.pointGeometry(n.canonical.x+(1<<n.canonical.z)*n.wrap,n.canonical.y),s=i.mult(1<<e.canonical.z);return s.x-=.5,s.y-=.5,s.distSqr(r)-s.distSqr(o)})}(i,this.painter),this._previousZoom=r.zoom;const o=this.proxyToSource||{};this.proxyToSource={},i.forEach(t=>{this.proxyToSource[t.key]={}}),this.terrainTileForTile={};const s=this._style._sourceCaches;for(const t in s){const n=s[t];if(!n.used)continue;if(n!==this.sourceCache&&this.resetTileLookupCache(n.id),this._setupProxiedCoordsForOrtho(n,e[t],o),n.usedForTerrain)continue;const r=e[t];n.getSource().reparseOverscaled&&this._assignTerrainTiles(r)}this.proxiedCoords[n.id]=i.map(t=>new xn(t,t.key,this.orthoMatrix)),this._assignTerrainTiles(i),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(o),this.renderingToTexture=!1,this._updateTimestamp=t.exported.now();const a={};this._visibleDemTiles=[];for(const t of this.proxyCoords){const e=this.terrainTileForTile[t.key];if(!e)continue;const n=e.tileID.key;n in a||(this._visibleDemTiles.push(e),a[n]=n)}}_assignTerrainTiles(t){this._initializing||t.forEach(t=>{if(this.terrainTileForTile[t.key])return;const e=this._findTileCoveringTileID(t,this.sourceCache);e&&(this.terrainTileForTile[t.key]=e)})}_prepareDEMTextures(){const t=this.painter.context,e=t.gl;for(const n in this.terrainTileForTile){const r=this.terrainTileForTile[n],i=r.dem;!i||r.demTexture&&!r.needsDEMTextureUpload||(t.activeTexture.set(e.TEXTURE1),an(this.painter,r,i))}}_prepareDemTileUniforms(t,e,n,r){if(!e||null==e.demTexture)return!1;const i=t.tileID.canonical,o=Math.pow(2,e.tileID.canonical.z-i.z),s=r||"";return n[`u_dem_tl${s}`]=[i.x*o%1,i.y*o%1],n[`u_dem_scale${s}`]=o,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}get emptyDepthBufferTexture(){const e=this.painter.context,n=e.gl;if(!this._emptyDepthBufferTexture){const r=new t.RGBAImage({width:1,height:1},Uint8Array.of(255,255,255,255));this._emptyDepthBufferTexture=new t.Texture(e,r,n.RGBA,{premultiply:!1})}return this._emptyDepthBufferTexture}_getLoadedAreaMinimum(){let t=0;const e=this._visibleDemTiles.reduce((e,n)=>{if(!n.dem)return e;const r=n.dem.tree.minimums[0];return r>0&&t++,e+r},0);return t?e/t:0}_updateEmptyDEMTexture(){const e=this.painter.context,n=e.gl;e.activeTexture.set(n.TEXTURE2);const r=this._getLoadedAreaMinimum(),i=new t.RGBAImage({width:1,height:1},new Uint8Array(t.DEMData.pack(r,this.sourceCache.getSource().encoding)));this._emptyDEMTextureDirty=!1;let o=this._emptyDEMTexture;return o?o.update(i,{premultiply:!1}):o=this._emptyDEMTexture=new t.Texture(e,i,n.RGBA,{premultiply:!1}),o}setupElevationDraw(e,n,r){const i=this.painter.context,o=i.gl,s=(a=this.sourceCache.getSource().encoding,{u_dem:2,u_dem_prev:4,u_dem_unpack:t.DEMData.getUnpackVector(a),u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_exaggeration:0,u_tile_tl_up:[0,0,1],u_tile_tr_up:[0,0,1],u_tile_br_up:[0,0,1],u_tile_bl_up:[0,0,1],u_tile_up_scale:1});var a;s.u_dem_size=this.sourceCache.getSource().tileSize,s.u_exaggeration=this.exaggeration();const c=this.painter.transform,l=c.projection,u=e.tileID.canonical;s.u_tile_tl_up=l.upVector(u,0,0),s.u_tile_tr_up=l.upVector(u,t.EXTENT,0),s.u_tile_br_up=l.upVector(u,t.EXTENT,t.EXTENT),s.u_tile_bl_up=l.upVector(u,0,t.EXTENT),s.u_tile_up_scale=r&&r.useDenormalizedUpVectorScale?yn:l.upVectorScale(u,c.center.lat,c.worldSize).metersToTile;let h=null,d=null,p=1;if(r&&r.morphing&&this._useVertexMorphing){const t=r.morphing.srcDemTile,n=r.morphing.dstDemTile;p=r.morphing.phase,t&&n&&(this._prepareDemTileUniforms(e,t,s,"_prev")&&(d=t),this._prepareDemTileUniforms(e,n,s)&&(h=n))}if(d&&h?(i.activeTexture.set(o.TEXTURE2),h.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),i.activeTexture.set(o.TEXTURE4),d.demTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE,o.NEAREST),s.u_dem_lerp=p):(h=this.terrainTileForTile[e.tileID.key],i.activeTexture.set(o.TEXTURE2),(this._prepareDemTileUniforms(e,h,s)?h.demTexture:this.emptyDEMTexture).bind(o.NEAREST,o.CLAMP_TO_EDGE)),i.activeTexture.set(o.TEXTURE3),r&&r.useDepthForOcclusion?(this._depthTexture&&this._depthTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),this._depthFBO&&(s.u_depth_size_inv=[1/this._depthFBO.width,1/this._depthFBO.height])):(this.emptyDepthBufferTexture.bind(o.NEAREST,o.CLAMP_TO_EDGE),s.u_depth_size_inv=[1,1]),r&&r.useMeterToDem&&h){const e=(1<<h.tileID.canonical.z)*t.mercatorZfromAltitude(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;s.u_meter_to_dem=e}r&&r.labelPlaneMatrixInv&&(s.u_label_plane_matrix_inv=r.labelPlaneMatrixInv),n.setTerrainUniformValues(i,s)}renderToBackBuffer(e){const n=this.painter,r=this.painter.context;0!==e.length&&(r.bindFramebuffer.set(null),r.viewport.set([0,0,n.width,n.height]),this.renderingToTexture=!1,function(e,n,r,i,o){if("globe"===e.transform.projection.name)!function(e,n,r,i,o){const s=e.context,a=s.gl;let c,l;const u=e.options.showTerrainWireframe?2:0,h=(t,n)=>{if(l===t)return;const r=[fn[t],"PROJECTION_GLOBE_VIEW"];n&&r.push(fn[u]),c=e.useProgram("globeRaster",null,r),l=t},d=e.colorModeForRenderPass(),p=new t.DepthMode(a.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);pn.update(o);const f=e.transform,m=t.calculateGlobeMercatorMatrix(f),g=[t.mercatorXfromLng(f.center.lng),t.mercatorYfromLat(f.center.lat)],_=e.globeSharedBuffers;if((u?[!1,!0]:[!1]).forEach(u=>{l=-1;const y=u?a.LINES:a.TRIANGLES;for(const l of i){const i=r.getTile(l),v=t.StencilMode.disabled,b=n.prevTerrainTileForTile[l.key],x=n.terrainTileForTile[l.key];dn(b,x)&&pn.newMorphing(l.key,b,x,o,250),s.activeTexture.set(a.TEXTURE0),i.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const w=pn.getMorphValuesForProxy(l.key),T=w?1:0,C={useDenormalizedUpVectorScale:!0};w&&t.extend$1(C,{morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:t.easeCubicInOut(w.phase)}});const E=Float32Array.from(f.globeMatrix),S=t.globeTileLatLngCorners(l.canonical),I=t.getGridMatrix(l.canonical,S),k=hn(f.projMatrix,E,m,t.globeToMercatorTransition(f.zoom),g,I);if(h(T,u),n.setupElevationDraw(i,c,C),e.prepareDrawProgram(s,c,l.toUnwrapped()),_){const[n,r,i]=u?_.getWirefameBuffers(e.context):_.getGridBuffers();c.draw(s,y,p,v,d,t.CullFaceMode.backCCW,k,"globe_raster",n,r,i)}}}),_){c=e.useProgram("globeRaster",null,["GLOBE_POLES","PROJECTION_GLOBE_VIEW"]);for(const o of i){const{x:i,y:l,z:u}=o.canonical,h=0===l,m=l===(1<<u)-1,[y,v,b,x]=_.getPoleBuffers(u);if(x&&(h||m)){const l=r.getTile(o);s.activeTexture.set(a.TEXTURE0),l.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let _=t.globePoleMatrixForTile(u,i,f);const w=(e,n)=>e.draw(s,a.TRIANGLES,p,t.StencilMode.disabled,d,t.CullFaceMode.disabled,hn(f.projMatrix,_,_,0,g),"globe_pole_raster",n,b,x);n.setupElevationDraw(l,c,{}),e.prepareDrawProgram(s,c,o.toUnwrapped()),h&&w(c,y),m&&(_=t.scale(t.create(),_,[1,-1,1]),w(c,v))}}}}(e,n,r,i,o);else{const s=e.context,a=s.gl;let c,l;const u=e.options.showTerrainWireframe?2:0,h=(t,n)=>{if(l===t)return;const r=[fn[t]];n&&r.push(fn[u]),c=e.useProgram("terrainRaster",null,r),l=t},d=e.colorModeForRenderPass(),p=new t.DepthMode(a.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);pn.update(o);const f=e.transform,m=6*Math.pow(1.5,22-f.zoom)*n.exaggeration();(u?[!1,!0]:[!1]).forEach(u=>{l=-1;const g=u?a.LINES:a.TRIANGLES,[_,y]=u?n.getWirefameBuffer():[n.gridIndexBuffer,n.gridSegments];for(const l of i){const i=r.getTile(l),v=t.StencilMode.disabled,b=n.prevTerrainTileForTile[l.key],x=n.terrainTileForTile[l.key];dn(b,x)&&pn.newMorphing(l.key,b,x,o,250),s.activeTexture.set(a.TEXTURE0),i.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE,a.LINEAR_MIPMAP_NEAREST);const w=pn.getMorphValuesForProxy(l.key),T=w?1:0;let C;w&&(C={morphing:{srcDemTile:w.from,dstDemTile:w.to,phase:t.easeCubicInOut(w.phase)}});const E=un(l.projMatrix,mn(l.canonical,f.renderWorldCopies)?m/10:m);h(T,u),n.setupElevationDraw(i,c,C),e.prepareDrawProgram(s,c,l.toUnwrapped()),c.draw(s,g,p,v,d,t.CullFaceMode.backCCW,E,"terrain_raster",n.gridBuffer,_,y)}})}}(n,this,this.proxySourceCache,e,this._updateTimestamp),this.renderingToTexture=!0,e.splice(0,e.length))}renderBatch(e){if(0===this._drapedRenderBatches.length)return e+1;this.renderingToTexture=!0;const n=this.painter,r=this.painter.context,i=this.proxySourceCache,o=this.proxiedCoords[i.id],s=this._drapedRenderBatches.shift(),a=[],c=n.style.order;let l=0;for(const u of o){const o=i.getTileByID(u.proxyTileKey),h=i.proxyCachedFBO[u.key]?i.proxyCachedFBO[u.key][e]:void 0,d=void 0!==h?i.renderCache[h]:this.pool[l++],p=void 0!==h;if(o.texture=d.tex,p&&!d.dirty){a.push(o.tileID);continue}let f;r.bindFramebuffer.set(d.fb.framebuffer),this.renderedToTile=!1,d.dirty&&(r.clear({color:t.Color.transparent,stencil:0}),d.dirty=!1);for(let t=s.start;t<=s.end;++t){const e=n.style._layers[c[t]];if(e.isHidden(n.transform.zoom))continue;const i=n.style._getLayerSourceCache(e),o=i?this.proxyToSource[u.key][i.id]:[u];if(!o)continue;const s=o;r.viewport.set([0,0,d.fb.width,d.fb.height]),f!==(i?i.id:null)&&(this._setupStencil(d,o,e,i),f=i?i.id:null),n.renderLayer(n,i,e,s)}this.renderedToTile?(d.dirty=!0,a.push(o.tileID)):p||--l,5===l&&(l=0,this.renderToBackBuffer(a))}return this.renderToBackBuffer(a),this.renderingToTexture=!1,r.bindFramebuffer.set(null),r.viewport.set([0,0,n.width,n.height]),s.end+1}postRender(){}renderCacheEfficiency(t){const e=t.order.length;if(0===e)return{efficiency:100};let n,r=0,i=0,o=!1;for(let s=0;s<e;++s){const e=t._layers[t.order[s]];this._style.isLayerDraped(e)?(o&&++r,++i):o||(o=!0,n=e.id)}return 0===i?{efficiency:100}:{efficiency:100*(1-r/i),firstUndrapedLayer:n}}getMinElevationBelowMSL(){let t=0;return this._visibleDemTiles.filter(t=>t.dem).forEach(e=>{t=Math.min(t,e.dem.tree.minimums[0])}),0===t?t:(t-30)*this._exaggeration}raycast(t,e,n){if(!this._visibleDemTiles)return null;const r=this._visibleDemTiles.filter(t=>t.dem).map(r=>{const i=r.tileID,o=Math.pow(2,i.overscaledZ),{x:s,y:a}=i.canonical,c=s/o,l=(s+1)/o,u=a/o,h=(a+1)/o;return{minx:c,miny:u,maxx:l,maxy:h,t:r.dem.tree.raycastRoot(c,u,l,h,t,e,n),tile:r}});r.sort((t,e)=>(null!==t.t?t.t:Number.MAX_VALUE)-(null!==e.t?e.t:Number.MAX_VALUE));for(const i of r){if(null==i.t)return null;const r=i.tile.dem.tree.raycast(i.minx,i.miny,i.maxx,i.maxy,t,e,n);if(null!=r)return r}return null}_createFBO(){const e=this.painter.context,n=e.gl,r=this.drapeBufferSize;e.activeTexture.set(n.TEXTURE0);const i=new t.Texture(e,{width:r[0],height:r[1],data:null},n.RGBA);i.bind(n.LINEAR,n.CLAMP_TO_EDGE);const o=e.createFramebuffer(r[0],r[1],!1);return o.colorAttachment.set(i.texture),o.depthAttachment=new wt(e,o.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=e.createRenderbuffer(e.gl.DEPTH_STENCIL,r[0],r[1]),this._stencilRef=0,o.depthAttachment.set(this._sharedDepthStencil),e.clear({stencil:0})):o.depthAttachment.set(this._sharedDepthStencil),e.extTextureFilterAnisotropic&&!e.extTextureFilterAnisotropicForceOff&&n.texParameterf(n.TEXTURE_2D,e.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,e.extTextureFilterAnisotropicMax),{fb:o,tex:i,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._style.light&&this._style.light.hasTransition())return!0;for(const t in this._style._sourceCaches)if(this._style._sourceCaches[t].hasTransition())return!0;return this._style.order.some(t=>{const e=this._style._layers[t],n=e.isHidden(this.painter.transform.zoom),r=e.getCrossfadeParameters(),i=!!r&&1!==r.t,o=e.hasTransition();return"custom"!==e.type&&!n&&(i||o)})}_clearRasterFadeFromRenderCache(){let t=!1;for(const e in this._style._sourceCaches)if(this._style._sourceCaches[e]._source instanceof Et){t=!0;break}if(t)for(let e=0;e<this._style.order.length;++e){const t=this._style._layers[this._style.order[e]],n=t.isHidden(this.painter.transform.zoom),r=this._style._getLayerSourceCache(t);if("raster"!==t.type||n||!r)continue;const i=t.paint.get("raster-fade-duration");for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][r.id];if(t)for(const e of t){const t=_n(r.getTile(e),r.findLoadedParent(e,0),r,this.painter.transform,i);(1!==t.opacity||0!==t.mix)&&this._clearRenderCacheForTile(r.id,e)}}}}_setupDrapedRenderBatches(){const t=this._style.order,e=t.length;if(0===e)return;const n=[];let r,i=0,o=this._style._layers[t[i]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++i<e;)o=this._style._layers[t[i]];for(;i<e;++i){const e=this._style._layers[t[i]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===r&&(r=i):void 0!==r&&(n.push({start:r,end:i-1}),r=void 0))}void 0!==r&&n.push({start:r,end:i-1}),this._drapedRenderBatches=n}_setupRenderCache(t){const e=this.proxySourceCache;if(this._shouldDisableRenderCache()||this._invalidateRenderCache){if(this._invalidateRenderCache=!1,e.renderCache.length>e.renderCachePool.length){const t=Object.values(e.proxyCachedFBO);e.proxyCachedFBO={};for(let n=0;n<t.length;++n){const r=Object.values(t[n]);e.renderCachePool.push(...r)}}return}this._clearRasterFadeFromRenderCache();const n=this.proxyCoords,r=this._tilesDirty;for(let o=n.length-1;o>=0;o--){const i=n[o];if(e.getTileByID(i.key),void 0!==e.proxyCachedFBO[i.key]){const n=t[i.key],o=this.proxyToSource[i.key];let s=0;for(const t in o){const e=o[t],i=n[t];if(!i||i.length!==e.length||e.some((e,n)=>e!==i[n]||r[t]&&r[t].hasOwnProperty(e.key))){s=-1;break}++s}for(const t in e.proxyCachedFBO[i.key])e.renderCache[e.proxyCachedFBO[i.key][t]].dirty=s<0||s!==Object.values(n).length}}const i=[...this._drapedRenderBatches];i.sort((t,e)=>e.end-e.start-(t.end-t.start));for(const o of i)for(const t of n){if(e.proxyCachedFBO[t.key])continue;let n=e.renderCachePool.pop();void 0===n&&e.renderCache.length<50&&(n=e.renderCache.length,e.renderCache.push(this._createFBO())),void 0!==n&&(e.proxyCachedFBO[t.key]={},e.proxyCachedFBO[t.key][o.start]=n,e.renderCache[n].dirty=!0)}this._tilesDirty={}}_setupStencil(t,e,n,r){if(!r||!this._sourceTilesOverlap[r.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const i=this.painter.context,o=i.gl;if(e.length<=1)return void(this._overlapStencilType=!1);let s;if(n.isTileClipped())s=e.length,this._overlapStencilMode.test={func:o.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(e[0].overscaledZ>e[e.length-1].overscaledZ))return void(this._overlapStencilType=!1);s=1,this._overlapStencilMode.test={func:o.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+s>255&&(i.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=s,this._overlapStencilMode.ref=this._stencilRef,n.isTileClipped()&&this._renderTileClippingMasks(e,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs.get(e.key)||0),this._overlapStencilMode):t.StencilMode.disabled}_renderTileClippingMasks(e,n){const r=this.painter,i=this.painter.context,o=i.gl;r._tileClippingMaskIDs.clear(),i.setColorMode(t.ColorMode.disabled),i.setDepthMode(t.DepthMode.disabled);const s=r.useProgram("clippingMask");for(const a of e){const e=--n;r._tileClippingMaskIDs.set(a.key,e),s.draw(i,o.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:o.ALWAYS,mask:0},e,255,o.KEEP,o.KEEP,o.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,gn(a.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(e){const n=this.painter.transform;if(e.x<0||e.x>n.width||e.y<0||e.y>n.height)return null;const r=[e.x,e.y,1,1];t.transformMat4$1(r,r,n.pixelMatrixInverse),t.scale$1(r,r,1/r[3]),r[0]/=n.worldSize,r[1]/=n.worldSize;const i=n._camera.position,o=t.mercatorZfromAltitude(1,n.center.lat),s=[i[0],i[1],i[2]/o,0],a=t.subtract([],r.slice(0,3),s);t.normalize(a,a);const c=this.raycast(s,a,this._exaggeration);return null!==c&&c?(t.scaleAndAdd(s,s,a,c),s[3]=s[2],s[2]*=o,s):null}drawDepth(){const e=this.painter,n=e.context,r=this.proxySourceCache,i=Math.ceil(e.width),o=Math.ceil(e.height);if(!this._depthFBO||this._depthFBO.width===i&&this._depthFBO.height===o||(this._depthFBO.destroy(),this._depthFBO=void 0,this._depthTexture=void 0),!this._depthFBO){const e=n.gl,r=n.createFramebuffer(i,o,!0);n.activeTexture.set(e.TEXTURE0);const s=new t.Texture(n,{width:i,height:o,data:null},e.RGBA);s.bind(e.NEAREST,e.CLAMP_TO_EDGE),r.colorAttachment.set(s.texture);const a=n.createRenderbuffer(n.gl.DEPTH_COMPONENT16,i,o);r.depthAttachment.set(a),this._depthFBO=r,this._depthTexture=s}n.bindFramebuffer.set(this._depthFBO.framebuffer),n.viewport.set([0,0,i,o]),function(e,n,r,i){if("globe"===e.transform.projection.name)return;const o=e.context,s=o.gl;o.clear({depth:1});const a=e.useProgram("terrainDepth"),c=new t.DepthMode(s.LESS,t.DepthMode.ReadWrite,e.depthRangeFor3D);for(const l of i){const e=r.getTile(l),i=un(l.projMatrix,0);n.setupElevationDraw(e,a),a.draw(o,s.TRIANGLES,c,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.backCCW,i,"terrain_depth",n.gridBuffer,n.gridIndexBuffer,n.gridNoSkirtSegments)}}(e,this,r,this.proxyCoords)}_setupProxiedCoordsForOrtho(t,e,n){if(t.getSource()instanceof kt)return this._setupProxiedCoordsForImageSource(t,e,n);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const r=this.proxiedCoords[t.id]=[],i=this.proxyCoords;for(let s=0;s<i.length;s++){const e=i[s],o=this._findTileCoveringTileID(e,t);if(o){const i=this._createProxiedId(e,o,n[e.key]&&n[e.key][t.id]);r.push(i),this.proxyToSource[e.key][t.id]=[i]}}let o=!1;for(let s=0;s<e.length;s++){const i=t.getTile(e[s]);if(!i||!i.hasData())continue;const a=this._findTileCoveringTileID(i.tileID,this.proxySourceCache);if(a&&a.tileID.canonical.z!==i.tileID.canonical.z){const e=this.proxyToSource[a.tileID.key][t.id],s=this._createProxiedId(a.tileID,i,n[a.tileID.key]&&n[a.tileID.key][t.id]);e?e.splice(e.length-1,0,s):this.proxyToSource[a.tileID.key][t.id]=[s],r.push(s),o=!0}}this._sourceTilesOverlap[t.id]=o}_setupProxiedCoordsForImageSource(e,n,r){if(!e.getSource().loaded())return;const i=this.proxiedCoords[e.id]=[],o=this.proxyCoords,s=e.getSource(),a=new t.pointGeometry(s.tileID.x,s.tileID.y)._div(1<<s.tileID.z),c=s.coordinates.map(t.MercatorCoordinate.fromLngLat).reduce((t,e)=>(t.min.x=Math.min(t.min.x,e.x-a.x),t.min.y=Math.min(t.min.y,e.y-a.y),t.max.x=Math.max(t.max.x,e.x-a.x),t.max.y=Math.max(t.max.y,e.y-a.y),t),{min:new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE),max:new t.pointGeometry(-Number.MAX_VALUE,-Number.MAX_VALUE)}),l=(e,n)=>{const r=e.wrap+e.canonical.x/(1<<e.canonical.z),i=e.canonical.y/(1<<e.canonical.z),o=t.EXTENT/(1<<e.canonical.z),s=n.wrap+n.canonical.x/(1<<n.canonical.z),a=n.canonical.y/(1<<n.canonical.z);return r+o<s+c.min.x||r>s+c.max.x||i+o<a+c.min.y||i>a+c.max.y};for(let t=0;t<o.length;t++){const s=o[t];for(let t=0;t<n.length;t++){const o=e.getTile(n[t]);if(!o||!o.hasData())continue;if(l(s,o.tileID))continue;const a=this._createProxiedId(s,o,r[s.key]&&r[s.key][e.id]),c=this.proxyToSource[s.key][e.id];c?c.push(a):this.proxyToSource[s.key][e.id]=[a],i.push(a)}}}_createProxiedId(e,n,r){let i=this.orthoMatrix;if(r){const t=r.find(t=>t.key===n.tileID.key);if(t)return t}if(n.tileID.key!==e.key){const r=e.canonical.z-n.tileID.canonical.z;let o,s,a;i=t.create();const c=n.tileID.wrap-e.wrap<<e.overscaledZ;r>0?(o=t.EXTENT>>r,s=o*((n.tileID.canonical.x<<r)-e.canonical.x+c),a=o*((n.tileID.canonical.y<<r)-e.canonical.y)):(o=t.EXTENT<<-r,s=t.EXTENT*(n.tileID.canonical.x-(e.canonical.x+c<<-r)),a=t.EXTENT*(n.tileID.canonical.y-(e.canonical.y<<-r))),t.ortho(i,0,o,0,o,0,1),t.translate(i,i,[s,a,0])}return new xn(n.tileID,e.key,i)}_findTileCoveringTileID(e,n){let r=n.getTile(e);if(r&&r.hasData())return r;const i=this._findCoveringTileCache[n.id],o=i[e.key];if(r=o?n.getTileByID(o):null,r&&r.hasData()||null===o)return r;let s=r?r.tileID:e,a=s.overscaledZ;const c=n.getSource().minzoom,l=[];if(!o){const i=n.getSource().maxzoom;if(e.canonical.z>=i){const r=e.canonical.z-i;n.getSource().reparseOverscaled?(a=Math.max(e.canonical.z+2,n.transform.tileZoom),s=new t.OverscaledTileID(a,e.wrap,i,e.canonical.x>>r,e.canonical.y>>r)):0!==r&&(a=i,s=new t.OverscaledTileID(a,e.wrap,i,e.canonical.x>>r,e.canonical.y>>r))}s.key!==e.key&&(l.push(s.key),r=n.getTile(s))}const u=t=>{l.forEach(e=>{i[e]=t}),l.length=0};for(a-=1;a>=c&&(!r||!r.hasData());a--){r&&u(r.tileID.key);const t=s.calculateScaledKey(a);if(r=n.getTileByID(t),r&&r.hasData())break;const e=i[t];if(null===e)break;void 0===e?l.push(t):r=n.getTileByID(e)}return u(r?r.tileID.key:null),r&&r.hasData()?r:null}findDEMTileFor(t){return this.enabled?this._findTileCoveringTileID(t,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(t,e){let n=this._tilesDirty[t];n||(n=this._tilesDirty[t]={}),n[e.key]=!0}getWirefameBuffer(){if(!this.wireframeSegments){const e=function(e){let n=0;const r=new t.StructArrayLayout2ui4,i=131;for(let t=1;t<129;t++){for(let e=1;e<129;e++)n=t*i+e,r.emplaceBack(n,n+1),r.emplaceBack(n,n+i),r.emplaceBack(n+1,n+i),128===t&&r.emplaceBack(n+i,n+i+1);r.emplaceBack(n+1,n+1+i)}return r}();this.wireframeIndexBuffer=this.painter.context.createIndexBuffer(e),this.wireframeSegments=t.SegmentVector.simpleSegment(0,0,this.gridBuffer.length,e.length)}return[this.wireframeIndexBuffer,this.wireframeSegments]}}function Tn(t){const e=[];for(let n=0;n<t.length;n++){if(null===t[n])continue;const r=t[n].split(" ");e.push(r.pop())}return e}class Cn{static cacheKey(t,e,n){let r=`${t}${n?n.cacheKey:""}`;for(const i of e)r+=`/${i}`;return r}constructor(e,n,r,i,o,s){const a=e.gl;this.program=a.createProgram();const c=Tn(r.staticAttributes),l=i?i.getBinderAttributes():[],u=c.concat(l),h=r.staticUniforms?Tn(r.staticUniforms):[],d=i?i.getBinderUniforms():[],p=h.concat(d),f=[];for(const t of p)f.indexOf(t)<0&&f.push(t);let m=i?i.defines():[];m=m.concat(s.map(t=>`#define ${t}`));const g=m.concat("\n#ifdef GL_ES\nprecision mediump float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",tn,Je.fragmentSource,Qe.fragmentSource,r.fragmentSource).join("\n"),_=m.concat("\n#ifdef GL_ES\nprecision highp float;\n#else\n\n#if !defined(lowp)\n#define lowp\n#endif\n\n#if !defined(mediump)\n#define mediump\n#endif\n\n#if !defined(highp)\n#define highp\n#endif\n\n#endif",tn,Je.vertexSource,Qe.vertexSource,Ye.vertexSource,r.vertexSource).join("\n"),y=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(y,g),a.compileShader(y),a.attachShader(this.program,y);const v=a.createShader(a.VERTEX_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(v,_),a.compileShader(v),a.attachShader(this.program,v),this.attributes={};const b={};this.numAttributes=u.length;for(let t=0;t<this.numAttributes;t++)u[t]&&(a.bindAttribLocation(this.program,t,u[t]),this.attributes[u[t]]=t);a.linkProgram(this.program),a.deleteShader(v),a.deleteShader(y);for(let t=0;t<f.length;t++){const e=f[t];if(e&&!b[e]){const t=a.getUniformLocation(this.program,e);t&&(b[e]=t)}}this.fixedUniforms=o(e,b),this.binderUniforms=i?i.getUniforms(e,b):[],-1!==s.indexOf("TERRAIN")&&(this.terrainUniforms=((e,n)=>({u_dem:new t.Uniform1i(e,n.u_dem),u_dem_prev:new t.Uniform1i(e,n.u_dem_prev),u_dem_unpack:new t.Uniform4f(e,n.u_dem_unpack),u_dem_tl:new t.Uniform2f(e,n.u_dem_tl),u_dem_scale:new t.Uniform1f(e,n.u_dem_scale),u_dem_tl_prev:new t.Uniform2f(e,n.u_dem_tl_prev),u_dem_scale_prev:new t.Uniform1f(e,n.u_dem_scale_prev),u_dem_size:new t.Uniform1f(e,n.u_dem_size),u_dem_lerp:new t.Uniform1f(e,n.u_dem_lerp),u_exaggeration:new t.Uniform1f(e,n.u_exaggeration),u_depth:new t.Uniform1i(e,n.u_depth),u_depth_size_inv:new t.Uniform2f(e,n.u_depth_size_inv),u_meter_to_dem:new t.Uniform1f(e,n.u_meter_to_dem),u_label_plane_matrix_inv:new t.UniformMatrix4f(e,n.u_label_plane_matrix_inv),u_tile_tl_up:new t.Uniform3f(e,n.u_tile_tl_up),u_tile_tr_up:new t.Uniform3f(e,n.u_tile_tr_up),u_tile_br_up:new t.Uniform3f(e,n.u_tile_br_up),u_tile_bl_up:new t.Uniform3f(e,n.u_tile_bl_up),u_tile_up_scale:new t.Uniform1f(e,n.u_tile_up_scale)}))(e,b)),-1!==s.indexOf("FOG")&&(this.fogUniforms=((e,n)=>({u_fog_matrix:new t.UniformMatrix4f(e,n.u_fog_matrix),u_fog_range:new t.Uniform2f(e,n.u_fog_range),u_fog_color:new t.Uniform4f(e,n.u_fog_color),u_fog_horizon_blend:new t.Uniform1f(e,n.u_fog_horizon_blend),u_fog_temporal_offset:new t.Uniform1f(e,n.u_fog_temporal_offset)}))(e,b))}setTerrainUniformValues(t,e){if(!this.terrainUniforms)return;const n=this.terrainUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)n[t].set(e[t])}}setFogUniformValues(t,e){if(!this.fogUniforms)return;const n=this.fogUniforms;if(!this.failedToCreate){t.program.set(this.program);for(const t in e)n[t].location&&n[t].set(e[t])}}draw(t,e,n,r,i,o,s,a,c,l,u,h,d,p,f,m){const g=t.gl;if(this.failedToCreate)return;t.program.set(this.program),t.setDepthMode(n),t.setStencilMode(r),t.setColorMode(i),t.setCullFace(o);for(const y of Object.keys(this.fixedUniforms))this.fixedUniforms[y].set(s[y]);p&&p.setUniforms(t,this.binderUniforms,h,{zoom:d});const _={[g.LINES]:2,[g.TRIANGLES]:3,[g.LINE_STRIP]:1}[e];for(const y of u.get()){const n=y.vaos||(y.vaos={});(n[a]||(n[a]=new rn)).bind(t,this,c,p?p.getPaintVertexBuffers():[],l,y.vertexOffset,f,m),g.drawElements(e,y.primitiveLength*_,g.UNSIGNED_SHORT,y.primitiveOffset*_*2)}}}function En(t,e,n){const r=1/D(n,1,e.transform.tileZoom),i=Math.pow(2,n.tileID.overscaledZ),o=n.tileSize*Math.pow(2,e.transform.tileZoom)/i,s=o*(n.tileID.canonical.x+n.tileID.wrap*i),a=o*n.tileID.canonical.y;return{u_image:0,u_texsize:n.imageAtlasTexture.size,u_scale:[r,t.fromScale,t.toScale],u_fade:t.t,u_pixel_coord_upper:[s>>16,a>>16],u_pixel_coord_lower:[65535&s,65535&a]}}const Sn=t.create(),In=(e,n,r,i,o,s,a,c,l)=>{const u=n.style.light,h=u.properties.get("position"),d=[h.x,h.y,h.z],p=t.create$1();"viewport"===u.properties.get("anchor")&&(t.fromRotation(p,-n.transform.angle),t.transformMat3(d,d,p));const f=u.properties.get("color"),m=n.transform,g={u_matrix:e,u_lightpos:d,u_lightintensity:u.properties.get("intensity"),u_lightcolor:[f.r,f.g,f.b],u_vertical_gradient:+r,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Sn,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0};return"globe"===m.projection.name&&(g.u_tile_id=[o.canonical.x,o.canonical.y,1<<o.canonical.z],g.u_zoom_transition=a,g.u_inv_rot_matrix=l,g.u_merc_center=c,g.u_up_dir=m.projection.upVector(new t.CanonicalTileID(0,0,0),c[0]*t.EXTENT,c[1]*t.EXTENT),g.u_height_lift=s),g},kn=(e,n,r,i,o,s,a,c,l,u,h)=>{const d=In(e,n,r,i,o,c,l,u,h),p={u_height_factor:-Math.pow(2,o.overscaledZ)/a.tileSize/8};return t.extend(d,En(s,n,a),p)},An=t=>({u_matrix:t}),Mn=(e,n,r,i)=>t.extend(An(e),En(r,n,i)),On=(t,e)=>({u_matrix:t,u_world:e}),Pn=(e,n,r,i,o)=>t.extend(Mn(e,n,r,i),{u_world:o}),Dn=t.create(),Rn=(e,n,r,i,o,s)=>{const a=e.transform,c="globe"===a.projection.name;let l;if("map"===s.paint.get("circle-pitch-alignment"))if(c){const e=t.globePixelsToTileUnits(a.zoom,n.canonical);l=Float32Array.from([e,0,0,e])}else l=a.calculatePixelsToTileUnitsMatrix(r);else l=new Float32Array([a.pixelsToGLUnits[0],0,0,a.pixelsToGLUnits[1]]);const u={u_camera_to_center_distance:a.cameraToCenterDistance,u_matrix:e.translatePosMatrix(n.projMatrix,r,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:t.exported.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:Dn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return c&&(u.u_inv_rot_matrix=i,u.u_merc_center=o,u.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],u.u_zoom_transition=t.globeToMercatorTransition(a.zoom),u.u_up_dir=a.projection.upVector(n.canonical,o[0],o[1])),u},Nn=t=>{const e=[];return"map"===t.paint.get("circle-pitch-alignment")&&e.push("PITCH_WITH_MAP"),"map"===t.paint.get("circle-pitch-scale")&&e.push("SCALE_WITH_MAP"),e},Ln=(e,n,r)=>{const i=t.EXTENT/r.tileSize;return{u_matrix:e,u_camera_to_center_distance:n.cameraToCenterDistance,u_extrude_scale:[n.pixelsToGLUnits[0]/i,n.pixelsToGLUnits[1]/i]}},jn=(t,e,n=1)=>({u_matrix:t,u_color:e,u_overlay:0,u_overlay_scale:n}),zn=t.create(),Fn=(e,n,r,i,o,s,a)=>{const c=e.transform,l="globe"===c.projection.name,u=l?t.globePixelsToTileUnits(c.zoom,n.canonical):D(r,1,s),h={u_matrix:n.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:zn,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};return l&&(h.u_inv_rot_matrix=i,h.u_merc_center=o,h.u_tile_id=[n.canonical.x,n.canonical.y,1<<n.canonical.z],h.u_zoom_transition=t.globeToMercatorTransition(c.zoom),h.u_up_dir=c.projection.upVector(n.canonical,o[0],o[1])),h},Bn=(t,e,n,r,i,o,s)=>{const a=t.transform,c=a.calculatePixelsToTileUnitsMatrix(e),l={u_matrix:qn(t,e,n,i),u_pixels_to_tile_units:c,u_device_pixel_ratio:s,u_units_to_pixels:[1/a.pixelsToGLUnits[0],1/a.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:o,u_texsize:[0,0],u_scale:[0,0,0],u_mix:0,u_alpha_discard_threshold:0};if(Gn(n)){const n=Vn(e,t.transform);l.u_texsize=e.lineAtlasTexture.size,l.u_scale=[n,r.fromScale,r.toScale],l.u_mix=r.t}return l},Un=(t,e,n,r,i,o)=>{const s=t.transform,a=Vn(e,s);return{u_matrix:qn(t,e,n,i),u_texsize:e.imageAtlasTexture.size,u_pixels_to_tile_units:s.calculatePixelsToTileUnitsMatrix(e),u_device_pixel_ratio:o,u_image:0,u_scale:[a,r.fromScale,r.toScale],u_fade:r.t,u_units_to_pixels:[1/s.pixelsToGLUnits[0],1/s.pixelsToGLUnits[1]],u_alpha_discard_threshold:0}};function Vn(t,e){return 1/D(t,1,e.tileZoom)}function qn(t,e,n,r){return t.translatePosMatrix(r||e.tileID.projMatrix,e,n.paint.get("line-translate"),n.paint.get("line-translate-anchor"))}function Gn(t){const e=t.paint.get("line-dasharray").value;return e.value||"constant"!==e.kind}const $n=(t,e,n,r,i,o)=>{return{u_matrix:t,u_tl_parent:e,u_scale_parent:n,u_fade_t:r.mix,u_opacity:r.opacity*i.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:i.paint.get("raster-brightness-min"),u_brightness_high:i.paint.get("raster-brightness-max"),u_saturation_factor:(a=i.paint.get("raster-saturation"),a>0?1-1/(1.001-a):-a),u_contrast_factor:(s=i.paint.get("raster-contrast"),s>0?1/(1-s):1+s),u_spin_weights:Wn(i.paint.get("raster-hue-rotate")),u_perspective_transform:o};var s,a};function Wn(t){t*=Math.PI/180;const e=Math.sin(t),n=Math.cos(t);return[(2*n+1)/3,(-Math.sqrt(3)*e-n+1)/3,(Math.sqrt(3)*e-n+1)/3]}const Hn=t.create(),Zn=(e,n,r,i,o,s,a,c,l,u,h,d,p,f)=>{const m=o.transform,g={u_is_size_zoom_constant:+("constant"===e||"source"===e),u_is_size_feature_constant:+("constant"===e||"camera"===e),u_size_t:n?n.uSizeT:0,u_size:n?n.uSize:0,u_camera_to_center_distance:m.cameraToCenterDistance,u_rotate_symbol:+r,u_aspect_ratio:m.width/m.height,u_fade_change:o.options.fadeDuration?o.symbolFadeChange:1,u_matrix:s,u_label_plane_matrix:a,u_coord_matrix:c,u_is_text:+l,u_pitch_with_map:+i,u_texsize:u,u_texture:0,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Hn,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Hn};return"globe"===m.projection.name&&(g.u_tile_id=[h.canonical.x,h.canonical.y,1<<h.canonical.z],g.u_zoom_transition=d,g.u_inv_rot_matrix=f,g.u_merc_center=p,g.u_camera_forward=m._camera.forward(),g.u_ecef_origin=t.globeECEFOrigin(m.globeMatrix,h.toUnwrapped()),g.u_tile_matrix=Float32Array.from(m.globeMatrix)),g},Kn=(e,n,r,i,o,s,a,c,l,u,h,d,p,f,m)=>{const{cameraToCenterDistance:g,_pitch:_}=o.transform;return t.extend(Zn(e,n,r,i,o,s,a,c,l,u,d,p,f,m),{u_gamma_scale:i?g*Math.cos(o.terrain?0:_):1,u_device_pixel_ratio:t.exported.devicePixelRatio,u_is_halo:+h})},Xn=(e,n,r,i,o,s,a,c,l,u,h,d,p,f)=>t.extend(Kn(e,n,r,i,o,s,a,c,!0,l,!0,h,d,p,f),{u_texsize_icon:u,u_texture_icon:1}),Yn=(t,e,n)=>({u_matrix:t,u_opacity:e,u_color:n}),Qn=(e,n,r,i,o,s)=>t.extend(function(t,e,n,r){const i=n.imageManager.getPattern(t.from.toString()),o=n.imageManager.getPattern(t.to.toString()),{width:s,height:a}=n.imageManager.getPixelSize(),c=Math.pow(2,r.tileID.overscaledZ),l=r.tileSize*Math.pow(2,n.transform.tileZoom)/c,u=l*(r.tileID.canonical.x+r.tileID.wrap*c),h=l*r.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:i.tl,u_pattern_br_a:i.br,u_pattern_tl_b:o.tl,u_pattern_br_b:o.br,u_texsize:[s,a],u_mix:e.t,u_pattern_size_a:i.displaySize,u_pattern_size_b:o.displaySize,u_scale_a:e.fromScale,u_scale_b:e.toScale,u_tile_units_to_pixels:1/D(r,1,n.transform.tileZoom),u_pixel_coord_upper:[u>>16,h>>16],u_pixel_coord_lower:[65535&u,65535&h]}}(i,s,r,o),{u_matrix:e,u_opacity:n}),Jn={fillExtrusion:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_opacity:new t.Uniform1f(e,n.u_opacity),u_tile_id:new t.Uniform3f(e,n.u_tile_id),u_zoom_transition:new t.Uniform1f(e,n.u_zoom_transition),u_inv_rot_matrix:new t.UniformMatrix4f(e,n.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,n.u_merc_center),u_up_dir:new t.Uniform3f(e,n.u_up_dir),u_height_lift:new t.Uniform1f(e,n.u_height_lift)}),fillExtrusionPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_lightpos:new t.Uniform3f(e,n.u_lightpos),u_lightintensity:new t.Uniform1f(e,n.u_lightintensity),u_lightcolor:new t.Uniform3f(e,n.u_lightcolor),u_vertical_gradient:new t.Uniform1f(e,n.u_vertical_gradient),u_height_factor:new t.Uniform1f(e,n.u_height_factor),u_tile_id:new t.Uniform3f(e,n.u_tile_id),u_zoom_transition:new t.Uniform1f(e,n.u_zoom_transition),u_inv_rot_matrix:new t.UniformMatrix4f(e,n.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,n.u_merc_center),u_up_dir:new t.Uniform3f(e,n.u_up_dir),u_height_lift:new t.Uniform1f(e,n.u_height_lift),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_opacity:new t.Uniform1f(e,n.u_opacity)}),fill:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),fillPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),fillOutline:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world)}),fillOutlinePattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_world:new t.Uniform2f(e,n.u_world),u_image:new t.Uniform1i(e,n.u_image),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade)}),circle:(e,n)=>({u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_extrude_scale:new t.UniformMatrix2f(e,n.u_extrude_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_rot_matrix:new t.UniformMatrix4f(e,n.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,n.u_merc_center),u_tile_id:new t.Uniform3f(e,n.u_tile_id),u_zoom_transition:new t.Uniform1f(e,n.u_zoom_transition),u_up_dir:new t.Uniform3f(e,n.u_up_dir)}),collisionBox:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_extrude_scale:new t.Uniform2f(e,n.u_extrude_scale)}),collisionCircle:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_matrix:new t.UniformMatrix4f(e,n.u_inv_matrix),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_viewport_size:new t.Uniform2f(e,n.u_viewport_size)}),debug:(e,n)=>({u_color:new t.UniformColor(e,n.u_color),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_overlay:new t.Uniform1i(e,n.u_overlay),u_overlay_scale:new t.Uniform1f(e,n.u_overlay_scale)}),clippingMask:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix)}),heatmap:(e,n)=>({u_extrude_scale:new t.Uniform1f(e,n.u_extrude_scale),u_intensity:new t.Uniform1f(e,n.u_intensity),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_inv_rot_matrix:new t.UniformMatrix4f(e,n.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,n.u_merc_center),u_tile_id:new t.Uniform3f(e,n.u_tile_id),u_zoom_transition:new t.Uniform1f(e,n.u_zoom_transition),u_up_dir:new t.Uniform3f(e,n.u_up_dir)}),heatmapTexture:(e,n)=>({u_image:new t.Uniform1i(e,n.u_image),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_opacity:new t.Uniform1f(e,n.u_opacity)}),hillshade:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_latrange:new t.Uniform2f(e,n.u_latrange),u_light:new t.Uniform2f(e,n.u_light),u_shadow:new t.UniformColor(e,n.u_shadow),u_highlight:new t.UniformColor(e,n.u_highlight),u_accent:new t.UniformColor(e,n.u_accent)}),hillshadePrepare:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_image:new t.Uniform1i(e,n.u_image),u_dimension:new t.Uniform2f(e,n.u_dimension),u_zoom:new t.Uniform1f(e,n.u_zoom),u_unpack:new t.Uniform4f(e,n.u_unpack)}),line:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_pixels_to_tile_units:new t.UniformMatrix2f(e,n.u_pixels_to_tile_units),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_dash_image:new t.Uniform1i(e,n.u_dash_image),u_gradient_image:new t.Uniform1i(e,n.u_gradient_image),u_image_height:new t.Uniform1f(e,n.u_image_height),u_texsize:new t.Uniform2f(e,n.u_texsize),u_scale:new t.Uniform3f(e,n.u_scale),u_mix:new t.Uniform1f(e,n.u_mix),u_alpha_discard_threshold:new t.Uniform1f(e,n.u_alpha_discard_threshold)}),linePattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_texsize:new t.Uniform2f(e,n.u_texsize),u_pixels_to_tile_units:new t.UniformMatrix2f(e,n.u_pixels_to_tile_units),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_image:new t.Uniform1i(e,n.u_image),u_units_to_pixels:new t.Uniform2f(e,n.u_units_to_pixels),u_scale:new t.Uniform3f(e,n.u_scale),u_fade:new t.Uniform1f(e,n.u_fade),u_alpha_discard_threshold:new t.Uniform1f(e,n.u_alpha_discard_threshold)}),raster:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_tl_parent:new t.Uniform2f(e,n.u_tl_parent),u_scale_parent:new t.Uniform1f(e,n.u_scale_parent),u_fade_t:new t.Uniform1f(e,n.u_fade_t),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image0:new t.Uniform1i(e,n.u_image0),u_image1:new t.Uniform1i(e,n.u_image1),u_brightness_low:new t.Uniform1f(e,n.u_brightness_low),u_brightness_high:new t.Uniform1f(e,n.u_brightness_high),u_saturation_factor:new t.Uniform1f(e,n.u_saturation_factor),u_contrast_factor:new t.Uniform1f(e,n.u_contrast_factor),u_spin_weights:new t.Uniform3f(e,n.u_spin_weights),u_perspective_transform:new t.Uniform2f(e,n.u_perspective_transform)}),symbolIcon:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_tile_id:new t.Uniform3f(e,n.u_tile_id),u_zoom_transition:new t.Uniform1f(e,n.u_zoom_transition),u_inv_rot_matrix:new t.UniformMatrix4f(e,n.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,n.u_merc_center),u_camera_forward:new t.Uniform3f(e,n.u_camera_forward),u_tile_matrix:new t.UniformMatrix4f(e,n.u_tile_matrix),u_ecef_origin:new t.Uniform3f(e,n.u_ecef_origin),u_texture:new t.Uniform1i(e,n.u_texture)}),symbolSDF:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texture:new t.Uniform1i(e,n.u_texture),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_tile_id:new t.Uniform3f(e,n.u_tile_id),u_zoom_transition:new t.Uniform1f(e,n.u_zoom_transition),u_inv_rot_matrix:new t.UniformMatrix4f(e,n.u_inv_rot_matrix),u_merc_center:new t.Uniform2f(e,n.u_merc_center),u_camera_forward:new t.Uniform3f(e,n.u_camera_forward),u_tile_matrix:new t.UniformMatrix4f(e,n.u_tile_matrix),u_ecef_origin:new t.Uniform3f(e,n.u_ecef_origin),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}),symbolTextAndIcon:(e,n)=>({u_is_size_zoom_constant:new t.Uniform1i(e,n.u_is_size_zoom_constant),u_is_size_feature_constant:new t.Uniform1i(e,n.u_is_size_feature_constant),u_size_t:new t.Uniform1f(e,n.u_size_t),u_size:new t.Uniform1f(e,n.u_size),u_camera_to_center_distance:new t.Uniform1f(e,n.u_camera_to_center_distance),u_rotate_symbol:new t.Uniform1i(e,n.u_rotate_symbol),u_aspect_ratio:new t.Uniform1f(e,n.u_aspect_ratio),u_fade_change:new t.Uniform1f(e,n.u_fade_change),u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_label_plane_matrix:new t.UniformMatrix4f(e,n.u_label_plane_matrix),u_coord_matrix:new t.UniformMatrix4f(e,n.u_coord_matrix),u_is_text:new t.Uniform1i(e,n.u_is_text),u_pitch_with_map:new t.Uniform1i(e,n.u_pitch_with_map),u_texsize:new t.Uniform2f(e,n.u_texsize),u_texsize_icon:new t.Uniform2f(e,n.u_texsize_icon),u_texture:new t.Uniform1i(e,n.u_texture),u_texture_icon:new t.Uniform1i(e,n.u_texture_icon),u_gamma_scale:new t.Uniform1f(e,n.u_gamma_scale),u_device_pixel_ratio:new t.Uniform1f(e,n.u_device_pixel_ratio),u_is_halo:new t.Uniform1i(e,n.u_is_halo)}),background:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_color:new t.UniformColor(e,n.u_color)}),backgroundPattern:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_opacity:new t.Uniform1f(e,n.u_opacity),u_image:new t.Uniform1i(e,n.u_image),u_pattern_tl_a:new t.Uniform2f(e,n.u_pattern_tl_a),u_pattern_br_a:new t.Uniform2f(e,n.u_pattern_br_a),u_pattern_tl_b:new t.Uniform2f(e,n.u_pattern_tl_b),u_pattern_br_b:new t.Uniform2f(e,n.u_pattern_br_b),u_texsize:new t.Uniform2f(e,n.u_texsize),u_mix:new t.Uniform1f(e,n.u_mix),u_pattern_size_a:new t.Uniform2f(e,n.u_pattern_size_a),u_pattern_size_b:new t.Uniform2f(e,n.u_pattern_size_b),u_scale_a:new t.Uniform1f(e,n.u_scale_a),u_scale_b:new t.Uniform1f(e,n.u_scale_b),u_pixel_coord_upper:new t.Uniform2f(e,n.u_pixel_coord_upper),u_pixel_coord_lower:new t.Uniform2f(e,n.u_pixel_coord_lower),u_tile_units_to_pixels:new t.Uniform1f(e,n.u_tile_units_to_pixels)}),terrainRaster:ln,terrainDepth:ln,skybox:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_sun_direction:new t.Uniform3f(e,n.u_sun_direction),u_cubemap:new t.Uniform1i(e,n.u_cubemap),u_opacity:new t.Uniform1f(e,n.u_opacity),u_temporal_offset:new t.Uniform1f(e,n.u_temporal_offset)}),skyboxGradient:(e,n)=>({u_matrix:new t.UniformMatrix4f(e,n.u_matrix),u_color_ramp:new t.Uniform1i(e,n.u_color_ramp),u_center_direction:new t.Uniform3f(e,n.u_center_direction),u_radius:new t.Uniform1f(e,n.u_radius),u_opacity:new t.Uniform1f(e,n.u_opacity),u_temporal_offset:new t.Uniform1f(e,n.u_temporal_offset)}),skyboxCapture:(e,n)=>({u_matrix_3f:new t.UniformMatrix3f(e,n.u_matrix_3f),u_sun_direction:new t.Uniform3f(e,n.u_sun_direction),u_sun_intensity:new t.Uniform1f(e,n.u_sun_intensity),u_color_tint_r:new t.Uniform4f(e,n.u_color_tint_r),u_color_tint_m:new t.Uniform4f(e,n.u_color_tint_m),u_luminance:new t.Uniform1f(e,n.u_luminance)}),globeRaster:(e,n)=>({u_proj_matrix:new t.UniformMatrix4f(e,n.u_proj_matrix),u_globe_matrix:new t.UniformMatrix4f(e,n.u_globe_matrix),u_merc_matrix:new t.UniformMatrix4f(e,n.u_merc_matrix),u_zoom_transition:new t.Uniform1f(e,n.u_zoom_transition),u_merc_center:new t.Uniform2f(e,n.u_merc_center),u_image0:new t.Uniform1i(e,n.u_image0),u_grid_matrix:new t.UniformMatrix3f(e,n.u_grid_matrix)}),globeAtmosphere:(e,n)=>({u_frustum_tl:new t.Uniform3f(e,n.u_frustum_tl),u_frustum_tr:new t.Uniform3f(e,n.u_frustum_tr),u_frustum_br:new t.Uniform3f(e,n.u_frustum_br),u_frustum_bl:new t.Uniform3f(e,n.u_frustum_bl),u_globe_pos:new t.Uniform3f(e,n.u_globe_pos),u_globe_radius:new t.Uniform1f(e,n.u_globe_radius),u_opacity:new t.Uniform1f(e,n.u_opacity),u_fadeout_range:new t.Uniform1f(e,n.u_fadeout_range),u_start_color:new t.Uniform3f(e,n.u_start_color),u_end_color:new t.Uniform3f(e,n.u_end_color)})};let tr;function er(e,n,r,i,o,s,a){const c=e.context,l=c.gl,u=e.useProgram("collisionBox"),h=[];let d=0,p=0;for(let b=0;b<i.length;b++){const f=i[b],m=n.getTile(f),g=m.getBucket(r);if(!g)continue;let _=f.projMatrix;0===o[0]&&0===o[1]||(_=e.translatePosMatrix(f.projMatrix,m,o,s));const y=a?g.textCollisionBox:g.iconCollisionBox,v=g.collisionCircleArray;if(v.length>0){const n=t.create(),r=_;t.mul(n,g.placementInvProjMatrix,e.transform.glCoordMatrix),t.mul(n,n,g.placementViewportMatrix),h.push({circleArray:v,circleOffset:p,transform:r,invTransform:n}),d+=v.length/4,p=d}y&&(e.terrain&&e.terrain.setupElevationDraw(m,u),u.draw(c,l.LINES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,Ln(_,e.transform,m),r.id,y.layoutVertexBuffer,y.indexBuffer,y.segments,null,e.transform.zoom,null,y.collisionVertexBuffer,y.collisionVertexBufferExt))}if(!a||!h.length)return;const f=e.useProgram("collisionCircle"),m=new t.StructArrayLayout2f1f2i16;m.resize(4*d),m._trim();let g=0;for(const t of h)for(let e=0;e<t.circleArray.length/4;e++){const n=4*e,r=t.circleArray[n+0],i=t.circleArray[n+1],o=t.circleArray[n+2],s=t.circleArray[n+3];m.emplace(g++,r,i,o,s,0),m.emplace(g++,r,i,o,s,1),m.emplace(g++,r,i,o,s,2),m.emplace(g++,r,i,o,s,3)}(!tr||tr.length<2*d)&&(tr=function(e){const n=2*e,r=new t.StructArrayLayout3ui6;r.resize(n),r._trim();for(let t=0;t<n;t++){const e=6*t;r.uint16[e+0]=4*t+0,r.uint16[e+1]=4*t+1,r.uint16[e+2]=4*t+2,r.uint16[e+3]=4*t+2,r.uint16[e+4]=4*t+3,r.uint16[e+5]=4*t+0}return r}(d));const _=c.createIndexBuffer(tr,!0),y=c.createVertexBuffer(m,t.collisionCircleLayout.members,!0);for(const b of h){const n={u_matrix:b.transform,u_inv_matrix:b.invTransform,u_camera_to_center_distance:(v=e.transform).cameraToCenterDistance,u_viewport_size:[v.width,v.height]};f.draw(c,l.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,n,r.id,y,_,t.SegmentVector.simpleSegment(0,2*b.circleOffset,b.circleArray.length,b.circleArray.length/2),null,e.transform.zoom,null,null,null)}var v;y.destroy(),_.destroy()}const nr=t.create();function rr(e,n,r,i,o,s){const{horizontalAlign:a,verticalAlign:c}=t.getAnchorAlignment(e),l=-(a-.5)*n,u=-(c-.5)*r,h=t.evaluateVariableOffset(e,i);return new t.pointGeometry((l/o+h[0])*s,(u/o+h[1])*s)}function ir(e,n,r,i,o,s,a,c,l,u,h,d){const p=e.text.placedSymbolArray,f=e.text.dynamicLayoutVertexArray,m=e.icon.dynamicLayoutVertexArray,g={},_=c.projMatrix,y=s.elevation,v=d.upVectorScale(c.canonical,s.center.lat,s.worldSize);f.clear();for(let b=0;b<p.length;b++){const m=p.get(b),x=e.allowVerticalPlacement&&!m.placedOrientation,w=m.hidden||!m.crossTileID||x?null:i[m.crossTileID];if(w){const i=new t.pointGeometry(m.tileAnchorX,m.tileAnchorY),p=d.upVector(c.canonical,i.x,i.y),b=y?y.getAtTileOffset(c,i.x,i.y):0,x=ne([m.projectedAnchorX+b*p[0]*v.metersToTile,m.projectedAnchorY+b*p[1]*v.metersToTile,m.projectedAnchorZ+b*p[2]*v.metersToTile],r?_:a),T=re(s.cameraToCenterDistance,x.signedDistanceFromCamera);let C=o.evaluateSizeForFeature(e.textSizeData,u,m)*T/t.ONE_EM;r&&(C*=e.tilePixelRatio/l);const{width:E,height:S,anchor:I,textOffset:k,textScale:A}=w,M=rr(I,E,S,k,A,C),O=r?ee(i.add(M),a,b*v.metersToLabelSpace).point:x.point.add(n?M.rotate(-s.angle):M),P=e.allowVerticalPlacement&&m.placedOrientation===t.WritingMode.vertical?Math.PI/2:0;for(let e=0;e<m.numGlyphs;e++)t.addDynamicAttributes(f,O,P);h&&m.associatedIconIndex>=0&&(g[m.associatedIconIndex]={shiftedAnchor:O,angle:P})}else pe(m.numGlyphs,f)}if(h){m.clear();const n=e.icon.placedSymbolArray;for(let e=0;e<n.length;e++){const r=n.get(e);if(r.hidden)pe(r.numGlyphs,m);else{const n=g[e];if(n)for(let e=0;e<r.numGlyphs;e++)t.addDynamicAttributes(m,n.shiftedAnchor,n.angle);else pe(r.numGlyphs,m)}}e.icon.dynamicLayoutVertexBuffer.updateData(m)}e.text.dynamicLayoutVertexBuffer.updateData(f)}function or(t,e,n){return n.iconsInText&&e?"symbolTextAndIcon":t?"symbolSDF":"symbolIcon"}function sr(e,n,r,i,o,s,a,c,l,u,h,d){const p=e.context,f=p.gl,m=e.transform,g="map"===c,_="map"===l,y=g&&"point"!==r.layout.get("symbol-placement"),v=g&&!_&&!y,b=void 0!==r.layout.get("symbol-sort-key").constantOr(1);let x=!1;const w=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),T=[t.mercatorXfromLng(m.center.lng),t.mercatorYfromLat(m.center.lat)],C=r.layout.get("text-variable-anchor"),E="globe"===m.projection.name,S=E?t.globeToMercatorTransition(m.zoom):0,I=[],k=[];e.terrain&&_&&k.push("PITCH_WITH_MAP_TERRAIN"),E&&k.push("PROJECTION_GLOBE_VIEW");for(const A of i){const i=n.getTile(A),c=i.getBucket(r);if(!c||c.projection!==m.projection.name)continue;const l=o?c.text:c.icon;if(!l||c.fullyClipped||!l.segments.get().length)continue;const h=l.programConfigurations.get(r.id),d=o||c.sdfIcons,p=o?c.textSizeData:c.iconSizeData,w=_||0!==m.pitch,E=t.evaluateSizeForZoom(p,m.zoom);let M,O,P,D,R=[0,0],N=null;if(o){if(O=i.glyphAtlasTexture,P=f.LINEAR,M=i.glyphAtlasTexture.size,c.iconsInText){R=i.imageAtlasTexture.size,N=i.imageAtlasTexture;const t="composite"===p.kind||"camera"===p.kind;D=w||e.options.rotating||e.options.zooming||t?f.LINEAR:f.NEAREST}}else{const t=1!==r.layout.get("icon-size").constantOr(0)||c.iconsNeedLinear;O=i.imageAtlasTexture,P=d||e.options.rotating||e.options.zooming||t||w?f.LINEAR:f.NEAREST,M=i.imageAtlasTexture.size}const L=e.transform.calculatePixelsToTileUnitsMatrix(i),j=Jt(A.projMatrix,i.tileID.canonical,_,g,e.transform,L),z=e.terrain&&_&&y?t.invert(t.create(),j):nr,F=te(A.projMatrix,i.tileID.canonical,_,g,e.transform,L),B=C&&c.hasTextData(),U="none"!==r.layout.get("icon-text-fit")&&B&&c.hasIconData();if(y){const t=m.elevation,n=t?t.getAtTileOffsetFunc(A,m.center.lat,m.worldSize,m.projection):t=>[0,0,0];oe(c,A.projMatrix,e,o,j,F,_,u,n,A)}const V=y||o&&C||U,q=e.translatePosMatrix(A.projMatrix,i,s,a),G=V?nr:j,$=e.translatePosMatrix(F,i,s,a,!0),W=m.projection.createInversionMatrix(m,A.canonical),H=V?k.concat(["PROJECTED_POS_ON_VIEWPORT"]):k,Z=d&&0!==r.paint.get(o?"text-halo-width":"icon-halo-width").constantOr(1);let K;K=d?c.iconsInText?Xn(p.kind,E,v,_,e,q,G,$,M,R,A,S,T,W):Kn(p.kind,E,v,_,e,q,G,$,o,M,!0,A,S,T,W):Zn(p.kind,E,v,_,e,q,G,$,o,M,A,S,T,W);const X={program:e.useProgram(or(d,o,c),h,H),buffers:l,uniformValues:K,atlasTexture:O,atlasTextureIcon:N,atlasInterpolation:P,atlasInterpolationIcon:D,isSDF:d,hasHalo:Z,tile:i,labelPlaneMatrixInv:z};if(b&&c.canOverlap){x=!0;const e=l.segments.get();for(const n of e)I.push({segments:new t.SegmentVector([n]),sortKey:n.sortKey,state:X})}else I.push({segments:l.segments,sortKey:0,state:X})}x&&I.sort((t,e)=>t.sortKey-e.sortKey);for(const t of I){const n=t.state;if(e.terrain&&e.terrain.setupElevationDraw(n.tile,n.program,{useDepthForOcclusion:!E,labelPlaneMatrixInv:n.labelPlaneMatrixInv}),p.activeTexture.set(f.TEXTURE0),n.atlasTexture.bind(n.atlasInterpolation,f.CLAMP_TO_EDGE),n.atlasTextureIcon&&(p.activeTexture.set(f.TEXTURE1),n.atlasTextureIcon&&n.atlasTextureIcon.bind(n.atlasInterpolationIcon,f.CLAMP_TO_EDGE)),n.isSDF){const i=n.uniformValues;n.hasHalo&&(i.u_is_halo=1,ar(n.buffers,t.segments,r,e,n.program,w,h,d,i)),i.u_is_halo=0}ar(n.buffers,t.segments,r,e,n.program,w,h,d,n.uniformValues)}}function ar(e,n,r,i,o,s,a,c,l){const u=i.context;o.draw(u,u.gl.TRIANGLES,s,a,c,t.CullFaceMode.disabled,l,r.id,e.layoutVertexBuffer,e.indexBuffer,n,r.paint,i.transform.zoom,e.programConfigurations.get(r.id),e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer)}function cr(e,n,r,i,o,s,a){const c=e.context.gl,l=r.paint.get("fill-pattern"),u=l&&l.constantOr(1),h=r.getCrossfadeParameters();let d,p,f,m,g;a?(p=u&&!r.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",d=c.LINES):(p=u?"fillPattern":"fill",d=c.TRIANGLES);for(const _ of i){const i=n.getTile(_);if(u&&!i.patternsLoaded())continue;const y=i.getBucket(r);if(!y)continue;e.prepareDrawTile();const v=y.programConfigurations.get(r.id),b=e.useProgram(p,v);u&&(e.context.activeTexture.set(c.TEXTURE0),i.imageAtlasTexture.bind(c.LINEAR,c.CLAMP_TO_EDGE),v.updatePaintBuffers(h));const x=l.constantOr(null);if(x&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[x.to.toString()],n=t.patternPositions[x.from.toString()];e&&n&&v.setConstantPatternPositions(e,n)}const w=e.translatePosMatrix(_.projMatrix,i,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor"));if(a){m=y.indexBuffer2,g=y.segments2;const t=e.terrain&&e.terrain.renderingToTexture?e.terrain.drapeBufferSize:[c.drawingBufferWidth,c.drawingBufferHeight];f="fillOutlinePattern"===p&&u?Pn(w,e,h,i,t):On(w,t)}else m=y.indexBuffer,g=y.segments,f=u?Mn(w,e,h,i):An(w);e.prepareDrawProgram(e.context,b,_.toUnwrapped()),b.draw(e.context,d,o,e.stencilModeForClipping(_),s,t.CullFaceMode.disabled,f,r.id,y.layoutVertexBuffer,m,g,r.paint,e.transform.zoom,v)}}function lr(e,n,r,i,o,s,a){const c=e.context,l=c.gl,u=e.transform,h=r.paint.get("fill-extrusion-pattern"),d=h.constantOr(1),p=r.getCrossfadeParameters(),f=r.paint.get("fill-extrusion-opacity"),m=function(e){if("globe"!==e.projection.name)return 0;const n=Math.PI/32,r=Math.tan(n),i=t.earthRadius;return i*Math.sqrt(1+2*r*r)-i}(u),g="globe"===u.projection.name,_=g?t.globeToMercatorTransition(u.zoom):0,y=[t.mercatorXfromLng(u.center.lng),t.mercatorYfromLat(u.center.lat)],v=[];g&&v.push("PROJECTION_GLOBE_VIEW");for(const b of i){const i=n.getTile(b),x=i.getBucket(r);if(!x||x.projection!==u.projection.name)continue;const w=x.programConfigurations.get(r.id),T=e.useProgram(d?"fillExtrusionPattern":"fillExtrusion",w,v);if(e.terrain){const t=e.terrain;if(e.style.terrainSetForDrapingOnly())t.setupElevationDraw(i,T,{useMeterToDem:!0});else{if(!x.enableTerrain)continue;if(t.setupElevationDraw(i,T,{useMeterToDem:!0}),ur(c,n,b,x,r,t),!x.centroidVertexBuffer){const t=T.attributes.a_centroid_pos;void 0!==t&&l.vertexAttrib2f(t,0,0)}}}d&&(e.context.activeTexture.set(l.TEXTURE0),i.imageAtlasTexture.bind(l.LINEAR,l.CLAMP_TO_EDGE),w.updatePaintBuffers(p));const C=h.constantOr(null);if(C&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[C.to.toString()],n=t.patternPositions[C.from.toString()];e&&n&&w.setConstantPatternPositions(e,n)}const E=e.translatePosMatrix(b.projMatrix,i,r.paint.get("fill-extrusion-translate"),r.paint.get("fill-extrusion-translate-anchor")),S=u.projection.createInversionMatrix(u,b.canonical),I=r.paint.get("fill-extrusion-vertical-gradient"),k=d?kn(E,e,I,f,b,p,i,m,_,y,S):In(E,e,I,f,b,m,_,y,S);e.prepareDrawProgram(c,T,b.toUnwrapped()),T.draw(c,c.gl.TRIANGLES,o,s,a,t.CullFaceMode.backCCW,k,r.id,x.layoutVertexBuffer,x.indexBuffer,x.segments,r.paint,e.transform.zoom,w,e.terrain?x.centroidVertexBuffer:null,g?x.layoutVertexExtBuffer:null)}}function ur(e,n,r,i,o,s){const a=[e=>{let n=e.canonical.x-1,r=e.wrap;return n<0&&(n=(1<<e.canonical.z)-1,r--),new t.OverscaledTileID(e.overscaledZ,r,e.canonical.z,n,e.canonical.y)},e=>{let n=e.canonical.x+1,r=e.wrap;return n===1<<e.canonical.z&&(n=0,r++),new t.OverscaledTileID(e.overscaledZ,r,e.canonical.z,n,e.canonical.y)},e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new t.OverscaledTileID(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)],c=t=>{const e=n.getSource().minzoom,r=t=>{const e=n.getTileByID(t);if(e&&e.hasData())return e.getBucket(o)},i=[0,-1,1];for(const n of i){if(t.overscaledZ+n<e)continue;const i=r(t.calculateScaledKey(t.overscaledZ+n));if(i)return i}},l=[0,0,0],u=(e,n)=>(l[0]=Math.min(e.min.y,n.min.y),l[1]=Math.max(e.max.y,n.max.y),l[2]=t.EXTENT-n.min.x>e.max.x?n.min.x-t.EXTENT:e.max.x,l),h=(e,n)=>(l[0]=Math.min(e.min.x,n.min.x),l[1]=Math.max(e.max.x,n.max.x),l[2]=t.EXTENT-n.min.y>e.max.y?n.min.y-t.EXTENT:e.max.y,l),d=[(t,e)=>u(t,e),(t,e)=>u(e,t),(t,e)=>h(t,e),(t,e)=>h(e,t)],p=new t.pointGeometry(0,0);let f,m,g;const _=(e,n,i,o,a)=>{const c=[[o?i:e,o?e:i,0],[o?i:n,o?n:i,0]],l=a<0?t.EXTENT+a:a,u=[o?l:(e+n)/2,o?(e+n)/2:l,0];return 0===i&&a<0||0!==i&&a>0?s.getForTilePoints(g,[u],!0,m):c.push(u),s.getForTilePoints(r,c,!0,f),Math.max(c[0][2],c[1][2],u[2])/s.exaggeration()};for(let y=0;y<4;y++){const e=(y<2?1:5)-y,n=i.borders[y];if(0===n.length)continue;const o=g=a[y](r),l=c(o);if(!(l&&l instanceof t.FillExtrusionBucket&&l.enableTerrain))continue;if(i.borderDoneWithNeighborZ[y]===l.canonical.z&&l.borderDoneWithNeighborZ[e]===i.canonical.z)continue;if(m=s.findDEMTileFor(o),!m||!m.dem)continue;if(!f){const t=s.findDEMTileFor(r);if(!t||!t.dem)return;f=t}const u=l.borders[e];let h=0;const v=l.borderDoneWithNeighborZ[e]!==i.canonical.z;if(i.canonical.z===l.canonical.z){for(let r=0;r<n.length;r++){const o=i.featuresOnBorder[n[r]],s=o.borders[y];let a;for(;h<u.length&&(a=l.featuresOnBorder[u[h]],!(a.borders[e][1]>s[0]+3));)v&&l.encodeCentroid(void 0,a,!1),h++;if(a&&h<u.length){const n=h;let r=0;for(;!(a.borders[e][0]>s[1]-3)&&(r++,++h!==u.length);)a=l.featuresOnBorder[u[h]];if(a=l.featuresOnBorder[u[n]],o.intersectsCount()>1||a.intersectsCount()>1||1!==r){1!==r&&(h=n),i.encodeCentroid(void 0,o,!1),v&&l.encodeCentroid(void 0,a,!1);continue}const c=d[y](o,a),f=y%2?t.EXTENT-1:0;p.x=_(c[0],Math.min(t.EXTENT-1,c[1]),f,y<2,c[2]),p.y=0,i.encodeCentroid(p,o,!1),v&&l.encodeCentroid(p,a,!1)}else i.encodeCentroid(void 0,o,!1)}i.borderDoneWithNeighborZ[y]=l.canonical.z,i.needsCentroidUpdate=!0,v&&(l.borderDoneWithNeighborZ[e]=i.canonical.z,l.needsCentroidUpdate=!0)}else{for(const t of n)i.encodeCentroid(void 0,i.featuresOnBorder[t],!1);if(v){for(const t of u)l.encodeCentroid(void 0,l.featuresOnBorder[t],!1);l.borderDoneWithNeighborZ[e]=i.canonical.z,l.needsCentroidUpdate=!0}i.borderDoneWithNeighborZ[y]=l.canonical.z,i.needsCentroidUpdate=!0}}(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(e)}const hr=new t.Color(1,0,0,1),dr=new t.Color(0,1,0,1),pr=new t.Color(0,0,1,1),fr=new t.Color(1,0,1,1),mr=new t.Color(0,1,1,1);function gr(t,e,n,r){yr(t,0,e+n/2,t.transform.width,n,r)}function _r(t,e,n,r){yr(t,e-n/2,0,n,t.transform.height,r)}function yr(e,n,r,i,o,s){const a=e.context,c=a.gl;c.enable(c.SCISSOR_TEST),c.scissor(n*t.exported.devicePixelRatio,r*t.exported.devicePixelRatio,i*t.exported.devicePixelRatio,o*t.exported.devicePixelRatio),a.clear({color:s}),c.disable(c.SCISSOR_TEST)}function vr(e,n,r){const i=e.context,o=i.gl,s="globe"===e.transform.projection.name,a=r.projMatrix,c=e.useProgram("debug",null,s?["PROJECTION_GLOBE_VIEW"]:null),l=n.getTileByID(r.key);e.terrain&&e.terrain.setupElevationDraw(l,c);const u=t.DepthMode.disabled,h=t.StencilMode.disabled,d=e.colorModeForRenderPass(),p="$debug";i.activeTexture.set(o.TEXTURE0),e.emptyTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s?l._makeGlobeTileDebugBuffers(e.context,e.transform.projection):l._makeDebugTileBoundsBuffers(e.context,e.transform.projection);const f=l._tileDebugBuffer||e.debugBuffer,m=l._tileDebugIndexBuffer||e.debugIndexBuffer,g=l._tileDebugSegments||e.debugSegments;c.draw(i,o.LINE_STRIP,u,h,d,t.CullFaceMode.disabled,jn(a,t.Color.red),p,f,m,g,null,null,null,l._globeTileDebugBorderBuffer);const _=l.latestRawTileData,y=Math.floor((_&&_.byteLength||0)/1024),v=n.getTile(r).tileSize,b=512/Math.min(v,512)*(r.overscaledZ/e.transform.zoom)*.5;let x=r.canonical.toString();r.overscaledZ!==r.canonical.z&&(x+=` => ${r.overscaledZ}`),function(t,e){t.initDebugOverlayCanvas();const n=t.debugOverlayCanvas,r=t.context.gl,i=t.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,n.width,n.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(e,5,5),i.strokeText(e,5,5),t.debugOverlayTexture.update(n),t.debugOverlayTexture.bind(r.LINEAR,r.CLAMP_TO_EDGE)}(e,`${x} ${y}kb`);const w=l._tileDebugTextBuffer||e.debugBuffer,T=l._tileDebugTextIndexBuffer||e.quadTriangleIndexBuffer,C=l._tileDebugTextSegments||e.debugSegments;c.draw(i,o.TRIANGLES,u,h,t.ColorMode.alphaBlended,t.CullFaceMode.disabled,jn(a,t.Color.transparent,b),p,w,T,C,null,null,null,l._globeTileDebugTextBuffer)}const br=t.createLayout([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:xr}=br;function wr(t,e,n,r){t.emplaceBack(e,n,r)}class Tr{constructor(e){this.vertexArray=new t.StructArrayLayout3f12,this.indices=new t.StructArrayLayout3ui6,wr(this.vertexArray,-1,-1,1),wr(this.vertexArray,1,-1,1),wr(this.vertexArray,-1,1,1),wr(this.vertexArray,1,1,1),wr(this.vertexArray,-1,-1,-1),wr(this.vertexArray,1,-1,-1),wr(this.vertexArray,-1,1,-1),wr(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=e.createVertexBuffer(this.vertexArray,xr),this.indexBuffer=e.createIndexBuffer(this.indices),this.segment=t.SegmentVector.simpleSegment(0,0,36,12)}}function Cr(e,n,r,i,o,s){const a=e.gl,c=n.paint.get("sky-atmosphere-color"),l=n.paint.get("sky-atmosphere-halo-color"),u=n.paint.get("sky-atmosphere-sun-intensity"),h=((t,e,n,r,i)=>({u_matrix_3f:t,u_sun_direction:e,u_sun_intensity:n,u_color_tint_r:[r.r,r.g,r.b,r.a],u_color_tint_m:[i.r,i.g,i.b,i.a],u_luminance:5e-5}))(t.fromMat4(t.create$1(),i),o,u,c,l);a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+s,n.skyboxTexture,0),r.draw(e,a.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,t.ColorMode.unblended,t.CullFaceMode.frontCW,h,"skyboxCapture",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}function Er(e,n){return t.transformMat4(e,e,n)}const Sr={symbol:function(e,n,r,i,o){if("translucent"!==e.renderPass)return;const s=t.StencilMode.disabled,a=e.colorModeForRenderPass();r.layout.get("text-variable-anchor")&&function(e,n,r,i,o,s,a){const c=n.transform,l="map"===o,u="map"===s;for(const h of e){const e=i.getTile(h),o=e.getBucket(r);if(!o||o.projection!==c.projection.name||!o.text||!o.text.segments.get().length)continue;const s=t.evaluateSizeForZoom(o.textSizeData,c.zoom),d=n.transform.calculatePixelsToTileUnitsMatrix(e),p=Jt(h.projMatrix,e.tileID.canonical,u,l,n.transform,d),f="none"!==r.layout.get("icon-text-fit")&&o.hasIconData();if(s){const n=Math.pow(2,c.zoom-e.tileID.overscaledZ);ir(o,l,u,a,t.symbolSize,c,p,h,n,s,f,c.projection)}}}(i,e,r,n,r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),o),0!==r.paint.get("icon-opacity").constantOr(1)&&sr(e,n,r,i,!1,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),r.layout.get("icon-rotation-alignment"),r.layout.get("icon-pitch-alignment"),r.layout.get("icon-keep-upright"),s,a),0!==r.paint.get("text-opacity").constantOr(1)&&sr(e,n,r,i,!0,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),r.layout.get("text-rotation-alignment"),r.layout.get("text-pitch-alignment"),r.layout.get("text-keep-upright"),s,a),n.map.showCollisionBoxes&&(er(e,n,r,i,r.paint.get("text-translate"),r.paint.get("text-translate-anchor"),!0),er(e,n,r,i,r.paint.get("icon-translate"),r.paint.get("icon-translate-anchor"),!1))},circle:function(e,n,r,i){if("translucent"!==e.renderPass)return;const o=r.paint.get("circle-opacity"),s=r.paint.get("circle-stroke-width"),a=r.paint.get("circle-stroke-opacity"),c=void 0!==r.layout.get("circle-sort-key").constantOr(1);if(0===o.constantOr(1)&&(0===s.constantOr(1)||0===a.constantOr(1)))return;const l=e.context,u=l.gl,h=e.transform,d=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),p=t.StencilMode.disabled,f=e.colorModeForRenderPass(),m="globe"===h.projection.name,g=[t.mercatorXfromLng(h.center.lng),t.mercatorYfromLat(h.center.lat)],_=[];for(let v=0;v<i.length;v++){const o=i[v],s=n.getTile(o),a=s.getBucket(r);if(!a)continue;const l=a.programConfigurations.get(r.id),u=Nn(r);m&&u.push("PROJECTION_GLOBE_VIEW");const d=e.useProgram("circle",l,u),p=a.layoutVertexBuffer,f=a.globeExtVertexBuffer,y=a.indexBuffer,b=h.projection.createInversionMatrix(h,o.canonical),x={programConfiguration:l,program:d,layoutVertexBuffer:p,globeExtVertexBuffer:f,indexBuffer:y,uniformValues:Rn(e,o,s,b,g,r),tile:s};if(c){const e=a.segments.get();for(const n of e)_.push({segments:new t.SegmentVector([n]),sortKey:n.sortKey,state:x})}else _.push({segments:a.segments,sortKey:0,state:x})}c&&_.sort((t,e)=>t.sortKey-e.sortKey);const y={useDepthForOcclusion:!m};for(const v of _){const{programConfiguration:n,program:i,layoutVertexBuffer:o,globeExtVertexBuffer:s,indexBuffer:a,uniformValues:c,tile:g}=v.state,_=v.segments;e.terrain&&e.terrain.setupElevationDraw(g,i,y),e.prepareDrawProgram(l,i,g.tileID.toUnwrapped()),i.draw(l,u.TRIANGLES,d,p,f,t.CullFaceMode.disabled,c,r.id,o,a,_,r.paint,h.zoom,n,m?s:null)}},heatmap:function(e,n,r,i){if(0!==r.paint.get("heatmap-opacity"))if("offscreen"===e.renderPass){const o=e.context,s=o.gl,a=t.StencilMode.disabled,c=new t.ColorMode([s.ONE,s.ONE],t.Color.transparent,[!0,!0,!0,!0]);!function(t,e,n){const r=t.gl;t.activeTexture.set(r.TEXTURE1),t.viewport.set([0,0,e.width/4,e.height/4]);let i=n.heatmapFbo;if(i)r.bindTexture(r.TEXTURE_2D,i.colorAttachment.get()),t.bindFramebuffer.set(i.framebuffer);else{const o=r.createTexture();r.bindTexture(r.TEXTURE_2D,o),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_S,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_WRAP_T,r.CLAMP_TO_EDGE),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MIN_FILTER,r.LINEAR),r.texParameteri(r.TEXTURE_2D,r.TEXTURE_MAG_FILTER,r.LINEAR),i=n.heatmapFbo=t.createFramebuffer(e.width/4,e.height/4,!1),function(t,e,n,r){const i=t.gl;i.texImage2D(i.TEXTURE_2D,0,i.RGBA,e.width/4,e.height/4,0,i.RGBA,t.extRenderToTextureHalfFloat?t.extTextureHalfFloat.HALF_FLOAT_OES:i.UNSIGNED_BYTE,null),r.colorAttachment.set(n)}(t,e,o,i)}}(o,e,r),o.clear({color:t.Color.transparent});const l=e.transform,u="globe"===l.projection.name,h=u?["PROJECTION_GLOBE_VIEW"]:null,d=[t.mercatorXfromLng(l.center.lng),t.mercatorYfromLat(l.center.lat)];for(let p=0;p<i.length;p++){const f=i[p];if(n.hasRenderableParent(f))continue;const m=n.getTile(f),g=m.getBucket(r);if(!g)continue;const _=g.programConfigurations.get(r.id),y=e.useProgram("heatmap",_,h),{zoom:v}=e.transform;e.terrain&&e.terrain.setupElevationDraw(m,y),e.prepareDrawProgram(o,y,f.toUnwrapped());const b=l.projection.createInversionMatrix(l,f.canonical);y.draw(o,s.TRIANGLES,t.DepthMode.disabled,a,c,t.CullFaceMode.disabled,Fn(e,f,m,b,d,v,r.paint.get("heatmap-intensity")),r.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,r.paint,e.transform.zoom,_,u?g.globeExtVertexBuffer:null)}o.viewport.set([0,0,e.width,e.height])}else"translucent"===e.renderPass&&(e.context.setColorMode(e.colorModeForRenderPass()),function(e,n){const r=e.context,i=r.gl,o=n.heatmapFbo;if(!o)return;r.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,o.colorAttachment.get()),r.activeTexture.set(i.TEXTURE1);let s=n.colorRampTexture;s||(s=n.colorRampTexture=new t.Texture(r,n.colorRamp,i.RGBA)),s.bind(i.LINEAR,i.CLAMP_TO_EDGE),e.useProgram("heatmapTexture").draw(r,i.TRIANGLES,t.DepthMode.disabled,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.disabled,((t,e,n,r)=>({u_image:0,u_color_ramp:1,u_opacity:e.paint.get("heatmap-opacity")}))(0,n),n.id,e.viewportBuffer,e.quadTriangleIndexBuffer,e.viewportSegments,n.paint,e.transform.zoom)}(e,r))},line:function(e,n,r,i){if("translucent"!==e.renderPass)return;const o=r.paint.get("line-opacity"),s=r.paint.get("line-width");if(0===o.constantOr(1)||0===s.constantOr(1))return;const a=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),c=e.colorModeForRenderPass(),l=e.terrain&&e.terrain.renderingToTexture?1:t.exported.devicePixelRatio,u=r.paint.get("line-dasharray"),h=u.constantOr(1),d=r.layout.get("line-cap"),p=r.paint.get("line-pattern"),f=p.constantOr(1),m=r.paint.get("line-gradient"),g=r.getCrossfadeParameters(),_=f?"linePattern":"line",y=e.context,v=y.gl,b=(t=>{const e=[];Gn(t)&&e.push("RENDER_LINE_DASH"),t.paint.get("line-gradient")&&e.push("RENDER_LINE_GRADIENT");const n=t.paint.get("line-pattern").constantOr(1),r=1!==t.paint.get("line-opacity").constantOr(1);return!n&&r&&e.push("RENDER_LINE_ALPHA_DISCARD"),e})(r);let x=b.includes("RENDER_LINE_ALPHA_DISCARD");e.terrain&&e.terrain.clipOrMaskOverlapStencilType()&&(x=!1);for(const w of i){const i=n.getTile(w);if(f&&!i.patternsLoaded())continue;const o=i.getBucket(r);if(!o)continue;e.prepareDrawTile();const s=o.programConfigurations.get(r.id),T=e.useProgram(_,s,b),C=p.constantOr(null);if(C&&i.imageAtlas){const t=i.imageAtlas,e=t.patternPositions[C.to.toString()],n=t.patternPositions[C.from.toString()];e&&n&&s.setConstantPatternPositions(e,n)}const E=u.constantOr(null),S=d.constantOr(null);if(!f&&E&&S&&i.lineAtlas){const t=i.lineAtlas,e=t.getDash(E.to,S),n=t.getDash(E.from,S);e&&n&&s.setConstantPatternPositions(e,n)}const I=e.terrain?w.projMatrix:null,k=f?Un(e,i,r,g,I,l):Bn(e,i,r,g,I,o.lineClipsArray.length,l);if(m){const i=o.gradients[r.id];let s=i.texture;if(r.gradientVersion!==i.version){let a=256;if(r.stepInterpolant){const r=n.getSource().maxzoom,i=w.canonical.z===r?Math.ceil(1<<e.transform.maxZoom-w.canonical.z):1;a=t.clamp(t.nextPowerOfTwo(o.maxLineLength/t.EXTENT*1024*i),256,y.maxTextureSize)}i.gradient=t.renderColorRamp({expression:r.gradientExpression(),evaluationKey:"lineProgress",resolution:a,image:i.gradient||void 0,clips:o.lineClipsArray}),i.texture?i.texture.update(i.gradient):i.texture=new t.Texture(y,i.gradient,v.RGBA),i.version=r.gradientVersion,s=i.texture}y.activeTexture.set(v.TEXTURE1),s.bind(r.stepInterpolant?v.NEAREST:v.LINEAR,v.CLAMP_TO_EDGE)}h&&(y.activeTexture.set(v.TEXTURE0),i.lineAtlasTexture.bind(v.LINEAR,v.REPEAT),s.updatePaintBuffers(g)),f&&(y.activeTexture.set(v.TEXTURE0),i.imageAtlasTexture.bind(v.LINEAR,v.CLAMP_TO_EDGE),s.updatePaintBuffers(g)),e.prepareDrawProgram(y,T,w.toUnwrapped());const A=n=>{T.draw(y,v.TRIANGLES,a,n,c,t.CullFaceMode.disabled,k,r.id,o.layoutVertexBuffer,o.indexBuffer,o.segments,r.paint,e.transform.zoom,s,o.layoutVertexBuffer2)};if(x){const n=e.stencilModeForClipping(w).ref;0===n&&e.terrain&&y.clear({stencil:0});const r={func:v.EQUAL,mask:255};k.u_alpha_discard_threshold=.8,A(new t.StencilMode(r,n,255,v.KEEP,v.KEEP,v.INVERT)),k.u_alpha_discard_threshold=0,A(new t.StencilMode(r,n,255,v.KEEP,v.KEEP,v.KEEP))}else A(e.stencilModeForClipping(w))}x&&(e.resetStencilClippingMasks(),e.terrain&&y.clear({stencil:0}))},fill:function(e,n,r,i){const o=r.paint.get("fill-color"),s=r.paint.get("fill-opacity");if(0===s.constantOr(1))return;const a=e.colorModeForRenderPass(),c=r.paint.get("fill-pattern"),l=e.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===o.constantOr(t.Color.transparent).a&&1===s.constantOr(0)?"opaque":"translucent";if(e.renderPass===l){const o=e.depthModeForSublayer(1,"opaque"===e.renderPass?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly);cr(e,n,r,i,o,a,!1)}if("translucent"===e.renderPass&&r.paint.get("fill-antialias")){const o=e.depthModeForSublayer(r.getPaintProperty("fill-outline-color")?2:0,t.DepthMode.ReadOnly);cr(e,n,r,i,o,a,!0)}},"fill-extrusion":function(e,n,r,i){const o=r.paint.get("fill-extrusion-opacity");if(0!==o&&"translucent"===e.renderPass){const s=new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D);if(1!==o||r.paint.get("fill-extrusion-pattern").constantOr(1))lr(e,n,r,i,s,t.StencilMode.disabled,t.ColorMode.disabled),lr(e,n,r,i,s,e.stencilModeFor3D(),e.colorModeForRenderPass()),e.resetStencilClippingMasks();else{const o=e.colorModeForRenderPass();lr(e,n,r,i,s,t.StencilMode.disabled,o)}}},hillshade:function(e,n,r,i){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;const o=e.context,s=e.depthModeForSublayer(0,t.DepthMode.ReadOnly),a=e.colorModeForRenderPass(),c=e.terrain&&e.terrain.renderingToTexture,[l,u]="translucent"!==e.renderPass||c?[{},i]:e.stencilConfigForOverlap(i);for(const h of u){const i=n.getTile(h);if(i.needsHillshadePrepare&&"offscreen"===e.renderPass)cn(e,i,r,s,t.StencilMode.disabled,a);else if("translucent"===e.renderPass){const t=c&&e.terrain?e.terrain.stencilModeForRTTOverlap(h):l[h.overscaledZ];sn(e,h,i,r,s,t,a)}}o.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(e,n,r,i,o,s){if("translucent"!==e.renderPass)return;if(0===r.paint.get("raster-opacity"))return;if(!i.length)return;const a=e.context,c=a.gl,l=n.getSource(),u=e.useProgram("raster"),h=e.colorModeForRenderPass(),d=e.terrain&&e.terrain.renderingToTexture,[p,f]=l instanceof kt||d?[{},i]:e.stencilConfigForOverlap(i),m=f[f.length-1].overscaledZ,g=!e.options.moving;for(const _ of f){const i=d?t.DepthMode.disabled:e.depthModeForSublayer(_.overscaledZ-m,1===r.paint.get("raster-opacity")?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly,c.LESS),o=_.toUnwrapped(),f=n.getTile(_);if(d&&(!f||!f.hasData()))continue;const y=d?_.projMatrix:e.transform.calculateProjMatrix(o,g),v=e.terrain&&d?e.terrain.stencilModeForRTTOverlap(_):p[_.overscaledZ],b=s?0:r.paint.get("raster-fade-duration");f.registerFadeDuration(b);const x=n.findLoadedParent(_,0),w=_n(f,x,n,e.transform,b);let T,C;e.terrain&&e.terrain.prepareDrawTile();const E="nearest"===r.paint.get("raster-resampling")?c.NEAREST:c.LINEAR;a.activeTexture.set(c.TEXTURE0),f.texture.bind(E,c.CLAMP_TO_EDGE),a.activeTexture.set(c.TEXTURE1),x?(x.texture.bind(E,c.CLAMP_TO_EDGE),T=Math.pow(2,x.tileID.overscaledZ-f.tileID.overscaledZ),C=[f.tileID.canonical.x*T%1,f.tileID.canonical.y*T%1]):f.texture.bind(E,c.CLAMP_TO_EDGE);const S=$n(y,C||[0,0],T||1,w,r,l instanceof kt?l.perspectiveTransform:[0,0]);if(e.prepareDrawProgram(a,u,o),l instanceof kt)l.boundsBuffer&&l.boundsSegments&&u.draw(a,c.TRIANGLES,i,t.StencilMode.disabled,h,t.CullFaceMode.disabled,S,r.id,l.boundsBuffer,e.quadTriangleIndexBuffer,l.boundsSegments);else{const{tileBoundsBuffer:n,tileBoundsIndexBuffer:o,tileBoundsSegments:s}=e.getTileBoundsBuffers(f);u.draw(a,c.TRIANGLES,i,v,h,t.CullFaceMode.disabled,S,r.id,n,o,s)}}e.resetStencilClippingMasks()},background:function(e,n,r,i){const o=r.paint.get("background-color"),s=r.paint.get("background-opacity");if(0===s)return;const a=e.context,c=a.gl,l=e.transform,u=l.tileSize,h=r.paint.get("background-pattern");if(e.isPatternMissing(h))return;const d=!h&&1===o.a&&1===s&&e.opaquePassEnabledForLayer()?"opaque":"translucent";if(e.renderPass!==d)return;const p=t.StencilMode.disabled,f=e.depthModeForSublayer(0,"opaque"===d?t.DepthMode.ReadWrite:t.DepthMode.ReadOnly),m=e.colorModeForRenderPass(),g=e.useProgram(h?"backgroundPattern":"background");let _,y=i;y||(_=e.getBackgroundTiles(),y=Object.values(_).map(t=>t.tileID)),h&&(a.activeTexture.set(c.TEXTURE0),e.imageManager.bind(e.context));const v=r.getCrossfadeParameters();for(const b of y){const d=b.toUnwrapped(),y=i?b.projMatrix:e.transform.calculateProjMatrix(d);e.prepareDrawTile();const x=n?n.getTile(b):_?_[b.key]:new t.Tile(b,u,l.zoom,e),w=h?Qn(y,s,e,h,{tileID:b,tileSize:u},v):Yn(y,s,o);e.prepareDrawProgram(a,g,d);const{tileBoundsBuffer:T,tileBoundsIndexBuffer:C,tileBoundsSegments:E}=e.getTileBoundsBuffers(x);g.draw(a,c.TRIANGLES,f,p,m,t.CullFaceMode.disabled,w,r.id,T,C,E)}},sky:function(e,n,r){const i=e.transform,o="mercator"===i.projection.name||"globe"===i.projection.name?1:t.smoothstep(7,8,i.zoom),s=r.paint.get("sky-opacity")*o;if(0===s)return;const a=e.context,c=r.paint.get("sky-type"),l=new t.DepthMode(a.gl.LEQUAL,t.DepthMode.ReadOnly,[0,1]),u=e.frameCounter/1e3%1;"atmosphere"===c?"offscreen"===e.renderPass?r.needsSkyboxCapture(e)&&(function(e,n,r,i){const o=e.context,s=o.gl;let a=n.skyboxFbo;if(!a){a=n.skyboxFbo=o.createFramebuffer(32,32,!1),n.skyboxGeometry=new Tr(o),n.skyboxTexture=o.gl.createTexture(),s.bindTexture(s.TEXTURE_CUBE_MAP,n.skyboxTexture),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_S,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_WRAP_T,s.CLAMP_TO_EDGE),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MIN_FILTER,s.LINEAR),s.texParameteri(s.TEXTURE_CUBE_MAP,s.TEXTURE_MAG_FILTER,s.LINEAR);for(let t=0;t<6;++t)s.texImage2D(s.TEXTURE_CUBE_MAP_POSITIVE_X+t,0,s.RGBA,32,32,0,s.RGBA,s.UNSIGNED_BYTE,null)}o.bindFramebuffer.set(a.framebuffer),o.viewport.set([0,0,32,32]);const c=n.getCenter(e,!0),l=e.useProgram("skyboxCapture"),u=new Float64Array(16);t.identity(u),t.rotateY(u,u,.5*-Math.PI),Cr(o,n,l,u,c,0),t.identity(u),t.rotateY(u,u,.5*Math.PI),Cr(o,n,l,u,c,1),t.identity(u),t.rotateX(u,u,.5*-Math.PI),Cr(o,n,l,u,c,2),t.identity(u),t.rotateX(u,u,.5*Math.PI),Cr(o,n,l,u,c,3),t.identity(u),Cr(o,n,l,u,c,4),t.identity(u),t.rotateY(u,u,Math.PI),Cr(o,n,l,u,c,5),o.viewport.set([0,0,e.width,e.height])}(e,r),r.markSkyboxValid(e)):"sky"===e.renderPass&&function(e,n,r,i,o){const s=e.context,a=s.gl,c=e.transform,l=e.useProgram("skybox");s.activeTexture.set(a.TEXTURE0),a.bindTexture(a.TEXTURE_CUBE_MAP,n.skyboxTexture);const u=((t,e,n,r,i)=>({u_matrix:t,u_sun_direction:e,u_cubemap:0,u_opacity:r,u_temporal_offset:i}))(c.skyboxMatrix,n.getCenter(e,!1),0,i,o);e.prepareDrawProgram(s,l),l.draw(s,a.TRIANGLES,r,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,u,"skybox",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(e,r,l,s,u):"gradient"===c&&"sky"===e.renderPass&&function(e,n,r,i,o){const s=e.context,a=s.gl,c=e.transform,l=e.useProgram("skyboxGradient");n.skyboxGeometry||(n.skyboxGeometry=new Tr(s)),s.activeTexture.set(a.TEXTURE0);let u=n.colorRampTexture;u||(u=n.colorRampTexture=new t.Texture(s,n.colorRamp,a.RGBA)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const h=((e,n,r,i,o)=>({u_matrix:e,u_color_ramp:0,u_center_direction:n,u_radius:t.degToRad(r),u_opacity:i,u_temporal_offset:o}))(c.skyboxMatrix,n.getCenter(e,!1),n.paint.get("sky-gradient-radius"),i,o);e.prepareDrawProgram(s,l),l.draw(s,a.TRIANGLES,r,t.StencilMode.disabled,e.colorModeForRenderPass(),t.CullFaceMode.backCW,h,"skyboxGradient",n.skyboxGeometry.vertexBuffer,n.skyboxGeometry.indexBuffer,n.skyboxGeometry.segment)}(e,r,l,s,u)},debug:function(t,e,n){for(let r=0;r<n.length;r++)vr(t,e,n[r])},custom:function(e,n,r){const i=e.context,o=r.implementation;if(e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes("custom"))t.warnOnce("Custom layers are not yet supported with non-mercator projections. Use mercator to enable custom layers.");else if("offscreen"===e.renderPass){const t=o.prerender;t&&(e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),t.call(o,i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState())}else if("translucent"===e.renderPass){e.setCustomLayerDefaults(),i.setColorMode(e.colorModeForRenderPass()),i.setStencilMode(t.StencilMode.disabled);const n="3d"===o.renderingMode?new t.DepthMode(e.context.gl.LEQUAL,t.DepthMode.ReadWrite,e.depthRangeFor3D):e.depthModeForSublayer(0,t.DepthMode.ReadOnly);i.setDepthMode(n),o.render(i.gl,e.transform.customLayerMatrix()),i.setDirty(),e.setBaseState(),i.bindFramebuffer.set(null)}}};class Ir{constructor(e,n){this.context=new Ct(e),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.setup(),this.numSublayers=t.SourceCache.maxUnderzooming+t.SourceCache.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Ve,this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this._tileClippingMaskIDs=new Map,this._skippedStencilTileIDs=new Set}updateTerrain(t,e){const n=!!t&&!!t.terrain&&this.transform.projection.supportsTerrain;if(!(n||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new wn(this,t));const r=this._terrain;this.transform.elevation=n?r:null,r.update(t,this.transform,e)}_updateFog(t){const e=t.fog;if(!e||e.getOpacity(this.transform.pitch)<1||e.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[n,r]=e.getFovAdjustedRange(this.transform._fov);if(n>r)return void(this.transform.fogCullDistSq=null);const i=n+.78*(r-n);this.transform.fogCullDistSq=i*i}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled?this._terrain:null}resize(e,n){if(this.width=e*t.exported.devicePixelRatio,this.height=n*t.exported.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const t of this.style.order)this.style._layers[t].resize()}setup(){const e=this.context,n=new t.StructArrayLayout2i4;n.emplaceBack(0,0),n.emplaceBack(t.EXTENT,0),n.emplaceBack(0,t.EXTENT),n.emplaceBack(t.EXTENT,t.EXTENT),this.tileExtentBuffer=e.createVertexBuffer(n,t.posAttributes.members),this.tileExtentSegments=t.SegmentVector.simpleSegment(0,0,4,2);const r=new t.StructArrayLayout2i4;r.emplaceBack(0,0),r.emplaceBack(t.EXTENT,0),r.emplaceBack(0,t.EXTENT),r.emplaceBack(t.EXTENT,t.EXTENT),this.debugBuffer=e.createVertexBuffer(r,t.posAttributes.members),this.debugSegments=t.SegmentVector.simpleSegment(0,0,4,5);const i=new t.StructArrayLayout2i4;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(-1,1),i.emplaceBack(1,1),this.viewportBuffer=e.createVertexBuffer(i,t.posAttributes.members),this.viewportSegments=t.SegmentVector.simpleSegment(0,0,4,2);const o=new t.StructArrayLayout4i8;o.emplaceBack(0,0,0,0),o.emplaceBack(t.EXTENT,0,t.EXTENT,0),o.emplaceBack(0,t.EXTENT,0,t.EXTENT),o.emplaceBack(t.EXTENT,t.EXTENT,t.EXTENT,t.EXTENT),this.mercatorBoundsBuffer=e.createVertexBuffer(o,t.boundsAttributes.members),this.mercatorBoundsSegments=t.SegmentVector.simpleSegment(0,0,4,2);const s=new t.StructArrayLayout3ui6;s.emplaceBack(0,1,2),s.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=e.createIndexBuffer(s);const a=new t.StructArrayLayout1ui2;for(const t of[0,1,3,2,0])a.emplaceBack(t);this.debugIndexBuffer=e.createIndexBuffer(a),this.emptyTexture=new t.Texture(e,new t.RGBAImage({width:1,height:1},Uint8Array.of(0,0,0,0)),e.gl.RGBA),this.identityMat=t.create();const c=this.context.gl;this.stencilClearMode=new t.StencilMode({func:c.ALWAYS,mask:0},0,255,c.ZERO,c.ZERO,c.ZERO),this.loadTimeStamps.push(t.window.performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(t){return t._makeTileBoundsBuffers(this.context,this.transform.projection),t._tileBoundsBuffer?{tileBoundsBuffer:t._tileBoundsBuffer,tileBoundsIndexBuffer:t._tileBoundsIndexBuffer,tileBoundsSegments:t._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context,n=e.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear(),this.useProgram("clippingMask").draw(e,n.TRIANGLES,t.DepthMode.disabled,this.stencilClearMode,t.ColorMode.disabled,t.CullFaceMode.disabled,gn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear())}_renderTileClippingMasks(e,n,r){if(!n||this.currentStencilSource===n.id||!e.isTileClipped()||!r||0===r.length)return;const i=[];let o=!1;if(this._tileClippingMaskIDs&&!this.terrain){for(const t of r)if(this._tileClippingMaskIDs.has(t.key)||(o=!0),this._skippedStencilTileIDs.has(t.key)){if(!n.getTile(t).getBucket(e))continue;this._skippedStencilTileIDs.delete(t.key),i.push(t)}if(!o&&0===i.length)return}const s=this.context,a=s.gl;s.setColorMode(t.ColorMode.disabled),s.setDepthMode(t.DepthMode.disabled);const c=this.useProgram("clippingMask"),l=e=>{const r=n.getTile(e),{tileBoundsBuffer:i,tileBoundsIndexBuffer:o,tileBoundsSegments:l}=this.getTileBoundsBuffers(r);c.draw(s,a.TRIANGLES,t.DepthMode.disabled,new t.StencilMode({func:a.GREATER,mask:255},this._tileClippingMaskIDs.get(e.key)||0,255,a.KEEP,a.KEEP,a.REPLACE),t.ColorMode.disabled,t.CullFaceMode.disabled,gn(e.projMatrix),"$clipping",i,o,l)};if(!o&&i.length>0)for(const t of i)l(t);else{(0===this._tileClippingMaskIDs.size||this.nextStencilID+r.length>256)&&this.clearStencil(),this._tileClippingMaskIDs.clear(),this._skippedStencilTileIDs.clear();for(const t of r)this._tileClippingMaskIDs.set(t.key,this.nextStencilID++),n.getTile(t).getBucket(e)?l(t):this._skippedStencilTileIDs.add(t.key)}0===this._skippedStencilTileIDs.size&&(this.currentStencilSource=n.id)}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,n=this.context.gl;return new t.StencilMode({func:n.NOTEQUAL,mask:255},e,255,n.KEEP,n.KEEP,n.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const n=this.context.gl;return new t.StencilMode({func:n.EQUAL,mask:255},this._tileClippingMaskIDs.get(e.key)||0,0,n.KEEP,n.KEEP,n.REPLACE)}stencilConfigForOverlap(e){const n=this.context.gl,r=e.sort((t,e)=>e.overscaledZ-t.overscaledZ),i=r[r.length-1].overscaledZ,o=r[0].overscaledZ-i+1;if(o>1){this.currentStencilSource=void 0,this.nextStencilID+o>256&&this.clearStencil();const e={};for(let r=0;r<o;r++)e[r+i]=new t.StencilMode({func:n.GEQUAL,mask:255},r+this.nextStencilID,255,n.KEEP,n.KEEP,n.REPLACE);return this.nextStencilID+=o,[e,r]}return[{[i]:t.StencilMode.disabled},r]}colorModeForRenderPass(){const e=this.context.gl;if(this._showOverdrawInspector){const n=1/8;return new t.ColorMode([e.CONSTANT_COLOR,e.ONE],new t.Color(n,n,n,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?t.ColorMode.unblended:t.ColorMode.alphaBlended}depthModeForSublayer(e,n,r){if(!this.opaquePassEnabledForLayer())return t.DepthMode.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new t.DepthMode(r||this.context.gl.LEQUAL,n,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}render(e,n){this.style=e,this.options=n,this.lineAtlas=e.lineAtlas,this.imageManager=e.imageManager,this.glyphManager=e.glyphManager,this.symbolFadeChange=e.placement.symbolFadeChange(t.exported.now()),this.imageManager.beginFrame();const r=this.style.order,i=this.style._sourceCaches;for(const t in i){const e=i[t];e.used&&e.prepare(this.context)}const o={},s={},a={};for(const t in i){const e=i[t];o[t]=e.getVisibleCoordinates(),s[t]=o[t].slice().reverse(),a[t]=e.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(let t=0;t<r.length;t++)if(this.style._layers[r[t]].is3D()){this.opaquePassCutoff=t;break}if(this.terrain&&(this.terrain.updateTileBinding(a),this.opaquePassCutoff=0),"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new t.GlobeSharedBuffers(this.context)),!t.isMapAuthenticated(this.context.gl))return;this.renderPass="offscreen";for(const t of r){const n=this.style._layers[t],r=e._getLayerSourceCache(n);if(!n.hasOffscreenPass()||n.isHidden(this.transform.zoom))continue;const i=r?s[r.id]:void 0;("custom"===n.type||n.isSky()||i&&i.length)&&this.renderLayer(this,r,n,i)}this.depthRangeFor3D=[0,1-(e.order.length+2)*this.numSublayers*this.depthEpsilon],this.terrain&&(this.style.hasSymbolLayers()||this.style.hasCircleLayers())&&this.terrain.drawDepth(),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);let c=t.Color.transparent;if(this.style.fog&&this.style.fog.getOpacity(this.transform.pitch)&&(c=this.style.fog.properties.get("color")),this.context.clear({color:n.showOverdrawInspector?t.Color.black:c,depth:1}),this.clearStencil(),this._showOverdrawInspector=n.showOverdrawInspector,this.renderPass="opaque",!this.terrain)for(this.currentLayer=r.length-1;this.currentLayer>=0;this.currentLayer--){const t=this.style._layers[r[this.currentLayer]],n=e._getLayerSourceCache(t);if(t.isSky())continue;const i=n?s[n.id]:void 0;this._renderTileClippingMasks(t,n,i),this.renderLayer(this,n,t,i)}if(this.renderPass="sky",(t.globeToMercatorTransition(this.transform.zoom)>0||"globe"!==this.transform.projection.name)&&this.transform.isHorizonVisible())for(this.currentLayer=0;this.currentLayer<r.length;this.currentLayer++){const t=this.style._layers[r[this.currentLayer]],n=e._getLayerSourceCache(t);t.isSky()&&this.renderLayer(this,n,t,n?s[n.id]:void 0)}for("globe"===this.transform.projection.name&&function(e){const n=e.context,r=n.gl,i=e.transform,o=new t.DepthMode(r.LEQUAL,t.DepthMode.ReadOnly,[0,1]),s=e.useProgram("globeAtmosphere"),a=i.centerOffset,c=i._camera.getCameraToClipPerspective(i._fov,i.width/i.height,i._nearZ,i._farZ);c[8]=2*-a.x/i.width,c[9]=2*a.y/i.height;const l=t.invert([],c),u=t.mul([],l,i.projMatrix),h={u_frustum_tl:Er([-1,1,1],l),u_frustum_tr:Er([1,1,1],l),u_frustum_br:Er([1,-1,1],l),u_frustum_bl:Er([-1,-1,1],l),u_globe_pos:Er([i.globeMatrix[12],i.globeMatrix[13],i.globeMatrix[14]],u),u_globe_radius:i.worldSize/2/Math.PI-1,u_opacity:1-t.globeToMercatorTransition(i.zoom),u_fadeout_range:2,u_start_color:[1,1,1],u_end_color:[.0118,.7451,.9882]};e.prepareDrawProgram(n,s);const d=e.globeSharedBuffers;d&&s.draw(n,r.TRIANGLES,o,t.StencilMode.disabled,t.ColorMode.alphaBlended,t.CullFaceMode.backCW,h,"skybox",d.atmosphereVertexBuffer,d.atmosphereIndexBuffer,d.atmosphereSegments)}(this),this.renderPass="translucent",this.currentLayer=0;this.currentLayer<r.length;){const t=this.style._layers[r[this.currentLayer]],n=e._getLayerSourceCache(t);if(t.isSky()){++this.currentLayer;continue}if(this.terrain&&this.style.isLayerDraped(t)){if(t.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer);continue}const i=n?("symbol"===t.type?a:s)[n.id]:void 0;this._renderTileClippingMasks(t,n,n?o[n.id]:void 0),this.renderLayer(this,n,t,i),++this.currentLayer}if(this.terrain&&this.terrain.postRender(),this.options.showTileBoundaries||this.options.showQueryGeometry){let n=null;t.values(this.style._layers).forEach(t=>{const r=e._getLayerSourceCache(t);r&&!t.isHidden(this.transform.zoom)&&(!n||n.getSource().maxzoom<r.getSource().maxzoom)&&(n=r)}),n&&this.options.showTileBoundaries&&Sr.debug(this,n,n.getVisibleCoordinates())}this.options.showPadding&&function(t){const e=t.transform.padding;gr(t,t.transform.height-(e.top||0),3,hr),gr(t,e.bottom||0,3,dr),_r(t,e.left||0,3,pr),_r(t,t.transform.width-(e.right||0),3,fr);const n=t.transform.centerPoint;!function(t,e,n,r){yr(t,e-1,n-10,2,20,r),yr(t,e-10,n-1,20,2,r)}(t,n.x,t.transform.height-n.y,mr)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(t.window.performance.now()),this.saveCanvasCopy())}renderLayer(t,e,n,r){n.isHidden(this.transform.zoom)||("background"===n.type||"sky"===n.type||"custom"===n.type||r&&r.length)&&(this.id=n.id,this.gpuTimingStart(n),t.transform.projection.unsupportedLayers&&t.transform.projection.unsupportedLayers.includes(n.type)||Sr[n.type](t,e,n,r,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(t){if(!this.options.gpuTiming)return;const e=this.context.extTimerQuery;let n=this.gpuTimers[t.id];n||(n=this.gpuTimers[t.id]={calls:0,cpuTime:0,query:e.createQueryEXT()}),n.calls++,e.beginQueryEXT(e.TIME_ELAPSED_EXT,n.query)}gpuTimingEnd(){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery;t.endQueryEXT(t.TIME_ELAPSED_EXT)}collectGpuTimers(){const t=this.gpuTimers;return this.gpuTimers={},t}queryGpuTimers(t){const e={};for(const n in t){const r=t[n],i=this.context.extTimerQuery,o=i.getQueryObjectEXT(r.query,i.QUERY_RESULT_EXT)/1e6;i.deleteQueryEXT(r.query),e[n]=o}return e}translatePosMatrix(e,n,r,i,o){if(!r[0]&&!r[1])return e;const s=o?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(s){const t=Math.sin(s),e=Math.cos(s);r=[r[0]*e-r[1]*t,r[0]*t+r[1]*e]}const a=[o?r[0]:D(n,r[0],this.transform.zoom),o?r[1]:D(n,r[1],this.transform.zoom),0],c=new Float32Array(16);return t.translate(c,e,a),c}saveTileTexture(t){const e=this._tileTextures[t.size[0]];e?e.push(t):this._tileTextures[t.size[0]]=[t]}getTileTexture(t){const e=this._tileTextures[t];return e&&e.length>0?e.pop():null}isPatternMissing(t){if(!t)return!1;if(!t.from||!t.to)return!0;const e=this.imageManager.getPattern(t.from.toString()),n=this.imageManager.getPattern(t.to.toString());return!e||!n}currentGlobalDefines(){const t=this.terrain&&this.terrain.renderingToTexture,e=this.style&&this.style.fog,n=[];return this.terrain&&!this.terrain.renderingToTexture&&n.push("TERRAIN"),e&&!t&&0!==e.getOpacity(this.transform.pitch)&&n.push("FOG"),t&&n.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&n.push("OVERDRAW_INSPECTOR"),n}useProgram(t,e,n){this.cache=this.cache||{};const r=n||[],i=this.currentGlobalDefines().concat(r),o=Cn.cacheKey(t,i,e);return this.cache[o]||(this.cache[o]=new Cn(this.context,t,en[t],e,Jn[t],i)),this.cache[o]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const t=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(t.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=t.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new t.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))}destroy(){this._terrain&&this._terrain.destroy(),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}prepareDrawProgram(t,e,n){if(this.terrain&&this.terrain.renderingToTexture)return;const r=this.style.fog;if(r){const i=r.getOpacity(this.transform.pitch);0!==i&&e.setFogUniformValues(t,((t,e,n,r)=>{const i=e.properties.get("color"),o=t.frameCounter/1e3%1,s=[i.r/i.a,i.g/i.a,i.b/i.a,r];return{u_fog_matrix:n?t.transform.calculateFogTileMatrix(n):t.identityMat,u_fog_range:e.getFovAdjustedRange(t.transform._fov),u_fog_color:s,u_fog_horizon_blend:e.properties.get("horizon-blend"),u_fog_temporal_offset:o}})(this,r,n,i))}}setTileLoadedFlag(t){this.tileLoaded=t}saveCanvasCopy(){this.frameCopies.push(this.canvasCopy()),this.tileLoaded=!1}canvasCopy(){const t=this.context.gl,e=t.createTexture();return t.bindTexture(t.TEXTURE_2D,e),t.copyTexImage2D(t.TEXTURE_2D,0,t.RGBA,0,0,t.drawingBufferWidth,t.drawingBufferHeight,0),e}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const t=this.style&&this.style.fog;return!!t&&0!==t.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,n=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const i of r)n[i.key]=e[i.key]||new t.Tile(i,512,this.transform.tileZoom,this);return n}clearBackgroundTiles(){this._backgroundTiles={}}}class kr{constructor(t=0,e=0,n=0,r=0){if(isNaN(t)||t<0||isNaN(e)||e<0||isNaN(n)||n<0||isNaN(r)||r<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=t,this.bottom=e,this.left=n,this.right=r}interpolate(e,n,r){return null!=n.top&&null!=e.top&&(this.top=t.number(e.top,n.top,r)),null!=n.bottom&&null!=e.bottom&&(this.bottom=t.number(e.bottom,n.bottom,r)),null!=n.left&&null!=e.left&&(this.left=t.number(e.left,n.left,r)),null!=n.right&&null!=e.right&&(this.right=t.number(e.right,n.right,r)),this}getCenter(e,n){const r=t.clamp((this.left+e-this.right)/2,0,e),i=t.clamp((this.top+n-this.bottom)/2,0,n);return new t.pointGeometry(r,i)}equals(t){return this.top===t.top&&this.bottom===t.bottom&&this.left===t.left&&this.right===t.right}clone(){return new kr(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}function Ar(e,n){const r=t.getColumn(e,3);t.fromQuat(e,n),t.setColumn(e,3,r)}function Mr(e,n){const r=t.identity$1([]);return t.rotateZ$1(r,r,-n),t.rotateX$1(r,r,-e),r}function Or(e,n){const r=[e[0],e[1],0],i=[n[0],n[1],0];if(t.length(r)>=1e-15){const e=t.normalize([],r);t.scale$2(i,e,t.dot(i,e)),n[0]=i[0],n[1]=i[1]}const o=t.cross([],n,e);if(t.len(o)<1e-15)return null;const s=Math.atan2(-o[1],o[0]);return Mr(Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2]),s)}class Pr{constructor(t,e){this.position=t,this.orientation=e}get position(){return this._position}set position(e){if(e){const n=e instanceof t.MercatorCoordinate?e:new t.MercatorCoordinate(e[0],e[1],e[2]);this._renderWorldCopies&&(n.x=t.wrap(n.x,0,1)),this._position=n}else this._position=null}lookAtPoint(e,n){if(this.orientation=null,!this.position)return;const r=this._elevation?this._elevation.getAtPointOrZero(t.MercatorCoordinate.fromLngLat(e)):0,i=this.position,o=t.MercatorCoordinate.fromLngLat(e,r),s=[o.x-i.x,o.y-i.y,o.z-i.z];n||(n=[0,0,1]),n[2]=Math.abs(n[2]),this.orientation=Or(s,n)}setPitchBearing(e,n){this.orientation=Mr(t.degToRad(e),t.degToRad(-n))}}class Dr{constructor(e,n){this._transform=t.identity([]),this.orientation=n,this.position=e}get mercatorPosition(){const e=this.position;return new t.MercatorCoordinate(e[0],e[1],e[2])}get position(){const e=t.getColumn(this._transform,3);return[e[0],e[1],e[2]]}set position(e){var n;e&&t.setColumn(this._transform,3,[(n=e)[0],n[1],n[2],1])}get orientation(){return this._orientation}set orientation(e){this._orientation=e||t.identity$1([]),e&&Ar(this._transform,this._orientation)}getPitchBearing(){const t=this.forward(),e=this.right();return{bearing:Math.atan2(-e[1],e[0]),pitch:Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2])}}setPitchBearing(t,e){this._orientation=Mr(t,e),Ar(this._transform,this._orientation)}forward(){const e=t.getColumn(this._transform,2);return[-e[0],-e[1],-e[2]]}up(){const e=t.getColumn(this._transform,1);return[-e[0],-e[1],-e[2]]}right(){const e=t.getColumn(this._transform,0);return[e[0],e[1],e[2]]}getCameraToWorld(e,n){const r=new Float64Array(16);return t.invert(r,this.getWorldToCamera(e,n)),r}getWorldToCameraPosition(e,n,r){const i=this.position;t.scale$2(i,i,-e);const o=new Float64Array(16);return t.fromScaling(o,[r,r,r]),t.translate(o,o,i),o[10]*=n,o}getWorldToCamera(e,n){const r=new Float64Array(16),i=new Float64Array(4),o=this.position;return t.conjugate(i,this._orientation),t.scale$2(o,o,-e),t.fromQuat(r,i),t.translate(r,r,o),r[1]*=-1,r[5]*=-1,r[9]*=-1,r[13]*=-1,r[8]*=n,r[9]*=n,r[10]*=n,r[11]*=n,r}getCameraToClipPerspective(e,n,r,i){const o=new Float64Array(16);return t.perspective(o,e,n,r,i),o}getDistanceToElevation(e){const n=0===e?0:t.mercatorZfromAltitude(e,this.position[1]),r=this.forward();return(n-this.position[2])/r[2]}clone(){return new Dr([...this.position],[...this.orientation])}}function Rr(e,n){const r=Lr(e),i=function(e,n,r,i,o){const s=new t.LngLat(r.lng-180*jr,r.lat),a=new t.LngLat(r.lng+180*jr,r.lat),c=e.project(s.lng,s.lat),l=e.project(a.lng,a.lat),u=-Math.atan2(l.y-c.y,l.x-c.x),h=t.MercatorCoordinate.fromLngLat(r);h.y=t.clamp(h.y,-.999975,.999975);const d=h.toLngLat(),p=e.project(d.lng,d.lat),f=t.MercatorCoordinate.fromLngLat(d);f.x+=jr;const m=f.toLngLat(),g=e.project(m.lng,m.lat),_=Fr(g.x-p.x,g.y-p.y,u),y=t.MercatorCoordinate.fromLngLat(d);y.y+=jr;const v=y.toLngLat(),b=e.project(v.lng,v.lat),x=Fr(b.x-p.x,b.y-p.y,u),w=Math.abs(_.x)/Math.abs(x.y),T=t.identity([]);t.rotateZ(T,T,-u*(1-(o?0:i)));const C=t.identity([]);return t.scale(C,C,[1,1-(1-w)*i,1]),C[4]=-x.x/x.y*i,t.rotateZ(C,C,u),t.multiply$1(C,T,C),C}(e.projection,0,e.center,r,n),o=Nr(e);return t.scale(i,i,[o,o,1]),i}function Nr(e){const n=e.projection,r=Lr(e),i=zr(n,e.center),o=zr(n,t.LngLat.convert(n.center));return Math.pow(2,i*r+(1-r)*o)}function Lr(e){const n=e.projection.range;if(!n)return 0;const r=Math.max(e.width,e.height),i=Math.log(r/1024)/Math.LN2;return t.smoothstep(n[0]+i,n[1]+i,e.zoom)}const jr=1/4e4;function zr(e,n){const r=t.clamp(n.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),i=new t.LngLat(n.lng-180*jr,r),o=new t.LngLat(n.lng+180*jr,r),s=e.project(i.lng,r),a=e.project(o.lng,r),c=t.MercatorCoordinate.fromLngLat(i),l=t.MercatorCoordinate.fromLngLat(o),u=a.x-s.x,h=a.y-s.y,d=l.x-c.x,p=l.y-c.y,f=Math.sqrt((d*d+p*p)/(u*u+h*h));return Math.log(f)/Math.LN2}function Fr(t,e,n){const r=Math.cos(n),i=Math.sin(n);return{x:t*r-e*i,y:t*i+e*r}}class Br{constructor(e,n,r,i,o,s,a){this.tileSize=512,this._renderWorldCopies=void 0===o||o,this._minZoom=e||0,this._maxZoom=n||22,this._minPitch=null==r?0:r,this._maxPitch=null==i?60:i,this.setProjection(s),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new t.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new kr,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._distanceTileDataCache={},this._camera=new Dr,this._centerAltitude=0,this._centerAltitudeValidForExaggeration=0,this._averageElevation=0,this.cameraElevationReference="ground",this._projectionScaler=1,this._horizonShift=.1}clone(){const t=new Br(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection());return t._elevation=this._elevation,t._centerAltitude=this._centerAltitude,t._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,t.tileSize=this.tileSize,t.width=this.width,t.height=this.height,t.cameraElevationReference=this.cameraElevationReference,t._center=this._center,t._setZoom(this.zoom),t._seaLevelZoom=this._seaLevelZoom,t.angle=this.angle,t._fov=this._fov,t._pitch=this._pitch,t._nearZ=this._nearZ,t._farZ=this._farZ,t._averageElevation=this._averageElevation,t._unmodified=this._unmodified,t._edgeInsets=this._edgeInsets.clone(),t._camera=this._camera.clone(),t._calcMatrices(),t.freezeTileCoverage=this.freezeTileCoverage,t}get elevation(){return this._elevation}set elevation(t){this._elevation!==t&&(this._elevation=t,this._updateCameraOnTerrain(),this._calcMatrices())}updateElevation(t){const e=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||e)&&this._updateCameraOnTerrain(),(t||e)&&this._constrainCameraAltitude(),this._calcMatrices()}getProjection(){return t.pick(this.projection,["name","center","parallels"])}setProjection(e){null==e&&(e={name:"mercator"}),this.projectionOptions=e;const n=this.projection?this.getProjection():void 0;this.projection=t.getProjection(e);const r=this.getProjection();return i(n,r)?null:(this._calcMatrices(),r)}get minZoom(){return this._minZoom}set minZoom(t){this._minZoom!==t&&(this._minZoom=t,this.zoom=Math.max(this.zoom,t))}get maxZoom(){return this._maxZoom}set maxZoom(t){this._maxZoom!==t&&(this._maxZoom=t,this.zoom=Math.min(this.zoom,t))}get minPitch(){return this._minPitch}set minPitch(t){this._minPitch!==t&&(this._minPitch=t,this.pitch=Math.max(this.pitch,t))}get maxPitch(){return this._maxPitch}set maxPitch(t){this._maxPitch!==t&&(this._maxPitch=t,this.pitch=Math.min(this.pitch,t))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(t){void 0===t?t=!0:null===t&&(t=!1),this._renderWorldCopies=t}get worldSize(){return this.tileSize*this.scale}get cameraWorldSize(){const t=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(t))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.cameraWorldSize)}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new t.pointGeometry(this.width,this.height)}get bearing(){return t.wrap(this.rotation,-180,180)}set bearing(t){this.rotation=t}get rotation(){return-this.angle/Math.PI*180}set rotation(e){const n=-e*Math.PI/180;var r;this.angle!==n&&(this._unmodified=!1,this.angle=n,this._calcMatrices(),this.rotationMatrix=(r=new t.ARRAY_TYPE(4),t.ARRAY_TYPE!=Float32Array&&(r[1]=0,r[2]=0),r[0]=1,r[3]=1,r),function(t,e,n){var r=e[0],i=e[1],o=e[2],s=e[3],a=Math.sin(n),c=Math.cos(n);t[0]=r*c+o*a,t[1]=i*c+s*a,t[2]=r*-a+o*c,t[3]=i*-a+s*c}(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(e){const n=t.clamp(e,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==n&&(this._unmodified=!1,this._pitch=n,this._calcMatrices())}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=t/180*Math.PI,this._calcMatrices())}get averageElevation(){return this._averageElevation}set averageElevation(t){this._averageElevation=t,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(t){const e=Math.min(Math.max(t,this.minZoom),this.maxZoom);this._zoom!==e&&(this._unmodified=!1,this._setZoom(e),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(t){this._zoom=t,this.scale=this.zoomScale(t),this.tileZoom=Math.floor(t),this.zoomFraction=t-this.tileZoom}_updateCameraOnTerrain(){if(!this._elevation||!this._elevation.isDataAvailableAtPoint(this.locationCoordinate(this.center)))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=0);const t=this._elevation;this._centerAltitude=t.getAtPointOrZero(this.locationCoordinate(this.center)),this._centerAltitudeValidForExaggeration=t.exaggeration(),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){0!==this._centerAltitudeValidForExaggeration&&(this._seaLevelZoom=this._zoomFromMercatorZ((this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize))}sampleAverageElevation(){if(!this._elevation)return 0;const e=this._elevation,n=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],r=this.horizonLineFromTop();let i=0,o=0;for(let s=0;s<n.length;s++){const a=new t.pointGeometry(n[s][0]*this.width,r+n[s][1]*(this.height-r)),c=e.pointCoordinate(a);if(!c)continue;const l=1/Math.hypot(c[0]-this._camera.position[0],c[1]-this._camera.position[1]);i+=c[3]*l,o+=l}return 0===o?NaN:i/o}get center(){return this._center}set center(t){t.lat===this._center.lat&&t.lng===this._center.lng||(this._unmodified=!1,this._center=t,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const t=this._seaLevelZoom,e=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),n=this.pixelsPerMeter/this.worldSize*e,r=this._mercatorZfromZoom(t),i=this._mercatorZfromZoom(this._maxZoom),o=Math.max(r-n,i);this._setZoom(this._zoomFromMercatorZ(o))}get padding(){return this._edgeInsets.toJSON()}set padding(t){this._edgeInsets.equals(t)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,t,1),this._calcMatrices())}computeZoomRelativeTo(e){const n=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,e.toAltitude()));let r;r=e.z<this._camera.position[2]?[n.x,n.y,n.z]:[e.x,e.y,e.z];const i=t.length(t.sub([],this._camera.position,r));return t.clamp(this._zoomFromMercatorZ(i),this._minZoom,this._maxZoom)}setFreeCameraOptions(e){if(!this.height)return;if(!e.position&&!e.orientation)return;this._updateCameraState();let n=!1;if(e.orientation&&!t.exactEquals(e.orientation,this._camera.orientation)&&(n=this._setCameraOrientation(e.orientation)),e.position){const r=[e.position.x,e.position.y,e.position.z];t.exactEquals$1(r,this._camera.position)||(this._setCameraPosition(r),n=!0)}n&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const e=this._camera.position,n=new Pr;return n.position=new t.MercatorCoordinate(e[0],e[1],e[2]),n.orientation=this._camera.orientation,n._elevation=this.elevation,n._renderWorldCopies=this.renderWorldCopies,n}_setCameraOrientation(e){if(!t.length$1(e))return!1;t.normalize$1(e,e);const n=t.transformQuat([],[0,0,-1],e),r=t.transformQuat([],[0,-1,0],e);if(r[2]<0)return!1;const i=Or(n,r);return!!i&&(this._camera.orientation=i,!0)}_setCameraPosition(e){const n=this.zoomScale(this.minZoom)*this.tileSize,r=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;e[2]=t.clamp(e[2],i/r,i/n),this._camera.position=e}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(t){return this._edgeInsets.equals(t)}interpolatePadding(t,e,n){this._unmodified=!1,this._edgeInsets.interpolate(t,e,n),this._constrain(),this._calcMatrices()}coveringZoomLevel(t){const e=(t.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/t.tileSize));return Math.max(0,e)}getVisibleUnwrappedCoordinates(e){const n=[new t.UnwrappedTileID(0,e)];if(this.renderWorldCopies){const r=this.pointCoordinate(new t.pointGeometry(0,0)),i=this.pointCoordinate(new t.pointGeometry(this.width,0)),o=this.pointCoordinate(new t.pointGeometry(this.width,this.height)),s=this.pointCoordinate(new t.pointGeometry(0,this.height)),a=Math.floor(Math.min(r.x,i.x,o.x,s.x)),c=Math.floor(Math.max(r.x,i.x,o.x,s.x)),l=1;for(let u=a-l;u<=c+l;u++)0!==u&&n.push(new t.UnwrappedTileID(u,e))}return n}coveringTiles(e){let n=this.coveringZoomLevel(e);const r=n,i=this.elevation&&!e.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==e.minzoom&&n<e.minzoom)return[];void 0!==e.maxzoom&&n>e.maxzoom&&(n=e.maxzoom);const s=this.locationCoordinate(this.center),a=this.center.lat,c=1<<n,l=[c*s.x,c*s.y,0],u="globe"===this.projection.name,h=!u,d=t.Frustum.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,n,h),p=u?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=c*t.mercatorZfromAltitude(1,this.center.lat),m=this._camera.position[2]/t.mercatorZfromAltitude(1,this.center.lat),g=[c*p.x,c*p.y,m*(h?1:f)],_=this.cameraToCenterDistance/e.tileSize*(e.roundZoom?1:.502),y=this.pitch<=60&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace?n:0,v=e.isTerrainDEM&&this._elevation?1e4*this._elevation.exaggeration():this._centerAltitude,b=e.isTerrainDEM?-v:this._elevation?this._elevation.getMinElevationBelowMSL():0,x=this.projection.isReprojectedInTileSpace?Nr(this):1,w=e=>{const n=1/4e4,r=new t.MercatorCoordinate(e.x+n,e.y,e.z),i=new t.MercatorCoordinate(e.x,e.y+n,e.z),o=e.toLngLat(),s=r.toLngLat(),a=i.toLngLat(),c=this.locationCoordinate(o),l=this.locationCoordinate(s),u=this.locationCoordinate(a),h=Math.hypot(l.x-c.x,l.y-c.y),d=Math.hypot(u.x-c.x,u.y-c.y);return Math.sqrt(h*d)*x/n},T=e=>{const n=v,r=b;return{aabb:t.tileAABB(this,c,0,0,0,e,r,n,this.projection),zoom:0,x:0,y:0,minZ:r,maxZ:n,wrap:e,fullyVisible:!1}},C=[];let E=[];const S=n,I=e.reparseOverscaled?r:n,k=t=>t*t,A=k((m-this._centerAltitude)*f),M=t=>{if(!this._elevation||!t.tileID||!o)return;const e=this._elevation.getMinMaxForTile(t.tileID),n=t.aabb;e?(n.min[2]=e.min,n.max[2]=e.max,n.center[2]=(n.min[2]+n.max[2])/2):(t.shouldSplit=O(t),t.shouldSplit||(n.min[2]=n.max[2]=n.center[2]=this._centerAltitude))},O=e=>{if(e.zoom<y)return!0;if(e.zoom===S)return!1;if(null!=e.shouldSplit)return e.shouldSplit;const n=e.aabb.distanceX(g),o=e.aabb.distanceY(g);let s=A,c=1;if(u){s=k(e.aabb.distanceZ(g));const n=Math.pow(2,e.zoom),r=t.latFromMercatorY((e.y+1)/n),i=t.latFromMercatorY(e.y/n),o=Math.min(Math.max(a,r),i),l=t.circumferenceAtLatitude(o)/t.circumferenceAtLatitude(a);c=Math.min(l,1)}else if(i&&(s=k(e.aabb.distanceZ(g)*f)),this.projection.isReprojectedInTileSpace&&r<=5){const n=Math.pow(2,e.zoom),r=w(new t.MercatorCoordinate((e.x+.5)/n,(e.y+.5)/n));c=r>.85?1:r}const l=n*n+o*o+s;return l<k((1<<S-e.zoom)*_*c*((t,e)=>{if(e*k(.707)<t)return 1;const n=Math.sqrt(e/t);return n/(1.4144271570014144+(Math.pow(1.1,n-1.4144271570014144+1)-1)/(1.1-1)-1)})(Math.max(s,A),l))};if(this.renderWorldCopies)for(let t=1;t<=3;t++)C.push(T(-t)),C.push(T(t));for(C.push(T(0));C.length>0;){const r=C.pop(),s=r.x,a=r.y;let h=r.fullyVisible;if(!h){const t=r.aabb.intersects(d);if(0===t)continue;h=2===t}if(r.zoom!==S&&O(r))for(let e=0;e<4;e++){const n=(s<<1)+e%2,l=(a<<1)+(e>>1),d={aabb:o?r.aabb.quadrant(e):t.tileAABB(this,c,r.zoom+1,n,l,r.wrap,r.minZ,r.maxZ,this.projection),zoom:r.zoom+1,x:n,y:l,wrap:r.wrap,fullyVisible:h,tileID:void 0,shouldSplit:void 0,minZ:r.minZ,maxZ:r.maxZ};i&&!u&&(d.tileID=new t.OverscaledTileID(r.zoom+1===S?I:r.zoom+1,r.wrap,r.zoom+1,n,l),M(d)),C.push(d)}else{const i=r.zoom===S?I:r.zoom;if(e.minzoom&&e.minzoom>i)continue;const o=l[0]-(.5+s+(r.wrap<<r.zoom))*(1<<n-r.zoom),c=l[1]-.5-a,u=r.tileID?r.tileID:new t.OverscaledTileID(i,r.wrap,r.zoom,s,a);E.push({tileID:u,distanceSq:o*o+c*c})}}if(this.fogCullDistSq){const n=this.fogCullDistSq,r=this.horizonLineFromTop();E=E.filter(i=>{const o=[0,0,0,1],s=[t.EXTENT,t.EXTENT,0,1],a=this.calculateFogTileMatrix(i.tileID.toUnwrapped());t.transformMat4$1(o,o,a),t.transformMat4$1(s,s,a);const c=t.getAABBPointSquareDist(o,s);if(0===c)return!0;let l=!1;const u=this._elevation;if(u&&c>n&&0!==r){const n=this.calculateProjMatrix(i.tileID.toUnwrapped());let o;e.isTerrainDEM||(o=u.getMinMaxForTile(i.tileID)),o||(o={min:b,max:v});const s=t.furthestTileCorner(this.rotation),a=[s[0]*t.EXTENT,s[1]*t.EXTENT,o.max];t.transformMat4(a,a,n),l=(1-a[1])*this.height*.5<r}return c<n||l})}return E.sort((t,e)=>t.distanceSq-e.distanceSq).map(t=>t.tileID)}resize(t,e){this.width=t,this.height=e,this.pixelsToGLUnits=[2/t,-2/e],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(t){return Math.pow(2,t)}scaleZoom(t){return Math.log(t)/Math.LN2}project(e){const n=t.clamp(e.lat,-t.MAX_MERCATOR_LATITUDE,t.MAX_MERCATOR_LATITUDE),r=this.projection.project(e.lng,n);return new t.pointGeometry(r.x*this.worldSize,r.y*this.worldSize)}unproject(t){return this.projection.unproject(t.x/this.worldSize,t.y/this.worldSize)}get point(){return this.project(this.center)}setLocationAtPoint(e,n){let r,i;const o=this.centerPoint;if("globe"===this.projection.name){const t=this.worldSize;r=(n.x-o.x)/t,i=(n.y-o.y)/t}else{const t=this.pointCoordinate(n),e=this.pointCoordinate(o);r=t.x-e.x,i=t.y-e.y}const s=this.locationCoordinate(e);this.setLocation(new t.MercatorCoordinate(s.x-r,s.y-i))}setLocation(t){this.center=this.coordinateLocation(t),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(t){return this.projection.locationPoint(this,t)}locationPoint3D(t){return this._coordinatePoint(this.locationCoordinate(t),!0)}pointLocation(t){return this.coordinateLocation(this.pointCoordinate(t))}pointLocation3D(t){return this.coordinateLocation(this.pointCoordinate3D(t))}locationCoordinate(e,n){const r=n?t.mercatorZfromAltitude(n,e.lat):void 0,i=this.projection.project(e.lng,e.lat);return new t.MercatorCoordinate(i.x,i.y,r)}coordinateLocation(t){return this.projection.unproject(t.x,t.y)}pointRayIntersection(e,n){const r=null!=n?n:this._centerAltitude,i=[e.x,e.y,0,1],o=[e.x,e.y,1,1];t.transformMat4$1(i,i,this.pixelMatrixInverse),t.transformMat4$1(o,o,this.pixelMatrixInverse);const s=o[3];t.scale$1(i,i,1/i[3]),t.scale$1(o,o,1/s);const a=i[2],c=o[2];return{p0:i,p1:o,t:a===c?0:(r-a)/(c-a)}}screenPointToMercatorRay(e){const n=[e.x,e.y,0,1],r=[e.x,e.y,1,1];return t.transformMat4$1(n,n,this.pixelMatrixInverse),t.transformMat4$1(r,r,this.pixelMatrixInverse),t.scale$1(n,n,1/n[3]),t.scale$1(r,r,1/r[3]),n[2]=t.mercatorZfromAltitude(n[2],this._center.lat)*this.worldSize,r[2]=t.mercatorZfromAltitude(r[2],this._center.lat)*this.worldSize,t.scale$1(n,n,1/this.worldSize),t.scale$1(r,r,1/this.worldSize),new t.Ray([n[0],n[1],n[2]],t.normalize([],t.sub([],r,n)))}rayIntersectionCoordinate(e){const{p0:n,p1:r,t:i}=e,o=t.mercatorZfromAltitude(n[2],this._center.lat),s=t.mercatorZfromAltitude(r[2],this._center.lat);return new t.MercatorCoordinate(t.number(n[0],r[0],i)/this.worldSize,t.number(n[1],r[1],i)/this.worldSize,t.number(o,s,i))}pointCoordinate(t,e=this._centerAltitude){return this.projection.pointCoordinate(this,t.x,t.y,e)}pointCoordinate3D(e){if(!this.elevation)return this.pointCoordinate(e);const n=this.elevation;let r=this.elevation.pointCoordinate(e);if(r)return new t.MercatorCoordinate(r[0],r[1],r[2]);let i=0,o=this.horizonLineFromTop();if(e.y>o)return this.pointCoordinate(e);const s=.02*o,a=e.clone();for(let c=0;c<10&&o-i>s;c++){a.y=t.number(i,o,.66);const e=n.pointCoordinate(a);e?(o=a.y,r=e):i=a.y}return r?new t.MercatorCoordinate(r[0],r[1],r[2]):this.pointCoordinate(e)}isPointAboveHorizon(t){if(this.elevation)return!this.elevation.pointCoordinate(t);{const e=this.horizonLineFromTop();return t.y<e}}_coordinatePoint(e,n){const r=n&&this.elevation?this.elevation.getAtPointOrZero(e,this._centerAltitude):this._centerAltitude,i=[e.x*this.worldSize,e.y*this.worldSize,r+e.toAltitude(),1];return t.transformMat4$1(i,i,this.pixelMatrix),i[3]>0?new t.pointGeometry(i[0]/i[3],i[1]/i[3]):new t.pointGeometry(Number.MAX_VALUE,Number.MAX_VALUE)}_getBounds(e,n){const r=new t.pointGeometry(this._edgeInsets.left,this._edgeInsets.top),i=new t.pointGeometry(this.width-this._edgeInsets.right,this._edgeInsets.top),o=new t.pointGeometry(this.width-this._edgeInsets.right,this.height-this._edgeInsets.bottom),s=new t.pointGeometry(this._edgeInsets.left,this.height-this._edgeInsets.bottom);let a=this.pointCoordinate(r,e),c=this.pointCoordinate(i,e);const l=this.pointCoordinate(o,n),u=this.pointCoordinate(s,n),h=(t,e)=>(e.y-t.y)/(e.x-t.x);return a.y>1&&c.y>=0?a=new t.MercatorCoordinate((1-u.y)/h(u,a)+u.x,1):a.y<0&&c.y<=1&&(a=new t.MercatorCoordinate(-u.y/h(u,a)+u.x,0)),c.y>1&&a.y>=0?c=new t.MercatorCoordinate((1-l.y)/h(l,c)+l.x,1):c.y<0&&a.y<=1&&(c=new t.MercatorCoordinate(-l.y/h(l,c)+l.x,0)),(new t.LngLatBounds).extend(this.coordinateLocation(a)).extend(this.coordinateLocation(c)).extend(this.coordinateLocation(u)).extend(this.coordinateLocation(l))}_getBounds3D(){const t=this.elevation;if(!t.visibleDemTiles.length)return this._getBounds(0,0);const e=t.visibleDemTiles.reduce((t,e)=>{if(e.dem){const n=e.dem.tree;t.min=Math.min(t.min,n.minimums[0]),t.max=Math.max(t.max,n.maximums[0])}return t},{min:Number.MAX_VALUE,max:0});return this._getBounds(e.min*t.exaggeration(),e.max*t.exaggeration())}getBounds(){return this._terrainEnabled()?this._getBounds3D():this._getBounds(0,0)}horizonLineFromTop(t=!0){const e=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))+this.centerOffset.y,n=this.height/2-e*(1-this._horizonShift);return t?Math.max(0,n):n}getMaxBounds(){return this.maxBounds}setMaxBounds(e){this.maxBounds=e,this.minLat=-t.MAX_MERCATOR_LATITUDE,this.maxLat=t.MAX_MERCATOR_LATITUDE,this.minLng=-180,this.maxLng=180,e&&(this.minLat=e.getSouth(),this.maxLat=e.getNorth(),this.minLng=e.getWest(),this.maxLng=e.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=t.mercatorXfromLng(this.minLng)*this.tileSize,this.worldMaxX=t.mercatorXfromLng(this.maxLng)*this.tileSize,this.worldMinY=t.mercatorYfromLat(this.maxLat)*this.tileSize,this.worldMaxY=t.mercatorYfromLat(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(t,e){return this.projection.createTileMatrix(this,e,t)}calculateDistanceTileData(e){const n=e.key,r=this._distanceTileDataCache;if(r[n])return r[n];const i=e.canonical,o=1/this.height,s=this.cameraWorldSize/this.zoomScale(i.z),a=(i.x+Math.pow(2,i.z)*e.wrap)*s,c=i.y*s,l=this.point,u=this.angle,h=Math.sin(-u),d=-Math.cos(-u);return r[n]={bearing:[h,d],center:[(l.x-a)*o,(l.y-c)*o],scale:s/t.EXTENT*o},r[n]}calculateFogTileMatrix(e){const n=e.key,r=this._fogTileMatrixCache;if(r[n])return r[n];const i=this.calculatePosMatrix(e,this.cameraWorldSize);return t.multiply$1(i,this.worldToFogMatrix,i),r[n]=new Float32Array(i),r[n]}calculateProjMatrix(e,n=!1){const r=e.key,i=n?this._alignedProjMatrixCache:this._projMatrixCache;if(i[r])return i[r];const o=this.calculatePosMatrix(e,this.worldSize);return t.multiply$1(o,this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.alignedProjMatrix:this.projMatrix,o),i[r]=new Float32Array(o),i[r]}calculatePixelsToTileUnitsMatrix(e){const n=e.tileID.key,r=this._pixelsToTileUnitsCache;if(r[n])return r[n];const i=function(e,n){const{scale:r}=e.tileTransform,i=r*t.EXTENT/(e.tileSize*Math.pow(2,n.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return o=new Float32Array(4),c=(s=n.inverseAdjustmentMatrix)[1],l=s[2],u=s[3],d=(a=[i,i])[1],o[0]=s[0]*(h=a[0]),o[1]=c*h,o[2]=l*d,o[3]=u*d,o;var o,s,a,c,l,u,h,d}(e,this);return r[n]=i,r[n]}customLayerMatrix(){return this.mercatorMatrix.slice()}recenterOnTerrain(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const n=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(n),i=this._camera.forward(),o=t.mercatorZfromAltitude(1,this._center.lat);r[2]/=o,i[2]/=o,t.normalize(i,i);const s=e.raycast(r,i,e.exaggeration());if(s){const e=t.scaleAndAdd([],r,i,s),n=new t.MercatorCoordinate(e[0],e[1],t.mercatorZfromAltitude(e[2],t.latFromMercatorY(e[1]))),a=(n.z+t.length([n.x-r[0],n.y-r[1],n.z-r[2]*o]))*this._projectionScaler;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=n.toAltitude(),this._center=this.coordinateLocation(n),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCameraAltitude(){if(!this._elevation)return;const e=this._elevation;this._updateCameraState();const n=t.mercatorZfromAltitude(1,this._center.lat)*this.worldSize,r=this._computeCameraPosition(n),i=e.getAtPointOrZero(new t.MercatorCoordinate(...r)),o=this._minimumHeightOverTerrain()*Math.cos(t.degToRad(this._maxPitch)),s=this._camera.position[2]-this.pixelsPerMeter/this.worldSize*i;if(s<o){const e=this.locationCoordinate(this._center,this._centerAltitude),n=[e.x-r[0],e.y-r[1],e.z-r[2]],i=t.length(n);n[2]-=(o-s)/this._projectionScaler;const a=t.length(n);if(0===a)return;t.scale$2(n,n,i/a*this._projectionScaler),this._camera.position=[e.x-n[0],e.y-n[1],e.z*this._projectionScaler-n[2]],this._camera.orientation=Or(n,this._camera.up()),this._updateStateFromCamera()}}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;if(this._constraining=!0,this.projection.isReprojectedInTileSpace){const e=this.center;return e.lat=t.clamp(e.lat,this.minLat,this.maxLat),!this.maxBounds&&this.renderWorldCopies||(e.lng=t.clamp(e.lng,this.minLng,this.maxLng)),this.center=e,void(this._constraining=!1)}const e=this._unmodified,{x:n,y:r}=this.point;let i=0,o=n,s=r;const a=this.width/2,c=this.height/2,l=this.worldMinY*this.scale,u=this.worldMaxY*this.scale;if(r-c<l&&(s=l+c),r+c>u&&(s=u-c),u-l<this.height&&(i=Math.max(i,this.height/(u-l)),s=(u+l)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const t=this.worldMinX*this.scale,e=this.worldMaxX*this.scale,r=this.worldSize/2-(t+e)/2;o=(n+r+this.worldSize)%this.worldSize-r,o-a<t&&(o=t+a),o+a>e&&(o=e-a),e-t<this.width&&(i=Math.max(i,this.width/(e-t)),o=(e+t)/2)}o===n&&s===r||(this.center=this.unproject(new t.pointGeometry(o,s))),i&&(this.zoom+=this.scaleZoom(i)),this._constrainCameraAltitude(),this._unmodified=e,this._constraining=!1}_minZoomForBounds(){let t=Math.max(0,this.scaleZoom(this.height/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(t=Math.max(t,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),t}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const e=this._fov/2,n=this.centerOffset,r=this.pixelsPerMeter;this._projectionScaler=r/(t.mercatorZfromAltitude(1,this.center.lat)*this.worldSize),this.cameraToCenterDistance=.5/Math.tan(e)*this.height*this._projectionScaler,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const i=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?r:1),o=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);o[8]=2*-n.x/this.width,o[9]=2*n.y/this.height;let s=t.mul([],o,i);if(this.projection.isReprojectedInTileSpace){const e=this.locationCoordinate(this.center),n=t.identity([]);t.translate(n,n,[e.x*this.worldSize,e.y*this.worldSize,0]),t.multiply$1(n,n,Rr(this)),t.translate(n,n,[-e.x*this.worldSize,-e.y*this.worldSize,0]),t.multiply$1(s,s,n),this.inverseAdjustmentMatrix=function(t){const e=Rr(t,!0);return y([],[e[0],e[1],e[4],e[5]])}(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];this.mercatorMatrix=t.scale([],s,[this.worldSize,this.worldSize,this.worldSize/r,1]),this.projMatrix=s,this.invProjMatrix=t.invert(new Float64Array(16),this.projMatrix);const a=new Float32Array(16);t.identity(a),t.scale(a,a,[1,-1,1]),t.rotateX(a,a,this._pitch),t.rotateZ(a,a,this.angle);const c=t.perspective(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ),l=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;c[8]=2*-n.x/this.width,c[9]=2*(n.y+l)/this.height,this.skyboxMatrix=t.multiply$1(a,c,a);const u=this.point,h=u.x,d=u.y,p=this.width%2/2,f=this.height%2/2,m=Math.cos(this.angle),g=Math.sin(this.angle),_=h-Math.round(h)+m*p+g*f,v=d-Math.round(d)+m*f+g*p,b=new Float64Array(s);if(t.translate(b,b,[_>.5?_-1:_,v>.5?v-1:v,0]),this.alignedProjMatrix=b,s=t.create(),t.scale(s,s,[this.width/2,-this.height/2,1]),t.translate(s,s,[1,-1,0]),this.labelPlaneMatrix=s,s=t.create(),t.scale(s,s,[1,-1,1]),t.translate(s,s,[-1,-1,0]),t.scale(s,s,[2/this.width,2/this.height,1]),this.glCoordMatrix=s,this.pixelMatrix=t.multiply$1(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),this._calcFogMatrices(),this._distanceTileDataCache={},s=t.invert(new Float64Array(16),this.pixelMatrix),!s)throw new Error("failed to invert matrix");this.pixelMatrixInverse=s,this.globeMatrix="globe"===this.projection.name?t.calculateGlobeMatrix(this):s,this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const e=this.cameraWorldSize,n=this.cameraPixelsPerMeter,r=this._camera.position,i=1/this.height,o=[e,e,n];t.scale$2(o,o,i),t.scale$2(r,r,-1),t.multiply$2(r,r,o);const s=t.create();t.translate(s,s,r),t.scale(s,s,o),this.mercatorFogMatrix=s,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(e,n,i)}_computeCameraPosition(t){const e=(t=t||this.pixelsPerMeter)/this.pixelsPerMeter,n=this._camera.forward(),r=this.point,i=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*e-t/this.worldSize*this._centerAltitude;return[r.x/this.worldSize-n[0]*i,r.y/this.worldSize-n[1]*i,t/this.worldSize*this._centerAltitude-n[2]*i]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(e){const n=this._maxCameraBoundsDistance()*Math.cos(this._pitch),r=e[2];let i=1;r>0&&(i=Math.min((n-this._camera.position[2])/r,1)),this._camera.position=t.scaleAndAdd([],this._camera.position,e,i),this._updateStateFromCamera(),this.projection.wrap&&(this.center=this.center.wrap())}_updateStateFromCamera(){const e=this._camera.position,n=this._camera.forward(),{pitch:r,bearing:i}=this._camera.getPitchBearing(),o=t.mercatorZfromAltitude(this._centerAltitude,this.center.lat)*this._projectionScaler,s=this._mercatorZfromZoom(this._maxZoom)*Math.cos(t.degToRad(this._maxPitch)),a=Math.max((e[2]-o)/Math.cos(r),s),c=this._zoomFromMercatorZ(a);t.scaleAndAdd(e,e,n,a),this._pitch=t.clamp(r,t.degToRad(this.minPitch),t.degToRad(this.maxPitch)),this.angle=t.wrap(i,-Math.PI,Math.PI),this._setZoom(t.clamp(c,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new t.MercatorCoordinate(e[0],e[1],e[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(t){return Math.pow(2,t)*this.tileSize}_mercatorZfromZoom(t){return this.cameraToCenterDistance/this._worldSizeFromZoom(t)}_minimumHeightOverTerrain(){const t=Math.min((null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom)+2,this._maxZoom);return this._mercatorZfromZoom(t)}_zoomFromMercatorZ(t){return this.scaleZoom(this.cameraToCenterDistance/(t*this.tileSize))}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(t.warnOnce("Terrain is not yet supported with alternate projections. Use mercator to enable terrain."),1))}anyCornerOffEdge(e,n){const r=Math.min(e.x,n.x),i=Math.max(e.x,n.x),o=Math.min(e.y,n.y),s=Math.max(e.y,n.y);if(o<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new t.pointGeometry(r,o),new t.pointGeometry(i,s),new t.pointGeometry(r,s),new t.pointGeometry(i,o)],c=this.renderWorldCopies?-3:0,l=this.renderWorldCopies?4:1;for(const t of a){const e=this.pointRayIntersection(t);if(e.t<0)return!0;const n=this.rayIntersectionCoordinate(e);if(n.x<c||n.y<0||n.x>l||n.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+t.radToDeg(this.fovAboveCenter)>88||this.anyCornerOffEdge(new t.pointGeometry(0,0),new t.pointGeometry(this.width,this.height))}zoomDeltaToMovement(e,n){const r=t.length(t.sub([],this._camera.position,e)),i=this._zoomFromMercatorZ(r)+n;return r-this._mercatorZfromZoom(i)}getCameraPoint(){const e=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new t.pointGeometry(0,e))}}function Ur(t,e){let n=!1,r=null;const i=()=>{r=null,n&&(t(),r=setTimeout(i,e),n=!1)};return()=>(n=!0,r||i(),r)}class Vr{constructor(e){this._hashName=e&&encodeURIComponent(e),t.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ur(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,t.window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),t.window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(e){const n=this._map;if(!n)return"";const r=n.getCenter(),i=Math.round(100*n.getZoom())/100,o=Math.ceil((i*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,o),a=Math.round(r.lng*s)/s,c=Math.round(r.lat*s)/s,l=n.getBearing(),u=n.getPitch();let h="";if(h+=e?`/${a}/${c}/${i}`:`${i}/${c}/${a}`,(l||u)&&(h+="/"+Math.round(10*l)/10),u&&(h+=`/${Math.round(u)}`),this._hashName){const e=this._hashName;let n=!1;const r=t.window.location.hash.slice(1).split("&").map(t=>{const r=t.split("=")[0];return r===e?(n=!0,`${r}=${h}`):t}).filter(t=>t);return n||r.push(`${e}=${h}`),`#${r.join("&")}`}return`#${h}`}_getCurrentHash(){const e=t.window.location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(t=>t.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const t=this._map;if(!t)return!1;const e=this._getCurrentHash();if(e.length>=3&&!e.some(t=>isNaN(t))){const n=t.dragRotate.isEnabled()&&t.touchZoomRotate.isEnabled()?+(e[3]||0):t.getBearing();return t.jumpTo({center:[+e[2],+e[1]],zoom:+e[0],bearing:n,pitch:+(e[4]||0)}),!0}return!1}_updateHashUnthrottled(){const e=t.window.location.href.replace(/(#.+)?$/,this.getHashString());t.window.history.replaceState(t.window.history.state,null,e)}}const qr={linearity:.3,easing:t.bezier(0,0,.3,1)},Gr=t.extend({deceleration:2500,maxSpeed:1400},qr),$r=t.extend({deceleration:20,maxSpeed:1400},qr),Wr=t.extend({deceleration:1e3,maxSpeed:360},qr),Hr=t.extend({deceleration:1e3,maxSpeed:90},qr);class Zr{constructor(t){this._map=t,this.clear()}clear(){this._inertiaBuffer=[]}record(e){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:t.exported.now(),settings:e})}_drainInertiaBuffer(){const e=this._inertiaBuffer,n=t.exported.now();for(;e.length>0&&n-e[0].time>160;)e.shift()}_onMoveEnd(e){if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const n={zoom:0,bearing:0,pitch:0,pan:new t.pointGeometry(0,0),pinchAround:void 0,around:void 0};for(const{settings:t}of this._inertiaBuffer)n.zoom+=t.zoomDelta||0,n.bearing+=t.bearingDelta||0,n.pitch+=t.pitchDelta||0,t.panDelta&&n.pan._add(t.panDelta),t.around&&(n.around=t.around),t.pinchAround&&(n.pinchAround=t.pinchAround);const r=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(n.pan.mag()){const o=Xr(n.pan.mag(),r,t.extend({},Gr,e||{}));i.offset=n.pan.mult(o.amount/n.pan.mag()),i.center=this._map.transform.center,Kr(i,o)}if(n.zoom){const t=Xr(n.zoom,r,$r);i.zoom=this._map.transform.zoom+t.amount,Kr(i,t)}if(n.bearing){const e=Xr(n.bearing,r,Wr);i.bearing=this._map.transform.bearing+t.clamp(e.amount,-179,179),Kr(i,e)}if(n.pitch){const t=Xr(n.pitch,r,Hr);i.pitch=this._map.transform.pitch+t.amount,Kr(i,t)}if(i.zoom||i.bearing){const t=void 0===n.pinchAround?n.around:n.pinchAround;i.around=t?this._map.unproject(t):this._map.getCenter()}return this.clear(),i.noMoveStart=!0,i}}function Kr(t,e){(!t.duration||t.duration<e.duration)&&(t.duration=e.duration,t.easing=e.easing)}function Xr(e,n,r){const{maxSpeed:i,linearity:o,deceleration:s}=r,a=t.clamp(e*o/(n/1e3),-i,i),c=Math.abs(a)/(s*o);return{easing:r.easing,duration:1e3*c,amount:a*(c/2)}}class Yr extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,r,i={}){const o=f(n.getCanvasContainer(),r),s=n.unproject(o);super(e,t.extend({point:o,lngLat:s,originalEvent:r},i)),this._defaultPrevented=!1,this.target=n}}class Qr extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,n,r){const i="touchend"===e?r.changedTouches:r.touches,o=m(n.getCanvasContainer(),i),s=o.map(t=>n.unproject(t)),a=o.reduce((t,e,n,r)=>t.add(e.div(r.length)),new t.pointGeometry(0,0));super(e,{points:o,point:a,lngLats:s,lngLat:n.unproject(a),originalEvent:r}),this._defaultPrevented=!1}}class Jr extends t.Event{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,e,n){super(t,{originalEvent:n}),this._defaultPrevented=!1}}class ti{constructor(t,e){this._map=t,this._clickTolerance=e.clickTolerance}reset(){this._mousedownPos=void 0}wheel(t){return this._firePreventable(new Jr(t.type,this._map,t))}mousedown(t,e){return this._mousedownPos=e,this._firePreventable(new Yr(t.type,this._map,t))}mouseup(t){this._map.fire(new Yr(t.type,this._map,t))}preclick(e){const n=t.extend({},e);n.type="preclick",this._map.fire(new Yr(n.type,this._map,n))}click(t,e){this._mousedownPos&&this._mousedownPos.dist(e)>=this._clickTolerance||(this.preclick(t),this._map.fire(new Yr(t.type,this._map,t)))}dblclick(t){return this._firePreventable(new Yr(t.type,this._map,t))}mouseover(t){this._map.fire(new Yr(t.type,this._map,t))}mouseout(t){this._map.fire(new Yr(t.type,this._map,t))}touchstart(t){return this._firePreventable(new Qr(t.type,this._map,t))}touchmove(t){this._map.fire(new Qr(t.type,this._map,t))}touchend(t){this._map.fire(new Qr(t.type,this._map,t))}touchcancel(t){this._map.fire(new Qr(t.type,this._map,t))}_firePreventable(t){if(this._map.fire(t),t.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ei{constructor(t){this._map=t}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(t){this._map.fire(new Yr(t.type,this._map,t))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Yr("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(t){this._delayContextMenu?this._contextMenuEvent=t:this._map.fire(new Yr(t.type,this._map,t)),this._map.listens("contextmenu")&&t.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class ni{constructor(t,e){this._map=t,this._el=t.getCanvasContainer(),this._container=t.getContainer(),this._clickTolerance=e.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(t,e){this.isEnabled()&&t.shiftKey&&0===t.button&&(u(),this._startPos=this._lastPos=e,this._active=!0)}mousemoveWindow(t,e){if(!this._active)return;const n=e;if(this._lastPos.equals(n)||!this._box&&n.dist(this._startPos)<this._clickTolerance)return;const r=this._startPos;this._lastPos=n,this._box||(this._box=o("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",t));const i=Math.min(r.x,n.x),s=Math.max(r.x,n.x),a=Math.min(r.y,n.y),c=Math.max(r.y,n.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${i}px,${a}px)`,this._box.style.width=s-i+"px",this._box.style.height=c-a+"px")})}mouseupWindow(e,n){if(!this._active)return;if(0!==e.button)return;const r=this._startPos,i=n;if(this.reset(),p(),r.x!==i.x||r.y!==i.y)return this._map.fire(new t.Event("boxzoomend",{originalEvent:e})),{cameraAnimation:t=>t.fitScreenCoordinates(r,i,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",e)}keydown(t){this._active&&27===t.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",t))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),h(),delete this._startPos,delete this._lastPos}_fireEvent(e,n){return this._map.fire(new t.Event(e,{originalEvent:n}))}}function ri(t,e){const n={};for(let r=0;r<t.length;r++)n[t[r].identifier]=e[r];return n}class ii{constructor(t){this.reset(),this.numTouches=t.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(e,n,r){(this.centroid||r.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=e.timeStamp),r.length===this.numTouches&&(this.centroid=function(e){const n=new t.pointGeometry(0,0);for(const t of e)n._add(t);return n.div(e.length)}(n),this.touches=ri(r,n)))}touchmove(t,e,n){if(this.aborted||!this.centroid)return;const r=ri(n,e);for(const i in this.touches){const t=this.touches[i],e=r[i];(!e||e.dist(t)>30)&&(this.aborted=!0)}}touchend(t,e,n){if((!this.centroid||t.timeStamp-this.startTime>500)&&(this.aborted=!0),0===n.length){const t=!this.aborted&&this.centroid;if(this.reset(),t)return t}}}class oi{constructor(t){this.singleTap=new ii(t),this.numTaps=t.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(t,e,n){this.singleTap.touchstart(t,e,n)}touchmove(t,e,n){this.singleTap.touchmove(t,e,n)}touchend(t,e,n){const r=this.singleTap.touchend(t,e,n);if(r){const e=t.timeStamp-this.lastTime<500,n=!this.lastTap||this.lastTap.dist(r)<30;if(e&&n||this.reset(),this.count++,this.lastTime=t.timeStamp,this.lastTap=r,this.count===this.numTaps)return this.reset(),r}}}class si{constructor(){this._zoomIn=new oi({numTouches:1,numTaps:2}),this._zoomOut=new oi({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(t,e,n){this._zoomIn.touchstart(t,e,n),this._zoomOut.touchstart(t,e,n)}touchmove(t,e,n){this._zoomIn.touchmove(t,e,n),this._zoomOut.touchmove(t,e,n)}touchend(t,e,n){const r=this._zoomIn.touchend(t,e,n),i=this._zoomOut.touchend(t,e,n);return r?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()+1,around:e.unproject(r)},{originalEvent:t})}):i?(this._active=!0,t.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:e=>e.easeTo({duration:300,zoom:e.getZoom()-1,around:e.unproject(i)},{originalEvent:t})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const ai={0:1,2:2};class ci{constructor(t){this.reset(),this._clickTolerance=t.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(t,e){return!1}_move(t,e){return{}}mousedown(t,e){if(this._lastPoint)return;const n=g(t);this._correctButton(t,n)&&(this._lastPoint=e,this._eventButton=n)}mousemoveWindow(t,e){const n=this._lastPoint;if(n)if(t.preventDefault(),null!=this._eventButton&&function(t,e){const n=ai[e];return void 0===t.buttons||(t.buttons&n)!==n}(t,this._eventButton))this.reset();else if(this._moved||!(e.dist(n)<this._clickTolerance))return this._moved=!0,this._lastPoint=e,this._move(n,e)}mouseupWindow(t){this._lastPoint&&g(t)===this._eventButton&&(this._moved&&p(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class li extends ci{mousedown(t,e){super.mousedown(t,e),this._lastPoint&&(this._active=!0)}_correctButton(t,e){return 0===e&&!t.ctrlKey}_move(t,e){return{around:e,panDelta:e.sub(t)}}}class ui extends ci{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const n=.8*(e.x-t.x);if(n)return this._active=!0,{bearingDelta:n}}contextmenu(t){t.preventDefault()}}class hi extends ci{_correctButton(t,e){return 0===e&&t.ctrlKey||2===e}_move(t,e){const n=-.5*(e.y-t.y);if(n)return this._active=!0,{pitchDelta:n}}contextmenu(t){t.preventDefault()}}class di{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._minTouches=1,this._clickTolerance=n.clickTolerance||1,this.reset(),t.bindAll(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new t.pointGeometry(0,0)}touchstart(t,e,n){return this._calculateTransform(t,e,n)}touchmove(t,e,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length)return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.preventDefault(),this._calculateTransform(t,e,n)}}touchend(t,e,n){this._calculateTransform(t,e,n),this._active&&n.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(e,n,r){r.length>0&&(this._active=!0);const i=ri(r,n),o=new t.pointGeometry(0,0),s=new t.pointGeometry(0,0);let a=0;for(const t in i){const e=i[t],n=this._touches[t];n&&(o._add(e),s._add(e.sub(n)),a++,i[t]=e)}if(this._touches=i,a<this._minTouches||!s.mag())return;const c=s.div(a);return this._sum._add(c),this._sum.mag()<this._clickTolerance?void 0:{around:o.div(a),panDelta:c}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show")},500)}}class pi{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(t){}_move(t,e,n){return{}}touchstart(t,e,n){this._firstTwoTouches||n.length<2||(this._firstTwoTouches=[n[0].identifier,n[1].identifier],this._start([e[0],e[1]]))}touchmove(t,e,n){const r=this._firstTwoTouches;if(!r)return;t.preventDefault();const[i,o]=r,s=fi(n,e,i),a=fi(n,e,o);if(!s||!a)return;const c=this._aroundCenter?null:s.add(a).div(2);return this._move([s,a],c,t)}touchend(t,e,n){if(!this._firstTwoTouches)return;const[r,i]=this._firstTwoTouches,o=fi(n,e,r),s=fi(n,e,i);o&&s||(this._active&&p(),this.reset())}touchcancel(){this.reset()}enable(t){this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function fi(t,e,n){for(let r=0;r<t.length;r++)if(t[r].identifier===n)return e[r]}function mi(t,e){return Math.log(t/e)/Math.LN2}class gi extends pi{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(t){this._startDistance=this._distance=t[0].dist(t[1])}_move(t,e){const n=this._distance;if(this._distance=t[0].dist(t[1]),this._active||!(Math.abs(mi(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:mi(this._distance,n),pinchAround:e}}}function _i(t,e){return 180*t.angleWith(e)/Math.PI}class yi extends pi{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(t){this._startVector=this._vector=t[0].sub(t[1]),this._minDiameter=t[0].dist(t[1])}_move(t,e){const n=this._vector;if(this._vector=t[0].sub(t[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:_i(this._vector,n),pinchAround:e}}_isBelowThreshold(t){this._minDiameter=Math.min(this._minDiameter,t.mag());const e=25/(Math.PI*this._minDiameter)*360,n=_i(t,this._startVector);return Math.abs(n)<e}}function vi(t){return Math.abs(t.y)>Math.abs(t.x)}class bi extends pi{constructor(t){super(),this._map=t}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(t){this._lastPoints=t,vi(t[0].sub(t[1]))&&(this._valid=!1)}_move(t,e,n){const r=this._lastPoints;if(!r)return;const i=t[0].sub(r[0]),o=t[1].sub(r[1]);return this._map._cooperativeGestures&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(i,o,n.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(i.y+o.y)/2*-.5})}gestureBeginsVertically(t,e,n){if(void 0!==this._valid)return this._valid;const r=t.mag()>=2,i=e.mag()>=2;if(!r&&!i)return;if(!r||!i)return null==this._firstMove&&(this._firstMove=n),n-this._firstMove<100&&void 0;const o=t.y>0==e.y>0;return vi(t)&&vi(e)&&o}}const xi={panStep:100,bearingStep:15,pitchStep:10};class wi{constructor(){const t=xi;this._panStep=t.panStep,this._bearingStep=t.bearingStep,this._pitchStep=t.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(t){if(t.altKey||t.ctrlKey||t.metaKey)return;let e=0,n=0,r=0,i=0,o=0;switch(t.keyCode){case 61:case 107:case 171:case 187:e=1;break;case 189:case 109:case 173:e=-1;break;case 37:t.shiftKey?n=-1:(t.preventDefault(),i=-1);break;case 39:t.shiftKey?n=1:(t.preventDefault(),i=1);break;case 38:t.shiftKey?r=1:(t.preventDefault(),o=-1);break;case 40:t.shiftKey?r=-1:(t.preventDefault(),o=1);break;default:return}return this._rotationDisabled&&(n=0,r=0),{cameraAnimation:s=>{const a=s.getZoom();s.easeTo({duration:300,easeId:"keyboardHandler",easing:Ti,zoom:e?Math.round(a)+e*(t.shiftKey?2:1):a,bearing:s.getBearing()+n*this._bearingStep,pitch:s.getPitch()+r*this._pitchStep,offset:[-i*this._panStep,-o*this._panStep],center:s.getCenter()},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Ti(t){return t*(2-t)}const Ci=4.000244140625;class Ei{constructor(e,n){this._map=e,this._el=e.getCanvasContainer(),this._handler=n,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=.0022222222222222222,t.bindAll(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert","_isFullscreen"],this)}setZoomRate(t){this._defaultZoomRate=t}setWheelZoomRate(t){this._wheelZoomRate=t}isEnabled(){return!!this._enabled}isActive(){return!!this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(t){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!t&&"center"===t.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(e){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(e.ctrlKey||e.metaKey||this.isZooming()||this._isFullscreen()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let n=e.deltaMode===t.window.WheelEvent.DOM_DELTA_LINE?40*e.deltaY:e.deltaY;const r=t.exported.now(),i=r-(this._lastWheelEventTime||0);this._lastWheelEventTime=r,0!==n&&n%Ci==0?this._type="wheel":0!==n&&Math.abs(n)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=n,this._timeout=setTimeout(this._onTimeout,40,e)):this._type||(this._type=Math.abs(i*n)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,n+=this._lastValue)),e.shiftKey&&n&&(n/=4),this._type&&(this._lastWheelEvent=e,this._delta-=n,this._active||this._start(e)),e.preventDefault()}_onTimeout(t){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(t)}_start(t){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const e=f(this._el,t);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:e,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const e=this._map.transform,n=()=>e._terrainEnabled()&&this._aroundCoord?e.computeZoomRelativeTo(this._aroundCoord):e.zoom;if(0!==this._delta){const t="wheel"===this._type&&Math.abs(this._delta)>Ci?this._wheelZoomRate:this._defaultZoomRate;let r=2/(1+Math.exp(-Math.abs(this._delta*t)));this._delta<0&&0!==r&&(r=1/r);const i=n(),o=Math.pow(2,i),s="number"==typeof this._targetZoom?e.zoomScale(this._targetZoom):o;this._targetZoom=Math.min(e.maxZoom,Math.max(e.minZoom,e.scaleZoom(s*r))),"wheel"===this._type&&(this._startZoom=n(),this._easing=this._smoothOutEasing(200)),this._delta=0}const r="number"==typeof this._targetZoom?this._targetZoom:n(),i=this._startZoom,o=this._easing;let s,a=!1;if("wheel"===this._type&&i&&o){const e=Math.min((t.exported.now()-this._lastWheelEventTime)/200,1),n=o(e);s=t.number(i,r,n),e<1?this._frameId||(this._frameId=!0):a=!0}else s=r,a=!0;return this._active=!0,a&&(this._active=!1,this._finishTimeout=setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!a,zoomDelta:s-n(),around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(e){let n=t.ease;if(this._prevEase){const e=this._prevEase,r=(t.exported.now()-e.start)/e.duration,i=e.easing(r+.01)-e.easing(r),o=.27/Math.sqrt(i*i+1e-4)*.01,s=Math.sqrt(.0729-o*o);n=t.bezier(o,s,.25,1)}return this._prevEase={start:t.exported.now(),duration:e,easing:n},n}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=o("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(t.window.navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_isFullscreen(){return!!t.window.document.fullscreenElement||!!t.window.document.webkitFullscreenElement}_showBlockerAlert(){"hidden"===this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="visible"),this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),clearTimeout(this._alertTimer),this._alertTimer=setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show")},200)}}class Si{constructor(t,e){this._clickZoom=t,this._tapZoom=e}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Ii{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(t,e){return t.preventDefault(),{cameraAnimation:n=>{n.easeTo({duration:300,zoom:n.getZoom()+(t.shiftKey?-1:1),around:n.unproject(e)},{originalEvent:t})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class ki{constructor(){this._tap=new oi({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(t,e,n){this._swipePoint||(this._tapTime&&t.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?n.length>0&&(this._swipePoint=e[0],this._swipeTouch=n[0].identifier):this._tap.touchstart(t,e,n))}touchmove(t,e,n){if(this._tapTime){if(this._swipePoint){if(n[0].identifier!==this._swipeTouch)return;const r=e[0],i=r.y-this._swipePoint.y;return this._swipePoint=r,t.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(t,e,n)}touchend(t,e,n){this._tapTime?this._swipePoint&&0===n.length&&this.reset():this._tap.touchend(t,e,n)&&(this._tapTime=t.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Ai{constructor(t,e,n){this._el=t,this._mousePan=e,this._touchPan=n}enable(t){this._inertiaOptions=t||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Mi{constructor(t,e,n){this._pitchWithRotate=t.pitchWithRotate,this._mouseRotate=e,this._mousePitch=n}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Oi{constructor(t,e,n,r){this._el=t,this._touchZoom=e,this._touchRotate=n,this._tapDragZoom=r,this._rotationDisabled=!1,this._enabled=!0}enable(t){this._touchZoom.enable(t),this._rotationDisabled||this._touchRotate.enable(t),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Pi=t=>t.zoom||t.drag||t.pitch||t.rotate;class Di extends t.Event{}class Ri{constructor(){this.constants=[1,1,.01],this.radius=0}setup(e,n){const r=t.sub([],n,e);this.radius=t.length(r[2]<0?t.div([],r,this.constants):[r[0],r[1],0])}projectRay(e){t.div(e,e,this.constants),t.normalize(e,e),t.mul$1(e,e,this.constants);const n=t.scale$2([],e,this.radius);if(n[2]>0){const e=t.scale$2([],[0,0,1],t.dot(n,[0,0,1])),r=t.scale$2([],t.normalize([],[n[0],n[1],0]),this.radius),i=t.add([],n,t.scale$2([],t.sub([],t.add([],r,e),n),2));n[0]=i[0],n[1]=i[1]}return n}}function Ni(t){return t.panDelta&&t.panDelta.mag()||t.zoomDelta||t.bearingDelta||t.pitchDelta}class Li{constructor(e,n){this._map=e,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Zr(e),this._bearingSnap=n.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Ri,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(n),t.bindAll(["handleEvent","handleWindowEvent"],this);const r=this._el;this._listeners=[[r,"touchstart",{passive:!0}],[r,"touchmove",{passive:!1}],[r,"touchend",void 0],[r,"touchcancel",void 0],[r,"mousedown",void 0],[r,"mousemove",void 0],[r,"mouseup",void 0],[t.window.document,"mousemove",{capture:!0}],[t.window.document,"mouseup",void 0],[r,"mouseover",void 0],[r,"mouseout",void 0],[r,"dblclick",void 0],[r,"click",void 0],[r,"keydown",{capture:!1}],[r,"keyup",void 0],[r,"wheel",{passive:!1}],[r,"contextmenu",void 0],[t.window,"blur",void 0]];for(const[i,o,s]of this._listeners)i.addEventListener(o,i===t.window.document?this.handleWindowEvent:this.handleEvent,s)}destroy(){for(const[e,n,r]of this._listeners)e.removeEventListener(n,e===t.window.document?this.handleWindowEvent:this.handleEvent,r)}_addDefaultHandlers(t){const e=this._map,n=e.getCanvasContainer();this._add("mapEvent",new ti(e,t));const r=e.boxZoom=new ni(e,t);this._add("boxZoom",r);const i=new si,o=new Ii;e.doubleClickZoom=new Si(o,i),this._add("tapZoom",i),this._add("clickZoom",o);const s=new ki;this._add("tapDragZoom",s);const a=e.touchPitch=new bi(e);this._add("touchPitch",a);const c=new ui(t),l=new hi(t);e.dragRotate=new Mi(t,c,l),this._add("mouseRotate",c,["mousePitch"]),this._add("mousePitch",l,["mouseRotate"]);const u=new li(t),h=new di(e,t);e.dragPan=new Ai(n,u,h),this._add("mousePan",u),this._add("touchPan",h,["touchZoom","touchRotate"]);const d=new yi,p=new gi;e.touchZoomRotate=new Oi(n,p,d,s),this._add("touchRotate",d,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new ei(e));const f=e.scrollZoom=new Ei(e,this);this._add("scrollZoom",f,["mousePan"]);const m=e.keyboard=new wi;this._add("keyboard",m);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])t.interactive&&t[g]&&e[g].enable(t[g])}_add(t,e,n){this._handlers.push({handlerName:t,handler:e,allowed:n}),this._handlersById[t]=e}stop(t){if(!this._updatingCamera){for(const{handler:t}of this._handlers)t.reset();this._inertia.clear(),this._fireEvents({},{},t),this._changes=[]}}isActive(){for(const{handler:t}of this._handlers)if(t.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Pi(this._eventsInProgress)||this.isZooming()}_blockedByActive(t,e,n){for(const r in t)if(r!==n&&(!e||e.indexOf(r)<0))return!0;return!1}handleWindowEvent(t){this.handleEvent(t,`${t.type}Window`)}_getMapTouches(t){const e=[];for(const n of t)this._el.contains(n.target)&&e.push(n);return e}handleEvent(t,e){this._updatingCamera=!0;const n="renderFrame"===t.type,r=n?void 0:t,i={needsRenderFrame:!1},o={},s={},a=t.touches?this._getMapTouches(t.touches):void 0,c=a?m(this._el,a):n?void 0:f(this._el,t);for(const{handlerName:h,handler:d,allowed:p}of this._handlers){if(!d.isEnabled())continue;let n;this._blockedByActive(s,p,h)?d.reset():d[e||t.type]&&(n=d[e||t.type](t,c,a),this.mergeHandlerResult(i,o,n,h,r),n&&n.needsRenderFrame&&this._triggerRenderFrame()),(n||d.isActive())&&(s[h]=d)}const l={};for(const h in this._previousActiveHandlers)s[h]||(l[h]=r);this._previousActiveHandlers=s,(Object.keys(l).length||Ni(i))&&(this._changes.push([i,o,l]),this._triggerRenderFrame()),(Object.keys(s).length||Ni(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=i;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,n,r,i,o){if(!r)return;t.extend(e,r);const s={handlerName:i,originalEvent:r.originalEvent||o};void 0!==r.zoomDelta&&(n.zoom=s),void 0!==r.panDelta&&(n.drag=s),void 0!==r.pitchDelta&&(n.pitch=s),void 0!==r.bearingDelta&&(n.rotate=s)}_applyChanges(){const e={},n={},r={};for(const[i,o,s]of this._changes)i.panDelta&&(e.panDelta=(e.panDelta||new t.pointGeometry(0,0))._add(i.panDelta)),i.zoomDelta&&(e.zoomDelta=(e.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(e.bearingDelta=(e.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(e.pitchDelta=(e.pitchDelta||0)+i.pitchDelta),void 0!==i.around&&(e.around=i.around),void 0!==i.aroundCoord&&(e.aroundCoord=i.aroundCoord),void 0!==i.pinchAround&&(e.pinchAround=i.pinchAround),i.noInertia&&(e.noInertia=i.noInertia),t.extend(n,o),t.extend(r,s);this._updateMapTransform(e,n,r),this._changes=[]}_updateMapTransform(e,n,r){const i=this._map,o=i.transform,s=t=>[t.x,t.y,t.z];if((t=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Ni(e)){const t=o.zoom;o.cameraElevationReference="sea",o.recenterOnTerrain(),o.cameraElevationReference="ground",t!==o.zoom&&this._map._update(!0)}if(!Ni(e))return void this._fireEvents(n,r,!0);let{panDelta:a,zoomDelta:c,bearingDelta:l,pitchDelta:u,around:h,aroundCoord:d,pinchAround:p}=e;void 0!==p&&(h=p),(t=>n.drag&&!this._eventsInProgress.drag)()&&h&&(this._dragOrigin=s(o.pointCoordinate3D(h)),this._trackingEllipsoid.setup(o._camera.position,this._dragOrigin)),o.cameraElevationReference="sea",i._stop(!0),h=h||i.transform.centerPoint,l&&(o.bearing+=l),u&&(o.pitch+=u),o._updateCameraState();const f=[0,0,0];if(a){const e=o.pointCoordinate(h);if("globe"===o.projection.name){const n=t.latFromMercatorY(e.y),r=o.center.lat,i=Math.min(t.mercatorZfromAltitude(1,n)/t.mercatorZfromAltitude(1,r),2);a=a.rotate(-o.angle),f[0]=-a.x/o.worldSize*i,f[1]=-a.y/o.worldSize*i}else{const t=o.pointCoordinate(h.sub(a));e&&t&&(f[0]=t.x-e.x,f[1]=t.y-e.y)}}const m=o.zoom,g=[0,0,0];if(c){const e=s(d||o.pointCoordinate3D(h)),n={dir:t.normalize([],t.sub([],e,o._camera.position))};if(n.dir[2]<0){const r=o.zoomDeltaToMovement(e,c);t.scale$2(g,n.dir,r)}}const _=t.add(f,f,g);o._translateCameraConstrained(_),c&&Math.abs(o.zoom-m)>1e-4&&o.recenterOnTerrain(),o.cameraElevationReference="ground",this._map._update(),e.noInertia||this._inertia.record(e),this._fireEvents(n,r,!0)}_fireEvents(e,n,r){const i=Pi(this._eventsInProgress),o=Pi(e),s={};for(const t in e){const{originalEvent:n}=e[t];this._eventsInProgress[t]||(s[`${t}start`]=n),this._eventsInProgress[t]=e[t]}!i&&o&&this._fireEvent("movestart",o.originalEvent);for(const t in s)this._fireEvent(t,s[t]);o&&this._fireEvent("move",o.originalEvent);for(const t in e){const{originalEvent:n}=e[t];this._fireEvent(t,n)}const a={};let c;for(const t in this._eventsInProgress){const{handlerName:e,originalEvent:r}=this._eventsInProgress[t];this._handlersById[e].isActive()||(delete this._eventsInProgress[t],c=n[e]||r,a[`${t}end`]=c)}for(const t in a)this._fireEvent(t,a[t]);const l=Pi(this._eventsInProgress);if(r&&(i||o)&&!l){this._updatingCamera=!0;const e=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),n=t=>0!==t&&-this._bearingSnap<t&&t<this._bearingSnap;e?(n(e.bearing||this._map.getBearing())&&(e.bearing=0),this._map.easeTo(e,{originalEvent:c})):(this._map.fire(new t.Event("moveend",{originalEvent:c})),n(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(e,n){this._map.fire(new t.Event(e,n?{originalEvent:n}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(t=>{this._frameId=void 0,this.handleEvent(new Di("renderFrame",{timeStamp:t})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const ji="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class zi extends t.Evented{constructor(e,n){super(),this._moving=!1,this._zooming=!1,this.transform=e,this._bearingSnap=n.bearingSnap,t.bindAll(["_renderFrameCallback"],this)}getCenter(){return new t.LngLat(this.transform.center.lng,this.transform.center.lat)}setCenter(t,e){return this.jumpTo({center:t},e)}panBy(e,n,r){return e=t.pointGeometry.convert(e).mult(-1),this.panTo(this.transform.center,t.extend({offset:e},n),r)}panTo(e,n,r){return this.easeTo(t.extend({center:e},n),r)}getZoom(){return this.transform.zoom}setZoom(t,e){return this.jumpTo({zoom:t},e),this}zoomTo(e,n,r){return this.easeTo(t.extend({zoom:e},n),r)}zoomIn(t,e){return this.zoomTo(this.getZoom()+1,t,e),this}zoomOut(t,e){return this.zoomTo(this.getZoom()-1,t,e),this}getBearing(){return this.transform.bearing}setBearing(t,e){return this.jumpTo({bearing:t},e),this}getPadding(){return this.transform.padding}setPadding(t,e){return this.jumpTo({padding:t},e),this}rotateTo(e,n,r){return this.easeTo(t.extend({bearing:e},n),r)}resetNorth(e,n){return this.rotateTo(0,t.extend({duration:1e3},e),n),this}resetNorthPitch(e,n){return this.easeTo(t.extend({bearing:0,pitch:0,duration:1e3},e),n),this}snapToNorth(t,e){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(t,e):this}getPitch(){return this.transform.pitch}setPitch(t,e){return this.jumpTo({pitch:t},e),this}cameraForBounds(e,n){e=t.LngLatBounds.convert(e);const r=n&&n.bearing||0;return this._cameraForBoxAndBearing(e.getNorthWest(),e.getSouthEast(),r,n)}_extendCameraOptions(e){const n={top:0,bottom:0,right:0,left:0};if("number"==typeof(e=t.extend({padding:n,offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding){const t=e.padding;e.padding={top:t,bottom:t,right:t,left:t}}return e.padding=t.extend(n,e.padding),e}_cameraForBoxAndBearing(e,n,r,i){const o=this._extendCameraOptions(i),s=this.transform,a=s.padding,c=s.project(t.LngLat.convert(e)),l=s.project(t.LngLat.convert(n)),u=new t.pointGeometry(c.x,l.y),h=new t.pointGeometry(l.x,c.y),d=-t.degToRad(r),p=c.rotate(d),f=l.rotate(d),m=u.rotate(d),g=h.rotate(d),_=new t.pointGeometry(Math.max(p.x,f.x,m.x,g.x),Math.max(p.y,f.y,m.y,g.y)),y=new t.pointGeometry(Math.min(p.x,f.x,m.x,g.x),Math.min(p.y,f.y,m.y,g.y)),v=_.sub(y),b=(s.width-((a.left||0)+(a.right||0)+o.padding.left+o.padding.right))/v.x,x=(s.height-((a.top||0)+(a.bottom||0)+o.padding.top+o.padding.bottom))/v.y;if(x<0||b<0)return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");const w=Math.min(s.scaleZoom(s.scale*Math.min(b,x)),o.maxZoom),T="number"==typeof o.offset.x&&"number"==typeof o.offset.y?new t.pointGeometry(o.offset.x,o.offset.y):t.pointGeometry.convert(o.offset),C=new t.pointGeometry((o.padding.left-o.padding.right)/2,(o.padding.top-o.padding.bottom)/2).rotate(r*Math.PI/180),E=T.add(C).mult(s.scale/s.zoomScale(w));return{center:s.unproject(c.add(l).div(2).sub(E)),zoom:w,bearing:r}}_cameraForBox(e,n,r,i,o){const s=this._extendCameraOptions(o);r=r||0,i=i||0,e=t.LngLat.convert(e),n=t.LngLat.convert(n);const a=this.transform.clone();a.padding=s.padding;const c=this.getFreeCameraOptions(),l=new t.LngLat(.5*(e.lng+n.lng),.5*(e.lat+n.lat)),u=.5*(r+i);if(a._camera.position[2]<t.mercatorZfromAltitude(u,l.lat))return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.");c.lookAtPoint(l),a.setFreeCameraOptions(c);const h=t.MercatorCoordinate.fromLngLat(e),d=t.MercatorCoordinate.fromLngLat(n),p=a.pointRayIntersection(a.centerPoint,u),f=[(m=a.rayIntersectionCoordinate(p)).x,m.y,m.z];var m;const g=a.screenPointToMercatorRay(a.centerPoint),_="globe"!==a.projection.name;let y,v=0;do{const n=Math.floor(a.zoom),o=1<<n,s=Math.min(o*h.x,o*d.x),c=Math.min(o*h.y,o*d.y),l=Math.max(o*h.x,o*d.x),u=Math.max(o*h.y,o*d.y),p=new t.Aabb([s,c,r],[l,u,i]),m=t.Frustum.fromInvProjectionMatrix(a.invProjMatrix,a.worldSize,n,_);if(2!==p.intersects(m)){y&&(a._camera.position=t.scaleAndAdd([],a._camera.position,g.dir,-y),a._updateStateFromCamera());break}const v=t.sub([],a._camera.position,f);y=.5*t.length(v),a._camera.position=t.scaleAndAdd([],a._camera.position,g.dir,y);try{a._updateStateFromCamera()}catch(e){return void t.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")}}while(++v<10);return{center:a.center,zoom:a.zoom,bearing:a.bearing,pitch:a.pitch}}fitBounds(t,e,n){return this._fitInternal(this.cameraForBounds(t,e),e,n)}_raycastElevationBox(e,n){const r=this.transform.elevation;if(!r)return;const i=new t.pointGeometry(e.x,n.y),o=new t.pointGeometry(n.x,e.y),s=r.pointCoordinate(e);if(!s)return;const a=r.pointCoordinate(n);if(!a)return;const c=r.pointCoordinate(i);if(!c)return;const l=r.pointCoordinate(o);if(!l)return;const u=new t.MercatorCoordinate(s[0],s[1]).toLngLat(),h=new t.MercatorCoordinate(a[0],a[1]).toLngLat(),d=new t.MercatorCoordinate(c[0],c[1]).toLngLat(),p=new t.MercatorCoordinate(l[0],l[1]).toLngLat(),f=Math.min(u.lng,Math.min(h.lng,Math.min(d.lng,p.lng))),m=Math.min(u.lat,Math.min(h.lat,Math.min(d.lat,p.lat))),g=Math.max(u.lng,Math.max(h.lng,Math.max(d.lng,p.lng))),_=Math.max(u.lat,Math.max(h.lat,Math.max(d.lat,p.lat))),y=Math.min(s[3],Math.min(a[3],Math.min(c[3],l[3]))),v=Math.max(s[3],Math.max(a[3],Math.max(c[3],l[3])));return{minLngLat:new t.LngLat(f,m),maxLngLat:new t.LngLat(g,_),minAltitude:y,maxAltitude:v}}fitScreenCoordinates(e,n,r,i,o){let s,a,c,l;const u=t.pointGeometry.convert(e),h=t.pointGeometry.convert(n),d=this._raycastElevationBox(u,h);if(d)s=d.minLngLat,a=d.maxLngLat,c=d.minAltitude,l=d.maxAltitude;else{if(this.transform.anyCornerOffEdge(u,h))return this;s=this.transform.pointLocation(u),a=this.transform.pointLocation(h)}return this._fitInternal(0===this.transform.pitch?this._cameraForBoxAndBearing(this.transform.pointLocation(t.pointGeometry.convert(e)),this.transform.pointLocation(t.pointGeometry.convert(n)),r,i):this._cameraForBox(s,a,c,l,i),i,o)}_fitInternal(e,n,r){return e?(delete(n=t.extend(e,n)).padding,n.linear?this.easeTo(n,r):this.flyTo(n,r)):this}jumpTo(e,n){this.stop();const r=e.preloadOnly?this.transform.clone():this.transform;let i=!1,o=!1,s=!1;return"zoom"in e&&r.zoom!==+e.zoom&&(i=!0,r.zoom=+e.zoom),void 0!==e.center&&(r.center=t.LngLat.convert(e.center)),"bearing"in e&&r.bearing!==+e.bearing&&(o=!0,r.bearing=+e.bearing),"pitch"in e&&r.pitch!==+e.pitch&&(s=!0,r.pitch=+e.pitch),null==e.padding||r.isPaddingEqual(e.padding)||(r.padding=e.padding),e.preloadOnly?(this._preloadTiles(r),this):(this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),i&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),o&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),s&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||t.warnOnce(ji),this.transform.getFreeCameraOptions()}setFreeCameraOptions(e,n){const r=this.transform;if(!r.projection.supportsFreeCamera)return t.warnOnce(ji),this;this.stop();const i=r.zoom,o=r.pitch,s=r.bearing;r.setFreeCameraOptions(e);const a=i!==r.zoom,c=o!==r.pitch,l=s!==r.bearing;return this.fire(new t.Event("movestart",n)).fire(new t.Event("move",n)),a&&this.fire(new t.Event("zoomstart",n)).fire(new t.Event("zoom",n)).fire(new t.Event("zoomend",n)),l&&this.fire(new t.Event("rotatestart",n)).fire(new t.Event("rotate",n)).fire(new t.Event("rotateend",n)),c&&this.fire(new t.Event("pitchstart",n)).fire(new t.Event("pitch",n)).fire(new t.Event("pitchend",n)),this.fire(new t.Event("moveend",n)),this}easeTo(e,n){this._stop(!1,e.easeId),(!1===(e=t.extend({offset:[0,0],duration:500,easing:t.ease},e)).animate||!e.essential&&t.exported.prefersReducedMotion)&&(e.duration=0);const r=this.transform,i=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),c="zoom"in e?+e.zoom:i,l="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:r.padding,d=t.pointGeometry.convert(e.offset);let p,f,m;if("globe"===r.projection.name){const n=t.MercatorCoordinate.fromLngLat(r.center),i=d.rotate(-r.angle);n.x+=i.x/r.worldSize,n.y+=i.y/r.worldSize;const o=n.toLngLat(),s=t.LngLat.convert(e.center||o);this._normalizeCenter(s),p=r.centerPoint.add(i),f=new t.pointGeometry(n.x,n.y).mult(r.worldSize),m=new t.pointGeometry(t.mercatorXfromLng(s.lng),t.mercatorYfromLat(s.lat)).mult(r.worldSize).sub(f)}else{p=r.centerPoint.add(d);const n=r.pointLocation(p),i=t.LngLat.convert(e.center||n);this._normalizeCenter(i),f=r.project(n),m=r.project(i).sub(f)}const g=r.zoomScale(c-i);let _,y;e.around&&(_=t.LngLat.convert(e.around),y=r.locationPoint(_));const v=this._zooming||c!==i,b=this._rotating||o!==l,x=this._pitching||u!==s,w=!r.isPaddingEqual(h),T=r=>T=>{if(v&&(r.zoom=t.number(i,c,T)),b&&(r.bearing=t.number(o,l,T)),x&&(r.pitch=t.number(s,u,T)),w&&(r.interpolatePadding(a,h,T),p=r.centerPoint.add(d)),_)r.setLocationAtPoint(_,y);else{const t=r.zoomScale(r.zoom-i),e=c>i?Math.min(2,g):Math.max(.5,g),n=Math.pow(e,1-T),o=r.unproject(f.add(m.mult(T*n)).mult(t));r.setLocationAtPoint(r.renderWorldCopies?o.wrap():o,p)}return e.preloadOnly||this._fireMoveEvents(n),r};if(e.preloadOnly){const t=this._emulate(T,e.duration,r);return this._preloadTiles(t),this}const C={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=b,this._pitching=x,this._padding=w,this._easeId=e.easeId,this._prepareEase(n,e.noMoveStart,C),this._ease(T(r),t=>{r.recenterOnTerrain(),this._afterEase(n,t)},e),this}_prepareEase(e,n,r={}){this._moving=!0,this.transform.cameraElevationReference="sea",n||r.moving||this.fire(new t.Event("movestart",e)),this._zooming&&!r.zooming&&this.fire(new t.Event("zoomstart",e)),this._rotating&&!r.rotating&&this.fire(new t.Event("rotatestart",e)),this._pitching&&!r.pitching&&this.fire(new t.Event("pitchstart",e))}_fireMoveEvents(e){this.fire(new t.Event("move",e)),this._zooming&&this.fire(new t.Event("zoom",e)),this._rotating&&this.fire(new t.Event("rotate",e)),this._pitching&&this.fire(new t.Event("pitch",e))}_afterEase(e,n){if(this._easeId&&n&&this._easeId===n)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const r=this._zooming,i=this._rotating,o=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,r&&this.fire(new t.Event("zoomend",e)),i&&this.fire(new t.Event("rotateend",e)),o&&this.fire(new t.Event("pitchend",e)),this.fire(new t.Event("moveend",e))}flyTo(e,n){if(!e.essential&&t.exported.prefersReducedMotion){const r=t.pick(e,["center","zoom","bearing","pitch","around"]);return this.jumpTo(r,n)}this.stop(),e=t.extend({offset:[0,0],speed:1.2,curve:1.42,easing:t.ease},e);const r=this.transform,i=this.getZoom(),o=this.getBearing(),s=this.getPitch(),a=this.getPadding(),c="zoom"in e?t.clamp(+e.zoom,r.minZoom,r.maxZoom):i,l="bearing"in e?this._normalizeBearing(e.bearing,o):o,u="pitch"in e?+e.pitch:s,h="padding"in e?e.padding:r.padding,d=r.zoomScale(c-i),p=t.pointGeometry.convert(e.offset);let f=r.centerPoint.add(p);const m=r.pointLocation(f),g=t.LngLat.convert(e.center||m);this._normalizeCenter(g);const _=r.project(m),y=r.project(g).sub(_);let v=e.curve;const b=Math.max(r.width,r.height),x=b/d,w=y.mag();if("minZoom"in e){const n=t.clamp(Math.min(e.minZoom,i,c),r.minZoom,r.maxZoom),o=b/r.zoomScale(n-i);v=Math.sqrt(o/w*2)}const T=v*v;function C(t){const e=(x*x-b*b+(t?-1:1)*T*T*w*w)/(2*(t?x:b)*T*w);return Math.log(Math.sqrt(e*e+1)-e)}function E(t){return(Math.exp(t)-Math.exp(-t))/2}function S(t){return(Math.exp(t)+Math.exp(-t))/2}const I=C(0);let k=function(t){return S(I)/S(I+v*t)},A=function(t){return b*((S(I)*(E(e=I+v*t)/S(e))-E(I))/T)/w;var e},M=(C(1)-I)/v;if(Math.abs(w)<1e-6||!isFinite(M)){if(Math.abs(b-x)<1e-6)return this.easeTo(e,n);const t=x<b?-1:1;M=Math.abs(Math.log(x/b))/v,A=function(){return 0},k=function(e){return Math.exp(t*v*e)}}e.duration="duration"in e?+e.duration:1e3*M/("screenSpeed"in e?+e.screenSpeed/v:+e.speed),e.maxDuration&&e.duration>e.maxDuration&&(e.duration=0);const O=o!==l,P=u!==s,D=!r.isPaddingEqual(h),R=r=>d=>{const m=d*M,v=1/k(m);r.zoom=1===d?c:i+r.scaleZoom(v),O&&(r.bearing=t.number(o,l,d)),P&&(r.pitch=t.number(s,u,d)),D&&(r.interpolatePadding(a,h,d),f=r.centerPoint.add(p));const b=1===d?g:r.unproject(_.add(y.mult(A(m))).mult(v));return r.setLocationAtPoint(r.renderWorldCopies?b.wrap():b,f),r._updateCameraOnTerrain(),e.preloadOnly||this._fireMoveEvents(n),r};if(e.preloadOnly){const t=this._emulate(R,e.duration,r);return this._preloadTiles(t),this}return this._zooming=!0,this._rotating=O,this._pitching=P,this._padding=D,this._prepareEase(n,!1),this._ease(R(r),()=>this._afterEase(n),e),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_stop(t,e){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const t=this._onEaseEnd;this._onEaseEnd=void 0,t.call(this,e)}if(!t){const t=this.handlers;t&&t.stop(!1)}return this}_ease(e,n,r){!1===r.animate||0===r.duration?(e(1),n()):(this._easeStart=t.exported.now(),this._easeOptions=r,this._onEaseFrame=e,this._onEaseEnd=n,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const e=Math.min((t.exported.now()-this._easeStart)/this._easeOptions.duration,1),n=this._onEaseFrame;n&&n(this._easeOptions.easing(e)),e<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(e,n){e=t.wrap(e,-180,180);const r=Math.abs(e-n);return Math.abs(e-360-n)<r&&(e-=360),Math.abs(e+360-n)<r&&(e+=360),e}_normalizeCenter(t){const e=this.transform;if(!e.renderWorldCopies||e.maxBounds)return;const n=t.lng-e.center.lng;t.lng+=n>180?-360:n<-180?360:0}_emulate(t,e,n){const r=Math.ceil(15*e/1e3),i=[],o=t(n.clone());for(let s=0;s<=r;s++){const t=o(s/r);i.push(t.clone())}return i}}class Fi{constructor(e={}){this.options=e,t.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(t){const e=this.options&&this.options.compact;return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=o("button","mapboxgl-ctrl-attrib-button",this._container),o("span","mapboxgl-ctrl-icon",this._compactButton).setAttribute("aria-hidden","true"),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=o("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),e&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===e&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_setElementTitle(t,e){const n=this._map._getUIString(`AttributionControl.${e}`);t.setAttribute("aria-label",n),t.removeAttribute("title"),t.firstElementChild&&t.firstElementChild.setAttribute("title",n)}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let e=this._editLink;e||(e=this._editLink=this._container.querySelector(".mapbox-improve-map"));const n=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||t.config.ACCESS_TOKEN}];if(e){const r=n.reduce((t,e,r)=>(e.value&&(t+=`${e.key}=${e.value}${r<n.length-1?"&":""}`),t),"?");e.href=`${t.config.FEEDBACK_URL}/${r}${this._map._hash?this._map._hash.getHashString(!0):""}`,e.rel="noopener nofollow",this._setElementTitle(e,"MapFeedback")}}_updateData(t){!t||"metadata"!==t.sourceDataType&&"visibility"!==t.sourceDataType&&"style"!==t.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let t=[];if(this._map.style.stylesheet){const t=this._map.style.stylesheet;this.styleOwner=t.owner,this.styleId=t.id}const e=this._map.style._sourceCaches;for(const r in e){const n=e[r];if(n.used){const e=n.getSource();e.attribution&&t.indexOf(e.attribution)<0&&t.push(e.attribution)}}t.sort((t,e)=>t.length-e.length),t=t.filter((e,n)=>{for(let r=n+1;r<t.length;r++)if(t[r].indexOf(e)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?t=[...this.options.customAttribution,...t]:t.unshift(this.options.customAttribution));const n=t.join(" | ");n!==this._attribHTML&&(this._attribHTML=n,t.length?(this._innerContainer.innerHTML=n,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Bi{constructor(){t.bindAll(["_updateLogo","_updateCompact"],this)}onAdd(t){this._map=t,this._container=o("div","mapboxgl-ctrl");const e=o("a","mapboxgl-ctrl-logo");return e.target="_blank",e.rel="noopener nofollow",e.href="https://www.mapbox.com/",e.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),e.setAttribute("rel","noopener nofollow"),this._container.appendChild(e),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(t){t&&"metadata"!==t.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const t=this._map.style._sourceCaches;if(0===Object.entries(t).length)return!0;for(const e in t){const n=t[e].getSource();if(n.hasOwnProperty("mapbox_logo")&&!n.mapbox_logo)return!1}return!0}_updateCompact(){const t=this._container.children;if(t.length){const e=t[0];this._map.getCanvasContainer().offsetWidth<250?e.classList.add("mapboxgl-compact"):e.classList.remove("mapboxgl-compact")}}}class Ui{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(t){const e=++this._id;return this._queue.push({callback:t,id:e,cancelled:!1}),e}remove(t){const e=this._currentlyRunning,n=e?this._queue.concat(e):this._queue;for(const r of n)if(r.id===t)return void(r.cancelled=!0)}run(t=0){const e=this._currentlyRunning=this._queue;this._queue=[];for(const n of e)if(!n.cancelled&&(n.callback(t),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}function Vi(e,n,r){if(e=new t.LngLat(e.lng,e.lat),n){const i=new t.LngLat(e.lng-360,e.lat),o=new t.LngLat(e.lng+360,e.lat),s=360*Math.ceil(Math.abs(e.lng-r.center.lng)/360),a=r.locationPoint(e).distSqr(n),c=n.x<0||n.y<0||n.x>r.width||n.y>r.height;r.locationPoint(i).distSqr(n)<a&&(c||Math.abs(i.lng-r.center.lng)<s)?e=i:r.locationPoint(o).distSqr(n)<a&&(c||Math.abs(o.lng-r.center.lng)<s)&&(e=o)}for(;Math.abs(e.lng-r.center.lng)>180;){const t=r.locationPoint(e);if(t.x>=0&&t.y>=0&&t.x<=r.width&&t.y<=r.height)break;e.lng>r.center.lng?e.lng-=360:e.lng+=360}return e}const qi={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};class Gi extends t.Evented{constructor(e,n){if(super(),(e instanceof t.window.HTMLElement||n)&&(e=t.extend({element:e},n)),t.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this),this._anchor=e&&e.anchor||"center",this._color=e&&e.color||"#3FB1CE",this._scale=e&&e.scale||1,this._draggable=e&&e.draggable||!1,this._clickTolerance=e&&e.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=e&&e.rotation||0,this._rotationAlignment=e&&e.rotationAlignment||"auto",this._pitchAlignment=e&&e.pitchAlignment&&"auto"!==e.pitchAlignment?e.pitchAlignment:this._rotationAlignment,this._updateMoving=()=>this._update(!0),e&&e.element)this._element=e.element,this._offset=t.pointGeometry.convert(e&&e.offset||[0,0]);else{this._defaultMarker=!0,this._element=o("div");const n=41,r=27,i=s("svg",{display:"block",height:n*this._scale+"px",width:r*this._scale+"px",viewBox:`0 0 ${r} ${n}`},this._element),a=s("radialGradient",{id:"shadowGradient"},s("defs",{},i));s("stop",{offset:"10%","stop-opacity":.4},a),s("stop",{offset:"100%","stop-opacity":.05},a),s("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},i),s("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},i),s("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},i),s("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},i),this._offset=t.pointGeometry.convert(e&&e.offset||[0,-14])}this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",t=>{t.preventDefault()}),this._element.addEventListener("mousedown",t=>{t.preventDefault()});const r=this._element.classList;for(const t in qi)r.remove(`mapboxgl-marker-anchor-${t}`);r.add(`mapboxgl-marker-anchor-${this._anchor}`),this._popup=null}addTo(t){return t===this._map||(this.remove(),this._map=t,t.getCanvasContainer().appendChild(this._element),t.on("move",this._updateMoving),t.on("moveend",this._update),t.on("remove",this._clearFadeTimer),t._addMarker(this),this.setDraggable(this._draggable),this._update(),t.on("click",this._onMapClick)),this}remove(){const t=this._map;return t&&(t.off("click",this._onMapClick),t.off("move",this._updateMoving),t.off("moveend",this._update),t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler),t.off("mouseup",this._onUp),t.off("touchend",this._onUp),t.off("mousemove",this._onMove),t.off("touchmove",this._onMove),t.off("remove",this._clearFadeTimer),t._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(e){return this._lngLat=t.LngLat.convert(e),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}getElement(){return this._element}setPopup(t){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),t){if(!("offset"in t.options)){const e=38.1,n=13.5,r=Math.sqrt(Math.pow(n,2)/2);t.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-e],"bottom-left":[r,-1*(e-n+r)],"bottom-right":[-r,-1*(e-n+r)],left:[n,-1*(e-n)],right:[-n,-1*(e-n)]}:this._offset}this._popup=t,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(t){const e=t.code,n=t.charCode||t.keyCode;"Space"!==e&&"Enter"!==e&&32!==n&&13!==n||this.togglePopup()}_onMapClick(t){const e=t.originalEvent.target,n=this._element;this._popup&&(e===n||n.contains(e))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const t=this._popup;return t?(t.isOpen()?(t.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(t.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_evaluateOpacity(){const t=this._map;if(!t)return;const e=this._pos;if(!e||e.x<0||e.x>t.transform.width||e.y<0||e.y>t.transform.height)return void this._clearFadeTimer();const n=t.unproject(e);let r=!1;if(t.transform._terrainEnabled()&&t.getTerrain()){const e=t.getFreeCameraOptions();if(e.position){const t=e.position.toLngLat();r=t.distanceTo(n)<.9*t.distanceTo(this._lngLat)}}const i=(1-t._queryFogOpacity(n))*(r?.2:1);this._element.style.opacity=`${i}`,this._popup&&this._popup._setOpacity(`${i}`),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const t=this._pos;if(!t)return;const e=this._offset.mult(this._scale),n=this._calculatePitch(),r=this._calculateRotation();this._element.style.transform=`\n            translate(${t.x}px, ${t.y}px) ${qi[this._anchor]}\n            rotateX(${n}deg) rotateZ(${r}deg)\n            translate(${e.x}px, ${e.y}px)\n        `}_calculatePitch(){return"viewport"===this._pitchAlignment||"auto"===this._pitchAlignment?0:this._map&&"map"===this._pitchAlignment?this._map.getPitch():0}_calculateRotation(){return"viewport"===this._rotationAlignment||"auto"===this._rotationAlignment?this._rotation:this._map&&"map"===this._rotationAlignment?this._rotation-this._map.getBearing():0}_update(e){t.window.cancelAnimationFrame(this._updateFrameId);const n=this._map;n&&(n.transform.renderWorldCopies&&(this._lngLat=Vi(this._lngLat,this._pos,n.transform)),this._pos=n.project(this._lngLat),!0===e?this._updateFrameId=t.window.requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),n._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),!n.getTerrain()&&!n.getFog()||this._fadeTimer||(this._fadeTimer=setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(e){return this._offset=t.pointGeometry.convert(e),this._update(),this}_onMove(e){const n=this._map;if(n){if(!this._isDragging){const t=this._clickTolerance||n._clickTolerance;this._isDragging=e.point.dist(this._pointerdownPos)>=t}this._isDragging&&(this._pos=e.point.sub(this._positionDelta),this._lngLat=n.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new t.Event("dragstart"))),this.fire(new t.Event("drag")))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const e=this._map;e&&(e.off("mousemove",this._onMove),e.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new t.Event("dragend")),this._state="inactive"}_addDragHandler(t){const e=this._map;e&&this._element.contains(t.originalEvent.target)&&(t.preventDefault(),this._positionDelta=t.point.sub(this._pos),this._pointerdownPos=t.point,this._state="pending",e.on("mousemove",this._onMove),e.on("touchmove",this._onMove),e.once("mouseup",this._onUp),e.once("touchend",this._onUp))}setDraggable(t){this._draggable=!!t;const e=this._map;return e&&(t?(e.on("mousedown",this._addDragHandler),e.on("touchstart",this._addDragHandler)):(e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(t){return this._rotation=t||0,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(t){return this._rotationAlignment=t||"auto",this._update(),this}getRotationAlignment(){return this._rotationAlignment}setPitchAlignment(t){return this._pitchAlignment=t&&"auto"!==t?t:this._rotationAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment}}class $i{constructor(t){this.jumpTo(t)}getValue(e){if(e<=this._startTime)return this._start;if(e>=this._endTime)return this._end;const n=t.easeCubicInOut((e-this._startTime)/(this._endTime-this._startTime));return this._start*(1-n)+this._end*n}isEasing(t){return t>=this._startTime&&t<=this._endTime}jumpTo(t){this._startTime=-1/0,this._endTime=-1/0,this._start=t,this._end=t}easeTo(t,e,n){this._start=this.getValue(e),this._end=t,this._startTime=e,this._endTime=e+n}}const Wi={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"},Hi={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,optimizeForTerrain:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0};function Zi(t){t.parentNode&&t.parentNode.removeChild(t)}const Ki={showCompass:!0,showZoom:!0,visualizePitch:!1};class Xi{constructor(e,n,r=!1){this._clickTolerance=10,this.element=n,this.mouseRotate=new ui({clickTolerance:e.dragRotate._mouseRotate._clickTolerance}),this.map=e,r&&(this.mousePitch=new hi({clickTolerance:e.dragRotate._mousePitch._clickTolerance})),t.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),n.addEventListener("mousedown",this.mousedown),n.addEventListener("touchstart",this.touchstart,{passive:!1}),n.addEventListener("touchmove",this.touchmove),n.addEventListener("touchend",this.touchend),n.addEventListener("touchcancel",this.reset)}down(t,e){this.mouseRotate.mousedown(t,e),this.mousePitch&&this.mousePitch.mousedown(t,e),u()}move(t,e){const n=this.map,r=this.mouseRotate.mousemoveWindow(t,e),i=r&&r.bearingDelta;if(i&&n.setBearing(n.getBearing()+i),this.mousePitch){const r=this.mousePitch.mousemoveWindow(t,e),i=r&&r.pitchDelta;i&&n.setPitch(n.getPitch()+i)}}off(){const t=this.element;t.removeEventListener("mousedown",this.mousedown),t.removeEventListener("touchstart",this.touchstart,{passive:!1}),t.removeEventListener("touchmove",this.touchmove),t.removeEventListener("touchend",this.touchend),t.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){h(),t.window.removeEventListener("mousemove",this.mousemove),t.window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(t.extend({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),f(this.element,e)),t.window.addEventListener("mousemove",this.mousemove),t.window.addEventListener("mouseup",this.mouseup)}mousemove(t){this.move(t,f(this.element,t))}mouseup(t){this.mouseRotate.mouseupWindow(t),this.mousePitch&&this.mousePitch.mouseupWindow(t),this.offTemp()}touchstart(t){1!==t.targetTouches.length?this.reset():(this._startPos=this._lastPos=m(this.element,t.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>t.preventDefault()},this._startPos))}touchmove(t){1!==t.targetTouches.length?this.reset():(this._lastPos=m(this.element,t.targetTouches)[0],this.move({preventDefault:()=>t.preventDefault()},this._lastPos))}touchend(t){0===t.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}const Yi={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1};let Qi,Ji=0,to=!1;const eo={maxWidth:100,unit:"metric"};function no(t,e,n){const r=n&&n.maxWidth||100,i=t._containerHeight/2,o=t._containerWidth/2-r/2,s=t.unproject([o,i]),a=t.unproject([o+r,i]),c=s.distanceTo(a);if(n&&"imperial"===n.unit){const n=3.2808*c;n>5280?ro(e,r,n/5280,t._getUIString("ScaleControl.Miles"),t):ro(e,r,n,t._getUIString("ScaleControl.Feet"),t)}else n&&"nautical"===n.unit?ro(e,r,c/1852,t._getUIString("ScaleControl.NauticalMiles"),t):c>=1e3?ro(e,r,c/1e3,t._getUIString("ScaleControl.Kilometers"),t):ro(e,r,c,t._getUIString("ScaleControl.Meters"),t)}function ro(t,e,n,r,i){const o=function(t){const e=Math.pow(10,`${Math.floor(t)}`.length-1);let n=t/e;return n=n>=10?10:n>=5?5:n>=3?3:n>=2?2:n>=1?1:function(t){const e=Math.pow(10,Math.ceil(-Math.log(t)/Math.LN10));return Math.round(t*e)/e}(n),e*n}(n),s=o/n;i._requestDomTask(()=>{t.style.width=e*s+"px",t.innerHTML=`${o}&nbsp;${r}`})}const io={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},oo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function so(e=new t.pointGeometry(0,0),n="bottom"){if("number"==typeof e){const r=Math.round(Math.sqrt(.5*Math.pow(e,2)));switch(n){case"top":return new t.pointGeometry(0,e);case"top-left":return new t.pointGeometry(r,r);case"top-right":return new t.pointGeometry(-r,r);case"bottom":return new t.pointGeometry(0,-e);case"bottom-left":return new t.pointGeometry(r,-r);case"bottom-right":return new t.pointGeometry(-r,-r);case"left":return new t.pointGeometry(e,0);case"right":return new t.pointGeometry(-e,0)}return new t.pointGeometry(0,0)}return e instanceof t.pointGeometry||Array.isArray(e)?t.pointGeometry.convert(e):t.pointGeometry.convert(e[n]||[0,0])}const ao={version:t.version,supported:e,setRTLTextPlugin:t.setRTLTextPlugin,getRTLTextPluginStatus:t.getRTLTextPluginStatus,Map:class extends zi{constructor(e){if(null!=(e=t.extend({},Hi,e)).minZoom&&null!=e.maxZoom&&e.minZoom>e.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=e.minPitch&&null!=e.maxPitch&&e.minPitch>e.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=e.minPitch&&e.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=e.maxPitch&&e.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(e.antialias&&t.isSafariWithAntialiasingBug(t.window)&&(e.antialias=!1,t.warnOnce("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Br(e.minZoom,e.maxZoom,e.minPitch,e.maxPitch,e.renderWorldCopies),e),this._interactive=e.interactive,this._minTileCacheSize=e.minTileCacheSize,this._maxTileCacheSize=e.maxTileCacheSize,this._failIfMajorPerformanceCaveat=e.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=e.preserveDrawingBuffer,this._antialias=e.antialias,this._trackResize=e.trackResize,this._bearingSnap=e.bearingSnap,this._refreshExpiredTiles=e.refreshExpiredTiles,this._fadeDuration=e.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=e.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=e.collectResourceTiming,this._optimizeForTerrain=e.optimizeForTerrain,this._renderTaskQueue=new Ui,this._domRenderTaskQueue=new Ui,this._controls=[],this._markers=[],this._mapId=t.uniqueId(),this._locale=t.extend({},Wi,e.locale),this._clickTolerance=e.clickTolerance,this._cooperativeGestures=e.cooperativeGestures,this._containerWidth=0,this._containerHeight=0,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new $i(0),this._explicitProjection=null,this._requestManager=new t.RequestManager(e.transformRequest,e.accessToken,e.testMode),this._silenceAuthErrors=!!e.testMode,"string"==typeof e.container){if(this._container=t.window.document.getElementById(e.container),!this._container)throw new Error(`Container '${e.container}' not found.`)}else{if(!(e.container instanceof t.window.HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=e.container}if(this._container.childNodes.length>0&&t.warnOnce("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),e.maxBounds&&this.setMaxBounds(e.maxBounds),t.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),void 0!==t.window&&(t.window.addEventListener("online",this._onWindowOnline,!1),t.window.addEventListener("resize",this._onWindowResize,!1),t.window.addEventListener("orientationchange",this._onWindowResize,!1),t.window.addEventListener("webkitfullscreenchange",this._onWindowResize,!1)),this.handlers=new Li(this,e),this._localFontFamily=e.localFontFamily,this._localIdeographFontFamily=e.localIdeographFontFamily,e.style&&this.setStyle(e.style,{localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),e.projection&&this.setProjection(e.projection),this._hash=e.hash&&new Vr("string"==typeof e.hash&&e.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:e.center,zoom:e.zoom,bearing:e.bearing,pitch:e.pitch}),e.bounds&&(this.resize(),this.fitBounds(e.bounds,t.extend({},e.fitBoundsOptions,{duration:0})))),this.resize(),e.attributionControl&&this.addControl(new Fi({customAttribution:e.customAttribution})),this._logoControl=new Bi,this.addControl(this._logoControl,e.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet)}),this.on("data",e=>{this._update("style"===e.dataType),this.fire(new t.Event(`${e.dataType}data`,e))}),this.on("dataloading",e=>{this.fire(new t.Event(`${e.dataType}dataloading`,e))})}_getMapId(){return this._mapId}addControl(e,n){if(void 0===n&&(n=e.getDefaultPosition?e.getDefaultPosition():"top-right"),!e||!e.onAdd)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const r=e.onAdd(this);this._controls.push(e);const i=this._controlPositions[n];return-1!==n.indexOf("bottom")?i.insertBefore(r,i.firstChild):i.appendChild(r),this}removeControl(e){if(!e||!e.onRemove)return this.fire(new t.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const n=this._controls.indexOf(e);return n>-1&&this._controls.splice(n,1),e.onRemove(this),this}hasControl(t){return this._controls.indexOf(t)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(e){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const n=!this._moving;return n&&this.fire(new t.Event("movestart",e)).fire(new t.Event("move",e)),this.fire(new t.Event("resize",e)),n&&this.fire(new t.Event("moveend",e)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(e){return this.transform.setMaxBounds(t.LngLatBounds.convert(e)),this._update()}setMinZoom(e){if((e=null==e?-2:e)>=-2&&e<=this.transform.maxZoom)return this.transform.minZoom=e,this._update(),this.getZoom()<e?this.setZoom(e):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(e){if((e=null==e?22:e)>=this.transform.minZoom)return this.transform.maxZoom=e,this._update(),this.getZoom()>e?this.setZoom(e):this.fire(new t.Event("zoomstart")).fire(new t.Event("zoom")).fire(new t.Event("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(e){if((e=null==e?0:e)<0)throw new Error("minPitch must be greater than or equal to 0");if(e>=0&&e<=this.transform.maxPitch)return this.transform.minPitch=e,this._update(),this.getPitch()<e?this.setPitch(e):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(e){if((e=null==e?85:e)>85)throw new Error("maxPitch must be less than or equal to 85");if(e>=this.transform.minPitch)return this.transform.maxPitch=e,this._update(),this.getPitch()>e?this.setPitch(e):this.fire(new t.Event("pitchstart")).fire(new t.Event("pitch")).fire(new t.Event("pitchend")),this;throw new Error("maxPitch must be greater than the current minPitch")}getMaxPitch(){return this.transform.maxPitch}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(t){return this.transform.renderWorldCopies=t,this._update()}getProjection(){return this._explicitProjection?this._explicitProjection:this.style&&this.style.stylesheet&&this.style.stylesheet.projection?this.style.stylesheet.projection:{name:"mercator",center:[0,0]}}setProjection(t){return this._lazyInitEmptyStyle(),t?"string"==typeof t&&(t={name:t}):t=null,this._updateProjection(t)}_updateProjection(t){null===t&&(this._explicitProjection=null);const e=t||this.getProjection(),n=this.transform.setProjection(e);if(t&&(this._explicitProjection=this.transform.getProjection()),n){this.painter.clearBackgroundTiles();for(const t in this.style._sourceCaches)this.style._sourceCaches[t].clearTiles();this.style.applyProjectionUpdate(),this._update(!0)}return this}project(e){return this.transform.locationPoint3D(t.LngLat.convert(e))}unproject(e){return this.transform.pointLocation3D(t.pointGeometry.convert(e))}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_createDelegatedListener(t,e,n){if("mouseenter"===t||"mouseover"===t){let r=!1;const i=i=>{const o=e.filter(t=>this.getLayer(t)),s=o.length?this.queryRenderedFeatures(i.point,{layers:o}):[];s.length?r||(r=!0,n.call(this,new Yr(t,this,i.originalEvent,{features:s}))):r=!1},o=()=>{r=!1};return{layers:new Set(e),listener:n,delegates:{mousemove:i,mouseout:o}}}if("mouseleave"===t||"mouseout"===t){let r=!1;const i=i=>{const o=e.filter(t=>this.getLayer(t));(o.length?this.queryRenderedFeatures(i.point,{layers:o}):[]).length?r=!0:r&&(r=!1,n.call(this,new Yr(t,this,i.originalEvent)))},o=e=>{r&&(r=!1,n.call(this,new Yr(t,this,e.originalEvent)))};return{layers:new Set(e),listener:n,delegates:{mousemove:i,mouseout:o}}}{const r=t=>{const r=e.filter(t=>this.getLayer(t)),i=r.length?this.queryRenderedFeatures(t.point,{layers:r}):[];i.length&&(t.features=i,n.call(this,t),delete t.features)};return{layers:new Set(e),listener:n,delegates:{[t]:r}}}}on(t,e,n){if(void 0===n)return super.on(t,e);Array.isArray(e)||(e=[e]);const r=this._createDelegatedListener(t,e,n);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[t]=this._delegatedListeners[t]||[],this._delegatedListeners[t].push(r);for(const i in r.delegates)this.on(i,r.delegates[i]);return this}once(t,e,n){if(void 0===n)return super.once(t,e);Array.isArray(e)||(e=[e]);const r=this._createDelegatedListener(t,e,n);for(const i in r.delegates)this.once(i,r.delegates[i]);return this}off(t,e,n){if(void 0===n)return super.off(t,e);e=new Set(Array.isArray(e)?e:[e]);const r=(t,e)=>{if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0},i=this._delegatedListeners?this._delegatedListeners[t]:void 0;return i&&(t=>{for(let i=0;i<t.length;i++){const o=t[i];if(o.listener===n&&r(o.layers,e)){for(const t in o.delegates)this.off(t,o.delegates[t]);return t.splice(i,1),this}}})(i),this}queryRenderedFeatures(e,n){return this.style?(void 0!==n||void 0===e||e instanceof t.pointGeometry||Array.isArray(e)||(n=e,e=void 0),this.style.queryRenderedFeatures(e=e||[[0,0],[this.transform.width,this.transform.height]],n=n||{},this.transform)):[]}querySourceFeatures(t,e){return this.style.querySourceFeatures(t,e)}queryTerrainElevation(e,n){const r=this.transform.elevation;return r?(n=t.extend({},{exaggerated:!0},n),r.getAtPoint(t.MercatorCoordinate.fromLngLat(e),null,n.exaggerated)):null}setStyle(e,n){return!1!==(n=t.extend({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},n)).diff&&n.localIdeographFontFamily===this._localIdeographFontFamily&&n.localFontFamily===this._localFontFamily&&this.style&&e?(this._diffStyle(e,n),this):(this._localIdeographFontFamily=n.localIdeographFontFamily,this._localFontFamily=n.localFontFamily,this._updateStyle(e,n))}_getUIString(t){const e=this._locale[t];if(null==e)throw new Error(`Missing UI string '${t}'`);return e}_updateStyle(t,e){return this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),t&&(this.style=new Ze(this,e||{}),this.style.setEventedParent(this,{style:this.style}),"string"==typeof t?this.style.loadURL(t):this.style.loadJSON(t)),this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Ze(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}_diffStyle(e,n){if("string"==typeof e){const r=this._requestManager.normalizeStyleURL(e),i=this._requestManager.transformRequest(r,t.ResourceType.Style);t.getJSON(i,(e,r)=>{e?this.fire(new t.ErrorEvent(e)):r&&this._updateDiff(r,n)})}else"object"==typeof e&&this._updateDiff(e,n)}_updateDiff(e,n){try{this.style.setState(e)&&this._update(!0)}catch(r){t.warnOnce(`Unable to perform style diff: ${r.message||r.error||r}.  Rebuilding the style from scratch.`),this._updateStyle(e,n)}}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(t.warnOnce("There is no style added to the map."),!1)}addSource(t,e){return this._lazyInitEmptyStyle(),this.style.addSource(t,e),this._update(!0)}isSourceLoaded(t){return!!this.style&&this.style._isSourceCacheLoaded(t)}areTilesLoaded(){const t=this.style&&this.style._sourceCaches;for(const e in t){const n=t[e]._tiles;for(const t in n){const e=n[t];if("loaded"!==e.state&&"errored"!==e.state)return!1}}return!0}addSourceType(t,e,n){this._lazyInitEmptyStyle(),this.style.addSourceType(t,e,n)}removeSource(t){return this.style.removeSource(t),this._updateTerrain(),this._update(!0)}getSource(t){return this.style.getSource(t)}addImage(e,n,{pixelRatio:r=1,sdf:i=!1,stretchX:o,stretchY:s,content:a}={}){if(this._lazyInitEmptyStyle(),n instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&n instanceof t.window.ImageBitmap){const{width:c,height:l,data:u}=t.exported.getImageData(n);this.style.addImage(e,{data:new t.RGBAImage({width:c,height:l},u),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:i,version:0})}else if(void 0===n.width||void 0===n.height)this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:c,height:l}=n,u=n;this.style.addImage(e,{data:new t.RGBAImage({width:c,height:l},new Uint8Array(u.data)),pixelRatio:r,stretchX:o,stretchY:s,content:a,sdf:i,version:0,userImage:u}),u.onAdd&&u.onAdd(this,e)}}updateImage(e,n){const r=this.style.getImage(e);if(!r)return void this.fire(new t.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const i=n instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&n instanceof t.window.ImageBitmap?t.exported.getImageData(n):n,{width:o,height:s}=i;void 0!==o&&void 0!==s?o===r.data.width&&s===r.data.height?(r.data.replace(i.data,!(n instanceof t.window.HTMLImageElement||t.window.ImageBitmap&&n instanceof t.window.ImageBitmap)),this.style.updateImage(e,r)):this.fire(new t.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):this.fire(new t.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")))}hasImage(e){return e?!!this.style.getImage(e):(this.fire(new t.ErrorEvent(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(t)}loadImage(e,n){t.getImage(this._requestManager.transformRequest(e,t.ResourceType.Image),(e,r)=>{n(e,r instanceof t.window.HTMLImageElement?t.exported.getImageData(r):r)})}listImages(){return this.style.listImages()}addLayer(t,e){return this._lazyInitEmptyStyle(),this.style.addLayer(t,e),this._update(!0)}moveLayer(t,e){return this.style.moveLayer(t,e),this._update(!0)}removeLayer(t){return this.style.removeLayer(t),this._update(!0)}getLayer(t){return this.style.getLayer(t)}setLayerZoomRange(t,e,n){return this.style.setLayerZoomRange(t,e,n),this._update(!0)}setFilter(t,e,n={}){return this.style.setFilter(t,e,n),this._update(!0)}getFilter(t){return this.style.getFilter(t)}setPaintProperty(t,e,n,r={}){return this.style.setPaintProperty(t,e,n,r),this._update(!0)}getPaintProperty(t,e){return this.style.getPaintProperty(t,e)}setLayoutProperty(t,e,n,r={}){return this.style.setLayoutProperty(t,e,n,r),this._update(!0)}getLayoutProperty(t,e){return this.style.getLayoutProperty(t,e)}setLight(t,e={}){return this._lazyInitEmptyStyle(),this.style.setLight(t,e),this._update(!0)}getLight(){return this.style.getLight()}setTerrain(t){return this._lazyInitEmptyStyle(),!t&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(t),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(t){return this._lazyInitEmptyStyle(),this.style.setFog(t),this._update(!0)}getFog(){return this.style?this.style.getFog():null}_queryFogOpacity(e){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(t.LngLat.convert(e),this.transform):0}setFeatureState(t,e){return this.style.setFeatureState(t,e),this._update()}removeFeatureState(t,e){return this.style.removeFeatureState(t,e),this._update()}getFeatureState(t){return this.style.getFeatureState(t)}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,n=this._container.getBoundingClientRect().height||300;let r,i,o,s=this._container;for(;s&&(!i||!o);){const e=t.window.getComputedStyle(s).transform;e&&"none"!==e&&(r=e.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(i=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(o=r[3])),s=s.parentElement}this._containerWidth=i?Math.abs(e/i):e,this._containerHeight=o?Math.abs(n/o):n}_detectMissingCSS(){"rgb(250, 128, 114)"!==t.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&t.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const t=this._container;t.classList.add("mapboxgl-map"),(this._missingCSSCanary=o("div","mapboxgl-canary",t)).style.visibility="hidden",this._detectMissingCSS();const e=this._canvasContainer=o("div","mapboxgl-canvas-container",t);this._interactive&&e.classList.add("mapboxgl-interactive"),this._canvas=o("canvas","mapboxgl-canvas",e),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const n=this._controlContainer=o("div","mapboxgl-control-container",t),r=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(t=>{r[t]=o("div",`mapboxgl-ctrl-${t}`,n)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(e,n){const r=t.exported.devicePixelRatio||1;this._canvas.width=r*Math.ceil(e),this._canvas.height=r*Math.ceil(n),this._canvas.style.width=`${e}px`,this._canvas.style.height=`${n}px`}_addMarker(t){this._markers.push(t)}_removeMarker(t){const e=this._markers.indexOf(t);-1!==e&&this._markers.splice(e,1)}_setupPainter(){const n=t.extend({},e.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl",n)||this._canvas.getContext("experimental-webgl",n);r?(t.storeAuthState(r,!0),this.painter=new Ir(r,this.transform),this.on("data",t=>{"source"===t.dataType&&this.painter.setTileLoadedFlag(!0)}),t.exported$1.testSupport(r)):this.fire(new t.ErrorEvent(new Error("Failed to initialize WebGL")))}_contextLost(e){e.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new t.Event("webglcontextlost",{originalEvent:e}))}_contextRestored(e){this._setupPainter(),this.resize(),this._update(),this.fire(new t.Event("webglcontextrestored",{originalEvent:e}))}_onMapScroll(t){if(t.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}_update(t){return this.style?(this._styleDirty=this._styleDirty||t,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(t){return this._update(),this._renderTaskQueue.add(t)}_cancelRenderFrame(t){this._renderTaskQueue.remove(t)}_requestDomTask(t){!this.loaded()||this.loaded()&&!this.isMoving()?t():this._domRenderTaskQueue.add(t)}_render(e){let n;const r=this.painter.context.extTimerQuery,i=t.exported.now();if(this.listens("gpu-timing-frame")&&(n=r.createQueryEXT(),r.beginQueryEXT(r.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(e),this._domRenderTaskQueue.run(e),this._removed)return;let o=!1;const s=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const e=this.transform.zoom,n=this.transform.pitch,r=t.exported.now();this.style.zoomHistory.update(e,r);const i=new t.EvaluationParameters(e,{now:r,fadeDuration:s,pitch:n,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),a=i.crossFadingFactor();1===a&&a===this._crossFadingFactor||(o=!0,this._crossFadingFactor=a),this.style.update(i)}this.style&&this.style.fog&&this.style.fog.hasTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let a=!1;if(this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),a=this._updateAverageElevation(i),this.style._updateSources(this.transform),this._forceMarkerUpdate()):a=this._updateAverageElevation(i),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,s,this._crossSourceCollisions),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showTerrainWireframe:this.showTerrainWireframe,showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:s,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),speedIndexTiming:this.speedIndexTiming}),this.fire(new t.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new t.Event("load"))),this.style&&(this.style.hasTransitions()||o)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){const e=t.exported.now()-i;r.endQueryEXT(r.TIME_ELAPSED_EXT,n),setTimeout(()=>{const i=r.getQueryObjectEXT(n,r.QUERY_RESULT_EXT)/1e6;r.deleteQueryEXT(n),this.fire(new t.Event("gpu-timing-frame",{cpuTime:e,gpuTime:i}))},50)}if(this.listens("gpu-timing-layer")){const e=this.painter.collectGpuTimers();setTimeout(()=>{const n=this.painter.queryGpuTimers(e);this.fire(new t.Event("gpu-timing-layer",{layerTimes:n}))},50)}const c=this._sourcesDirty||this._styleDirty||this._placementDirty||a;if(c||this._repaint)this.triggerRepaint();else{const e=!this.isMoving()&&this.loaded();if(e&&(a=this._updateAverageElevation(i,!0)),a)this.triggerRepaint();else if(this._triggerFrame(!1),e&&(this.fire(new t.Event("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const e=this._calculateSpeedIndex();this.fire(new t.Event("speedindexcompleted",{speedIndex:e})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||c||(this._fullyLoaded=!0,this._authenticate())}_forceMarkerUpdate(){for(const t of this._markers)t._update()}_updateAverageElevation(t,e=!1){const n=t=>(this.transform.averageElevation=t,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&n(0);if((e||t-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(t)){const e=this.transform.averageElevation;let r=this.transform.sampleAverageElevation(),i=!1;this.transform.elevation&&(i=this.transform.elevation.exaggeration()!==this._averageElevationExaggeration,this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(r)?r=0:this._averageElevationLastSampledAt=t;const o=Math.abs(e-r);if(o>1){if(this._isInitialLoad||i)return this._averageElevation.jumpTo(r),n(r);this._averageElevation.easeTo(r,t,300)}else if(o>1e-4)return this._averageElevation.jumpTo(r),n(r)}return!!this._averageElevation.isEasing(t)&&n(this._averageElevation.getValue(t))}_authenticate(){t.getMapSessionAPI(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,e=>{if(e&&(e.message===t.AUTH_ERR_MSG||401===e.status)){const e=this.painter.context.gl;t.storeAuthState(e,!1),this._logoControl instanceof Bi&&this._logoControl._updateLogo(),e&&e.clear(e.DEPTH_BUFFER_BIT|e.COLOR_BUFFER_BIT|e.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new t.ErrorEvent(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),t.postMapLoadEvent(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_updateTerrain(){this.painter.updateTerrain(this.style,this.isMoving()||this.isRotating()||this.isZooming())}_calculateSpeedIndex(){const t=this.painter.canvasCopy(),e=this.painter.getCanvasCopiesAndTimestamps();e.timeStamps.push(performance.now());const n=this.painter.context.gl,r=n.createFramebuffer();function i(t){n.framebufferTexture2D(n.FRAMEBUFFER,n.COLOR_ATTACHMENT0,n.TEXTURE_2D,t,0);const e=new Uint8Array(n.drawingBufferWidth*n.drawingBufferHeight*4);return n.readPixels(0,0,n.drawingBufferWidth,n.drawingBufferHeight,n.RGBA,n.UNSIGNED_BYTE,e),e}return n.bindFramebuffer(n.FRAMEBUFFER,r),this._canvasPixelComparison(i(t),e.canvasCopies.map(i),e.timeStamps)}_canvasPixelComparison(t,e,n){let r=n[1]-n[0];const i=t.length/4;for(let o=0;o<e.length;o++){const s=e[o];let a=0;for(let e=0;e<s.length;e+=4)s[e]===t[e]&&s[e+1]===t[e+1]&&s[e+2]===t[e+2]&&s[e+3]===t[e+3]&&(a+=1);r+=(n[o+2]-n[o+1])*(1-a/i)}return r}remove(){this._hash&&this._hash.remove();for(const t of this._controls)t.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),void 0!==t.window&&(t.window.removeEventListener("resize",this._onWindowResize,!1),t.window.removeEventListener("orientationchange",this._onWindowResize,!1),t.window.removeEventListener("webkitfullscreenchange",this._onWindowResize,!1),t.window.removeEventListener("online",this._onWindowOnline,!1));const e=this.painter.context.gl.getExtension("WEBGL_lose_context");e&&e.loseContext(),Zi(this._canvasContainer),Zi(this._controlContainer),Zi(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),t.removeAuthState(this.painter.context.gl),this._removed=!0,this.fire(new t.Event("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(e){this._renderNextFrame=this._renderNextFrame||e,this.style&&!this._frame&&(this._frame=t.exported.frame(t=>{const e=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,e&&this._render(t)}))}_preloadTiles(e){const n=this.style?Object.values(this.style._sourceCaches):[];return t.asyncAll(n,(t,n)=>t._preloadTiles(e,n),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(t){this._trackResize&&this.resize({originalEvent:t})._update()}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(t){this._showTileBoundaries!==t&&(this._showTileBoundaries=t,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(t){this._showTerrainWireframe!==t&&(this._showTerrainWireframe=t,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(t){this._speedIndexTiming!==t&&(this._speedIndexTiming=t,this._update())}get showPadding(){return!!this._showPadding}set showPadding(t){this._showPadding!==t&&(this._showPadding=t,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(t){this._showCollisionBoxes!==t&&(this._showCollisionBoxes=t,t?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(t){this._showOverdrawInspector!==t&&(this._showOverdrawInspector=t,this._update())}get repaint(){return!!this._repaint}set repaint(t){this._repaint!==t&&(this._repaint=t,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(t){this._vertices=t,this._update()}_setCacheLimits(e,n){t.setCacheLimits(e,n)}get version(){return t.version}},NavigationControl:class{constructor(e){this.options=t.extend({},Ki,e),this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",t=>t.preventDefault()),this.options.showZoom&&(t.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",t=>{this._map&&this._map.zoomIn({},{originalEvent:t})}),o("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",t=>{this._map&&this._map.zoomOut({},{originalEvent:t})}),o("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(t.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",t=>{const e=this._map;e&&(this.options.visualizePitch?e.resetNorthPitch({},{originalEvent:t}):e.resetNorth({},{originalEvent:t}))}),this._compassIcon=o("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const t=this._map;if(!t)return;const e=t.getZoom(),n=e===t.getMaxZoom(),r=e===t.getMinZoom();this._zoomInButton.disabled=n,this._zoomOutButton.disabled=r,this._zoomInButton.setAttribute("aria-disabled",n.toString()),this._zoomOutButton.setAttribute("aria-disabled",r.toString())}_rotateCompassArrow(){const t=this._map;if(!t)return;const e=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(t.transform.pitch*(Math.PI/180)),.5)}) rotateX(${t.transform.pitch}deg) rotateZ(${t.transform.angle*(180/Math.PI)}deg)`:`rotate(${t.transform.angle*(180/Math.PI)}deg)`;t._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=e)})}onAdd(t){return this._map=t,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),t.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&t.on("pitch",this._rotateCompassArrow),t.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Xi(t,this._compass,this.options.visualizePitch)),this._container}onRemove(){const t=this._map;t&&(this._container.remove(),this.options.showZoom&&t.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&t.off("pitch",this._rotateCompassArrow),t.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(t,e){const n=o("button",t,this._container);return n.type="button",n.addEventListener("click",e),n}_setButtonTitle(t,e){if(!this._map)return;const n=this._map._getUIString(`NavigationControl.${e}`);t.setAttribute("aria-label",n),t.firstElementChild&&t.firstElementChild.setAttribute("title",n)}},GeolocateControl:class extends t.Evented{constructor(e){super(),this.options=t.extend({},Yi,e),t.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ur(this._updateMarkerRotation,20)}onAdd(e){var n;return this._map=e,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),n=this._setupUI,void 0!==Qi?n(Qi):void 0!==t.window.navigator.permissions?t.window.navigator.permissions.query({name:"geolocation"}).then(t=>{Qi="denied"!==t.state,n(Qi)}):(Qi=!!t.window.navigator.geolocation,n(Qi)),this._container}onRemove(){void 0!==this._geolocationWatchID&&(t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,Ji=0,to=!1}_isOutOfMapMaxBounds(t){const e=this._map.getMaxBounds(),n=t.coords;return!!e&&(n.longitude<e.getWest()||n.longitude>e.getEast()||n.latitude<e.getSouth()||n.latitude>e.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(e){if(this._map){if(this._isOutOfMapMaxBounds(e))return this._setErrorState(),this.fire(new t.Event("outofmaxbounds",e)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=e,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(e),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(e),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("geolocate",e)),this._finish()}}_updateCamera(e){const n=new t.LngLat(e.coords.longitude,e.coords.latitude),r=e.coords.accuracy,i=this._map.getBearing(),o=t.extend({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(n.toBounds(r),o,{geolocateSource:!0})}_updateMarker(e){if(e){const n=new t.LngLat(e.coords.longitude,e.coords.latitude);this._accuracyCircleMarker.setLngLat(n).addTo(this._map),this._userLocationDotMarker.setLngLat(n).addTo(this._map),this._accuracy=e.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map._containerHeight/2,e=this._map.unproject([0,t]),n=this._map.unproject([100,t]),r=e.distanceTo(n)/100,i=Math.ceil(2*this._accuracy/r);this._circleElement.style.width=`${i}px`,this._circleElement.style.height=`${i}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._dotElement.classList.add("mapboxgl-user-location-show-heading")):(this._dotElement.classList.remove("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(e){if(this._map){if(this.options.trackUserLocation)if(1===e.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===e.code&&to)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new t.Event("error",e)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(e){if(this._container.addEventListener("contextmenu",t=>t.preventDefault()),this._geolocateButton=o("button","mapboxgl-ctrl-geolocate",this._container),o("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===e){t.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}else{const t=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=o("div","mapboxgl-user-location"),this._dotElement.appendChild(o("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(o("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Gi({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=o("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Gi({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",e=>{e.geolocateSource||"ACTIVE_LOCK"!==this._watchState||e.originalEvent&&"resize"===e.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new t.Event("trackuserlocationend")))})}_onDeviceOrientation(t){this._userLocationDotMarker&&(t.webkitCompassHeading?this._heading=t.webkitCompassHeading:!0===t.absolute&&(this._heading=-1*t.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return t.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new t.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":Ji--,to=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new t.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new t.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),Ji++,Ji>1?(e={maximumAge:6e5,timeout:0},to=!0):(e=this.options.positionOptions,to=!1),this._geolocationWatchID=t.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else t.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{t.window.addEventListener("ondeviceorientationabsolute"in t.window?"deviceorientationabsolute":"deviceorientation",this._onDeviceOrientation)};void 0!==t.window.DeviceMotionEvent&&"function"==typeof t.window.DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){t.window.navigator.geolocation.clearWatch(this._geolocationWatchID),t.window.removeEventListener("deviceorientation",this._onDeviceOrientation),t.window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Fi,ScaleControl:class{constructor(e){this.options=t.extend({},eo,e),t.bindAll(["_onMove","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_onMove(){no(this._map,this._container,this.options)}onAdd(t){return this._map=t,this._container=o("div","mapboxgl-ctrl mapboxgl-ctrl-scale",t.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._onMove),this._map=void 0}setUnit(t){this.options.unit=t,no(this._map,this._container,this.options)}},FullscreenControl:class{constructor(e){this._fullscreen=!1,e&&e.container&&(e.container instanceof t.window.HTMLElement?this._container=e.container:t.warnOnce("Full screen control 'container' must be a DOM element.")),t.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in t.window.document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in t.window.document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(e){return this._map=e,this._container||(this._container=this._map.getContainer()),this._controlContainer=o("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",t.warnOnce("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,t.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!t.window.document.fullscreenEnabled&&!t.window.document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=o("button","mapboxgl-ctrl-fullscreen",this._controlContainer);o("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),t.window.document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const t=this._getTitle();this._fullscreenButton.setAttribute("aria-label",t),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",t)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(t.window.document.fullscreenElement||t.window.document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?t.window.document.exitFullscreen?t.window.document.exitFullscreen():t.window.document.webkitCancelFullScreen&&t.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},Popup:class extends t.Evented{constructor(e){super(),this.options=t.extend(Object.create(io),e),t.bindAll(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(e&&e.className?e.className.trim().split(/\s+/):[])}addTo(e){return this._map&&this.remove(),this._map=e,this.options.closeOnClick&&e.on("preclick",this._onClose),this.options.closeOnMove&&e.on("move",this._onClose),e.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(e.on("mousemove",this._onMouseEvent),e.on("mouseup",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")):e.on("move",this._update),this.fire(new t.Event("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const e=this._map;return e&&(e.off("move",this._update),e.off("move",this._onClose),e.off("preclick",this._onClose),e.off("click",this._onClose),e.off("remove",this.remove),e.off("mousemove",this._onMouseEvent),e.off("mouseup",this._onMouseEvent),e.off("drag",this._onMouseEvent),this._map=void 0),this.fire(new t.Event("close")),this}getLngLat(){return this._lngLat}setLngLat(e){this._lngLat=t.LngLat.convert(e),this._pos=null,this._trackPointer=!1,this._update();const n=this._map;return n&&(n.on("move",this._update),n.off("mousemove",this._onMouseEvent),n._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const t=this._map;return t&&(t.off("move",this._update),t.on("mousemove",this._onMouseEvent),t.on("drag",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(t.window.document.createTextNode(e))}setHTML(e){const n=t.window.document.createDocumentFragment(),r=t.window.document.createElement("body");let i;for(r.innerHTML=e;i=r.firstChild,i;)n.appendChild(i);return this.setDOMContent(n)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(t){return this.options.maxWidth=t,this._update(),this}setDOMContent(t){let e=this._content;if(e)for(;e.hasChildNodes();)e.firstChild&&e.removeChild(e.firstChild);else e=this._content=o("div","mapboxgl-popup-content",this._container||void 0);if(e.appendChild(t),this.options.closeButton){const t=this._closeButton=o("button","mapboxgl-popup-close-button",e);t.type="button",t.setAttribute("aria-label","Close popup"),t.setAttribute("aria-hidden","true"),t.innerHTML="&#215;",t.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(t){return this._classList.add(t),this._updateClassList(),this}removeClassName(t){return this._classList.delete(t),this._updateClassList(),this}setOffset(t){return this.options.offset=t,this._update(),this}toggleClassName(t){let e;return this._classList.delete(t)?e=!1:(this._classList.add(t),e=!0),this._updateClassList(),e}_onMouseEvent(t){this._update(t.point)}_getAnchor(t){if(this.options.anchor)return this.options.anchor;const e=this._map,n=this._container,r=this._pos;if(!e||!n||!r)return"bottom";const i=n.offsetWidth,o=n.offsetHeight,s=r.x<i/2,a=r.x>e.transform.width-i/2;if(r.y+t<o)return s?"top-left":a?"top-right":"top";if(r.y>e.transform.height-o){if(s)return"bottom-left";if(a)return"bottom-right"}return s?"left":a?"right":"bottom"}_updateClassList(){const t=this._container;if(!t)return;const e=[...this._classList];e.push("mapboxgl-popup"),this._anchor&&e.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&e.push("mapboxgl-popup-track-pointer"),t.className=e.join(" ")}_update(t){const e=this._map,n=this._content;if(!e||!this._lngLat&&!this._trackPointer||!n)return;let r=this._container;if(r||(r=this._container=o("div","mapboxgl-popup",e.getContainer()),this._tip=o("div","mapboxgl-popup-tip",r),r.appendChild(n)),this.options.maxWidth&&r.style.maxWidth!==this.options.maxWidth&&(r.style.maxWidth=this.options.maxWidth),e.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Vi(this._lngLat,this._pos,e.transform)),!this._trackPointer||t){const n=this._pos=this._trackPointer&&t?t:e.project(this._lngLat),r=so(this.options.offset),i=this._anchor=this._getAnchor(r.y),o=so(this.options.offset,i),s=n.add(o).round();e._requestDomTask(()=>{this._container&&i&&(this._container.style.transform=`${qi[i]} translate(${s.x}px,${s.y}px)`)})}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const t=this._container.querySelector(oo);t&&t.focus()}_onClose(){this.remove()}_setOpacity(t){this._content&&(this._content.style.opacity=t),this._tip&&(this._tip.style.opacity=t)}},Marker:Gi,Style:Ze,LngLat:t.LngLat,LngLatBounds:t.LngLatBounds,Point:t.pointGeometry,MercatorCoordinate:t.MercatorCoordinate,FreeCameraOptions:Pr,Evented:t.Evented,config:t.config,prewarm:function(){Ft().acquire(Lt)},clearPrewarmedResources:function(){const t=zt;t&&(t.isPreloaded()&&1===t.numActive()?(t.release(Lt),zt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return t.config.ACCESS_TOKEN},set accessToken(e){t.config.ACCESS_TOKEN=e},get baseApiUrl(){return t.config.API_URL},set baseApiUrl(e){t.config.API_URL=e},get workerCount(){return jt.workerCount},set workerCount(t){jt.workerCount=t},get maxParallelImageRequests(){return t.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(e){t.config.MAX_PARALLEL_IMAGE_REQUESTS=e},clearStorage(e){t.clearTileCache(e)},workerUrl:"",workerClass:null,setNow:t.exported.setNow,restoreNow:t.exported.restoreNow};return ao}),n}()},"5+tZ":function(t,e,n){"use strict";n.d(e,"a",function(){return s});var r=n("lJxs"),i=n("Cfvw"),o=n("zx2A");function s(t,e,n=Number.POSITIVE_INFINITY){return"function"==typeof e?o=>o.pipe(s((n,o)=>Object(i.a)(t(n,o)).pipe(Object(r.a)((t,r)=>e(n,t,o,r))),n)):("number"==typeof e&&(n=e),e=>e.lift(new a(t,n)))}class a{constructor(t,e=Number.POSITIVE_INFINITY){this.project=t,this.concurrent=e}call(t,e){return e.subscribe(new c(t,this.project,this.concurrent))}}class c extends o.b{constructor(t,e,n=Number.POSITIVE_INFINITY){super(t),this.project=e,this.concurrent=n,this.hasCompleted=!1,this.buffer=[],this.active=0,this.index=0}_next(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)}_tryNext(t){let e;const n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this.active++,this._innerSub(e)}_innerSub(t){const e=new o.a(this),n=this.destination;n.add(e);const r=Object(o.c)(t,e);r!==e&&n.add(r)}_complete(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()}notifyNext(t){this.destination.next(t)}notifyComplete(){const t=this.buffer;this.active--,t.length>0?this._next(t.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()}}},"6Uf2":function(t,e,n){"use strict";(function(t){var e=n("zIRd"),r=n("/6Yf"),i=n("qOnz"),o=n("mrSG"),s=n("q/0M"),a="";function c(t){a=t}var l,u=function(){function t(t){this.domStorage_=t,this.prefix_="firebase:"}return t.prototype.set=function(t,e){null==e?this.domStorage_.removeItem(this.prefixedName_(t)):this.domStorage_.setItem(this.prefixedName_(t),Object(i.J)(e))},t.prototype.get=function(t){var e=this.domStorage_.getItem(this.prefixedName_(t));return null==e?null:Object(i.D)(e)},t.prototype.remove=function(t){this.domStorage_.removeItem(this.prefixedName_(t))},t.prototype.prefixedName_=function(t){return this.prefix_+t},t.prototype.toString=function(){return this.domStorage_.toString()},t}(),h=function(){function t(){this.cache_={},this.isInMemoryStorage=!0}return t.prototype.set=function(t,e){null==e?delete this.cache_[t]:this.cache_[t]=e},t.prototype.get=function(t){return Object(i.i)(this.cache_,t)?this.cache_[t]:null},t.prototype.remove=function(t){delete this.cache_[t]},t}(),d=function(t){try{if("undefined"!=typeof window&&void 0!==window[t]){var e=window[t];return e.setItem("firebase:sentinel","cache"),e.removeItem("firebase:sentinel"),new u(e)}}catch(n){}return new h},p=d("localStorage"),f=d("sessionStorage"),m=new s.b("@firebase/database"),g=(l=1,function(){return l++}),_=function(t){var e=Object(i.I)(t),n=new i.d;n.update(e);var r=n.digest();return i.g.encodeByteArray(r)},y=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n="",r=0;r<t.length;r++){var o=t[r];Array.isArray(o)||o&&"object"==typeof o&&"number"==typeof o.length?n+=y.apply(null,o):n+="object"==typeof o?Object(i.J)(o):o,n+=" "}return n},v=null,b=!0,x=function(t,e){Object(i.e)(!e||!0===t||!1===t,"Can't turn on custom loggers persistently."),!0===t?(m.logLevel=s.a.VERBOSE,v=m.log.bind(m),e&&f.set("logging_enabled",!0)):"function"==typeof t?v=t:(v=null,f.remove("logging_enabled"))},w=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];if(!0===b&&(b=!1,null===v&&!0===f.get("logging_enabled")&&x(!0)),v){var n=y.apply(null,t);v(n)}},T=function(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];w.apply(void 0,Object(o.f)([t],Object(o.e)(e)))}},C=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE INTERNAL ERROR: "+y.apply(void 0,Object(o.f)([],Object(o.e)(t)));m.error(n)},E=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE FATAL ERROR: "+y.apply(void 0,Object(o.f)([],Object(o.e)(t)));throw m.error(n),new Error(n)},S=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n="FIREBASE WARNING: "+y.apply(void 0,Object(o.f)([],Object(o.e)(t)));m.warn(n)},I=function(t){return"number"==typeof t&&(t!=t||t===Number.POSITIVE_INFINITY||t===Number.NEGATIVE_INFINITY)},k="[MIN_NAME]",A="[MAX_NAME]",M=function(t,e){if(t===e)return 0;if(t===k||e===A)return-1;if(e===k||t===A)return 1;var n=z(t),r=z(e);return null!==n?null!==r?n-r==0?t.length-e.length:n-r:-1:null!==r?1:t<e?-1:1},O=function(t,e){return t===e?0:t<e?-1:1},P=function(t,e){if(e&&t in e)return e[t];throw new Error("Missing required key ("+t+") in object: "+Object(i.J)(e))},D=function(t){if("object"!=typeof t||null===t)return Object(i.J)(t);var e=[];for(var n in t)e.push(n);e.sort();for(var r="{",o=0;o<e.length;o++)0!==o&&(r+=","),r+=Object(i.J)(e[o]),r+=":",r+=D(t[e[o]]);return r+"}"},R=function(t,e){var n=t.length;if(n<=e)return[t];for(var r=[],i=0;i<n;i+=e)r.push(t.substring(i,i+e>n?n:i+e));return r};function N(t,e){for(var n in t)t.hasOwnProperty(n)&&e(n,t[n])}var L=function(t){var e,n,r,o,s;Object(i.e)(!I(t),"Invalid JSON number"),0===t?(n=0,r=0,e=1/t==-1/0?1:0):(e=t<0,(t=Math.abs(t))>=Math.pow(2,-1022)?(n=(o=Math.min(Math.floor(Math.log(t)/Math.LN2),1023))+1023,r=Math.round(t*Math.pow(2,52-o)-Math.pow(2,52))):(n=0,r=Math.round(t/Math.pow(2,-1074))));var a=[];for(s=52;s;s-=1)a.push(r%2?1:0),r=Math.floor(r/2);for(s=11;s;s-=1)a.push(n%2?1:0),n=Math.floor(n/2);a.push(e?1:0),a.reverse();var c=a.join(""),l="";for(s=0;s<64;s+=8){var u=parseInt(c.substr(s,8),2).toString(16);1===u.length&&(u="0"+u),l+=u}return l.toLowerCase()},j=new RegExp("^-?(0*)\\d{1,10}$"),z=function(t){if(j.test(t)){var e=Number(t);if(e>=-2147483648&&e<=2147483647)return e}return null},F=function(t){try{t()}catch(e){setTimeout(function(){throw S("Exception was thrown by user callback.",e.stack||""),e},Math.floor(0))}},B=function(t,e){var n=setTimeout(t,e);return"object"==typeof n&&n.unref&&n.unref(),n},U=function(){function t(t,e){var n=this;this.appName_=t,this.appCheckProvider=e,this.appCheck=null==e?void 0:e.getImmediate({optional:!0}),this.appCheck||null==e||e.get().then(function(t){return n.appCheck=t})}return t.prototype.getToken=function(t){var e=this;return this.appCheck?this.appCheck.getToken(t):new Promise(function(n,r){setTimeout(function(){e.appCheck?e.getToken(t).then(n,r):n(null)},0)})},t.prototype.addTokenChangeListener=function(t){var e;null===(e=this.appCheckProvider)||void 0===e||e.get().then(function(e){return e.addTokenListener(t)})},t.prototype.notifyForInvalidToken=function(){S('Provided AppCheck credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly.')},t}(),V=function(){function t(t,e,n){var r=this;this.appName_=t,this.firebaseOptions_=e,this.authProvider_=n,this.auth_=null,this.auth_=n.getImmediate({optional:!0}),this.auth_||n.onInit(function(t){return r.auth_=t})}return t.prototype.getToken=function(t){var e=this;return this.auth_?this.auth_.getToken(t).catch(function(t){return t&&"auth/token-not-initialized"===t.code?(w("Got auth/token-not-initialized error.  Treating as null token."),null):Promise.reject(t)}):new Promise(function(n,r){setTimeout(function(){e.auth_?e.getToken(t).then(n,r):n(null)},0)})},t.prototype.addTokenChangeListener=function(t){this.auth_?this.auth_.addAuthTokenListener(t):this.authProvider_.get().then(function(e){return e.addAuthTokenListener(t)})},t.prototype.removeTokenChangeListener=function(t){this.authProvider_.get().then(function(e){return e.removeAuthTokenListener(t)})},t.prototype.notifyForInvalidToken=function(){var t='Provided authentication credentials for the app named "'+this.appName_+'" are invalid. This usually indicates your app was not initialized correctly. ';S(t+="credential"in this.firebaseOptions_?'Make sure the "credential" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':"serviceAccount"in this.firebaseOptions_?'Make sure the "serviceAccount" property provided to initializeApp() is authorized to access the specified "databaseURL" and is from the correct project.':'Make sure the "apiKey" and "databaseURL" properties provided to initializeApp() match the values provided for your app at https://console.firebase.google.com/.')},t}(),q=function(){function t(t){this.accessToken=t}return t.prototype.getToken=function(t){return Promise.resolve({accessToken:this.accessToken})},t.prototype.addTokenChangeListener=function(t){t(this.accessToken)},t.prototype.removeTokenChangeListener=function(t){},t.prototype.notifyForInvalidToken=function(){},t.OWNER="owner",t}(),G=/(console\.firebase|firebase-console-\w+\.corp|firebase\.corp)\.google\.com/,$="websocket",W="long_polling",H=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=!1),void 0===o&&(o=""),void 0===s&&(s=!1),this.secure=e,this.namespace=n,this.webSocketOnly=r,this.nodeAdmin=i,this.persistenceKey=o,this.includeNamespaceInQueryParams=s,this._host=t.toLowerCase(),this._domain=this._host.substr(this._host.indexOf(".")+1),this.internalHost=p.get("host:"+t)||this._host}return t.prototype.isCacheableHost=function(){return"s-"===this.internalHost.substr(0,2)},t.prototype.isCustomHost=function(){return"firebaseio.com"!==this._domain&&"firebaseio-demo.com"!==this._domain},Object.defineProperty(t.prototype,"host",{get:function(){return this._host},set:function(t){t!==this.internalHost&&(this.internalHost=t,this.isCacheableHost()&&p.set("host:"+this._host,this.internalHost))},enumerable:!1,configurable:!0}),t.prototype.toString=function(){var t=this.toURLString();return this.persistenceKey&&(t+="<"+this.persistenceKey+">"),t},t.prototype.toURLString=function(){return(this.secure?"https://":"http://")+this.host+"/"+(this.includeNamespaceInQueryParams?"?ns="+this.namespace:"")},t}();function Z(t,e,n){var r;if(Object(i.e)("string"==typeof e,"typeof type must == string"),Object(i.e)("object"==typeof n,"typeof params must == object"),e===$)r=(t.secure?"wss://":"ws://")+t.internalHost+"/.ws?";else{if(e!==W)throw new Error("Unknown connection type: "+e);r=(t.secure?"https://":"http://")+t.internalHost+"/.lp?"}(function(t){return t.host!==t.internalHost||t.isCustomHost()||t.includeNamespaceInQueryParams})(t)&&(n.ns=t.namespace);var o=[];return N(n,function(t,e){o.push(t+"="+e)}),r+o.join("&")}var K=function(){function t(){this.counters_={}}return t.prototype.incrementCounter=function(t,e){void 0===e&&(e=1),Object(i.i)(this.counters_,t)||(this.counters_[t]=0),this.counters_[t]+=e},t.prototype.get=function(){return Object(i.l)(this.counters_)},t}(),X={},Y={};function Q(t){var e=t.toString();return X[e]||(X[e]=new K),X[e]}var J=function(){function t(t){this.onMessage_=t,this.pendingResponses=[],this.currentResponseNum=0,this.closeAfterResponse=-1,this.onClose=null}return t.prototype.closeAfter=function(t,e){this.closeAfterResponse=t,this.onClose=e,this.closeAfterResponse<this.currentResponseNum&&(this.onClose(),this.onClose=null)},t.prototype.handleResponse=function(t,e){var n=this;this.pendingResponses[t]=e;for(var r=function(){var t=i.pendingResponses[i.currentResponseNum];delete i.pendingResponses[i.currentResponseNum];for(var e=function(e){t[e]&&F(function(){n.onMessage_(t[e])})},r=0;r<t.length;++r)e(r);if(i.currentResponseNum===i.closeAfterResponse)return i.onClose&&(i.onClose(),i.onClose=null),"break";i.currentResponseNum++},i=this;this.pendingResponses[this.currentResponseNum]&&"break"!==r(););},t}(),tt="start",et="close",nt=function(){function t(t,e,n,r,i,o,s){var a=this;this.connId=t,this.repoInfo=e,this.applicationId=n,this.appCheckToken=r,this.authToken=i,this.transportSessionId=o,this.lastSessionId=s,this.bytesSent=0,this.bytesReceived=0,this.everConnected_=!1,this.log_=T(t),this.stats_=Q(e),this.urlFn=function(t){return a.appCheckToken&&(t.ac=a.appCheckToken),Z(e,W,t)}}return t.prototype.open=function(t,e){var n=this;this.curSegmentNum=0,this.onDisconnect_=e,this.myPacketOrderer=new J(t),this.isClosed_=!1,this.connectTimeoutTimer_=setTimeout(function(){n.log_("Timed out trying to connect."),n.onClosed_(),n.connectTimeoutTimer_=null},Math.floor(3e4)),function(t){if(Object(i.y)()||"complete"===document.readyState)t();else{var e=!1,n=function(){document.body?e||(e=!0,t()):setTimeout(n,Math.floor(10))};document.addEventListener?(document.addEventListener("DOMContentLoaded",n,!1),window.addEventListener("load",n,!1)):document.attachEvent&&(document.attachEvent("onreadystatechange",function(){"complete"===document.readyState&&n()}),window.attachEvent("onload",n))}}(function(){if(!n.isClosed_){n.scriptTagHolder=new rt(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Object(o.e)(t,5),i=r[0],s=r[1],a=r[2];if(n.incrementIncomingBytes_(t),n.scriptTagHolder)if(n.connectTimeoutTimer_&&(clearTimeout(n.connectTimeoutTimer_),n.connectTimeoutTimer_=null),n.everConnected_=!0,i===tt)n.id=s,n.password=a;else{if(i!==et)throw new Error("Unrecognized command received: "+i);s?(n.scriptTagHolder.sendNewPolls=!1,n.myPacketOrderer.closeAfter(s,function(){n.onClosed_()})):n.onClosed_()}},function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var r=Object(o.e)(t,2),i=r[0],s=r[1];n.incrementIncomingBytes_(t),n.myPacketOrderer.handleResponse(i,s)},function(){n.onClosed_()},n.urlFn);var t={start:"t"};t.ser=Math.floor(1e8*Math.random()),n.scriptTagHolder.uniqueCallbackIdentifier&&(t.cb=n.scriptTagHolder.uniqueCallbackIdentifier),t.v="5",n.transportSessionId&&(t.s=n.transportSessionId),n.lastSessionId&&(t.ls=n.lastSessionId),n.applicationId&&(t.p=n.applicationId),n.appCheckToken&&(t.ac=n.appCheckToken),"undefined"!=typeof location&&location.hostname&&G.test(location.hostname)&&(t.r="f");var e=n.urlFn(t);n.log_("Connecting via long-poll to "+e),n.scriptTagHolder.addTag(e,function(){})}})},t.prototype.start=function(){this.scriptTagHolder.startLongPoll(this.id,this.password),this.addDisconnectPingFrame(this.id,this.password)},t.forceAllow=function(){t.forceAllow_=!0},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){return!(Object(i.y)()||!t.forceAllow_&&(t.forceDisallow_||"undefined"==typeof document||null==document.createElement||"object"==typeof window&&window.chrome&&window.chrome.extension&&!/^chrome/.test(window.location.href)||"object"==typeof Windows&&"object"==typeof Windows.UI))},t.prototype.markConnectionHealthy=function(){},t.prototype.shutdown_=function(){this.isClosed_=!0,this.scriptTagHolder&&(this.scriptTagHolder.close(),this.scriptTagHolder=null),this.myDisconnFrame&&(document.body.removeChild(this.myDisconnFrame),this.myDisconnFrame=null),this.connectTimeoutTimer_&&(clearTimeout(this.connectTimeoutTimer_),this.connectTimeoutTimer_=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("Longpoll is closing itself"),this.shutdown_(),this.onDisconnect_&&(this.onDisconnect_(this.everConnected_),this.onDisconnect_=null))},t.prototype.close=function(){this.isClosed_||(this.log_("Longpoll is being closed."),this.shutdown_())},t.prototype.send=function(t){var e=Object(i.J)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);for(var n=Object(i.h)(e),r=R(n,1840),o=0;o<r.length;o++)this.scriptTagHolder.enqueueSegment(this.curSegmentNum,r.length,r[o]),this.curSegmentNum++},t.prototype.addDisconnectPingFrame=function(t,e){if(!Object(i.y)()){this.myDisconnFrame=document.createElement("iframe");var n={dframe:"t"};n.id=t,n.pw=e,this.myDisconnFrame.src=this.urlFn(n),this.myDisconnFrame.style.display="none",document.body.appendChild(this.myDisconnFrame)}},t.prototype.incrementIncomingBytes_=function(t){var e=Object(i.J)(t).length;this.bytesReceived+=e,this.stats_.incrementCounter("bytes_received",e)},t}(),rt=function(){function t(e,n,r,o){if(this.onDisconnect=r,this.urlFn=o,this.outstandingRequests=new Set,this.pendingSegs=[],this.currentSerial=Math.floor(1e8*Math.random()),this.sendNewPolls=!0,Object(i.y)())this.commandCB=e,this.onMessageCB=n;else{this.uniqueCallbackIdentifier=g(),window["pLPCommand"+this.uniqueCallbackIdentifier]=e,window["pRTLPCB"+this.uniqueCallbackIdentifier]=n,this.myIFrame=t.createIFrame_();var s="";this.myIFrame.src&&"javascript:"===this.myIFrame.src.substr(0,"javascript:".length)&&(s='<script>document.domain="'+document.domain+'";<\/script>');var a="<html><body>"+s+"</body></html>";try{this.myIFrame.doc.open(),this.myIFrame.doc.write(a),this.myIFrame.doc.close()}catch(c){w("frame writing exception"),c.stack&&w(c.stack),w(c)}}}return t.createIFrame_=function(){var t=document.createElement("iframe");if(t.style.display="none",!document.body)throw"Document body has not initialized. Wait to initialize Firebase until after the document is ready.";document.body.appendChild(t);try{t.contentWindow.document||w("No IE domain setting required")}catch(n){var e=document.domain;t.src="javascript:void((function(){document.open();document.domain='"+e+"';document.close();})())"}return t.contentDocument?t.doc=t.contentDocument:t.contentWindow?t.doc=t.contentWindow.document:t.document&&(t.doc=t.document),t},t.prototype.close=function(){var t=this;this.alive=!1,this.myIFrame&&(this.myIFrame.doc.body.innerHTML="",setTimeout(function(){null!==t.myIFrame&&(document.body.removeChild(t.myIFrame),t.myIFrame=null)},Math.floor(0)));var e=this.onDisconnect;e&&(this.onDisconnect=null,e())},t.prototype.startLongPoll=function(t,e){for(this.myID=t,this.myPW=e,this.alive=!0;this.newRequest_(););},t.prototype.newRequest_=function(){if(this.alive&&this.sendNewPolls&&this.outstandingRequests.size<(this.pendingSegs.length>0?2:1)){this.currentSerial++;var t={};t.id=this.myID,t.pw=this.myPW,t.ser=this.currentSerial;for(var e=this.urlFn(t),n="",r=0;this.pendingSegs.length>0&&this.pendingSegs[0].d.length+30+n.length<=1870;){var i=this.pendingSegs.shift();n=n+"&seg"+r+"="+i.seg+"&ts"+r+"="+i.ts+"&d"+r+"="+i.d,r++}return this.addLongPollTag_(e+=n,this.currentSerial),!0}return!1},t.prototype.enqueueSegment=function(t,e,n){this.pendingSegs.push({seg:t,ts:e,d:n}),this.alive&&this.newRequest_()},t.prototype.addLongPollTag_=function(t,e){var n=this;this.outstandingRequests.add(e);var r=function(){n.outstandingRequests.delete(e),n.newRequest_()},i=setTimeout(r,Math.floor(25e3));this.addTag(t,function(){clearTimeout(i),r()})},t.prototype.addTag=function(t,e){var n=this;Object(i.y)()?this.doNodeLongPoll(t,e):setTimeout(function(){try{if(!n.sendNewPolls)return;var r=n.myIFrame.doc.createElement("script");r.type="text/javascript",r.async=!0,r.src=t,r.onload=r.onreadystatechange=function(){var t=r.readyState;t&&"loaded"!==t&&"complete"!==t||(r.onload=r.onreadystatechange=null,r.parentNode&&r.parentNode.removeChild(r),e())},r.onerror=function(){w("Long-poll script failed to load: "+t),n.sendNewPolls=!1,n.close()},n.myIFrame.doc.body.appendChild(r)}catch(i){}},Math.floor(1))},t}(),it=null;"undefined"!=typeof MozWebSocket?it=MozWebSocket:"undefined"!=typeof WebSocket&&(it=WebSocket);var ot=function(){function t(e,n,r,i,o,s,a){this.connId=e,this.applicationId=r,this.appCheckToken=i,this.authToken=o,this.keepaliveTimer=null,this.frames=null,this.totalFrames=0,this.bytesSent=0,this.bytesReceived=0,this.log_=T(this.connId),this.stats_=Q(n),this.connURL=t.connectionURL_(n,s,a,i),this.nodeAdmin=n.nodeAdmin}return t.connectionURL_=function(t,e,n,r){var o={v:"5"};return!Object(i.y)()&&"undefined"!=typeof location&&location.hostname&&G.test(location.hostname)&&(o.r="f"),e&&(o.s=e),n&&(o.ls=n),r&&(o.ac=r),Z(t,$,o)},t.prototype.open=function(t,e){var n=this;this.onDisconnect=e,this.onMessage=t,this.log_("Websocket connecting to "+this.connURL),this.everConnected_=!1,p.set("previous_websocket_failure",!0);try{if(Object(i.y)()){var r={headers:{"User-Agent":"Firebase/5/"+a+"/"+process.platform+"/"+(this.nodeAdmin?"AdminNode":"Node"),"X-Firebase-GMPID":this.applicationId||""}};this.authToken&&(r.headers.Authorization="Bearer "+this.authToken),this.appCheckToken&&(r.headers["X-Firebase-AppCheck"]=this.appCheckToken);var o=process.env,s=0===this.connURL.indexOf("wss://")?o.HTTPS_PROXY||o.https_proxy:o.HTTP_PROXY||o.http_proxy;s&&(r.proxy={origin:s}),this.mySock=new it(this.connURL,[],r)}else this.mySock=new it(this.connURL,[],r={headers:{"X-Firebase-GMPID":this.applicationId||"","X-Firebase-AppCheck":this.appCheckToken||""}})}catch(l){this.log_("Error instantiating WebSocket.");var c=l.message||l.data;return c&&this.log_(c),void this.onClosed_()}this.mySock.onopen=function(){n.log_("Websocket connected."),n.everConnected_=!0},this.mySock.onclose=function(){n.log_("Websocket connection was disconnected."),n.mySock=null,n.onClosed_()},this.mySock.onmessage=function(t){n.handleIncomingFrame(t)},this.mySock.onerror=function(t){n.log_("WebSocket error.  Closing connection.");var e=t.message||t.data;e&&n.log_(e),n.onClosed_()}},t.prototype.start=function(){},t.forceDisallow=function(){t.forceDisallow_=!0},t.isAvailable=function(){var e=!1;if("undefined"!=typeof navigator&&navigator.userAgent){var n=navigator.userAgent.match(/Android ([0-9]{0,}\.[0-9]{0,})/);n&&n.length>1&&parseFloat(n[1])<4.4&&(e=!0)}return!e&&null!==it&&!t.forceDisallow_},t.previouslyFailed=function(){return p.isInMemoryStorage||!0===p.get("previous_websocket_failure")},t.prototype.markConnectionHealthy=function(){p.remove("previous_websocket_failure")},t.prototype.appendFrame_=function(t){if(this.frames.push(t),this.frames.length===this.totalFrames){var e=this.frames.join("");this.frames=null;var n=Object(i.D)(e);this.onMessage(n)}},t.prototype.handleNewFrameCount_=function(t){this.totalFrames=t,this.frames=[]},t.prototype.extractFrameCount_=function(t){if(Object(i.e)(null===this.frames,"We already have a frame buffer"),t.length<=6){var e=Number(t);if(!isNaN(e))return this.handleNewFrameCount_(e),null}return this.handleNewFrameCount_(1),t},t.prototype.handleIncomingFrame=function(t){if(null!==this.mySock){var e=t.data;if(this.bytesReceived+=e.length,this.stats_.incrementCounter("bytes_received",e.length),this.resetKeepAlive(),null!==this.frames)this.appendFrame_(e);else{var n=this.extractFrameCount_(e);null!==n&&this.appendFrame_(n)}}},t.prototype.send=function(t){this.resetKeepAlive();var e=Object(i.J)(t);this.bytesSent+=e.length,this.stats_.incrementCounter("bytes_sent",e.length);var n=R(e,16384);n.length>1&&this.sendString_(String(n.length));for(var r=0;r<n.length;r++)this.sendString_(n[r])},t.prototype.shutdown_=function(){this.isClosed_=!0,this.keepaliveTimer&&(clearInterval(this.keepaliveTimer),this.keepaliveTimer=null),this.mySock&&(this.mySock.close(),this.mySock=null)},t.prototype.onClosed_=function(){this.isClosed_||(this.log_("WebSocket is closing itself"),this.shutdown_(),this.onDisconnect&&(this.onDisconnect(this.everConnected_),this.onDisconnect=null))},t.prototype.close=function(){this.isClosed_||(this.log_("WebSocket is being closed"),this.shutdown_())},t.prototype.resetKeepAlive=function(){var t=this;clearInterval(this.keepaliveTimer),this.keepaliveTimer=setInterval(function(){t.mySock&&t.sendString_("0"),t.resetKeepAlive()},Math.floor(45e3))},t.prototype.sendString_=function(t){try{this.mySock.send(t)}catch(e){this.log_("Exception thrown from WebSocket.send():",e.message||e.data,"Closing connection."),setTimeout(this.onClosed_.bind(this),0)}},t.responsesRequiredToBeHealthy=2,t.healthyTimeout=3e4,t}(),st=function(){function t(t){this.initTransports_(t)}return Object.defineProperty(t,"ALL_TRANSPORTS",{get:function(){return[nt,ot]},enumerable:!1,configurable:!0}),t.prototype.initTransports_=function(e){var n,r,i=ot&&ot.isAvailable(),s=i&&!ot.previouslyFailed();if(e.webSocketOnly&&(i||S("wss:// URL used, but browser isn't known to support websockets.  Trying anyway."),s=!0),s)this.transports_=[ot];else{var a=this.transports_=[];try{for(var c=Object(o.g)(t.ALL_TRANSPORTS),l=c.next();!l.done;l=c.next()){var u=l.value;u&&u.isAvailable()&&a.push(u)}}catch(h){n={error:h}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}},t.prototype.initialTransport=function(){if(this.transports_.length>0)return this.transports_[0];throw new Error("No transports available")},t.prototype.upgradeTransport=function(){return this.transports_.length>1?this.transports_[1]:null},t}(),at=function(){function t(t,e,n,r,i,o,s,a,c,l){this.id=t,this.repoInfo_=e,this.applicationId_=n,this.appCheckToken_=r,this.authToken_=i,this.onMessage_=o,this.onReady_=s,this.onDisconnect_=a,this.onKill_=c,this.lastSessionId=l,this.connectionCount=0,this.pendingDataMessages=[],this.state_=0,this.log_=T("c:"+this.id+":"),this.transportManager_=new st(e),this.log_("Connection created"),this.start_()}return t.prototype.start_=function(){var t=this,e=this.transportManager_.initialTransport();this.conn_=new e(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,null,this.lastSessionId),this.primaryResponsesRequired_=e.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.conn_),r=this.disconnReceiver_(this.conn_);this.tx_=this.conn_,this.rx_=this.conn_,this.secondaryConn_=null,this.isHealthy_=!1,setTimeout(function(){t.conn_&&t.conn_.open(n,r)},Math.floor(0));var i=e.healthyTimeout||0;i>0&&(this.healthyTimeout_=B(function(){t.healthyTimeout_=null,t.isHealthy_||(t.conn_&&t.conn_.bytesReceived>102400?(t.log_("Connection exceeded healthy timeout but has received "+t.conn_.bytesReceived+" bytes.  Marking connection healthy."),t.isHealthy_=!0,t.conn_.markConnectionHealthy()):t.conn_&&t.conn_.bytesSent>10240?t.log_("Connection exceeded healthy timeout but has sent "+t.conn_.bytesSent+" bytes.  Leaving connection alive."):(t.log_("Closing unhealthy connection after timeout."),t.close()))},Math.floor(i)))},t.prototype.nextTransportId_=function(){return"c:"+this.id+":"+this.connectionCount++},t.prototype.disconnReceiver_=function(t){var e=this;return function(n){t===e.conn_?e.onConnectionLost_(n):t===e.secondaryConn_?(e.log_("Secondary connection lost."),e.onSecondaryConnectionLost_()):e.log_("closing an old connection")}},t.prototype.connReceiver_=function(t){var e=this;return function(n){2!==e.state_&&(t===e.rx_?e.onPrimaryMessageReceived_(n):t===e.secondaryConn_?e.onSecondaryMessageReceived_(n):e.log_("message on old connection"))}},t.prototype.sendRequest=function(t){this.sendData_({t:"d",d:t})},t.prototype.tryCleanupConnection=function(){this.tx_===this.secondaryConn_&&this.rx_===this.secondaryConn_&&(this.log_("cleaning up and promoting a connection: "+this.secondaryConn_.connId),this.conn_=this.secondaryConn_,this.secondaryConn_=null)},t.prototype.onSecondaryControl_=function(t){if("t"in t){var e=t.t;"a"===e?this.upgradeIfSecondaryHealthy_():"r"===e?(this.log_("Got a reset on secondary, closing it"),this.secondaryConn_.close(),this.tx_!==this.secondaryConn_&&this.rx_!==this.secondaryConn_||this.close()):"o"===e&&(this.log_("got pong on secondary."),this.secondaryResponsesRequired_--,this.upgradeIfSecondaryHealthy_())}},t.prototype.onSecondaryMessageReceived_=function(t){var e=P("t",t),n=P("d",t);if("c"===e)this.onSecondaryControl_(n);else{if("d"!==e)throw new Error("Unknown protocol layer: "+e);this.pendingDataMessages.push(n)}},t.prototype.upgradeIfSecondaryHealthy_=function(){this.secondaryResponsesRequired_<=0?(this.log_("Secondary connection is healthy."),this.isHealthy_=!0,this.secondaryConn_.markConnectionHealthy(),this.proceedWithUpgrade_()):(this.log_("sending ping on secondary."),this.secondaryConn_.send({t:"c",d:{t:"p",d:{}}}))},t.prototype.proceedWithUpgrade_=function(){this.secondaryConn_.start(),this.log_("sending client ack on secondary"),this.secondaryConn_.send({t:"c",d:{t:"a",d:{}}}),this.log_("Ending transmission on primary"),this.conn_.send({t:"c",d:{t:"n",d:{}}}),this.tx_=this.secondaryConn_,this.tryCleanupConnection()},t.prototype.onPrimaryMessageReceived_=function(t){var e=P("t",t),n=P("d",t);"c"===e?this.onControl_(n):"d"===e&&this.onDataMessage_(n)},t.prototype.onDataMessage_=function(t){this.onPrimaryResponse_(),this.onMessage_(t)},t.prototype.onPrimaryResponse_=function(){this.isHealthy_||(this.primaryResponsesRequired_--,this.primaryResponsesRequired_<=0&&(this.log_("Primary connection is healthy."),this.isHealthy_=!0,this.conn_.markConnectionHealthy()))},t.prototype.onControl_=function(t){var e=P("t",t);if("d"in t){var n=t.d;if("h"===e)this.onHandshake_(n);else if("n"===e){this.log_("recvd end transmission on primary"),this.rx_=this.secondaryConn_;for(var r=0;r<this.pendingDataMessages.length;++r)this.onDataMessage_(this.pendingDataMessages[r]);this.pendingDataMessages=[],this.tryCleanupConnection()}else"s"===e?this.onConnectionShutdown_(n):"r"===e?this.onReset_(n):"e"===e?C("Server Error: "+n):"o"===e?(this.log_("got pong on primary."),this.onPrimaryResponse_(),this.sendPingOnPrimaryIfNecessary_()):C("Unknown control packet command: "+e)}},t.prototype.onHandshake_=function(t){var e=t.ts,n=t.v,r=t.h;this.sessionId=t.s,this.repoInfo_.host=r,0===this.state_&&(this.conn_.start(),this.onConnectionEstablished_(this.conn_,e),"5"!==n&&S("Protocol version mismatch detected"),this.tryStartUpgrade_())},t.prototype.tryStartUpgrade_=function(){var t=this.transportManager_.upgradeTransport();t&&this.startUpgrade_(t)},t.prototype.startUpgrade_=function(t){var e=this;this.secondaryConn_=new t(this.nextTransportId_(),this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,this.sessionId),this.secondaryResponsesRequired_=t.responsesRequiredToBeHealthy||0;var n=this.connReceiver_(this.secondaryConn_),r=this.disconnReceiver_(this.secondaryConn_);this.secondaryConn_.open(n,r),B(function(){e.secondaryConn_&&(e.log_("Timed out trying to upgrade."),e.secondaryConn_.close())},Math.floor(6e4))},t.prototype.onReset_=function(t){this.log_("Reset packet received.  New host: "+t),this.repoInfo_.host=t,1===this.state_?this.close():(this.closeConnections_(),this.start_())},t.prototype.onConnectionEstablished_=function(t,e){var n=this;this.log_("Realtime connection established."),this.conn_=t,this.state_=1,this.onReady_&&(this.onReady_(e,this.sessionId),this.onReady_=null),0===this.primaryResponsesRequired_?(this.log_("Primary connection is healthy."),this.isHealthy_=!0):B(function(){n.sendPingOnPrimaryIfNecessary_()},Math.floor(5e3))},t.prototype.sendPingOnPrimaryIfNecessary_=function(){this.isHealthy_||1!==this.state_||(this.log_("sending ping on primary."),this.sendData_({t:"c",d:{t:"p",d:{}}}))},t.prototype.onSecondaryConnectionLost_=function(){var t=this.secondaryConn_;this.secondaryConn_=null,this.tx_!==t&&this.rx_!==t||this.close()},t.prototype.onConnectionLost_=function(t){this.conn_=null,t||0!==this.state_?1===this.state_&&this.log_("Realtime connection lost."):(this.log_("Realtime connection failed."),this.repoInfo_.isCacheableHost()&&(p.remove("host:"+this.repoInfo_.host),this.repoInfo_.internalHost=this.repoInfo_.host)),this.close()},t.prototype.onConnectionShutdown_=function(t){this.log_("Connection shutdown command received. Shutting down..."),this.onKill_&&(this.onKill_(t),this.onKill_=null),this.onDisconnect_=null,this.close()},t.prototype.sendData_=function(t){if(1!==this.state_)throw"Connection is not connected";this.tx_.send(t)},t.prototype.close=function(){2!==this.state_&&(this.log_("Closing realtime connection."),this.state_=2,this.closeConnections_(),this.onDisconnect_&&(this.onDisconnect_(),this.onDisconnect_=null))},t.prototype.closeConnections_=function(){this.log_("Shutting down all connections"),this.conn_&&(this.conn_.close(),this.conn_=null),this.secondaryConn_&&(this.secondaryConn_.close(),this.secondaryConn_=null),this.healthyTimeout_&&(clearTimeout(this.healthyTimeout_),this.healthyTimeout_=null)},t}(),ct=function(){function t(){}return t.prototype.put=function(t,e,n,r){},t.prototype.merge=function(t,e,n,r){},t.prototype.refreshAuthToken=function(t){},t.prototype.refreshAppCheckToken=function(t){},t.prototype.onDisconnectPut=function(t,e,n){},t.prototype.onDisconnectMerge=function(t,e,n){},t.prototype.onDisconnectCancel=function(t,e){},t.prototype.reportStats=function(t){},t}(),lt=function(){function t(t){this.allowedEvents_=t,this.listeners_={},Object(i.e)(Array.isArray(t)&&t.length>0,"Requires a non-empty array")}return t.prototype.trigger=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Array.isArray(this.listeners_[t]))for(var r=Object(o.f)([],Object(o.e)(this.listeners_[t])),i=0;i<r.length;i++)r[i].callback.apply(r[i].context,e)},t.prototype.on=function(t,e,n){this.validateEventType_(t),this.listeners_[t]=this.listeners_[t]||[],this.listeners_[t].push({callback:e,context:n});var r=this.getInitialEvent(t);r&&e.apply(n,r)},t.prototype.off=function(t,e,n){this.validateEventType_(t);for(var r=this.listeners_[t]||[],i=0;i<r.length;i++)if(r[i].callback===e&&(!n||n===r[i].context))return void r.splice(i,1)},t.prototype.validateEventType_=function(t){Object(i.e)(this.allowedEvents_.find(function(e){return e===t}),"Unknown event: "+t)},t}(),ut=function(t){function e(){var e=t.call(this,["online"])||this;return e.online_=!0,"undefined"==typeof window||void 0===window.addEventListener||Object(i.w)()||(window.addEventListener("online",function(){e.online_||(e.online_=!0,e.trigger("online",!0))},!1),window.addEventListener("offline",function(){e.online_&&(e.online_=!1,e.trigger("online",!1))},!1)),e}return Object(o.c)(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return Object(i.e)("online"===t,"Unknown event type: "+t),[this.online_]},e.prototype.currentlyOnline=function(){return this.online_},e}(lt),ht=function(){function t(t,e){if(void 0===e){this.pieces_=t.split("/");for(var n=0,r=0;r<this.pieces_.length;r++)this.pieces_[r].length>0&&(this.pieces_[n]=this.pieces_[r],n++);this.pieces_.length=n,this.pieceNum_=0}else this.pieces_=t,this.pieceNum_=e}return t.prototype.toString=function(){for(var t="",e=this.pieceNum_;e<this.pieces_.length;e++)""!==this.pieces_[e]&&(t+="/"+this.pieces_[e]);return t||"/"},t}();function dt(){return new ht("")}function pt(t){return t.pieceNum_>=t.pieces_.length?null:t.pieces_[t.pieceNum_]}function ft(t){return t.pieces_.length-t.pieceNum_}function mt(t){var e=t.pieceNum_;return e<t.pieces_.length&&e++,new ht(t.pieces_,e)}function gt(t){return t.pieceNum_<t.pieces_.length?t.pieces_[t.pieces_.length-1]:null}function _t(t,e){return void 0===e&&(e=0),t.pieces_.slice(t.pieceNum_+e)}function yt(t){if(t.pieceNum_>=t.pieces_.length)return null;for(var e=[],n=t.pieceNum_;n<t.pieces_.length-1;n++)e.push(t.pieces_[n]);return new ht(e,0)}function vt(t,e){for(var n=[],r=t.pieceNum_;r<t.pieces_.length;r++)n.push(t.pieces_[r]);if(e instanceof ht)for(r=e.pieceNum_;r<e.pieces_.length;r++)n.push(e.pieces_[r]);else{var i=e.split("/");for(r=0;r<i.length;r++)i[r].length>0&&n.push(i[r])}return new ht(n,0)}function bt(t){return t.pieceNum_>=t.pieces_.length}function xt(t,e){var n=pt(t),r=pt(e);if(null===n)return e;if(n===r)return xt(mt(t),mt(e));throw new Error("INTERNAL ERROR: innerPath ("+e+") is not within outerPath ("+t+")")}function wt(t,e){for(var n=_t(t,0),r=_t(e,0),i=0;i<n.length&&i<r.length;i++){var o=M(n[i],r[i]);if(0!==o)return o}return n.length===r.length?0:n.length<r.length?-1:1}function Tt(t,e){if(ft(t)!==ft(e))return!1;for(var n=t.pieceNum_,r=e.pieceNum_;n<=t.pieces_.length;n++,r++)if(t.pieces_[n]!==e.pieces_[r])return!1;return!0}function Ct(t,e){var n=t.pieceNum_,r=e.pieceNum_;if(ft(t)>ft(e))return!1;for(;n<t.pieces_.length;){if(t.pieces_[n]!==e.pieces_[r])return!1;++n,++r}return!0}var Et=function(){return function(t,e){this.errorPrefix_=e,this.parts_=_t(t,0),this.byteLength_=Math.max(1,this.parts_.length);for(var n=0;n<this.parts_.length;n++)this.byteLength_+=Object(i.H)(this.parts_[n]);St(this)}}();function St(t){if(t.byteLength_>768)throw new Error(t.errorPrefix_+"has a key path longer than 768 bytes ("+t.byteLength_+").");if(t.parts_.length>32)throw new Error(t.errorPrefix_+"path specified exceeds the maximum depth that can be written (32) or object contains a cycle "+It(t))}function It(t){return 0===t.parts_.length?"":"in property '"+t.parts_.join(".")+"'"}var kt,At,Mt=function(t){function e(){var e,n,r=t.call(this,["visible"])||this;return"undefined"!=typeof document&&void 0!==document.addEventListener&&(void 0!==document.hidden?(n="visibilitychange",e="hidden"):void 0!==document.mozHidden?(n="mozvisibilitychange",e="mozHidden"):void 0!==document.msHidden?(n="msvisibilitychange",e="msHidden"):void 0!==document.webkitHidden&&(n="webkitvisibilitychange",e="webkitHidden")),r.visible_=!0,n&&document.addEventListener(n,function(){var t=!document[e];t!==r.visible_&&(r.visible_=t,r.trigger("visible",t))},!1),r}return Object(o.c)(e,t),e.getInstance=function(){return new e},e.prototype.getInitialEvent=function(t){return Object(i.e)("visible"===t,"Unknown event type: "+t),[this.visible_]},e}(lt),Ot=1e3,Pt=function(t){function e(n,r,o,s,a,c,l,u){var h=t.call(this)||this;if(h.repoInfo_=n,h.applicationId_=r,h.onDataUpdate_=o,h.onConnectStatus_=s,h.onServerInfoUpdate_=a,h.authTokenProvider_=c,h.appCheckTokenProvider_=l,h.authOverride_=u,h.id=e.nextPersistentConnectionId_++,h.log_=T("p:"+h.id+":"),h.interruptReasons_={},h.listens=new Map,h.outstandingPuts_=[],h.outstandingGets_=[],h.outstandingPutCount_=0,h.outstandingGetCount_=0,h.onDisconnectRequestQueue_=[],h.connected_=!1,h.reconnectDelay_=Ot,h.maxReconnectDelay_=3e5,h.securityDebugCallback_=null,h.lastSessionId=null,h.establishConnectionTimer_=null,h.visible_=!1,h.requestCBHash_={},h.requestNumber_=0,h.realtime_=null,h.authToken_=null,h.appCheckToken_=null,h.forceTokenRefresh_=!1,h.invalidAuthTokenCount_=0,h.invalidAppCheckTokenCount_=0,h.firstConnection_=!0,h.lastConnectionAttemptTime_=null,h.lastConnectionEstablishedTime_=null,u&&!Object(i.y)())throw new Error("Auth override specified in options, but not supported on non Node.js platforms");return Mt.getInstance().on("visible",h.onVisible_,h),-1===n.host.indexOf("fblocal")&&ut.getInstance().on("online",h.onOnline_,h),h}return Object(o.c)(e,t),e.prototype.sendRequest=function(t,e,n){var r=++this.requestNumber_,o={r:r,a:t,b:e};this.log_(Object(i.J)(o)),Object(i.e)(this.connected_,"sendRequest call when we're not connected not allowed."),this.realtime_.sendRequest(o),n&&(this.requestCBHash_[r]=n)},e.prototype.get=function(t){var e=this;this.initConnection_();var n=new i.a,r={p:t._path.toString(),q:t._queryObject},o={action:"g",request:r,onComplete:function(t){var i=t.d;"ok"===t.s?(e.onDataUpdate_(r.p,i,!1,null),n.resolve(i)):n.reject(i)}};this.outstandingGets_.push(o),this.outstandingGetCount_++;var s=this.outstandingGets_.length-1;return this.connected_||setTimeout(function(){var t=e.outstandingGets_[s];void 0!==t&&o===t&&(delete e.outstandingGets_[s],e.outstandingGetCount_--,0===e.outstandingGetCount_&&(e.outstandingGets_=[]),e.log_("get "+s+" timed out on connection"),n.reject(new Error("Client is offline.")))},3e3),this.connected_&&this.sendGet_(s),n.promise},e.prototype.listen=function(t,e,n,r){this.initConnection_();var o=t._queryIdentifier,s=t._path.toString();this.log_("Listen called for "+s+" "+o),this.listens.has(s)||this.listens.set(s,new Map),Object(i.e)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"listen() called for non-default but complete query"),Object(i.e)(!this.listens.get(s).has(o),"listen() called twice for same path/queryId.");var a={onComplete:r,hashFn:e,query:t,tag:n};this.listens.get(s).set(o,a),this.connected_&&this.sendListen_(a)},e.prototype.sendGet_=function(t){var e=this,n=this.outstandingGets_[t];this.sendRequest("g",n.request,function(r){delete e.outstandingGets_[t],e.outstandingGetCount_--,0===e.outstandingGetCount_&&(e.outstandingGets_=[]),n.onComplete&&n.onComplete(r)})},e.prototype.sendListen_=function(t){var n=this,r=t.query,i=r._path.toString(),o=r._queryIdentifier;this.log_("Listen on "+i+" for "+o);var s={p:i};t.tag&&(s.q=r._queryObject,s.t=t.tag),s.h=t.hashFn(),this.sendRequest("q",s,function(s){var a=s.d,c=s.s;e.warnOnListenWarnings_(a,r),(n.listens.get(i)&&n.listens.get(i).get(o))===t&&(n.log_("listen response",s),"ok"!==c&&n.removeListen_(i,o),t.onComplete&&t.onComplete(c,a))})},e.warnOnListenWarnings_=function(t,e){if(t&&"object"==typeof t&&Object(i.i)(t,"w")){var n=Object(i.G)(t,"w");if(Array.isArray(n)&&~n.indexOf("no_index")){var r='".indexOn": "'+e._queryParams.getIndex().toString()+'"',o=e._path.toString();S("Using an unspecified index. Your data will be downloaded and filtered on the client. Consider adding "+r+" at "+o+" to your security rules for better performance.")}}},e.prototype.refreshAuthToken=function(t){this.authToken_=t,this.log_("Auth token refreshed"),this.authToken_?this.tryAuth():this.connected_&&this.sendRequest("unauth",{},function(){}),this.reduceReconnectDelayIfAdminCredential_(t)},e.prototype.reduceReconnectDelayIfAdminCredential_=function(t){(t&&40===t.length||Object(i.q)(t))&&(this.log_("Admin auth credential detected.  Reducing max reconnect time."),this.maxReconnectDelay_=3e4)},e.prototype.refreshAppCheckToken=function(t){this.appCheckToken_=t,this.log_("App check token refreshed"),this.appCheckToken_?this.tryAppCheck():this.connected_&&this.sendRequest("unappeck",{},function(){})},e.prototype.tryAuth=function(){var t=this;if(this.connected_&&this.authToken_){var e=this.authToken_,n=Object(i.C)(e)?"auth":"gauth",r={cred:e};null===this.authOverride_?r.noauth=!0:"object"==typeof this.authOverride_&&(r.authvar=this.authOverride_),this.sendRequest(n,r,function(n){var r=n.s,i=n.d||"error";t.authToken_===e&&("ok"===r?t.invalidAuthTokenCount_=0:t.onAuthRevoked_(r,i))})}},e.prototype.tryAppCheck=function(){var t=this;this.connected_&&this.appCheckToken_&&this.sendRequest("appcheck",{token:this.appCheckToken_},function(e){var n=e.s,r=e.d||"error";"ok"===n?t.invalidAppCheckTokenCount_=0:t.onAppCheckRevoked_(n,r)})},e.prototype.unlisten=function(t,e){var n=t._path.toString(),r=t._queryIdentifier;this.log_("Unlisten called for "+n+" "+r),Object(i.e)(t._queryParams.isDefault()||!t._queryParams.loadsAllData(),"unlisten() called for non-default but complete query"),this.removeListen_(n,r)&&this.connected_&&this.sendUnlisten_(n,r,t._queryObject,e)},e.prototype.sendUnlisten_=function(t,e,n,r){this.log_("Unlisten on "+t+" for "+e);var i={p:t};r&&(i.q=n,i.t=r),this.sendRequest("n",i)},e.prototype.onDisconnectPut=function(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("o",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"o",data:e,onComplete:n})},e.prototype.onDisconnectMerge=function(t,e,n){this.initConnection_(),this.connected_?this.sendOnDisconnect_("om",t,e,n):this.onDisconnectRequestQueue_.push({pathString:t,action:"om",data:e,onComplete:n})},e.prototype.onDisconnectCancel=function(t,e){this.initConnection_(),this.connected_?this.sendOnDisconnect_("oc",t,null,e):this.onDisconnectRequestQueue_.push({pathString:t,action:"oc",data:null,onComplete:e})},e.prototype.sendOnDisconnect_=function(t,e,n,r){var i={p:e,d:n};this.log_("onDisconnect "+t,i),this.sendRequest(t,i,function(t){r&&setTimeout(function(){r(t.s,t.d)},Math.floor(0))})},e.prototype.put=function(t,e,n,r){this.putInternal("p",t,e,n,r)},e.prototype.merge=function(t,e,n,r){this.putInternal("m",t,e,n,r)},e.prototype.putInternal=function(t,e,n,r,i){this.initConnection_();var o={p:e,d:n};void 0!==i&&(o.h=i),this.outstandingPuts_.push({action:t,request:o,onComplete:r}),this.outstandingPutCount_++,this.connected_?this.sendPut_(this.outstandingPuts_.length-1):this.log_("Buffering put: "+e)},e.prototype.sendPut_=function(t){var e=this,n=this.outstandingPuts_[t].action,r=this.outstandingPuts_[t].request,i=this.outstandingPuts_[t].onComplete;this.outstandingPuts_[t].queued=this.connected_,this.sendRequest(n,r,function(r){e.log_(n+" response",r),delete e.outstandingPuts_[t],e.outstandingPutCount_--,0===e.outstandingPutCount_&&(e.outstandingPuts_=[]),i&&i(r.s,r.d)})},e.prototype.reportStats=function(t){var e=this;if(this.connected_){var n={c:t};this.log_("reportStats",n),this.sendRequest("s",n,function(t){"ok"!==t.s&&e.log_("reportStats","Error sending stats: "+t.d)})}},e.prototype.onDataMessage_=function(t){if("r"in t){this.log_("from server: "+Object(i.J)(t));var e=t.r,n=this.requestCBHash_[e];n&&(delete this.requestCBHash_[e],n(t.b))}else{if("error"in t)throw"A server-side error has occurred: "+t.error;"a"in t&&this.onDataPush_(t.a,t.b)}},e.prototype.onDataPush_=function(t,e){this.log_("handleServerMessage",t,e),"d"===t?this.onDataUpdate_(e.p,e.d,!1,e.t):"m"===t?this.onDataUpdate_(e.p,e.d,!0,e.t):"c"===t?this.onListenRevoked_(e.p,e.q):"ac"===t?this.onAuthRevoked_(e.s,e.d):"apc"===t?this.onAppCheckRevoked_(e.s,e.d):"sd"===t?this.onSecurityDebugPacket_(e):C("Unrecognized action received from server: "+Object(i.J)(t)+"\nAre you using the latest client?")},e.prototype.onReady_=function(t,e){this.log_("connection ready"),this.connected_=!0,this.lastConnectionEstablishedTime_=(new Date).getTime(),this.handleTimestamp_(t),this.lastSessionId=e,this.firstConnection_&&this.sendConnectStats_(),this.restoreState_(),this.firstConnection_=!1,this.onConnectStatus_(!0)},e.prototype.scheduleConnect_=function(t){var e=this;Object(i.e)(!this.realtime_,"Scheduling a connect when we're already connected/ing?"),this.establishConnectionTimer_&&clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=setTimeout(function(){e.establishConnectionTimer_=null,e.establishConnection_()},Math.floor(t))},e.prototype.initConnection_=function(){!this.realtime_&&this.firstConnection_&&this.scheduleConnect_(0)},e.prototype.onVisible_=function(t){t&&!this.visible_&&this.reconnectDelay_===this.maxReconnectDelay_&&(this.log_("Window became visible.  Reducing delay."),this.reconnectDelay_=Ot,this.realtime_||this.scheduleConnect_(0)),this.visible_=t},e.prototype.onOnline_=function(t){t?(this.log_("Browser went online."),this.reconnectDelay_=Ot,this.realtime_||this.scheduleConnect_(0)):(this.log_("Browser went offline.  Killing connection."),this.realtime_&&this.realtime_.close())},e.prototype.onRealtimeDisconnect_=function(){if(this.log_("data client disconnected"),this.connected_=!1,this.realtime_=null,this.cancelSentTransactions_(),this.requestCBHash_={},this.shouldReconnect_()){this.visible_?this.lastConnectionEstablishedTime_&&((new Date).getTime()-this.lastConnectionEstablishedTime_>3e4&&(this.reconnectDelay_=Ot),this.lastConnectionEstablishedTime_=null):(this.log_("Window isn't visible.  Delaying reconnect."),this.reconnectDelay_=this.maxReconnectDelay_,this.lastConnectionAttemptTime_=(new Date).getTime());var t=(new Date).getTime()-this.lastConnectionAttemptTime_,e=Math.max(0,this.reconnectDelay_-t);e=Math.random()*e,this.log_("Trying to reconnect in "+e+"ms"),this.scheduleConnect_(e),this.reconnectDelay_=Math.min(this.maxReconnectDelay_,1.3*this.reconnectDelay_)}this.onConnectStatus_(!1)},e.prototype.establishConnection_=function(){return Object(o.b)(this,void 0,void 0,function(){var t,n,r,s,a,c,l,u,h,d,p,f,m,g=this;return Object(o.d)(this,function(_){switch(_.label){case 0:if(!this.shouldReconnect_())return[3,4];this.log_("Making a connection attempt"),this.lastConnectionAttemptTime_=(new Date).getTime(),this.lastConnectionEstablishedTime_=null,t=this.onDataMessage_.bind(this),n=this.onReady_.bind(this),r=this.onRealtimeDisconnect_.bind(this),s=this.id+":"+e.nextConnectionId_++,a=this.lastSessionId,c=!1,l=null,this.realtime_={close:u=function(){l?l.close():(c=!0,r())},sendRequest:function(t){Object(i.e)(l,"sendRequest call when we're not connected not allowed."),l.sendRequest(t)}},h=this.forceTokenRefresh_,this.forceTokenRefresh_=!1,_.label=1;case 1:return _.trys.push([1,3,,4]),[4,Promise.all([this.authTokenProvider_.getToken(h),this.appCheckTokenProvider_.getToken(h)])];case 2:return d=o.e.apply(void 0,[_.sent(),2]),p=d[0],f=d[1],c?w("getToken() completed but was canceled"):(w("getToken() completed. Creating connection."),this.authToken_=p&&p.accessToken,this.appCheckToken_=f&&f.token,l=new at(s,this.repoInfo_,this.applicationId_,this.appCheckToken_,this.authToken_,t,n,r,function(t){S(t+" ("+g.repoInfo_.toString()+")"),g.interrupt("server_kill")},a)),[3,4];case 3:return m=_.sent(),this.log_("Failed to get token: "+m),c||(this.repoInfo_.nodeAdmin&&S(m),u()),[3,4];case 4:return[2]}})})},e.prototype.interrupt=function(t){w("Interrupting connection for reason: "+t),this.interruptReasons_[t]=!0,this.realtime_?this.realtime_.close():(this.establishConnectionTimer_&&(clearTimeout(this.establishConnectionTimer_),this.establishConnectionTimer_=null),this.connected_&&this.onRealtimeDisconnect_())},e.prototype.resume=function(t){w("Resuming connection for reason: "+t),delete this.interruptReasons_[t],Object(i.u)(this.interruptReasons_)&&(this.reconnectDelay_=Ot,this.realtime_||this.scheduleConnect_(0))},e.prototype.handleTimestamp_=function(t){var e=t-(new Date).getTime();this.onServerInfoUpdate_({serverTimeOffset:e})},e.prototype.cancelSentTransactions_=function(){for(var t=0;t<this.outstandingPuts_.length;t++){var e=this.outstandingPuts_[t];e&&"h"in e.request&&e.queued&&(e.onComplete&&e.onComplete("disconnect"),delete this.outstandingPuts_[t],this.outstandingPutCount_--)}0===this.outstandingPutCount_&&(this.outstandingPuts_=[])},e.prototype.onListenRevoked_=function(t,e){var n;n=e?e.map(function(t){return D(t)}).join("$"):"default";var r=this.removeListen_(t,n);r&&r.onComplete&&r.onComplete("permission_denied")},e.prototype.removeListen_=function(t,e){var n,r=new ht(t).toString();if(this.listens.has(r)){var i=this.listens.get(r);n=i.get(e),i.delete(e),0===i.size&&this.listens.delete(r)}else n=void 0;return n},e.prototype.onAuthRevoked_=function(t,e){w("Auth token revoked: "+t+"/"+e),this.authToken_=null,this.forceTokenRefresh_=!0,this.realtime_.close(),"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAuthTokenCount_++,this.invalidAuthTokenCount_>=3&&(this.reconnectDelay_=3e4,this.authTokenProvider_.notifyForInvalidToken()))},e.prototype.onAppCheckRevoked_=function(t,e){w("App check token revoked: "+t+"/"+e),this.appCheckToken_=null,this.forceTokenRefresh_=!0,"invalid_token"!==t&&"permission_denied"!==t||(this.invalidAppCheckTokenCount_++,this.invalidAppCheckTokenCount_>=3&&this.appCheckTokenProvider_.notifyForInvalidToken())},e.prototype.onSecurityDebugPacket_=function(t){this.securityDebugCallback_?this.securityDebugCallback_(t):"msg"in t&&console.log("FIREBASE: "+t.msg.replace("\n","\nFIREBASE: "))},e.prototype.restoreState_=function(){var t,e,n,r;this.tryAuth(),this.tryAppCheck();try{for(var i=Object(o.g)(this.listens.values()),s=i.next();!s.done;s=i.next()){var a=s.value;try{for(var c=(n=void 0,Object(o.g)(a.values())),l=c.next();!l.done;l=c.next())this.sendListen_(l.value)}catch(d){n={error:d}}finally{try{l&&!l.done&&(r=c.return)&&r.call(c)}finally{if(n)throw n.error}}}}catch(p){t={error:p}}finally{try{s&&!s.done&&(e=i.return)&&e.call(i)}finally{if(t)throw t.error}}for(var u=0;u<this.outstandingPuts_.length;u++)this.outstandingPuts_[u]&&this.sendPut_(u);for(;this.onDisconnectRequestQueue_.length;){var h=this.onDisconnectRequestQueue_.shift();this.sendOnDisconnect_(h.action,h.pathString,h.data,h.onComplete)}for(u=0;u<this.outstandingGets_.length;u++)this.outstandingGets_[u]&&this.sendGet_(u)},e.prototype.sendConnectStats_=function(){var t={},e="js";Object(i.y)()&&(e=this.repoInfo_.nodeAdmin?"admin_node":"node"),t["sdk."+e+"."+a.replace(/\./g,"-")]=1,Object(i.w)()?t["framework.cordova"]=1:Object(i.z)()&&(t["framework.reactnative"]=1),this.reportStats(t)},e.prototype.shouldReconnect_=function(){var t=ut.getInstance().currentlyOnline();return Object(i.u)(this.interruptReasons_)&&t},e.nextPersistentConnectionId_=0,e.nextConnectionId_=0,e}(ct),Dt=function(){function t(t,e){this.name=t,this.node=e}return t.Wrap=function(e,n){return new t(e,n)},t}(),Rt=function(){function t(){}return t.prototype.getCompare=function(){return this.compare.bind(this)},t.prototype.indexedValueChanged=function(t,e){var n=new Dt(k,t),r=new Dt(k,e);return 0!==this.compare(n,r)},t.prototype.minPost=function(){return Dt.MIN},t}(),Nt=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),Object.defineProperty(e,"__EMPTY_NODE",{get:function(){return kt},set:function(t){kt=t},enumerable:!1,configurable:!0}),e.prototype.compare=function(t,e){return M(t.name,e.name)},e.prototype.isDefinedOn=function(t){throw Object(i.f)("KeyIndex.isDefinedOn not expected to be called.")},e.prototype.indexedValueChanged=function(t,e){return!1},e.prototype.minPost=function(){return Dt.MIN},e.prototype.maxPost=function(){return new Dt(A,kt)},e.prototype.makePost=function(t,e){return Object(i.e)("string"==typeof t,"KeyIndex indexValue must always be a string."),new Dt(t,kt)},e.prototype.toString=function(){return".key"},e}(Rt),Lt=new Nt,jt=function(){function t(t,e,n,r,i){void 0===i&&(i=null),this.isReverse_=r,this.resultGenerator_=i,this.nodeStack_=[];for(var o=1;!t.isEmpty();)if(t=t,o=e?n(t.key,e):1,r&&(o*=-1),o<0)t=this.isReverse_?t.left:t.right;else{if(0===o){this.nodeStack_.push(t);break}this.nodeStack_.push(t),t=this.isReverse_?t.right:t.left}}return t.prototype.getNext=function(){if(0===this.nodeStack_.length)return null;var t,e=this.nodeStack_.pop();if(t=this.resultGenerator_?this.resultGenerator_(e.key,e.value):{key:e.key,value:e.value},this.isReverse_)for(e=e.left;!e.isEmpty();)this.nodeStack_.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack_.push(e),e=e.left;return t},t.prototype.hasNext=function(){return this.nodeStack_.length>0},t.prototype.peek=function(){if(0===this.nodeStack_.length)return null;var t=this.nodeStack_[this.nodeStack_.length-1];return this.resultGenerator_?this.resultGenerator_(t.key,t.value):{key:t.key,value:t.value}},t}(),zt=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:Bt.EMPTY_NODE,this.right=null!=o?o:Bt.EMPTY_NODE}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.count=function(){return this.left.count()+1+this.right.count()},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||!!t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min_=function(){return this.left.isEmpty()?this:this.left.min_()},t.prototype.minKey=function(){return this.min_().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp_()},t.prototype.removeMin_=function(){if(this.left.isEmpty())return Bt.EMPTY_NODE;var t=this;return t.left.isRed_()||t.left.left.isRed_()||(t=t.moveRedLeft_()),(t=t.copy(null,null,null,t.left.removeMin_(),null)).fixUp_()},t.prototype.remove=function(t,e){var n,r;if(e(t,(n=this).key)<0)n.left.isEmpty()||n.left.isRed_()||n.left.left.isRed_()||(n=n.moveRedLeft_()),n=n.copy(null,null,null,n.left.remove(t,e),null);else{if(n.left.isRed_()&&(n=n.rotateRight_()),n.right.isEmpty()||n.right.isRed_()||n.right.left.isRed_()||(n=n.moveRedRight_()),0===e(t,n.key)){if(n.right.isEmpty())return Bt.EMPTY_NODE;r=n.right.min_(),n=n.copy(r.key,r.value,null,null,n.right.removeMin_())}n=n.copy(null,null,null,null,n.right.remove(t,e))}return n.fixUp_()},t.prototype.isRed_=function(){return this.color},t.prototype.fixUp_=function(){var t=this;return t.right.isRed_()&&!t.left.isRed_()&&(t=t.rotateLeft_()),t.left.isRed_()&&t.left.left.isRed_()&&(t=t.rotateRight_()),t.left.isRed_()&&t.right.isRed_()&&(t=t.colorFlip_()),t},t.prototype.moveRedLeft_=function(){var t=this.colorFlip_();return t.right.left.isRed_()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight_())).rotateLeft_()).colorFlip_()),t},t.prototype.moveRedRight_=function(){var t=this.colorFlip_();return t.left.left.isRed_()&&(t=(t=t.rotateRight_()).colorFlip_()),t},t.prototype.rotateLeft_=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight_=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip_=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth_=function(){var t=this.check_();return Math.pow(2,t)<=this.count()+1},t.prototype.check_=function(){if(this.isRed_()&&this.left.isRed_())throw new Error("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed_())throw new Error("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check_();if(t!==this.right.check_())throw new Error("Black depths differ");return t+(this.isRed_()?0:1)},t.RED=!0,t.BLACK=!1,t}(),Ft=function(){function t(){}return t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new zt(t,e,null)},t.prototype.remove=function(t,e){return this},t.prototype.count=function(){return 0},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.check_=function(){return 0},t.prototype.isRed_=function(){return!1},t}(),Bt=function(){function t(e,n){void 0===n&&(n=t.EMPTY_NODE),this.comparator_=e,this.root_=n}return t.prototype.insert=function(e,n){return new t(this.comparator_,this.root_.insert(e,n,this.comparator_).copy(null,null,zt.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator_,this.root_.remove(e,this.comparator_).copy(null,null,zt.BLACK,null,null))},t.prototype.get=function(t){for(var e,n=this.root_;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key)))return n.value;e<0?n=n.left:e>0&&(n=n.right)}return null},t.prototype.getPredecessorKey=function(t){for(var e,n=this.root_,r=null;!n.isEmpty();){if(0===(e=this.comparator_(t,n.key))){if(n.left.isEmpty())return r?r.key:null;for(n=n.left;!n.right.isEmpty();)n=n.right;return n.key}e<0?n=n.left:e>0&&(r=n,n=n.right)}throw new Error("Attempted to find predecessor key for a nonexistent key.  What gives?")},t.prototype.isEmpty=function(){return this.root_.isEmpty()},t.prototype.count=function(){return this.root_.count()},t.prototype.minKey=function(){return this.root_.minKey()},t.prototype.maxKey=function(){return this.root_.maxKey()},t.prototype.inorderTraversal=function(t){return this.root_.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.root_.reverseTraversal(t)},t.prototype.getIterator=function(t){return new jt(this.root_,null,this.comparator_,!1,t)},t.prototype.getIteratorFrom=function(t,e){return new jt(this.root_,t,this.comparator_,!1,e)},t.prototype.getReverseIteratorFrom=function(t,e){return new jt(this.root_,t,this.comparator_,!0,e)},t.prototype.getReverseIterator=function(t){return new jt(this.root_,null,this.comparator_,!0,t)},t.EMPTY_NODE=new Ft,t}();function Ut(t,e){return M(t.name,e.name)}function Vt(t,e){return M(t,e)}var qt,Gt,$t,Wt,Ht,Zt=function(t){return"number"==typeof t?"number:"+L(t):"string:"+t},Kt=function(t){if(t.isLeafNode()){var e=t.val();Object(i.e)("string"==typeof e||"number"==typeof e||"object"==typeof e&&Object(i.i)(e,".sv"),"Priority must be a string or number.")}else Object(i.e)(t===At||t.isEmpty(),"priority of unexpected type.");Object(i.e)(t===At||t.getPriority().isEmpty(),"Priority nodes can't have a priority of their own.")},Xt=function(){function t(e,n){void 0===n&&(n=t.__childrenNodeConstructor.EMPTY_NODE),this.value_=e,this.priorityNode_=n,this.lazyHash_=null,Object(i.e)(null!=this.value_,"LeafNode shouldn't be created with null/undefined value."),Kt(this.priorityNode_)}return Object.defineProperty(t,"__childrenNodeConstructor",{get:function(){return qt},set:function(t){qt=t},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!0},t.prototype.getPriority=function(){return this.priorityNode_},t.prototype.updatePriority=function(e){return new t(this.value_,e)},t.prototype.getImmediateChild=function(e){return".priority"===e?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.getChild=function(e){return bt(e)?this:".priority"===pt(e)?this.priorityNode_:t.__childrenNodeConstructor.EMPTY_NODE},t.prototype.hasChild=function(){return!1},t.prototype.getPredecessorChildName=function(t,e){return null},t.prototype.updateImmediateChild=function(e,n){return".priority"===e?this.updatePriority(n):n.isEmpty()&&".priority"!==e?this:t.__childrenNodeConstructor.EMPTY_NODE.updateImmediateChild(e,n).updatePriority(this.priorityNode_)},t.prototype.updateChild=function(e,n){var r=pt(e);return null===r?n:n.isEmpty()&&".priority"!==r?this:(Object(i.e)(".priority"!==r||1===ft(e),".priority must be the last token in a path"),this.updateImmediateChild(r,t.__childrenNodeConstructor.EMPTY_NODE.updateChild(mt(e),n)))},t.prototype.isEmpty=function(){return!1},t.prototype.numChildren=function(){return 0},t.prototype.forEachChild=function(t,e){return!1},t.prototype.val=function(t){return t&&!this.getPriority().isEmpty()?{".value":this.getValue(),".priority":this.getPriority().val()}:this.getValue()},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.priorityNode_.isEmpty()||(t+="priority:"+Zt(this.priorityNode_.val())+":");var e=typeof this.value_;t+=e+":",t+="number"===e?L(this.value_):this.value_,this.lazyHash_=_(t)}return this.lazyHash_},t.prototype.getValue=function(){return this.value_},t.prototype.compareTo=function(e){return e===t.__childrenNodeConstructor.EMPTY_NODE?1:e instanceof t.__childrenNodeConstructor?-1:(Object(i.e)(e.isLeafNode(),"Unknown node type"),this.compareToLeafNode_(e))},t.prototype.compareToLeafNode_=function(e){var n=typeof e.value_,r=typeof this.value_,o=t.VALUE_TYPE_ORDER.indexOf(n),s=t.VALUE_TYPE_ORDER.indexOf(r);return Object(i.e)(o>=0,"Unknown leaf type: "+n),Object(i.e)(s>=0,"Unknown leaf type: "+r),o===s?"object"===r?0:this.value_<e.value_?-1:this.value_===e.value_?0:1:s-o},t.prototype.withIndex=function(){return this},t.prototype.isIndexed=function(){return!0},t.prototype.equals=function(t){return t===this||!!t.isLeafNode()&&this.value_===t.value_&&this.priorityNode_.equals(t.priorityNode_)},t.VALUE_TYPE_ORDER=["object","boolean","number","string"],t}(),Yt=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.compare=function(t,e){var n=t.node.getPriority(),r=e.node.getPriority(),i=n.compareTo(r);return 0===i?M(t.name,e.name):i},e.prototype.isDefinedOn=function(t){return!t.getPriority().isEmpty()},e.prototype.indexedValueChanged=function(t,e){return!t.getPriority().equals(e.getPriority())},e.prototype.minPost=function(){return Dt.MIN},e.prototype.maxPost=function(){return new Dt(A,new Xt("[PRIORITY-POST]",$t))},e.prototype.makePost=function(t,e){var n=Gt(t);return new Dt(e,new Xt("[PRIORITY-POST]",n))},e.prototype.toString=function(){return".priority"},e}(Rt)),Qt=Math.log(2),Jt=function(){function t(t){this.count=parseInt(Math.log(t+1)/Qt,10),this.current_=this.count-1;var e=parseInt(Array(this.count+1).join("1"),2);this.bits_=t+1&e}return t.prototype.nextBitIsOne=function(){var t=!(this.bits_&1<<this.current_);return this.current_--,t},t}(),te=function(t,e,n,r){t.sort(e);var i=function(e,r){var o,s,a=r-e;if(0===a)return null;if(1===a)return o=t[e],s=n?n(o):o,new zt(s,o.node,zt.BLACK,null,null);var c=parseInt(a/2,10)+e,l=i(e,c),u=i(c+1,r);return o=t[c],s=n?n(o):o,new zt(s,o.node,zt.BLACK,l,u)},o=function(e){for(var r=null,o=null,s=t.length,a=function(e,r){var o=s-e,a=s;s-=e;var l=i(o+1,a),u=t[o],h=n?n(u):u;c(new zt(h,u.node,r,null,l))},c=function(t){r?(r.left=t,r=t):(o=t,r=t)},l=0;l<e.count;++l){var u=e.nextBitIsOne(),h=Math.pow(2,e.count-(l+1));u?a(h,zt.BLACK):(a(h,zt.BLACK),a(h,zt.RED))}return o}(new Jt(t.length));return new Bt(r||e,o)},ee={},ne=function(){function t(t,e){this.indexes_=t,this.indexSet_=e}return Object.defineProperty(t,"Default",{get:function(){return Object(i.e)(ee&&Yt,"ChildrenNode.ts has not been loaded"),Wt=Wt||new t({".priority":ee},{".priority":Yt})},enumerable:!1,configurable:!0}),t.prototype.get=function(t){var e=Object(i.G)(this.indexes_,t);if(!e)throw new Error("No index defined for "+t);return e instanceof Bt?e:null},t.prototype.hasIndex=function(t){return Object(i.i)(this.indexSet_,t.toString())},t.prototype.addIndex=function(e,n){Object(i.e)(e!==Lt,"KeyIndex always exists and isn't meant to be added to the IndexMap.");for(var r,s=[],a=!1,c=n.getIterator(Dt.Wrap),l=c.getNext();l;)a=a||e.isDefinedOn(l.node),s.push(l),l=c.getNext();r=a?te(s,e.getCompare()):ee;var u=e.toString(),h=Object(o.a)({},this.indexSet_);h[u]=e;var d=Object(o.a)({},this.indexes_);return d[u]=r,new t(d,h)},t.prototype.addToIndexes=function(e,n){var r=this;return new t(Object(i.E)(this.indexes_,function(t,o){var s=Object(i.G)(r.indexSet_,o);if(Object(i.e)(s,"Missing index implementation for "+o),t===ee){if(s.isDefinedOn(e.node)){for(var a=[],c=n.getIterator(Dt.Wrap),l=c.getNext();l;)l.name!==e.name&&a.push(l),l=c.getNext();return a.push(e),te(a,s.getCompare())}return ee}var u=n.get(e.name),h=t;return u&&(h=h.remove(new Dt(e.name,u))),h.insert(e,e.node)}),this.indexSet_)},t.prototype.removeFromIndexes=function(e,n){return new t(Object(i.E)(this.indexes_,function(t){if(t===ee)return t;var r=n.get(e.name);return r?t.remove(new Dt(e.name,r)):t}),this.indexSet_)},t}(),re=function(){function t(t,e,n){this.children_=t,this.priorityNode_=e,this.indexMap_=n,this.lazyHash_=null,this.priorityNode_&&Kt(this.priorityNode_),this.children_.isEmpty()&&Object(i.e)(!this.priorityNode_||this.priorityNode_.isEmpty(),"An empty node cannot have a priority")}return Object.defineProperty(t,"EMPTY_NODE",{get:function(){return Ht||(Ht=new t(new Bt(Vt),null,ne.Default))},enumerable:!1,configurable:!0}),t.prototype.isLeafNode=function(){return!1},t.prototype.getPriority=function(){return this.priorityNode_||Ht},t.prototype.updatePriority=function(e){return this.children_.isEmpty()?this:new t(this.children_,e,this.indexMap_)},t.prototype.getImmediateChild=function(t){if(".priority"===t)return this.getPriority();var e=this.children_.get(t);return null===e?Ht:e},t.prototype.getChild=function(t){var e=pt(t);return null===e?this:this.getImmediateChild(e).getChild(mt(t))},t.prototype.hasChild=function(t){return null!==this.children_.get(t)},t.prototype.updateImmediateChild=function(e,n){if(Object(i.e)(n,"We should always be passing snapshot nodes"),".priority"===e)return this.updatePriority(n);var r=new Dt(e,n),o=void 0,s=void 0;n.isEmpty()?(o=this.children_.remove(e),s=this.indexMap_.removeFromIndexes(r,this.children_)):(o=this.children_.insert(e,n),s=this.indexMap_.addToIndexes(r,this.children_));var a=o.isEmpty()?Ht:this.priorityNode_;return new t(o,a,s)},t.prototype.updateChild=function(t,e){var n=pt(t);if(null===n)return e;Object(i.e)(".priority"!==pt(t)||1===ft(t),".priority must be the last token in a path");var r=this.getImmediateChild(n).updateChild(mt(t),e);return this.updateImmediateChild(n,r)},t.prototype.isEmpty=function(){return this.children_.isEmpty()},t.prototype.numChildren=function(){return this.children_.count()},t.prototype.val=function(e){if(this.isEmpty())return null;var n={},r=0,i=0,o=!0;if(this.forEachChild(Yt,function(s,a){n[s]=a.val(e),r++,o&&t.INTEGER_REGEXP_.test(s)?i=Math.max(i,Number(s)):o=!1}),!e&&o&&i<2*r){var s=[];for(var a in n)s[a]=n[a];return s}return e&&!this.getPriority().isEmpty()&&(n[".priority"]=this.getPriority().val()),n},t.prototype.hash=function(){if(null===this.lazyHash_){var t="";this.getPriority().isEmpty()||(t+="priority:"+Zt(this.getPriority().val())+":"),this.forEachChild(Yt,function(e,n){var r=n.hash();""!==r&&(t+=":"+e+":"+r)}),this.lazyHash_=""===t?"":_(t)}return this.lazyHash_},t.prototype.getPredecessorChildName=function(t,e,n){var r=this.resolveIndex_(n);if(r){var i=r.getPredecessorKey(new Dt(t,e));return i?i.name:null}return this.children_.getPredecessorKey(t)},t.prototype.getFirstChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.minKey();return n&&n.name}return this.children_.minKey()},t.prototype.getFirstChild=function(t){var e=this.getFirstChildName(t);return e?new Dt(e,this.children_.get(e)):null},t.prototype.getLastChildName=function(t){var e=this.resolveIndex_(t);if(e){var n=e.maxKey();return n&&n.name}return this.children_.maxKey()},t.prototype.getLastChild=function(t){var e=this.getLastChildName(t);return e?new Dt(e,this.children_.get(e)):null},t.prototype.forEachChild=function(t,e){var n=this.resolveIndex_(t);return n?n.inorderTraversal(function(t){return e(t.name,t.node)}):this.children_.inorderTraversal(e)},t.prototype.getIterator=function(t){return this.getIteratorFrom(t.minPost(),t)},t.prototype.getIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getIteratorFrom(t,function(t){return t});for(var r=this.children_.getIteratorFrom(t.name,Dt.Wrap),i=r.peek();null!=i&&e.compare(i,t)<0;)r.getNext(),i=r.peek();return r},t.prototype.getReverseIterator=function(t){return this.getReverseIteratorFrom(t.maxPost(),t)},t.prototype.getReverseIteratorFrom=function(t,e){var n=this.resolveIndex_(e);if(n)return n.getReverseIteratorFrom(t,function(t){return t});for(var r=this.children_.getReverseIteratorFrom(t.name,Dt.Wrap),i=r.peek();null!=i&&e.compare(i,t)>0;)r.getNext(),i=r.peek();return r},t.prototype.compareTo=function(t){return this.isEmpty()?t.isEmpty()?0:-1:t.isLeafNode()||t.isEmpty()?1:t===ie?-1:0},t.prototype.withIndex=function(e){if(e===Lt||this.indexMap_.hasIndex(e))return this;var n=this.indexMap_.addIndex(e,this.children_);return new t(this.children_,this.priorityNode_,n)},t.prototype.isIndexed=function(t){return t===Lt||this.indexMap_.hasIndex(t)},t.prototype.equals=function(t){if(t===this)return!0;if(t.isLeafNode())return!1;var e=t;if(this.getPriority().equals(e.getPriority())){if(this.children_.count()===e.children_.count()){for(var n=this.getIterator(Yt),r=e.getIterator(Yt),i=n.getNext(),o=r.getNext();i&&o;){if(i.name!==o.name||!i.node.equals(o.node))return!1;i=n.getNext(),o=r.getNext()}return null===i&&null===o}return!1}return!1},t.prototype.resolveIndex_=function(t){return t===Lt?null:this.indexMap_.get(t.toString())},t.INTEGER_REGEXP_=/^(0|[1-9]\d*)$/,t}(),ie=new(function(t){function e(){return t.call(this,new Bt(Vt),re.EMPTY_NODE,ne.Default)||this}return Object(o.c)(e,t),e.prototype.compareTo=function(t){return t===this?0:1},e.prototype.equals=function(t){return t===this},e.prototype.getPriority=function(){return this},e.prototype.getImmediateChild=function(t){return re.EMPTY_NODE},e.prototype.isEmpty=function(){return!1},e}(re));function oe(t,e){if(void 0===e&&(e=null),null===t)return re.EMPTY_NODE;if("object"==typeof t&&".priority"in t&&(e=t[".priority"]),Object(i.e)(null===e||"string"==typeof e||"number"==typeof e||"object"==typeof e&&".sv"in e,"Invalid priority type found: "+typeof e),"object"==typeof t&&".value"in t&&null!==t[".value"]&&(t=t[".value"]),"object"!=typeof t||".sv"in t)return new Xt(t,oe(e));if(t instanceof Array){var n=re.EMPTY_NODE;return N(t,function(e,r){if(Object(i.i)(t,e)&&"."!==e.substring(0,1)){var o=oe(r);!o.isLeafNode()&&o.isEmpty()||(n=n.updateImmediateChild(e,o))}}),n.updatePriority(oe(e))}var r=[],o=!1;if(N(t,function(t,e){if("."!==t.substring(0,1)){var n=oe(e);n.isEmpty()||(o=o||!n.getPriority().isEmpty(),r.push(new Dt(t,n)))}}),0===r.length)return re.EMPTY_NODE;var s=te(r,Ut,function(t){return t.name},Vt);if(o){var a=te(r,Yt.getCompare());return new re(s,oe(e),new ne({".priority":a},{".priority":Yt}))}return new re(s,oe(e),ne.Default)}Object.defineProperties(Dt,{MIN:{value:new Dt(k,re.EMPTY_NODE)},MAX:{value:new Dt(A,ie)}}),Nt.__EMPTY_NODE=re.EMPTY_NODE,Xt.__childrenNodeConstructor=re,At=ie,$t=ie,Gt=oe;var se,ae,ce=function(t){function e(e){var n=t.call(this)||this;return n.indexPath_=e,Object(i.e)(!bt(e)&&".priority"!==pt(e),"Can't create PathIndex with empty path or .priority key"),n}return Object(o.c)(e,t),e.prototype.extractChild=function(t){return t.getChild(this.indexPath_)},e.prototype.isDefinedOn=function(t){return!t.getChild(this.indexPath_).isEmpty()},e.prototype.compare=function(t,e){var n=this.extractChild(t.node),r=this.extractChild(e.node),i=n.compareTo(r);return 0===i?M(t.name,e.name):i},e.prototype.makePost=function(t,e){var n=oe(t),r=re.EMPTY_NODE.updateChild(this.indexPath_,n);return new Dt(e,r)},e.prototype.maxPost=function(){var t=re.EMPTY_NODE.updateChild(this.indexPath_,ie);return new Dt(A,t)},e.prototype.toString=function(){return _t(this.indexPath_,0).join("/")},e}(Rt),le=new(function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype.compare=function(t,e){var n=t.node.compareTo(e.node);return 0===n?M(t.name,e.name):n},e.prototype.isDefinedOn=function(t){return!0},e.prototype.indexedValueChanged=function(t,e){return!t.equals(e)},e.prototype.minPost=function(){return Dt.MIN},e.prototype.maxPost=function(){return Dt.MAX},e.prototype.makePost=function(t,e){var n=oe(t);return new Dt(e,n)},e.prototype.toString=function(){return".value"},e}(Rt)),ue="-0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ_abcdefghijklmnopqrstuvwxyz",he=(se=0,ae=[],function(t){var e,n=t===se;se=t;var r=new Array(8);for(e=7;e>=0;e--)r[e]=ue.charAt(t%64),t=Math.floor(t/64);Object(i.e)(0===t,"Cannot push at time == 0");var o=r.join("");if(n){for(e=11;e>=0&&63===ae[e];e--)ae[e]=0;ae[e]++}else for(e=0;e<12;e++)ae[e]=Math.floor(64*Math.random());for(e=0;e<12;e++)o+=ue.charAt(ae[e]);return Object(i.e)(20===o.length,"nextPushId: Length should be 20."),o}),de=function(t){if("2147483647"===t)return"-";var e=z(t);if(null!=e)return""+(e+1);for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t.charAt(r);if(n.length<786)return n.push("-"),n.join("");for(var i=n.length-1;i>=0&&"z"===n[i];)i--;if(-1===i)return A;var o=ue.charAt(ue.indexOf(n[i])+1);return n[i]=o,n.slice(0,i+1).join("")},pe=function(t){if("-2147483648"===t)return k;var e=z(t);if(null!=e)return""+(e-1);for(var n=new Array(t.length),r=0;r<n.length;r++)n[r]=t.charAt(r);return"-"===n[n.length-1]?1===n.length?"2147483647":(delete n[n.length-1],n.join("")):(n[n.length-1]=ue.charAt(ue.indexOf(n[n.length-1])-1),n.join("")+"z".repeat(786-n.length))};function fe(t){return{type:"value",snapshotNode:t}}function me(t,e){return{type:"child_added",snapshotNode:e,childName:t}}function ge(t,e){return{type:"child_removed",snapshotNode:e,childName:t}}function _e(t,e,n){return{type:"child_changed",snapshotNode:e,childName:t,oldSnap:n}}var ye=function(){function t(t){this.index_=t}return t.prototype.updateChild=function(t,e,n,r,o,s){Object(i.e)(t.isIndexed(this.index_),"A node must be indexed if only a child is updated");var a=t.getImmediateChild(e);return a.getChild(r).equals(n.getChild(r))&&a.isEmpty()===n.isEmpty()?t:(null!=s&&(n.isEmpty()?t.hasChild(e)?s.trackChildChange(ge(e,a)):Object(i.e)(t.isLeafNode(),"A child remove without an old child only makes sense on a leaf node"):a.isEmpty()?s.trackChildChange(me(e,n)):s.trackChildChange(_e(e,n,a))),t.isLeafNode()&&n.isEmpty()?t:t.updateImmediateChild(e,n).withIndex(this.index_))},t.prototype.updateFullNode=function(t,e,n){return null!=n&&(t.isLeafNode()||t.forEachChild(Yt,function(t,r){e.hasChild(t)||n.trackChildChange(ge(t,r))}),e.isLeafNode()||e.forEachChild(Yt,function(e,r){if(t.hasChild(e)){var i=t.getImmediateChild(e);i.equals(r)||n.trackChildChange(_e(e,r,i))}else n.trackChildChange(me(e,r))})),e.withIndex(this.index_)},t.prototype.updatePriority=function(t,e){return t.isEmpty()?re.EMPTY_NODE:t.updatePriority(e)},t.prototype.filtersNodes=function(){return!1},t.prototype.getIndexedFilter=function(){return this},t.prototype.getIndex=function(){return this.index_},t}(),ve=function(){function t(e){this.indexedFilter_=new ye(e.getIndex()),this.index_=e.getIndex(),this.startPost_=t.getStartPost_(e),this.endPost_=t.getEndPost_(e)}return t.prototype.getStartPost=function(){return this.startPost_},t.prototype.getEndPost=function(){return this.endPost_},t.prototype.matches=function(t){return this.index_.compare(this.getStartPost(),t)<=0&&this.index_.compare(t,this.getEndPost())<=0},t.prototype.updateChild=function(t,e,n,r,i,o){return this.matches(new Dt(e,n))||(n=re.EMPTY_NODE),this.indexedFilter_.updateChild(t,e,n,r,i,o)},t.prototype.updateFullNode=function(t,e,n){e.isLeafNode()&&(e=re.EMPTY_NODE);var r=e.withIndex(this.index_);r=r.updatePriority(re.EMPTY_NODE);var i=this;return e.forEachChild(Yt,function(t,e){i.matches(new Dt(t,e))||(r=r.updateImmediateChild(t,re.EMPTY_NODE))}),this.indexedFilter_.updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.indexedFilter_},t.prototype.getIndex=function(){return this.index_},t.getStartPost_=function(t){if(t.hasStart()){var e=t.getIndexStartName();return t.getIndex().makePost(t.getIndexStartValue(),e)}return t.getIndex().minPost()},t.getEndPost_=function(t){if(t.hasEnd()){var e=t.getIndexEndName();return t.getIndex().makePost(t.getIndexEndValue(),e)}return t.getIndex().maxPost()},t}(),be=function(){function t(t){this.rangedFilter_=new ve(t),this.index_=t.getIndex(),this.limit_=t.getLimit(),this.reverse_=!t.isViewFromLeft()}return t.prototype.updateChild=function(t,e,n,r,i,o){return this.rangedFilter_.matches(new Dt(e,n))||(n=re.EMPTY_NODE),t.getImmediateChild(e).equals(n)?t:t.numChildren()<this.limit_?this.rangedFilter_.getIndexedFilter().updateChild(t,e,n,r,i,o):this.fullLimitUpdateChild_(t,e,n,i,o)},t.prototype.updateFullNode=function(t,e,n){var r;if(e.isLeafNode()||e.isEmpty())r=re.EMPTY_NODE.withIndex(this.index_);else if(2*this.limit_<e.numChildren()&&e.isIndexed(this.index_)){r=re.EMPTY_NODE.withIndex(this.index_);var i=void 0;i=this.reverse_?e.getReverseIteratorFrom(this.rangedFilter_.getEndPost(),this.index_):e.getIteratorFrom(this.rangedFilter_.getStartPost(),this.index_);for(var o=0;i.hasNext()&&o<this.limit_;){var s=i.getNext();if(!(this.reverse_?this.index_.compare(this.rangedFilter_.getStartPost(),s)<=0:this.index_.compare(s,this.rangedFilter_.getEndPost())<=0))break;r=r.updateImmediateChild(s.name,s.node),o++}}else{r=(r=e.withIndex(this.index_)).updatePriority(re.EMPTY_NODE);var a=void 0,c=void 0,l=void 0;if(i=void 0,this.reverse_){i=r.getReverseIterator(this.index_),a=this.rangedFilter_.getEndPost(),c=this.rangedFilter_.getStartPost();var u=this.index_.getCompare();l=function(t,e){return u(e,t)}}else i=r.getIterator(this.index_),a=this.rangedFilter_.getStartPost(),c=this.rangedFilter_.getEndPost(),l=this.index_.getCompare();o=0;for(var h=!1;i.hasNext();)s=i.getNext(),!h&&l(a,s)<=0&&(h=!0),h&&o<this.limit_&&l(s,c)<=0?o++:r=r.updateImmediateChild(s.name,re.EMPTY_NODE)}return this.rangedFilter_.getIndexedFilter().updateFullNode(t,r,n)},t.prototype.updatePriority=function(t,e){return t},t.prototype.filtersNodes=function(){return!0},t.prototype.getIndexedFilter=function(){return this.rangedFilter_.getIndexedFilter()},t.prototype.getIndex=function(){return this.index_},t.prototype.fullLimitUpdateChild_=function(t,e,n,r,o){var s;if(this.reverse_){var a=this.index_.getCompare();s=function(t,e){return a(e,t)}}else s=this.index_.getCompare();var c=t;Object(i.e)(c.numChildren()===this.limit_,"");var l=new Dt(e,n),u=this.reverse_?c.getFirstChild(this.index_):c.getLastChild(this.index_),h=this.rangedFilter_.matches(l);if(c.hasChild(e)){for(var d=c.getImmediateChild(e),p=r.getChildAfterChild(this.index_,u,this.reverse_);null!=p&&(p.name===e||c.hasChild(p.name));)p=r.getChildAfterChild(this.index_,p,this.reverse_);var f=null==p?1:s(p,l);if(h&&!n.isEmpty()&&f>=0)return null!=o&&o.trackChildChange(_e(e,n,d)),c.updateImmediateChild(e,n);null!=o&&o.trackChildChange(ge(e,d));var m=c.updateImmediateChild(e,re.EMPTY_NODE);return null!=p&&this.rangedFilter_.matches(p)?(null!=o&&o.trackChildChange(me(p.name,p.node)),m.updateImmediateChild(p.name,p.node)):m}return n.isEmpty()?t:h&&s(u,l)>=0?(null!=o&&(o.trackChildChange(ge(u.name,u.node)),o.trackChildChange(me(e,n))),c.updateImmediateChild(e,n).updateImmediateChild(u.name,re.EMPTY_NODE)):t},t}(),xe=function(){function t(){this.limitSet_=!1,this.startSet_=!1,this.startNameSet_=!1,this.startAfterSet_=!1,this.endSet_=!1,this.endNameSet_=!1,this.endBeforeSet_=!1,this.limit_=0,this.viewFrom_="",this.indexStartValue_=null,this.indexStartName_="",this.indexEndValue_=null,this.indexEndName_="",this.index_=Yt}return t.prototype.hasStart=function(){return this.startSet_},t.prototype.hasStartAfter=function(){return this.startAfterSet_},t.prototype.hasEndBefore=function(){return this.endBeforeSet_},t.prototype.isViewFromLeft=function(){return""===this.viewFrom_?this.startSet_:"l"===this.viewFrom_},t.prototype.getIndexStartValue=function(){return Object(i.e)(this.startSet_,"Only valid if start has been set"),this.indexStartValue_},t.prototype.getIndexStartName=function(){return Object(i.e)(this.startSet_,"Only valid if start has been set"),this.startNameSet_?this.indexStartName_:k},t.prototype.hasEnd=function(){return this.endSet_},t.prototype.getIndexEndValue=function(){return Object(i.e)(this.endSet_,"Only valid if end has been set"),this.indexEndValue_},t.prototype.getIndexEndName=function(){return Object(i.e)(this.endSet_,"Only valid if end has been set"),this.endNameSet_?this.indexEndName_:A},t.prototype.hasLimit=function(){return this.limitSet_},t.prototype.hasAnchoredLimit=function(){return this.limitSet_&&""!==this.viewFrom_},t.prototype.getLimit=function(){return Object(i.e)(this.limitSet_,"Only valid if limit has been set"),this.limit_},t.prototype.getIndex=function(){return this.index_},t.prototype.loadsAllData=function(){return!(this.startSet_||this.endSet_||this.limitSet_)},t.prototype.isDefault=function(){return this.loadsAllData()&&this.index_===Yt},t.prototype.copy=function(){var e=new t;return e.limitSet_=this.limitSet_,e.limit_=this.limit_,e.startSet_=this.startSet_,e.indexStartValue_=this.indexStartValue_,e.startNameSet_=this.startNameSet_,e.indexStartName_=this.indexStartName_,e.endSet_=this.endSet_,e.indexEndValue_=this.indexEndValue_,e.endNameSet_=this.endNameSet_,e.indexEndName_=this.indexEndName_,e.index_=this.index_,e.viewFrom_=this.viewFrom_,e},t}();function we(t,e,n){var r=t.copy();return r.startSet_=!0,void 0===e&&(e=null),r.indexStartValue_=e,null!=n?(r.startNameSet_=!0,r.indexStartName_=n):(r.startNameSet_=!1,r.indexStartName_=""),r}function Te(t,e,n){var r=t.copy();return r.endSet_=!0,void 0===e&&(e=null),r.indexEndValue_=e,void 0!==n?(r.endNameSet_=!0,r.indexEndName_=n):(r.endNameSet_=!1,r.indexEndName_=""),r}function Ce(t,e){var n=t.copy();return n.index_=e,n}function Ee(t){var e,n={};return t.isDefault()||(t.index_===Yt?e="$priority":t.index_===le?e="$value":t.index_===Lt?e="$key":(Object(i.e)(t.index_ instanceof ce,"Unrecognized index type!"),e=t.index_.toString()),n.orderBy=Object(i.J)(e),t.startSet_&&(n.startAt=Object(i.J)(t.indexStartValue_),t.startNameSet_&&(n.startAt+=","+Object(i.J)(t.indexStartName_))),t.endSet_&&(n.endAt=Object(i.J)(t.indexEndValue_),t.endNameSet_&&(n.endAt+=","+Object(i.J)(t.indexEndName_))),t.limitSet_&&(t.isViewFromLeft()?n.limitToFirst=t.limit_:n.limitToLast=t.limit_)),n}function Se(t){var e={};if(t.startSet_&&(e.sp=t.indexStartValue_,t.startNameSet_&&(e.sn=t.indexStartName_)),t.endSet_&&(e.ep=t.indexEndValue_,t.endNameSet_&&(e.en=t.indexEndName_)),t.limitSet_){e.l=t.limit_;var n=t.viewFrom_;""===n&&(n=t.isViewFromLeft()?"l":"r"),e.vf=n}return t.index_!==Yt&&(e.i=t.index_.toString()),e}var Ie=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.repoInfo_=e,o.onDataUpdate_=n,o.authTokenProvider_=r,o.appCheckTokenProvider_=i,o.log_=T("p:rest:"),o.listens_={},o}return Object(o.c)(e,t),e.prototype.reportStats=function(t){throw new Error("Method not implemented.")},e.getListenId_=function(t,e){return void 0!==e?"tag$"+e:(Object(i.e)(t._queryParams.isDefault(),"should have a tag if it's not a default query."),t._path.toString())},e.prototype.listen=function(t,n,r,o){var s=this,a=t._path.toString();this.log_("Listen called for "+a+" "+t._queryIdentifier);var c=e.getListenId_(t,r),l={};this.listens_[c]=l;var u=Ee(t._queryParams);this.restRequest_(a+".json",u,function(t,e){var n=e;404===t&&(n=null,t=null),null===t&&s.onDataUpdate_(a,n,!1,r),Object(i.G)(s.listens_,c)===l&&o(t?401===t?"permission_denied":"rest_error:"+t:"ok",null)})},e.prototype.unlisten=function(t,n){var r=e.getListenId_(t,n);delete this.listens_[r]},e.prototype.get=function(t){var e=this,n=Ee(t._queryParams),r=t._path.toString(),o=new i.a;return this.restRequest_(r+".json",n,function(t,n){var i=n;404===t&&(i=null,t=null),null===t?(e.onDataUpdate_(r,i,!1,null),o.resolve(i)):o.reject(new Error(i))}),o.promise},e.prototype.refreshAuthToken=function(t){},e.prototype.restRequest_=function(t,e,n){var r=this;return void 0===e&&(e={}),e.format="export",Promise.all([this.authTokenProvider_.getToken(!1),this.appCheckTokenProvider_.getToken(!1)]).then(function(s){var a=Object(o.e)(s,2),c=a[0],l=a[1];c&&c.accessToken&&(e.auth=c.accessToken),l&&l.token&&(e.ac=l.token);var u=(r.repoInfo_.secure?"https://":"http://")+r.repoInfo_.host+t+"?ns="+r.repoInfo_.namespace+Object(i.F)(e);r.log_("Sending REST request for "+u);var h=new XMLHttpRequest;h.onreadystatechange=function(){if(n&&4===h.readyState){r.log_("REST Response for "+u+" received. status:",h.status,"response:",h.responseText);var t=null;if(h.status>=200&&h.status<300){try{t=Object(i.D)(h.responseText)}catch(e){S("Failed to parse JSON response for "+u+": "+h.responseText)}n(null,t)}else 401!==h.status&&404!==h.status&&S("Got unsuccessful REST response for "+u+" Status: "+h.status),n(h.status);n=null}},h.open("GET",u,!0),h.send()})},e}(ct),ke=function(){function t(){this.rootNode_=re.EMPTY_NODE}return t.prototype.getNode=function(t){return this.rootNode_.getChild(t)},t.prototype.updateSnapshot=function(t,e){this.rootNode_=this.rootNode_.updateChild(t,e)},t}();function Ae(){return{value:null,children:new Map}}function Me(t,e,n){if(bt(e))t.value=n,t.children.clear();else if(null!==t.value)t.value=t.value.updateChild(e,n);else{var r=pt(e);t.children.has(r)||t.children.set(r,Ae()),Me(t.children.get(r),e=mt(e),n)}}function Oe(t,e){if(bt(e))return t.value=null,t.children.clear(),!0;if(null!==t.value){if(t.value.isLeafNode())return!1;var n=t.value;return t.value=null,n.forEachChild(Yt,function(e,n){Me(t,new ht(e),n)}),Oe(t,e)}if(t.children.size>0){var r=pt(e);return e=mt(e),t.children.has(r)&&Oe(t.children.get(r),e)&&t.children.delete(r),0===t.children.size}return!0}function Pe(t,e,n){null!==t.value?n(e,t.value):function(t,e){t.children.forEach(function(t,n){e(n,t)})}(t,function(t,r){Pe(r,new ht(e.toString()+"/"+t),n)})}var De=function(){function t(t){this.collection_=t,this.last_=null}return t.prototype.get=function(){var t=this.collection_.get(),e=Object(o.a)({},t);return this.last_&&N(this.last_,function(t,n){e[t]=e[t]-n}),this.last_=t,e},t}(),Re=function(){function t(t,e){this.server_=e,this.statsToReport_={},this.statsListener_=new De(t);var n=1e4+2e4*Math.random();B(this.reportStats_.bind(this),Math.floor(n))}return t.prototype.reportStats_=function(){var t=this,e=this.statsListener_.get(),n={},r=!1;N(e,function(e,o){o>0&&Object(i.i)(t.statsToReport_,e)&&(n[e]=o,r=!0)}),r&&this.server_.reportStats(n),B(this.reportStats_.bind(this),Math.floor(2*Math.random()*3e5))},t}(),Ne=function(t){return t[t.OVERWRITE=0]="OVERWRITE",t[t.MERGE=1]="MERGE",t[t.ACK_USER_WRITE=2]="ACK_USER_WRITE",t[t.LISTEN_COMPLETE=3]="LISTEN_COMPLETE",t}({});function Le(t){return{fromUser:!1,fromServer:!0,queryId:t,tagged:!0}}var je,ze=function(){function t(t,e,n){this.path=t,this.affectedTree=e,this.revert=n,this.type=Ne.ACK_USER_WRITE,this.source={fromUser:!0,fromServer:!1,queryId:null,tagged:!1}}return t.prototype.operationForChild=function(e){if(bt(this.path)){if(null!=this.affectedTree.value)return Object(i.e)(this.affectedTree.children.isEmpty(),"affectedTree should not have overlapping affected paths."),this;var n=this.affectedTree.subtree(new ht(e));return new t(dt(),n,this.revert)}return Object(i.e)(pt(this.path)===e,"operationForChild called for unrelated child."),new t(mt(this.path),this.affectedTree,this.revert)},t}(),Fe=function(){function t(t,e){this.source=t,this.path=e,this.type=Ne.LISTEN_COMPLETE}return t.prototype.operationForChild=function(e){return bt(this.path)?new t(this.source,dt()):new t(this.source,mt(this.path))},t}(),Be=function(){function t(t,e,n){this.source=t,this.path=e,this.snap=n,this.type=Ne.OVERWRITE}return t.prototype.operationForChild=function(e){return bt(this.path)?new t(this.source,dt(),this.snap.getImmediateChild(e)):new t(this.source,mt(this.path),this.snap)},t}(),Ue=function(){function t(t,e,n){this.source=t,this.path=e,this.children=n,this.type=Ne.MERGE}return t.prototype.operationForChild=function(e){if(bt(this.path)){var n=this.children.subtree(new ht(e));return n.isEmpty()?null:n.value?new Be(this.source,dt(),n.value):new t(this.source,dt(),n)}return Object(i.e)(pt(this.path)===e,"Can't get a merge for a child not on the path of the operation"),new t(this.source,mt(this.path),this.children)},t.prototype.toString=function(){return"Operation("+this.path+": "+this.source.toString()+" merge: "+this.children.toString()+")"},t}(),Ve=function(){function t(t,e,n){this.node_=t,this.fullyInitialized_=e,this.filtered_=n}return t.prototype.isFullyInitialized=function(){return this.fullyInitialized_},t.prototype.isFiltered=function(){return this.filtered_},t.prototype.isCompleteForPath=function(t){if(bt(t))return this.isFullyInitialized()&&!this.filtered_;var e=pt(t);return this.isCompleteForChild(e)},t.prototype.isCompleteForChild=function(t){return this.isFullyInitialized()&&!this.filtered_||this.node_.hasChild(t)},t.prototype.getNode=function(){return this.node_},t}(),qe=function(){return function(t){this.query_=t,this.index_=this.query_._queryParams.getIndex()}}();function Ge(t,e,n,r,o,s){var a=r.filter(function(t){return t.type===n});a.sort(function(e,n){return function(t,e,n){if(null==e.childName||null==n.childName)throw Object(i.f)("Should only compare child_ events.");var r=new Dt(e.childName,e.snapshotNode),o=new Dt(n.childName,n.snapshotNode);return t.index_.compare(r,o)}(t,e,n)}),a.forEach(function(n){var r=function(t,e,n){return"value"===e.type||"child_removed"===e.type||(e.prevName=n.getPredecessorChildName(e.childName,e.snapshotNode,t.index_)),e}(t,n,s);o.forEach(function(i){i.respondsTo(n.type)&&e.push(i.createEvent(r,t.query_))})})}function $e(t,e){return{eventCache:t,serverCache:e}}function We(t,e,n,r){return $e(new Ve(e,n,r),t.serverCache)}function He(t,e,n,r){return $e(t.eventCache,new Ve(e,n,r))}function Ze(t){return t.eventCache.isFullyInitialized()?t.eventCache.getNode():null}function Ke(t){return t.serverCache.isFullyInitialized()?t.serverCache.getNode():null}var Xe=function(){function t(t,e){void 0===e&&(je||(je=new Bt(O)),e=je),this.value=t,this.children=e}return t.fromObject=function(e){var n=new t(null);return N(e,function(t,e){n=n.set(new ht(t),e)}),n},t.prototype.isEmpty=function(){return null===this.value&&this.children.isEmpty()},t.prototype.findRootMostMatchingPathAndValue=function(t,e){if(null!=this.value&&e(this.value))return{path:dt(),value:this.value};if(bt(t))return null;var n=pt(t),r=this.children.get(n);if(null!==r){var i=r.findRootMostMatchingPathAndValue(mt(t),e);return null!=i?{path:vt(new ht(n),i.path),value:i.value}:null}return null},t.prototype.findRootMostValueAndPath=function(t){return this.findRootMostMatchingPathAndValue(t,function(){return!0})},t.prototype.subtree=function(e){if(bt(e))return this;var n=pt(e),r=this.children.get(n);return null!==r?r.subtree(mt(e)):new t(null)},t.prototype.set=function(e,n){if(bt(e))return new t(n,this.children);var r=pt(e),i=(this.children.get(r)||new t(null)).set(mt(e),n),o=this.children.insert(r,i);return new t(this.value,o)},t.prototype.remove=function(e){if(bt(e))return this.children.isEmpty()?new t(null):new t(null,this.children);var n=pt(e),r=this.children.get(n);if(r){var i=r.remove(mt(e)),o=void 0;return o=i.isEmpty()?this.children.remove(n):this.children.insert(n,i),null===this.value&&o.isEmpty()?new t(null):new t(this.value,o)}return this},t.prototype.get=function(t){if(bt(t))return this.value;var e=pt(t),n=this.children.get(e);return n?n.get(mt(t)):null},t.prototype.setTree=function(e,n){if(bt(e))return n;var r,i=pt(e),o=(this.children.get(i)||new t(null)).setTree(mt(e),n);return r=o.isEmpty()?this.children.remove(i):this.children.insert(i,o),new t(this.value,r)},t.prototype.fold=function(t){return this.fold_(dt(),t)},t.prototype.fold_=function(t,e){var n={};return this.children.inorderTraversal(function(r,i){n[r]=i.fold_(vt(t,r),e)}),e(t,this.value,n)},t.prototype.findOnPath=function(t,e){return this.findOnPath_(t,dt(),e)},t.prototype.findOnPath_=function(t,e,n){var r=!!this.value&&n(e,this.value);if(r)return r;if(bt(t))return null;var i=pt(t),o=this.children.get(i);return o?o.findOnPath_(mt(t),vt(e,i),n):null},t.prototype.foreachOnPath=function(t,e){return this.foreachOnPath_(t,dt(),e)},t.prototype.foreachOnPath_=function(e,n,r){if(bt(e))return this;this.value&&r(n,this.value);var i=pt(e),o=this.children.get(i);return o?o.foreachOnPath_(mt(e),vt(n,i),r):new t(null)},t.prototype.foreach=function(t){this.foreach_(dt(),t)},t.prototype.foreach_=function(t,e){this.children.inorderTraversal(function(n,r){r.foreach_(vt(t,n),e)}),this.value&&e(t,this.value)},t.prototype.foreachChild=function(t){this.children.inorderTraversal(function(e,n){n.value&&t(e,n.value)})},t}(),Ye=function(){function t(t){this.writeTree_=t}return t.empty=function(){return new t(new Xe(null))},t}();function Qe(t,e,n){if(bt(e))return new Ye(new Xe(n));var r=t.writeTree_.findRootMostValueAndPath(e);if(null!=r){var i=r.path,o=r.value,s=xt(i,e);return o=o.updateChild(s,n),new Ye(t.writeTree_.set(i,o))}var a=new Xe(n),c=t.writeTree_.setTree(e,a);return new Ye(c)}function Je(t,e,n){var r=t;return N(n,function(t,n){r=Qe(r,vt(e,t),n)}),r}function tn(t,e){if(bt(e))return Ye.empty();var n=t.writeTree_.setTree(e,new Xe(null));return new Ye(n)}function en(t,e){return null!=nn(t,e)}function nn(t,e){var n=t.writeTree_.findRootMostValueAndPath(e);return null!=n?t.writeTree_.get(n.path).getChild(xt(n.path,e)):null}function rn(t){var e=[],n=t.writeTree_.value;return null!=n?n.isLeafNode()||n.forEachChild(Yt,function(t,n){e.push(new Dt(t,n))}):t.writeTree_.children.inorderTraversal(function(t,n){null!=n.value&&e.push(new Dt(t,n.value))}),e}function on(t,e){if(bt(e))return t;var n=nn(t,e);return new Ye(null!=n?new Xe(n):t.writeTree_.subtree(e))}function sn(t){return t.writeTree_.isEmpty()}function an(t,e){return cn(dt(),t.writeTree_,e)}function cn(t,e,n){if(null!=e.value)return n.updateChild(t,e.value);var r=null;return e.children.inorderTraversal(function(e,o){".priority"===e?(Object(i.e)(null!==o.value,"Priority writes must always be leaf nodes"),r=o.value):n=cn(vt(t,e),o,n)}),n.getChild(t).isEmpty()||null===r||(n=n.updateChild(vt(t,".priority"),r)),n}function ln(t,e){return bn(e,t)}function un(t,e){if(t.snap)return Ct(t.path,e);for(var n in t.children)if(t.children.hasOwnProperty(n)&&Ct(vt(t.path,n),e))return!0;return!1}function hn(t){return t.visible}function dn(t,e,n){for(var r=Ye.empty(),o=0;o<t.length;++o){var s=t[o];if(e(s)){var a=s.path,c=void 0;if(s.snap)Ct(n,a)?r=Qe(r,c=xt(n,a),s.snap):Ct(a,n)&&(c=xt(a,n),r=Qe(r,dt(),s.snap.getChild(c)));else{if(!s.children)throw Object(i.f)("WriteRecord should have .snap or .children");if(Ct(n,a))r=Je(r,c=xt(n,a),s.children);else if(Ct(a,n))if(bt(c=xt(a,n)))r=Je(r,dt(),s.children);else{var l=Object(i.G)(s.children,pt(c));if(l){var u=l.getChild(mt(c));r=Qe(r,dt(),u)}}}}}return r}function pn(t,e,n,r,i){if(r||i){var o=on(t.visibleWrites,e);return!i&&sn(o)?n:i||null!=n||en(o,dt())?an(dn(t.allWrites,function(t){return(t.visible||i)&&(!r||!~r.indexOf(t.writeId))&&(Ct(t.path,e)||Ct(e,t.path))},e),n||re.EMPTY_NODE):null}var s=nn(t.visibleWrites,e);if(null!=s)return s;var a=on(t.visibleWrites,e);return sn(a)?n:null!=n||en(a,dt())?an(a,n||re.EMPTY_NODE):null}function fn(t,e,n,r){return pn(t.writeTree,t.treePath,e,n,r)}function mn(t,e){return function(t,e,n){var r=re.EMPTY_NODE,i=nn(t.visibleWrites,e);if(i)return i.isLeafNode()||i.forEachChild(Yt,function(t,e){r=r.updateImmediateChild(t,e)}),r;if(n){var o=on(t.visibleWrites,e);return n.forEachChild(Yt,function(t,e){var n=an(on(o,new ht(t)),e);r=r.updateImmediateChild(t,n)}),rn(o).forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}return rn(on(t.visibleWrites,e)).forEach(function(t){r=r.updateImmediateChild(t.name,t.node)}),r}(t.writeTree,t.treePath,e)}function gn(t,e,n,r){return function(t,e,n,r,o){Object(i.e)(r||o,"Either existingEventSnap or existingServerSnap must exist");var s=vt(e,n);if(en(t.visibleWrites,s))return null;var a=on(t.visibleWrites,s);return sn(a)?o.getChild(n):an(a,o.getChild(n))}(t.writeTree,t.treePath,e,n,r)}function _n(t,e){return function(t,e){return nn(t.visibleWrites,e)}(t.writeTree,vt(t.treePath,e))}function yn(t,e,n){return function(t,e,n,r){var i=vt(e,n),o=nn(t.visibleWrites,i);return null!=o?o:r.isCompleteForChild(n)?an(on(t.visibleWrites,i),r.getNode().getImmediateChild(n)):null}(t.writeTree,t.treePath,e,n)}function vn(t,e){return bn(vt(t.treePath,e),t.writeTree)}function bn(t,e){return{treePath:t,writeTree:e}}var xn=function(){function t(){this.changeMap=new Map}return t.prototype.trackChildChange=function(t){var e=t.type,n=t.childName;Object(i.e)("child_added"===e||"child_changed"===e||"child_removed"===e,"Only child changes supported for tracking"),Object(i.e)(".priority"!==n,"Only non-priority child changes can be tracked.");var r=this.changeMap.get(n);if(r){var o=r.type;if("child_added"===e&&"child_removed"===o)this.changeMap.set(n,_e(n,t.snapshotNode,r.snapshotNode));else if("child_removed"===e&&"child_added"===o)this.changeMap.delete(n);else if("child_removed"===e&&"child_changed"===o)this.changeMap.set(n,ge(n,r.oldSnap));else if("child_changed"===e&&"child_added"===o)this.changeMap.set(n,me(n,t.snapshotNode));else{if("child_changed"!==e||"child_changed"!==o)throw Object(i.f)("Illegal combination of changes: "+t+" occurred after "+r);this.changeMap.set(n,_e(n,t.snapshotNode,r.oldSnap))}}else this.changeMap.set(n,t)},t.prototype.getChanges=function(){return Array.from(this.changeMap.values())},t}(),wn=new(function(){function t(){}return t.prototype.getCompleteChild=function(t){return null},t.prototype.getChildAfterChild=function(t,e,n){return null},t}()),Tn=function(){function t(t,e,n){void 0===n&&(n=null),this.writes_=t,this.viewCache_=e,this.optCompleteServerCache_=n}return t.prototype.getCompleteChild=function(t){var e=this.viewCache_.eventCache;if(e.isCompleteForChild(t))return e.getNode().getImmediateChild(t);var n=null!=this.optCompleteServerCache_?new Ve(this.optCompleteServerCache_,!0,!1):this.viewCache_.serverCache;return yn(this.writes_,t,n)},t.prototype.getChildAfterChild=function(t,e,n){var r=null!=this.optCompleteServerCache_?this.optCompleteServerCache_:Ke(this.viewCache_),i=function(t,e,n,r,i,o){return function(t,e,n,r,i,o,s){var a,c=on(t.visibleWrites,e),l=nn(c,dt());if(null!=l)a=l;else{if(null==n)return[];a=an(c,n)}if((a=a.withIndex(s)).isEmpty()||a.isLeafNode())return[];for(var u=[],h=s.getCompare(),d=o?a.getReverseIteratorFrom(r,s):a.getIteratorFrom(r,s),p=d.getNext();p&&u.length<1;)0!==h(p,r)&&u.push(p),p=d.getNext();return u}(t.writeTree,t.treePath,e,n,0,i,o)}(this.writes_,r,e,0,n,t);return 0===i.length?null:i[0]},t}();function Cn(t,e,n,r,o,s){var a=e.eventCache;if(null!=_n(r,n))return e;var c=void 0,l=void 0;if(bt(n))if(Object(i.e)(e.serverCache.isFullyInitialized(),"If change path is empty, we must have complete server data"),e.serverCache.isFiltered()){var u=Ke(e),h=mn(r,u instanceof re?u:re.EMPTY_NODE);c=t.filter.updateFullNode(e.eventCache.getNode(),h,s)}else{var d=fn(r,Ke(e));c=t.filter.updateFullNode(e.eventCache.getNode(),d,s)}else{var p=pt(n);if(".priority"===p){Object(i.e)(1===ft(n),"Can't have a priority with additional path components");var f=a.getNode(),m=gn(r,n,f,l=e.serverCache.getNode());c=null!=m?t.filter.updatePriority(f,m):a.getNode()}else{var g=mt(n),_=void 0;if(a.isCompleteForChild(p)){l=e.serverCache.getNode();var y=gn(r,n,a.getNode(),l);_=null!=y?a.getNode().getImmediateChild(p).updateChild(g,y):a.getNode().getImmediateChild(p)}else _=yn(r,p,e.serverCache);c=null!=_?t.filter.updateChild(a.getNode(),p,_,g,o,s):a.getNode()}}return We(e,c,a.isFullyInitialized()||bt(n),t.filter.filtersNodes())}function En(t,e,n,r,i,o,s,a){var c,l=e.serverCache,u=s?t.filter:t.filter.getIndexedFilter();if(bt(n))c=u.updateFullNode(l.getNode(),r,null);else if(u.filtersNodes()&&!l.isFiltered()){var h=l.getNode().updateChild(n,r);c=u.updateFullNode(l.getNode(),h,null)}else{var d=pt(n);if(!l.isCompleteForPath(n)&&ft(n)>1)return e;var p=mt(n),f=l.getNode().getImmediateChild(d).updateChild(p,r);c=".priority"===d?u.updatePriority(l.getNode(),f):u.updateChild(l.getNode(),d,f,p,wn,null)}var m=He(e,c,l.isFullyInitialized()||bt(n),u.filtersNodes());return Cn(t,m,n,i,new Tn(i,m,o),a)}function Sn(t,e,n,r,i,o,s){var a,c,l=e.eventCache,u=new Tn(i,e,o);if(bt(n))c=t.filter.updateFullNode(e.eventCache.getNode(),r,s),a=We(e,c,!0,t.filter.filtersNodes());else{var h=pt(n);if(".priority"===h)c=t.filter.updatePriority(e.eventCache.getNode(),r),a=We(e,c,l.isFullyInitialized(),l.isFiltered());else{var d=mt(n),p=l.getNode().getImmediateChild(h),f=void 0;if(bt(d))f=r;else{var m=u.getCompleteChild(h);f=null!=m?".priority"===gt(d)&&m.getChild(yt(d)).isEmpty()?m:m.updateChild(d,r):re.EMPTY_NODE}a=p.equals(f)?e:We(e,t.filter.updateChild(l.getNode(),h,f,d,u,s),l.isFullyInitialized(),t.filter.filtersNodes())}}return a}function In(t,e){return t.eventCache.isCompleteForChild(e)}function kn(t,e,n){return n.foreach(function(t,n){e=e.updateChild(t,n)}),e}function An(t,e,n,r,i,o,s,a){if(e.serverCache.getNode().isEmpty()&&!e.serverCache.isFullyInitialized())return e;var c,l=e;c=bt(n)?r:new Xe(null).setTree(n,r);var u=e.serverCache.getNode();return c.children.inorderTraversal(function(n,r){if(u.hasChild(n)){var c=kn(0,e.serverCache.getNode().getImmediateChild(n),r);l=En(t,l,new ht(n),c,i,o,s,a)}}),c.children.inorderTraversal(function(n,r){var c=!e.serverCache.isCompleteForChild(n)&&void 0===r.value;if(!u.hasChild(n)&&!c){var h=kn(0,e.serverCache.getNode().getImmediateChild(n),r);l=En(t,l,new ht(n),h,i,o,s,a)}}),l}var Mn,On=function(){function t(t,e){this.query_=t,this.eventRegistrations_=[];var n,r=this.query_._queryParams,i=new ye(r.getIndex()),o=(n=r).loadsAllData()?new ye(n.getIndex()):n.hasLimit()?new be(n):new ve(n);this.processor_=function(t){return{filter:t}}(o);var s=e.serverCache,a=e.eventCache,c=i.updateFullNode(re.EMPTY_NODE,s.getNode(),null),l=o.updateFullNode(re.EMPTY_NODE,a.getNode(),null),u=new Ve(c,s.isFullyInitialized(),i.filtersNodes()),h=new Ve(l,a.isFullyInitialized(),o.filtersNodes());this.viewCache_=$e(h,u),this.eventGenerator_=new qe(this.query_)}return Object.defineProperty(t.prototype,"query",{get:function(){return this.query_},enumerable:!1,configurable:!0}),t}();function Pn(t,e){var n=Ke(t.viewCache_);return n&&(t.query._queryParams.loadsAllData()||!bt(e)&&!n.getImmediateChild(pt(e)).isEmpty())?n.getChild(e):null}function Dn(t){return 0===t.eventRegistrations_.length}function Rn(t,e,n){var r=[];if(n){Object(i.e)(null==e,"A cancel should cancel all event registrations.");var o=t.query._path;t.eventRegistrations_.forEach(function(t){var e=t.createCancelEvent(n,o);e&&r.push(e)})}if(e){for(var s=[],a=0;a<t.eventRegistrations_.length;++a){var c=t.eventRegistrations_[a];if(c.matches(e)){if(e.hasAnyCallback()){s=s.concat(t.eventRegistrations_.slice(a+1));break}}else s.push(c)}t.eventRegistrations_=s}else t.eventRegistrations_=[];return r}function Nn(t,e,n,r){e.type===Ne.MERGE&&null!==e.source.queryId&&(Object(i.e)(Ke(t.viewCache_),"We should always have a full cache before handling merges"),Object(i.e)(Ze(t.viewCache_),"Missing event cache, even though we have a server cache"));var o,s,a=t.viewCache_,c=function(t,e,n,r,o){var s,a,c=new xn;if(n.type===Ne.OVERWRITE){var l=n;l.source.fromUser?s=Sn(t,e,l.path,l.snap,r,o,c):(Object(i.e)(l.source.fromServer,"Unknown source."),a=l.source.tagged||e.serverCache.isFiltered()&&!bt(l.path),s=En(t,e,l.path,l.snap,r,o,a,c))}else if(n.type===Ne.MERGE){var u=n;u.source.fromUser?s=function(t,e,n,r,i,o,s){var a=e;return r.foreach(function(r,c){var l=vt(n,r);In(e,pt(l))&&(a=Sn(t,a,l,c,i,o,s))}),r.foreach(function(r,c){var l=vt(n,r);In(e,pt(l))||(a=Sn(t,a,l,c,i,o,s))}),a}(t,e,u.path,u.children,r,o,c):(Object(i.e)(u.source.fromServer,"Unknown source."),a=u.source.tagged||e.serverCache.isFiltered(),s=An(t,e,u.path,u.children,r,o,a,c))}else if(n.type===Ne.ACK_USER_WRITE){var h=n;s=h.revert?function(t,e,n,r,o,s){var a;if(null!=_n(r,n))return e;var c=new Tn(r,e,o),l=e.eventCache.getNode(),u=void 0;if(bt(n)||".priority"===pt(n)){var h=void 0;if(e.serverCache.isFullyInitialized())h=fn(r,Ke(e));else{var d=e.serverCache.getNode();Object(i.e)(d instanceof re,"serverChildren would be complete if leaf node"),h=mn(r,d)}u=t.filter.updateFullNode(l,h=h,s)}else{var p=pt(n),f=yn(r,p,e.serverCache);null==f&&e.serverCache.isCompleteForChild(p)&&(f=l.getImmediateChild(p)),(u=null!=f?t.filter.updateChild(l,p,f,mt(n),c,s):e.eventCache.getNode().hasChild(p)?t.filter.updateChild(l,p,re.EMPTY_NODE,mt(n),c,s):l).isEmpty()&&e.serverCache.isFullyInitialized()&&(a=fn(r,Ke(e))).isLeafNode()&&(u=t.filter.updateFullNode(u,a,s))}return a=e.serverCache.isFullyInitialized()||null!=_n(r,dt()),We(e,u,a,t.filter.filtersNodes())}(t,e,h.path,r,o,c):function(t,e,n,r,i,o,s){if(null!=_n(i,n))return e;var a=e.serverCache.isFiltered(),c=e.serverCache;if(null!=r.value){if(bt(n)&&c.isFullyInitialized()||c.isCompleteForPath(n))return En(t,e,n,c.getNode().getChild(n),i,o,a,s);if(bt(n)){var l=new Xe(null);return c.getNode().forEachChild(Lt,function(t,e){l=l.set(new ht(t),e)}),An(t,e,n,l,i,o,a,s)}return e}var u=new Xe(null);return r.foreach(function(t,e){var r=vt(n,t);c.isCompleteForPath(r)&&(u=u.set(t,c.getNode().getChild(r)))}),An(t,e,n,u,i,o,a,s)}(t,e,h.path,h.affectedTree,r,o,c)}else{if(n.type!==Ne.LISTEN_COMPLETE)throw Object(i.f)("Unknown operation type: "+n.type);s=function(t,e,n,r,i){var o=e.serverCache;return Cn(t,He(e,o.getNode(),o.isFullyInitialized()||bt(n),o.isFiltered()),n,r,wn,i)}(t,e,n.path,r,c)}var d=c.getChanges();return function(t,e,n){var r=e.eventCache;if(r.isFullyInitialized()){var i=r.getNode().isLeafNode()||r.getNode().isEmpty(),o=Ze(t);(n.length>0||!t.eventCache.isFullyInitialized()||i&&!r.getNode().equals(o)||!r.getNode().getPriority().equals(o.getPriority()))&&n.push(fe(Ze(e)))}}(e,s,d),{viewCache:s,changes:d}}(t.processor_,a,e,n,r);return o=t.processor_,s=c.viewCache,Object(i.e)(s.eventCache.getNode().isIndexed(o.filter.getIndex()),"Event snap not indexed"),Object(i.e)(s.serverCache.getNode().isIndexed(o.filter.getIndex()),"Server snap not indexed"),Object(i.e)(c.viewCache.serverCache.isFullyInitialized()||!a.serverCache.isFullyInitialized(),"Once a server snap is complete, it should never go back"),t.viewCache_=c.viewCache,Ln(t,c.changes,c.viewCache.eventCache.getNode(),null)}function Ln(t,e,n,r){return function(t,e,n,r){var i=[],o=[];return e.forEach(function(e){"child_changed"===e.type&&t.index_.indexedValueChanged(e.oldSnap,e.snapshotNode)&&o.push({type:"child_moved",snapshotNode:e.snapshotNode,childName:e.childName})}),Ge(t,i,"child_removed",e,r,n),Ge(t,i,"child_added",e,r,n),Ge(t,i,"child_moved",o,r,n),Ge(t,i,"child_changed",e,r,n),Ge(t,i,"value",e,r,n),i}(t.eventGenerator_,e,n,r?[r]:t.eventRegistrations_)}var jn,zn=function(){return function(){this.views=new Map}}();function Fn(t,e,n,r){var s,a,c=e.source.queryId;if(null!==c){var l=t.views.get(c);return Object(i.e)(null!=l,"SyncTree gave us an op for an invalid query."),Nn(l,e,n,r)}var u=[];try{for(var h=Object(o.g)(t.views.values()),d=h.next();!d.done;d=h.next())u=u.concat(Nn(l=d.value,e,n,r))}catch(p){s={error:p}}finally{try{d&&!d.done&&(a=h.return)&&a.call(h)}finally{if(s)throw s.error}}return u}function Bn(t,e,n,r,i){var o=t.views.get(e._queryIdentifier);if(!o){var s=fn(n,i?r:null),a=!1;s?a=!0:r instanceof re?(s=mn(n,r),a=!1):(s=re.EMPTY_NODE,a=!1);var c=$e(new Ve(s,a,!1),new Ve(r,i,!1));return new On(e,c)}return o}function Un(t){var e,n,r=[];try{for(var i=Object(o.g)(t.views.values()),s=i.next();!s.done;s=i.next()){var a=s.value;a.query._queryParams.loadsAllData()||r.push(a)}}catch(c){e={error:c}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}function Vn(t,e){var n,r,i=null;try{for(var s=Object(o.g)(t.views.values()),a=s.next();!a.done;a=s.next())i=i||Pn(a.value,e)}catch(c){n={error:c}}finally{try{a&&!a.done&&(r=s.return)&&r.call(s)}finally{if(n)throw n.error}}return i}function qn(t,e){return e._queryParams.loadsAllData()?Wn(t):t.views.get(e._queryIdentifier)}function Gn(t,e){return null!=qn(t,e)}function $n(t){return null!=Wn(t)}function Wn(t){var e,n;try{for(var r=Object(o.g)(t.views.values()),i=r.next();!i.done;i=r.next()){var s=i.value;if(s.query._queryParams.loadsAllData())return s}}catch(a){e={error:a}}finally{try{i&&!i.done&&(n=r.return)&&n.call(r)}finally{if(e)throw e.error}}return null}var Hn=1,Zn=function(){return function(t){this.listenProvider_=t,this.syncPointTree_=new Xe(null),this.pendingWriteTree_={visibleWrites:Ye.empty(),allWrites:[],lastWriteId:-1},this.tagToQueryMap=new Map,this.queryToTagMap=new Map}}();function Kn(t,e,n,r,o){return function(t,e,n,r,o){Object(i.e)(r>t.lastWriteId,"Stacking an older write on top of newer ones"),void 0===o&&(o=!0),t.allWrites.push({path:e,snap:n,writeId:r,visible:o}),o&&(t.visibleWrites=Qe(t.visibleWrites,e,n)),t.lastWriteId=r}(t.pendingWriteTree_,e,n,r,o),o?er(t,new Be({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,n)):[]}function Xn(t,e,n){void 0===n&&(n=!1);var r=function(t,e){for(var n=0;n<t.allWrites.length;n++){var r=t.allWrites[n];if(r.writeId===e)return r}return null}(t.pendingWriteTree_,e);if(function(t,e){var n=t.allWrites.findIndex(function(t){return t.writeId===e});Object(i.e)(n>=0,"removeWrite called with nonexistent writeId.");var r=t.allWrites[n];t.allWrites.splice(n,1);for(var o=r.visible,s=!1,a=t.allWrites.length-1;o&&a>=0;){var c=t.allWrites[a];c.visible&&(a>=n&&un(c,r.path)?o=!1:Ct(r.path,c.path)&&(s=!0)),a--}return!!o&&(s?(function(t){t.visibleWrites=dn(t.allWrites,hn,dt()),t.lastWriteId=t.allWrites.length>0?t.allWrites[t.allWrites.length-1].writeId:-1}(t),!0):(r.snap?t.visibleWrites=tn(t.visibleWrites,r.path):N(r.children,function(e){t.visibleWrites=tn(t.visibleWrites,vt(r.path,e))}),!0))}(t.pendingWriteTree_,e)){var o=new Xe(null);return null!=r.snap?o=o.set(dt(),!0):N(r.children,function(t){o=o.set(new ht(t),!0)}),er(t,new ze(r.path,o,n))}return[]}function Yn(t,e,n){return er(t,new Be({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,n))}function Qn(t,e,n,r){var s=e._path,a=t.syncPointTree_.get(s),c=[];if(a&&("default"===e._queryIdentifier||Gn(a,e))){var l=function(t,e,n,r){var s,a,c=e._queryIdentifier,l=[],u=[],h=$n(t);if("default"===c)try{for(var d=Object(o.g)(t.views.entries()),p=d.next();!p.done;p=d.next()){var f,m=Object(o.e)(p.value,2),g=m[0];u=u.concat(Rn(f=m[1],n,r)),Dn(f)&&(t.views.delete(g),f.query._queryParams.loadsAllData()||l.push(f.query))}}catch(_){s={error:_}}finally{try{p&&!p.done&&(a=d.return)&&a.call(d)}finally{if(s)throw s.error}}else(f=t.views.get(c))&&(u=u.concat(Rn(f,n,r)),Dn(f)&&(t.views.delete(c),f.query._queryParams.loadsAllData()||l.push(f.query)));return h&&!$n(t)&&l.push(new(Object(i.e)(Mn,"Reference.ts has not been loaded"),Mn)(e._repo,e._path)),{removed:l,events:u}}(a,e,n,r);0===a.views.size&&(t.syncPointTree_=t.syncPointTree_.remove(s));var u=l.removed;c=l.events;var h=-1!==u.findIndex(function(t){return t._queryParams.loadsAllData()}),d=t.syncPointTree_.findOnPath(s,function(t,e){return $n(e)});if(h&&!d){var p=t.syncPointTree_.subtree(s);if(!p.isEmpty())for(var f=function(t){return t.fold(function(t,e,n){if(e&&$n(e))return[Wn(e)];var r=[];return e&&(r=Un(e)),N(n,function(t,e){r=r.concat(e)}),r})}(p),m=0;m<f.length;++m){var g=f[m],_=g.query,y=ir(t,g);t.listenProvider_.startListening(ur(_),or(t,_),y.hashFn,y.onComplete)}}!d&&u.length>0&&!r&&(h?t.listenProvider_.stopListening(ur(e),null):u.forEach(function(e){var n=t.queryToTagMap.get(sr(e));t.listenProvider_.stopListening(ur(e),n)})),function(t,e){for(var n=0;n<e.length;++n){var r=e[n];if(!r._queryParams.loadsAllData()){var i=sr(r),o=t.queryToTagMap.get(i);t.queryToTagMap.delete(i),t.tagToQueryMap.delete(o)}}}(t,u)}return c}function Jn(t,e,n){var r=e._path,o=null,s=!1;t.syncPointTree_.foreachOnPath(r,function(t,e){var n=xt(t,r);o=o||Vn(e,n),s=s||$n(e)});var a,c=t.syncPointTree_.get(r);c?(s=s||$n(c),o=o||Vn(c,dt())):(c=new zn,t.syncPointTree_=t.syncPointTree_.set(r,c)),null!=o?a=!0:(a=!1,o=re.EMPTY_NODE,t.syncPointTree_.subtree(r).foreachChild(function(t,e){var n=Vn(e,dt());n&&(o=o.updateImmediateChild(t,n))}));var l=Gn(c,e);if(!l&&!e._queryParams.loadsAllData()){var u=sr(e);Object(i.e)(!t.queryToTagMap.has(u),"View does not exist, but we have a tag");var h=Hn++;t.queryToTagMap.set(u,h),t.tagToQueryMap.set(h,u)}var d=function(t,e,n,r,i,o){var s=Bn(t,e,r,i,o);return t.views.has(e._queryIdentifier)||t.views.set(e._queryIdentifier,s),function(t,e){t.eventRegistrations_.push(e)}(s,n),function(t,e){var n=t.viewCache_.eventCache,r=[];return n.getNode().isLeafNode()||n.getNode().forEachChild(Yt,function(t,e){r.push(me(t,e))}),n.isFullyInitialized()&&r.push(fe(n.getNode())),Ln(t,r,n.getNode(),e)}(s,n)}(c,e,n,ln(t.pendingWriteTree_,r),o,a);if(!l&&!s){var p=qn(c,e);d=d.concat(function(t,e,n){var r=e._path,o=or(t,e),s=ir(t,n),a=t.listenProvider_.startListening(ur(e),o,s.hashFn,s.onComplete),c=t.syncPointTree_.subtree(r);if(o)Object(i.e)(!$n(c.value),"If we're adding a query, it shouldn't be shadowed");else for(var l=c.fold(function(t,e,n){if(!bt(t)&&e&&$n(e))return[Wn(e).query];var r=[];return e&&(r=r.concat(Un(e).map(function(t){return t.query}))),N(n,function(t,e){r=r.concat(e)}),r}),u=0;u<l.length;++u){var h=l[u];t.listenProvider_.stopListening(ur(h),or(t,h))}return a}(t,e,p))}return d}function tr(t,e,n){var r=t.pendingWriteTree_,i=t.syncPointTree_.findOnPath(e,function(t,n){var r=Vn(n,xt(t,e));if(r)return r});return pn(r,e,i,n,!0)}function er(t,e){return nr(e,t.syncPointTree_,null,ln(t.pendingWriteTree_,dt()))}function nr(t,e,n,r){if(bt(t.path))return rr(t,e,n,r);var i=e.get(dt());null==n&&null!=i&&(n=Vn(i,dt()));var o=[],s=pt(t.path),a=t.operationForChild(s),c=e.children.get(s);if(c&&a){var l=n?n.getImmediateChild(s):null,u=vn(r,s);o=o.concat(nr(a,c,l,u))}return i&&(o=o.concat(Fn(i,t,r,n))),o}function rr(t,e,n,r){var i=e.get(dt());null==n&&null!=i&&(n=Vn(i,dt()));var o=[];return e.children.inorderTraversal(function(e,i){var s=n?n.getImmediateChild(e):null,a=vn(r,e),c=t.operationForChild(e);c&&(o=o.concat(rr(c,i,s,a)))}),i&&(o=o.concat(Fn(i,t,r,n))),o}function ir(t,e){var n=e.query,r=or(t,n);return{hashFn:function(){return(function(t){return t.viewCache_.serverCache.getNode()}(e)||re.EMPTY_NODE).hash()},onComplete:function(e){if("ok"===e)return r?function(t,e,n){var r=ar(t,n);if(r){var i=cr(r),o=i.path,s=i.queryId,a=xt(o,e);return lr(t,o,new Fe(Le(s),a))}return[]}(t,n._path,r):function(t,e){return er(t,new Fe({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e))}(t,n._path);var i=function(t,e){var n="Unknown Error";"too_big"===t?n="The data requested exceeds the maximum size that can be accessed with a single request.":"permission_denied"===t?n="Client doesn't have permission to access the desired data.":"unavailable"===t&&(n="The service is unavailable");var r=new Error(t+" at "+e._path.toString()+": "+n);return r.code=t.toUpperCase(),r}(e,n);return Qn(t,n,null,i)}}}function or(t,e){var n=sr(e);return t.queryToTagMap.get(n)}function sr(t){return t._path.toString()+"$"+t._queryIdentifier}function ar(t,e){return t.tagToQueryMap.get(e)}function cr(t){var e=t.indexOf("$");return Object(i.e)(-1!==e&&e<t.length-1,"Bad queryKey."),{queryId:t.substr(e+1),path:new ht(t.substr(0,e))}}function lr(t,e,n){var r=t.syncPointTree_.get(e);return Object(i.e)(r,"Missing sync point for query tag that we're tracking"),Fn(r,n,ln(t.pendingWriteTree_,e),null)}function ur(t){return t._queryParams.loadsAllData()&&!t._queryParams.isDefault()?new(Object(i.e)(jn,"Reference.ts has not been loaded"),jn)(t._repo,t._path):t}var hr=function(){function t(t){this.node_=t}return t.prototype.getImmediateChild=function(e){return new t(this.node_.getImmediateChild(e))},t.prototype.node=function(){return this.node_},t}(),dr=function(){function t(t,e){this.syncTree_=t,this.path_=e}return t.prototype.getImmediateChild=function(e){var n=vt(this.path_,e);return new t(this.syncTree_,n)},t.prototype.node=function(){return tr(this.syncTree_,this.path_)},t}(),pr=function(t,e,n){return t&&"object"==typeof t?(Object(i.e)(".sv"in t,"Unexpected leaf node or priority contents"),"string"==typeof t[".sv"]?fr(t[".sv"],e,n):"object"==typeof t[".sv"]?mr(t[".sv"],e):void Object(i.e)(!1,"Unexpected server value: "+JSON.stringify(t,null,2))):t},fr=function(t,e,n){switch(t){case"timestamp":return n.timestamp;default:Object(i.e)(!1,"Unexpected server value: "+t)}},mr=function(t,e,n){t.hasOwnProperty("increment")||Object(i.e)(!1,"Unexpected server value: "+JSON.stringify(t,null,2));var r=t.increment;"number"!=typeof r&&Object(i.e)(!1,"Unexpected increment value: "+r);var o=e.node();if(Object(i.e)(null!=o,"Expected ChildrenNode.EMPTY_NODE for nulls"),!o.isLeafNode())return r;var s=o.getValue();return"number"!=typeof s?r:s+r},gr=function(t,e,n,r){return yr(e,new dr(n,t),r)},_r=function(t,e,n){return yr(t,new hr(e),n)};function yr(t,e,n){var r,i=t.getPriority().val(),o=pr(i,e.getImmediateChild(".priority"),n);if(t.isLeafNode()){var s=t,a=pr(s.getValue(),e,n);return a!==s.getValue()||o!==s.getPriority().val()?new Xt(a,oe(o)):t}var c=t;return r=c,o!==c.getPriority().val()&&(r=r.updatePriority(new Xt(o))),c.forEachChild(Yt,function(t,i){var o=yr(i,e.getImmediateChild(t),n);o!==i&&(r=r.updateImmediateChild(t,o))}),r}var vr=function(){return function(t,e,n){void 0===t&&(t=""),void 0===e&&(e=null),void 0===n&&(n={children:{},childCount:0}),this.name=t,this.parent=e,this.node=n}}();function br(t,e){for(var n=e instanceof ht?e:new ht(e),r=t,o=pt(n);null!==o;){var s=Object(i.G)(r.node.children,o)||{children:{},childCount:0};r=new vr(o,r,s),o=pt(n=mt(n))}return r}function xr(t){return t.node.value}function wr(t,e){t.node.value=e,Ir(t)}function Tr(t){return t.node.childCount>0}function Cr(t,e){N(t.node.children,function(n,r){e(new vr(n,t,r))})}function Er(t,e,n,r){n&&!r&&e(t),Cr(t,function(t){Er(t,e,!0,r)}),n&&r&&e(t)}function Sr(t){return new ht(null===t.parent?t.name:Sr(t.parent)+"/"+t.name)}function Ir(t){null!==t.parent&&function(t,e,n){var r=function(t){return void 0===xr(t)&&!Tr(t)}(n),o=Object(i.i)(t.node.children,e);r&&o?(delete t.node.children[e],t.node.childCount--,Ir(t)):r||o||(t.node.children[e]=n.node,t.node.childCount++,Ir(t))}(t.parent,t.name,t)}var kr=/[\[\].#$\/\u0000-\u001F\u007F]/,Ar=/[\[\].#$\u0000-\u001F\u007F]/,Mr=10485760,Or=function(t){return"string"==typeof t&&0!==t.length&&!kr.test(t)},Pr=function(t){return"string"==typeof t&&0!==t.length&&!Ar.test(t)},Dr=function(t){return null===t||"string"==typeof t||"number"==typeof t&&!I(t)||t&&"object"==typeof t&&Object(i.i)(t,".sv")},Rr=function(t,e,n,r){r&&void 0===e||Nr(Object(i.n)(t,"value"),e,n)},Nr=function(t,e,n){var r=n instanceof ht?new Et(n,t):n;if(void 0===e)throw new Error(t+"contains undefined "+It(r));if("function"==typeof e)throw new Error(t+"contains a function "+It(r)+" with contents = "+e.toString());if(I(e))throw new Error(t+"contains "+e.toString()+" "+It(r));if("string"==typeof e&&e.length>Mr/3&&Object(i.H)(e)>Mr)throw new Error(t+"contains a string greater than 10485760 utf8 bytes "+It(r)+" ('"+e.substring(0,50)+"...')");if(e&&"object"==typeof e){var o=!1,s=!1;if(N(e,function(e,n){if(".value"===e)o=!0;else if(".priority"!==e&&".sv"!==e&&(s=!0,!Or(e)))throw new Error(t+" contains an invalid key ("+e+") "+It(r)+'.  Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');var a,c;!function(t,e){t.parts_.length>0&&(t.byteLength_+=1),t.parts_.push(e),t.byteLength_+=Object(i.H)(e),St(t)}(r,e),Nr(t,n,r),c=(a=r).parts_.pop(),a.byteLength_-=Object(i.H)(c),a.parts_.length>0&&(a.byteLength_-=1)}),o&&s)throw new Error(t+' contains ".value" child '+It(r)+" in addition to actual children.")}},Lr=function(t,e,n,r){if(!r||void 0!==e){var o=Object(i.n)(t,"values");if(!e||"object"!=typeof e||Array.isArray(e))throw new Error(o+" must be an object containing the children to replace.");var s=[];N(e,function(t,e){var r=new ht(t);if(Nr(o,e,vt(n,r)),".priority"===gt(r)&&!Dr(e))throw new Error(o+"contains an invalid value for '"+r.toString()+"', which must be a valid Firebase priority (a string, finite number, server value, or null).");s.push(r)}),function(t,e){var n,r;for(n=0;n<e.length;n++)for(var i=_t(r=e[n]),o=0;o<i.length;o++)if(".priority"===i[o]&&o===i.length-1);else if(!Or(i[o]))throw new Error(t+"contains an invalid key ("+i[o]+") in path "+r.toString()+'. Keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]"');e.sort(wt);var s=null;for(n=0;n<e.length;n++){if(r=e[n],null!==s&&Ct(s,r))throw new Error(t+"contains a path "+s.toString()+" that is ancestor of another path "+r.toString());s=r}}(o,s)}},jr=function(t,e,n){if(!n||void 0!==e){if(I(e))throw new Error(Object(i.n)(t,"priority")+"is "+e.toString()+", but must be a valid Firebase priority (a string, finite number, server value, or null).");if(!Dr(e))throw new Error(Object(i.n)(t,"priority")+"must be a valid Firebase priority (a string, finite number, server value, or null).")}},zr=function(t,e,n){if(!n||void 0!==e)switch(e){case"value":case"child_added":case"child_removed":case"child_changed":case"child_moved":break;default:throw new Error(Object(i.n)(t,"eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},Fr=function(t,e,n,r){if(!(r&&void 0===n||Or(n)))throw new Error(Object(i.n)(t,e)+'was an invalid key = "'+n+'".  Firebase keys must be non-empty strings and can\'t contain ".", "#", "$", "/", "[", or "]").')},Br=function(t,e,n,r){if(!(r&&void 0===n||Pr(n)))throw new Error(Object(i.n)(t,e)+'was an invalid path = "'+n+'". Paths must be non-empty strings and can\'t contain ".", "#", "$", "[", or "]"')},Ur=function(t,e){if(".info"===pt(e))throw new Error(t+" failed = Can't modify data under /.info/")},Vr=function(t,e){var n=e.path.toString();if("string"!=typeof e.repoInfo.host||0===e.repoInfo.host.length||!Or(e.repoInfo.namespace)&&"localhost"!==e.repoInfo.host.split(":")[0]||0!==n.length&&!function(t){return t&&(t=t.replace(/^\/*\.info(\/|$)/,"/")),Pr(t)}(n))throw new Error(Object(i.n)(t,"url")+'must be a valid firebase URL and the path can\'t contain ".", "#", "$", "[", or "]".')},qr=function(t,e,n,r){if((!r||void 0!==n)&&"boolean"!=typeof n)throw new Error(Object(i.n)(t,e)+"must be a boolean.")},Gr=function(){return function(){this.eventLists_=[],this.recursionDepth_=0}}();function $r(t,e){for(var n=null,r=0;r<e.length;r++){var i=e[r],o=i.getPath();null===n||Tt(o,n.path)||(t.eventLists_.push(n),n=null),null===n&&(n={events:[],path:o}),n.events.push(i)}n&&t.eventLists_.push(n)}function Wr(t,e,n){$r(t,n),Zr(t,function(t){return Tt(t,e)})}function Hr(t,e,n){$r(t,n),Zr(t,function(t){return Ct(t,e)||Ct(e,t)})}function Zr(t,e){t.recursionDepth_++;for(var n=!0,r=0;r<t.eventLists_.length;r++){var i=t.eventLists_[r];i&&(e(i.path)?(Kr(t.eventLists_[r]),t.eventLists_[r]=null):n=!1)}n&&(t.eventLists_=[]),t.recursionDepth_--}function Kr(t){for(var e=0;e<t.events.length;e++){var n=t.events[e];if(null!==n){t.events[e]=null;var r=n.getEventRunner();v&&w("event: "+n.toString()),F(r)}}}var Xr="repo_interrupt",Yr=function(){function t(t,e,n,r){this.repoInfo_=t,this.forceRestClient_=e,this.authTokenProvider_=n,this.appCheckProvider_=r,this.dataUpdateCount=0,this.statsListener_=null,this.eventQueue_=new Gr,this.nextWriteId_=1,this.interceptServerDataCallback_=null,this.onDisconnect_=Ae(),this.transactionQueueTree_=new vr,this.persistentConnection_=null,this.key=this.repoInfo_.toURLString()}return t.prototype.toString=function(){return(this.repoInfo_.secure?"https://":"http://")+this.repoInfo_.host},t}();function Qr(t){var e=t.infoData_.getNode(new ht(".info/serverTimeOffset")).val()||0;return(new Date).getTime()+e}function Jr(t){return(e=(e={timestamp:Qr(t)})||{}).timestamp=e.timestamp||(new Date).getTime(),e;var e}function ti(t,e,n,r,o){t.dataUpdateCount++;var s=new ht(e);n=t.interceptServerDataCallback_?t.interceptServerDataCallback_(e,n):n;var a=[];if(o)if(r){var c=Object(i.E)(n,function(t){return oe(t)});a=function(t,e,n,r){var i=ar(t,r);if(i){var o=cr(i),s=o.path,a=o.queryId,c=xt(s,e),l=Xe.fromObject(n);return lr(t,s,new Ue(Le(a),c,l))}return[]}(t.serverSyncTree_,s,c,o)}else{var l=oe(n);a=function(t,e,n,r){var i=ar(t,r);if(null!=i){var o=cr(i),s=o.path,a=o.queryId,c=xt(s,e);return lr(t,s,new Be(Le(a),c,n))}return[]}(t.serverSyncTree_,s,l,o)}else if(r){var u=Object(i.E)(n,function(t){return oe(t)});a=function(t,e,n){var r=Xe.fromObject(n);return er(t,new Ue({fromUser:!1,fromServer:!0,queryId:null,tagged:!1},e,r))}(t.serverSyncTree_,s,u)}else{var h=oe(n);a=Yn(t.serverSyncTree_,s,h)}var d=s;a.length>0&&(d=pi(t,s)),Hr(t.eventQueue_,d,a)}function ei(t,e){ni(t,"connected",e),!1===e&&function(t){li(t,"onDisconnectEvents");var e=Jr(t),n=Ae();Pe(t.onDisconnect_,dt(),function(r,i){var o=gr(r,i,t.serverSyncTree_,e);Me(n,r,o)});var r=[];Pe(n,dt(),function(e,n){r=r.concat(Yn(t.serverSyncTree_,e,n));var i=yi(t,e);pi(t,i)}),t.onDisconnect_=Ae(),Hr(t.eventQueue_,dt(),r)}(t)}function ni(t,e,n){var r=new ht("/.info/"+e),i=oe(n);t.infoData_.updateSnapshot(r,i);var o=Yn(t.infoSyncTree_,r,i);Hr(t.eventQueue_,r,o)}function ri(t){return t.nextWriteId_++}function ii(t,e,n,r,i){li(t,"set",{path:e.toString(),value:n,priority:r});var o=Jr(t),s=oe(n,r),a=tr(t.serverSyncTree_,e),c=_r(s,a,o),l=ri(t),u=Kn(t.serverSyncTree_,e,c,l,!0);$r(t.eventQueue_,u),t.server_.put(e.toString(),s.val(!0),function(n,r){var o="ok"===n;o||S("set at "+e+" failed: "+n);var s=Xn(t.serverSyncTree_,l,!o);Hr(t.eventQueue_,e,s),ui(0,i,n,r)});var h=yi(t,e);pi(t,h),Hr(t.eventQueue_,h,[])}function oi(t,e,n){t.server_.onDisconnectCancel(e.toString(),function(r,i){"ok"===r&&Oe(t.onDisconnect_,e),ui(0,n,r,i)})}function si(t,e,n,r){var i=oe(n);t.server_.onDisconnectPut(e.toString(),i.val(!0),function(n,o){"ok"===n&&Me(t.onDisconnect_,e,i),ui(0,r,n,o)})}function ai(t,e,n){var r;r=".info"===pt(e._path)?Qn(t.infoSyncTree_,e,n):Qn(t.serverSyncTree_,e,n),Wr(t.eventQueue_,e._path,r)}function ci(t){t.persistentConnection_&&t.persistentConnection_.interrupt(Xr)}function li(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r="";t.persistentConnection_&&(r=t.persistentConnection_.id+":"),w.apply(void 0,Object(o.f)([r],Object(o.e)(e)))}function ui(t,e,n,r){e&&F(function(){if("ok"===n)e(null);else{var t=(n||"error").toUpperCase(),i=t;r&&(i+=": "+r);var o=new Error(i);o.code=t,e(o)}})}function hi(t,e,n){return tr(t.serverSyncTree_,e,n)||re.EMPTY_NODE}function di(t,e){if(void 0===e&&(e=t.transactionQueueTree_),e||_i(t,e),xr(e)){var n=mi(t,e);Object(i.e)(n.length>0,"Sending zero length transaction queue"),n.every(function(t){return 0===t.status})&&function(t,e,n){for(var r=n.map(function(t){return t.currentWriteId}),o=hi(t,e,r),s=o,a=o.hash(),c=0;c<n.length;c++){var l=n[c];Object(i.e)(0===l.status,"tryToSendTransactionQueue_: items in queue should all be run."),l.status=1,l.retryCount++;var u=xt(e,l.path);s=s.updateChild(u,l.currentOutputSnapshotRaw)}var h=s.val(!0),d=e;t.server_.put(d.toString(),h,function(r){li(t,"transaction put response",{path:d.toString(),status:r});var i=[];if("ok"===r){for(var o=[],s=function(e){n[e].status=2,i=i.concat(Xn(t.serverSyncTree_,n[e].currentWriteId)),n[e].onComplete&&o.push(function(){return n[e].onComplete(null,!0,n[e].currentOutputSnapshotResolved)}),n[e].unwatcher()},a=0;a<n.length;a++)s(a);for(_i(t,br(t.transactionQueueTree_,e)),di(t,t.transactionQueueTree_),Hr(t.eventQueue_,e,i),a=0;a<o.length;a++)F(o[a])}else{if("datastale"===r)for(a=0;a<n.length;a++)n[a].status=3===n[a].status?4:0;else for(S("transaction at "+d.toString()+" failed: "+r),a=0;a<n.length;a++)n[a].status=4,n[a].abortReason=r;pi(t,e)}},a)}(t,Sr(e),n)}else Tr(e)&&Cr(e,function(e){di(t,e)})}function pi(t,e){var n=fi(t,e),r=Sr(n);return function(t,e,n){if(0!==e.length){for(var r=[],o=[],s=e.filter(function(t){return 0===t.status}).map(function(t){return t.currentWriteId}),a=function(a){var c,l=e[a],u=xt(n,l.path),h=!1;if(Object(i.e)(null!==u,"rerunTransactionsUnderNode_: relativePath should not be null."),4===l.status)h=!0,c=l.abortReason,o=o.concat(Xn(t.serverSyncTree_,l.currentWriteId,!0));else if(0===l.status)if(l.retryCount>=25)h=!0,c="maxretry",o=o.concat(Xn(t.serverSyncTree_,l.currentWriteId,!0));else{var d=hi(t,l.path,s);l.currentInputSnapshot=d;var p=e[a].update(d.val());if(void 0!==p){Nr("transaction failed: Data returned ",p,l.path);var f=oe(p);"object"==typeof p&&null!=p&&Object(i.i)(p,".priority")||(f=f.updatePriority(d.getPriority()));var m=l.currentWriteId,g=Jr(t),_=_r(f,d,g);l.currentOutputSnapshotRaw=f,l.currentOutputSnapshotResolved=_,l.currentWriteId=ri(t),s.splice(s.indexOf(m),1),o=(o=o.concat(Kn(t.serverSyncTree_,l.path,_,l.currentWriteId,l.applyLocally))).concat(Xn(t.serverSyncTree_,m,!0))}else h=!0,c="nodata",o=o.concat(Xn(t.serverSyncTree_,l.currentWriteId,!0))}Hr(t.eventQueue_,n,o),o=[],h&&(e[a].status=2,setTimeout(e[a].unwatcher,Math.floor(0)),e[a].onComplete&&r.push("nodata"===c?function(){return e[a].onComplete(null,!1,e[a].currentInputSnapshot)}:function(){return e[a].onComplete(new Error(c),!1,null)}))},c=0;c<e.length;c++)a(c);for(_i(t,t.transactionQueueTree_),c=0;c<r.length;c++)F(r[c]);di(t,t.transactionQueueTree_)}}(t,mi(t,n),r),r}function fi(t,e){var n,r=t.transactionQueueTree_;for(n=pt(e);null!==n&&void 0===xr(r);)r=br(r,n),n=pt(e=mt(e));return r}function mi(t,e){var n=[];return gi(t,e,n),n.sort(function(t,e){return t.order-e.order}),n}function gi(t,e,n){var r=xr(e);if(r)for(var i=0;i<r.length;i++)n.push(r[i]);Cr(e,function(e){gi(t,e,n)})}function _i(t,e){var n=xr(e);if(n){for(var r=0,i=0;i<n.length;i++)2!==n[i].status&&(n[r]=n[i],r++);n.length=r,wr(e,n.length>0?n:void 0)}Cr(e,function(e){_i(t,e)})}function yi(t,e){var n=Sr(fi(t,e)),r=br(t.transactionQueueTree_,e);return function(t,e,n){for(var r=t.parent;null!==r;){if(e(r))return!0;r=r.parent}}(r,function(e){vi(t,e)}),vi(t,r),Er(r,function(e){vi(t,e)}),n}function vi(t,e){var n=xr(e);if(n){for(var r=[],o=[],s=-1,a=0;a<n.length;a++)3===n[a].status||(1===n[a].status?(Object(i.e)(s===a-1,"All SENT items should be at beginning of queue."),s=a,n[a].status=3,n[a].abortReason="set"):(Object(i.e)(0===n[a].status,"Unexpected transaction status in abort"),n[a].unwatcher(),o=o.concat(Xn(t.serverSyncTree_,n[a].currentWriteId,!0)),n[a].onComplete&&r.push(n[a].onComplete.bind(null,new Error("set"),!1,null))));for(-1===s?wr(e,void 0):n.length=s+1,Hr(t.eventQueue_,Sr(e),o),a=0;a<r.length;a++)F(r[a])}}var bi=function(t,e){var n=xi(t),r=n.namespace;return"firebase.com"===n.domain&&E(n.host+" is no longer supported. Please use <YOUR FIREBASE>.firebaseio.com instead"),r&&"undefined"!==r||"localhost"===n.domain||E("Cannot parse Firebase url. Please use https://<YOUR FIREBASE>.firebaseio.com"),n.secure||"undefined"!=typeof window&&window.location&&window.location.protocol&&-1!==window.location.protocol.indexOf("https:")&&S("Insecure Firebase access from a secure page. Please use https in calls to new Firebase()."),{repoInfo:new H(n.host,n.secure,r,e,"ws"===n.scheme||"wss"===n.scheme,"",r!==n.subdomain),path:new ht(n.pathString)}},xi=function(t){var e="",n="",r="",i="",s="",a=!0,c="https",l=443;if("string"==typeof t){var u=t.indexOf("//");u>=0&&(c=t.substring(0,u-1),t=t.substring(u+2));var h=t.indexOf("/");-1===h&&(h=t.length);var d=t.indexOf("?");-1===d&&(d=t.length),e=t.substring(0,Math.min(h,d)),h<d&&(i=function(t){for(var e="",n=t.split("/"),r=0;r<n.length;r++)if(n[r].length>0){var i=n[r];try{i=decodeURIComponent(i.replace(/\+/g," "))}catch(o){}e+="/"+i}return e}(t.substring(h,d)));var p=function(t){var e,n,r={};"?"===t.charAt(0)&&(t=t.substring(1));try{for(var i=Object(o.g)(t.split("&")),s=i.next();!s.done;s=i.next()){var a=s.value;if(0!==a.length){var c=a.split("=");2===c.length?r[decodeURIComponent(c[0])]=decodeURIComponent(c[1]):S("Invalid query segment '"+a+"' in query '"+t+"'")}}}catch(l){e={error:l}}finally{try{s&&!s.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}(t.substring(Math.min(t.length,d)));(u=e.indexOf(":"))>=0?(a="https"===c||"wss"===c,l=parseInt(e.substring(u+1),10)):u=e.length;var f=e.slice(0,u);if("localhost"===f.toLowerCase())n="localhost";else if(f.split(".").length<=2)n=f;else{var m=e.indexOf(".");r=e.substring(0,m).toLowerCase(),n=e.substring(m+1),s=r}"ns"in p&&(s=p.ns)}return{host:e,port:l,domain:n,subdomain:r,secure:a,scheme:c,pathString:i,namespace:s}},wi=function(){function t(t,e,n,r){this.eventType=t,this.eventRegistration=e,this.snapshot=n,this.prevName=r}return t.prototype.getPath=function(){var t=this.snapshot.ref;return"value"===this.eventType?t._path:t.parent._path},t.prototype.getEventType=function(){return this.eventType},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.getPath().toString()+":"+this.eventType+":"+Object(i.J)(this.snapshot.exportVal())},t}(),Ti=function(){function t(t,e,n){this.eventRegistration=t,this.error=e,this.path=n}return t.prototype.getPath=function(){return this.path},t.prototype.getEventType=function(){return"cancel"},t.prototype.getEventRunner=function(){return this.eventRegistration.getEventRunner(this)},t.prototype.toString=function(){return this.path.toString()+":cancel"},t}(),Ci=function(){function t(t,e){this.snapshotCallback=t,this.cancelCallback=e}return t.prototype.onValue=function(t,e){this.snapshotCallback.call(null,t,e)},t.prototype.onCancel=function(t){return Object(i.e)(this.hasCancelCallback,"Raising a cancel event on a listener with no cancel callback"),this.cancelCallback.call(null,t)},Object.defineProperty(t.prototype,"hasCancelCallback",{get:function(){return!!this.cancelCallback},enumerable:!1,configurable:!0}),t.prototype.matches=function(t){return this.snapshotCallback===t.snapshotCallback||void 0!==this.snapshotCallback.userCallback&&this.snapshotCallback.userCallback===t.snapshotCallback.userCallback&&this.snapshotCallback.context===t.snapshotCallback.context},t}(),Ei=function(){function t(t,e){this._repo=t,this._path=e}return t.prototype.cancel=function(){var t=new i.a;return oi(this._repo,this._path,t.wrapCallback(function(){})),t.promise},t.prototype.remove=function(){Ur("OnDisconnect.remove",this._path);var t=new i.a;return si(this._repo,this._path,null,t.wrapCallback(function(){})),t.promise},t.prototype.set=function(t){Ur("OnDisconnect.set",this._path),Rr("OnDisconnect.set",t,this._path,!1);var e=new i.a;return si(this._repo,this._path,t,e.wrapCallback(function(){})),e.promise},t.prototype.setWithPriority=function(t,e){Ur("OnDisconnect.setWithPriority",this._path),Rr("OnDisconnect.setWithPriority",t,this._path,!1),jr("OnDisconnect.setWithPriority",e,!1);var n=new i.a;return function(t,e,n,r,i){var o=oe(n,r);t.server_.onDisconnectPut(e.toString(),o.val(!0),function(n,r){"ok"===n&&Me(t.onDisconnect_,e,o),ui(0,i,n,r)})}(this._repo,this._path,t,e,n.wrapCallback(function(){})),n.promise},t.prototype.update=function(t){Ur("OnDisconnect.update",this._path),Lr("OnDisconnect.update",t,this._path,!1);var e=new i.a;return function(t,e,n,r){if(Object(i.u)(n))return w("onDisconnect().update() called with empty data.  Don't do anything."),void ui(0,r,"ok",void 0);t.server_.onDisconnectMerge(e.toString(),n,function(i,o){"ok"===i&&N(n,function(n,r){var i=oe(r);Me(t.onDisconnect_,vt(e,n),i)}),ui(0,r,i,o)})}(this._repo,this._path,t,e.wrapCallback(function(){})),e.promise},t}(),Si=function(){function t(t,e,n,r){this._repo=t,this._path=e,this._queryParams=n,this._orderByCalled=r}return Object.defineProperty(t.prototype,"key",{get:function(){return bt(this._path)?null:gt(this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Mi(this._repo,this._path)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_queryIdentifier",{get:function(){var t=Se(this._queryParams),e=D(t);return"{}"===e?"default":e},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_queryObject",{get:function(){return Se(this._queryParams)},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){if(!((e=Object(i.o)(e))instanceof t))return!1;var n=this._repo===e._repo,r=Tt(this._path,e._path);return n&&r&&this._queryIdentifier===e._queryIdentifier},t.prototype.toJSON=function(){return this.toString()},t.prototype.toString=function(){return this._repo.toString()+function(t){for(var e="",n=t.pieceNum_;n<t.pieces_.length;n++)""!==t.pieces_[n]&&(e+="/"+encodeURIComponent(String(t.pieces_[n])));return e||"/"}(this._path)},t}();function Ii(t,e){if(!0===t._orderByCalled)throw new Error(e+": You can't combine multiple orderBy calls.")}function ki(t){var e=null,n=null;if(t.hasStart()&&(e=t.getIndexStartValue()),t.hasEnd()&&(n=t.getIndexEndValue()),t.getIndex()===Lt){var r="Query: When ordering by key, you may only pass one argument to startAt(), endAt(), or equalTo().",o="Query: When ordering by key, the argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() must be a string.";if(t.hasStart()){if(t.getIndexStartName()!==k)throw new Error(r);if("string"!=typeof e)throw new Error(o)}if(t.hasEnd()){if(t.getIndexEndName()!==A)throw new Error(r);if("string"!=typeof n)throw new Error(o)}}else if(t.getIndex()===Yt){if(null!=e&&!Dr(e)||null!=n&&!Dr(n))throw new Error("Query: When ordering by priority, the first argument passed to startAt(), startAfter() endAt(), endBefore(), or equalTo() must be a valid priority value (null, a number, or a string).")}else if(Object(i.e)(t.getIndex()instanceof ce||t.getIndex()===le,"unknown index type."),null!=e&&"object"==typeof e||null!=n&&"object"==typeof n)throw new Error("Query: First argument passed to startAt(), startAfter(), endAt(), endBefore(), or equalTo() cannot be an object.")}function Ai(t){if(t.hasStart()&&t.hasEnd()&&t.hasLimit()&&!t.hasAnchoredLimit())throw new Error("Query: Can't combine startAt(), startAfter(), endAt(), endBefore(), and limit(). Use limitToFirst() or limitToLast() instead.")}var Mi=function(t){function e(e,n){return t.call(this,e,n,new xe,!1)||this}return Object(o.c)(e,t),Object.defineProperty(e.prototype,"parent",{get:function(){var t=yt(this._path);return null===t?null:new e(this._repo,t)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){for(var t=this;null!==t.parent;)t=t.parent;return t},enumerable:!1,configurable:!0}),e}(Si),Oi=function(){function t(t,e,n){this._node=t,this.ref=e,this._index=n}return Object.defineProperty(t.prototype,"priority",{get:function(){return this._node.getPriority().val()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"key",{get:function(){return this.ref.key},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._node.numChildren()},enumerable:!1,configurable:!0}),t.prototype.child=function(e){var n=new ht(e),r=Ri(this.ref,e);return new t(this._node.getChild(n),r,Yt)},t.prototype.exists=function(){return!this._node.isEmpty()},t.prototype.exportVal=function(){return this._node.val(!0)},t.prototype.forEach=function(e){var n=this;return!this._node.isLeafNode()&&!!this._node.forEachChild(this._index,function(r,i){return e(new t(i,Ri(n.ref,r),Yt))})},t.prototype.hasChild=function(t){var e=new ht(t);return!this._node.getChild(e).isEmpty()},t.prototype.hasChildren=function(){return!this._node.isLeafNode()&&!this._node.isEmpty()},t.prototype.toJSON=function(){return this.exportVal()},t.prototype.val=function(){return this._node.val()},t}();function Pi(t,e){return(t=Object(i.o)(t))._checkNotDeleted("ref"),void 0!==e?Ri(t._root,e):t._root}function Di(t,e){(t=Object(i.o)(t))._checkNotDeleted("refFromURL");var n=bi(e,t._repo.repoInfo_.nodeAdmin);Vr("refFromURL",n);var r=n.repoInfo;return t._repo.repoInfo_.isCustomHost()||r.host===t._repo.repoInfo_.host||E("refFromURL: Host name does not match the current database: (found "+r.host+" but expected "+t._repo.repoInfo_.host+")"),Pi(t,n.path.toString())}function Ri(t,e){var n;return null===pt((t=Object(i.o)(t))._path)?((n=e)&&(n=n.replace(/^\/*\.info(\/|$)/,"/")),Br("child","path",n,!1)):Br("child","path",e,!1),new Mi(t._repo,vt(t._path,e))}function Ni(t,e){t=Object(i.o)(t),Ur("push",t._path),Rr("push",e,t._path,!0);var n,r=Qr(t._repo),o=he(r),s=Ri(t,o),a=Ri(t,o);return n=null!=e?ji(a,e).then(function(){return a}):Promise.resolve(a),s.then=n.then.bind(n),s.catch=n.then.bind(n,void 0),s}function Li(t){return Ur("remove",t._path),ji(t,null)}function ji(t,e){t=Object(i.o)(t),Ur("set",t._path),Rr("set",e,t._path,!1);var n=new i.a;return ii(t._repo,t._path,e,null,n.wrapCallback(function(){})),n.promise}function zi(t,e){t=Object(i.o)(t),Ur("setPriority",t._path),jr("setPriority",e,!1);var n=new i.a;return ii(t._repo,vt(t._path,".priority"),e,null,n.wrapCallback(function(){})),n.promise}function Fi(t,e,n){if(Ur("setWithPriority",t._path),Rr("setWithPriority",e,t._path,!1),jr("setWithPriority",n,!1),".length"===t.key||".keys"===t.key)throw"setWithPriority failed: "+t.key+" is a read-only object.";var r=new i.a;return ii(t._repo,t._path,e,n,r.wrapCallback(function(){})),r.promise}function Bi(t,e){Lr("update",e,t._path,!1);var n=new i.a;return function(t,e,n,r){li(t,"update",{path:e.toString(),value:n});var o=!0,s=Jr(t),a={};if(N(n,function(n,r){o=!1,a[n]=gr(vt(e,n),oe(r),t.serverSyncTree_,s)}),o)w("update() called with empty data.  Don't do anything."),ui(0,r,"ok",void 0);else{var c=ri(t),l=function(t,e,n,r){!function(t,e,n,r){Object(i.e)(r>t.lastWriteId,"Stacking an older merge on top of newer ones"),t.allWrites.push({path:e,children:n,writeId:r,visible:!0}),t.visibleWrites=Je(t.visibleWrites,e,n),t.lastWriteId=r}(t.pendingWriteTree_,e,n,r);var o=Xe.fromObject(n);return er(t,new Ue({fromUser:!0,fromServer:!1,queryId:null,tagged:!1},e,o))}(t.serverSyncTree_,e,a,c);$r(t.eventQueue_,l),t.server_.merge(e.toString(),n,function(n,i){var o="ok"===n;o||S("update at "+e+" failed: "+n);var s=Xn(t.serverSyncTree_,c,!o),a=s.length>0?pi(t,e):e;Hr(t.eventQueue_,a,s),ui(0,r,n,i)}),N(n,function(n){var r=yi(t,vt(e,n));pi(t,r)}),Hr(t.eventQueue_,e,[])}}(t._repo,t._path,e,n.wrapCallback(function(){})),n.promise}var Ui=function(){function t(t){this.callbackContext=t}return t.prototype.respondsTo=function(t){return"value"===t},t.prototype.createEvent=function(t,e){var n=e._queryParams.getIndex();return new wi("value",this,new Oi(t.snapshotNode,new Mi(e._repo,e._path),n))},t.prototype.getEventRunner=function(t){var e=this;return"cancel"===t.getEventType()?function(){return e.callbackContext.onCancel(t.error)}:function(){return e.callbackContext.onValue(t.snapshot,null)}},t.prototype.createCancelEvent=function(t,e){return this.callbackContext.hasCancelCallback?new Ti(this,t,e):null},t.prototype.matches=function(e){return e instanceof t&&(!e.callbackContext||!this.callbackContext||e.callbackContext.matches(this.callbackContext))},t.prototype.hasAnyCallback=function(){return null!==this.callbackContext},t}(),Vi=function(){function t(t,e){this.eventType=t,this.callbackContext=e}return t.prototype.respondsTo=function(t){var e="children_added"===t?"child_added":t;return this.eventType===("children_removed"===e?"child_removed":e)},t.prototype.createCancelEvent=function(t,e){return this.callbackContext.hasCancelCallback?new Ti(this,t,e):null},t.prototype.createEvent=function(t,e){Object(i.e)(null!=t.childName,"Child events should have a childName.");var n=Ri(new Mi(e._repo,e._path),t.childName),r=e._queryParams.getIndex();return new wi(t.type,this,new Oi(t.snapshotNode,n,r),t.prevName)},t.prototype.getEventRunner=function(t){var e=this;return"cancel"===t.getEventType()?function(){return e.callbackContext.onCancel(t.error)}:function(){return e.callbackContext.onValue(t.snapshot,t.prevName)}},t.prototype.matches=function(e){return e instanceof t&&this.eventType===e.eventType&&(!this.callbackContext||!e.callbackContext||this.callbackContext.matches(e.callbackContext))},t.prototype.hasAnyCallback=function(){return!!this.callbackContext},t}();function qi(t,e,n,r,i){var o;if("object"==typeof r&&(o=void 0,i=r),"function"==typeof r&&(o=r),i&&i.onlyOnce){var s=n,a=function(e,n){ai(t._repo,t,l),s(e,n)};a.userCallback=n.userCallback,a.context=n.context,n=a}var c=new Ci(n,o||void 0),l="value"===e?new Ui(c):new Vi(e,c);return function(t,e,n){var r;r=".info"===pt(e._path)?Jn(t.infoSyncTree_,e,n):Jn(t.serverSyncTree_,e,n),Wr(t.eventQueue_,e._path,r)}(t._repo,t,l),function(){return ai(t._repo,t,l)}}function Gi(t,e,n,r){return qi(t,"value",e,n,r)}function $i(t,e,n,r){return qi(t,"child_added",e,n,r)}function Wi(t,e,n,r){return qi(t,"child_changed",e,n,r)}function Hi(t,e,n,r){return qi(t,"child_moved",e,n,r)}function Zi(t,e,n,r){return qi(t,"child_removed",e,n,r)}function Ki(t,e,n){var r=null,i=n?new Ci(n):null;"value"===e?r=new Ui(i):e&&(r=new Vi(e,i)),ai(t._repo,t,r)}var Xi=function(){return function(){}}(),Yi=function(t){function e(e,n){var r=t.call(this)||this;return r._value=e,r._key=n,r}return Object(o.c)(e,t),e.prototype._apply=function(t){Rr("endAt",this._value,t._path,!0);var e=Te(t._queryParams,this._value,this._key);if(Ai(e),ki(e),t._queryParams.hasEnd())throw new Error("endAt: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Si(t._repo,t._path,e,t._orderByCalled)},e}(Xi);function Qi(t,e){return Fr("endAt","key",e,!0),new Yi(t,e)}var Ji=function(t){function e(e,n){var r=t.call(this)||this;return r._value=e,r._key=n,r}return Object(o.c)(e,t),e.prototype._apply=function(t){Rr("endBefore",this._value,t._path,!1);var e,n,r,i,o=(n=this._value,r=this._key,(e=t._queryParams).index_===Lt?("string"==typeof n&&(n=pe(n)),i=Te(e,n,r)):i=Te(e,n,null==r?k:pe(r)),i.endBeforeSet_=!0,i);if(Ai(o),ki(o),t._queryParams.hasEnd())throw new Error("endBefore: Starting point was already set (by another call to endAt, endBefore or equalTo).");return new Si(t._repo,t._path,o,t._orderByCalled)},e}(Xi);function to(t,e){return Fr("endBefore","key",e,!0),new Ji(t,e)}var eo=function(t){function e(e,n){var r=t.call(this)||this;return r._value=e,r._key=n,r}return Object(o.c)(e,t),e.prototype._apply=function(t){Rr("startAt",this._value,t._path,!0);var e=we(t._queryParams,this._value,this._key);if(Ai(e),ki(e),t._queryParams.hasStart())throw new Error("startAt: Starting point was already set (by another call to startAt, startBefore or equalTo).");return new Si(t._repo,t._path,e,t._orderByCalled)},e}(Xi);function no(t,e){return void 0===t&&(t=null),Fr("startAt","key",e,!0),new eo(t,e)}var ro=function(t){function e(e,n){var r=t.call(this)||this;return r._value=e,r._key=n,r}return Object(o.c)(e,t),e.prototype._apply=function(t){Rr("startAfter",this._value,t._path,!1);var e,n,r,i,o=(n=this._value,r=this._key,(e=t._queryParams).index_===Lt?("string"==typeof n&&(n=de(n)),i=we(e,n,r)):i=we(e,n,null==r?A:de(r)),i.startAfterSet_=!0,i);if(Ai(o),ki(o),t._queryParams.hasStart())throw new Error("startAfter: Starting point was already set (by another call to startAt, startAfter, or equalTo).");return new Si(t._repo,t._path,o,t._orderByCalled)},e}(Xi);function io(t,e){return Fr("startAfter","key",e,!0),new ro(t,e)}var oo=function(t){function e(e){var n=t.call(this)||this;return n._limit=e,n}return Object(o.c)(e,t),e.prototype._apply=function(t){if(t._queryParams.hasLimit())throw new Error("limitToFirst: Limit was already set (by another call to limitToFirst or limitToLast).");return new Si(t._repo,t._path,(e=this._limit,(n=t._queryParams.copy()).limitSet_=!0,n.limit_=e,n.viewFrom_="l",n),t._orderByCalled);var e,n},e}(Xi);function so(t){if("number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("limitToFirst: First argument must be a positive integer.");return new oo(t)}var ao=function(t){function e(e){var n=t.call(this)||this;return n._limit=e,n}return Object(o.c)(e,t),e.prototype._apply=function(t){if(t._queryParams.hasLimit())throw new Error("limitToLast: Limit was already set (by another call to limitToFirst or limitToLast).");return new Si(t._repo,t._path,(e=this._limit,(n=t._queryParams.copy()).limitSet_=!0,n.limit_=e,n.viewFrom_="r",n),t._orderByCalled);var e,n},e}(Xi);function co(t){if("number"!=typeof t||Math.floor(t)!==t||t<=0)throw new Error("limitToLast: First argument must be a positive integer.");return new ao(t)}var lo=function(t){function e(e){var n=t.call(this)||this;return n._path=e,n}return Object(o.c)(e,t),e.prototype._apply=function(t){Ii(t,"orderByChild");var e=new ht(this._path);if(bt(e))throw new Error("orderByChild: cannot pass in empty path. Use orderByValue() instead.");var n=new ce(e),r=Ce(t._queryParams,n);return ki(r),new Si(t._repo,t._path,r,!0)},e}(Xi);function uo(t){if("$key"===t)throw new Error('orderByChild: "$key" is invalid.  Use orderByKey() instead.');if("$priority"===t)throw new Error('orderByChild: "$priority" is invalid.  Use orderByPriority() instead.');if("$value"===t)throw new Error('orderByChild: "$value" is invalid.  Use orderByValue() instead.');return Br("orderByChild","path",t,!1),new lo(t)}var ho=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype._apply=function(t){Ii(t,"orderByKey");var e=Ce(t._queryParams,Lt);return ki(e),new Si(t._repo,t._path,e,!0)},e}(Xi);function po(){return new ho}var fo=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype._apply=function(t){Ii(t,"orderByPriority");var e=Ce(t._queryParams,Yt);return ki(e),new Si(t._repo,t._path,e,!0)},e}(Xi);function mo(){return new fo}var go=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(o.c)(e,t),e.prototype._apply=function(t){Ii(t,"orderByValue");var e=Ce(t._queryParams,le);return ki(e),new Si(t._repo,t._path,e,!0)},e}(Xi);function _o(){return new go}var yo=function(t){function e(e,n){var r=t.call(this)||this;return r._value=e,r._key=n,r}return Object(o.c)(e,t),e.prototype._apply=function(t){if(Rr("equalTo",this._value,t._path,!1),t._queryParams.hasStart())throw new Error("equalTo: Starting point was already set (by another call to startAt/startAfter or equalTo).");if(t._queryParams.hasEnd())throw new Error("equalTo: Ending point was already set (by another call to endAt/endBefore or equalTo).");return new Yi(this._value,this._key)._apply(new eo(this._value,this._key)._apply(t))},e}(Xi);function vo(t,e){return Fr("equalTo","key",e,!0),new yo(t,e)}function bo(t){for(var e,n,r=[],s=1;s<arguments.length;s++)r[s-1]=arguments[s];var a=Object(i.o)(t);try{for(var c=Object(o.g)(r),l=c.next();!l.done;l=c.next()){var u=l.value;a=u._apply(a)}}catch(h){e={error:h}}finally{try{l&&!l.done&&(n=c.return)&&n.call(c)}finally{if(e)throw e.error}}return a}!function(t){Object(i.e)(!Mn,"__referenceConstructor has already been defined"),Mn=t}(Mi),function(t){Object(i.e)(!jn,"__referenceConstructor has already been defined"),jn=t}(Mi);var xo={},wo=!1;function To(t,e,n,r,i){var o=r||t.options.databaseURL;void 0===o&&(t.options.projectId||E("Can't determine Firebase Database URL. Be sure to include  a Project ID when calling firebase.initializeApp()."),w("Using default host for project ",t.options.projectId),o=t.options.projectId+"-default-rtdb.firebaseio.com");var s,a=bi(o,i),c=a.repoInfo,l=void 0;"undefined"!=typeof process&&(l=process.env.FIREBASE_DATABASE_EMULATOR_HOST),l?(s=!0,c=(a=bi(o="http://"+l+"?ns="+c.namespace,i)).repoInfo):s=!a.repoInfo.secure;var u=i&&s?new q(q.OWNER):new V(t.name,t.options,e);Vr("Invalid Firebase Database URL",a),bt(a.path)||E("Database URL must point to the root of a Firebase Database (not including a child path).");var h=function(t,e,n,r){var i=xo[e.name];i||(xo[e.name]=i={});var o=i[t.toURLString()];return o&&E("Database initialized multiple times. Please make sure the format of the database URL matches with each database() call."),o=new Yr(t,wo,n,r),i[t.toURLString()]=o,o}(c,t,u,new U(t.name,n));return new Co(h,t)}var Co=function(){function t(t,e){this._repoInternal=t,this.app=e,this.type="database",this._instanceStarted=!1}return Object.defineProperty(t.prototype,"_repo",{get:function(){return this._instanceStarted||(function(t,e,n){if(t.stats_=Q(t.repoInfo_),t.forceRestClient_||("object"==typeof window&&window.navigator&&window.navigator.userAgent||"").search(/googlebot|google webmaster tools|bingbot|yahoo! slurp|baiduspider|yandexbot|duckduckbot/i)>=0)t.server_=new Ie(t.repoInfo_,function(e,n,r,i){ti(t,e,n,r,i)},t.authTokenProvider_,t.appCheckProvider_),setTimeout(function(){return ei(t,!0)},0);else{if(null!=n){if("object"!=typeof n)throw new Error("Only objects are supported for option databaseAuthVariableOverride");try{Object(i.J)(n)}catch(s){throw new Error("Invalid authOverride provided: "+s)}}t.persistentConnection_=new Pt(t.repoInfo_,e,function(e,n,r,i){ti(t,e,n,r,i)},function(e){ei(t,e)},function(e){!function(t,e){N(e,function(e,n){ni(t,e,n)})}(t,e)},t.authTokenProvider_,t.appCheckProvider_,n),t.server_=t.persistentConnection_}var r,o;t.authTokenProvider_.addTokenChangeListener(function(e){t.server_.refreshAuthToken(e)}),t.appCheckProvider_.addTokenChangeListener(function(e){t.server_.refreshAppCheckToken(e.token)}),t.statsReporter_=(r=function(){return new Re(t.stats_,t.server_)},o=t.repoInfo_.toString(),Y[o]||(Y[o]=r()),Y[o]),t.infoData_=new ke,t.infoSyncTree_=new Zn({startListening:function(e,n,r,i){var o=[],s=t.infoData_.getNode(e._path);return s.isEmpty()||(o=Yn(t.infoSyncTree_,e._path,s),setTimeout(function(){i("ok")},0)),o},stopListening:function(){}}),ni(t,"connected",!1),t.serverSyncTree_=new Zn({startListening:function(e,n,r,i){return t.server_.listen(e,r,n,function(n,r){var o=i(n,r);Hr(t.eventQueue_,e._path,o)}),[]},stopListening:function(e,n){t.server_.unlisten(e,n)}})}(this._repoInternal,this.app.options.appId,this.app.options.databaseAuthVariableOverride),this._instanceStarted=!0),this._repoInternal},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_root",{get:function(){return this._rootInternal||(this._rootInternal=new Mi(this._repo,dt())),this._rootInternal},enumerable:!1,configurable:!0}),t.prototype._delete=function(){var t,e,n;return null!==this._rootInternal&&(t=this._repo,(n=xo[e=this.app.name])&&n[t.key]===t||E("Database "+e+"("+t.repoInfo_+") has already been deleted."),ci(t),delete n[t.key],this._repoInternal=null,this._rootInternal=null),Promise.resolve()},t.prototype._checkNotDeleted=function(t){null===this._rootInternal&&E("Cannot call "+t+" on a deleted database.")},t}();function Eo(t){(t=Object(i.o)(t))._checkNotDeleted("goOffline"),ci(t._repo)}function So(t){var e;(t=Object(i.o)(t))._checkNotDeleted("goOnline"),(e=t._repo).persistentConnection_&&e.persistentConnection_.resume(Xr)}var Io={".sv":"timestamp"},ko=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}();function Ao(t,e,n){var r;if(t=Object(i.o)(t),Ur("Reference.transaction",t._path),".length"===t.key||".keys"===t.key)throw"Reference.transaction failed: "+t.key+" is a read-only object.";var o=null===(r=null==n?void 0:n.applyLocally)||void 0===r||r,s=new i.a,a=Gi(t,function(){});return function(e,n,r,o,a,c){li(e,"transaction on "+n);var l={path:n,update:r,onComplete:function(e,n,r){var i=null;e?s.reject(e):(i=new Oi(r,new Mi(t._repo,t._path),Yt),s.resolve(new ko(n,i)))},status:null,order:g(),applyLocally:c,retryCount:0,unwatcher:a,abortReason:null,currentWriteId:null,currentInputSnapshot:null,currentOutputSnapshotRaw:null,currentOutputSnapshotResolved:null},u=hi(e,n,void 0);l.currentInputSnapshot=u;var h=l.update(u.val());if(void 0===h)l.unwatcher(),l.currentOutputSnapshotRaw=null,l.currentOutputSnapshotResolved=null,l.onComplete&&l.onComplete(null,!1,l.currentInputSnapshot);else{Nr("transaction failed: Data returned ",h,l.path),l.status=0;var d=br(e.transactionQueueTree_,n),p=xr(d)||[];p.push(l),wr(d,p);var f=void 0;"object"==typeof h&&null!==h&&Object(i.i)(h,".priority")?(f=Object(i.G)(h,".priority"),Object(i.e)(Dr(f),"Invalid priority returned by transaction. Priority must be a valid string, finite number, server value, or null.")):f=(tr(e.serverSyncTree_,n)||re.EMPTY_NODE).getPriority().val();var m=Jr(e),_=oe(h,f),y=_r(_,u,m);l.currentOutputSnapshotRaw=_,l.currentOutputSnapshotResolved=y,l.currentWriteId=ri(e);var v=Kn(e.serverSyncTree_,n,y,l.currentWriteId,l.applyLocally);Hr(e.eventQueue_,n,v),di(e,e.transactionQueueTree_)}}(t._repo,t._path,e,0,a,o),s.promise}var Mo=function(){function t(t){this._delegate=t}return t.prototype.cancel=function(t){Object(i.K)("OnDisconnect.cancel",0,1,arguments.length),Object(i.L)("OnDisconnect.cancel","onComplete",t,!0);var e=this._delegate.cancel();return t&&e.then(function(){return t(null)},function(e){return t(e)}),e},t.prototype.remove=function(t){Object(i.K)("OnDisconnect.remove",0,1,arguments.length),Object(i.L)("OnDisconnect.remove","onComplete",t,!0);var e=this._delegate.remove();return t&&e.then(function(){return t(null)},function(e){return t(e)}),e},t.prototype.set=function(t,e){Object(i.K)("OnDisconnect.set",1,2,arguments.length),Object(i.L)("OnDisconnect.set","onComplete",e,!0);var n=this._delegate.set(t);return e&&n.then(function(){return e(null)},function(t){return e(t)}),n},t.prototype.setWithPriority=function(t,e,n){Object(i.K)("OnDisconnect.setWithPriority",2,3,arguments.length),Object(i.L)("OnDisconnect.setWithPriority","onComplete",n,!0);var r=this._delegate.setWithPriority(t,e);return n&&r.then(function(){return n(null)},function(t){return n(t)}),r},t.prototype.update=function(t,e){if(Object(i.K)("OnDisconnect.update",1,2,arguments.length),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,S("Passing an Array to firebase.database.onDisconnect().update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Object(i.L)("OnDisconnect.update","onComplete",e,!0);var o=this._delegate.update(t);return e&&o.then(function(){return e(null)},function(t){return e(t)}),o},t}(),Oo=function(){function t(t,e){this.committed=t,this.snapshot=e}return t.prototype.toJSON=function(){return Object(i.K)("TransactionResult.toJSON",0,1,arguments.length),{committed:this.committed,snapshot:this.snapshot.toJSON()}},t}(),Po=function(){function t(t,e){this._database=t,this._delegate=e}return t.prototype.val=function(){return Object(i.K)("DataSnapshot.val",0,0,arguments.length),this._delegate.val()},t.prototype.exportVal=function(){return Object(i.K)("DataSnapshot.exportVal",0,0,arguments.length),this._delegate.exportVal()},t.prototype.toJSON=function(){return Object(i.K)("DataSnapshot.toJSON",0,1,arguments.length),this._delegate.toJSON()},t.prototype.exists=function(){return Object(i.K)("DataSnapshot.exists",0,0,arguments.length),this._delegate.exists()},t.prototype.child=function(e){return Object(i.K)("DataSnapshot.child",0,1,arguments.length),e=String(e),Br("DataSnapshot.child","path",e,!1),new t(this._database,this._delegate.child(e))},t.prototype.hasChild=function(t){return Object(i.K)("DataSnapshot.hasChild",1,1,arguments.length),Br("DataSnapshot.hasChild","path",t,!1),this._delegate.hasChild(t)},t.prototype.getPriority=function(){return Object(i.K)("DataSnapshot.getPriority",0,0,arguments.length),this._delegate.priority},t.prototype.forEach=function(e){var n=this;return Object(i.K)("DataSnapshot.forEach",1,1,arguments.length),Object(i.L)("DataSnapshot.forEach","action",e,!1),this._delegate.forEach(function(r){return e(new t(n._database,r))})},t.prototype.hasChildren=function(){return Object(i.K)("DataSnapshot.hasChildren",0,0,arguments.length),this._delegate.hasChildren()},Object.defineProperty(t.prototype,"key",{get:function(){return this._delegate.key},enumerable:!1,configurable:!0}),t.prototype.numChildren=function(){return Object(i.K)("DataSnapshot.numChildren",0,0,arguments.length),this._delegate.size},t.prototype.getRef=function(){return Object(i.K)("DataSnapshot.ref",0,0,arguments.length),new Ro(this._database,this._delegate.ref)},Object.defineProperty(t.prototype,"ref",{get:function(){return this.getRef()},enumerable:!1,configurable:!0}),t}(),Do=function(){function t(t,e){this.database=t,this._delegate=e}return t.prototype.on=function(e,n,r,o){var s,a=this;Object(i.K)("Query.on",2,4,arguments.length),Object(i.L)("Query.on","callback",n,!1);var c=t.getCancelAndContextArgs_("Query.on",r,o),l=function(t,e){n.call(c.context,new Po(a.database,t),e)};l.userCallback=n,l.context=c.context;var u=null===(s=c.cancel)||void 0===s?void 0:s.bind(c.context);switch(e){case"value":return Gi(this._delegate,l,u),n;case"child_added":return $i(this._delegate,l,u),n;case"child_removed":return Zi(this._delegate,l,u),n;case"child_changed":return Wi(this._delegate,l,u),n;case"child_moved":return Hi(this._delegate,l,u),n;default:throw new Error(Object(i.n)("Query.on","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}},t.prototype.off=function(t,e,n){if(Object(i.K)("Query.off",0,3,arguments.length),zr("Query.off",t,!0),Object(i.L)("Query.off","callback",e,!0),Object(i.M)("Query.off","context",n,!0),e){var r=function(){};r.userCallback=e,r.context=n,Ki(this._delegate,t,r)}else Ki(this._delegate,t)},t.prototype.get=function(){var t=this;return function(t){return function(t,e){var n=function(t,e){var n=e._path,r=null;t.syncPointTree_.foreachOnPath(n,function(t,e){var i=xt(t,n);r=r||Vn(e,i)});var i=t.syncPointTree_.get(n);i?r=r||Vn(i,dt()):(i=new zn,t.syncPointTree_=t.syncPointTree_.set(n,i));var o=null!=r,s=o?new Ve(r,!0,!1):null;return Ze(Bn(i,e,ln(t.pendingWriteTree_,e._path),o?s.getNode():re.EMPTY_NODE,o).viewCache_)}(t.serverSyncTree_,e);return null!=n?Promise.resolve(n):t.server_.get(e).then(function(n){var r=oe(n).withIndex(e._queryParams.getIndex()),i=Yn(t.serverSyncTree_,e._path,r);return Wr(t.eventQueue_,e._path,i),Promise.resolve(r)},function(n){return li(t,"get for query "+Object(i.J)(e)+" failed: "+n),Promise.reject(new Error(n))})}((t=Object(i.o)(t))._repo,t).then(function(e){return new Oi(e,new Mi(t._repo,t._path),t._queryParams.getIndex())})}(this._delegate).then(function(e){return new Po(t.database,e)})},t.prototype.once=function(e,n,r,o){var s=this;Object(i.K)("Query.once",1,4,arguments.length),Object(i.L)("Query.once","callback",n,!0);var a=t.getCancelAndContextArgs_("Query.once",r,o),c=new i.a,l=function(t,e){var r=new Po(s.database,t);n&&n.call(a.context,r,e),c.resolve(r)};l.userCallback=n,l.context=a.context;var u=function(t){a.cancel&&a.cancel.call(a.context,t),c.reject(t)};switch(e){case"value":Gi(this._delegate,l,u,{onlyOnce:!0});break;case"child_added":$i(this._delegate,l,u,{onlyOnce:!0});break;case"child_removed":Zi(this._delegate,l,u,{onlyOnce:!0});break;case"child_changed":Wi(this._delegate,l,u,{onlyOnce:!0});break;case"child_moved":Hi(this._delegate,l,u,{onlyOnce:!0});break;default:throw new Error(Object(i.n)("Query.once","eventType")+'must be a valid event type = "value", "child_added", "child_removed", "child_changed", or "child_moved".')}return c.promise},t.prototype.limitToFirst=function(e){return Object(i.K)("Query.limitToFirst",1,1,arguments.length),new t(this.database,bo(this._delegate,so(e)))},t.prototype.limitToLast=function(e){return Object(i.K)("Query.limitToLast",1,1,arguments.length),new t(this.database,bo(this._delegate,co(e)))},t.prototype.orderByChild=function(e){return Object(i.K)("Query.orderByChild",1,1,arguments.length),new t(this.database,bo(this._delegate,uo(e)))},t.prototype.orderByKey=function(){return Object(i.K)("Query.orderByKey",0,0,arguments.length),new t(this.database,bo(this._delegate,po()))},t.prototype.orderByPriority=function(){return Object(i.K)("Query.orderByPriority",0,0,arguments.length),new t(this.database,bo(this._delegate,mo()))},t.prototype.orderByValue=function(){return Object(i.K)("Query.orderByValue",0,0,arguments.length),new t(this.database,bo(this._delegate,_o()))},t.prototype.startAt=function(e,n){return void 0===e&&(e=null),Object(i.K)("Query.startAt",0,2,arguments.length),new t(this.database,bo(this._delegate,no(e,n)))},t.prototype.startAfter=function(e,n){return void 0===e&&(e=null),Object(i.K)("Query.startAfter",0,2,arguments.length),new t(this.database,bo(this._delegate,io(e,n)))},t.prototype.endAt=function(e,n){return void 0===e&&(e=null),Object(i.K)("Query.endAt",0,2,arguments.length),new t(this.database,bo(this._delegate,Qi(e,n)))},t.prototype.endBefore=function(e,n){return void 0===e&&(e=null),Object(i.K)("Query.endBefore",0,2,arguments.length),new t(this.database,bo(this._delegate,to(e,n)))},t.prototype.equalTo=function(e,n){return Object(i.K)("Query.equalTo",1,2,arguments.length),new t(this.database,bo(this._delegate,vo(e,n)))},t.prototype.toString=function(){return Object(i.K)("Query.toString",0,0,arguments.length),this._delegate.toString()},t.prototype.toJSON=function(){return Object(i.K)("Query.toJSON",0,1,arguments.length),this._delegate.toJSON()},t.prototype.isEqual=function(e){if(Object(i.K)("Query.isEqual",1,1,arguments.length),!(e instanceof t)){var n="Query.isEqual failed: First argument must be an instance of firebase.database.Query.";throw new Error(n)}return this._delegate.isEqual(e._delegate)},t.getCancelAndContextArgs_=function(t,e,n){var r={cancel:void 0,context:void 0};if(e&&n)r.cancel=e,Object(i.L)(t,"cancel",r.cancel,!0),r.context=n,Object(i.M)(t,"context",r.context,!0);else if(e)if("object"==typeof e&&null!==e)r.context=e;else{if("function"!=typeof e)throw new Error(Object(i.n)(t,"cancelOrContext")+" must either be a cancel callback or a context object.");r.cancel=e}return r},Object.defineProperty(t.prototype,"ref",{get:function(){return new Ro(this.database,new Mi(this._delegate._repo,this._delegate._path))},enumerable:!1,configurable:!0}),t}(),Ro=function(t){function e(e,n){var r=t.call(this,e,new Si(n._repo,n._path,new xe,!1))||this;return r.database=e,r._delegate=n,r}return Object(o.c)(e,t),e.prototype.getKey=function(){return Object(i.K)("Reference.key",0,0,arguments.length),this._delegate.key},e.prototype.child=function(t){return Object(i.K)("Reference.child",1,1,arguments.length),"number"==typeof t&&(t=String(t)),new e(this.database,Ri(this._delegate,t))},e.prototype.getParent=function(){Object(i.K)("Reference.parent",0,0,arguments.length);var t=this._delegate.parent;return t?new e(this.database,t):null},e.prototype.getRoot=function(){return Object(i.K)("Reference.root",0,0,arguments.length),new e(this.database,this._delegate.root)},e.prototype.set=function(t,e){Object(i.K)("Reference.set",1,2,arguments.length),Object(i.L)("Reference.set","onComplete",e,!0);var n=ji(this._delegate,t);return e&&n.then(function(){return e(null)},function(t){return e(t)}),n},e.prototype.update=function(t,e){if(Object(i.K)("Reference.update",1,2,arguments.length),Array.isArray(t)){for(var n={},r=0;r<t.length;++r)n[""+r]=t[r];t=n,S("Passing an Array to Firebase.update() is deprecated. Use set() if you want to overwrite the existing data, or an Object with integer keys if you really do want to only update some of the children.")}Ur("Reference.update",this._delegate._path),Object(i.L)("Reference.update","onComplete",e,!0);var o=Bi(this._delegate,t);return e&&o.then(function(){return e(null)},function(t){return e(t)}),o},e.prototype.setWithPriority=function(t,e,n){Object(i.K)("Reference.setWithPriority",2,3,arguments.length),Object(i.L)("Reference.setWithPriority","onComplete",n,!0);var r=Fi(this._delegate,t,e);return n&&r.then(function(){return n(null)},function(t){return n(t)}),r},e.prototype.remove=function(t){Object(i.K)("Reference.remove",0,1,arguments.length),Object(i.L)("Reference.remove","onComplete",t,!0);var e=Li(this._delegate);return t&&e.then(function(){return t(null)},function(e){return t(e)}),e},e.prototype.transaction=function(t,e,n){var r=this;Object(i.K)("Reference.transaction",1,3,arguments.length),Object(i.L)("Reference.transaction","transactionUpdate",t,!1),Object(i.L)("Reference.transaction","onComplete",e,!0),qr("Reference.transaction","applyLocally",n,!0);var o=Ao(this._delegate,t,{applyLocally:n}).then(function(t){return new Oo(t.committed,new Po(r.database,t.snapshot))});return e&&o.then(function(t){return e(null,t.committed,t.snapshot)},function(t){return e(t,!1,null)}),o},e.prototype.setPriority=function(t,e){Object(i.K)("Reference.setPriority",1,2,arguments.length),Object(i.L)("Reference.setPriority","onComplete",e,!0);var n=zi(this._delegate,t);return e&&n.then(function(){return e(null)},function(t){return e(t)}),n},e.prototype.push=function(t,n){var r=this;Object(i.K)("Reference.push",0,2,arguments.length),Object(i.L)("Reference.push","onComplete",n,!0);var o=Ni(this._delegate,t),s=o.then(function(t){return new e(r.database,t)});n&&s.then(function(){return n(null)},function(t){return n(t)});var a=new e(this.database,o);return a.then=s.then.bind(s),a.catch=s.catch.bind(s,void 0),a},e.prototype.onDisconnect=function(){return Ur("Reference.onDisconnect",this._delegate._path),new Mo(new Ei(this._delegate._repo,this._delegate._path))},Object.defineProperty(e.prototype,"key",{get:function(){return this.getKey()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){return this.getParent()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"root",{get:function(){return this.getRoot()},enumerable:!1,configurable:!0}),e}(Do),No=function(){function t(t,e){var n=this;this._delegate=t,this.app=e,this.INTERNAL={delete:function(){return n._delegate._delete()}}}return t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={}),(t=Object(i.o)(t))._checkNotDeleted("useEmulator"),t._instanceStarted&&E("Cannot call useEmulator() after instance has already been initialized.");var o=t._repoInternal,s=void 0;if(o.repoInfo_.nodeAdmin)r.mockUserToken&&E('mockUserToken is not supported by the Admin SDK. For client access with mock users, please use the "firebase" package instead of "firebase-admin".'),s=new q(q.OWNER);else if(r.mockUserToken){var a="string"==typeof r.mockUserToken?r.mockUserToken:Object(i.j)(r.mockUserToken,t.app.options.projectId);s=new q(a)}!function(t,e,n,r){t.repoInfo_=new H(e+":"+n,!1,t.repoInfo_.namespace,t.repoInfo_.webSocketOnly,t.repoInfo_.nodeAdmin,t.repoInfo_.persistenceKey,t.repoInfo_.includeNamespaceInQueryParams),r&&(t.authTokenProvider_=r)}(o,e,n,s)}(this._delegate,t,e,n)},t.prototype.ref=function(t){if(Object(i.K)("database.ref",0,1,arguments.length),t instanceof Ro){var e=Di(this._delegate,t.toString());return new Ro(this,e)}return e=Pi(this._delegate,t),new Ro(this,e)},t.prototype.refFromURL=function(t){var e="database.refFromURL";Object(i.K)(e,1,1,arguments.length);var n=Di(this._delegate,t);return new Ro(this,n)},t.prototype.goOffline=function(){return Object(i.K)("database.goOffline",0,0,arguments.length),Eo(this._delegate)},t.prototype.goOnline=function(){return Object(i.K)("database.goOnline",0,0,arguments.length),So(this._delegate)},t.ServerValue={TIMESTAMP:Io,increment:function(t){return function(t){return{".sv":{increment:t}}}(t)}},t}(),Lo=Object.freeze({__proto__:null,forceLongPolling:function(){ot.forceDisallow(),nt.forceAllow()},forceWebSockets:function(){nt.forceDisallow()},isWebSocketsAvailable:function(){return ot.isAvailable()},setSecurityDebugCallback:function(t,e){t._delegate._repo.persistentConnection_.securityDebugCallback_=e},stats:function(t,e){!function(t,e){if(void 0===e&&(e=!1),"undefined"!=typeof console){var n;e?(t.statsListener_||(t.statsListener_=new De(t.stats_)),n=t.statsListener_.get()):n=t.stats_.get();var r=Object.keys(n).reduce(function(t,e){return Math.max(e.length,t)},0);N(n,function(t,e){for(var n=t,i=t.length;i<r+2;i++)n+=" ";console.log(n+e)})}}(t._delegate._repo,e)},statsIncrementCounter:function(t,e){!function(t,e){t.stats_.incrementCounter(e),t.statsReporter_.statsToReport_[e]=!0}(t._delegate._repo,e)},dataUpdateCount:function(t){return t._delegate._repo.dataUpdateCount},interceptServerData:function(t,e){return function(t,e){t.interceptServerDataCallback_=e}(t._delegate._repo,e)},initStandalone:function(t){var e=t.app,n=t.url,i=t.customAuthImpl,o=t.namespace,s=t.nodeAdmin,a=void 0!==s&&s;c(t.version);var l=new r.c("auth-internal",new r.b("database-standalone"));return l.setComponent(new r.a("auth-internal",function(){return i},"PRIVATE")),{instance:new No(To(e,l,void 0,n,a),e),namespace:o}}}),jo=Pt;Pt.prototype.simpleListen=function(t,e){this.sendRequest("q",{p:t},e)},Pt.prototype.echo=function(t,e){this.sendRequest("echo",{d:t},e)};var zo=Object.freeze({__proto__:null,DataConnection:jo,RealTimeConnection:at,hijackHash:function(t){var e=Pt.prototype.put;return Pt.prototype.put=function(n,r,i,o){void 0!==o&&(o=t()),e.call(this,n,r,i,o)},function(){Pt.prototype.put=e}},ConnectionTarget:H,queryIdentifier:function(t){return t._delegate._queryIdentifier},forceRestClient:function(t){!function(t){wo=t}(t)}}),Fo=No.ServerValue;!function(e){c(e.SDK_VERSION);var n=e.INTERNAL.registerComponent(new r.a("database",function(t,e){var n=e.instanceIdentifier,r=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal");return new No(To(r,i,o,n),r)},"PUBLIC").setServiceProps({Reference:Ro,Query:Do,Database:No,DataSnapshot:Po,enableLogging:x,INTERNAL:Lo,ServerValue:Fo,TEST_ACCESS:zo}).setMultipleInstances(!0));e.registerVersion("@firebase/database","0.11.0"),Object(i.y)()&&(t.exports=n)}(e.a)}).call(this,n("3UD+")(t))},"7o/Q":function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n("n6bG"),i=n("gRHU"),o=n("quSY"),s=n("2QA8"),a=n("2fFW"),c=n("NJ4a");class l extends o.a{constructor(t,e,n){switch(super(),this.syncErrorValue=null,this.syncErrorThrown=!1,this.syncErrorThrowable=!1,this.isStopped=!1,arguments.length){case 0:this.destination=i.a;break;case 1:if(!t){this.destination=i.a;break}if("object"==typeof t){t instanceof l?(this.syncErrorThrowable=t.syncErrorThrowable,this.destination=t,t.add(this)):(this.syncErrorThrowable=!0,this.destination=new u(this,t));break}default:this.syncErrorThrowable=!0,this.destination=new u(this,t,e,n)}}[s.a](){return this}static create(t,e,n){const r=new l(t,e,n);return r.syncErrorThrowable=!1,r}next(t){this.isStopped||this._next(t)}error(t){this.isStopped||(this.isStopped=!0,this._error(t))}complete(){this.isStopped||(this.isStopped=!0,this._complete())}unsubscribe(){this.closed||(this.isStopped=!0,super.unsubscribe())}_next(t){this.destination.next(t)}_error(t){this.destination.error(t),this.unsubscribe()}_complete(){this.destination.complete(),this.unsubscribe()}_unsubscribeAndRecycle(){const{_parentOrParents:t}=this;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this}}class u extends l{constructor(t,e,n,o){let s;super(),this._parentSubscriber=t;let a=this;Object(r.a)(e)?s=e:e&&(s=e.next,n=e.error,o=e.complete,e!==i.a&&(a=Object.create(e),Object(r.a)(a.unsubscribe)&&this.add(a.unsubscribe.bind(a)),a.unsubscribe=this.unsubscribe.bind(this))),this._context=a,this._next=s,this._error=n,this._complete=o}next(t){if(!this.isStopped&&this._next){const{_parentSubscriber:e}=this;a.a.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}}error(t){if(!this.isStopped){const{_parentSubscriber:e}=this,{useDeprecatedSynchronousErrorHandling:n}=a.a;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):Object(c.a)(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;Object(c.a)(t)}}}complete(){if(!this.isStopped){const{_parentSubscriber:t}=this;if(this._complete){const e=()=>this._complete.call(this._context);a.a.useDeprecatedSynchronousErrorHandling&&t.syncErrorThrowable?(this.__tryOrSetError(t,e),this.unsubscribe()):(this.__tryOrUnsub(e),this.unsubscribe())}else this.unsubscribe()}}__tryOrUnsub(t,e){try{t.call(this._context,e)}catch(n){if(this.unsubscribe(),a.a.useDeprecatedSynchronousErrorHandling)throw n;Object(c.a)(n)}}__tryOrSetError(t,e,n){if(!a.a.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(r){return a.a.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=r,t.syncErrorThrown=!0,!0):(Object(c.a)(r),!0)}return!1}_unsubscribe(){const{_parentSubscriber:t}=this;this._context=null,this._parentSubscriber=null,t.unsubscribe()}}},"9ppp":function(t,e,n){"use strict";n.d(e,"a",function(){return r});const r=(()=>{function t(){return Error.call(this),this.message="object unsubscribed",this.name="ObjectUnsubscribedError",this}return t.prototype=Object.create(Error.prototype),t})()},Cfvw:function(t,e,n){"use strict";n.d(e,"a",function(){return h});var r=n("HDdC"),i=n("SeVD"),o=n("quSY"),s=n("kJWO"),a=n("jZKg"),c=n("Lhse"),l=n("c2HN"),u=n("I55L");function h(t,e){return e?function(t,e){if(null!=t){if(function(t){return t&&"function"==typeof t[s.a]}(t))return function(t,e){return new r.a(n=>{const r=new o.a;return r.add(e.schedule(()=>{const i=t[s.a]();r.add(i.subscribe({next(t){r.add(e.schedule(()=>n.next(t)))},error(t){r.add(e.schedule(()=>n.error(t)))},complete(){r.add(e.schedule(()=>n.complete()))}}))})),r})}(t,e);if(Object(l.a)(t))return function(t,e){return new r.a(n=>{const r=new o.a;return r.add(e.schedule(()=>t.then(t=>{r.add(e.schedule(()=>{n.next(t),r.add(e.schedule(()=>n.complete()))}))},t=>{r.add(e.schedule(()=>n.error(t)))}))),r})}(t,e);if(Object(u.a)(t))return Object(a.a)(t,e);if(function(t){return t&&"function"==typeof t[c.a]}(t)||"string"==typeof t)return function(t,e){if(!t)throw new Error("Iterable cannot be null");return new r.a(n=>{const r=new o.a;let i;return r.add(()=>{i&&"function"==typeof i.return&&i.return()}),r.add(e.schedule(()=>{i=t[c.a](),r.add(e.schedule(function(){if(n.closed)return;let t,e;try{const n=i.next();t=n.value,e=n.done}catch(r){return void n.error(r)}e?n.complete():(n.next(t),this.schedule())}))})),r})}(t,e)}throw new TypeError((null!==t&&typeof t||t)+" is not observable")}(t,e):t instanceof r.a?t:new r.a(Object(i.a)(t))}},D0XW:function(t,e,n){"use strict";n.d(e,"b",function(){return i}),n.d(e,"a",function(){return o});var r=n("3N8a");const i=new(n("IjjT").a)(r.a),o=i},DH7j:function(t,e,n){"use strict";n.d(e,"a",function(){return r});const r=(()=>Array.isArray||(t=>t&&"number"==typeof t.length))()},EY2u:function(t,e,n){"use strict";n.d(e,"a",function(){return i}),n.d(e,"b",function(){return o});var r=n("HDdC");const i=new r.a(t=>t.complete());function o(t){return t?function(t){return new r.a(e=>t.schedule(()=>e.complete()))}(t):i}},HDdC:function(t,e,n){"use strict";n.d(e,"a",function(){return l});var r=n("7o/Q"),i=n("2QA8"),o=n("gRHU"),s=n("kJWO"),a=n("SpAZ"),c=n("2fFW");let l=(()=>{class t{constructor(t){this._isScalar=!1,t&&(this._subscribe=t)}lift(e){const n=new t;return n.source=this,n.operator=e,n}subscribe(t,e,n){const{operator:s}=this,a=function(t,e,n){if(t){if(t instanceof r.a)return t;if(t[i.a])return t[i.a]()}return t||e||n?new r.a(t,e,n):new r.a(o.a)}(t,e,n);if(a.add(s?s.call(a,this.source):this.source||c.a.useDeprecatedSynchronousErrorHandling&&!a.syncErrorThrowable?this._subscribe(a):this._trySubscribe(a)),c.a.useDeprecatedSynchronousErrorHandling&&a.syncErrorThrowable&&(a.syncErrorThrowable=!1,a.syncErrorThrown))throw a.syncErrorValue;return a}_trySubscribe(t){try{return this._subscribe(t)}catch(e){c.a.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),function(t){for(;t;){const{closed:e,destination:n,isStopped:i}=t;if(e||i)return!1;t=n&&n instanceof r.a?n:null}return!0}(t)?t.error(e):console.warn(e)}}forEach(t,e){return new(e=u(e))((e,n)=>{let r;r=this.subscribe(e=>{try{t(e)}catch(i){n(i),r&&r.unsubscribe()}},n,e)})}_subscribe(t){const{source:e}=this;return e&&e.subscribe(t)}[s.a](){return this}pipe(...t){return 0===t.length?this:(0===(e=t).length?a.a:1===e.length?e[0]:function(t){return e.reduce((t,e)=>e(t),t)})(this);var e}toPromise(t){return new(t=u(t))((t,e)=>{let n;this.subscribe(t=>n=t,t=>e(t),()=>t(n))})}}return t.create=e=>new t(e),t})();function u(t){if(t||(t=c.a.Promise||Promise),!t)throw new Error("no Promise impl found");return t}},I55L:function(t,e,n){"use strict";n.d(e,"a",function(){return r});const r=t=>t&&"number"==typeof t.length&&"function"!=typeof t},IjjT:function(t,e,n){"use strict";n.d(e,"a",function(){return i});let r=(()=>{class t{constructor(e,n=t.now){this.SchedulerAction=e,this.now=n}schedule(t,e=0,n){return new this.SchedulerAction(this,t).schedule(n,e)}}return t.now=()=>Date.now(),t})();class i extends r{constructor(t,e=r.now){super(t,()=>i.delegate&&i.delegate!==this?i.delegate.now():e()),this.actions=[],this.active=!1,this.scheduled=void 0}schedule(t,e=0,n){return i.delegate&&i.delegate!==this?i.delegate.schedule(t,e,n):super.schedule(t,e,n)}flush(t){const{actions:e}=this;if(this.active)return void e.push(t);let n;this.active=!0;do{if(n=t.execute(t.state,t.delay))break}while(t=e.shift());if(this.active=!1,n){for(;t=e.shift();)t.unsubscribe();throw n}}}},Jgta:function(t,e,n){"use strict";var r=n("zIRd");n.d(e,"a",function(){return r.a});var i="8.10.1";r.a.registerVersion("firebase",i,"app"),r.a.SDK_VERSION=i},LRne:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var r=n("z+Ro"),i=n("yCtX"),o=n("jZKg");function s(...t){let e=t[t.length-1];return Object(r.a)(e)?(t.pop(),Object(o.a)(t,e)):Object(i.a)(t)}},Lhse:function(t,e,n){"use strict";function r(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}n.d(e,"a",function(){return i});const i=r()},NJ4a:function(t,e,n){"use strict";function r(t){setTimeout(()=>{throw t},0)}n.d(e,"a",function(){return r})},SeVD:function(t,e,n){"use strict";n.d(e,"a",function(){return u});var r=n("ngJS"),i=n("NJ4a"),o=n("Lhse"),s=n("kJWO"),a=n("I55L"),c=n("c2HN"),l=n("XoHu");const u=t=>{if(t&&"function"==typeof t[s.a])return u=t,t=>{const e=u[s.a]();if("function"!=typeof e.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return e.subscribe(t)};if(Object(a.a)(t))return Object(r.a)(t);if(Object(c.a)(t))return n=t,t=>(n.then(e=>{t.closed||(t.next(e),t.complete())},e=>t.error(e)).then(null,i.a),t);if(t&&"function"==typeof t[o.a])return e=t,t=>{const n=e[o.a]();for(;;){let e;try{e=n.next()}catch(r){return t.error(r),t}if(e.done){t.complete();break}if(t.next(e.value),t.closed)break}return"function"==typeof n.return&&t.add(()=>{n.return&&n.return()}),t};{const e=Object(l.a)(t)?"an invalid object":`'${t}'`;throw new TypeError(`You provided ${e} where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.`)}var e,n,u}},SpAZ:function(t,e,n){"use strict";function r(t){return t}n.d(e,"a",function(){return r})},VRyK:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r=n("HDdC"),i=n("z+Ro"),o=n("bHdf"),s=n("yCtX");function a(...t){let e=Number.POSITIVE_INFINITY,n=null,a=t[t.length-1];return Object(i.a)(a)?(n=t.pop(),t.length>1&&"number"==typeof t[t.length-1]&&(e=t.pop())):"number"==typeof a&&(e=t.pop()),null===n&&1===t.length&&t[0]instanceof r.a?t[0]:Object(o.a)(e)(Object(s.a)(t,n))}},XNiG:function(t,e,n){"use strict";n.d(e,"b",function(){return l}),n.d(e,"a",function(){return u});var r=n("HDdC"),i=n("7o/Q"),o=n("quSY"),s=n("9ppp"),a=n("Ylt2"),c=n("2QA8");class l extends i.a{constructor(t){super(t),this.destination=t}}let u=(()=>{class t extends r.a{constructor(){super(),this.observers=[],this.closed=!1,this.isStopped=!1,this.hasError=!1,this.thrownError=null}[c.a](){return new l(this)}lift(t){const e=new h(this,this);return e.operator=t,e}next(t){if(this.closed)throw new s.a;if(!this.isStopped){const{observers:e}=this,n=e.length,r=e.slice();for(let i=0;i<n;i++)r[i].next(t)}}error(t){if(this.closed)throw new s.a;this.hasError=!0,this.thrownError=t,this.isStopped=!0;const{observers:e}=this,n=e.length,r=e.slice();for(let i=0;i<n;i++)r[i].error(t);this.observers.length=0}complete(){if(this.closed)throw new s.a;this.isStopped=!0;const{observers:t}=this,e=t.length,n=t.slice();for(let r=0;r<e;r++)n[r].complete();this.observers.length=0}unsubscribe(){this.isStopped=!0,this.closed=!0,this.observers=null}_trySubscribe(t){if(this.closed)throw new s.a;return super._trySubscribe(t)}_subscribe(t){if(this.closed)throw new s.a;return this.hasError?(t.error(this.thrownError),o.a.EMPTY):this.isStopped?(t.complete(),o.a.EMPTY):(this.observers.push(t),new a.a(this,t))}asObservable(){const t=new r.a;return t.source=this,t}}return t.create=(t,e)=>new h(t,e),t})();class h extends u{constructor(t,e){super(),this.destination=t,this.source=e}next(t){const{destination:e}=this;e&&e.next&&e.next(t)}error(t){const{destination:e}=this;e&&e.error&&this.destination.error(t)}complete(){const{destination:t}=this;t&&t.complete&&this.destination.complete()}_subscribe(t){const{source:e}=this;return e?this.source.subscribe(t):o.a.EMPTY}}},XoHu:function(t,e,n){"use strict";function r(t){return null!==t&&"object"==typeof t}n.d(e,"a",function(){return r})},Ylt2:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("quSY");class i extends r.a{constructor(t,e){super(),this.subject=t,this.subscriber=e,this.closed=!1}unsubscribe(){if(this.closed)return;this.closed=!0;const t=this.subject,e=t.observers;if(this.subject=null,!e||0===e.length||t.isStopped||t.closed)return;const n=e.indexOf(this.subscriber);-1!==n&&e.splice(n,1)}}},bHdf:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n("5+tZ"),i=n("SpAZ");function o(t=Number.POSITIVE_INFINITY){return Object(r.a)(i.a,t)}},c2HN:function(t,e,n){"use strict";function r(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}n.d(e,"a",function(){return r})},fXoL:function(t,e,n){"use strict";n.d(e,"a",function(){return en}),n.d(e,"b",function(){return dc}),n.d(e,"c",function(){return ac}),n.d(e,"d",function(){return oc}),n.d(e,"e",function(){return sc}),n.d(e,"f",function(){return ol}),n.d(e,"g",function(){return Kc}),n.d(e,"h",function(){return la}),n.d(e,"i",function(){return Tc}),n.d(e,"j",function(){return Ds}),n.d(e,"k",function(){return mc}),n.d(e,"l",function(){return js}),n.d(e,"m",function(){return vr}),n.d(e,"n",function(){return Fa}),n.d(e,"o",function(){return ro}),n.d(e,"p",function(){return wn}),n.d(e,"q",function(){return E}),n.d(e,"r",function(){return tn}),n.d(e,"s",function(){return bo}),n.d(e,"t",function(){return na}),n.d(e,"u",function(){return ia}),n.d(e,"v",function(){return fc}),n.d(e,"w",function(){return ba}),n.d(e,"x",function(){return Yc}),n.d(e,"y",function(){return va}),n.d(e,"z",function(){return Gc}),n.d(e,"A",function(){return Sc}),n.d(e,"B",function(){return Tn}),n.d(e,"C",function(){return hc}),n.d(e,"D",function(){return uc}),n.d(e,"E",function(){return Bs}),n.d(e,"F",function(){return Fs}),n.d(e,"G",function(){return Tr}),n.d(e,"H",function(){return Vs}),n.d(e,"I",function(){return dr}),n.d(e,"J",function(){return Cn}),n.d(e,"K",function(){return tl}),n.d(e,"L",function(){return ma}),n.d(e,"M",function(){return Dc}),n.d(e,"N",function(){return nn}),n.d(e,"O",function(){return Gs}),n.d(e,"P",function(){return qs}),n.d(e,"Q",function(){return wa}),n.d(e,"R",function(){return O}),n.d(e,"S",function(){return $c}),n.d(e,"T",function(){return Vc}),n.d(e,"U",function(){return p}),n.d(e,"V",function(){return Uc}),n.d(e,"W",function(){return rl}),n.d(e,"X",function(){return Lc}),n.d(e,"Y",function(){return pc}),n.d(e,"Z",function(){return oo}),n.d(e,"ab",function(){return vs}),n.d(e,"bb",function(){return ur}),n.d(e,"cb",function(){return Hn}),n.d(e,"db",function(){return Ln}),n.d(e,"eb",function(){return zn}),n.d(e,"fb",function(){return Vn}),n.d(e,"gb",function(){return Bn}),n.d(e,"hb",function(){return Fn}),n.d(e,"ib",function(){return Un}),n.d(e,"jb",function(){return ms}),n.d(e,"kb",function(){return nl}),n.d(e,"lb",function(){return gs}),n.d(e,"mb",function(){return _s}),n.d(e,"nb",function(){return jn}),n.d(e,"ob",function(){return L}),n.d(e,"pb",function(){return Ao}),n.d(e,"qb",function(){return $o}),n.d(e,"rb",function(){return qo}),n.d(e,"sb",function(){return Go}),n.d(e,"tb",function(){return fs}),n.d(e,"ub",function(){return Ct}),n.d(e,"vb",function(){return u}),n.d(e,"wb",function(){return Nn}),n.d(e,"xb",function(){return wo}),n.d(e,"yb",function(){return yt}),n.d(e,"zb",function(){return Ms}),n.d(e,"Ab",function(){return li}),n.d(e,"Bb",function(){return Do}),n.d(e,"Cb",function(){return ns}),n.d(e,"Db",function(){return Ja}),n.d(e,"Eb",function(){return H}),n.d(e,"Fb",function(){return tt}),n.d(e,"Gb",function(){return g}),n.d(e,"Hb",function(){return _}),n.d(e,"Ib",function(){return Y}),n.d(e,"Jb",function(){return et}),n.d(e,"Kb",function(){return Lo}),n.d(e,"Lb",function(){return Uo}),n.d(e,"Mb",function(){return Bo}),n.d(e,"Nb",function(){return Fo}),n.d(e,"Ob",function(){return Vo}),n.d(e,"Pb",function(){return Xe}),n.d(e,"Qb",function(){return us}),n.d(e,"Rb",function(){return vn}),n.d(e,"Sb",function(){return Ye}),n.d(e,"Tb",function(){return ic}),n.d(e,"Ub",function(){return Wo}),n.d(e,"Vb",function(){return tc}),n.d(e,"Wb",function(){return Ko}),n.d(e,"Xb",function(){return Qo}),n.d(e,"Yb",function(){return Yo}),n.d(e,"Zb",function(){return jo}),n.d(e,"ac",function(){return ja}),n.d(e,"bc",function(){return za}),n.d(e,"cc",function(){return Ya}),n.d(e,"dc",function(){return No}),n.d(e,"ec",function(){return qt}),n.d(e,"fc",function(){return pr}),n.d(e,"gc",function(){return fr}),n.d(e,"hc",function(){return Q}),n.d(e,"ic",function(){return Ro}),n.d(e,"jc",function(){return as}),n.d(e,"kc",function(){return cs}),n.d(e,"lc",function(){return ls}),n.d(e,"mc",function(){return Qa});var r=n("XNiG"),i=n("quSY"),o=n("HDdC"),s=n("VRyK"),a=n("w1tV");function c(t){for(let e in t)if(t[e]===c)return e;throw Error("Could not find renamed property on target object.")}function l(t,e){for(const n in e)e.hasOwnProperty(n)&&!t.hasOwnProperty(n)&&(t[n]=e[n])}function u(t){if("string"==typeof t)return t;if(Array.isArray(t))return"["+t.map(u).join(", ")+"]";if(null==t)return""+t;if(t.overriddenName)return`${t.overriddenName}`;if(t.name)return`${t.name}`;const e=t.toString();if(null==e)return""+e;const n=e.indexOf("\n");return-1===n?e:e.substring(0,n)}function h(t,e){return null==t||""===t?null===e?"":e:null==e||""===e?t:t+" "+e}const d=c({__forward_ref__:c});function p(t){return t.__forward_ref__=p,t.toString=function(){return u(this())},t}function f(t){return m(t)?t():t}function m(t){return"function"==typeof t&&t.hasOwnProperty(d)&&t.__forward_ref__===p}function g(t){return{token:t.token,providedIn:t.providedIn||null,factory:t.factory,value:void 0}}function _(t){return{factory:t.factory,providers:t.providers||[],imports:t.imports||[]}}function y(t){return v(t,x)||v(t,T)}function v(t,e){return t.hasOwnProperty(e)?t[e]:null}function b(t){return t&&(t.hasOwnProperty(w)||t.hasOwnProperty(C))?t[w]:null}const x=c({"\u0275prov":c}),w=c({"\u0275inj":c}),T=c({ngInjectableDef:c}),C=c({ngInjectorDef:c});var E=function(t){return t[t.Default=0]="Default",t[t.Host=1]="Host",t[t.Self=2]="Self",t[t.SkipSelf=4]="SkipSelf",t[t.Optional=8]="Optional",t}({});let S;function I(t){const e=S;return S=t,e}function k(t,e,n){const r=y(t);if(r&&"root"==r.providedIn)return void 0===r.value?r.value=r.factory():r.value;if(n&E.Optional)return null;if(void 0!==e)return e;throw new Error(`Injector: NOT_FOUND [${u(t)}]`)}function A(t){return{toString:t}.toString()}var M=function(t){return t[t.OnPush=0]="OnPush",t[t.Default=1]="Default",t}({}),O=function(t){return t[t.Emulated=0]="Emulated",t[t.None=2]="None",t[t.ShadowDom=3]="ShadowDom",t}({});const P="undefined"!=typeof globalThis&&globalThis,D="undefined"!=typeof window&&window,R="undefined"!=typeof self&&"undefined"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope&&self,N="undefined"!=typeof global&&global,L=P||N||D||R,j={},z=[],F=c({"\u0275cmp":c}),B=c({"\u0275dir":c}),U=c({"\u0275pipe":c}),V=c({"\u0275mod":c}),q=c({"\u0275loc":c}),G=c({"\u0275fac":c}),$=c({__NG_ELEMENT_ID__:c});let W=0;function H(t){return A(()=>{const e={},n={type:t.type,providersResolver:null,decls:t.decls,vars:t.vars,factory:null,template:t.template||null,consts:t.consts||null,ngContentSelectors:t.ngContentSelectors,hostBindings:t.hostBindings||null,hostVars:t.hostVars||0,hostAttrs:t.hostAttrs||null,contentQueries:t.contentQueries||null,declaredInputs:e,inputs:null,outputs:null,exportAs:t.exportAs||null,onPush:t.changeDetection===M.OnPush,directiveDefs:null,pipeDefs:null,selectors:t.selectors||z,viewQuery:t.viewQuery||null,features:t.features||null,data:t.data||{},encapsulation:t.encapsulation||O.Emulated,id:"c",styles:t.styles||z,_:null,setInput:null,schemas:t.schemas||null,tView:null},r=t.directives,i=t.features,o=t.pipes;return n.id+=W++,n.inputs=J(t.inputs,e),n.outputs=J(t.outputs),i&&i.forEach(t=>t(n)),n.directiveDefs=r?()=>("function"==typeof r?r():r).map(Z):null,n.pipeDefs=o?()=>("function"==typeof o?o():o).map(K):null,n})}function Z(t){return nt(t)||function(t){return t[B]||null}(t)}function K(t){return function(t){return t[U]||null}(t)}const X={};function Y(t){const e={type:t.type,bootstrap:t.bootstrap||z,declarations:t.declarations||z,imports:t.imports||z,exports:t.exports||z,transitiveCompileScopes:null,schemas:t.schemas||null,id:t.id||null};return null!=t.id&&A(()=>{X[t.id]=t.type}),e}function Q(t,e){return A(()=>{const n=rt(t,!0);n.declarations=e.declarations||z,n.imports=e.imports||z,n.exports=e.exports||z})}function J(t,e){if(null==t)return j;const n={};for(const r in t)if(t.hasOwnProperty(r)){let i=t[r],o=i;Array.isArray(i)&&(o=i[1],i=i[0]),n[i]=r,e&&(e[i]=o)}return n}const tt=H;function et(t){return{type:t.type,name:t.name,factory:null,pure:!1!==t.pure,onDestroy:t.type.prototype.ngOnDestroy||null}}function nt(t){return t[F]||null}function rt(t,e){const n=t[V]||null;if(!n&&!0===e)throw new Error(`Type ${u(t)} does not have '\u0275mod' property.`);return n}const it=20,ot=10;function st(t){return Array.isArray(t)&&"object"==typeof t[1]}function at(t){return Array.isArray(t)&&!0===t[1]}function ct(t){return 0!=(8&t.flags)}function lt(t){return 2==(2&t.flags)}function ut(t){return 1==(1&t.flags)}function ht(t){return null!==t.template}function dt(t,e){return t.hasOwnProperty(G)?t[G]:null}class pt extends Error{constructor(t,e){super(function(t,e){return`${t?`NG0${t}: `:""}${e}`}(t,e)),this.code=t}}function ft(t){return"string"==typeof t?t:null==t?"":String(t)}function mt(t){return"function"==typeof t?t.name||t.toString():"object"==typeof t&&null!=t&&"function"==typeof t.type?t.type.name||t.type.toString():ft(t)}function gt(t,e){const n=e?` in ${e}`:"";throw new pt("201",`No provider for ${mt(t)} found${n}`)}class _t{constructor(t,e,n){this.previousValue=t,this.currentValue=e,this.firstChange=n}isFirstChange(){return this.firstChange}}function yt(){return vt}function vt(t){return t.type.prototype.ngOnChanges&&(t.setInput=xt),bt}function bt(){const t=wt(this),e=null==t?void 0:t.current;if(e){const n=t.previous;if(n===j)t.previous=e;else for(let t in e)n[t]=e[t];t.current=null,this.ngOnChanges(e)}}function xt(t,e,n,r){const i=wt(t)||function(t,e){return t.__ngSimpleChanges__=e}(t,{previous:j,current:null}),o=i.current||(i.current={}),s=i.previous,a=this.declaredInputs[n],c=s[a];o[a]=new _t(c&&c.currentValue,e,s===j),t[r]=e}function wt(t){return t.__ngSimpleChanges__||null}let Tt;function Ct(t){Tt=t}function Et(){return void 0!==Tt?Tt:"undefined"!=typeof document?document:void 0}function St(t){return!!t.listen}yt.ngInherit=!0;const It={createRenderer:(t,e)=>Et()};function kt(t){for(;Array.isArray(t);)t=t[0];return t}function At(t,e){return kt(e[t])}function Mt(t,e){return kt(e[t.index])}function Ot(t,e){return t.data[e]}function Pt(t,e){const n=e[t];return st(n)?n:n[0]}function Dt(t){const e=function(t){return t.__ngContext__||null}(t);return e?Array.isArray(e)?e:e.lView:null}function Rt(t){return 4==(4&t[2])}function Nt(t){return 128==(128&t[2])}function Lt(t,e){return null==e?null:t[e]}function jt(t){t[18]=0}function zt(t,e){t[5]+=e;let n=t,r=t[3];for(;null!==r&&(1===e&&1===n[5]||-1===e&&0===n[5]);)r[5]+=e,n=r,r=r[3]}const Ft={lFrame:ae(null),bindingsEnabled:!0,isInCheckNoChangesMode:!1};function Bt(){return Ft.bindingsEnabled}function Ut(){return Ft.lFrame.lView}function Vt(){return Ft.lFrame.tView}function qt(t){Ft.lFrame.contextLView=t}function Gt(){let t=$t();for(;null!==t&&64===t.type;)t=t.parent;return t}function $t(){return Ft.lFrame.currentTNode}function Wt(t,e){const n=Ft.lFrame;n.currentTNode=t,n.isParent=e}function Ht(){return Ft.lFrame.isParent}function Zt(){Ft.lFrame.isParent=!1}function Kt(){return Ft.isInCheckNoChangesMode}function Xt(t){Ft.isInCheckNoChangesMode=t}function Yt(){const t=Ft.lFrame;let e=t.bindingRootIndex;return-1===e&&(e=t.bindingRootIndex=t.tView.bindingStartIndex),e}function Qt(){return Ft.lFrame.bindingIndex++}function Jt(t,e){const n=Ft.lFrame;n.bindingIndex=n.bindingRootIndex=t,te(e)}function te(t){Ft.lFrame.currentDirectiveIndex=t}function ee(){return Ft.lFrame.currentQueryIndex}function ne(t){Ft.lFrame.currentQueryIndex=t}function re(t){const e=t[1];return 2===e.type?e.declTNode:1===e.type?t[6]:null}function ie(t,e,n){if(n&E.SkipSelf){let r=e,i=t;for(;r=r.parent,!(null!==r||n&E.Host||(r=re(i),null===r)||(i=i[15],10&r.type)););if(null===r)return!1;e=r,t=i}const r=Ft.lFrame=se();return r.currentTNode=e,r.lView=t,!0}function oe(t){const e=se(),n=t[1];Ft.lFrame=e,e.currentTNode=n.firstChild,e.lView=t,e.tView=n,e.contextLView=t,e.bindingIndex=n.bindingStartIndex,e.inI18n=!1}function se(){const t=Ft.lFrame,e=null===t?null:t.child;return null===e?ae(t):e}function ae(t){const e={currentTNode:null,isParent:!0,lView:null,tView:null,selectedIndex:-1,contextLView:null,elementDepthCount:0,currentNamespace:null,currentDirectiveIndex:-1,bindingRootIndex:-1,bindingIndex:-1,currentQueryIndex:0,parent:t,child:null,inI18n:!1};return null!==t&&(t.child=e),e}function ce(){const t=Ft.lFrame;return Ft.lFrame=t.parent,t.currentTNode=null,t.lView=null,t}const le=ce;function ue(){const t=ce();t.isParent=!0,t.tView=null,t.selectedIndex=-1,t.contextLView=null,t.elementDepthCount=0,t.currentDirectiveIndex=-1,t.currentNamespace=null,t.bindingRootIndex=-1,t.bindingIndex=-1,t.currentQueryIndex=0}function he(){return Ft.lFrame.selectedIndex}function de(t){Ft.lFrame.selectedIndex=t}function pe(){const t=Ft.lFrame;return Ot(t.tView,t.selectedIndex)}function fe(t,e){for(let n=e.directiveStart,r=e.directiveEnd;n<r;n++){const e=t.data[n].type.prototype,{ngAfterContentInit:r,ngAfterContentChecked:i,ngAfterViewInit:o,ngAfterViewChecked:s,ngOnDestroy:a}=e;r&&(t.contentHooks||(t.contentHooks=[])).push(-n,r),i&&((t.contentHooks||(t.contentHooks=[])).push(n,i),(t.contentCheckHooks||(t.contentCheckHooks=[])).push(n,i)),o&&(t.viewHooks||(t.viewHooks=[])).push(-n,o),s&&((t.viewHooks||(t.viewHooks=[])).push(n,s),(t.viewCheckHooks||(t.viewCheckHooks=[])).push(n,s)),null!=a&&(t.destroyHooks||(t.destroyHooks=[])).push(n,a)}}function me(t,e,n){ye(t,e,3,n)}function ge(t,e,n,r){(3&t[2])===n&&ye(t,e,n,r)}function _e(t,e){let n=t[2];(3&n)===e&&(n&=2047,n+=1,t[2]=n)}function ye(t,e,n,r){const i=null!=r?r:-1,o=e.length-1;let s=0;for(let a=void 0!==r?65535&t[18]:0;a<o;a++)if("number"==typeof e[a+1]){if(s=e[a],null!=r&&s>=r)break}else e[a]<0&&(t[18]+=65536),(s<i||-1==i)&&(ve(t,n,e,a),t[18]=(4294901760&t[18])+a+2),a++}function ve(t,e,n,r){const i=n[r]<0,o=n[r+1],s=t[i?-n[r]:n[r]];i?t[2]>>11<t[18]>>16&&(3&t[2])===e&&(t[2]+=2048,o.call(s)):o.call(s)}const be=-1;class xe{constructor(t,e,n){this.factory=t,this.resolving=!1,this.canSeeViewProviders=e,this.injectImpl=n}}function we(t,e,n){const r=St(t);let i=0;for(;i<n.length;){const o=n[i];if("number"==typeof o){if(0!==o)break;i++;const s=n[i++],a=n[i++],c=n[i++];r?t.setAttribute(e,a,c,s):e.setAttributeNS(s,a,c)}else{const s=o,a=n[++i];Ce(s)?r&&t.setProperty(e,s,a):r?t.setAttribute(e,s,a):e.setAttribute(s,a),i++}}return i}function Te(t){return 3===t||4===t||6===t}function Ce(t){return 64===t.charCodeAt(0)}function Ee(t,e){if(null===e||0===e.length);else if(null===t||0===t.length)t=e.slice();else{let n=-1;for(let r=0;r<e.length;r++){const i=e[r];"number"==typeof i?n=i:0===n||Se(t,n,i,null,-1===n||2===n?e[++r]:null)}}return t}function Se(t,e,n,r,i){let o=0,s=t.length;if(-1===e)s=-1;else for(;o<t.length;){const n=t[o++];if("number"==typeof n){if(n===e){s=-1;break}if(n>e){s=o-1;break}}}for(;o<t.length;){const e=t[o];if("number"==typeof e)break;if(e===n){if(null===r)return void(null!==i&&(t[o+1]=i));if(r===t[o+1])return void(t[o+2]=i)}o++,null!==r&&o++,null!==i&&o++}-1!==s&&(t.splice(s,0,e),o=s+1),t.splice(o++,0,n),null!==r&&t.splice(o++,0,r),null!==i&&t.splice(o++,0,i)}function Ie(t){return t!==be}function ke(t){return 32767&t}function Ae(t,e){let n=t>>16,r=e;for(;n>0;)r=r[15],n--;return r}let Me=!0;function Oe(t){const e=Me;return Me=t,e}let Pe=0;function De(t,e){const n=Ne(t,e);if(-1!==n)return n;const r=e[1];r.firstCreatePass&&(t.injectorIndex=e.length,Re(r.data,t),Re(e,null),Re(r.blueprint,null));const i=Le(t,e),o=t.injectorIndex;if(Ie(i)){const t=ke(i),n=Ae(i,e),r=n[1].data;for(let i=0;i<8;i++)e[o+i]=n[t+i]|r[t+i]}return e[o+8]=i,o}function Re(t,e){t.push(0,0,0,0,0,0,0,0,e)}function Ne(t,e){return-1===t.injectorIndex||t.parent&&t.parent.injectorIndex===t.injectorIndex||null===e[t.injectorIndex+8]?-1:t.injectorIndex}function Le(t,e){if(t.parent&&-1!==t.parent.injectorIndex)return t.parent.injectorIndex;let n=0,r=null,i=e;for(;null!==i;){const t=i[1],e=t.type;if(r=2===e?t.declTNode:1===e?i[6]:null,null===r)return be;if(n++,i=i[15],-1!==r.injectorIndex)return r.injectorIndex|n<<16}return be}function je(t,e,n){!function(t,e,n){let r;"string"==typeof n?r=n.charCodeAt(0)||0:n.hasOwnProperty($)&&(r=n[$]),null==r&&(r=n[$]=Pe++);const i=255&r;e.data[t+(i>>5)]|=1<<i}(t,e,n)}function ze(t,e,n){if(n&E.Optional)return t;gt(e,"NodeInjector")}function Fe(t,e,n,r){if(n&E.Optional&&void 0===r&&(r=null),0==(n&(E.Self|E.Host))){const i=t[9],o=I(void 0);try{return i?i.get(e,r,n&E.Optional):k(e,r,n&E.Optional)}finally{I(o)}}return ze(r,e,n)}function Be(t,e,n,r=E.Default,i){if(null!==t){const o=function(t){if("string"==typeof t)return t.charCodeAt(0)||0;const e=t.hasOwnProperty($)?t[$]:void 0;return"number"==typeof e?e>=0?255&e:Ve:e}(n);if("function"==typeof o){if(!ie(e,t,r))return r&E.Host?ze(i,n,r):Fe(e,n,r,i);try{const t=o();if(null!=t||r&E.Optional)return t;gt(n)}finally{le()}}else if("number"==typeof o){let i=null,s=Ne(t,e),a=be,c=r&E.Host?e[16][6]:null;for((-1===s||r&E.SkipSelf)&&(a=-1===s?Le(t,e):e[s+8],a!==be&&He(r,!1)?(i=e[1],s=ke(a),e=Ae(a,e)):s=-1);-1!==s;){const t=e[1];if(We(o,s,t.data)){const t=qe(s,e,n,i,r,c);if(t!==Ue)return t}a=e[s+8],a!==be&&He(r,e[1].data[s+8]===c)&&We(o,s,e)?(i=t,s=ke(a),e=Ae(a,e)):s=-1}}}return Fe(e,n,r,i)}const Ue={};function Ve(){return new Ze(Gt(),Ut())}function qe(t,e,n,r,i,o){const s=e[1],a=s.data[t+8],c=Ge(a,s,n,null==r?lt(a)&&Me:r!=s&&0!=(3&a.type),i&E.Host&&o===a);return null!==c?$e(e,s,c,a):Ue}function Ge(t,e,n,r,i){const o=t.providerIndexes,s=e.data,a=1048575&o,c=t.directiveStart,l=o>>20,u=i?a+l:t.directiveEnd;for(let h=r?a:a+l;h<u;h++){const t=s[h];if(h<c&&n===t||h>=c&&t.type===n)return h}if(i){const t=s[c];if(t&&ht(t)&&t.type===n)return c}return null}function $e(t,e,n,r){let i=t[n];const o=e.data;if(i instanceof xe){const s=i;s.resolving&&function(t,e){throw new pt("200",`Circular dependency in DI detected for ${t}`)}(mt(o[n]));const a=Oe(s.canSeeViewProviders);s.resolving=!0;const c=s.injectImpl?I(s.injectImpl):null;ie(t,r,E.Default);try{i=t[n]=s.factory(void 0,o,t,r),e.firstCreatePass&&n>=r.directiveStart&&function(t,e,n){const{ngOnChanges:r,ngOnInit:i,ngDoCheck:o}=e.type.prototype;if(r){const r=vt(e);(n.preOrderHooks||(n.preOrderHooks=[])).push(t,r),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,r)}i&&(n.preOrderHooks||(n.preOrderHooks=[])).push(0-t,i),o&&((n.preOrderHooks||(n.preOrderHooks=[])).push(t,o),(n.preOrderCheckHooks||(n.preOrderCheckHooks=[])).push(t,o))}(n,o[n],e)}finally{null!==c&&I(c),Oe(a),s.resolving=!1,le()}}return i}function We(t,e,n){return!!(n[e+(t>>5)]&1<<t)}function He(t,e){return!(t&E.Self||t&E.Host&&e)}class Ze{constructor(t,e){this._tNode=t,this._lView=e}get(t,e){return Be(this._tNode,this._lView,t,void 0,e)}}function Ke(t){const e=t;if(m(t))return()=>{const t=Ke(f(e));return t?t():null};let n=dt(e);if(null===n){const t=b(e);n=t&&t.factory}return n||null}function Xe(t){return A(()=>{const e=t.prototype.constructor,n=e[G]||Ke(e),r=Object.prototype;let i=Object.getPrototypeOf(t.prototype).constructor;for(;i&&i!==r;){const t=i[G]||Ke(i);if(t&&t!==n)return t;i=Object.getPrototypeOf(i)}return t=>new t})}function Ye(t){return function(t,e){if("class"===e)return t.classes;if("style"===e)return t.styles;const n=t.attrs;if(n){const t=n.length;let r=0;for(;r<t;){const i=n[r];if(Te(i))break;if(0===i)r+=2;else if("number"==typeof i)for(r++;r<t&&"string"==typeof n[r];)r++;else{if(i===e)return n[r+1];r+=2}}}return null}(Gt(),t)}const Qe="__parameters__";function Je(t,e,n){return A(()=>{const r=function(t){return function(...e){if(t){const n=t(...e);for(const t in n)this[t]=n[t]}}}(e);function i(...t){if(this instanceof i)return r.apply(this,t),this;const e=new i(...t);return n.annotation=e,n;function n(t,n,r){const i=t.hasOwnProperty(Qe)?t[Qe]:Object.defineProperty(t,Qe,{value:[]})[Qe];for(;i.length<=r;)i.push(null);return(i[r]=i[r]||[]).push(e),t}}return n&&(i.prototype=Object.create(n.prototype)),i.prototype.ngMetadataName=t,i.annotationCls=i,i})}class tn{constructor(t,e){this._desc=t,this.ngMetadataName="InjectionToken",this.\u0275prov=void 0,"number"==typeof e?this.__NG_ELEMENT_ID__=e:void 0!==e&&(this.\u0275prov=g({token:this,providedIn:e.providedIn||"root",factory:e.factory}))}toString(){return`InjectionToken ${this._desc}`}}const en=new tn("AnalyzeForEntryComponents"),nn=Function;function rn(t,e){void 0===e&&(e=t);for(let n=0;n<t.length;n++){let r=t[n];Array.isArray(r)?(e===t&&(e=t.slice(0,n)),rn(r,e)):e!==t&&e.push(r)}return e}function on(t,e){t.forEach(t=>Array.isArray(t)?on(t,e):e(t))}function sn(t,e,n){e>=t.length?t.push(n):t.splice(e,0,n)}function an(t,e){return e>=t.length-1?t.pop():t.splice(e,1)[0]}function cn(t,e){const n=[];for(let r=0;r<t;r++)n.push(e);return n}function ln(t,e,n){let r=hn(t,e);return r>=0?t[1|r]=n:(r=~r,function(t,e,n,r){let i=t.length;if(i==e)t.push(n,r);else if(1===i)t.push(r,t[0]),t[0]=n;else{for(i--,t.push(t[i-1],t[i]);i>e;)t[i]=t[i-2],i--;t[e]=n,t[e+1]=r}}(t,r,e,n)),r}function un(t,e){const n=hn(t,e);if(n>=0)return t[1|n]}function hn(t,e){return function(t,e,n){let r=0,i=t.length>>1;for(;i!==r;){const n=r+(i-r>>1),o=t[n<<1];if(e===o)return n<<1;o>e?i=n:r=n+1}return~(i<<1)}(t,e)}const dn={},pn=/\n/gm,fn="__source",mn=c({provide:String,useValue:c});let gn;function _n(t){const e=gn;return gn=t,e}function yn(t,e=E.Default){if(void 0===gn)throw new Error("inject() must be called from an injection context");return null===gn?k(t,void 0,e):gn.get(t,e&E.Optional?null:void 0,e)}function vn(t,e=E.Default){return(S||yn)(f(t),e)}function bn(t){const e=[];for(let n=0;n<t.length;n++){const r=f(t[n]);if(Array.isArray(r)){if(0===r.length)throw new Error("Arguments array must have arguments.");let t,n=E.Default;for(let e=0;e<r.length;e++){const i=r[e],o=i.__NG_DI_FLAG__;"number"==typeof o?-1===o?t=i.token:n|=o:t=i}e.push(vn(t,n))}else e.push(vn(r))}return e}function xn(t,e){return t.__NG_DI_FLAG__=e,t.prototype.__NG_DI_FLAG__=e,t}const wn=xn(Je("Inject",t=>({token:t})),-1),Tn=xn(Je("Optional"),8),Cn=xn(Je("SkipSelf"),4);let En,Sn;function In(t){var e;return(null===(e=function(){if(void 0===En&&(En=null,L.trustedTypes))try{En=L.trustedTypes.createPolicy("angular",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch(e){}return En}())||void 0===e?void 0:e.createHTML(t))||t}function kn(t){var e;return(null===(e=function(){if(void 0===Sn&&(Sn=null,L.trustedTypes))try{Sn=L.trustedTypes.createPolicy("angular#unsafe-bypass",{createHTML:t=>t,createScript:t=>t,createScriptURL:t=>t})}catch(e){}return Sn}())||void 0===e?void 0:e.createHTML(t))||t}class An{constructor(t){this.changingThisBreaksApplicationSecurity=t}toString(){return`SafeValue must use [property]=binding: ${this.changingThisBreaksApplicationSecurity} (see https://g.co/ng/security#xss)`}}class Mn extends An{getTypeName(){return"HTML"}}class On extends An{getTypeName(){return"Style"}}class Pn extends An{getTypeName(){return"Script"}}class Dn extends An{getTypeName(){return"URL"}}class Rn extends An{getTypeName(){return"ResourceURL"}}function Nn(t){return t instanceof An?t.changingThisBreaksApplicationSecurity:t}function Ln(t,e){const n=jn(t);if(null!=n&&n!==e){if("ResourceURL"===n&&"URL"===e)return!0;throw new Error(`Required a safe ${e}, got a ${n} (see https://g.co/ng/security#xss)`)}return n===e}function jn(t){return t instanceof An&&t.getTypeName()||null}function zn(t){return new Mn(t)}function Fn(t){return new On(t)}function Bn(t){return new Pn(t)}function Un(t){return new Dn(t)}function Vn(t){return new Rn(t)}class qn{constructor(t){this.inertDocumentHelper=t}getInertBodyElement(t){t="<body><remove></remove>"+t;try{const e=(new window.DOMParser).parseFromString(In(t),"text/html").body;return null===e?this.inertDocumentHelper.getInertBodyElement(t):(e.removeChild(e.firstChild),e)}catch(e){return null}}}class Gn{constructor(t){if(this.defaultDoc=t,this.inertDocument=this.defaultDoc.implementation.createHTMLDocument("sanitization-inert"),null==this.inertDocument.body){const t=this.inertDocument.createElement("html");this.inertDocument.appendChild(t);const e=this.inertDocument.createElement("body");t.appendChild(e)}}getInertBodyElement(t){const e=this.inertDocument.createElement("template");if("content"in e)return e.innerHTML=In(t),e;const n=this.inertDocument.createElement("body");return n.innerHTML=In(t),this.defaultDoc.documentMode&&this.stripCustomNsAttrs(n),n}stripCustomNsAttrs(t){const e=t.attributes;for(let r=e.length-1;0<r;r--){const n=e.item(r).name;"xmlns:ns1"!==n&&0!==n.indexOf("ns1:")||t.removeAttribute(n)}let n=t.firstChild;for(;n;)n.nodeType===Node.ELEMENT_NODE&&this.stripCustomNsAttrs(n),n=n.nextSibling}}const $n=/^(?:(?:https?|mailto|ftp|tel|file|sms):|[^&:/?#]*(?:[/?#]|$))/gi,Wn=/^data:(?:image\/(?:bmp|gif|jpeg|jpg|png|tiff|webp)|video\/(?:mpeg|mp4|ogg|webm)|audio\/(?:mp3|oga|ogg|opus));base64,[a-z0-9+\/]+=*$/i;function Hn(t){return(t=String(t)).match($n)||t.match(Wn)?t:"unsafe:"+t}function Zn(t){const e={};for(const n of t.split(","))e[n]=!0;return e}function Kn(...t){const e={};for(const n of t)for(const t in n)n.hasOwnProperty(t)&&(e[t]=!0);return e}const Xn=Zn("area,br,col,hr,img,wbr"),Yn=Zn("colgroup,dd,dt,li,p,tbody,td,tfoot,th,thead,tr"),Qn=Zn("rp,rt"),Jn=Kn(Qn,Yn),tr=Kn(Xn,Kn(Yn,Zn("address,article,aside,blockquote,caption,center,del,details,dialog,dir,div,dl,figure,figcaption,footer,h1,h2,h3,h4,h5,h6,header,hgroup,hr,ins,main,map,menu,nav,ol,pre,section,summary,table,ul")),Kn(Qn,Zn("a,abbr,acronym,audio,b,bdi,bdo,big,br,cite,code,del,dfn,em,font,i,img,ins,kbd,label,map,mark,picture,q,ruby,rp,rt,s,samp,small,source,span,strike,strong,sub,sup,time,track,tt,u,var,video")),Jn),er=Zn("background,cite,href,itemtype,longdesc,poster,src,xlink:href"),nr=Zn("srcset"),rr=Kn(er,nr,Zn("abbr,accesskey,align,alt,autoplay,axis,bgcolor,border,cellpadding,cellspacing,class,clear,color,cols,colspan,compact,controls,coords,datetime,default,dir,download,face,headers,height,hidden,hreflang,hspace,ismap,itemscope,itemprop,kind,label,lang,language,loop,media,muted,nohref,nowrap,open,preload,rel,rev,role,rows,rowspan,rules,scope,scrolling,shape,size,sizes,span,srclang,start,summary,tabindex,target,title,translate,type,usemap,valign,value,vspace,width"),Zn("aria-activedescendant,aria-atomic,aria-autocomplete,aria-busy,aria-checked,aria-colcount,aria-colindex,aria-colspan,aria-controls,aria-current,aria-describedby,aria-details,aria-disabled,aria-dropeffect,aria-errormessage,aria-expanded,aria-flowto,aria-grabbed,aria-haspopup,aria-hidden,aria-invalid,aria-keyshortcuts,aria-label,aria-labelledby,aria-level,aria-live,aria-modal,aria-multiline,aria-multiselectable,aria-orientation,aria-owns,aria-placeholder,aria-posinset,aria-pressed,aria-readonly,aria-relevant,aria-required,aria-roledescription,aria-rowcount,aria-rowindex,aria-rowspan,aria-selected,aria-setsize,aria-sort,aria-valuemax,aria-valuemin,aria-valuenow,aria-valuetext")),ir=Zn("script,style,template");class or{constructor(){this.sanitizedSomething=!1,this.buf=[]}sanitizeChildren(t){let e=t.firstChild,n=!0;for(;e;)if(e.nodeType===Node.ELEMENT_NODE?n=this.startElement(e):e.nodeType===Node.TEXT_NODE?this.chars(e.nodeValue):this.sanitizedSomething=!0,n&&e.firstChild)e=e.firstChild;else for(;e;){e.nodeType===Node.ELEMENT_NODE&&this.endElement(e);let t=this.checkClobberedElement(e,e.nextSibling);if(t){e=t;break}e=this.checkClobberedElement(e,e.parentNode)}return this.buf.join("")}startElement(t){const e=t.nodeName.toLowerCase();if(!tr.hasOwnProperty(e))return this.sanitizedSomething=!0,!ir.hasOwnProperty(e);this.buf.push("<"),this.buf.push(e);const n=t.attributes;for(let i=0;i<n.length;i++){const t=n.item(i),e=t.name,o=e.toLowerCase();if(!rr.hasOwnProperty(o)){this.sanitizedSomething=!0;continue}let s=t.value;er[o]&&(s=Hn(s)),nr[o]&&(r=s,s=(r=String(r)).split(",").map(t=>Hn(t.trim())).join(", ")),this.buf.push(" ",e,'="',cr(s),'"')}var r;return this.buf.push(">"),!0}endElement(t){const e=t.nodeName.toLowerCase();tr.hasOwnProperty(e)&&!Xn.hasOwnProperty(e)&&(this.buf.push("</"),this.buf.push(e),this.buf.push(">"))}chars(t){this.buf.push(cr(t))}checkClobberedElement(t,e){if(e&&(t.compareDocumentPosition(e)&Node.DOCUMENT_POSITION_CONTAINED_BY)===Node.DOCUMENT_POSITION_CONTAINED_BY)throw new Error(`Failed to sanitize html because the element is clobbered: ${t.outerHTML}`);return e}}const sr=/[\uD800-\uDBFF][\uDC00-\uDFFF]/g,ar=/([^\#-~ |!])/g;function cr(t){return t.replace(/&/g,"&amp;").replace(sr,function(t){return"&#"+(1024*(t.charCodeAt(0)-55296)+(t.charCodeAt(1)-56320)+65536)+";"}).replace(ar,function(t){return"&#"+t.charCodeAt(0)+";"}).replace(/</g,"&lt;").replace(/>/g,"&gt;")}let lr;function ur(t,e){let n=null;try{lr=lr||function(t){const e=new Gn(t);return function(){try{return!!(new window.DOMParser).parseFromString(In(""),"text/html")}catch(t){return!1}}()?new qn(e):e}(t);let r=e?String(e):"";n=lr.getInertBodyElement(r);let i=5,o=r;do{if(0===i)throw new Error("Failed to sanitize html because the input is unstable");i--,r=o,o=n.innerHTML,n=lr.getInertBodyElement(r)}while(r!==o);return In((new or).sanitizeChildren(hr(n)||n))}finally{if(n){const t=hr(n)||n;for(;t.firstChild;)t.removeChild(t.firstChild)}}}function hr(t){return"content"in t&&function(t){return t.nodeType===Node.ELEMENT_NODE&&"TEMPLATE"===t.nodeName}(t)?t.content:null}var dr=function(t){return t[t.NONE=0]="NONE",t[t.HTML=1]="HTML",t[t.STYLE=2]="STYLE",t[t.SCRIPT=3]="SCRIPT",t[t.URL=4]="URL",t[t.RESOURCE_URL=5]="RESOURCE_URL",t}({});function pr(t){const e=mr();return e?kn(e.sanitize(dr.HTML,t)||""):Ln(t,"HTML")?kn(Nn(t)):ur(Et(),ft(t))}function fr(t){const e=mr();return e?e.sanitize(dr.URL,t)||"":Ln(t,"URL")?Nn(t):Hn(ft(t))}function mr(){const t=Ut();return t&&t[12]}function gr(t){return t.ngDebugContext}function _r(t){return t.ngOriginalError}function yr(t,...e){t.error(...e)}class vr{constructor(){this._console=console}handleError(t){const e=this._findOriginalError(t),n=this._findContext(t),r=function(t){return t.ngErrorLogger||yr}(t);r(this._console,"ERROR",t),e&&r(this._console,"ORIGINAL ERROR",e),n&&r(this._console,"ERROR CONTEXT",n)}_findContext(t){return t?gr(t)?gr(t):this._findContext(_r(t)):null}_findOriginalError(t){let e=_r(t);for(;e&&_r(e);)e=_r(e);return e}}function br(t,e){t.__ngContext__=e}const xr=(()=>("undefined"!=typeof requestAnimationFrame&&requestAnimationFrame||setTimeout).bind(L))();function wr(t){return t instanceof Function?t():t}var Tr=function(t){return t[t.Important=1]="Important",t[t.DashCase=2]="DashCase",t}({});function Cr(t,e){return(void 0)(t,e)}function Er(t){const e=t[3];return at(e)?e[3]:e}function Sr(t){return kr(t[13])}function Ir(t){return kr(t[4])}function kr(t){for(;null!==t&&!at(t);)t=t[4];return t}function Ar(t,e,n,r,i){if(null!=r){let o,s=!1;at(r)?o=r:st(r)&&(s=!0,r=r[0]);const a=kt(r);0===t&&null!==n?null==i?jr(e,n,a):Lr(e,n,a,i||null,!0):1===t&&null!==n?Lr(e,n,a,i||null,!0):2===t?function(t,e,n){const r=Fr(t,e);r&&function(t,e,n,r){St(t)?t.removeChild(e,n,r):e.removeChild(n)}(t,r,e,n)}(e,a,s):3===t&&e.destroyNode(a),null!=o&&function(t,e,n,r,i){const o=n[7];o!==kt(n)&&Ar(e,t,r,o,i);for(let s=ot;s<n.length;s++){const i=n[s];Wr(i[1],i,t,e,r,o)}}(e,t,o,n,i)}}function Mr(t,e,n){return St(t)?t.createElement(e,n):null===n?t.createElement(e):t.createElementNS(n,e)}function Or(t,e){const n=t[9],r=n.indexOf(e),i=e[3];1024&e[2]&&(e[2]&=-1025,zt(i,-1)),n.splice(r,1)}function Pr(t,e){if(t.length<=ot)return;const n=ot+e,r=t[n];if(r){const o=r[17];null!==o&&o!==t&&Or(o,r),e>0&&(t[n-1][4]=r[4]);const s=an(t,ot+e);Wr(r[1],i=r,i[11],2,null,null),i[0]=null,i[6]=null;const a=s[19];null!==a&&a.detachView(s[1]),r[3]=null,r[4]=null,r[2]&=-129}var i;return r}function Dr(t,e){if(!(256&e[2])){const n=e[11];St(n)&&n.destroyNode&&Wr(t,e,n,3,null,null),function(t){let e=t[13];if(!e)return Rr(t[1],t);for(;e;){let n=null;if(st(e))n=e[13];else{const t=e[10];t&&(n=t)}if(!n){for(;e&&!e[4]&&e!==t;)st(e)&&Rr(e[1],e),e=e[3];null===e&&(e=t),st(e)&&Rr(e[1],e),n=e&&e[4]}e=n}}(e)}}function Rr(t,e){if(!(256&e[2])){e[2]&=-129,e[2]|=256,function(t,e){let n;if(null!=t&&null!=(n=t.destroyHooks))for(let r=0;r<n.length;r+=2){const t=e[n[r]];if(!(t instanceof xe)){const e=n[r+1];if(Array.isArray(e))for(let n=0;n<e.length;n+=2)e[n+1].call(t[e[n]]);else e.call(t)}}}(t,e),function(t,e){const n=t.cleanup,r=e[7];let i=-1;if(null!==n)for(let o=0;o<n.length-1;o+=2)if("string"==typeof n[o]){const t=n[o+1],s="function"==typeof t?t(e):kt(e[t]),a=r[i=n[o+2]],c=n[o+3];"boolean"==typeof c?s.removeEventListener(n[o],a,c):c>=0?r[i=c]():r[i=-c].unsubscribe(),o+=2}else{const t=r[i=n[o+1]];n[o].call(t)}if(null!==r){for(let t=i+1;t<r.length;t++)(0,r[t])();e[7]=null}}(t,e),1===e[1].type&&St(e[11])&&e[11].destroy();const n=e[17];if(null!==n&&at(e[3])){n!==e[3]&&Or(n,e);const r=e[19];null!==r&&r.detachView(t)}}}function Nr(t,e,n){return function(t,e,n){let r=e;for(;null!==r&&40&r.type;)r=(e=r).parent;if(null===r)return n[0];if(2&r.flags){const e=t.data[r.directiveStart].encapsulation;if(e===O.None||e===O.Emulated)return null}return Mt(r,n)}(t,e.parent,n)}function Lr(t,e,n,r,i){St(t)?t.insertBefore(e,n,r,i):e.insertBefore(n,r,i)}function jr(t,e,n){St(t)?t.appendChild(e,n):e.appendChild(n)}function zr(t,e,n,r,i){null!==r?Lr(t,e,n,r,i):jr(t,e,n)}function Fr(t,e){return St(t)?t.parentNode(e):e.parentNode}function Br(t,e,n){return Ur(t,e,n)}let Ur=function(t,e,n){return 40&t.type?Mt(t,n):null};function Vr(t,e,n,r){const i=Nr(t,r,e),o=e[11],s=Br(r.parent||e[6],r,e);if(null!=i)if(Array.isArray(n))for(let a=0;a<n.length;a++)zr(o,i,n[a],s,!1);else zr(o,i,n,s,!1)}function qr(t,e){if(null!==e){const n=e.type;if(3&n)return Mt(e,t);if(4&n)return Gr(-1,t[e.index]);if(8&n){const n=e.child;if(null!==n)return qr(t,n);{const n=t[e.index];return at(n)?Gr(-1,n):kt(n)}}if(32&n)return Cr(e,t)()||kt(t[e.index]);{const n=t[16],r=n[6],i=Er(n),o=r.projection[e.projection];return null!=o?qr(i,o):qr(t,e.next)}}return null}function Gr(t,e){const n=ot+t+1;if(n<e.length){const t=e[n],r=t[1].firstChild;if(null!==r)return qr(t,r)}return e[7]}function $r(t,e,n,r,i,o,s){for(;null!=n;){const a=r[n.index],c=n.type;if(s&&0===e&&(a&&br(kt(a),r),n.flags|=4),64!=(64&n.flags))if(8&c)$r(t,e,n.child,r,i,o,!1),Ar(e,t,i,a,o);else if(32&c){const s=Cr(n,r);let c;for(;c=s();)Ar(e,t,i,c,o);Ar(e,t,i,a,o)}else 16&c?Hr(t,e,r,n,i,o):Ar(e,t,i,a,o);n=s?n.projectionNext:n.next}}function Wr(t,e,n,r,i,o){$r(n,r,t.firstChild,e,i,o,!1)}function Hr(t,e,n,r,i,o){const s=n[16],a=s[6].projection[r.projection];if(Array.isArray(a))for(let c=0;c<a.length;c++)Ar(e,t,i,a[c],o);else $r(t,e,a,s[3],i,o,!0)}function Zr(t,e,n){St(t)?t.setAttribute(e,"style",n):e.style.cssText=n}function Kr(t,e,n){St(t)?""===n?t.removeAttribute(e,"class"):t.setAttribute(e,"class",n):e.className=n}function Xr(t,e,n){let r=t.length;for(;;){const i=t.indexOf(e,n);if(-1===i)return i;if(0===i||t.charCodeAt(i-1)<=32){const n=e.length;if(i+n===r||t.charCodeAt(i+n)<=32)return i}n=i+1}}const Yr="ng-template";function Qr(t,e,n){let r=0;for(;r<t.length;){let i=t[r++];if(n&&"class"===i){if(i=t[r],-1!==Xr(i.toLowerCase(),e,0))return!0}else if(1===i){for(;r<t.length&&"string"==typeof(i=t[r++]);)if(i.toLowerCase()===e)return!0;return!1}}return!1}function Jr(t){return 4===t.type&&t.value!==Yr}function ti(t,e,n){return e===(4!==t.type||n?t.value:Yr)}function ei(t,e,n){let r=4;const i=t.attrs||[],o=function(t){for(let e=0;e<t.length;e++)if(Te(t[e]))return e;return t.length}(i);let s=!1;for(let a=0;a<e.length;a++){const c=e[a];if("number"!=typeof c){if(!s)if(4&r){if(r=2|1&r,""!==c&&!ti(t,c,n)||""===c&&1===e.length){if(ni(r))return!1;s=!0}}else{const l=8&r?c:e[++a];if(8&r&&null!==t.attrs){if(!Qr(t.attrs,l,n)){if(ni(r))return!1;s=!0}continue}const u=ri(8&r?"class":c,i,Jr(t),n);if(-1===u){if(ni(r))return!1;s=!0;continue}if(""!==l){let t;t=u>o?"":i[u+1].toLowerCase();const e=8&r?t:null;if(e&&-1!==Xr(e,l,0)||2&r&&l!==t){if(ni(r))return!1;s=!0}}}}else{if(!s&&!ni(r)&&!ni(c))return!1;if(s&&ni(c))continue;s=!1,r=c|1&r}}return ni(r)||s}function ni(t){return 0==(1&t)}function ri(t,e,n,r){if(null===e)return-1;let i=0;if(r||!n){let n=!1;for(;i<e.length;){const r=e[i];if(r===t)return i;if(3===r||6===r)n=!0;else{if(1===r||2===r){let t=e[++i];for(;"string"==typeof t;)t=e[++i];continue}if(4===r)break;if(0===r){i+=4;continue}}i+=n?1:2}return-1}return function(t,e){let n=t.indexOf(4);if(n>-1)for(n++;n<t.length;){const r=t[n];if("number"==typeof r)return-1;if(r===e)return n;n++}return-1}(e,t)}function ii(t,e,n=!1){for(let r=0;r<e.length;r++)if(ei(t,e[r],n))return!0;return!1}function oi(t,e){t:for(let n=0;n<e.length;n++){const r=e[n];if(t.length===r.length){for(let e=0;e<t.length;e++)if(t[e]!==r[e])continue t;return!0}}return!1}function si(t,e){return t?":not("+e.trim()+")":e}function ai(t){let e=t[0],n=1,r=2,i="",o=!1;for(;n<t.length;){let s=t[n];if("string"==typeof s)if(2&r){const e=t[++n];i+="["+s+(e.length>0?'="'+e+'"':"")+"]"}else 8&r?i+="."+s:4&r&&(i+=" "+s);else""===i||ni(s)||(e+=si(o,i),i=""),r=s,o=o||!ni(r);n++}return""!==i&&(e+=si(o,i)),e}const ci={};function li(t){ui(Vt(),Ut(),he()+t,Kt())}function ui(t,e,n,r){if(!r)if(3==(3&e[2])){const r=t.preOrderCheckHooks;null!==r&&me(e,r,n)}else{const r=t.preOrderHooks;null!==r&&ge(e,r,0,n)}de(n)}function hi(t,e){return t<<17|e<<2}function di(t){return t>>17&32767}function pi(t){return 2|t}function fi(t){return(131068&t)>>2}function mi(t,e){return-131069&t|e<<2}function gi(t){return 1|t}function _i(t,e){const n=t.contentQueries;if(null!==n)for(let r=0;r<n.length;r+=2){const i=n[r],o=n[r+1];if(-1!==o){const n=t.data[o];ne(i),n.contentQueries(2,e[o],o)}}}function yi(t,e,n,r,i,o,s,a,c,l){const u=e.blueprint.slice();return u[0]=i,u[2]=140|r,jt(u),u[3]=u[15]=t,u[8]=n,u[10]=s||t&&t[10],u[11]=a||t&&t[11],u[12]=c||t&&t[12]||null,u[9]=l||t&&t[9]||null,u[6]=o,u[16]=2==e.type?t[16]:u,u}function vi(t,e,n,r,i){let o=t.data[e];if(null===o)o=function(t,e,n,r,i){const o=$t(),s=Ht(),a=t.data[e]=function(t,e,n,r,i,o){return{type:n,index:r,insertBeforeIndex:null,injectorIndex:e?e.injectorIndex:-1,directiveStart:-1,directiveEnd:-1,directiveStylingLast:-1,propertyBindings:null,flags:0,providerIndexes:0,value:i,attrs:o,mergedAttrs:null,localNames:null,initialInputs:void 0,inputs:null,outputs:null,tViews:null,next:null,projectionNext:null,child:null,parent:e,projection:null,styles:null,stylesWithoutHost:null,residualStyles:void 0,classes:null,classesWithoutHost:null,residualClasses:void 0,classBindings:0,styleBindings:0}}(0,s?o:o&&o.parent,n,e,r,i);return null===t.firstChild&&(t.firstChild=a),null!==o&&(s?null==o.child&&null!==a.parent&&(o.child=a):null===o.next&&(o.next=a)),a}(t,e,n,r,i),Ft.lFrame.inI18n&&(o.flags|=64);else if(64&o.type){o.type=n,o.value=r,o.attrs=i;const t=function(){const t=Ft.lFrame,e=t.currentTNode;return t.isParent?e:e.parent}();o.injectorIndex=null===t?-1:t.injectorIndex}return Wt(o,!0),o}function bi(t,e,n,r){if(0===n)return-1;const i=e.length;for(let o=0;o<n;o++)e.push(r),t.blueprint.push(r),t.data.push(null);return i}function xi(t,e,n){oe(e);try{const r=t.viewQuery;null!==r&&Xi(1,r,n);const i=t.template;null!==i&&Ci(t,e,i,1,n),t.firstCreatePass&&(t.firstCreatePass=!1),t.staticContentQueries&&_i(t,e),t.staticViewQueries&&Xi(2,t.viewQuery,n);const o=t.components;null!==o&&function(t,e){for(let n=0;n<e.length;n++)$i(t,e[n])}(e,o)}catch(r){throw t.firstCreatePass&&(t.incompleteFirstPass=!0),r}finally{e[2]&=-5,ue()}}function wi(t,e,n,r){const i=e[2];if(256==(256&i))return;oe(e);const o=Kt();try{jt(e),Ft.lFrame.bindingIndex=t.bindingStartIndex,null!==n&&Ci(t,e,n,2,r);const s=3==(3&i);if(!o)if(s){const n=t.preOrderCheckHooks;null!==n&&me(e,n,null)}else{const n=t.preOrderHooks;null!==n&&ge(e,n,0,null),_e(e,0)}if(function(t){for(let e=Sr(t);null!==e;e=Ir(e)){if(!e[2])continue;const t=e[9];for(let e=0;e<t.length;e++){const n=t[e],r=n[3];0==(1024&n[2])&&zt(r,1),n[2]|=1024}}}(e),function(t){for(let e=Sr(t);null!==e;e=Ir(e))for(let t=ot;t<e.length;t++){const n=e[t],r=n[1];Nt(n)&&wi(r,n,r.template,n[8])}}(e),null!==t.contentQueries&&_i(t,e),!o)if(s){const n=t.contentCheckHooks;null!==n&&me(e,n)}else{const n=t.contentHooks;null!==n&&ge(e,n,1),_e(e,1)}!function(t,e){const n=t.hostBindingOpCodes;if(null!==n)try{for(let t=0;t<n.length;t++){const r=n[t];if(r<0)de(~r);else{const i=r,o=n[++t],s=n[++t];Jt(o,i),s(2,e[i])}}}finally{de(-1)}}(t,e);const a=t.components;null!==a&&function(t,e){for(let n=0;n<e.length;n++)qi(t,e[n])}(e,a);const c=t.viewQuery;if(null!==c&&Xi(2,c,r),!o)if(s){const n=t.viewCheckHooks;null!==n&&me(e,n)}else{const n=t.viewHooks;null!==n&&ge(e,n,2),_e(e,2)}!0===t.firstUpdatePass&&(t.firstUpdatePass=!1),o||(e[2]&=-73),1024&e[2]&&(e[2]&=-1025,zt(e[3],-1))}finally{ue()}}function Ti(t,e,n,r){const i=e[10],o=!Kt(),s=Rt(e);try{o&&!s&&i.begin&&i.begin(),s&&xi(t,e,r),wi(t,e,n,r)}finally{o&&!s&&i.end&&i.end()}}function Ci(t,e,n,r,i){const o=he();try{de(-1),2&r&&e.length>it&&ui(t,e,it,Kt()),n(r,i)}finally{de(o)}}function Ei(t,e,n){Bt()&&(function(t,e,n,r){const i=n.directiveStart,o=n.directiveEnd;t.firstCreatePass||De(n,e),br(r,e);const s=n.initialInputs;for(let a=i;a<o;a++){const r=t.data[a],o=ht(r);o&&Fi(e,n,r);const c=$e(e,t,a,n);br(c,e),null!==s&&Bi(0,a-i,c,r,0,s),o&&(Pt(n.index,e)[8]=c)}}(t,e,n,Mt(n,e)),128==(128&n.flags)&&function(t,e,n){const r=n.directiveStart,i=n.directiveEnd,o=n.index,s=Ft.lFrame.currentDirectiveIndex;try{de(o);for(let n=r;n<i;n++){const r=t.data[n],i=e[n];te(n),null===r.hostBindings&&0===r.hostVars&&null===r.hostAttrs||Ri(r,i)}}finally{de(-1),te(s)}}(t,e,n))}function Si(t,e,n=Mt){const r=e.localNames;if(null!==r){let i=e.index+1;for(let o=0;o<r.length;o+=2){const s=r[o+1],a=-1===s?n(e,t):t[s];t[i++]=a}}}function Ii(t){const e=t.tView;return null===e||e.incompleteFirstPass?t.tView=ki(1,null,t.template,t.decls,t.vars,t.directiveDefs,t.pipeDefs,t.viewQuery,t.schemas,t.consts):e}function ki(t,e,n,r,i,o,s,a,c,l){const u=it+r,h=u+i,d=function(t,e){const n=[];for(let r=0;r<e;r++)n.push(r<t?null:ci);return n}(u,h),p="function"==typeof l?l():l;return d[1]={type:t,blueprint:d,template:n,queries:null,viewQuery:a,declTNode:e,data:d.slice().fill(null,u),bindingStartIndex:u,expandoStartIndex:h,hostBindingOpCodes:null,firstCreatePass:!0,firstUpdatePass:!0,staticViewQueries:!1,staticContentQueries:!1,preOrderHooks:null,preOrderCheckHooks:null,contentHooks:null,contentCheckHooks:null,viewHooks:null,viewCheckHooks:null,destroyHooks:null,cleanup:null,contentQueries:null,components:null,directiveRegistry:"function"==typeof o?o():o,pipeRegistry:"function"==typeof s?s():s,firstChild:null,schemas:c,consts:p,incompleteFirstPass:!1}}function Ai(t,e,n,r){const i=Qi(e);null===n?i.push(r):(i.push(n),t.firstCreatePass&&Ji(t).push(r,i.length-1))}function Mi(t,e,n){for(let r in t)if(t.hasOwnProperty(r)){const i=t[r];(n=null===n?{}:n).hasOwnProperty(r)?n[r].push(e,i):n[r]=[e,i]}return n}function Oi(t,e,n,r,i,o,s,a){const c=Mt(e,n);let l,u=e.inputs;var h;!a&&null!=u&&(l=u[r])?(eo(t,n,l,r,i),lt(e)&&function(t,e){const n=Pt(e,t);16&n[2]||(n[2]|=64)}(n,e.index)):3&e.type&&(r="class"===(h=r)?"className":"for"===h?"htmlFor":"formaction"===h?"formAction":"innerHtml"===h?"innerHTML":"readonly"===h?"readOnly":"tabindex"===h?"tabIndex":h,i=null!=s?s(i,e.value||"",r):i,St(o)?o.setProperty(c,r,i):Ce(r)||(c.setProperty?c.setProperty(r,i):c[r]=i))}function Pi(t,e,n,r){let i=!1;if(Bt()){const o=function(t,e,n){const r=t.directiveRegistry;let i=null;if(r)for(let o=0;o<r.length;o++){const s=r[o];ii(n,s.selectors,!1)&&(i||(i=[]),je(De(n,e),t,s.type),ht(s)?(Ni(t,n),i.unshift(s)):i.push(s))}return i}(t,e,n),s=null===r?null:{"":-1};if(null!==o){i=!0,ji(n,t.data.length,o.length);for(let t=0;t<o.length;t++){const e=o[t];e.providersResolver&&e.providersResolver(e)}let r=!1,a=!1,c=bi(t,e,o.length,null);for(let i=0;i<o.length;i++){const l=o[i];n.mergedAttrs=Ee(n.mergedAttrs,l.hostAttrs),zi(t,n,e,c,l),Li(c,l,s),null!==l.contentQueries&&(n.flags|=8),null===l.hostBindings&&null===l.hostAttrs&&0===l.hostVars||(n.flags|=128);const u=l.type.prototype;!r&&(u.ngOnChanges||u.ngOnInit||u.ngDoCheck)&&((t.preOrderHooks||(t.preOrderHooks=[])).push(n.index),r=!0),a||!u.ngOnChanges&&!u.ngDoCheck||((t.preOrderCheckHooks||(t.preOrderCheckHooks=[])).push(n.index),a=!0),c++}!function(t,e){const n=e.directiveEnd,r=t.data,i=e.attrs,o=[];let s=null,a=null;for(let c=e.directiveStart;c<n;c++){const t=r[c],n=t.inputs,l=null===i||Jr(e)?null:Ui(n,i);o.push(l),s=Mi(n,c,s),a=Mi(t.outputs,c,a)}null!==s&&(s.hasOwnProperty("class")&&(e.flags|=16),s.hasOwnProperty("style")&&(e.flags|=32)),e.initialInputs=o,e.inputs=s,e.outputs=a}(t,n)}s&&function(t,e,n){if(e){const r=t.localNames=[];for(let t=0;t<e.length;t+=2){const i=n[e[t+1]];if(null==i)throw new pt("301",`Export of name '${e[t+1]}' not found!`);r.push(e[t],i)}}}(n,r,s)}return n.mergedAttrs=Ee(n.mergedAttrs,n.attrs),i}function Di(t,e,n,r,i,o){const s=o.hostBindings;if(s){let n=t.hostBindingOpCodes;null===n&&(n=t.hostBindingOpCodes=[]);const o=~e.index;(function(t){let e=t.length;for(;e>0;){const n=t[--e];if("number"==typeof n&&n<0)return n}return 0})(n)!=o&&n.push(o),n.push(r,i,s)}}function Ri(t,e){null!==t.hostBindings&&t.hostBindings(1,e)}function Ni(t,e){e.flags|=2,(t.components||(t.components=[])).push(e.index)}function Li(t,e,n){if(n){if(e.exportAs)for(let r=0;r<e.exportAs.length;r++)n[e.exportAs[r]]=t;ht(e)&&(n[""]=t)}}function ji(t,e,n){t.flags|=1,t.directiveStart=e,t.directiveEnd=e+n,t.providerIndexes=e}function zi(t,e,n,r,i){t.data[r]=i;const o=i.factory||(i.factory=dt(i.type)),s=new xe(o,ht(i),null);t.blueprint[r]=s,n[r]=s,Di(t,e,0,r,bi(t,n,i.hostVars,ci),i)}function Fi(t,e,n){const r=Mt(e,t),i=Ii(n),o=t[10],s=Wi(t,yi(t,i,null,n.onPush?64:16,r,e,o,o.createRenderer(r,n),null,null));t[e.index]=s}function Bi(t,e,n,r,i,o){const s=o[e];if(null!==s){const t=r.setInput;for(let e=0;e<s.length;){const i=s[e++],o=s[e++],a=s[e++];null!==t?r.setInput(n,a,i,o):n[o]=a}}}function Ui(t,e){let n=null,r=0;for(;r<e.length;){const i=e[r];if(0!==i)if(5!==i){if("number"==typeof i)break;t.hasOwnProperty(i)&&(null===n&&(n=[]),n.push(i,t[i],e[r+1])),r+=2}else r+=2;else r+=4}return n}function Vi(t,e,n,r){return new Array(t,!0,!1,e,null,0,r,n,null,null)}function qi(t,e){const n=Pt(e,t);if(Nt(n)){const t=n[1];80&n[2]?wi(t,n,t.template,n[8]):n[5]>0&&Gi(n)}}function Gi(t){for(let n=Sr(t);null!==n;n=Ir(n))for(let t=ot;t<n.length;t++){const e=n[t];if(1024&e[2]){const t=e[1];wi(t,e,t.template,e[8])}else e[5]>0&&Gi(e)}const e=t[1].components;if(null!==e)for(let n=0;n<e.length;n++){const r=Pt(e[n],t);Nt(r)&&r[5]>0&&Gi(r)}}function $i(t,e){const n=Pt(e,t),r=n[1];!function(t,e){for(let n=e.length;n<t.blueprint.length;n++)e.push(t.blueprint[n])}(r,n),xi(r,n,n[8])}function Wi(t,e){return t[13]?t[14][4]=e:t[13]=e,t[14]=e,e}function Hi(t){for(;t;){t[2]|=64;const e=Er(t);if(0!=(512&t[2])&&!e)return t;t=e}return null}function Zi(t,e,n){const r=e[10];r.begin&&r.begin();try{wi(t,e,t.template,n)}catch(i){throw to(e,i),i}finally{r.end&&r.end()}}function Ki(t){!function(t){for(let e=0;e<t.components.length;e++){const n=t.components[e],r=Dt(n),i=r[1];Ti(i,r,i.template,n)}}(t[8])}function Xi(t,e,n){ne(0),e(t,n)}const Yi=(()=>Promise.resolve(null))();function Qi(t){return t[7]||(t[7]=[])}function Ji(t){return t.cleanup||(t.cleanup=[])}function to(t,e){const n=t[9],r=n?n.get(vr,null):null;r&&r.handleError(e)}function eo(t,e,n,r,i){for(let o=0;o<n.length;){const s=n[o++],a=n[o++],c=e[s],l=t.data[s];null!==l.setInput?l.setInput(c,i,r,a):c[a]=i}}function no(t,e,n){let r=n?t.styles:null,i=n?t.classes:null,o=0;if(null!==e)for(let s=0;s<e.length;s++){const t=e[s];"number"==typeof t?o=t:1==o?i=h(i,t):2==o&&(r=h(r,t+": "+e[++s]+";"))}n?t.styles=r:t.stylesWithoutHost=r,n?t.classes=i:t.classesWithoutHost=i}const ro=new tn("INJECTOR",-1);class io{get(t,e=dn){if(e===dn){const e=new Error(`NullInjectorError: No provider for ${u(t)}!`);throw e.name="NullInjectorError",e}return e}}const oo=new tn("Set Injector scope."),so={},ao={},co=[];let lo;function uo(){return void 0===lo&&(lo=new io),lo}function ho(t,e=null,n=null,r){return new po(t,n,e||uo(),r)}class po{constructor(t,e,n,r=null){this.parent=n,this.records=new Map,this.injectorDefTypes=new Set,this.onDestroy=new Set,this._destroyed=!1;const i=[];e&&on(e,n=>this.processProvider(n,t,e)),on([t],t=>this.processInjectorType(t,[],i)),this.records.set(ro,go(void 0,this));const o=this.records.get(oo);this.scope=null!=o?o.value:null,this.source=r||("object"==typeof t?null:u(t))}get destroyed(){return this._destroyed}destroy(){this.assertNotDestroyed(),this._destroyed=!0;try{this.onDestroy.forEach(t=>t.ngOnDestroy())}finally{this.records.clear(),this.onDestroy.clear(),this.injectorDefTypes.clear()}}get(t,e=dn,n=E.Default){this.assertNotDestroyed();const r=_n(this);try{if(!(n&E.SkipSelf)){let e=this.records.get(t);if(void 0===e){const n=("function"==typeof(i=t)||"object"==typeof i&&i instanceof tn)&&y(t);e=n&&this.injectableDefInScope(n)?go(fo(t),so):null,this.records.set(t,e)}if(null!=e)return this.hydrate(t,e)}return(n&E.Self?uo():this.parent).get(t,e=n&E.Optional&&e===dn?null:e)}catch(o){if("NullInjectorError"===o.name){if((o.ngTempTokenPath=o.ngTempTokenPath||[]).unshift(u(t)),r)throw o;return function(t,e,n,r){const i=t.ngTempTokenPath;throw e[fn]&&i.unshift(e[fn]),t.message=function(t,e,n,r=null){t=t&&"\n"===t.charAt(0)&&"\u0275"==t.charAt(1)?t.substr(2):t;let i=u(e);if(Array.isArray(e))i=e.map(u).join(" -> ");else if("object"==typeof e){let t=[];for(let n in e)if(e.hasOwnProperty(n)){let r=e[n];t.push(n+":"+("string"==typeof r?JSON.stringify(r):u(r)))}i=`{${t.join(", ")}}`}return`${n}${r?"("+r+")":""}[${i}]: ${t.replace(pn,"\n  ")}`}("\n"+t.message,i,n,r),t.ngTokenPath=i,t.ngTempTokenPath=null,t}(o,t,"R3InjectorError",this.source)}throw o}finally{_n(r)}var i}_resolveInjectorDefTypes(){this.injectorDefTypes.forEach(t=>this.get(t))}toString(){const t=[];return this.records.forEach((e,n)=>t.push(u(n))),`R3Injector[${t.join(", ")}]`}assertNotDestroyed(){if(this._destroyed)throw new Error("Injector has already been destroyed.")}processInjectorType(t,e,n){if(!(t=f(t)))return!1;let r=b(t);const i=null==r&&t.ngModule||void 0,o=void 0===i?t:i,s=-1!==n.indexOf(o);if(void 0!==i&&(r=b(i)),null==r)return!1;if(null!=r.imports&&!s){let t;n.push(o);try{on(r.imports,r=>{this.processInjectorType(r,e,n)&&(void 0===t&&(t=[]),t.push(r))})}finally{}if(void 0!==t)for(let e=0;e<t.length;e++){const{ngModule:n,providers:r}=t[e];on(r,t=>this.processProvider(t,n,r||co))}}this.injectorDefTypes.add(o),this.records.set(o,go(r.factory,so));const a=r.providers;if(null!=a&&!s){const e=t;on(a,t=>this.processProvider(t,e,a))}return void 0!==i&&void 0!==t.providers}processProvider(t,e,n){let r=yo(t=f(t))?t:f(t&&t.provide);const i=function(t,e,n){return _o(t)?go(void 0,t.useValue):go(mo(t),so)}(t);if(yo(t)||!0!==t.multi)this.records.get(r);else{let e=this.records.get(r);e||(e=go(void 0,so,!0),e.factory=()=>bn(e.multi),this.records.set(r,e)),r=t,e.multi.push(t)}this.records.set(r,i)}hydrate(t,e){var n;return e.value===so&&(e.value=ao,e.value=e.factory()),"object"==typeof e.value&&e.value&&null!==(n=e.value)&&"object"==typeof n&&"function"==typeof n.ngOnDestroy&&this.onDestroy.add(e.value),e.value}injectableDefInScope(t){return!!t.providedIn&&("string"==typeof t.providedIn?"any"===t.providedIn||t.providedIn===this.scope:this.injectorDefTypes.has(t.providedIn))}}function fo(t){const e=y(t),n=null!==e?e.factory:dt(t);if(null!==n)return n;const r=b(t);if(null!==r)return r.factory;if(t instanceof tn)throw new Error(`Token ${u(t)} is missing a \u0275prov definition.`);if(t instanceof Function)return function(t){const e=t.length;if(e>0){const n=cn(e,"?");throw new Error(`Can't resolve all parameters for ${u(t)}: (${n.join(", ")}).`)}const n=function(t){const e=t&&(t[x]||t[T]);if(e){const n=function(t){if(t.hasOwnProperty("name"))return t.name;const e=(""+t).match(/^function\s*([^\s(]+)/);return null===e?"":e[1]}(t);return console.warn(`DEPRECATED: DI is instantiating a token "${n}" that inherits its @Injectable decorator but does not provide one itself.\nThis will become an error in a future version of Angular. Please add @Injectable() to the "${n}" class.`),e}return null}(t);return null!==n?()=>n.factory(t):()=>new t}(t);throw new Error("unreachable")}function mo(t,e,n){let r;if(yo(t)){const e=f(t);return dt(e)||fo(e)}if(_o(t))r=()=>f(t.useValue);else if((i=t)&&i.useFactory)r=()=>t.useFactory(...bn(t.deps||[]));else if(function(t){return!(!t||!t.useExisting)}(t))r=()=>vn(f(t.useExisting));else{const e=f(t&&(t.useClass||t.provide));if(!function(t){return!!t.deps}(t))return dt(e)||fo(e);r=()=>new e(...bn(t.deps))}var i;return r}function go(t,e,n=!1){return{factory:t,value:e,multi:n?[]:void 0}}function _o(t){return null!==t&&"object"==typeof t&&mn in t}function yo(t){return"function"==typeof t}const vo=function(t,e,n){return function(t,e=null,n=null,r){const i=ho(t,e,n,r);return i._resolveInjectorDefTypes(),i}({name:n},e,t,n)};let bo=(()=>{class t{static create(t,e){return Array.isArray(t)?vo(t,e,""):vo(t.providers,t.parent,t.name||"")}}return t.THROW_IF_NOT_FOUND=dn,t.NULL=new io,t.\u0275prov=g({token:t,providedIn:"any",factory:()=>vn(ro)}),t.__NG_ELEMENT_ID__=-1,t})();function xo(t,e){fe(Dt(t)[1],Gt())}function wo(t){let e=Object.getPrototypeOf(t.type.prototype).constructor,n=!0;const r=[t];for(;e;){let i;if(ht(t))i=e.\u0275cmp||e.\u0275dir;else{if(e.\u0275cmp)throw new Error("Directives cannot inherit Components");i=e.\u0275dir}if(i){if(n){r.push(i);const e=t;e.inputs=To(t.inputs),e.declaredInputs=To(t.declaredInputs),e.outputs=To(t.outputs);const n=i.hostBindings;n&&So(t,n);const o=i.viewQuery,s=i.contentQueries;if(o&&Co(t,o),s&&Eo(t,s),l(t.inputs,i.inputs),l(t.declaredInputs,i.declaredInputs),l(t.outputs,i.outputs),ht(i)&&i.data.animation){const e=t.data;e.animation=(e.animation||[]).concat(i.data.animation)}}const e=i.features;if(e)for(let r=0;r<e.length;r++){const i=e[r];i&&i.ngInherit&&i(t),i===wo&&(n=!1)}}e=Object.getPrototypeOf(e)}!function(t){let e=0,n=null;for(let r=t.length-1;r>=0;r--){const i=t[r];i.hostVars=e+=i.hostVars,i.hostAttrs=Ee(i.hostAttrs,n=Ee(n,i.hostAttrs))}}(r)}function To(t){return t===j?{}:t===z?[]:t}function Co(t,e){const n=t.viewQuery;t.viewQuery=n?(t,r)=>{e(t,r),n(t,r)}:e}function Eo(t,e){const n=t.contentQueries;t.contentQueries=n?(t,r,i)=>{e(t,r,i),n(t,r,i)}:e}function So(t,e){const n=t.hostBindings;t.hostBindings=n?(t,r)=>{e(t,r),n(t,r)}:e}let Io=null;function ko(){if(!Io){const t=L.Symbol;if(t&&t.iterator)Io=t.iterator;else{const t=Object.getOwnPropertyNames(Map.prototype);for(let e=0;e<t.length;++e){const n=t[e];"entries"!==n&&"size"!==n&&Map.prototype[n]===Map.prototype.entries&&(Io=n)}}}return Io}function Ao(t){return!!Mo(t)&&(Array.isArray(t)||!(t instanceof Map)&&ko()in t)}function Mo(t){return null!==t&&("function"==typeof t||"object"==typeof t)}function Oo(t,e,n){return t[e]=n}function Po(t,e,n){return!Object.is(t[e],n)&&(t[e]=n,!0)}function Do(t,e,n,r){const i=Ut();return Po(i,Qt(),e)&&(Vt(),function(t,e,n,r,i,o){const s=Mt(t,e);!function(t,e,n,r,i,o,s){if(null==o)St(t)?t.removeAttribute(e,i,n):e.removeAttribute(i);else{const a=null==s?ft(o):s(o,r||"",i);St(t)?t.setAttribute(e,i,a,n):n?e.setAttributeNS(n,i,a):e.setAttribute(i,a)}}(e[11],s,o,t.value,n,r,i)}(pe(),i,t,e,n,r)),Do}function Ro(t,e,n,r,i,o,s,a){const c=Ut(),l=Vt(),u=t+it,h=l.firstCreatePass?function(t,e,n,r,i,o,s,a,c){const l=e.consts,u=vi(e,t,4,s||null,Lt(l,a));Pi(e,n,u,Lt(l,c)),fe(e,u);const h=u.tViews=ki(2,u,r,i,o,e.directiveRegistry,e.pipeRegistry,null,e.schemas,l);return null!==e.queries&&(e.queries.template(e,u),h.queries=e.queries.embeddedTView(u)),u}(u,l,c,e,n,r,i,o,s):l.data[u];Wt(h,!1);const d=c[11].createComment("");Vr(l,c,d,h),br(d,c),Wi(c,c[u]=Vi(d,c,d,h)),ut(h)&&Ei(l,c,h),null!=s&&Si(c,h,a)}function No(t){return function(t,e){return t[e]}(Ft.lFrame.contextLView,it+t)}function Lo(t,e=E.Default){const n=Ut();return null===n?vn(t,e):Be(Gt(),n,f(t),e)}function jo(t,e,n){const r=Ut();return Po(r,Qt(),e)&&Oi(Vt(),pe(),r,t,e,r[11],n,!1),jo}function zo(t,e,n,r,i){const o=i?"class":"style";eo(t,n,e.inputs[o],o,r)}function Fo(t,e,n,r){const i=Ut(),o=Vt(),s=it+t,a=i[11],c=i[s]=Mr(a,e,Ft.lFrame.currentNamespace),l=o.firstCreatePass?function(t,e,n,r,i,o,s){const a=e.consts,c=vi(e,t,2,i,Lt(a,o));return Pi(e,n,c,Lt(a,s)),null!==c.attrs&&no(c,c.attrs,!1),null!==c.mergedAttrs&&no(c,c.mergedAttrs,!0),null!==e.queries&&e.queries.elementStart(e,c),c}(s,o,i,0,e,n,r):o.data[s];Wt(l,!0);const u=l.mergedAttrs;null!==u&&we(a,c,u);const h=l.classes;null!==h&&Kr(a,c,h);const d=l.styles;null!==d&&Zr(a,c,d),64!=(64&l.flags)&&Vr(o,i,c,l),0===Ft.lFrame.elementDepthCount&&br(c,i),Ft.lFrame.elementDepthCount++,ut(l)&&(Ei(o,i,l),function(t,e,n){if(ct(e)){const r=e.directiveEnd;for(let i=e.directiveStart;i<r;i++){const e=t.data[i];e.contentQueries&&e.contentQueries(1,n[i],i)}}}(o,l,i)),null!==r&&Si(i,l)}function Bo(){let t=Gt();Ht()?Zt():(t=t.parent,Wt(t,!1));const e=t;Ft.lFrame.elementDepthCount--;const n=Vt();n.firstCreatePass&&(fe(n,t),ct(t)&&n.queries.elementEnd(t)),null!=e.classesWithoutHost&&function(t){return 0!=(16&t.flags)}(e)&&zo(n,e,Ut(),e.classesWithoutHost,!0),null!=e.stylesWithoutHost&&function(t){return 0!=(32&t.flags)}(e)&&zo(n,e,Ut(),e.stylesWithoutHost,!1)}function Uo(t,e,n,r){Fo(t,e,n,r),Bo()}function Vo(){return Ut()}function qo(t){return!!t&&"function"==typeof t.then}function Go(t){return!!t&&"function"==typeof t.subscribe}const $o=Go;function Wo(t,e,n=!1,r){const i=Ut(),o=Vt(),s=Gt();return function(t,e,n,r,i,o,s=!1,a){const c=ut(r),l=t.firstCreatePass&&Ji(t),u=Qi(e);let h=!0;if(3&r.type){const d=Mt(r,e),p=a?a(d):j,f=p.target||d,m=u.length,g=a?t=>a(kt(t[r.index])).target:r.index;if(St(n)){let s=null;if(!a&&c&&(s=function(t,e,n,r){const i=t.cleanup;if(null!=i)for(let o=0;o<i.length-1;o+=2){const t=i[o];if(t===n&&i[o+1]===r){const t=e[7],n=i[o+2];return t.length>n?t[n]:null}"string"==typeof t&&(o+=2)}return null}(t,e,i,r.index)),null!==s)(s.__ngLastListenerFn__||s).__ngNextListenerFn__=o,s.__ngLastListenerFn__=o,h=!1;else{o=Zo(r,e,o,!1);const t=n.listen(p.name||f,i,o);u.push(o,t),l&&l.push(i,g,m,m+1)}}else o=Zo(r,e,o,!0),f.addEventListener(i,o,s),u.push(o),l&&l.push(i,g,m,s)}else o=Zo(r,e,o,!1);const d=r.outputs;let p;if(h&&null!==d&&(p=d[i])){const t=p.length;if(t)for(let n=0;n<t;n+=2){const t=e[p[n]][p[n+1]].subscribe(o),s=u.length;u.push(o,t),l&&l.push(i,r.index,s,-(s+1))}}}(o,i,i[11],s,t,e,n,r),Wo}function Ho(t,e,n){try{return!1!==e(n)}catch(r){return to(t,r),!1}}function Zo(t,e,n,r){return function i(o){if(o===Function)return n;const s=2&t.flags?Pt(t.index,e):e;0==(32&e[2])&&Hi(s);let a=Ho(e,n,o),c=i.__ngNextListenerFn__;for(;c;)a=Ho(e,c,o)&&a,c=c.__ngNextListenerFn__;return r&&!1===a&&(o.preventDefault(),o.returnValue=!1),a}}function Ko(t=1){return function(t){return(Ft.lFrame.contextLView=function(t,e){for(;t>0;)e=e[15],t--;return e}(t,Ft.lFrame.contextLView))[8]}(t)}function Xo(t,e){let n=null;const r=function(t){const e=t.attrs;if(null!=e){const t=e.indexOf(5);if(0==(1&t))return e[t+1]}return null}(t);for(let i=0;i<e.length;i++){const o=e[i];if("*"!==o){if(null===r?ii(t,o,!0):oi(r,o))return i}else n=i}return n}function Yo(t){const e=Ut()[16][6];if(!e.projection){const n=e.projection=cn(t?t.length:1,null),r=n.slice();let i=e.child;for(;null!==i;){const e=t?Xo(i,t):0;null!==e&&(r[e]?r[e].projectionNext=i:n[e]=i,r[e]=i),i=i.next}}}function Qo(t,e=0,n){const r=Ut(),i=Vt(),o=vi(i,it+t,16,null,n||null);null===o.projection&&(o.projection=e),Zt(),64!=(64&o.flags)&&function(t,e,n){Hr(e[11],0,e,n,Nr(t,n,e),Br(n.parent||e[6],n,e))}(i,r,o)}const Jo=[];function ts(t,e,n,r,i){const o=t[n+1],s=null===e;let a=r?di(o):fi(o),c=!1;for(;0!==a&&(!1===c||s);){const n=t[a+1];es(t[a],e)&&(c=!0,t[a+1]=r?gi(n):pi(n)),a=r?di(n):fi(n)}c&&(t[n+1]=r?pi(o):gi(o))}function es(t,e){return null===t||null==e||(Array.isArray(t)?t[1]:t)===e||!(!Array.isArray(t)||"string"!=typeof e)&&hn(t,e)>=0}function ns(t,e){return function(t,e,n,r){const i=Ut(),o=Vt(),s=function(t){const e=Ft.lFrame,n=e.bindingIndex;return e.bindingIndex=e.bindingIndex+2,n}();o.firstUpdatePass&&function(t,e,n,r){const i=t.data;if(null===i[n+1]){const o=i[he()],s=function(t,e){return e>=t.expandoStartIndex}(t,n);(function(t,e){return 0!=(16&t.flags)})(o)&&null===e&&!s&&(e=!1),e=function(t,e,n,r){const i=function(t){const e=Ft.lFrame.currentDirectiveIndex;return-1===e?null:t[e]}(t);let o=e.residualClasses;if(null===i)0===e.classBindings&&(n=is(n=rs(null,t,e,n,r),e.attrs,r),o=null);else{const s=e.directiveStylingLast;if(-1===s||t[s]!==i)if(n=rs(i,t,e,n,r),null===o){let n=function(t,e,n){const r=e.classBindings;if(0!==fi(r))return t[di(r)]}(t,e);void 0!==n&&Array.isArray(n)&&(n=rs(null,t,e,n[1],r),n=is(n,e.attrs,r),function(t,e,n,r){t[di(e.classBindings)]=r}(t,e,0,n))}else o=function(t,e,n){let r;const i=e.directiveEnd;for(let o=1+e.directiveStylingLast;o<i;o++)r=is(r,t[o].hostAttrs,true);return is(r,e.attrs,true)}(t,e)}return void 0!==o&&(e.residualClasses=o),n}(i,o,e,r),function(t,e,n,r,i,o){let s=e.classBindings,a=di(s),c=fi(s);t[r]=n;let l,u=!1;if(Array.isArray(n)){const t=n;l=t[1],(null===l||hn(t,l)>0)&&(u=!0)}else l=n;if(i)if(0!==c){const e=di(t[a+1]);t[r+1]=hi(e,a),0!==e&&(t[e+1]=mi(t[e+1],r)),t[a+1]=131071&t[a+1]|r<<17}else t[r+1]=hi(a,0),0!==a&&(t[a+1]=mi(t[a+1],r)),a=r;else t[r+1]=hi(c,0),0===a?a=r:t[c+1]=mi(t[c+1],r),c=r;u&&(t[r+1]=pi(t[r+1])),ts(t,l,r,!0),ts(t,l,r,!1),function(t,e,n,r,i){const o=t.residualClasses;null!=o&&"string"==typeof e&&hn(o,e)>=0&&(n[r+1]=gi(n[r+1]))}(e,l,t,r),s=hi(a,c),e.classBindings=s}(i,o,e,n,s)}}(o,t,s,true),e!==ci&&Po(i,s,e)&&function(t,e,n,r,i,o,s,a){if(!(3&e.type))return;const c=t.data,l=c[a+1];ss(1==(1&l)?os(c,e,n,i,fi(l),s):void 0)||(ss(o)||function(t){return 2==(2&t)}(l)&&(o=os(c,null,n,i,a,s)),function(t,e,n,r,i){const o=St(t);i?o?t.addClass(n,r):n.classList.add(r):o?t.removeClass(n,r):n.classList.remove(r)}(r,0,At(he(),n),i,o))}(o,o.data[he()],i,i[11],t,i[s+1]=function(t,e){return null==t||"object"==typeof t&&(t=u(Nn(t))),t}(e),true,s)}(t,e),ns}function rs(t,e,n,r,i){let o=null;const s=n.directiveEnd;let a=n.directiveStylingLast;for(-1===a?a=n.directiveStart:a++;a<s&&(o=e[a],r=is(r,o.hostAttrs,i),o!==t);)a++;return null!==t&&(n.directiveStylingLast=a),r}function is(t,e,n){const r=n?1:2;let i=-1;if(null!==e)for(let o=0;o<e.length;o++){const s=e[o];"number"==typeof s?i=s:i===r&&(Array.isArray(t)||(t=void 0===t?[]:["",t]),ln(t,s,!!n||e[++o]))}return void 0===t?null:t}function os(t,e,n,r,i,o){const s=null===e;let a;for(;i>0;){const e=t[i],o=Array.isArray(e),c=o?e[1]:e,l=null===c;let u=n[i+1];u===ci&&(u=l?Jo:void 0);let h=l?un(u,r):c===r?u:void 0;if(o&&!ss(h)&&(h=un(e,r)),ss(h)&&(a=h,s))return a;const d=t[i+1];i=s?di(d):fi(d)}if(null!==e){let t=o?e.residualClasses:e.residualStyles;null!=t&&(a=un(t,r))}return a}function ss(t){return void 0!==t}function as(t,e=""){const n=Ut(),r=Vt(),i=t+it,o=r.firstCreatePass?vi(r,i,1,e,null):r.data[i],s=n[i]=function(t,e){return St(t)?t.createText(e):t.createTextNode(e)}(n[11],e);Vr(r,n,s,o),Wt(o,!1)}function cs(t){return ls("",t,""),cs}function ls(t,e,n){const r=Ut(),i=function(t,e,n,r){return Po(t,Qt(),n)?e+ft(n)+r:ci}(r,t,e,n);return i!==ci&&function(t,e,n){const r=At(e,t);!function(t,e,n){St(t)?t.setValue(e,n):e.textContent=n}(t[11],r,n)}(r,he(),i),ls}function us(t,e,n){const r=Ut();return Po(r,Qt(),e)&&Oi(Vt(),pe(),r,t,e,r[11],n,!0),us}const hs=void 0;var ds=["en",[["a","p"],["AM","PM"],hs],[["AM","PM"],hs,hs],[["S","M","T","W","T","F","S"],["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],["Su","Mo","Tu","We","Th","Fr","Sa"]],hs,[["J","F","M","A","M","J","J","A","S","O","N","D"],["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],["January","February","March","April","May","June","July","August","September","October","November","December"]],hs,[["B","A"],["BC","AD"],["Before Christ","Anno Domini"]],0,[6,0],["M/d/yy","MMM d, y","MMMM d, y","EEEE, MMMM d, y"],["h:mm a","h:mm:ss a","h:mm:ss a z","h:mm:ss a zzzz"],["{1}, {0}",hs,"{1} 'at' {0}",hs],[".",",",";","%","+","-","E","\xd7","\u2030","\u221e","NaN",":"],["#,##0.###","#,##0%","\xa4#,##0.00","#E0"],"USD","$","US Dollar",{},"ltr",function(t){let e=Math.floor(Math.abs(t)),n=t.toString().replace(/^[^.]*\.?/,"").length;return 1===e&&0===n?1:5}];let ps={};function fs(t,e,n){"string"!=typeof e&&(n=e,e=t[vs.LocaleId]),e=e.toLowerCase().replace(/_/g,"-"),ps[e]=t,n&&(ps[e][vs.ExtraData]=n)}function ms(t){const e=function(t){return t.toLowerCase().replace(/_/g,"-")}(t);let n=ys(e);if(n)return n;const r=e.split("-")[0];if(n=ys(r),n)return n;if("en"===r)return ds;throw new Error(`Missing locale data for the locale "${t}".`)}function gs(t){return ms(t)[vs.CurrencyCode]||null}function _s(t){return ms(t)[vs.PluralCase]}function ys(t){return t in ps||(ps[t]=L.ng&&L.ng.common&&L.ng.common.locales&&L.ng.common.locales[t]),ps[t]}var vs=function(t){return t[t.LocaleId=0]="LocaleId",t[t.DayPeriodsFormat=1]="DayPeriodsFormat",t[t.DayPeriodsStandalone=2]="DayPeriodsStandalone",t[t.DaysFormat=3]="DaysFormat",t[t.DaysStandalone=4]="DaysStandalone",t[t.MonthsFormat=5]="MonthsFormat",t[t.MonthsStandalone=6]="MonthsStandalone",t[t.Eras=7]="Eras",t[t.FirstDayOfWeek=8]="FirstDayOfWeek",t[t.WeekendRange=9]="WeekendRange",t[t.DateFormat=10]="DateFormat",t[t.TimeFormat=11]="TimeFormat",t[t.DateTimeFormat=12]="DateTimeFormat",t[t.NumberSymbols=13]="NumberSymbols",t[t.NumberFormats=14]="NumberFormats",t[t.CurrencyCode=15]="CurrencyCode",t[t.CurrencySymbol=16]="CurrencySymbol",t[t.CurrencyName=17]="CurrencyName",t[t.Currencies=18]="Currencies",t[t.Directionality=19]="Directionality",t[t.PluralCase=20]="PluralCase",t[t.ExtraData=21]="ExtraData",t}({});const bs="en-US";let xs=bs;function ws(t){var e,n;n="Expected localeId to be defined",null==(e=t)&&function(t,e,n,r){throw new Error(`ASSERTION ERROR: ${t} [Expected=> null != ${e} <=Actual]`)}(n,e),"string"==typeof t&&(xs=t.toLowerCase().replace(/_/g,"-"))}function Ts(t,e,n,r,i){if(t=f(t),Array.isArray(t))for(let o=0;o<t.length;o++)Ts(t[o],e,n,r,i);else{const o=Vt(),s=Ut();let a=yo(t)?t:f(t.provide),c=mo(t);const l=Gt(),u=1048575&l.providerIndexes,h=l.directiveStart,d=l.providerIndexes>>20;if(yo(t)||!t.multi){const r=new xe(c,i,Lo),p=Ss(a,e,i?u:u+d,h);-1===p?(je(De(l,s),o,a),Cs(o,t,e.length),e.push(a),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=1048576),n.push(r),s.push(r)):(n[p]=r,s[p]=r)}else{const p=Ss(a,e,u+d,h),f=Ss(a,e,u,u+d),m=p>=0&&n[p],g=f>=0&&n[f];if(i&&!g||!i&&!m){je(De(l,s),o,a);const u=function(t,e,n,r,i){const o=new xe(t,n,Lo);return o.multi=[],o.index=e,o.componentProviders=0,Es(o,i,r&&!n),o}(i?ks:Is,n.length,i,r,c);!i&&g&&(n[f].providerFactory=u),Cs(o,t,e.length,0),e.push(a),l.directiveStart++,l.directiveEnd++,i&&(l.providerIndexes+=1048576),n.push(u),s.push(u)}else Cs(o,t,p>-1?p:f,Es(n[i?f:p],c,!i&&r));!i&&r&&g&&n[f].componentProviders++}}}function Cs(t,e,n,r){const i=yo(e);if(i||e.useClass){const o=(e.useClass||e).prototype.ngOnDestroy;if(o){const s=t.destroyHooks||(t.destroyHooks=[]);if(!i&&e.multi){const t=s.indexOf(n);-1===t?s.push(n,[r,o]):s[t+1].push(r,o)}else s.push(n,o)}}}function Es(t,e,n){return n&&t.componentProviders++,t.multi.push(e)-1}function Ss(t,e,n,r){for(let i=n;i<r;i++)if(e[i]===t)return i;return-1}function Is(t,e,n,r){return As(this.multi,[])}function ks(t,e,n,r){const i=this.multi;let o;if(this.providerFactory){const t=this.providerFactory.componentProviders,e=$e(n,n[1],this.providerFactory.index,r);o=e.slice(0,t),As(i,o);for(let n=t;n<e.length;n++)o.push(e[n])}else o=[],As(i,o);return o}function As(t,e){for(let n=0;n<t.length;n++)e.push((0,t[n])());return e}function Ms(t,e=[]){return n=>{n.providersResolver=(n,r)=>function(t,e,n){const r=Vt();if(r.firstCreatePass){const i=ht(t);Ts(n,r.data,r.blueprint,i,!0),Ts(e,r.data,r.blueprint,i,!1)}}(n,r?r(t):t,e)}}class Os{}class Ps{resolveComponentFactory(t){throw function(t){const e=Error(`No component factory found for ${u(t)}. Did you add it to @NgModule.entryComponents?`);return e.ngComponent=t,e}(t)}}let Ds=(()=>{class t{}return t.NULL=new Ps,t})();function Rs(...t){}function Ns(t,e){return new js(Mt(t,e))}const Ls=function(){return Ns(Gt(),Ut())};let js=(()=>{class t{constructor(t){this.nativeElement=t}}return t.__NG_ELEMENT_ID__=Ls,t})();function zs(t){return t instanceof js?t.nativeElement:t}class Fs{}let Bs=(()=>{class t{}return t.__NG_ELEMENT_ID__=()=>Us(),t})();const Us=function(){const t=Ut(),e=Pt(Gt().index,t);return function(t){return t[11]}(st(e)?e:t)};let Vs=(()=>{class t{}return t.\u0275prov=g({token:t,providedIn:"root",factory:()=>null}),t})();class qs{constructor(t){this.full=t,this.major=t.split(".")[0],this.minor=t.split(".")[1],this.patch=t.split(".").slice(2).join(".")}}const Gs=new qs("11.1.2");class $s{constructor(){}supports(t){return Ao(t)}create(t){return new Hs(t)}}const Ws=(t,e)=>e;class Hs{constructor(t){this.length=0,this._linkedRecords=null,this._unlinkedRecords=null,this._previousItHead=null,this._itHead=null,this._itTail=null,this._additionsHead=null,this._additionsTail=null,this._movesHead=null,this._movesTail=null,this._removalsHead=null,this._removalsTail=null,this._identityChangesHead=null,this._identityChangesTail=null,this._trackByFn=t||Ws}forEachItem(t){let e;for(e=this._itHead;null!==e;e=e._next)t(e)}forEachOperation(t){let e=this._itHead,n=this._removalsHead,r=0,i=null;for(;e||n;){const o=!n||e&&e.currentIndex<Ys(n,r,i)?e:n,s=Ys(o,r,i),a=o.currentIndex;if(o===n)r--,n=n._nextRemoved;else if(e=e._next,null==o.previousIndex)r++;else{i||(i=[]);const t=s-r,e=a-r;if(t!=e){for(let n=0;n<t;n++){const r=n<i.length?i[n]:i[n]=0,o=r+n;e<=o&&o<t&&(i[n]=r+1)}i[o.previousIndex]=e-t}}s!==a&&t(o,s,a)}}forEachPreviousItem(t){let e;for(e=this._previousItHead;null!==e;e=e._nextPrevious)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachMovedItem(t){let e;for(e=this._movesHead;null!==e;e=e._nextMoved)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}forEachIdentityChange(t){let e;for(e=this._identityChangesHead;null!==e;e=e._nextIdentityChange)t(e)}diff(t){if(null==t&&(t=[]),!Ao(t))throw new Error(`Error trying to diff '${u(t)}'. Only arrays and iterables are allowed`);return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e,n,r,i=this._itHead,o=!1;if(Array.isArray(t)){this.length=t.length;for(let e=0;e<this.length;e++)n=t[e],r=this._trackByFn(e,n),null!==i&&Object.is(i.trackById,r)?(o&&(i=this._verifyReinsertion(i,n,r,e)),Object.is(i.item,n)||this._addIdentityChange(i,n)):(i=this._mismatch(i,n,r,e),o=!0),i=i._next}else e=0,function(t,e){if(Array.isArray(t))for(let n=0;n<t.length;n++)e(t[n]);else{const n=t[ko()]();let r;for(;!(r=n.next()).done;)e(r.value)}}(t,t=>{r=this._trackByFn(e,t),null!==i&&Object.is(i.trackById,r)?(o&&(i=this._verifyReinsertion(i,t,r,e)),Object.is(i.item,t)||this._addIdentityChange(i,t)):(i=this._mismatch(i,t,r,e),o=!0),i=i._next,e++}),this.length=e;return this._truncate(i),this.collection=t,this.isDirty}get isDirty(){return null!==this._additionsHead||null!==this._movesHead||null!==this._removalsHead||null!==this._identityChangesHead}_reset(){if(this.isDirty){let t;for(t=this._previousItHead=this._itHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._additionsHead;null!==t;t=t._nextAdded)t.previousIndex=t.currentIndex;for(this._additionsHead=this._additionsTail=null,t=this._movesHead;null!==t;t=t._nextMoved)t.previousIndex=t.currentIndex;this._movesHead=this._movesTail=null,this._removalsHead=this._removalsTail=null,this._identityChangesHead=this._identityChangesTail=null}}_mismatch(t,e,n,r){let i;return null===t?i=this._itTail:(i=t._prev,this._remove(t)),null!==(t=null===this._linkedRecords?null:this._linkedRecords.get(n,r))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._moveAfter(t,i,r)):null!==(t=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null))?(Object.is(t.item,e)||this._addIdentityChange(t,e),this._reinsertAfter(t,i,r)):t=this._addAfter(new Zs(e,n),i,r),t}_verifyReinsertion(t,e,n,r){let i=null===this._unlinkedRecords?null:this._unlinkedRecords.get(n,null);return null!==i?t=this._reinsertAfter(i,t._prev,r):t.currentIndex!=r&&(t.currentIndex=r,this._addToMoves(t,r)),t}_truncate(t){for(;null!==t;){const e=t._next;this._addToRemovals(this._unlink(t)),t=e}null!==this._unlinkedRecords&&this._unlinkedRecords.clear(),null!==this._additionsTail&&(this._additionsTail._nextAdded=null),null!==this._movesTail&&(this._movesTail._nextMoved=null),null!==this._itTail&&(this._itTail._next=null),null!==this._removalsTail&&(this._removalsTail._nextRemoved=null),null!==this._identityChangesTail&&(this._identityChangesTail._nextIdentityChange=null)}_reinsertAfter(t,e,n){null!==this._unlinkedRecords&&this._unlinkedRecords.remove(t);const r=t._prevRemoved,i=t._nextRemoved;return null===r?this._removalsHead=i:r._nextRemoved=i,null===i?this._removalsTail=r:i._prevRemoved=r,this._insertAfter(t,e,n),this._addToMoves(t,n),t}_moveAfter(t,e,n){return this._unlink(t),this._insertAfter(t,e,n),this._addToMoves(t,n),t}_addAfter(t,e,n){return this._insertAfter(t,e,n),this._additionsTail=null===this._additionsTail?this._additionsHead=t:this._additionsTail._nextAdded=t,t}_insertAfter(t,e,n){const r=null===e?this._itHead:e._next;return t._next=r,t._prev=e,null===r?this._itTail=t:r._prev=t,null===e?this._itHead=t:e._next=t,null===this._linkedRecords&&(this._linkedRecords=new Xs),this._linkedRecords.put(t),t.currentIndex=n,t}_remove(t){return this._addToRemovals(this._unlink(t))}_unlink(t){null!==this._linkedRecords&&this._linkedRecords.remove(t);const e=t._prev,n=t._next;return null===e?this._itHead=n:e._next=n,null===n?this._itTail=e:n._prev=e,t}_addToMoves(t,e){return t.previousIndex===e||(this._movesTail=null===this._movesTail?this._movesHead=t:this._movesTail._nextMoved=t),t}_addToRemovals(t){return null===this._unlinkedRecords&&(this._unlinkedRecords=new Xs),this._unlinkedRecords.put(t),t.currentIndex=null,t._nextRemoved=null,null===this._removalsTail?(this._removalsTail=this._removalsHead=t,t._prevRemoved=null):(t._prevRemoved=this._removalsTail,this._removalsTail=this._removalsTail._nextRemoved=t),t}_addIdentityChange(t,e){return t.item=e,this._identityChangesTail=null===this._identityChangesTail?this._identityChangesHead=t:this._identityChangesTail._nextIdentityChange=t,t}}class Zs{constructor(t,e){this.item=t,this.trackById=e,this.currentIndex=null,this.previousIndex=null,this._nextPrevious=null,this._prev=null,this._next=null,this._prevDup=null,this._nextDup=null,this._prevRemoved=null,this._nextRemoved=null,this._nextAdded=null,this._nextMoved=null,this._nextIdentityChange=null}}class Ks{constructor(){this._head=null,this._tail=null}add(t){null===this._head?(this._head=this._tail=t,t._nextDup=null,t._prevDup=null):(this._tail._nextDup=t,t._prevDup=this._tail,t._nextDup=null,this._tail=t)}get(t,e){let n;for(n=this._head;null!==n;n=n._nextDup)if((null===e||e<=n.currentIndex)&&Object.is(n.trackById,t))return n;return null}remove(t){const e=t._prevDup,n=t._nextDup;return null===e?this._head=n:e._nextDup=n,null===n?this._tail=e:n._prevDup=e,null===this._head}}class Xs{constructor(){this.map=new Map}put(t){const e=t.trackById;let n=this.map.get(e);n||(n=new Ks,this.map.set(e,n)),n.add(t)}get(t,e){const n=this.map.get(t);return n?n.get(t,e):null}remove(t){const e=t.trackById;return this.map.get(e).remove(t)&&this.map.delete(e),t}get isEmpty(){return 0===this.map.size}clear(){this.map.clear()}}function Ys(t,e,n){const r=t.previousIndex;if(null===r)return r;let i=0;return n&&r<n.length&&(i=n[r]),r+e+i}class Qs{constructor(){}supports(t){return t instanceof Map||Mo(t)}create(){return new Js}}class Js{constructor(){this._records=new Map,this._mapHead=null,this._appendAfter=null,this._previousMapHead=null,this._changesHead=null,this._changesTail=null,this._additionsHead=null,this._additionsTail=null,this._removalsHead=null,this._removalsTail=null}get isDirty(){return null!==this._additionsHead||null!==this._changesHead||null!==this._removalsHead}forEachItem(t){let e;for(e=this._mapHead;null!==e;e=e._next)t(e)}forEachPreviousItem(t){let e;for(e=this._previousMapHead;null!==e;e=e._nextPrevious)t(e)}forEachChangedItem(t){let e;for(e=this._changesHead;null!==e;e=e._nextChanged)t(e)}forEachAddedItem(t){let e;for(e=this._additionsHead;null!==e;e=e._nextAdded)t(e)}forEachRemovedItem(t){let e;for(e=this._removalsHead;null!==e;e=e._nextRemoved)t(e)}diff(t){if(t){if(!(t instanceof Map||Mo(t)))throw new Error(`Error trying to diff '${u(t)}'. Only maps and objects are allowed`)}else t=new Map;return this.check(t)?this:null}onDestroy(){}check(t){this._reset();let e=this._mapHead;if(this._appendAfter=null,this._forEach(t,(t,n)=>{if(e&&e.key===n)this._maybeAddToChanges(e,t),this._appendAfter=e,e=e._next;else{const r=this._getOrCreateRecordForKey(n,t);e=this._insertBeforeOrAppend(e,r)}}),e){e._prev&&(e._prev._next=null),this._removalsHead=e;for(let t=e;null!==t;t=t._nextRemoved)t===this._mapHead&&(this._mapHead=null),this._records.delete(t.key),t._nextRemoved=t._next,t.previousValue=t.currentValue,t.currentValue=null,t._prev=null,t._next=null}return this._changesTail&&(this._changesTail._nextChanged=null),this._additionsTail&&(this._additionsTail._nextAdded=null),this.isDirty}_insertBeforeOrAppend(t,e){if(t){const n=t._prev;return e._next=t,e._prev=n,t._prev=e,n&&(n._next=e),t===this._mapHead&&(this._mapHead=e),this._appendAfter=t,t}return this._appendAfter?(this._appendAfter._next=e,e._prev=this._appendAfter):this._mapHead=e,this._appendAfter=e,null}_getOrCreateRecordForKey(t,e){if(this._records.has(t)){const n=this._records.get(t);this._maybeAddToChanges(n,e);const r=n._prev,i=n._next;return r&&(r._next=i),i&&(i._prev=r),n._next=null,n._prev=null,n}const n=new ta(t);return this._records.set(t,n),n.currentValue=e,this._addToAdditions(n),n}_reset(){if(this.isDirty){let t;for(this._previousMapHead=this._mapHead,t=this._previousMapHead;null!==t;t=t._next)t._nextPrevious=t._next;for(t=this._changesHead;null!==t;t=t._nextChanged)t.previousValue=t.currentValue;for(t=this._additionsHead;null!=t;t=t._nextAdded)t.previousValue=t.currentValue;this._changesHead=this._changesTail=null,this._additionsHead=this._additionsTail=null,this._removalsHead=null}}_maybeAddToChanges(t,e){Object.is(e,t.currentValue)||(t.previousValue=t.currentValue,t.currentValue=e,this._addToChanges(t))}_addToAdditions(t){null===this._additionsHead?this._additionsHead=this._additionsTail=t:(this._additionsTail._nextAdded=t,this._additionsTail=t)}_addToChanges(t){null===this._changesHead?this._changesHead=this._changesTail=t:(this._changesTail._nextChanged=t,this._changesTail=t)}_forEach(t,e){t instanceof Map?t.forEach(e):Object.keys(t).forEach(n=>e(t[n],n))}}class ta{constructor(t){this.key=t,this.previousValue=null,this.currentValue=null,this._nextPrevious=null,this._next=null,this._prev=null,this._nextAdded=null,this._nextRemoved=null,this._nextChanged=null}}function ea(){return new na([new $s])}let na=(()=>{class t{constructor(t){this.factories=t}static create(e,n){if(null!=n){const t=n.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:n=>t.create(e,n||ea()),deps:[[t,new Cn,new Tn]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(null!=e)return e;throw new Error(`Cannot find a differ supporting object '${t}' of type '${n=t,n.name||typeof n}'`);var n}}return t.\u0275prov=g({token:t,providedIn:"root",factory:ea}),t})();function ra(){return new ia([new Qs])}let ia=(()=>{class t{constructor(t){this.factories=t}static create(e,n){if(n){const t=n.factories.slice();e=e.concat(t)}return new t(e)}static extend(e){return{provide:t,useFactory:n=>t.create(e,n||ra()),deps:[[t,new Cn,new Tn]]}}find(t){const e=this.factories.find(e=>e.supports(t));if(e)return e;throw new Error(`Cannot find a differ supporting object '${t}'`)}}return t.\u0275prov=g({token:t,providedIn:"root",factory:ra}),t})();function oa(t,e,n,r,i=!1){for(;null!==n;){const o=e[n.index];if(null!==o&&r.push(kt(o)),at(o))for(let t=ot;t<o.length;t++){const e=o[t],n=e[1].firstChild;null!==n&&oa(e[1],e,n,r)}const s=n.type;if(8&s)oa(t,e,n.child,r);else if(32&s){const t=Cr(n,e);let i;for(;i=t();)r.push(i)}else if(16&s){const t=e[16],i=t[6].projection[n.projection];if(Array.isArray(i))r.push(...i);else{const e=Er(t);oa(e[1],e,i,r,!0)}}n=i?n.projectionNext:n.next}return r}class sa{constructor(t,e){this._lView=t,this._cdRefInjectingView=e,this._appRef=null,this._attachedToViewContainer=!1}get rootNodes(){const t=this._lView,e=t[1];return oa(e,t,e.firstChild,[])}get context(){return this._lView[8]}get destroyed(){return 256==(256&this._lView[2])}destroy(){if(this._appRef)this._appRef.detachView(this);else if(this._attachedToViewContainer){const t=this._lView[3];if(at(t)){const e=t[8],n=e?e.indexOf(this):-1;n>-1&&(Pr(t,n),an(e,n))}this._attachedToViewContainer=!1}Dr(this._lView[1],this._lView)}onDestroy(t){Ai(this._lView[1],this._lView,null,t)}markForCheck(){Hi(this._cdRefInjectingView||this._lView)}detach(){this._lView[2]&=-129}reattach(){this._lView[2]|=128}detectChanges(){Zi(this._lView[1],this._lView,this.context)}checkNoChanges(){!function(t,e,n){Xt(!0);try{Zi(t,e,n)}finally{Xt(!1)}}(this._lView[1],this._lView,this.context)}attachToViewContainerRef(){if(this._appRef)throw new Error("This view is already attached directly to the ApplicationRef!");this._attachedToViewContainer=!0}detachFromAppRef(){var t;this._appRef=null,Wr(this._lView[1],t=this._lView,t[11],2,null,null)}attachToAppRef(t){if(this._attachedToViewContainer)throw new Error("This view is already attached to a ViewContainer!");this._appRef=t}}class aa extends sa{constructor(t){super(t),this._view=t}detectChanges(){Ki(this._view)}checkNoChanges(){!function(t){Xt(!0);try{Ki(t)}finally{Xt(!1)}}(this._view)}get context(){return null}}const ca=ua;let la=(()=>{class t{}return t.__NG_ELEMENT_ID__=ca,t.__ChangeDetectorRef__=!0,t})();function ua(t=!1){return function(t,e,n){if(!n&&lt(t)){const n=Pt(t.index,e);return new sa(n,n)}return 47&t.type?new sa(e[16],e):null}(Gt(),Ut(),t)}const ha=[new Qs],da=new na([new $s]),pa=new ia(ha),fa=function(){return ya(Gt(),Ut())};let ma=(()=>{class t{}return t.__NG_ELEMENT_ID__=fa,t})();const ga=ma,_a=class extends ga{constructor(t,e,n){super(),this._declarationLView=t,this._declarationTContainer=e,this.elementRef=n}createEmbeddedView(t){const e=this._declarationTContainer.tViews,n=yi(this._declarationLView,e,t,16,null,e.declTNode,null,null,null,null);n[17]=this._declarationLView[this._declarationTContainer.index];const r=this._declarationLView[19];return null!==r&&(n[19]=r.createEmbeddedView(e)),xi(e,n,t),new sa(n)}};function ya(t,e){return 4&t.type?new _a(e,t,Ns(t,e)):null}class va{}class ba{}const xa=function(){return Ia(Gt(),Ut())};let wa=(()=>{class t{}return t.__NG_ELEMENT_ID__=xa,t})();const Ta=wa,Ca=class extends Ta{constructor(t,e,n){super(),this._lContainer=t,this._hostTNode=e,this._hostLView=n}get element(){return Ns(this._hostTNode,this._hostLView)}get injector(){return new Ze(this._hostTNode,this._hostLView)}get parentInjector(){const t=Le(this._hostTNode,this._hostLView);if(Ie(t)){const e=Ae(t,this._hostLView),n=ke(t);return new Ze(e[1].data[n+8],e)}return new Ze(null,this._hostLView)}clear(){for(;this.length>0;)this.remove(this.length-1)}get(t){const e=Ea(this._lContainer);return null!==e&&e[t]||null}get length(){return this._lContainer.length-ot}createEmbeddedView(t,e,n){const r=t.createEmbeddedView(e||{});return this.insert(r,n),r}createComponent(t,e,n,r,i){const o=n||this.parentInjector;if(!i&&null==t.ngModule&&o){const t=o.get(va,null);t&&(i=t)}const s=t.create(o,r,void 0,i);return this.insert(s.hostView,e),s}insert(t,e){const n=t._lView,r=n[1];if(at(n[3])){const e=this.indexOf(t);if(-1!==e)this.detach(e);else{const e=n[3],r=new Ca(e,e[6],e[3]);r.detach(r.indexOf(t))}}const i=this._adjustIndex(e),o=this._lContainer;!function(t,e,n,r){const i=ot+r,o=n.length;r>0&&(n[i-1][4]=e),r<o-ot?(e[4]=n[i],sn(n,ot+r,e)):(n.push(e),e[4]=null),e[3]=n;const s=e[17];null!==s&&n!==s&&function(t,e){const n=t[9];e[16]!==e[3][3][16]&&(t[2]=!0),null===n?t[9]=[e]:n.push(e)}(s,e);const a=e[19];null!==a&&a.insertView(t),e[2]|=128}(r,n,o,i);const s=Gr(i,o),a=n[11],c=Fr(a,o[7]);return null!==c&&function(t,e,n,r,i,o){r[0]=i,r[6]=e,Wr(t,r,n,1,i,o)}(r,o[6],a,n,c,s),t.attachToViewContainerRef(),sn(Sa(o),i,t),t}move(t,e){return this.insert(t,e)}indexOf(t){const e=Ea(this._lContainer);return null!==e?e.indexOf(t):-1}remove(t){const e=this._adjustIndex(t,-1),n=Pr(this._lContainer,e);n&&(an(Sa(this._lContainer),e),Dr(n[1],n))}detach(t){const e=this._adjustIndex(t,-1),n=Pr(this._lContainer,e);return n&&null!=an(Sa(this._lContainer),e)?new sa(n):null}_adjustIndex(t,e=0){return null==t?this.length+e:t}};function Ea(t){return t[8]}function Sa(t){return t[8]||(t[8]=[])}function Ia(t,e){let n;const r=e[t.index];if(at(r))n=r;else{let i;if(8&t.type)i=kt(r);else{const n=e[11];i=n.createComment("");const r=Mt(t,e);Lr(n,Fr(n,r),i,function(t,e){return St(t)?t.nextSibling(e):e.nextSibling}(n,r),!1)}e[t.index]=n=Vi(r,e,i,t),Wi(e,n)}return new Ca(n,t,e)}const ka={};class Aa extends Ds{constructor(t){super(),this.ngModule=t}resolveComponentFactory(t){const e=nt(t);return new Pa(e,this.ngModule)}}function Ma(t){const e=[];for(let n in t)t.hasOwnProperty(n)&&e.push({propName:t[n],templateName:n});return e}const Oa=new tn("SCHEDULER_TOKEN",{providedIn:"root",factory:()=>xr});class Pa extends Os{constructor(t,e){super(),this.componentDef=t,this.ngModule=e,this.componentType=t.type,this.selector=t.selectors.map(ai).join(","),this.ngContentSelectors=t.ngContentSelectors?t.ngContentSelectors:[],this.isBoundToModule=!!e}get inputs(){return Ma(this.componentDef.inputs)}get outputs(){return Ma(this.componentDef.outputs)}create(t,e,n,r){const i=(r=r||this.ngModule)?function(t,e){return{get:(n,r,i)=>{const o=t.get(n,ka,i);return o!==ka||r===ka?o:e.get(n,r,i)}}}(t,r.injector):t,o=i.get(Fs,It),s=i.get(Vs,null),a=o.createRenderer(null,this.componentDef),c=this.componentDef.selectors[0][0]||"div",l=n?function(t,e,n){if(St(t))return t.selectRootElement(e,n===O.ShadowDom);let r="string"==typeof e?t.querySelector(e):e;return r.textContent="",r}(a,n,this.componentDef.encapsulation):Mr(o.createRenderer(null,this.componentDef),c,function(t){const e=t.toLowerCase();return"svg"===e?"http://www.w3.org/2000/svg":"math"===e?"http://www.w3.org/1998/MathML/":null}(c)),u=this.componentDef.onPush?576:528,h={components:[],scheduler:xr,clean:Yi,playerHandler:null,flags:0},d=ki(0,null,null,1,0,null,null,null,null,null),p=yi(null,d,h,u,null,null,o,a,s,i);let f,m;oe(p);try{const t=function(t,e,n,r,i,o){const s=n[1];n[20]=t;const a=vi(s,20,2,"#host",null),c=a.mergedAttrs=e.hostAttrs;null!==c&&(no(a,c,!0),null!==t&&(we(i,t,c),null!==a.classes&&Kr(i,t,a.classes),null!==a.styles&&Zr(i,t,a.styles)));const l=r.createRenderer(t,e),u=yi(n,Ii(e),null,e.onPush?64:16,n[20],a,r,l,null,null);return s.firstCreatePass&&(je(De(a,n),s,e.type),Ni(s,a),ji(a,n.length,1)),Wi(n,u),n[20]=u}(l,this.componentDef,p,o,a);if(l)if(n)we(a,l,["ng-version",Gs.full]);else{const{attrs:t,classes:e}=function(t){const e=[],n=[];let r=1,i=2;for(;r<t.length;){let o=t[r];if("string"==typeof o)2===i?""!==o&&e.push(o,t[++r]):8===i&&n.push(o);else{if(!ni(i))break;i=o}r++}return{attrs:e,classes:n}}(this.componentDef.selectors[0]);t&&we(a,l,t),e&&e.length>0&&Kr(a,l,e.join(" "))}if(m=Ot(d,it),void 0!==e){const t=m.projection=[];for(let n=0;n<this.ngContentSelectors.length;n++){const r=e[n];t.push(null!=r?Array.from(r):null)}}f=function(t,e,n,r,i){const o=n[1],s=function(t,e,n){const r=Gt();t.firstCreatePass&&(n.providersResolver&&n.providersResolver(n),zi(t,r,e,bi(t,e,1,null),n));const i=$e(e,t,r.directiveStart,r);br(i,e);const o=Mt(r,e);return o&&br(o,e),i}(o,n,e);if(r.components.push(s),t[8]=s,i&&i.forEach(t=>t(s,e)),e.contentQueries){const t=Gt();e.contentQueries(1,s,t.directiveStart)}const a=Gt();return!o.firstCreatePass||null===e.hostBindings&&null===e.hostAttrs||(de(a.index),Di(n[1],a,0,a.directiveStart,a.directiveEnd,e),Ri(e,s)),s}(t,this.componentDef,p,h,[xo]),xi(d,p,null)}finally{ue()}return new Da(this.componentType,f,Ns(m,p),p,m)}}class Da extends class{}{constructor(t,e,n,r,i){super(),this.location=n,this._rootLView=r,this._tNode=i,this.instance=e,this.hostView=this.changeDetectorRef=new aa(r),this.componentType=t}get injector(){return new Ze(this._tNode,this._rootLView)}destroy(){this.hostView.destroy()}onDestroy(t){this.hostView.onDestroy(t)}}const Ra=new Map;class Na extends va{constructor(t,e){super(),this._parent=e,this._bootstrapComponents=[],this.injector=this,this.destroyCbs=[],this.componentFactoryResolver=new Aa(this);const n=rt(t),r=t[q]||null;r&&ws(r),this._bootstrapComponents=wr(n.bootstrap),this._r3Injector=ho(t,e,[{provide:va,useValue:this},{provide:Ds,useValue:this.componentFactoryResolver}],u(t)),this._r3Injector._resolveInjectorDefTypes(),this.instance=this.get(t)}get(t,e=bo.THROW_IF_NOT_FOUND,n=E.Default){return t===bo||t===va||t===ro?this:this._r3Injector.get(t,e,n)}destroy(){const t=this._r3Injector;!t.destroyed&&t.destroy(),this.destroyCbs.forEach(t=>t()),this.destroyCbs=null}onDestroy(t){this.destroyCbs.push(t)}}class La extends ba{constructor(t){super(),this.moduleType=t,null!==rt(t)&&function(t){const e=new Set;!function t(n){const r=rt(n,!0),i=r.id;null!==i&&(function(t,e,n){if(e&&e!==n)throw new Error(`Duplicate module registered for ${t} - ${u(e)} vs ${u(e.name)}`)}(i,Ra.get(i),n),Ra.set(i,n));const o=wr(r.imports);for(const s of o)e.has(s)||(e.add(s),t(s))}(t)}(t)}create(t){return new Na(this.moduleType,t)}}function ja(t,e,n){const r=Yt()+t,i=Ut();return i[r]===ci?Oo(i,r,n?e.call(n):e()):function(t,e){return t[e]}(i,r)}function za(t,e,n,r){return function(t,e,n,r,i,o){const s=e+n;return Po(t,s,i)?Oo(t,s+1,o?r.call(o,i):r(i)):function(t,e){const n=t[e];return n===ci?void 0:n}(t,s+1)}(Ut(),Yt(),t,e,n,r)}const Fa=class extends r.a{constructor(t=!1){super(),this.__isAsync=t}emit(t){super.next(t)}subscribe(t,e,n){let r,o=t=>null,s=()=>null;t&&"object"==typeof t?(r=this.__isAsync?e=>{setTimeout(()=>t.next(e))}:e=>{t.next(e)},t.error&&(o=this.__isAsync?e=>{setTimeout(()=>t.error(e))}:e=>{t.error(e)}),t.complete&&(s=this.__isAsync?()=>{setTimeout(()=>t.complete())}:()=>{t.complete()})):(r=this.__isAsync?e=>{setTimeout(()=>t(e))}:e=>{t(e)},e&&(o=this.__isAsync?t=>{setTimeout(()=>e(t))}:t=>{e(t)}),n&&(s=this.__isAsync?()=>{setTimeout(()=>n())}:()=>{n()}));const a=super.subscribe(r,o,s);return t instanceof i.a&&t.add(a),a}};function Ba(){return this._results[ko()]()}class Ua{constructor(t=!1){this._emitDistinctChangesOnly=t,this.dirty=!0,this._results=[],this._changesDetected=!1,this._changes=null,this.length=0,this.first=void 0,this.last=void 0;const e=ko(),n=Ua.prototype;n[e]||(n[e]=Ba)}get changes(){return this._changes||(this._changes=new Fa)}get(t){return this._results[t]}map(t){return this._results.map(t)}filter(t){return this._results.filter(t)}find(t){return this._results.find(t)}reduce(t,e){return this._results.reduce(t,e)}forEach(t){this._results.forEach(t)}some(t){return this._results.some(t)}toArray(){return this._results.slice()}toString(){return this._results.toString()}reset(t,e){const n=this;n.dirty=!1;const r=rn(t);(this._changesDetected=!function(t,e,n){if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++){let i=t[r],o=e[r];if(n&&(i=n(i),o=n(o)),o!==i)return!1}return!0}(n._results,r,e))&&(n._results=r,n.length=r.length,n.last=r[this.length-1],n.first=r[0])}notifyOnChanges(){!this._changes||!this._changesDetected&&this._emitDistinctChangesOnly||this._changes.emit(this)}setDirty(){this.dirty=!0}destroy(){this.changes.complete(),this.changes.unsubscribe()}}class Va{constructor(t){this.queryList=t,this.matches=null}clone(){return new Va(this.queryList)}setDirty(){this.queryList.setDirty()}}class qa{constructor(t=[]){this.queries=t}createEmbeddedView(t){const e=t.queries;if(null!==e){const n=null!==t.contentQueries?t.contentQueries[0]:e.length,r=[];for(let t=0;t<n;t++){const n=e.getByIndex(t);r.push(this.queries[n.indexInDeclarationView].clone())}return new qa(r)}return null}insertView(t){this.dirtyQueriesWithMatches(t)}detachView(t){this.dirtyQueriesWithMatches(t)}dirtyQueriesWithMatches(t){for(let e=0;e<this.queries.length;e++)null!==rc(t,e).matches&&this.queries[e].setDirty()}}class Ga{constructor(t,e,n=null){this.predicate=t,this.flags=e,this.read=n}}class $a{constructor(t=[]){this.queries=t}elementStart(t,e){for(let n=0;n<this.queries.length;n++)this.queries[n].elementStart(t,e)}elementEnd(t){for(let e=0;e<this.queries.length;e++)this.queries[e].elementEnd(t)}embeddedTView(t){let e=null;for(let n=0;n<this.length;n++){const r=null!==e?e.length:0,i=this.getByIndex(n).embeddedTView(t,r);i&&(i.indexInDeclarationView=n,null!==e?e.push(i):e=[i])}return null!==e?new $a(e):null}template(t,e){for(let n=0;n<this.queries.length;n++)this.queries[n].template(t,e)}getByIndex(t){return this.queries[t]}get length(){return this.queries.length}track(t){this.queries.push(t)}}class Wa{constructor(t,e=-1){this.metadata=t,this.matches=null,this.indexInDeclarationView=-1,this.crossesNgTemplate=!1,this._appliesToNextNode=!0,this._declarationNodeIndex=e}elementStart(t,e){this.isApplyingToNode(e)&&this.matchTNode(t,e)}elementEnd(t){this._declarationNodeIndex===t.index&&(this._appliesToNextNode=!1)}template(t,e){this.elementStart(t,e)}embeddedTView(t,e){return this.isApplyingToNode(t)?(this.crossesNgTemplate=!0,this.addMatch(-t.index,e),new Wa(this.metadata)):null}isApplyingToNode(t){if(this._appliesToNextNode&&1!=(1&this.metadata.flags)){const e=this._declarationNodeIndex;let n=t.parent;for(;null!==n&&8&n.type&&n.index!==e;)n=n.parent;return e===(null!==n?n.index:-1)}return this._appliesToNextNode}matchTNode(t,e){const n=this.metadata.predicate;if(Array.isArray(n))for(let r=0;r<n.length;r++){const i=n[r];this.matchTNodeWithReadOption(t,e,Ha(e,i)),this.matchTNodeWithReadOption(t,e,Ge(e,t,i,!1,!1))}else n===ma?4&e.type&&this.matchTNodeWithReadOption(t,e,-1):this.matchTNodeWithReadOption(t,e,Ge(e,t,n,!1,!1))}matchTNodeWithReadOption(t,e,n){if(null!==n){const r=this.metadata.read;if(null!==r)if(r===js||r===wa||r===ma&&4&e.type)this.addMatch(e.index,-2);else{const n=Ge(e,t,r,!1,!1);null!==n&&this.addMatch(e.index,n)}else this.addMatch(e.index,n)}}addMatch(t,e){null===this.matches?this.matches=[t,e]:this.matches.push(t,e)}}function Ha(t,e){const n=t.localNames;if(null!==n)for(let r=0;r<n.length;r+=2)if(n[r]===e)return n[r+1];return null}function Za(t,e,n,r){return-1===n?function(t,e){return 11&t.type?Ns(t,e):4&t.type?ya(t,e):null}(e,t):-2===n?function(t,e,n){return n===js?Ns(e,t):n===ma?ya(e,t):n===wa?Ia(e,t):void 0}(t,e,r):$e(t,t[1],n,e)}function Ka(t,e,n,r){const i=e[19].queries[r];if(null===i.matches){const r=t.data,o=n.matches,s=[];for(let t=0;t<o.length;t+=2){const i=o[t];s.push(i<0?null:Za(e,r[i],o[t+1],n.metadata.read))}i.matches=s}return i.matches}function Xa(t,e,n,r){const i=t.queries.getByIndex(n),o=i.matches;if(null!==o){const s=Ka(t,e,i,n);for(let t=0;t<o.length;t+=2){const n=o[t];if(n>0)r.push(s[t/2]);else{const i=o[t+1],s=e[-n];for(let t=ot;t<s.length;t++){const e=s[t];e[17]===e[3]&&Xa(e[1],e,i,r)}if(null!==s[9]){const t=s[9];for(let e=0;e<t.length;e++){const n=t[e];Xa(n[1],n,i,r)}}}}}return r}function Ya(t){const e=Ut(),n=Vt(),r=ee();ne(r+1);const i=rc(n,r);if(t.dirty&&Rt(e)===(2==(2&i.metadata.flags))){if(null===i.matches)t.reset([]);else{const o=i.crossesNgTemplate?Xa(n,e,r,[]):Ka(n,e,i,r);t.reset(o,zs),t.notifyOnChanges()}return!0}return!1}function Qa(t,e,n){const r=Vt();r.firstCreatePass&&(nc(r,new Ga(t,e,n),-1),2==(2&e)&&(r.staticViewQueries=!0)),ec(r,Ut(),e)}function Ja(t,e,n,r){const i=Vt();if(i.firstCreatePass){const o=Gt();nc(i,new Ga(e,n,r),o.index),function(t,e){const n=t.contentQueries||(t.contentQueries=[]);e!==(n.length?n[n.length-1]:-1)&&n.push(t.queries.length-1,e)}(i,t),2==(2&n)&&(i.staticContentQueries=!0)}ec(i,Ut(),n)}function tc(){return t=Ut(),e=ee(),t[19].queries[e].queryList;var t,e}function ec(t,e,n){const r=new Ua(4==(4&n));Ai(t,e,r,r.destroy),null===e[19]&&(e[19]=new qa),e[19].queries.push(new Va(r))}function nc(t,e,n){null===t.queries&&(t.queries=new $a),t.queries.track(new Wa(e,n))}function rc(t,e){return t.queries.getByIndex(e)}function ic(t=E.Default){const e=ua(!0);if(null!=e||t&E.Optional)return e;gt("ChangeDetectorRef")}const oc=new tn("Application Initializer");let sc=(()=>{class t{constructor(t){this.appInits=t,this.resolve=Rs,this.reject=Rs,this.initialized=!1,this.done=!1,this.donePromise=new Promise((t,e)=>{this.resolve=t,this.reject=e})}runInitializers(){if(this.initialized)return;const t=[],e=()=>{this.done=!0,this.resolve()};if(this.appInits)for(let n=0;n<this.appInits.length;n++){const e=this.appInits[n]();qo(e)&&t.push(e)}Promise.all(t).then(()=>{e()}).catch(t=>{this.reject(t)}),0===t.length&&e(),this.initialized=!0}}return t.\u0275fac=function(e){return new(e||t)(vn(oc,8))},t.\u0275prov=g({token:t,factory:t.\u0275fac}),t})();const ac=new tn("AppId"),cc={provide:ac,useFactory:function(){return`${lc()}${lc()}${lc()}`},deps:[]};function lc(){return String.fromCharCode(97+Math.floor(25*Math.random()))}const uc=new tn("Platform Initializer"),hc=new tn("Platform ID"),dc=new tn("appBootstrapListener");let pc=(()=>{class t{log(t){console.log(t)}warn(t){console.warn(t)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=g({token:t,factory:t.\u0275fac}),t})();const fc=new tn("LocaleId"),mc=new tn("DefaultCurrencyCode");class gc{constructor(t,e){this.ngModuleFactory=t,this.componentFactories=e}}const _c=function(t){return new La(t)},yc=_c,vc=function(t){return Promise.resolve(_c(t))},bc=function(t){const e=_c(t),n=wr(rt(t).declarations).reduce((t,e)=>{const n=nt(e);return n&&t.push(new Pa(n)),t},[]);return new gc(e,n)},xc=bc,wc=function(t){return Promise.resolve(bc(t))};let Tc=(()=>{class t{constructor(){this.compileModuleSync=yc,this.compileModuleAsync=vc,this.compileModuleAndAllComponentsSync=xc,this.compileModuleAndAllComponentsAsync=wc}clearCache(){}clearCacheFor(t){}getModuleId(t){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=g({token:t,factory:t.\u0275fac}),t})();const Cc=(()=>Promise.resolve(0))();function Ec(t){"undefined"==typeof Zone?Cc.then(()=>{t&&t.apply(null,null)}):Zone.current.scheduleMicroTask("scheduleMicrotask",t)}class Sc{constructor({enableLongStackTrace:t=!1,shouldCoalesceEventChangeDetection:e=!1,shouldCoalesceRunChangeDetection:n=!1}){if(this.hasPendingMacrotasks=!1,this.hasPendingMicrotasks=!1,this.isStable=!0,this.onUnstable=new Fa(!1),this.onMicrotaskEmpty=new Fa(!1),this.onStable=new Fa(!1),this.onError=new Fa(!1),"undefined"==typeof Zone)throw new Error("In this configuration Angular requires Zone.js");Zone.assertZonePatched();const r=this;r._nesting=0,r._outer=r._inner=Zone.current,Zone.TaskTrackingZoneSpec&&(r._inner=r._inner.fork(new Zone.TaskTrackingZoneSpec)),t&&Zone.longStackTraceZoneSpec&&(r._inner=r._inner.fork(Zone.longStackTraceZoneSpec)),r.shouldCoalesceEventChangeDetection=!n&&e,r.shouldCoalesceRunChangeDetection=n,r.lastRequestAnimationFrameId=-1,r.nativeRequestAnimationFrame=function(){let t=L.requestAnimationFrame,e=L.cancelAnimationFrame;if("undefined"!=typeof Zone&&t&&e){const n=t[Zone.__symbol__("OriginalDelegate")];n&&(t=n);const r=e[Zone.__symbol__("OriginalDelegate")];r&&(e=r)}return{nativeRequestAnimationFrame:t,nativeCancelAnimationFrame:e}}().nativeRequestAnimationFrame,function(t){const e=()=>{!function(t){-1===t.lastRequestAnimationFrameId&&(t.lastRequestAnimationFrameId=t.nativeRequestAnimationFrame.call(L,()=>{t.fakeTopEventTask||(t.fakeTopEventTask=Zone.root.scheduleEventTask("fakeTopEventTask",()=>{t.lastRequestAnimationFrameId=-1,Ac(t),kc(t)},void 0,()=>{},()=>{})),t.fakeTopEventTask.invoke()}),Ac(t))}(t)};t._inner=t._inner.fork({name:"angular",properties:{isAngularZone:!0},onInvokeTask:(n,r,i,o,s,a)=>{try{return Mc(t),n.invokeTask(i,o,s,a)}finally{(t.shouldCoalesceEventChangeDetection&&"eventTask"===o.type||t.shouldCoalesceRunChangeDetection)&&e(),Oc(t)}},onInvoke:(n,r,i,o,s,a,c)=>{try{return Mc(t),n.invoke(i,o,s,a,c)}finally{t.shouldCoalesceRunChangeDetection&&e(),Oc(t)}},onHasTask:(e,n,r,i)=>{e.hasTask(r,i),n===r&&("microTask"==i.change?(t._hasPendingMicrotasks=i.microTask,Ac(t),kc(t)):"macroTask"==i.change&&(t.hasPendingMacrotasks=i.macroTask))},onHandleError:(e,n,r,i)=>(e.handleError(r,i),t.runOutsideAngular(()=>t.onError.emit(i)),!1)})}(r)}static isInAngularZone(){return!0===Zone.current.get("isAngularZone")}static assertInAngularZone(){if(!Sc.isInAngularZone())throw new Error("Expected to be in Angular Zone, but it is not!")}static assertNotInAngularZone(){if(Sc.isInAngularZone())throw new Error("Expected to not be in Angular Zone, but it is!")}run(t,e,n){return this._inner.run(t,e,n)}runTask(t,e,n,r){const i=this._inner,o=i.scheduleEventTask("NgZoneEvent: "+r,t,Ic,Rs,Rs);try{return i.runTask(o,e,n)}finally{i.cancelTask(o)}}runGuarded(t,e,n){return this._inner.runGuarded(t,e,n)}runOutsideAngular(t){return this._outer.run(t)}}const Ic={};function kc(t){if(0==t._nesting&&!t.hasPendingMicrotasks&&!t.isStable)try{t._nesting++,t.onMicrotaskEmpty.emit(null)}finally{if(t._nesting--,!t.hasPendingMicrotasks)try{t.runOutsideAngular(()=>t.onStable.emit(null))}finally{t.isStable=!0}}}function Ac(t){t.hasPendingMicrotasks=!!(t._hasPendingMicrotasks||(t.shouldCoalesceEventChangeDetection||t.shouldCoalesceRunChangeDetection)&&-1!==t.lastRequestAnimationFrameId)}function Mc(t){t._nesting++,t.isStable&&(t.isStable=!1,t.onUnstable.emit(null))}function Oc(t){t._nesting--,kc(t)}class Pc{constructor(){this.hasPendingMicrotasks=!1,this.hasPendingMacrotasks=!1,this.isStable=!0,this.onUnstable=new Fa,this.onMicrotaskEmpty=new Fa,this.onStable=new Fa,this.onError=new Fa}run(t,e,n){return t.apply(e,n)}runGuarded(t,e,n){return t.apply(e,n)}runOutsideAngular(t){return t()}runTask(t,e,n,r){return t.apply(e,n)}}let Dc=(()=>{class t{constructor(t){this._ngZone=t,this._pendingCount=0,this._isZoneStable=!0,this._didWork=!1,this._callbacks=[],this.taskTrackingZone=null,this._watchAngularEvents(),t.run(()=>{this.taskTrackingZone="undefined"==typeof Zone?null:Zone.current.get("TaskTrackingZone")})}_watchAngularEvents(){this._ngZone.onUnstable.subscribe({next:()=>{this._didWork=!0,this._isZoneStable=!1}}),this._ngZone.runOutsideAngular(()=>{this._ngZone.onStable.subscribe({next:()=>{Sc.assertNotInAngularZone(),Ec(()=>{this._isZoneStable=!0,this._runCallbacksIfReady()})}})})}increasePendingRequestCount(){return this._pendingCount+=1,this._didWork=!0,this._pendingCount}decreasePendingRequestCount(){if(this._pendingCount-=1,this._pendingCount<0)throw new Error("pending async requests below zero");return this._runCallbacksIfReady(),this._pendingCount}isStable(){return this._isZoneStable&&0===this._pendingCount&&!this._ngZone.hasPendingMacrotasks}_runCallbacksIfReady(){if(this.isStable())Ec(()=>{for(;0!==this._callbacks.length;){let t=this._callbacks.pop();clearTimeout(t.timeoutId),t.doneCb(this._didWork)}this._didWork=!1});else{let t=this.getPendingTasks();this._callbacks=this._callbacks.filter(e=>!e.updateCb||!e.updateCb(t)||(clearTimeout(e.timeoutId),!1)),this._didWork=!0}}getPendingTasks(){return this.taskTrackingZone?this.taskTrackingZone.macroTasks.map(t=>({source:t.source,creationLocation:t.creationLocation,data:t.data})):[]}addCallback(t,e,n){let r=-1;e&&e>0&&(r=setTimeout(()=>{this._callbacks=this._callbacks.filter(t=>t.timeoutId!==r),t(this._didWork,this.getPendingTasks())},e)),this._callbacks.push({doneCb:t,timeoutId:r,updateCb:n})}whenStable(t,e,n){if(n&&!this.taskTrackingZone)throw new Error('Task tracking zone is required when passing an update callback to whenStable(). Is "zone.js/dist/task-tracking.js" loaded?');this.addCallback(t,e,n),this._runCallbacksIfReady()}getPendingRequestCount(){return this._pendingCount}findProviders(t,e,n){return[]}}return t.\u0275fac=function(e){return new(e||t)(vn(Sc))},t.\u0275prov=g({token:t,factory:t.\u0275fac}),t})(),Rc=(()=>{class t{constructor(){this._applications=new Map,zc.addToWindow(this)}registerApplication(t,e){this._applications.set(t,e)}unregisterApplication(t){this._applications.delete(t)}unregisterAllApplications(){this._applications.clear()}getTestability(t){return this._applications.get(t)||null}getAllTestabilities(){return Array.from(this._applications.values())}getAllRootElements(){return Array.from(this._applications.keys())}findTestabilityInTree(t,e=!0){return zc.findTestabilityInTree(this,t,e)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=g({token:t,factory:t.\u0275fac}),t})();class Nc{addToWindow(t){}findTestabilityInTree(t,e,n){return null}}function Lc(t){zc=t}let jc,zc=new Nc,Fc=!0,Bc=!1;function Uc(){return Bc=!0,Fc}function Vc(){if(Bc)throw new Error("Cannot enable prod mode after platform setup.");Fc=!1}const qc=new tn("AllowMultipleToken");class Gc{constructor(t,e){this.name=t,this.token=e}}function $c(t,e,n=[]){const r=`Platform: ${e}`,i=new tn(r);return(e=[])=>{let o=Wc();if(!o||o.injector.get(qc,!1))if(t)t(n.concat(e).concat({provide:i,useValue:!0}));else{const t=n.concat(e).concat({provide:i,useValue:!0},{provide:oo,useValue:"platform"});!function(t){if(jc&&!jc.destroyed&&!jc.injector.get(qc,!1))throw new Error("There can be only one platform. Destroy the previous one to create a new one.");jc=t.get(Hc);const e=t.get(uc,null);e&&e.forEach(t=>t())}(bo.create({providers:t,name:r}))}return function(t){const e=Wc();if(!e)throw new Error("No platform exists!");if(!e.injector.get(t,null))throw new Error("A platform with a different configuration has been created. Please destroy it first.");return e}(i)}}function Wc(){return jc&&!jc.destroyed?jc:null}let Hc=(()=>{class t{constructor(t){this._injector=t,this._modules=[],this._destroyListeners=[],this._destroyed=!1}bootstrapModuleFactory(t,e){const n=function(t,e){let n;return n="noop"===t?new Pc:("zone.js"===t?void 0:t)||new Sc({enableLongStackTrace:Uc(),shouldCoalesceEventChangeDetection:!!(null==e?void 0:e.ngZoneEventCoalescing),shouldCoalesceRunChangeDetection:!!(null==e?void 0:e.ngZoneRunCoalescing)}),n}(e?e.ngZone:void 0,{ngZoneEventCoalescing:e&&e.ngZoneEventCoalescing||!1,ngZoneRunCoalescing:e&&e.ngZoneRunCoalescing||!1}),r=[{provide:Sc,useValue:n}];return n.run(()=>{const e=bo.create({providers:r,parent:this.injector,name:t.moduleType.name}),i=t.create(e),o=i.injector.get(vr,null);if(!o)throw new Error("No ErrorHandler. Is platform module (BrowserModule) included?");return n.runOutsideAngular(()=>{const t=n.onError.subscribe({next:t=>{o.handleError(t)}});i.onDestroy(()=>{Xc(this._modules,i),t.unsubscribe()})}),function(t,e,n){try{const r=n();return qo(r)?r.catch(n=>{throw e.runOutsideAngular(()=>t.handleError(n)),n}):r}catch(r){throw e.runOutsideAngular(()=>t.handleError(r)),r}}(o,n,()=>{const t=i.injector.get(sc);return t.runInitializers(),t.donePromise.then(()=>(ws(i.injector.get(fc,bs)||bs),this._moduleDoBootstrap(i),i))})})}bootstrapModule(t,e=[]){const n=Zc({},e);return function(t,e,n){const r=new La(n);return Promise.resolve(r)}(0,0,t).then(t=>this.bootstrapModuleFactory(t,n))}_moduleDoBootstrap(t){const e=t.injector.get(Kc);if(t._bootstrapComponents.length>0)t._bootstrapComponents.forEach(t=>e.bootstrap(t));else{if(!t.instance.ngDoBootstrap)throw new Error(`The module ${u(t.instance.constructor)} was bootstrapped, but it does not declare "@NgModule.bootstrap" components nor a "ngDoBootstrap" method. Please define one of these.`);t.instance.ngDoBootstrap(e)}this._modules.push(t)}onDestroy(t){this._destroyListeners.push(t)}get injector(){return this._injector}destroy(){if(this._destroyed)throw new Error("The platform has already been destroyed!");this._modules.slice().forEach(t=>t.destroy()),this._destroyListeners.forEach(t=>t()),this._destroyed=!0}get destroyed(){return this._destroyed}}return t.\u0275fac=function(e){return new(e||t)(vn(bo))},t.\u0275prov=g({token:t,factory:t.\u0275fac}),t})();function Zc(t,e){return Array.isArray(e)?e.reduce(Zc,t):Object.assign(Object.assign({},t),e)}let Kc=(()=>{class t{constructor(t,e,n,r,i,c){this._zone=t,this._console=e,this._injector=n,this._exceptionHandler=r,this._componentFactoryResolver=i,this._initStatus=c,this._bootstrapListeners=[],this._views=[],this._runningTick=!1,this._stable=!0,this.componentTypes=[],this.components=[],this._onMicrotaskEmptySubscription=this._zone.onMicrotaskEmpty.subscribe({next:()=>{this._zone.run(()=>{this.tick()})}});const l=new o.a(t=>{this._stable=this._zone.isStable&&!this._zone.hasPendingMacrotasks&&!this._zone.hasPendingMicrotasks,this._zone.runOutsideAngular(()=>{t.next(this._stable),t.complete()})}),u=new o.a(t=>{let e;this._zone.runOutsideAngular(()=>{e=this._zone.onStable.subscribe(()=>{Sc.assertNotInAngularZone(),Ec(()=>{this._stable||this._zone.hasPendingMacrotasks||this._zone.hasPendingMicrotasks||(this._stable=!0,t.next(!0))})})});const n=this._zone.onUnstable.subscribe(()=>{Sc.assertInAngularZone(),this._stable&&(this._stable=!1,this._zone.runOutsideAngular(()=>{t.next(!1)}))});return()=>{e.unsubscribe(),n.unsubscribe()}});this.isStable=Object(s.a)(l,u.pipe(Object(a.a)()))}bootstrap(t,e){if(!this._initStatus.done)throw new Error("Cannot bootstrap as there are still asynchronous initializers running. Bootstrap components in the `ngDoBootstrap` method of the root module.");let n;n=t instanceof Os?t:this._componentFactoryResolver.resolveComponentFactory(t),this.componentTypes.push(n.componentType);const r=n.isBoundToModule?void 0:this._injector.get(va),i=n.create(bo.NULL,[],e||n.selector,r),o=i.location.nativeElement,s=i.injector.get(Dc,null),a=s&&i.injector.get(Rc);return s&&a&&a.registerApplication(o,s),i.onDestroy(()=>{this.detachView(i.hostView),Xc(this.components,i),a&&a.unregisterApplication(o)}),this._loadComponent(i),Uc()&&this._console.log("Angular is running in development mode. Call enableProdMode() to enable production mode."),i}tick(){if(this._runningTick)throw new Error("ApplicationRef.tick is called recursively");try{this._runningTick=!0;for(let t of this._views)t.detectChanges()}catch(t){this._zone.runOutsideAngular(()=>this._exceptionHandler.handleError(t))}finally{this._runningTick=!1}}attachView(t){const e=t;this._views.push(e),e.attachToAppRef(this)}detachView(t){const e=t;Xc(this._views,e),e.detachFromAppRef()}_loadComponent(t){this.attachView(t.hostView),this.tick(),this.components.push(t),this._injector.get(dc,[]).concat(this._bootstrapListeners).forEach(e=>e(t))}ngOnDestroy(){this._views.slice().forEach(t=>t.destroy()),this._onMicrotaskEmptySubscription.unsubscribe()}get viewCount(){return this._views.length}}return t.\u0275fac=function(e){return new(e||t)(vn(Sc),vn(pc),vn(bo),vn(vr),vn(Ds),vn(sc))},t.\u0275prov=g({token:t,factory:t.\u0275fac}),t})();function Xc(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}class Yc{}class Qc{}const Jc={factoryPathPrefix:"",factoryPathSuffix:".ngfactory"};let tl=(()=>{class t{constructor(t,e){this._compiler=t,this._config=e||Jc}load(t){return this.loadAndCompile(t)}loadAndCompile(t){let[e,r]=t.split("#");return void 0===r&&(r="default"),n("zn8P")(e).then(t=>t[r]).then(t=>el(t,e,r)).then(t=>this._compiler.compileModuleAsync(t))}loadFactory(t){let[e,r]=t.split("#"),i="NgFactory";return void 0===r&&(r="default",i=""),n("zn8P")(this._config.factoryPathPrefix+e+this._config.factoryPathSuffix).then(t=>t[r+i]).then(t=>el(t,e,r))}}return t.\u0275fac=function(e){return new(e||t)(vn(Tc),vn(Qc,8))},t.\u0275prov=g({token:t,factory:t.\u0275fac}),t})();function el(t,e,n){if(!t)throw new Error(`Cannot find '${n}' in '${e}'`);return t}const nl=function(t){return null},rl=$c(null,"core",[{provide:hc,useValue:"unknown"},{provide:Hc,deps:[bo]},{provide:Rc,deps:[]},{provide:pc,deps:[]}]),il=[{provide:Kc,useClass:Kc,deps:[Sc,pc,bo,vr,Ds,sc]},{provide:Oa,deps:[Sc],useFactory:function(t){let e=[];return t.onStable.subscribe(()=>{for(;e.length;)e.pop()()}),function(t){e.push(t)}}},{provide:sc,useClass:sc,deps:[[new Tn,oc]]},{provide:Tc,useClass:Tc,deps:[]},cc,{provide:na,useFactory:function(){return da},deps:[]},{provide:ia,useFactory:function(){return pa},deps:[]},{provide:fc,useFactory:function(t){return ws(t=t||"undefined"!=typeof $localize&&$localize.locale||bs),t},deps:[[new wn(fc),new Tn,new Cn]]},{provide:mc,useValue:"USD"}];let ol=(()=>{class t{constructor(t){}}return t.\u0275mod=Y({type:t}),t.\u0275inj=_({factory:function(e){return new(e||t)(vn(Kc))},providers:il}),t})()},gRHU:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n("2fFW"),i=n("NJ4a");const o={closed:!0,next(t){},error(t){if(r.a.useDeprecatedSynchronousErrorHandling)throw t;Object(i.a)(t)},complete(){}}},jZKg:function(t,e,n){"use strict";n.d(e,"a",function(){return o});var r=n("HDdC"),i=n("quSY");function o(t,e){return new r.a(n=>{const r=new i.a;let o=0;return r.add(e.schedule(function(){o!==t.length?(n.next(t[o++]),n.closed||r.add(this.schedule())):n.complete()})),r})}},kJWO:function(t,e,n){"use strict";n.d(e,"a",function(){return r});const r=(()=>"function"==typeof Symbol&&Symbol.observable||"@@observable")()},lJxs:function(t,e,n){"use strict";n.d(e,"a",function(){return i});var r=n("7o/Q");function i(t,e){return function(n){if("function"!=typeof t)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return n.lift(new o(t,e))}}class o{constructor(t,e){this.project=t,this.thisArg=e}call(t,e){return e.subscribe(new s(t,this.project,this.thisArg))}}class s extends r.a{constructor(t,e,n){super(t),this.project=e,this.count=0,this.thisArg=n||this}_next(t){let e;try{e=this.project.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}},mrSG:function(t,e,n){"use strict";n.d(e,"c",function(){return i}),n.d(e,"a",function(){return o}),n.d(e,"b",function(){return s}),n.d(e,"d",function(){return a}),n.d(e,"g",function(){return c}),n.d(e,"e",function(){return l}),n.d(e,"f",function(){return u});var r=function(t,e){return(r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function i(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}r(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var o=function(){return(o=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function s(t,e,n,r){return new(n||(n=Promise))(function(i,o){function s(t){try{c(r.next(t))}catch(e){o(e)}}function a(t){try{c(r.throw(t))}catch(e){o(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n(function(t){t(e)})).then(s,a)}c((r=r.apply(t,e||[])).next())})}function a(t,e){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=e.call(t,s)}catch(a){o=[6,a],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function c(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function l(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,i,o=n.call(t),s=[];try{for(;(void 0===e||e-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(a){i={error:a}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function u(t,e,n){if(n||2===arguments.length)for(var r,i=0,o=e.length;i<o;i++)!r&&i in e||(r||(r=Array.prototype.slice.call(e,0,i)),r[i]=e[i]);return t.concat(r||Array.prototype.slice.call(e))}},n6bG:function(t,e,n){"use strict";function r(t){return"function"==typeof t}n.d(e,"a",function(){return r})},ngJS:function(t,e,n){"use strict";n.d(e,"a",function(){return r});const r=t=>e=>{for(let n=0,r=t.length;n<r&&!e.closed;n++)e.next(t[n]);e.complete()}},pxpQ:function(t,e,n){"use strict";n.d(e,"b",function(){return c}),n.d(e,"a",function(){return u});var r=n("7o/Q"),i=n("EY2u"),o=n("LRne"),s=n("HDdC");let a=(()=>{class t{constructor(t,e,n){this.kind=t,this.value=e,this.error=n,this.hasValue="N"===t}observe(t){switch(this.kind){case"N":return t.next&&t.next(this.value);case"E":return t.error&&t.error(this.error);case"C":return t.complete&&t.complete()}}do(t,e,n){switch(this.kind){case"N":return t&&t(this.value);case"E":return e&&e(this.error);case"C":return n&&n()}}accept(t,e,n){return t&&"function"==typeof t.next?this.observe(t):this.do(t,e,n)}toObservable(){switch(this.kind){case"N":return Object(o.a)(this.value);case"E":return t=this.error,new s.a(e=>e.error(t));case"C":return Object(i.b)()}var t;throw new Error("unexpected notification kind value")}static createNext(e){return void 0!==e?new t("N",e):t.undefinedValueNotification}static createError(e){return new t("E",void 0,e)}static createComplete(){return t.completeNotification}}return t.completeNotification=new t("C"),t.undefinedValueNotification=new t("N",void 0),t})();function c(t,e=0){return function(n){return n.lift(new l(t,e))}}class l{constructor(t,e=0){this.scheduler=t,this.delay=e}call(t,e){return e.subscribe(new u(t,this.scheduler,this.delay))}}class u extends r.a{constructor(t,e,n=0){super(t),this.scheduler=e,this.delay=n}static dispatch(t){const{notification:e,destination:n}=t;e.observe(n),this.unsubscribe()}scheduleMessage(t){this.destination.add(this.scheduler.schedule(u.dispatch,this.delay,new h(t,this.destination)))}_next(t){this.scheduleMessage(a.createNext(t))}_error(t){this.scheduleMessage(a.createError(t)),this.unsubscribe()}_complete(){this.scheduleMessage(a.createComplete()),this.unsubscribe()}}class h{constructor(t,e){this.notification=t,this.destination=e}}},"q/0M":function(t,e,n){"use strict";function r(){for(var t=0,e=0,n=arguments.length;e<n;e++)t+=arguments[e].length;var r=Array(t),i=0;for(e=0;e<n;e++)for(var o=arguments[e],s=0,a=o.length;s<a;s++,i++)r[i]=o[s];return r}var i;n.d(e,"a",function(){return s}),n.d(e,"b",function(){return h}),n.d(e,"c",function(){return d}),n.d(e,"d",function(){return p});var o=[],s=function(t){return t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT",t}({}),a={debug:s.DEBUG,verbose:s.VERBOSE,info:s.INFO,warn:s.WARN,error:s.ERROR,silent:s.SILENT},c=s.INFO,l=((i={})[s.DEBUG]="log",i[s.VERBOSE]="log",i[s.INFO]="info",i[s.WARN]="warn",i[s.ERROR]="error",i),u=function(t,e){for(var n=[],i=2;i<arguments.length;i++)n[i-2]=arguments[i];if(!(e<t.logLevel)){var o=(new Date).toISOString(),s=l[e];if(!s)throw new Error("Attempted to log a message with an invalid logType (value: "+e+")");console[s].apply(console,r(["["+o+"]  "+t.name+":"],n))}},h=function(){function t(t){this.name=t,this._logLevel=c,this._logHandler=u,this._userLogHandler=null,o.push(this)}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in s))throw new TypeError('Invalid value "'+t+'" assigned to `logLevel`');this._logLevel=t},enumerable:!1,configurable:!0}),t.prototype.setLogLevel=function(t){this._logLevel="string"==typeof t?a[t]:t},Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"userLogHandler",{get:function(){return this._userLogHandler},set:function(t){this._userLogHandler=t},enumerable:!1,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,s.DEBUG],t)),this._logHandler.apply(this,r([this,s.DEBUG],t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,s.VERBOSE],t)),this._logHandler.apply(this,r([this,s.VERBOSE],t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,s.INFO],t)),this._logHandler.apply(this,r([this,s.INFO],t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,s.WARN],t)),this._logHandler.apply(this,r([this,s.WARN],t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._userLogHandler&&this._userLogHandler.apply(this,r([this,s.ERROR],t)),this._logHandler.apply(this,r([this,s.ERROR],t))},t}();function d(t){o.forEach(function(e){e.setLogLevel(t)})}function p(t,e){for(var n=function(n){var r=null;e&&e.level&&(r=a[e.level]),n.userLogHandler=null===t?null:function(e,n){for(var i=[],o=2;o<arguments.length;o++)i[o-2]=arguments[o];var a=i.map(function(t){if(null==t)return null;if("string"==typeof t)return t;if("number"==typeof t||"boolean"==typeof t)return t.toString();if(t instanceof Error)return t.message;try{return JSON.stringify(t)}catch(e){return null}}).filter(function(t){return t}).join(" ");n>=(null!=r?r:e.logLevel)&&t({level:s[n].toLowerCase(),message:a,args:i,type:e.name})}},r=0,i=o;r<i.length;r++)n(i[r])}},qOnz:function(t,e,n){"use strict";n.d(e,"a",function(){return p}),n.d(e,"b",function(){return I}),n.d(e,"c",function(){return S}),n.d(e,"d",function(){return B}),n.d(e,"e",function(){return i}),n.d(e,"f",function(){return o}),n.d(e,"g",function(){return a}),n.d(e,"h",function(){return c}),n.d(e,"i",function(){return N}),n.d(e,"j",function(){return f}),n.d(e,"k",function(){return U}),n.d(e,"l",function(){return h}),n.d(e,"m",function(){return d}),n.d(e,"n",function(){return $}),n.d(e,"o",function(){return X}),n.d(e,"p",function(){return m}),n.d(e,"q",function(){return R}),n.d(e,"r",function(){return y}),n.d(e,"s",function(){return v}),n.d(e,"t",function(){return x}),n.d(e,"u",function(){return j}),n.d(e,"v",function(){return w}),n.d(e,"w",function(){return g}),n.d(e,"x",function(){return _}),n.d(e,"y",function(){return C}),n.d(e,"z",function(){return b}),n.d(e,"A",function(){return E}),n.d(e,"B",function(){return T}),n.d(e,"C",function(){return D}),n.d(e,"D",function(){return M}),n.d(e,"E",function(){return z}),n.d(e,"F",function(){return F}),n.d(e,"G",function(){return L}),n.d(e,"H",function(){return K}),n.d(e,"I",function(){return Z}),n.d(e,"J",function(){return O}),n.d(e,"K",function(){return G}),n.d(e,"L",function(){return W}),n.d(e,"M",function(){return H});var r=n("mrSG"),i=function(t,e){if(!t)throw o(e)},o=function(t){return new Error("Firebase Database (${JSCORE_VERSION}) INTERNAL ASSERT FAILED: "+t)},s=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},a={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray:function(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();for(var n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[],i=0;i<t.length;i+=3){var o=t[i],s=i+1<t.length,a=s?t[i+1]:0,c=i+2<t.length,l=c?t[i+2]:0,u=(15&a)<<2|l>>6,h=63&l;c||(h=64,s||(u=64)),r.push(n[o>>2],n[(3&o)<<4|a>>4],n[u],n[h])}return r.join("")},encodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString:function(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){for(var e=[],n=0,r=0;n<t.length;){var i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){var o=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&o)}else if(i>239&&i<365){var s=((7&i)<<18|(63&(o=t[n++]))<<12|(63&(a=t[n++]))<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{o=t[n++];var a=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&o)<<6|63&a)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray:function(t,e){this.init_();for(var n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[],i=0;i<t.length;){var o=n[t.charAt(i++)],s=i<t.length?n[t.charAt(i)]:0,a=++i<t.length?n[t.charAt(i)]:64,c=++i<t.length?n[t.charAt(i)]:64;if(++i,null==o||null==s||null==a||null==c)throw Error();r.push(o<<2|s>>4),64!==a&&(r.push(s<<4&240|a>>2),64!==c&&r.push(a<<6&192|c))}return r},init_:function(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(var t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}},c=function(t){var e=s(t);return a.encodeByteArray(e,!0)},l=function(t){return c(t).replace(/\./g,"")},u=function(t){try{return a.decodeString(t,!0)}catch(e){console.error("base64Decode failed: ",e)}return null};function h(t){return d(void 0,t)}function d(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&"__proto__"!==n&&(t[n]=d(t[n],e[n]));return t}var p=function(){function t(){var t=this;this.reject=function(){},this.resolve=function(){},this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}return t.prototype.wrapCallback=function(t){var e=this;return function(n,r){n?e.reject(n):e.resolve(r),"function"==typeof t&&(e.promise.catch(function(){}),1===t.length?t(n):t(n,r))}},t}();function f(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');var n=e||"demo-project",i=t.iat||0,o=t.sub||t.user_id;if(!o)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");var s=Object(r.a)({iss:"https://securetoken.google.com/"+n,aud:n,iat:i,exp:i+3600,auth_time:i,sub:o,user_id:o,firebase:{sign_in_provider:"custom",identities:{}}},t);return[l(JSON.stringify({alg:"none",type:"JWT"})),l(JSON.stringify(s)),""].join(".")}function m(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function g(){return"undefined"!=typeof window&&!!(window.cordova||window.phonegap||window.PhoneGap)&&/ios|iphone|ipod|ipad|android|blackberry|iemobile/i.test(m())}function _(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}function y(){return"object"==typeof self&&self.self===self}function v(){var t="object"==typeof chrome?chrome.runtime:"object"==typeof browser?browser.runtime:void 0;return"object"==typeof t&&void 0!==t.id}function b(){return"object"==typeof navigator&&"ReactNative"===navigator.product}function x(){return m().indexOf("Electron/")>=0}function w(){var t=m();return t.indexOf("MSIE ")>=0||t.indexOf("Trident/")>=0}function T(){return m().indexOf("MSAppHost/")>=0}function C(){return!1}function E(){return!_()&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}var S=function(t){function e(n,r,i){var o=t.call(this,r)||this;return o.code=n,o.customData=i,o.name="FirebaseError",Object.setPrototypeOf(o,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(o,I.prototype.create),o}return Object(r.c)(e,t),e}(Error),I=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],s=o?k(o,r):"Error",a=this.serviceName+": "+s+" ("+i+").",c=new S(i,a,r);return c},t}();function k(t,e){return t.replace(A,function(t,n){var r=e[n];return null!=r?String(r):"<"+n+"?>"})}var A=/\{\$([^}]+)}/g;function M(t){return JSON.parse(t)}function O(t){return JSON.stringify(t)}var P=function(t){var e={},n={},r={},i="";try{var o=t.split(".");e=M(u(o[0])||""),n=M(u(o[1])||""),i=o[2],r=n.d||{},delete n.d}catch(s){}return{header:e,claims:n,data:r,signature:i}},D=function(t){var e=P(t).claims;return!!e&&"object"==typeof e&&e.hasOwnProperty("iat")},R=function(t){var e=P(t).claims;return"object"==typeof e&&!0===e.admin};function N(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function L(t,e){return Object.prototype.hasOwnProperty.call(t,e)?t[e]:void 0}function j(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function z(t,e,n){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&(r[i]=e.call(n,t[i],i,t));return r}function F(t){for(var e=[],n=function(t,n){Array.isArray(n)?n.forEach(function(n){e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))}):e.push(encodeURIComponent(t)+"="+encodeURIComponent(n))},r=0,i=Object.entries(t);r<i.length;r++){var o=i[r];n(o[0],o[1])}return e.length?"&"+e.join("&"):""}var B=function(){function t(){this.chain_=[],this.buf_=[],this.W_=[],this.pad_=[],this.inbuf_=0,this.total_=0,this.blockSize=64,this.pad_[0]=128;for(var t=1;t<this.blockSize;++t)this.pad_[t]=0;this.reset()}return t.prototype.reset=function(){this.chain_[0]=1732584193,this.chain_[1]=4023233417,this.chain_[2]=2562383102,this.chain_[3]=271733878,this.chain_[4]=3285377520,this.inbuf_=0,this.total_=0},t.prototype.compress_=function(t,e){e||(e=0);var n=this.W_;if("string"==typeof t)for(var r=0;r<16;r++)n[r]=t.charCodeAt(e)<<24|t.charCodeAt(e+1)<<16|t.charCodeAt(e+2)<<8|t.charCodeAt(e+3),e+=4;else for(r=0;r<16;r++)n[r]=t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3],e+=4;for(r=16;r<80;r++)n[r]=4294967295&((h=n[r-3]^n[r-8]^n[r-14]^n[r-16])<<1|h>>>31);var i,o,s=this.chain_[0],a=this.chain_[1],c=this.chain_[2],l=this.chain_[3],u=this.chain_[4];for(r=0;r<80;r++){r<40?r<20?(i=l^a&(c^l),o=1518500249):(i=a^c^l,o=1859775393):r<60?(i=a&c|l&(a|c),o=2400959708):(i=a^c^l,o=3395469782);var h=(s<<5|s>>>27)+i+u+o+n[r]&4294967295;u=l,l=c,c=4294967295&(a<<30|a>>>2),a=s,s=h}this.chain_[0]=this.chain_[0]+s&4294967295,this.chain_[1]=this.chain_[1]+a&4294967295,this.chain_[2]=this.chain_[2]+c&4294967295,this.chain_[3]=this.chain_[3]+l&4294967295,this.chain_[4]=this.chain_[4]+u&4294967295},t.prototype.update=function(t,e){if(null!=t){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=0,i=this.buf_,o=this.inbuf_;r<e;){if(0===o)for(;r<=n;)this.compress_(t,r),r+=this.blockSize;if("string"==typeof t){for(;r<e;)if(i[o]=t.charCodeAt(r),++r,++o===this.blockSize){this.compress_(i),o=0;break}}else for(;r<e;)if(i[o]=t[r],++r,++o===this.blockSize){this.compress_(i),o=0;break}}this.inbuf_=o,this.total_+=e}},t.prototype.digest=function(){var t=[],e=8*this.total_;this.update(this.pad_,this.inbuf_<56?56-this.inbuf_:this.blockSize-(this.inbuf_-56));for(var n=this.blockSize-1;n>=56;n--)this.buf_[n]=255&e,e/=256;this.compress_(this.buf_);var r=0;for(n=0;n<5;n++)for(var i=24;i>=0;i-=8)t[r]=this.chain_[n]>>i&255,++r;return t},t}();function U(t,e){var n=new V(t,e);return n.subscribe.bind(n)}var V=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=["next","error","complete"];n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t)?t:{next:t,error:e,complete:n}).next&&(r.next=q),void 0===r.error&&(r.error=q),void 0===r.complete&&(r.complete=q);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(r){"undefined"!=typeof console&&console.error&&console.error(r)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function q(){}var G=function(t,e,n,r){var i;if(r<e?i="at least "+e:r>n&&(i=0===n?"none":"no more than "+n),i)throw new Error(t+" failed: Was called with "+r+(1===r?" argument.":" arguments.")+" Expects "+i+".")};function $(t,e){return t+" failed: "+e+" argument "}function W(t,e,n,r){if((!r||n)&&"function"!=typeof n)throw new Error($(t,e)+"must be a valid function.")}function H(t,e,n,r){if((!r||n)&&("object"!=typeof n||null===n))throw new Error($(t,e)+"must be a valid context object.")}var Z=function(t){for(var e=[],n=0,r=0;r<t.length;r++){var o=t.charCodeAt(r);if(o>=55296&&o<=56319){var s=o-55296;r++,i(r<t.length,"Surrogate pair missing trail surrogate."),o=65536+(s<<10)+(t.charCodeAt(r)-56320)}o<128?e[n++]=o:o<2048?(e[n++]=o>>6|192,e[n++]=63&o|128):o<65536?(e[n++]=o>>12|224,e[n++]=o>>6&63|128,e[n++]=63&o|128):(e[n++]=o>>18|240,e[n++]=o>>12&63|128,e[n++]=o>>6&63|128,e[n++]=63&o|128)}return e},K=function(t){for(var e=0,n=0;n<t.length;n++){var r=t.charCodeAt(n);r<128?e++:r<2048?e+=2:r>=55296&&r<=56319?(e+=4,n++):e+=3}return e};function X(t){return t&&t._delegate?t._delegate:t}},qgXg:function(t,e,n){"use strict";n.d(e,"b",function(){return a}),n.d(e,"a",function(){return c});var r=n("3N8a");class i extends r.a{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}schedule(t,e=0){return e>0?super.schedule(t,e):(this.delay=e,this.state=t,this.scheduler.flush(this),this)}execute(t,e){return e>0||this.closed?super.execute(t,e):this._execute(t,e)}requestAsyncId(t,e,n=0){return null!==n&&n>0||null===n&&this.delay>0?super.requestAsyncId(t,e,n):t.flush(this)}}var o=n("IjjT");class s extends o.a{}const a=new s(i),c=a},quSY:function(t,e,n){"use strict";n.d(e,"a",function(){return a});var r=n("DH7j"),i=n("XoHu"),o=n("n6bG");const s=(()=>{function t(t){return Error.call(this),this.message=t?`${t.length} errors occurred during unsubscription:\n${t.map((t,e)=>`${e+1}) ${t.toString()}`).join("\n  ")}`:"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t})();let a=(()=>{class t{constructor(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._ctorUnsubscribe=!0,this._unsubscribe=t)}unsubscribe(){let e;if(this.closed)return;let{_parentOrParents:n,_ctorUnsubscribe:a,_unsubscribe:l,_subscriptions:u}=this;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,n instanceof t)n.remove(this);else if(null!==n)for(let t=0;t<n.length;++t)n[t].remove(this);if(Object(o.a)(l)){a&&(this._unsubscribe=void 0);try{l.call(this)}catch(h){e=h instanceof s?c(h.errors):[h]}}if(Object(r.a)(u)){let t=-1,n=u.length;for(;++t<n;){const n=u[t];if(Object(i.a)(n))try{n.unsubscribe()}catch(h){e=e||[],h instanceof s?e=e.concat(c(h.errors)):e.push(h)}}}if(e)throw new s(e)}add(e){let n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){const e=n;n=new t,n._subscriptions=[e]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}let{_parentOrParents:r}=n;if(null===r)n._parentOrParents=this;else if(r instanceof t){if(r===this)return n;n._parentOrParents=[r,this]}else{if(-1!==r.indexOf(this))return n;r.push(this)}const i=this._subscriptions;return null===i?this._subscriptions=[n]:i.push(n),n}remove(t){const e=this._subscriptions;if(e){const n=e.indexOf(t);-1!==n&&e.splice(n,1)}}}var e;return t.EMPTY=((e=new t).closed=!0,e),t})();function c(t){return t.reduce((t,e)=>t.concat(e instanceof s?e.errors:e),[])}},spgP:function(t,e,n){"use strict";(function(t){n.d(e,"a",function(){return S}),n.d(e,"b",function(){return v}),n.d(e,"c",function(){return y}),n.d(e,"d",function(){return p}),n.d(e,"e",function(){return _}),n.d(e,"f",function(){return C}),n.d(e,"g",function(){return x}),n.d(e,"h",function(){return f}),n.d(e,"i",function(){return g}),n.d(e,"j",function(){return w});var r=n("qgXg"),i=n("D0XW"),o=n("vkgz"),s=n("tf+s"),a=n("pxpQ"),c=n("fXoL"),l=n("Jgta");function u(){}class h{constructor(t,e=r.b){this.zone=t,this.delegate=e}now(){return this.delegate.now()}schedule(t,e,n){const r=this.zone;return this.delegate.schedule(function(e){r.runGuarded(()=>{t.apply(this,[e])})},e,n)}}class d{constructor(t){this.zone=t,this.task=null}call(t,e){const n=this.unscheduleTask.bind(this);return this.task=this.zone.run(()=>Zone.current.scheduleMacroTask("firebaseZoneBlock",u,{},u,u)),e.pipe(Object(o.a)({next:n,complete:n,error:n})).subscribe(t).add(n)}unscheduleTask(){setTimeout(()=>{null!=this.task&&"scheduled"===this.task.state&&(this.task.invoke(),this.task=null)},10)}}class p{constructor(t){this.ngZone=t,this.outsideAngular=t.runOutsideAngular(()=>new h(Zone.current)),this.insideAngular=t.run(()=>new h(Zone.current,i.b))}}function f(t){return function(e){return(e=e.lift(new d(t.ngZone))).pipe(Object(s.a)(t.outsideAngular),Object(a.b)(t.insideAngular))}}const m=["ngOnDestroy"],g=(t,e,n,r={})=>new Proxy(t,{get:(i,o)=>n.runOutsideAngular(()=>{var i;if(t[o])return(null===(i=null==r?void 0:r.spy)||void 0===i?void 0:i.get)&&r.spy.get(o,t[o]),t[o];if(m.indexOf(o)>-1)return()=>{};const s=e.toPromise().then(t=>{const e=t&&t[o];return"function"==typeof e?e.bind(t):e&&e.then?e.then(t=>n.run(()=>t)):n.run(()=>e)});return new Proxy(()=>{},{get:(t,e)=>s[e],apply:(t,e,n)=>s.then(t=>{var e;const i=t&&t(...n);return(null===(e=null==r?void 0:r.spy)||void 0===e?void 0:e.apply)&&r.spy.apply(o,n,i),i})})})}),_=(t,e)=>{e.forEach(e=>{Object.getOwnPropertyNames(e.prototype||e).forEach(n=>{Object.defineProperty(t.prototype,n,Object.getOwnPropertyDescriptor(e.prototype||e,n))})})},y=new c.r("angularfire2.app.options"),v=new c.r("angularfire2.app.nameOrConfig"),b=new c.P("6.1.5");function x(e,n,r){const i="object"==typeof r&&r||{};i.name=i.name||"string"==typeof r&&r||"[DEFAULT]";const o=l.a.apps.filter(t=>t&&t.name===i.name)[0]||n.runOutsideAngular(()=>l.a.initializeApp(e,i));try{JSON.stringify(e)!==JSON.stringify(o.options)&&T("error",`${o.name} Firebase App already initialized with different options${t.hot?", you may need to reload as Firebase is not HMR aware.":"."}`)}catch(s){}return o}const w=()=>{T("warn","You may need to import 'firebase/auth' manually in your component rather than rely on AngularFireAuth's dynamic import, when using the emulator suite https://github.com/angular/angularfire/issues/2656")},T=(t,...e)=>{Object(c.V)()&&"undefined"!=typeof console&&console[t](...e)};function C(e,n,r,i,o){const[s,...a]=globalThis.\u0275AngularfireInstanceCache.get(e)||[];if(s){try{o.some((t,e)=>{const n=a[e];return t&&"object"==typeof t?JSON.stringify(t)!==JSON.stringify(n):t!==n})&&T("error",`${n} was already initialized on the ${r.name} Firebase App instance with different settings.${t.hot?" You may need to reload as Firebase is not HMR aware.":""}`)}catch(c){}return s}{const t=i();return globalThis.\u0275AngularfireInstanceCache.set(e,[t,...o]),t}}globalThis.\u0275AngularfireInstanceCache||(globalThis.\u0275AngularfireInstanceCache=new Map);const E={provide:class{},useFactory:x,deps:[y,c.A,[new c.B,v]]};let S=(()=>{class t{constructor(t){l.a.registerVersion("angularfire",b.full,t.toString()),l.a.registerVersion("angular",c.O.full)}static initializeApp(e,n){return{ngModule:t,providers:[{provide:y,useValue:e},{provide:v,useValue:n}]}}}return t.\u0275mod=c.Ib({type:t}),t.\u0275inj=c.Hb({factory:function(e){return new(e||t)(c.Rb(c.C))},providers:[E]}),t})()}).call(this,n("3UD+")(t))},"tf+s":function(t,e,n){"use strict";n.d(e,"a",function(){return g});var r=n("HDdC");let i=1;const o=(()=>Promise.resolve())(),s={};function a(t){return t in s&&(delete s[t],!0)}const c={setImmediate(t){const e=i++;return s[e]=!0,o.then(()=>a(e)&&t()),e},clearImmediate(t){a(t)}};var l=n("3N8a");class u extends l.a{constructor(t,e){super(t,e),this.scheduler=t,this.work=e}requestAsyncId(t,e,n=0){return null!==n&&n>0?super.requestAsyncId(t,e,n):(t.actions.push(this),t.scheduled||(t.scheduled=c.setImmediate(t.flush.bind(t,null))))}recycleAsyncId(t,e,n=0){if(null!==n&&n>0||null===n&&this.delay>0)return super.recycleAsyncId(t,e,n);0===t.actions.length&&(c.clearImmediate(e),t.scheduled=void 0)}}var h=n("IjjT");class d extends h.a{flush(t){this.active=!0,this.scheduled=void 0;const{actions:e}=this;let n,r=-1,i=e.length;t=t||e.shift();do{if(n=t.execute(t.state,t.delay))break}while(++r<i&&(t=e.shift()));if(this.active=!1,n){for(;++r<i&&(t=e.shift());)t.unsubscribe();throw n}}}const p=new d(u);var f=n("DH7j");class m extends r.a{constructor(t,e=0,n=p){var r;super(),this.source=t,this.delayTime=e,this.scheduler=n,r=e,(Object(f.a)(r)||!(r-parseFloat(r)+1>=0)||e<0)&&(this.delayTime=0),n&&"function"==typeof n.schedule||(this.scheduler=p)}static create(t,e=0,n=p){return new m(t,e,n)}static dispatch(t){const{source:e,subscriber:n}=t;return this.add(e.subscribe(n))}_subscribe(t){return this.scheduler.schedule(m.dispatch,this.delayTime,{source:this.source,subscriber:t})}}function g(t,e=0){return function(n){return n.lift(new _(t,e))}}class _{constructor(t,e){this.scheduler=t,this.delay=e}call(t,e){return new m(e,this.delay,this.scheduler).subscribe(t)}}},vkgz:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var r=n("7o/Q");function i(){}var o=n("n6bG");function s(t,e,n){return function(r){return r.lift(new a(t,e,n))}}class a{constructor(t,e,n){this.nextOrObserver=t,this.error=e,this.complete=n}call(t,e){return e.subscribe(new c(t,this.nextOrObserver,this.error,this.complete))}}class c extends r.a{constructor(t,e,n,r){super(t),this._tapNext=i,this._tapError=i,this._tapComplete=i,this._tapError=n||i,this._tapComplete=r||i,Object(o.a)(e)?(this._context=this,this._tapNext=e):e&&(this._context=e,this._tapNext=e.next||i,this._tapError=e.error||i,this._tapComplete=e.complete||i)}_next(t){try{this._tapNext.call(this._context,t)}catch(e){return void this.destination.error(e)}this.destination.next(t)}_error(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)}_complete(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()}}},w1tV:function(t,e,n){"use strict";n.d(e,"a",function(){return f});var r=n("XNiG"),i=n("HDdC"),o=n("7o/Q"),s=n("quSY");function a(){return function(t){return t.lift(new c(t))}}class c{constructor(t){this.connectable=t}call(t,e){const{connectable:n}=this;n._refCount++;const r=new l(t,n),i=e.subscribe(r);return r.closed||(r.connection=n.connect()),i}}class l extends o.a{constructor(t,e){super(t),this.connectable=e}_unsubscribe(){const{connectable:t}=this;if(!t)return void(this.connection=null);this.connectable=null;const e=t._refCount;if(e<=0)return void(this.connection=null);if(t._refCount=e-1,e>1)return void(this.connection=null);const{connection:n}=this,r=t._connection;this.connection=null,!r||n&&r!==n||r.unsubscribe()}}class u extends i.a{constructor(t,e){super(),this.source=t,this.subjectFactory=e,this._refCount=0,this._isComplete=!1}_subscribe(t){return this.getSubject().subscribe(t)}getSubject(){const t=this._subject;return t&&!t.isStopped||(this._subject=this.subjectFactory()),this._subject}connect(){let t=this._connection;return t||(this._isComplete=!1,t=this._connection=new s.a,t.add(this.source.subscribe(new d(this.getSubject(),this))),t.closed&&(this._connection=null,t=s.a.EMPTY)),t}refCount(){return a()(this)}}const h=(()=>{const t=u.prototype;return{operator:{value:null},_refCount:{value:0,writable:!0},_subject:{value:null,writable:!0},_connection:{value:null,writable:!0},_subscribe:{value:t._subscribe},_isComplete:{value:t._isComplete,writable:!0},getSubject:{value:t.getSubject},connect:{value:t.connect},refCount:{value:t.refCount}}})();class d extends r.b{constructor(t,e){super(t),this.connectable=e}_error(t){this._unsubscribe(),super._error(t)}_complete(){this.connectable._isComplete=!0,this._unsubscribe(),super._complete()}_unsubscribe(){const t=this.connectable;if(t){this.connectable=null;const e=t._connection;t._refCount=0,t._subject=null,t._connection=null,e&&e.unsubscribe()}}}function p(){return new r.a}function f(){return t=>{return a()((e=p,function(t){let n;n="function"==typeof e?e:function(){return e};const r=Object.create(t,h);return r.source=t,r.subjectFactory=n,r})(t));var e}}},yCtX:function(t,e,n){"use strict";n.d(e,"a",function(){return s});var r=n("HDdC"),i=n("ngJS"),o=n("jZKg");function s(t,e){return e?Object(o.a)(t,e):new r.a(Object(i.a)(t))}},"z+Ro":function(t,e,n){"use strict";function r(t){return t&&"function"==typeof t.schedule}n.d(e,"a",function(){return r})},zIRd:function(t,e,n){"use strict";var r,i,o=n("mrSG"),s=n("qOnz"),a=n("/6Yf"),c=n("q/0M"),l=((r={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",r["bad-app-name"]="Illegal App name: '{$appName}",r["duplicate-app"]="Firebase App named '{$appName}' already exists",r["app-deleted"]="Firebase App named '{$appName}' already deleted",r["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",r["invalid-log-argument"]="First argument to `onLog` must be null or a function.",r),u=new s.b("app","Firebase",l),h="@firebase/app",d="[DEFAULT]",p=((i={})[h]="fire-core",i["@firebase/analytics"]="fire-analytics",i["@firebase/app-check"]="fire-app-check",i["@firebase/auth"]="fire-auth",i["@firebase/database"]="fire-rtdb",i["@firebase/functions"]="fire-fn",i["@firebase/installations"]="fire-iid",i["@firebase/messaging"]="fire-fcm",i["@firebase/performance"]="fire-perf",i["@firebase/remote-config"]="fire-rc",i["@firebase/storage"]="fire-gcs",i["@firebase/firestore"]="fire-fst",i["fire-js"]="fire-js",i["firebase-wrapper"]="fire-js-all",i),f=new c.b("@firebase/app"),m=function(){function t(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Object(s.l)(t),this.container=new a.b(e.name),this._addComponent(new a.a("app",function(){return r},"PUBLIC")),this.firebase_.INTERNAL.components.forEach(function(t){return r._addComponent(t)})}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!1,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){return t.firebase_.INTERNAL.removeApp(t.name_),Promise.all(t.container.getProviders().map(function(t){return t.delete()}))}).then(function(){t.isDeleted_=!0})},t.prototype._getService=function(t,e){var n;void 0===e&&(e=d),this.checkDestroyed_();var r=this.container.getProvider(t);return r.isInitialized()||"EXPLICIT"!==(null===(n=r.getComponent())||void 0===n?void 0:n.instantiationMode)||r.initialize(),r.getImmediate({identifier:e})},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=d),this.container.getProvider(t).clearInstance(e)},t.prototype._addComponent=function(t){try{this.container.addComponent(t)}catch(e){f.debug("Component "+t.name+" failed to register with FirebaseApp "+this.name,e)}},t.prototype._addOrOverwriteComponent=function(t){this.container.addOrOverwriteComponent(t)},t.prototype.toJSON=function(){return{name:this.name,automaticDataCollectionEnabled:this.automaticDataCollectionEnabled,options:this.options}},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw u.create("app-deleted",{appName:this.name_})},t}();m.prototype.name&&m.prototype.options||m.prototype.delete||console.log("dc");var g=function t(){var e=function(t){var e={},n=new Map,r={__esModule:!0,initializeApp:function(n,i){void 0===i&&(i={}),"object"==typeof i&&null!==i||(i={name:i});var o=i;void 0===o.name&&(o.name=d);var a=o.name;if("string"!=typeof a||!a)throw u.create("bad-app-name",{appName:String(a)});if(Object(s.i)(e,a))throw u.create("duplicate-app",{appName:a});var c=new t(n,o,r);return e[a]=c,c},app:i,registerVersion:function(t,e,n){var r,i=null!==(r=p[t])&&void 0!==r?r:t;n&&(i+="-"+n);var s=i.match(/\s|\//),c=e.match(/\s|\//);if(s||c){var l=['Unable to register library "'+i+'" with version "'+e+'":'];return s&&l.push('library name "'+i+'" contains illegal characters (whitespace or "/")'),s&&c&&l.push("and"),c&&l.push('version name "'+e+'" contains illegal characters (whitespace or "/")'),void f.warn(l.join(" "))}o(new a.a(i+"-version",function(){return{library:i,version:e}},"VERSION"))},setLogLevel:c.c,onLog:function(t,e){if(null!==t&&"function"!=typeof t)throw u.create("invalid-log-argument");Object(c.d)(t,e)},apps:null,SDK_VERSION:"8.10.0",INTERNAL:{registerComponent:o,removeApp:function(t){delete e[t]},components:n,useAsService:function(t,e){return"serverAuth"===e?null:e}}};function i(t){if(t=t||d,!Object(s.i)(e,t))throw u.create("no-app",{appName:t});return e[t]}function o(o){var a=o.name;if(n.has(a))return f.debug("There were multiple attempts to register component "+a+"."),"PUBLIC"===o.type?r[a]:null;if(n.set(a,o),"PUBLIC"===o.type){var c=function(t){if(void 0===t&&(t=i()),"function"!=typeof t[a])throw u.create("invalid-app-argument",{appName:a});return t[a]()};void 0!==o.serviceProps&&Object(s.m)(c,o.serviceProps),r[a]=c,t.prototype[a]=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return this._getService.bind(this,a).apply(this,o.multipleInstances?t:[])}}for(var l=0,h=Object.keys(e);l<h.length;l++)e[h[l]]._addComponent(o);return"PUBLIC"===o.type?r[a]:null}return r.default=r,Object.defineProperty(r,"apps",{get:function(){return Object.keys(e).map(function(t){return e[t]})}}),i.App=t,r}(m);return e.INTERNAL=Object(o.a)(Object(o.a)({},e.INTERNAL),{createFirebaseNamespace:t,extendNamespace:function(t){Object(s.m)(e,t)},createSubscribe:s.k,ErrorFactory:s.b,deepExtend:s.m}),e}(),_=function(){function t(t){this.container=t}return t.prototype.getPlatformInfoString=function(){return this.container.getProviders().map(function(t){if(function(t){var e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){var e=t.getImmediate();return e.library+"/"+e.version}return null}).filter(function(t){return t}).join(" ")},t}();if(Object(s.r)()&&void 0!==self.firebase){f.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var y=self.firebase.SDK_VERSION;y&&y.indexOf("LITE")>=0&&f.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var v=g.initializeApp;g.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return Object(s.x)()&&f.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the @rollup/plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/@rollup/plugin-node-resolve\n      '),v.apply(void 0,t)};var b=g;!function(t,e){t.INTERNAL.registerComponent(new a.a("platform-logger",function(t){return new _(t)},"PRIVATE")),t.registerVersion(h,"0.6.30",void 0),t.registerVersion("fire-js","")}(b),e.a=b},zUnb:function(t,e,n){"use strict";n.r(e);var r=n("fXoL");let i=null;function o(){return i}const s=new r.r("DocumentToken");let a=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Object(r.Gb)({factory:c,token:t,providedIn:"platform"}),t})();function c(){return Object(r.Rb)(u)}const l=new r.r("Location Initialized");let u=(()=>{class t extends a{constructor(t){super(),this._doc=t,this._init()}_init(){this.location=o().getLocation(),this._history=o().getHistory()}getBaseHrefFromDOM(){return o().getBaseHref(this._doc)}onPopState(t){o().getGlobalEventTarget(this._doc,"window").addEventListener("popstate",t,!1)}onHashChange(t){o().getGlobalEventTarget(this._doc,"window").addEventListener("hashchange",t,!1)}get href(){return this.location.href}get protocol(){return this.location.protocol}get hostname(){return this.location.hostname}get port(){return this.location.port}get pathname(){return this.location.pathname}get search(){return this.location.search}get hash(){return this.location.hash}set pathname(t){this.location.pathname=t}pushState(t,e,n){h()?this._history.pushState(t,e,n):this.location.hash=n}replaceState(t,e,n){h()?this._history.replaceState(t,e,n):this.location.hash=n}forward(){this._history.forward()}back(){this._history.back()}getState(){return this._history.state}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(s))},t.\u0275prov=Object(r.Gb)({factory:d,token:t,providedIn:"platform"}),t})();function h(){return!!window.history.pushState}function d(){return new u(Object(r.Rb)(s))}function p(t,e){if(0==t.length)return e;if(0==e.length)return t;let n=0;return t.endsWith("/")&&n++,e.startsWith("/")&&n++,2==n?t+e.substring(1):1==n?t+e:t+"/"+e}function f(t){const e=t.match(/#|\?|$/),n=e&&e.index||t.length;return t.slice(0,n-("/"===t[n-1]?1:0))+t.slice(n)}function m(t){return t&&"?"!==t[0]?"?"+t:t}let g=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=Object(r.Gb)({factory:_,token:t,providedIn:"root"}),t})();function _(t){const e=Object(r.Rb)(s).location;return new v(Object(r.Rb)(a),e&&e.origin||"")}const y=new r.r("appBaseHref");let v=(()=>{class t extends g{constructor(t,e){if(super(),this._platformLocation=t,null==e&&(e=this._platformLocation.getBaseHrefFromDOM()),null==e)throw new Error("No base href set. Please provide a value for the APP_BASE_HREF token or add a base element to the document.");this._baseHref=e}onPopState(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)}getBaseHref(){return this._baseHref}prepareExternalUrl(t){return p(this._baseHref,t)}path(t=!1){const e=this._platformLocation.pathname+m(this._platformLocation.search),n=this._platformLocation.hash;return n&&t?`${e}${n}`:e}pushState(t,e,n,r){const i=this.prepareExternalUrl(n+m(r));this._platformLocation.pushState(t,e,i)}replaceState(t,e,n,r){const i=this.prepareExternalUrl(n+m(r));this._platformLocation.replaceState(t,e,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(a),r.Rb(y,8))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})(),b=(()=>{class t extends g{constructor(t,e){super(),this._platformLocation=t,this._baseHref="",null!=e&&(this._baseHref=e)}onPopState(t){this._platformLocation.onPopState(t),this._platformLocation.onHashChange(t)}getBaseHref(){return this._baseHref}path(t=!1){let e=this._platformLocation.hash;return null==e&&(e="#"),e.length>0?e.substring(1):e}prepareExternalUrl(t){const e=p(this._baseHref,t);return e.length>0?"#"+e:e}pushState(t,e,n,r){let i=this.prepareExternalUrl(n+m(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.pushState(t,e,i)}replaceState(t,e,n,r){let i=this.prepareExternalUrl(n+m(r));0==i.length&&(i=this._platformLocation.pathname),this._platformLocation.replaceState(t,e,i)}forward(){this._platformLocation.forward()}back(){this._platformLocation.back()}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(a),r.Rb(y,8))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})(),x=(()=>{class t{constructor(t,e){this._subject=new r.n,this._urlChangeListeners=[],this._platformStrategy=t;const n=this._platformStrategy.getBaseHref();this._platformLocation=e,this._baseHref=f(T(n)),this._platformStrategy.onPopState(t=>{this._subject.emit({url:this.path(!0),pop:!0,state:t.state,type:t.type})})}path(t=!1){return this.normalize(this._platformStrategy.path(t))}getState(){return this._platformLocation.getState()}isCurrentPathEqualTo(t,e=""){return this.path()==this.normalize(t+m(e))}normalize(e){return t.stripTrailingSlash(function(t,e){return t&&e.startsWith(t)?e.substring(t.length):e}(this._baseHref,T(e)))}prepareExternalUrl(t){return t&&"/"!==t[0]&&(t="/"+t),this._platformStrategy.prepareExternalUrl(t)}go(t,e="",n=null){this._platformStrategy.pushState(n,"",t,e),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+m(e)),n)}replaceState(t,e="",n=null){this._platformStrategy.replaceState(n,"",t,e),this._notifyUrlChangeListeners(this.prepareExternalUrl(t+m(e)),n)}forward(){this._platformStrategy.forward()}back(){this._platformStrategy.back()}onUrlChange(t){this._urlChangeListeners.push(t),this._urlChangeSubscription||(this._urlChangeSubscription=this.subscribe(t=>{this._notifyUrlChangeListeners(t.url,t.state)}))}_notifyUrlChangeListeners(t="",e){this._urlChangeListeners.forEach(n=>n(t,e))}subscribe(t,e,n){return this._subject.subscribe({next:t,error:e,complete:n})}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(g),r.Rb(a))},t.normalizeQueryParams=m,t.joinWithSlash=p,t.stripTrailingSlash=f,t.\u0275prov=Object(r.Gb)({factory:w,token:t,providedIn:"root"}),t})();function w(){return new x(Object(r.Rb)(g),Object(r.Rb)(a))}function T(t){return t.replace(/\/index.html$/,"")}var C=function(t){return t[t.Zero=0]="Zero",t[t.One=1]="One",t[t.Two=2]="Two",t[t.Few=3]="Few",t[t.Many=4]="Many",t[t.Other=5]="Other",t}({});const E=r.mb;class S{}let I=(()=>{class t extends S{constructor(t){super(),this.locale=t}getPluralCategory(t,e){switch(E(e||this.locale)(t)){case C.Zero:return"zero";case C.One:return"one";case C.Two:return"two";case C.Few:return"few";case C.Many:return"many";default:return"other"}}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(r.v))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})(),k=(()=>{class t{constructor(t,e,n,r){this._iterableDiffers=t,this._keyValueDiffers=e,this._ngEl=n,this._renderer=r,this._iterableDiffer=null,this._keyValueDiffer=null,this._initialClasses=[],this._rawClass=null}set klass(t){this._removeClasses(this._initialClasses),this._initialClasses="string"==typeof t?t.split(/\s+/):[],this._applyClasses(this._initialClasses),this._applyClasses(this._rawClass)}set ngClass(t){this._removeClasses(this._rawClass),this._applyClasses(this._initialClasses),this._iterableDiffer=null,this._keyValueDiffer=null,this._rawClass="string"==typeof t?t.split(/\s+/):t,this._rawClass&&(Object(r.pb)(this._rawClass)?this._iterableDiffer=this._iterableDiffers.find(this._rawClass).create():this._keyValueDiffer=this._keyValueDiffers.find(this._rawClass).create())}ngDoCheck(){if(this._iterableDiffer){const t=this._iterableDiffer.diff(this._rawClass);t&&this._applyIterableChanges(t)}else if(this._keyValueDiffer){const t=this._keyValueDiffer.diff(this._rawClass);t&&this._applyKeyValueChanges(t)}}_applyKeyValueChanges(t){t.forEachAddedItem(t=>this._toggleClass(t.key,t.currentValue)),t.forEachChangedItem(t=>this._toggleClass(t.key,t.currentValue)),t.forEachRemovedItem(t=>{t.previousValue&&this._toggleClass(t.key,!1)})}_applyIterableChanges(t){t.forEachAddedItem(t=>{if("string"!=typeof t.item)throw new Error(`NgClass can only toggle CSS classes expressed as strings, got ${Object(r.vb)(t.item)}`);this._toggleClass(t.item,!0)}),t.forEachRemovedItem(t=>this._toggleClass(t.item,!1))}_applyClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(t=>this._toggleClass(t,!0)):Object.keys(t).forEach(e=>this._toggleClass(e,!!t[e])))}_removeClasses(t){t&&(Array.isArray(t)||t instanceof Set?t.forEach(t=>this._toggleClass(t,!1)):Object.keys(t).forEach(t=>this._toggleClass(t,!1)))}_toggleClass(t,e){(t=t.trim())&&t.split(/\s+/g).forEach(t=>{e?this._renderer.addClass(this._ngEl.nativeElement,t):this._renderer.removeClass(this._ngEl.nativeElement,t)})}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.t),r.Kb(r.u),r.Kb(r.l),r.Kb(r.E))},t.\u0275dir=r.Fb({type:t,selectors:[["","ngClass",""]],inputs:{klass:["class","klass"],ngClass:"ngClass"}}),t})();class A{constructor(t,e,n,r){this.$implicit=t,this.ngForOf=e,this.index=n,this.count=r}get first(){return 0===this.index}get last(){return this.index===this.count-1}get even(){return this.index%2==0}get odd(){return!this.even}}let M=(()=>{class t{constructor(t,e,n){this._viewContainer=t,this._template=e,this._differs=n,this._ngForOf=null,this._ngForOfDirty=!0,this._differ=null}set ngForOf(t){this._ngForOf=t,this._ngForOfDirty=!0}set ngForTrackBy(t){this._trackByFn=t}get ngForTrackBy(){return this._trackByFn}set ngForTemplate(t){t&&(this._template=t)}ngDoCheck(){if(this._ngForOfDirty){this._ngForOfDirty=!1;const n=this._ngForOf;if(!this._differ&&n)try{this._differ=this._differs.find(n).create(this.ngForTrackBy)}catch(e){throw new Error(`Cannot find a differ supporting object '${n}' of type '${t=n,t.name||typeof t}'. NgFor only supports binding to Iterables such as Arrays.`)}}var t;if(this._differ){const t=this._differ.diff(this._ngForOf);t&&this._applyChanges(t)}}_applyChanges(t){const e=[];t.forEachOperation((t,n,r)=>{if(null==t.previousIndex){const n=this._viewContainer.createEmbeddedView(this._template,new A(null,this._ngForOf,-1,-1),null===r?void 0:r),i=new O(t,n);e.push(i)}else if(null==r)this._viewContainer.remove(null===n?void 0:n);else if(null!==n){const i=this._viewContainer.get(n);this._viewContainer.move(i,r);const o=new O(t,i);e.push(o)}});for(let n=0;n<e.length;n++)this._perViewChange(e[n].view,e[n].record);for(let n=0,r=this._viewContainer.length;n<r;n++){const t=this._viewContainer.get(n);t.context.index=n,t.context.count=r,t.context.ngForOf=this._ngForOf}t.forEachIdentityChange(t=>{this._viewContainer.get(t.currentIndex).context.$implicit=t.item})}_perViewChange(t,e){t.context.$implicit=e.item}static ngTemplateContextGuard(t,e){return!0}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.Q),r.Kb(r.L),r.Kb(r.t))},t.\u0275dir=r.Fb({type:t,selectors:[["","ngFor","","ngForOf",""]],inputs:{ngForOf:"ngForOf",ngForTrackBy:"ngForTrackBy",ngForTemplate:"ngForTemplate"}}),t})();class O{constructor(t,e){this.record=t,this.view=e}}let P=(()=>{class t{constructor(t,e){this._viewContainer=t,this._context=new D,this._thenTemplateRef=null,this._elseTemplateRef=null,this._thenViewRef=null,this._elseViewRef=null,this._thenTemplateRef=e}set ngIf(t){this._context.$implicit=this._context.ngIf=t,this._updateView()}set ngIfThen(t){R("ngIfThen",t),this._thenTemplateRef=t,this._thenViewRef=null,this._updateView()}set ngIfElse(t){R("ngIfElse",t),this._elseTemplateRef=t,this._elseViewRef=null,this._updateView()}_updateView(){this._context.$implicit?this._thenViewRef||(this._viewContainer.clear(),this._elseViewRef=null,this._thenTemplateRef&&(this._thenViewRef=this._viewContainer.createEmbeddedView(this._thenTemplateRef,this._context))):this._elseViewRef||(this._viewContainer.clear(),this._thenViewRef=null,this._elseTemplateRef&&(this._elseViewRef=this._viewContainer.createEmbeddedView(this._elseTemplateRef,this._context)))}static ngTemplateContextGuard(t,e){return!0}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.Q),r.Kb(r.L))},t.\u0275dir=r.Fb({type:t,selectors:[["","ngIf",""]],inputs:{ngIf:"ngIf",ngIfThen:"ngIfThen",ngIfElse:"ngIfElse"}}),t})();class D{constructor(){this.$implicit=null,this.ngIf=null}}function R(t,e){if(e&&!e.createEmbeddedView)throw new Error(`${t} must be a TemplateRef, but received '${Object(r.vb)(e)}'.`)}let N=(()=>{class t{constructor(t,e,n){this._ngEl=t,this._differs=e,this._renderer=n,this._ngStyle=null,this._differ=null}set ngStyle(t){this._ngStyle=t,!this._differ&&t&&(this._differ=this._differs.find(t).create())}ngDoCheck(){if(this._differ){const t=this._differ.diff(this._ngStyle);t&&this._applyChanges(t)}}_setStyle(t,e){const[n,r]=t.split(".");null!=(e=null!=e&&r?`${e}${r}`:e)?this._renderer.setStyle(this._ngEl.nativeElement,n,e):this._renderer.removeStyle(this._ngEl.nativeElement,n)}_applyChanges(t){t.forEachRemovedItem(t=>this._setStyle(t.key,null)),t.forEachAddedItem(t=>this._setStyle(t.key,t.currentValue)),t.forEachChangedItem(t=>this._setStyle(t.key,t.currentValue))}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.l),r.Kb(r.u),r.Kb(r.E))},t.\u0275dir=r.Fb({type:t,selectors:[["","ngStyle",""]],inputs:{ngStyle:"ngStyle"}}),t})(),L=(()=>{class t{}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)},providers:[{provide:S,useClass:I}]}),t})();function j(t){return"server"===t}let z=(()=>{class t{}return t.\u0275prov=Object(r.Gb)({token:t,providedIn:"root",factory:()=>new F(Object(r.Rb)(s),window)}),t})();class F{constructor(t,e){this.document=t,this.window=e,this.offset=()=>[0,0]}setOffset(t){this.offset=Array.isArray(t)?()=>t:t}getScrollPosition(){return this.supportsScrolling()?[this.window.pageXOffset,this.window.pageYOffset]:[0,0]}scrollToPosition(t){this.supportsScrolling()&&this.window.scrollTo(t[0],t[1])}scrollToAnchor(t){var e;if(!this.supportsScrolling())return;const n=null!==(e=this.document.getElementById(t))&&void 0!==e?e:this.document.getElementsByName(t)[0];void 0!==n&&(this.scrollToElement(n),this.attemptFocus(n))}setHistoryScrollRestoration(t){if(this.supportScrollRestoration()){const e=this.window.history;e&&e.scrollRestoration&&(e.scrollRestoration=t)}}scrollToElement(t){const e=t.getBoundingClientRect(),n=e.left+this.window.pageXOffset,r=e.top+this.window.pageYOffset,i=this.offset();this.window.scrollTo(n-i[0],r-i[1])}attemptFocus(t){return t.focus(),this.document.activeElement===t}supportScrollRestoration(){try{if(!this.supportsScrolling())return!1;const t=B(this.window.history)||B(Object.getPrototypeOf(this.window.history));return!(!t||!t.writable&&!t.set)}catch(t){return!1}}supportsScrolling(){try{return!!this.window&&!!this.window.scrollTo&&"pageXOffset"in this.window}catch(t){return!1}}}function B(t){return Object.getOwnPropertyDescriptor(t,"scrollRestoration")}class U extends class extends class{}{constructor(){super()}supportsDOMEvents(){return!0}}{static makeCurrent(){var t;t=new U,i||(i=t)}getProperty(t,e){return t[e]}log(t){window.console&&window.console.log&&window.console.log(t)}logGroup(t){window.console&&window.console.group&&window.console.group(t)}logGroupEnd(){window.console&&window.console.groupEnd&&window.console.groupEnd()}onAndCancel(t,e,n){return t.addEventListener(e,n,!1),()=>{t.removeEventListener(e,n,!1)}}dispatchEvent(t,e){t.dispatchEvent(e)}remove(t){return t.parentNode&&t.parentNode.removeChild(t),t}getValue(t){return t.value}createElement(t,e){return(e=e||this.getDefaultDocument()).createElement(t)}createHtmlDocument(){return document.implementation.createHTMLDocument("fakeTitle")}getDefaultDocument(){return document}isElementNode(t){return t.nodeType===Node.ELEMENT_NODE}isShadowRoot(t){return t instanceof DocumentFragment}getGlobalEventTarget(t,e){return"window"===e?window:"document"===e?t:"body"===e?t.body:null}getHistory(){return window.history}getLocation(){return window.location}getBaseHref(t){const e=q||(q=document.querySelector("base"),q)?q.getAttribute("href"):null;return null==e?null:(n=e,V||(V=document.createElement("a")),V.setAttribute("href",n),"/"===V.pathname.charAt(0)?V.pathname:"/"+V.pathname);var n}resetBaseElement(){q=null}getUserAgent(){return window.navigator.userAgent}performanceNow(){return window.performance&&window.performance.now?window.performance.now():(new Date).getTime()}supportsCookies(){return!0}getCookie(t){return function(t,e){e=encodeURIComponent(e);for(const n of t.split(";")){const t=n.indexOf("="),[r,i]=-1==t?[n,""]:[n.slice(0,t),n.slice(t+1)];if(r.trim()===e)return decodeURIComponent(i)}return null}(document.cookie,t)}}let V,q=null;const G=new r.r("TRANSITION_ID"),$=[{provide:r.d,useFactory:function(t,e,n){return()=>{n.get(r.e).donePromise.then(()=>{const n=o();Array.prototype.slice.apply(e.querySelectorAll("style[ng-transition]")).filter(e=>e.getAttribute("ng-transition")===t).forEach(t=>n.remove(t))})}},deps:[G,s,r.s],multi:!0}];class W{static init(){Object(r.X)(new W)}addToWindow(t){r.ob.getAngularTestability=(e,n=!0)=>{const r=t.findTestabilityInTree(e,n);if(null==r)throw new Error("Could not find testability for element.");return r},r.ob.getAllAngularTestabilities=()=>t.getAllTestabilities(),r.ob.getAllAngularRootElements=()=>t.getAllRootElements(),r.ob.frameworkStabilizers||(r.ob.frameworkStabilizers=[]),r.ob.frameworkStabilizers.push(t=>{const e=r.ob.getAllAngularTestabilities();let n=e.length,i=!1;const o=function(e){i=i||e,n--,0==n&&t(i)};e.forEach(function(t){t.whenStable(o)})})}findTestabilityInTree(t,e,n){if(null==e)return null;const r=t.getTestability(e);return null!=r?r:n?o().isShadowRoot(e)?this.findTestabilityInTree(t,e.host,!0):this.findTestabilityInTree(t,e.parentElement,!0):null}}const H=new r.r("EventManagerPlugins");let Z=(()=>{class t{constructor(t,e){this._zone=e,this._eventNameToPlugin=new Map,t.forEach(t=>t.manager=this),this._plugins=t.slice().reverse()}addEventListener(t,e,n){return this._findPluginFor(e).addEventListener(t,e,n)}addGlobalEventListener(t,e,n){return this._findPluginFor(e).addGlobalEventListener(t,e,n)}getZone(){return this._zone}_findPluginFor(t){const e=this._eventNameToPlugin.get(t);if(e)return e;const n=this._plugins;for(let r=0;r<n.length;r++){const e=n[r];if(e.supports(t))return this._eventNameToPlugin.set(t,e),e}throw new Error(`No event manager plugin found for event ${t}`)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(H),r.Rb(r.A))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})();class K{constructor(t){this._doc=t}addGlobalEventListener(t,e,n){const r=o().getGlobalEventTarget(this._doc,t);if(!r)throw new Error(`Unsupported event target ${r} for event ${e}`);return this.addEventListener(r,e,n)}}let X=(()=>{class t{constructor(){this._stylesSet=new Set}addStyles(t){const e=new Set;t.forEach(t=>{this._stylesSet.has(t)||(this._stylesSet.add(t),e.add(t))}),this.onStylesAdded(e)}onStylesAdded(t){}getAllStyles(){return Array.from(this._stylesSet)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})(),Y=(()=>{class t extends X{constructor(t){super(),this._doc=t,this._hostNodes=new Set,this._styleNodes=new Set,this._hostNodes.add(t.head)}_addStylesToHost(t,e){t.forEach(t=>{const n=this._doc.createElement("style");n.textContent=t,this._styleNodes.add(e.appendChild(n))})}addHost(t){this._addStylesToHost(this._stylesSet,t),this._hostNodes.add(t)}removeHost(t){this._hostNodes.delete(t)}onStylesAdded(t){this._hostNodes.forEach(e=>this._addStylesToHost(t,e))}ngOnDestroy(){this._styleNodes.forEach(t=>o().remove(t))}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(s))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})();const Q={svg:"http://www.w3.org/2000/svg",xhtml:"http://www.w3.org/1999/xhtml",xlink:"http://www.w3.org/1999/xlink",xml:"http://www.w3.org/XML/1998/namespace",xmlns:"http://www.w3.org/2000/xmlns/"},J=/%COMP%/g;function tt(t,e,n){for(let r=0;r<e.length;r++){let i=e[r];Array.isArray(i)?tt(t,i,n):(i=i.replace(J,t),n.push(i))}return n}function et(t){return e=>{if("__ngUnwrap__"===e)return t;!1===t(e)&&(e.preventDefault(),e.returnValue=!1)}}let nt=(()=>{class t{constructor(t,e,n){this.eventManager=t,this.sharedStylesHost=e,this.appId=n,this.rendererByCompId=new Map,this.defaultRenderer=new rt(t)}createRenderer(t,e){if(!t||!e)return this.defaultRenderer;switch(e.encapsulation){case r.R.Emulated:{let n=this.rendererByCompId.get(e.id);return n||(n=new it(this.eventManager,this.sharedStylesHost,e,this.appId),this.rendererByCompId.set(e.id,n)),n.applyToHost(t),n}case 1:case r.R.ShadowDom:return new ot(this.eventManager,this.sharedStylesHost,t,e);default:if(!this.rendererByCompId.has(e.id)){const t=tt(e.id,e.styles,[]);this.sharedStylesHost.addStyles(t),this.rendererByCompId.set(e.id,this.defaultRenderer)}return this.defaultRenderer}}begin(){}end(){}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Z),r.Rb(Y),r.Rb(r.c))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})();class rt{constructor(t){this.eventManager=t,this.data=Object.create(null)}destroy(){}createElement(t,e){return e?document.createElementNS(Q[e]||e,t):document.createElement(t)}createComment(t){return document.createComment(t)}createText(t){return document.createTextNode(t)}appendChild(t,e){t.appendChild(e)}insertBefore(t,e,n){t&&t.insertBefore(e,n)}removeChild(t,e){t&&t.removeChild(e)}selectRootElement(t,e){let n="string"==typeof t?document.querySelector(t):t;if(!n)throw new Error(`The selector "${t}" did not match any elements`);return e||(n.textContent=""),n}parentNode(t){return t.parentNode}nextSibling(t){return t.nextSibling}setAttribute(t,e,n,r){if(r){e=r+":"+e;const i=Q[r];i?t.setAttributeNS(i,e,n):t.setAttribute(e,n)}else t.setAttribute(e,n)}removeAttribute(t,e,n){if(n){const r=Q[n];r?t.removeAttributeNS(r,e):t.removeAttribute(`${n}:${e}`)}else t.removeAttribute(e)}addClass(t,e){t.classList.add(e)}removeClass(t,e){t.classList.remove(e)}setStyle(t,e,n,i){i&(r.G.DashCase|r.G.Important)?t.style.setProperty(e,n,i&r.G.Important?"important":""):t.style[e]=n}removeStyle(t,e,n){n&r.G.DashCase?t.style.removeProperty(e):t.style[e]=""}setProperty(t,e,n){t[e]=n}setValue(t,e){t.nodeValue=e}listen(t,e,n){return"string"==typeof t?this.eventManager.addGlobalEventListener(t,e,et(n)):this.eventManager.addEventListener(t,e,et(n))}}class it extends rt{constructor(t,e,n,r){super(t),this.component=n;const i=tt(r+"-"+n.id,n.styles,[]);e.addStyles(i),this.contentAttr="_ngcontent-%COMP%".replace(J,r+"-"+n.id),this.hostAttr="_nghost-%COMP%".replace(J,r+"-"+n.id)}applyToHost(t){super.setAttribute(t,this.hostAttr,"")}createElement(t,e){const n=super.createElement(t,e);return super.setAttribute(n,this.contentAttr,""),n}}class ot extends rt{constructor(t,e,n,r){super(t),this.sharedStylesHost=e,this.hostEl=n,this.shadowRoot=n.attachShadow({mode:"open"}),this.sharedStylesHost.addHost(this.shadowRoot);const i=tt(r.id,r.styles,[]);for(let o=0;o<i.length;o++){const t=document.createElement("style");t.textContent=i[o],this.shadowRoot.appendChild(t)}}nodeOrShadowRoot(t){return t===this.hostEl?this.shadowRoot:t}destroy(){this.sharedStylesHost.removeHost(this.shadowRoot)}appendChild(t,e){return super.appendChild(this.nodeOrShadowRoot(t),e)}insertBefore(t,e,n){return super.insertBefore(this.nodeOrShadowRoot(t),e,n)}removeChild(t,e){return super.removeChild(this.nodeOrShadowRoot(t),e)}parentNode(t){return this.nodeOrShadowRoot(super.parentNode(this.nodeOrShadowRoot(t)))}}let st=(()=>{class t extends K{constructor(t){super(t)}supports(t){return!0}addEventListener(t,e,n){return t.addEventListener(e,n,!1),()=>this.removeEventListener(t,e,n)}removeEventListener(t,e,n){return t.removeEventListener(e,n)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(s))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})();const at=["alt","control","meta","shift"],ct={"\b":"Backspace","\t":"Tab","\x7f":"Delete","\x1b":"Escape",Del:"Delete",Esc:"Escape",Left:"ArrowLeft",Right:"ArrowRight",Up:"ArrowUp",Down:"ArrowDown",Menu:"ContextMenu",Scroll:"ScrollLock",Win:"OS"},lt={A:"1",B:"2",C:"3",D:"4",E:"5",F:"6",G:"7",H:"8",I:"9",J:"*",K:"+",M:"-",N:".",O:"/","`":"0","\x90":"NumLock"},ut={alt:t=>t.altKey,control:t=>t.ctrlKey,meta:t=>t.metaKey,shift:t=>t.shiftKey};let ht=(()=>{class t extends K{constructor(t){super(t)}supports(e){return null!=t.parseEventName(e)}addEventListener(e,n,r){const i=t.parseEventName(n),s=t.eventCallback(i.fullKey,r,this.manager.getZone());return this.manager.getZone().runOutsideAngular(()=>o().onAndCancel(e,i.domEventName,s))}static parseEventName(e){const n=e.toLowerCase().split("."),r=n.shift();if(0===n.length||"keydown"!==r&&"keyup"!==r)return null;const i=t._normalizeKey(n.pop());let o="";if(at.forEach(t=>{const e=n.indexOf(t);e>-1&&(n.splice(e,1),o+=t+".")}),o+=i,0!=n.length||0===i.length)return null;const s={};return s.domEventName=r,s.fullKey=o,s}static getEventFullKey(t){let e="",n=function(t){let e=t.key;if(null==e){if(e=t.keyIdentifier,null==e)return"Unidentified";e.startsWith("U+")&&(e=String.fromCharCode(parseInt(e.substring(2),16)),3===t.location&&lt.hasOwnProperty(e)&&(e=lt[e]))}return ct[e]||e}(t);return n=n.toLowerCase()," "===n?n="space":"."===n&&(n="dot"),at.forEach(r=>{r!=n&&(0,ut[r])(t)&&(e+=r+".")}),e+=n,e}static eventCallback(e,n,r){return i=>{t.getEventFullKey(i)===e&&r.runGuarded(()=>n(i))}}static _normalizeKey(t){switch(t){case"esc":return"escape";default:return t}}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(s))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})();const dt=[{provide:r.C,useValue:"browser"},{provide:r.D,useValue:function(){U.makeCurrent(),W.init()},multi:!0},{provide:s,useFactory:function(){return Object(r.ub)(document),document},deps:[]}],pt=Object(r.S)(r.W,"browser",dt),ft=[[],{provide:r.Z,useValue:"root"},{provide:r.m,useFactory:function(){return new r.m},deps:[]},{provide:H,useClass:st,multi:!0,deps:[s,r.A,r.C]},{provide:H,useClass:ht,multi:!0,deps:[s]},[],{provide:nt,useClass:nt,deps:[Z,Y,r.c]},{provide:r.F,useExisting:nt},{provide:X,useExisting:Y},{provide:Y,useClass:Y,deps:[s]},{provide:r.M,useClass:r.M,deps:[r.A]},{provide:Z,useClass:Z,deps:[H,r.A]},[]];let mt=(()=>{class t{constructor(t){if(t)throw new Error("BrowserModule has already been loaded. If you need access to common directives such as NgIf and NgFor from a lazy loaded module, import CommonModule instead.")}static withServerTransition(e){return{ngModule:t,providers:[{provide:r.c,useValue:e.appId},{provide:G,useExisting:r.c},$]}}}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)(r.Rb(t,12))},providers:ft,imports:[L,r.f]}),t})();"undefined"!=typeof window&&window;var gt=n("spgP"),_t=n("D0XW"),yt=n("HDdC"),vt=n("LRne"),bt=n("VRyK"),xt=n("lJxs"),wt=n("w1tV"),Tt=n("Cfvw"),Ct=n("zx2A");function Et(t,e){return"function"==typeof e?n=>n.pipe(Et((n,r)=>Object(Tt.a)(t(n,r)).pipe(Object(xt.a)((t,i)=>e(n,t,r,i))))):e=>e.lift(new St(t))}class St{constructor(t){this.project=t}call(t,e){return e.subscribe(new It(t,this.project))}}class It extends Ct.b{constructor(t,e){super(t),this.project=e,this.index=0}_next(t){let e;const n=this.index++;try{e=this.project(t,n)}catch(r){return void this.destination.error(r)}this._innerSub(e)}_innerSub(t){const e=this.innerSubscription;e&&e.unsubscribe();const n=new Ct.a(this),r=this.destination;r.add(n),this.innerSubscription=Object(Ct.c)(t,n),this.innerSubscription!==n&&r.add(this.innerSubscription)}_complete(){const{innerSubscription:t}=this;t&&!t.closed||super._complete(),this.unsubscribe()}_unsubscribe(){this.innerSubscription=void 0}notifyComplete(){this.innerSubscription=void 0,this.isStopped&&super._complete()}notifyNext(t){this.destination.next(t)}}var kt=n("7o/Q");function At(t,e){let n=!1;return arguments.length>=2&&(n=!0),function(r){return r.lift(new Mt(t,e,n))}}class Mt{constructor(t,e,n=!1){this.accumulator=t,this.seed=e,this.hasSeed=n}call(t,e){return e.subscribe(new Ot(t,this.accumulator,this.seed,this.hasSeed))}}class Ot extends kt.a{constructor(t,e,n,r){super(t),this.accumulator=e,this._seed=n,this.hasSeed=r,this.index=0}get seed(){return this._seed}set seed(t){this.hasSeed=!0,this._seed=t}_next(t){if(this.hasSeed)return this._tryNext(t);this.seed=t,this.destination.next(t)}_tryNext(t){const e=this.index++;let n;try{n=this.accumulator(this.seed,t,e)}catch(r){this.destination.error(r)}this.seed=n,this.destination.next(n)}}function Pt(t,e){return n=>n.lift(new Dt(t,e))}class Dt{constructor(t,e){this.compare=t,this.keySelector=e}call(t,e){return e.subscribe(new Rt(t,this.compare,this.keySelector))}}class Rt extends kt.a{constructor(t,e,n){super(t),this.keySelector=n,this.hasKey=!1,"function"==typeof e&&(this.compare=e)}compare(t,e){return t===e}_next(t){let e;try{const{keySelector:n}=this;e=n?n(t):t}catch(r){return this.destination.error(r)}let n=!1;if(this.hasKey)try{const{compare:t}=this;n=t(this.key,e)}catch(r){return this.destination.error(r)}else this.hasKey=!0;n||(this.key=e,this.destination.next(t))}}class Nt extends kt.a{notifyNext(t,e,n,r,i){this.destination.next(e)}notifyError(t,e){this.destination.error(t)}notifyComplete(t){this.destination.complete()}}class Lt extends kt.a{constructor(t,e,n){super(),this.parent=t,this.outerValue=e,this.outerIndex=n,this.index=0}_next(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)}_error(t){this.parent.notifyError(t,this),this.unsubscribe()}_complete(){this.parent.notifyComplete(this),this.unsubscribe()}}var jt=n("SeVD");function zt(t,e,n,r,i=new Lt(t,n,r)){if(!i.closed)return e instanceof yt.a?e.subscribe(i):Object(jt.a)(e)(i)}class Ft{constructor(t,e){this.observables=t,this.project=e}call(t,e){return e.subscribe(new Bt(t,this.observables,this.project))}}class Bt extends Nt{constructor(t,e,n){super(t),this.observables=e,this.project=n,this.toRespond=[];const r=e.length;this.values=new Array(r);for(let i=0;i<r;i++)this.toRespond.push(i);for(let i=0;i<r;i++)this.add(zt(this,e[i],void 0,i))}notifyNext(t,e,n){this.values[n]=e;const r=this.toRespond;if(r.length>0){const t=r.indexOf(n);-1!==t&&r.splice(t,1)}}notifyComplete(){}_next(t){if(0===this.toRespond.length){const e=[t,...this.values];this.project?this._tryProject(e):this.destination.next(e)}}_tryProject(t){let e;try{e=this.project.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}class Ut{constructor(t){this.predicate=t}call(t,e){return e.subscribe(new Vt(t,this.predicate))}}class Vt extends kt.a{constructor(t,e){super(t),this.predicate=e,this.skipping=!0,this.index=0}_next(t){const e=this.destination;this.skipping&&this.tryCallPredicate(t),this.skipping||e.next(t)}tryCallPredicate(t){try{const e=this.predicate(t,this.index++);this.skipping=Boolean(e)}catch(e){this.destination.error(e)}}}n("6Uf2");var qt=n("XNiG"),Gt=n("pxpQ"),$t=n("qgXg"),Wt=n("quSY"),Ht=n("9ppp"),Zt=n("Ylt2");class Kt extends qt.a{constructor(t=Number.POSITIVE_INFINITY,e=Number.POSITIVE_INFINITY,n){super(),this.scheduler=n,this._events=[],this._infiniteTimeWindow=!1,this._bufferSize=t<1?1:t,this._windowTime=e<1?1:e,e===Number.POSITIVE_INFINITY?(this._infiniteTimeWindow=!0,this.next=this.nextInfiniteTimeWindow):this.next=this.nextTimeWindow}nextInfiniteTimeWindow(t){if(!this.isStopped){const e=this._events;e.push(t),e.length>this._bufferSize&&e.shift()}super.next(t)}nextTimeWindow(t){this.isStopped||(this._events.push(new Xt(this._getNow(),t)),this._trimBufferThenGetEvents()),super.next(t)}_subscribe(t){const e=this._infiniteTimeWindow,n=e?this._events:this._trimBufferThenGetEvents(),r=this.scheduler,i=n.length;let o;if(this.closed)throw new Ht.a;if(this.isStopped||this.hasError?o=Wt.a.EMPTY:(this.observers.push(t),o=new Zt.a(this,t)),r&&t.add(t=new Gt.a(t,r)),e)for(let s=0;s<i&&!t.closed;s++)t.next(n[s]);else for(let s=0;s<i&&!t.closed;s++)t.next(n[s].value);return this.hasError?t.error(this.thrownError):this.isStopped&&t.complete(),o}_getNow(){return(this.scheduler||$t.a).now()}_trimBufferThenGetEvents(){const t=this._getNow(),e=this._bufferSize,n=this._windowTime,r=this._events,i=r.length;let o=0;for(;o<i&&!(t-r[o].time<n);)o++;return i>e&&(o=Math.max(o,i-e)),o>0&&r.splice(0,o),r}}class Xt{constructor(t,e){this.time=t,this.value=e}}function Yt(t,e,n){let r;return r=t&&"object"==typeof t?t:{bufferSize:t,windowTime:e,refCount:!1,scheduler:n},t=>t.lift(function({bufferSize:t=Number.POSITIVE_INFINITY,windowTime:e=Number.POSITIVE_INFINITY,refCount:n,scheduler:r}){let i,o,s=0,a=!1,c=!1;return function(l){let u;s++,!i||a?(a=!1,i=new Kt(t,e,r),u=i.subscribe(this),o=l.subscribe({next(t){i.next(t)},error(t){a=!0,i.error(t)},complete(){c=!0,o=void 0,i.complete()}}),c&&(o=void 0)):u=i.subscribe(this),this.add(()=>{s--,u.unsubscribe(),u=void 0,o&&!c&&n&&0===s&&(o.unsubscribe(),o=void 0,i=void 0)})}}(r))}const Qt=(()=>{function t(){return Error.call(this),this.message="no elements in sequence",this.name="EmptyError",this}return t.prototype=Object.create(Error.prototype),t})();function Jt(t,e){return function(n){return n.lift(new te(t,e))}}class te{constructor(t,e){this.predicate=t,this.thisArg=e}call(t,e){return e.subscribe(new ee(t,this.predicate,this.thisArg))}}class ee extends kt.a{constructor(t,e,n){super(t),this.predicate=e,this.thisArg=n,this.count=0}_next(t){let e;try{e=this.predicate.call(this.thisArg,t,this.count++)}catch(n){return void this.destination.error(n)}e&&this.destination.next(t)}}const ne=(()=>{function t(){return Error.call(this),this.message="argument out of range",this.name="ArgumentOutOfRangeError",this}return t.prototype=Object.create(Error.prototype),t})();var re=n("EY2u");function ie(t){return e=>0===t?Object(re.b)():e.lift(new oe(t))}class oe{constructor(t){if(this.total=t,this.total<0)throw new ne}call(t,e){return e.subscribe(new se(t,this.total))}}class se extends kt.a{constructor(t,e){super(t),this.total=e,this.count=0}_next(t){const e=this.total,n=++this.count;n<=e&&(this.destination.next(t),n===e&&(this.destination.complete(),this.unsubscribe()))}}function ae(t=null){return e=>e.lift(new ce(t))}class ce{constructor(t){this.defaultValue=t}call(t,e){return e.subscribe(new le(t,this.defaultValue))}}class le extends kt.a{constructor(t,e){super(t),this.defaultValue=e,this.isEmpty=!0}_next(t){this.isEmpty=!1,this.destination.next(t)}_complete(){this.isEmpty&&this.destination.next(this.defaultValue),this.destination.complete()}}function ue(t=pe){return e=>e.lift(new he(t))}class he{constructor(t){this.errorFactory=t}call(t,e){return e.subscribe(new de(t,this.errorFactory))}}class de extends kt.a{constructor(t,e){super(t),this.errorFactory=e,this.hasValue=!1}_next(t){this.hasValue=!0,this.destination.next(t)}_complete(){if(this.hasValue)return this.destination.complete();{let t;try{t=this.errorFactory()}catch(K_){t=K_}this.destination.error(t)}}}function pe(){return new Qt}var fe=n("SpAZ");function me(t,e){const n=arguments.length>=2;return r=>r.pipe(t?Jt((e,n)=>t(e,n,r)):fe.a,ie(1),n?ae(e):ue(()=>new Qt))}function ge(t,e){return e?Et(()=>t,e):Et(()=>t)}var _e=n("tf+s");const ye=new r.r("angularfire2.auth.use-emulator"),ve=new r.r("angularfire2.auth.settings"),be=new r.r("angularfire2.auth.tenant-id"),xe=new r.r("angularfire2.auth.langugage-code"),we=new r.r("angularfire2.auth.use-device-language"),Te=new r.r("angularfire.auth.persistence");let Ce=(()=>{class t{constructor(t,e,r,i,o,s,a,c,l,u){const h=new gt.d(i),d=Object(gt.h)(h),p=new qt.a,f=Object(vt.a)(void 0).pipe(Object(Gt.b)(h.outsideAngular),Et(()=>i.runOutsideAngular(()=>n.e(4).then(n.bind(null,"6nsN")))),Object(xt.a)(()=>Object(gt.g)(t,i,e)),Object(xt.a)(t=>i.runOutsideAngular(()=>{const e=o,n=s;return Object(gt.f)(`${t.name}.auth`,"AngularFireAuth",t,()=>{const r=i.runOutsideAngular(()=>t.auth());if(e&&r.useEmulator(`http://${e.join(":")}`),a&&(r.tenantId=a),r.languageCode=c,l&&r.useDeviceLanguage(),n)for(const[t,e]of Object.entries(n))r.settings[t]=e;return u&&r.setPersistence(u),r},[e,a,c,l,n,u])})),Yt({bufferSize:1,refCount:!1}));if(j(r))this.authState=this.user=this.idToken=this.idTokenResult=this.credential=Object(vt.a)(null);else{f.pipe(me()).subscribe();const t=f.pipe(Et(t=>t.getRedirectResult().then(t=>t,()=>null)),d,Yt({bufferSize:1,refCount:!1})),e=t=>new yt.a(e=>({unsubscribe:i.runOutsideAngular(()=>t(e))})),n=f.pipe(Et(t=>e(t.onAuthStateChanged.bind(t)))),r=f.pipe(Et(t=>e(t.onIdTokenChanged.bind(t))));this.authState=t.pipe(ge(n),Object(_e.a)(h.outsideAngular),Object(Gt.b)(h.insideAngular)),this.user=t.pipe(ge(r),Object(_e.a)(h.outsideAngular),Object(Gt.b)(h.insideAngular)),this.idToken=this.user.pipe(Et(t=>t?Object(Tt.a)(t.getIdToken()):Object(vt.a)(null))),this.idTokenResult=this.user.pipe(Et(t=>t?Object(Tt.a)(t.getIdTokenResult()):Object(vt.a)(null))),this.credential=Object(bt.a)(t,p,this.authState.pipe(Jt(t=>!t))).pipe(Object(xt.a)(t=>(null==t?void 0:t.user)?t:null),Object(_e.a)(h.outsideAngular),Object(Gt.b)(h.insideAngular))}return Object(gt.i)(this,f,i,{spy:{apply:(t,e,n)=>{(t.startsWith("signIn")||t.startsWith("createUser"))&&n.then(t=>p.next(t))}}})}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(gt.c),r.Rb(gt.b,8),r.Rb(r.C),r.Rb(r.A),r.Rb(ye,8),r.Rb(ve,8),r.Rb(be,8),r.Rb(xe,8),r.Rb(we,8),r.Rb(Te,8))},t.\u0275prov=r.Gb({factory:function(){return new t(r.Rb(gt.c),r.Rb(gt.b,8),r.Rb(r.C),r.Rb(r.A),r.Rb(ye,8),r.Rb(ve,8),r.Rb(be,8),r.Rb(xe,8),r.Rb(we,8),r.Rb(Te,8))},token:t,providedIn:"any"}),t})();Object(gt.e)(Ce,[{app:null,applyActionCode:null,checkActionCode:null,confirmPasswordReset:null,createUserWithEmailAndPassword:null,currentUser:null,fetchSignInMethodsForEmail:null,isSignInWithEmailLink:null,getRedirectResult:null,languageCode:null,settings:null,onAuthStateChanged:null,onIdTokenChanged:null,sendSignInLinkToEmail:null,sendPasswordResetEmail:null,setPersistence:null,signInAndRetrieveDataWithCredential:null,signInAnonymously:null,signInWithCredential:null,signInWithCustomToken:null,signInWithEmailAndPassword:null,signInWithPhoneNumber:null,signInWithEmailLink:null,signInWithPopup:null,signInWithRedirect:null,signOut:null,tenantId:null,updateCurrentUser:null,useDeviceLanguage:null,useEmulator:null,verifyPasswordResetCode:null}]);let Ee=(()=>{class t{}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)},providers:[Ce]}),t})();var Se=n("Jgta");function Ie(t){return null==t}function ke(t){return"function"==typeof t.set}function Ae(t,e){return ke(e)?e:t.ref(e)}function Me(t,e){if("string"==typeof t)return e.stringCase();if(ke(t))return e.firebaseCase();if("function"==typeof t.exportVal)return e.snapshotCase();throw new Error("Expects a string, snapshot, or reference. Got: "+typeof t)}function Oe(t,e,n="on",r=_t.b){return new yt.a(i=>{let o=null;return o=t[n](e,(t,e)=>{r.schedule(()=>{i.next({snapshot:t,prevKey:e})}),"once"===n&&r.schedule(()=>i.complete())},t=>{r.schedule(()=>i.error(t))}),"on"===n?{unsubscribe(){null!=o&&t.off(e,o)}}:{unsubscribe(){}}}).pipe(Object(xt.a)(t=>{const{snapshot:n,prevKey:r}=t;let i=null;return n.exists()&&(i=n.key),{type:e,payload:n,prevKey:r,key:i}}),Object(wt.a)())}function Pe(t,e){const n=t.length;for(let r=0;r<n;r++)if(t[r].payload.key===e)return r;return-1}function De(t,e){const{payload:n,prevKey:r,key:i}=e,o=Pe(t,i),s=function(t,e){if(Ie(e))return 0;{const n=Pe(t,e);return-1===n?t.length:n+1}}(t,r);switch(e.type){case"value":if(e.payload&&e.payload.exists()){let n=null;e.payload.forEach(e=>{const r={payload:e,type:"value",prevKey:n,key:e.key};return n=e.key,t=[...t,r],!1})}return t;case"child_added":if(o>-1){const i=t[o-1];(i&&i.key||null)!==r&&(t=t.filter(t=>t.payload.key!==n.key)).splice(s,0,e)}else{if(null==r)return[e,...t];(t=t.slice()).splice(s,0,e)}return t;case"child_removed":return t.filter(t=>t.payload.key!==n.key);case"child_changed":return t.map(t=>t.payload.key===i?e:t);case"child_moved":if(o>-1){const e=t.splice(o,1)[0];return(t=t.slice()).splice(s,0,e),t}return t;default:return t}}function Re(t){return(Ie(t)||0===t.length)&&(t=["child_added","child_removed","child_changed","child_moved"]),t}function Ne(t,e,n){return function(t,e,n){return Oe(t,"value","once",n).pipe(Et(r=>{const i=[Object(vt.a)(r)];return e.forEach(e=>i.push(Oe(t,e,"on",n))),Object(bt.a)(...i).pipe(At(De,[]))}),Pt())}(t,e=Re(e),n)}function Le(t,e,n){const r=(e=Re(e)).map(e=>Oe(t,e,"on",n));return Object(bt.a)(...r)}function je(t,e){return function(n,r){return Me(n,{stringCase:()=>t.child(n)[e](r),firebaseCase:()=>n[e](r),snapshotCase:()=>n.ref[e](r)})}}function ze(t,e){return function(){return Oe(t,"value","on",e)}}const Fe=new r.r("angularfire2.realtimeDatabaseURL"),Be=new r.r("angularfire2.database.use-emulator");let Ue=(()=>{class t{constructor(t,e,n,r,i,o,s){this.schedulers=new gt.d(i),this.keepUnstableUntilFirst=Object(gt.h)(this.schedulers);const a=o,c=Object(gt.g)(t,i,e);!Se.a.auth&&s&&Object(gt.j)(),this.database=Object(gt.f)(`${c.name}.database.${n}`,"AngularFireDatabase",c,()=>{const t=i.runOutsideAngular(()=>c.database(n||void 0));return a&&t.useEmulator(...a),t},[a])}list(t,e){const n=this.schedulers.ngZone.runOutsideAngular(()=>Ae(this.database,t));let r=n;return e&&(r=e(n)),function(t,e){const n=e.schedulers.outsideAngular,r=e.schedulers.ngZone.run(()=>t.ref);return{query:t,update:je(r,"update"),set:je(r,"set"),push:t=>r.push(t),remove:(i=r,function(t){return t?Me(t,{stringCase:()=>i.child(t).remove(),firebaseCase:()=>t.remove(),snapshotCase:()=>t.ref.remove()}):i.remove()}),snapshotChanges:r=>Ne(t,r,n).pipe(e.keepUnstableUntilFirst),stateChanges:r=>Le(t,r,n).pipe(e.keepUnstableUntilFirst),auditTrail:r=>function(t,e,n){return function(t,e,n){return function(t,e){return Oe(t,"value","on",e).pipe(Object(xt.a)(t=>{let e;return t.payload.forEach(t=>(e=t.key,!1)),{data:t,lastKeyToLoad:e}}))}(t,n).pipe(function(...t){return e=>{let n;return"function"==typeof t[t.length-1]&&(n=t.pop()),e.lift(new Ft(t,n))}}(e),Object(xt.a)(([t,e])=>{const n=t.lastKeyToLoad,r=e.map(t=>t.key);return{actions:e,lastKeyToLoad:n,loadedKeys:r}}),(r=t=>-1===t.loadedKeys.indexOf(t.lastKeyToLoad),t=>t.lift(new Ut(r))),Object(xt.a)(t=>t.actions));var r}(t,Le(t,e).pipe(At((t,e)=>[...t,e],[])),n)}(t,r,n).pipe(e.keepUnstableUntilFirst),valueChanges:(r,i)=>Ne(t,r,n).pipe(Object(xt.a)(t=>t.map(t=>i&&i.idField?Object.assign(Object.assign({},t.payload.val()),{[i.idField]:t.key}):t.payload.val())),e.keepUnstableUntilFirst)};var i}(r,this)}object(t){const e=this.schedulers.ngZone.runOutsideAngular(()=>Ae(this.database,t));return r=this,{query:n=e,snapshotChanges:()=>ze(n,r.schedulers.outsideAngular)().pipe(r.keepUnstableUntilFirst),update:t=>n.ref.update(t),set:t=>n.ref.set(t),remove:()=>n.ref.remove(),valueChanges:()=>ze(n,r.schedulers.outsideAngular)().pipe(r.keepUnstableUntilFirst,Object(xt.a)(t=>t.payload.exists()?t.payload.val():null))};var n,r}createPushId(){return this.schedulers.ngZone.runOutsideAngular(()=>this.database.ref()).push().key}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(gt.c),r.Rb(gt.b,8),r.Rb(Fe,8),r.Rb(r.C),r.Rb(r.A),r.Rb(Be,8),r.Rb(ye,8))},t.\u0275prov=r.Gb({factory:function(){return new t(r.Rb(gt.c),r.Rb(gt.b,8),r.Rb(Fe,8),r.Rb(r.C),r.Rb(r.A),r.Rb(Be,8),r.Rb(ye,8))},token:t,providedIn:"any"}),t})(),Ve=(()=>{class t{}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)},providers:[Ue]}),t})();class qe{constructor(t,e){this.dueTime=t,this.scheduler=e}call(t,e){return e.subscribe(new Ge(t,this.dueTime,this.scheduler))}}class Ge extends kt.a{constructor(t,e,n){super(t),this.dueTime=e,this.scheduler=n,this.debouncedSubscription=null,this.lastValue=null,this.hasValue=!1}_next(t){this.clearDebounce(),this.lastValue=t,this.hasValue=!0,this.add(this.debouncedSubscription=this.scheduler.schedule($e,this.dueTime,this))}_complete(){this.debouncedNext(),this.destination.complete()}debouncedNext(){if(this.clearDebounce(),this.hasValue){const{lastValue:t}=this;this.lastValue=null,this.hasValue=!1,this.destination.next(t)}}clearDebounce(){const t=this.debouncedSubscription;null!==t&&(this.remove(t),t.unsubscribe(),this.debouncedSubscription=null)}}function $e(t){t.debouncedNext()}var We=n("zIRd"),He=n("mrSG"),Ze=n("qOnz"),Ke=n("/6Yf"),Xe="firebasestorage.googleapis.com",Ye=function(t){function e(n,r){var i=t.call(this,Qe(n),"Firebase Storage: "+r+" ("+Qe(n)+")")||this;return i.customData={serverResponse:null},i._baseMessage=i.message,Object.setPrototypeOf(i,e.prototype),i}return Object(He.c)(e,t),e.prototype._codeEquals=function(t){return Qe(t)===this.code},Object.defineProperty(e.prototype,"serverResponse",{get:function(){return this.customData.serverResponse},set:function(t){this.customData.serverResponse=t,this.message=this.customData.serverResponse?this._baseMessage+"\n"+this.customData.serverResponse:this._baseMessage},enumerable:!1,configurable:!0}),e}(Ze.c);function Qe(t){return"storage/"+t}function Je(){return new Ye("unknown","An unknown error occurred, please check the error payload for server response.")}function tn(){return new Ye("canceled","User canceled the upload/download.")}function en(){return new Ye("cannot-slice-blob","Cannot slice blob for upload. Please retry the upload.")}function nn(t){return new Ye("invalid-argument",t)}function rn(){return new Ye("app-deleted","The Firebase app was deleted.")}function on(t){return new Ye("invalid-root-operation","The operation '"+t+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}function sn(t,e){return new Ye("invalid-format","String does not match format '"+t+"': "+e)}function an(t){throw new Ye("internal-error","Internal error: "+t)}var cn={RAW:"raw",BASE64:"base64",BASE64URL:"base64url",DATA_URL:"data_url"},ln=function(){return function(t,e){this.data=t,this.contentType=e||null}}();function un(t,e){switch(t){case cn.RAW:return new ln(hn(e));case cn.BASE64:case cn.BASE64URL:return new ln(dn(t,e));case cn.DATA_URL:return new ln((n=new pn(e)).base64?dn(cn.BASE64,n.rest):function(t){var e;try{e=decodeURIComponent(t)}catch(K_){throw sn(cn.DATA_URL,"Malformed data URL.")}return hn(e)}(n.rest),new pn(e).contentType)}var n;throw Je()}function hn(t){for(var e=[],n=0;n<t.length;n++){var r=t.charCodeAt(n);if(r<=127)e.push(r);else if(r<=2047)e.push(192|r>>6,128|63&r);else if(55296==(64512&r))if(n<t.length-1&&56320==(64512&t.charCodeAt(n+1))){var i=r,o=t.charCodeAt(++n);e.push(240|(r=65536|(1023&i)<<10|1023&o)>>18,128|r>>12&63,128|r>>6&63,128|63&r)}else e.push(239,191,189);else 56320==(64512&r)?e.push(239,191,189):e.push(224|r>>12,128|r>>6&63,128|63&r)}return new Uint8Array(e)}function dn(t,e){switch(t){case cn.BASE64:var n=-1!==e.indexOf("-"),r=-1!==e.indexOf("_");if(n||r)throw sn(t,"Invalid character '"+(n?"-":"_")+"' found: is it base64url encoded?");break;case cn.BASE64URL:var i=-1!==e.indexOf("+"),o=-1!==e.indexOf("/");if(i||o)throw sn(t,"Invalid character '"+(i?"+":"/")+"' found: is it base64 encoded?");e=e.replace(/-/g,"+").replace(/_/g,"/")}var s;try{s=atob(e)}catch(K_){throw sn(t,"Invalid character found")}for(var a=new Uint8Array(s.length),c=0;c<s.length;c++)a[c]=s.charCodeAt(c);return a}var pn=function(){return function(t){this.base64=!1,this.contentType=null;var e=t.match(/^data:([^,]+)?,/);if(null===e)throw sn(cn.DATA_URL,"Must be formatted 'data:[<mediatype>][;base64],<data>");var n,r,i=e[1]||null;null!=i&&(this.base64=(n=i).length>=(r=";base64").length&&n.substring(n.length-r.length)===r,this.contentType=this.base64?i.substring(0,i.length-";base64".length):i),this.rest=t.substring(t.indexOf(",")+1)}}(),fn={RUNNING:"running",PAUSED:"paused",SUCCESS:"success",CANCELED:"canceled",ERROR:"error"};function mn(t){switch(t){case"running":case"pausing":case"canceling":return fn.RUNNING;case"paused":return fn.PAUSED;case"success":return fn.SUCCESS;case"canceled":return fn.CANCELED;case"error":default:return fn.ERROR}}var gn=function(t){return t[t.NO_ERROR=0]="NO_ERROR",t[t.NETWORK_ERROR=1]="NETWORK_ERROR",t[t.ABORT=2]="ABORT",t}({}),_n=function(){function t(){var t=this;this.sent_=!1,this.xhr_=new XMLHttpRequest,this.errorCode_=gn.NO_ERROR,this.sendPromise_=new Promise(function(e){t.xhr_.addEventListener("abort",function(){t.errorCode_=gn.ABORT,e()}),t.xhr_.addEventListener("error",function(){t.errorCode_=gn.NETWORK_ERROR,e()}),t.xhr_.addEventListener("load",function(){e()})})}return t.prototype.send=function(t,e,n,r){if(this.sent_)throw an("cannot .send() more than once");if(this.sent_=!0,this.xhr_.open(e,t,!0),void 0!==r)for(var i in r)r.hasOwnProperty(i)&&this.xhr_.setRequestHeader(i,r[i].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_},t.prototype.getErrorCode=function(){if(!this.sent_)throw an("cannot .getErrorCode() before sending");return this.errorCode_},t.prototype.getStatus=function(){if(!this.sent_)throw an("cannot .getStatus() before sending");try{return this.xhr_.status}catch(K_){return-1}},t.prototype.getResponseText=function(){if(!this.sent_)throw an("cannot .getResponseText() before sending");return this.xhr_.responseText},t.prototype.abort=function(){this.xhr_.abort()},t.prototype.getResponseHeader=function(t){return this.xhr_.getResponseHeader(t)},t.prototype.addUploadProgressListener=function(t){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",t)},t.prototype.removeUploadProgressListener=function(t){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",t)},t}(),yn=function(){function t(){}return t.prototype.createConnection=function(){return new _n},t}(),vn=function(){function t(t,e){this.bucket=t,this.path_=e}return Object.defineProperty(t.prototype,"path",{get:function(){return this.path_},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isRoot",{get:function(){return 0===this.path.length},enumerable:!1,configurable:!0}),t.prototype.fullServerUrl=function(){var t=encodeURIComponent;return"/b/"+t(this.bucket)+"/o/"+t(this.path)},t.prototype.bucketOnlyServerUrl=function(){return"/b/"+encodeURIComponent(this.bucket)+"/o"},t.makeFromBucketSpec=function(e,n){var r;try{r=t.makeFromUrl(e,n)}catch(K_){return new t(e,"")}if(""===r.path)return r;throw new Ye("invalid-default-bucket","Invalid default bucket '"+e+"'.")},t.makeFromUrl=function(e,n){var r=null,i="([A-Za-z0-9.\\-_]+)",o=new RegExp("^gs://"+i+"(/(.*))?$","i");function s(t){t.path_=decodeURIComponent(t.path)}for(var a=n.replace(/[.]/g,"\\."),c=[{regex:o,indices:{bucket:1,path:3},postModify:function(t){"/"===t.path.charAt(t.path.length-1)&&(t.path_=t.path_.slice(0,-1))}},{regex:new RegExp("^https?://"+a+"/v[A-Za-z0-9_]+/b/"+i+"/o(/([^?#]*).*)?$","i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp("^https?://"+(n===Xe?"(?:storage.googleapis.com|storage.cloud.google.com)":n)+"/"+i+"/([^?#]*)","i"),indices:{bucket:1,path:2},postModify:s}],l=0;l<c.length;l++){var u=c[l],h=u.regex.exec(e);if(h){var d=h[u.indices.path];d||(d=""),r=new t(h[u.indices.bucket],d),u.postModify(r);break}}if(null==r)throw function(t){return new Ye("invalid-url","Invalid URL '"+t+"'.")}(e);return r},t}(),bn=function(){function t(t){this.promise_=Promise.reject(t)}return t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){},t}();function xn(t){return"string"==typeof t||t instanceof String}function wn(t){return Tn()&&t instanceof Blob}function Tn(){return"undefined"!=typeof Blob}function Cn(t,e,n,r){if(r<e)throw nn("Invalid value for '"+t+"'. Expected "+e+" or greater.");if(r>n)throw nn("Invalid value for '"+t+"'. Expected "+n+" or less.")}function En(t,e){var n=e.match(/^(\w+):\/\/.+/),r=e;return null==(null==n?void 0:n[1])&&(r="https://"+e),r+"/v0"+t}function Sn(t){var e=encodeURIComponent,n="?";for(var r in t)t.hasOwnProperty(r)&&(n=n+(e(r)+"=")+e(t[r])+"&");return n.slice(0,-1)}var In=function(){function t(t,e,n,r,i,o,s,a,c,l,u){var h=this;this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.url_=t,this.method_=e,this.headers_=n,this.body_=r,this.successCodes_=i.slice(),this.additionalRetryCodes_=o.slice(),this.callback_=s,this.errorCallback_=a,this.progressCallback_=l,this.timeout_=c,this.pool_=u,this.promise_=new Promise(function(t,e){h.resolve_=t,h.reject_=e,h.start_()})}return t.prototype.start_=function(){var t=this;function e(e,n){var r,i=t.resolve_,o=t.reject_,s=n.connection;if(n.wasSuccessCode)try{var a=t.callback_(s,s.getResponseText());void 0!==a?i(a):i()}catch(K_){o(K_)}else null!==s?((r=Je()).serverResponse=s.getResponseText(),o(t.errorCallback_?t.errorCallback_(s,r):r)):o(r=n.canceled?t.appDelete_?rn():tn():new Ye("retry-limit-exceeded","Max retry time for operation exceeded, please try again."))}this.canceled_?e(0,new kn(!1,null,!0)):this.backoffId_=function(e,n,r){var i=1,o=null,s=!1,a=0;function c(){return 2===a}var l=!1;function u(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];l||(l=!0,n.apply(null,t))}function h(e){o=setTimeout(function(){o=null,function(e,n){if(n)e(!1,new kn(!1,null,!0));else{var r=t.pool_.createConnection();t.pendingConnection_=r,null!==t.progressCallback_&&r.addUploadProgressListener(i),r.send(t.url_,t.method_,t.body_,t.headers_).then(function(){null!==t.progressCallback_&&r.removeUploadProgressListener(i),t.pendingConnection_=null;var n=r.getErrorCode()===gn.NO_ERROR,o=r.getStatus();if(n&&!t.isRetryStatusCode_(o)){var s=-1!==t.successCodes_.indexOf(o);e(!0,new kn(s,r))}else{var a=r.getErrorCode()===gn.ABORT;e(!1,new kn(!1,null,a))}})}function i(e){null!==t.progressCallback_&&t.progressCallback_(e.loaded,e.lengthComputable?e.total:-1)}}(d,c())},e)}function d(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(!l)if(t)u.call.apply(u,Object(He.f)([null,t],e));else{var r;c()||s?u.call.apply(u,Object(He.f)([null,t],e)):(i<64&&(i*=2),1===a?(a=2,r=0):r=1e3*(i+Math.random()),h(r))}}var p=!1;function f(t){p||(p=!0,l||(null!==o?(t||(a=2),clearTimeout(o),h(0)):t||(a=1)))}return h(0),setTimeout(function(){s=!0,f(!0)},r),f}(0,e,this.timeout_)},t.prototype.getPromise=function(){return this.promise_},t.prototype.cancel=function(t){this.canceled_=!0,this.appDelete_=t||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()},t.prototype.isRetryStatusCode_=function(t){var e=t>=500&&t<600,n=-1!==[408,429].indexOf(t),r=-1!==this.additionalRetryCodes_.indexOf(t);return e||n||r},t}(),kn=function(){return function(t,e,n){this.wasSuccessCode=t,this.connection=e,this.canceled=!!n}}();function An(){return"undefined"!=typeof BlobBuilder?BlobBuilder:"undefined"!=typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Mn(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];var n=An();if(void 0!==n){for(var r=new n,i=0;i<t.length;i++)r.append(t[i]);return r.getBlob()}if(Tn())return new Blob(t);throw new Ye("unsupported-environment","This browser doesn't seem to support creating Blobs")}var On=function(){function t(t,e){var n=0,r="";wn(t)?(this.data_=t,n=t.size,r=t.type):t instanceof ArrayBuffer?(e?this.data_=new Uint8Array(t):(this.data_=new Uint8Array(t.byteLength),this.data_.set(new Uint8Array(t))),n=this.data_.length):t instanceof Uint8Array&&(e?this.data_=t:(this.data_=new Uint8Array(t.length),this.data_.set(t)),n=t.length),this.size_=n,this.type_=r}return t.prototype.size=function(){return this.size_},t.prototype.type=function(){return this.type_},t.prototype.slice=function(e,n){if(wn(this.data_)){var r=(o=e,s=n,(i=this.data_).webkitSlice?i.webkitSlice(o,s):i.mozSlice?i.mozSlice(o,s):i.slice?i.slice(o,s):null);return null===r?null:new t(r)}var i,o,s;return new t(new Uint8Array(this.data_.buffer,e,n-e),!0)},t.getBlob=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];if(Tn()){var r=e.map(function(e){return e instanceof t?e.data_:e});return new t(Mn.apply(null,r))}var i=e.map(function(t){return xn(t)?un(cn.RAW,t).data:t.data_}),o=0;i.forEach(function(t){o+=t.byteLength});var s=new Uint8Array(o),a=0;return i.forEach(function(t){for(var e=0;e<t.length;e++)s[a++]=t[e]}),new t(s,!0)},t.prototype.uploadData=function(){return this.data_},t}();function Pn(t){var e,n;try{e=JSON.parse(t)}catch(K_){return null}return"object"!=typeof(n=e)||Array.isArray(n)?null:e}function Dn(t){var e=t.lastIndexOf("/",t.length-2);return-1===e?t:t.slice(e+1)}function Rn(t,e){return e}var Nn=function(){return function(t,e,n,r){this.server=t,this.local=e||t,this.writable=!!n,this.xform=r||Rn}}(),Ln=null;function jn(){if(Ln)return Ln;var t=[];t.push(new Nn("bucket")),t.push(new Nn("generation")),t.push(new Nn("metageneration")),t.push(new Nn("name","fullPath",!0));var e=new Nn("name");e.xform=function(t,e){return function(t){return!xn(t)||t.length<2?t:Dn(t)}(e)},t.push(e);var n=new Nn("size");return n.xform=function(t,e){return void 0!==e?Number(e):e},t.push(n),t.push(new Nn("timeCreated")),t.push(new Nn("updated")),t.push(new Nn("md5Hash",null,!0)),t.push(new Nn("cacheControl",null,!0)),t.push(new Nn("contentDisposition",null,!0)),t.push(new Nn("contentEncoding",null,!0)),t.push(new Nn("contentLanguage",null,!0)),t.push(new Nn("contentType",null,!0)),t.push(new Nn("metadata","customMetadata",!0)),Ln=t}function zn(t,e,n){var r=Pn(e);return null===r?null:function(t,e,n){for(var r={type:"file"},i=n.length,o=0;o<i;o++){var s=n[o];r[s.local]=s.xform(r,e[s.server])}return function(t,e){Object.defineProperty(t,"ref",{get:function(){var n=new vn(t.bucket,t.fullPath);return e._makeStorageReference(n)}})}(r,t),r}(t,r,n)}function Fn(t,e){for(var n={},r=e.length,i=0;i<r;i++){var o=e[i];o.writable&&(n[o.server]=t[o.local])}return JSON.stringify(n)}var Bn=function(){return function(t,e,n,r){this.url=t,this.method=e,this.handler=n,this.timeout=r,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}();function Un(t){if(!t)throw Je()}function Vn(t,e){return function(n,r){var i=zn(t,r,e);return Un(null!==i),i}}function qn(t){return function(e,n){var r;return(r=401===e.getStatus()?e.getResponseText().includes("Firebase App Check token is invalid")?new Ye("unauthorized-app","This app does not have permission to access Firebase Storage on this project."):new Ye("unauthenticated","User is not authenticated, please authenticate using Firebase Authentication and try again."):402===e.getStatus()?new Ye("quota-exceeded","Quota for bucket '"+t.bucket+"' exceeded, please view quota on https://firebase.google.com/pricing/."):403===e.getStatus()?new Ye("unauthorized","User does not have permission to access '"+t.path+"'."):n).serverResponse=n.serverResponse,r}}function Gn(t){var e=qn(t);return function(n,r){var i=e(n,r);return 404===n.getStatus()&&(i=new Ye("object-not-found","Object '"+t.path+"' does not exist.")),i.serverResponse=r.serverResponse,i}}function $n(t,e,n){var r=En(e.fullServerUrl(),t.host),i=t.maxOperationRetryTime,o=new Bn(r,"GET",Vn(t,n),i);return o.errorHandler=Gn(e),o}function Wn(t,e,n){var r=Object.assign({},n);return r.fullPath=t.path,r.size=e.size(),r.contentType||(r.contentType=function(t,e){return e&&e.type()||"application/octet-stream"}(0,e)),r}var Hn=function(){return function(t,e,n,r){this.current=t,this.total=e,this.finalized=!!n,this.metadata=r||null}}();function Zn(t,e){var n=null;try{n=t.getResponseHeader("X-Goog-Upload-Status")}catch(K_){Un(!1)}return Un(!!n&&-1!==(e||["active"]).indexOf(n)),n}var Kn=262144,Xn=function(){return function(t,e,n){if("function"==typeof t||null!=e||null!=n)this.next=t,this.error=e,this.complete=n;else{var r=t;this.next=r.next,this.error=r.error,this.complete=r.complete}}}();function Yn(t){return function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];Promise.resolve().then(function(){return t.apply(void 0,e)})}}var Qn=function(){function t(t,e,n){var r=this;void 0===n&&(n=null),this._transferred=0,this._needToFetchStatus=!1,this._needToFetchMetadata=!1,this._observers=[],this._error=void 0,this._uploadUrl=void 0,this._request=void 0,this._chunkMultiplier=1,this._resolve=void 0,this._reject=void 0,this._ref=t,this._blob=e,this._metadata=n,this._mappings=jn(),this._resumable=this._shouldDoResumable(this._blob),this._state="running",this._errorHandler=function(t){r._request=void 0,r._chunkMultiplier=1,t._codeEquals("canceled")?(r._needToFetchStatus=!0,r.completeTransitions_()):(r._error=t,r._transition("error"))},this._metadataErrorHandler=function(t){r._request=void 0,t._codeEquals("canceled")?r.completeTransitions_():(r._error=t,r._transition("error"))},this._promise=new Promise(function(t,e){r._resolve=t,r._reject=e,r._start()}),this._promise.then(null,function(){})}return t.prototype._makeProgressCallback=function(){var t=this,e=this._transferred;return function(n){return t._updateProgress(e+n)}},t.prototype._shouldDoResumable=function(t){return t.size()>262144},t.prototype._start=function(){"running"===this._state&&void 0===this._request&&(this._resumable?void 0===this._uploadUrl?this._createResumable():this._needToFetchStatus?this._fetchStatus():this._needToFetchMetadata?this._fetchMetadata():this._continueUpload():this._oneShotUpload())},t.prototype._resolveToken=function(t){var e=this;Promise.all([this._ref.storage._getAuthToken(),this._ref.storage._getAppCheckToken()]).then(function(n){var r=n[0],i=n[1];switch(e._state){case"running":t(r,i);break;case"canceling":e._transition("canceled");break;case"pausing":e._transition("paused")}})},t.prototype._createResumable=function(){var t=this;this._resolveToken(function(e,n){var r=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s=Wn(e,r,i),a={name:s.fullPath},c=En(o,t.host),l={"X-Goog-Upload-Protocol":"resumable","X-Goog-Upload-Command":"start","X-Goog-Upload-Header-Content-Length":""+r.size(),"X-Goog-Upload-Header-Content-Type":s.contentType,"Content-Type":"application/json; charset=utf-8"},u=Fn(s,n),h=new Bn(c,"POST",function(t){var e;Zn(t);try{e=t.getResponseHeader("X-Goog-Upload-URL")}catch(K_){Un(!1)}return Un(xn(e)),e},t.maxUploadRetryTime);return h.urlParams=a,h.headers=l,h.body=u,h.errorHandler=qn(e),h}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._uploadUrl=e,t._needToFetchStatus=!1,t.completeTransitions_()},t._errorHandler)})},t.prototype._fetchStatus=function(){var t=this,e=this._uploadUrl;this._resolveToken(function(n,r){var i=function(t,e,n,r){var i=new Bn(n,"POST",function(t){var e=Zn(t,["active","final"]),n=null;try{n=t.getResponseHeader("X-Goog-Upload-Size-Received")}catch(K_){Un(!1)}n||Un(!1);var i=Number(n);return Un(!isNaN(i)),new Hn(i,r.size(),"final"===e)},t.maxUploadRetryTime);return i.headers={"X-Goog-Upload-Command":"query"},i.errorHandler=qn(e),i}(t._ref.storage,t._ref._location,e,t._blob),o=t._ref.storage._makeRequest(i,n,r);t._request=o,o.getPromise().then(function(e){e=e,t._request=void 0,t._updateProgress(e.current),t._needToFetchStatus=!1,e.finalized&&(t._needToFetchMetadata=!0),t.completeTransitions_()},t._errorHandler)})},t.prototype._continueUpload=function(){var t=this,e=Kn*this._chunkMultiplier,n=new Hn(this._transferred,this._blob.size()),r=this._uploadUrl;this._resolveToken(function(i,o){var s;try{s=function(t,e,n,r,i,o,s,a){var c=new Hn(0,0);if(s?(c.current=s.current,c.total=s.total):(c.current=0,c.total=r.size()),r.size()!==c.total)throw new Ye("server-file-wrong-size","Server recorded incorrect upload file size, please retry the upload.");var l=c.total-c.current,u=l;i>0&&(u=Math.min(u,i));var h=c.current,d={"X-Goog-Upload-Command":u===l?"upload, finalize":"upload","X-Goog-Upload-Offset":""+c.current},p=r.slice(h,h+u);if(null===p)throw en();var f=new Bn(n,"POST",function(t,n){var i,s=Zn(t,["active","final"]),a=c.current+u,l=r.size();return i="final"===s?Vn(e,o)(t,n):null,new Hn(a,l,"final"===s,i)},e.maxUploadRetryTime);return f.headers=d,f.body=p.uploadData(),f.progressCallback=a||null,f.errorHandler=qn(t),f}(t._ref._location,t._ref.storage,r,t._blob,e,t._mappings,n,t._makeProgressCallback())}catch(K_){return t._error=K_,void t._transition("error")}var a=t._ref.storage._makeRequest(s,i,o);t._request=a,a.getPromise().then(function(e){t._increaseMultiplier(),t._request=void 0,t._updateProgress(e.current),e.finalized?(t._metadata=e.metadata,t._transition("success")):t.completeTransitions_()},t._errorHandler)})},t.prototype._increaseMultiplier=function(){Kn*this._chunkMultiplier<33554432&&(this._chunkMultiplier*=2)},t.prototype._fetchMetadata=function(){var t=this;this._resolveToken(function(e,n){var r=$n(t._ref.storage,t._ref._location,t._mappings),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._metadata=e,t._transition("success")},t._metadataErrorHandler)})},t.prototype._oneShotUpload=function(){var t=this;this._resolveToken(function(e,n){var r=function(t,e,n,r,i){var o=e.bucketOnlyServerUrl(),s={"X-Goog-Upload-Protocol":"multipart"},a=function(){for(var t="",e=0;e<2;e++)t+=Math.random().toString().slice(2);return t}();s["Content-Type"]="multipart/related; boundary="+a;var c=Wn(e,r,i),l=Fn(c,n),u=On.getBlob("--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+l+"\r\n--"+a+"\r\nContent-Type: "+c.contentType+"\r\n\r\n",r,"\r\n--"+a+"--");if(null===u)throw en();var h={name:c.fullPath},d=En(o,t.host),p=t.maxUploadRetryTime,f=new Bn(d,"POST",Vn(t,n),p);return f.urlParams=h,f.headers=s,f.body=u.uploadData(),f.errorHandler=qn(e),f}(t._ref.storage,t._ref._location,t._mappings,t._blob,t._metadata),i=t._ref.storage._makeRequest(r,e,n);t._request=i,i.getPromise().then(function(e){t._request=void 0,t._metadata=e,t._updateProgress(t._blob.size()),t._transition("success")},t._errorHandler)})},t.prototype._updateProgress=function(t){var e=this._transferred;this._transferred=t,this._transferred!==e&&this._notifyObservers()},t.prototype._transition=function(t){if(this._state!==t)switch(t){case"canceling":case"pausing":this._state=t,void 0!==this._request&&this._request.cancel();break;case"running":var e="paused"===this._state;this._state=t,e&&(this._notifyObservers(),this._start());break;case"paused":this._state=t,this._notifyObservers();break;case"canceled":this._error=tn(),this._state=t,this._notifyObservers();break;case"error":case"success":this._state=t,this._notifyObservers()}},t.prototype.completeTransitions_=function(){switch(this._state){case"pausing":this._transition("paused");break;case"canceling":this._transition("canceled");break;case"running":this._start()}},Object.defineProperty(t.prototype,"snapshot",{get:function(){var t=mn(this._state);return{bytesTransferred:this._transferred,totalBytes:this._blob.size(),state:t,metadata:this._metadata,task:this,ref:this._ref}},enumerable:!1,configurable:!0}),t.prototype.on=function(t,e,n,r){var i=this,o=new Xn(e,n,r);return this._addObserver(o),function(){i._removeObserver(o)}},t.prototype.then=function(t,e){return this._promise.then(t,e)},t.prototype.catch=function(t){return this.then(null,t)},t.prototype._addObserver=function(t){this._observers.push(t),this._notifyObserver(t)},t.prototype._removeObserver=function(t){var e=this._observers.indexOf(t);-1!==e&&this._observers.splice(e,1)},t.prototype._notifyObservers=function(){var t=this;this._finishPromise(),this._observers.slice().forEach(function(e){t._notifyObserver(e)})},t.prototype._finishPromise=function(){if(void 0!==this._resolve){var t=!0;switch(mn(this._state)){case fn.SUCCESS:Yn(this._resolve.bind(null,this.snapshot))();break;case fn.CANCELED:case fn.ERROR:Yn(this._reject.bind(null,this._error))();break;default:t=!1}t&&(this._resolve=void 0,this._reject=void 0)}},t.prototype._notifyObserver=function(t){switch(mn(this._state)){case fn.RUNNING:case fn.PAUSED:t.next&&Yn(t.next.bind(t,this.snapshot))();break;case fn.SUCCESS:t.complete&&Yn(t.complete.bind(t))();break;case fn.CANCELED:case fn.ERROR:t.error&&Yn(t.error.bind(t,this._error))();break;default:t.error&&Yn(t.error.bind(t,this._error))()}},t.prototype.resume=function(){var t="paused"===this._state||"pausing"===this._state;return t&&this._transition("running"),t},t.prototype.pause=function(){var t="running"===this._state;return t&&this._transition("pausing"),t},t.prototype.cancel=function(){var t="running"===this._state||"pausing"===this._state;return t&&this._transition("canceling"),t},t}(),Jn=function(){function t(t,e){this._service=t,this._location=e instanceof vn?e:vn.makeFromUrl(e,t.host)}return t.prototype.toString=function(){return"gs://"+this._location.bucket+"/"+this._location.path},t.prototype._newRef=function(e,n){return new t(e,n)},Object.defineProperty(t.prototype,"root",{get:function(){var t=new vn(this._location.bucket,"");return this._newRef(this._service,t)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this._location.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._location.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return Dn(this._location.path)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"storage",{get:function(){return this._service},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=function(t){if(0===t.length)return null;var e=t.lastIndexOf("/");return-1===e?"":t.slice(0,e)}(this._location.path);if(null===e)return null;var n=new vn(this._location.bucket,e);return new t(this._service,n)},enumerable:!1,configurable:!0}),t.prototype._throwIfRoot=function(t){if(""===this._location.path)throw on(t)},t}();function tr(t){var e={prefixes:[],items:[]};return er(t,e).then(function(){return e})}function er(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i,o;return Object(He.d)(this,function(s){switch(s.label){case 0:return[4,nr(t,{pageToken:n})];case 1:return r=s.sent(),(i=e.prefixes).push.apply(i,r.prefixes),(o=e.items).push.apply(o,r.items),null==r.nextPageToken?[3,3]:[4,er(t,e,r.nextPageToken)];case 2:s.sent(),s.label=3;case 3:return[2]}})})}function nr(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r;return Object(He.d)(this,function(i){switch(i.label){case 0:return null!=e&&"number"==typeof e.maxResults&&Cn("options.maxResults",1,1e3,e.maxResults),r=function(t,e,n,r,i){var o={};o.prefix=e.isRoot?"":e.path+"/",n&&n.length>0&&(o.delimiter=n),r&&(o.pageToken=r),i&&(o.maxResults=i);var s=En(e.bucketOnlyServerUrl(),t.host),a=t.maxOperationRetryTime,c=new Bn(s,"GET",function(t,e){return function(n,r){var i=function(t,e,n){var r=Pn(n);return null===r?null:function(t,e,n){var r={prefixes:[],items:[],nextPageToken:n.nextPageToken};if(n.prefixes)for(var i=0,o=n.prefixes;i<o.length;i++){var s=o[i].replace(/\/$/,""),a=t._makeStorageReference(new vn(e,s));r.prefixes.push(a)}if(n.items)for(var c=0,l=n.items;c<l.length;c++)a=t._makeStorageReference(new vn(e,l[c].name)),r.items.push(a);return r}(t,e,r)}(t,e,r);return Un(null!==i),i}}(t,e.bucket),a);return c.urlParams=o,c.errorHandler=qn(e),c}(t.storage,t._location,"/",(n=e||{}).pageToken,n.maxResults),[4,t.storage.makeRequestWithTokens(r)];case 1:return[2,i.sent().getPromise()]}})})}function rr(t,e){var n=function(t,e){var n=e.split("/").filter(function(t){return t.length>0}).join("/");return 0===t.length?n:t+"/"+n}(t._location.path,e),r=new vn(t._location.bucket,n);return new Jn(t.storage,r)}function ir(t){return/^[A-Za-z]+:\/\//.test(t)}function or(t,e){if(t instanceof cr){var n=t;if(null==n._bucket)throw new Ye("no-default-bucket","No default bucket found. Did you set the 'storageBucket' property when initializing the app?");var r=new Jn(n,n._bucket);return null!=e?or(r,e):r}return void 0!==e?rr(t,e):t}function sr(t,e){if(e&&ir(e)){if(t instanceof cr)return new Jn(t,e);throw nn("To use ref(service, url), the first argument must be a Storage instance.")}return or(t,e)}function ar(t,e){var n=null==e?void 0:e.storageBucket;return null==n?null:vn.makeFromBucketSpec(n,t)}var cr=function(){function t(t,e,n,r,i,o){this.app=t,this._authProvider=e,this._appCheckProvider=n,this._pool=r,this._url=i,this._firebaseVersion=o,this._bucket=null,this._host=Xe,this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=i?vn.makeFromBucketSpec(i,this._host):ar(this._host,this.app.options)}return Object.defineProperty(t.prototype,"host",{get:function(){return this._host},set:function(t){this._host=t,this._bucket=null!=this._url?vn.makeFromBucketSpec(this._url,t):ar(t,this.app.options)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this._maxUploadRetryTime},set:function(t){Cn("time",0,Number.POSITIVE_INFINITY,t),this._maxUploadRetryTime=t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this._maxOperationRetryTime},set:function(t){Cn("time",0,Number.POSITIVE_INFINITY,t),this._maxOperationRetryTime=t},enumerable:!1,configurable:!0}),t.prototype._getAuthToken=function(){return Object(He.b)(this,void 0,void 0,function(){var t,e;return Object(He.d)(this,function(n){switch(n.label){case 0:return this._overrideAuthToken?[2,this._overrideAuthToken]:(t=this._authProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:if(null!==(e=n.sent()))return[2,e.accessToken];n.label=2;case 2:return[2,null]}})})},t.prototype._getAppCheckToken=function(){return Object(He.b)(this,void 0,void 0,function(){var t;return Object(He.d)(this,function(e){switch(e.label){case 0:return(t=this._appCheckProvider.getImmediate({optional:!0}))?[4,t.getToken()]:[3,2];case 1:return[2,e.sent().token];case 2:return[2,null]}})})},t.prototype._delete=function(){return this._deleted||(this._deleted=!0,this._requests.forEach(function(t){return t.cancel()}),this._requests.clear()),Promise.resolve()},t.prototype._makeStorageReference=function(t){return new Jn(this,t)},t.prototype._makeRequest=function(t,e,n){var r=this;if(this._deleted)return new bn(rn());var i=function(t,e,n,r,i,o){var s=Sn(t.urlParams),a=t.url+s,c=Object.assign({},t.headers);return function(t,e){e&&(t["X-Firebase-GMPID"]=e)}(c,e),function(t,e){null!==e&&e.length>0&&(t.Authorization="Firebase "+e)}(c,n),function(t,e){t["X-Firebase-Storage-Version"]="webjs/"+(null!=e?e:"AppManager")}(c,o),function(t,e){null!==e&&(t["X-Firebase-AppCheck"]=e)}(c,r),new In(a,t.method,c,t.body,t.successCodes,t.additionalRetryCodes,t.handler,t.errorHandler,t.timeout,t.progressCallback,i)}(t,this._appId,e,n,this._pool,this._firebaseVersion);return this._requests.add(i),i.getPromise().then(function(){return r._requests.delete(i)},function(){return r._requests.delete(i)}),i},t.prototype.makeRequestWithTokens=function(t){return Object(He.b)(this,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return[4,Promise.all([this._getAuthToken(),this._getAppCheckToken()])];case 1:return e=n.sent(),[2,this._makeRequest(t,e[0],e[1])]}})})},t}();function lr(t,e){return sr(t=Object(Ze.o)(t),e)}var ur,hr,dr=function(){function t(t,e,n){this._delegate=t,this.task=e,this.ref=n}return Object.defineProperty(t.prototype,"bytesTransferred",{get:function(){return this._delegate.bytesTransferred},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"state",{get:function(){return this._delegate.state},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"totalBytes",{get:function(){return this._delegate.totalBytes},enumerable:!1,configurable:!0}),t}(),pr=function(){function t(t,e){this._delegate=t,this._ref=e,this.cancel=this._delegate.cancel.bind(this._delegate),this.catch=this._delegate.catch.bind(this._delegate),this.pause=this._delegate.pause.bind(this._delegate),this.resume=this._delegate.resume.bind(this._delegate)}return Object.defineProperty(t.prototype,"snapshot",{get:function(){return new dr(this._delegate.snapshot,this,this._ref)},enumerable:!1,configurable:!0}),t.prototype.then=function(t,e){var n=this;return this._delegate.then(function(e){if(t)return t(new dr(e,n,n._ref))},e)},t.prototype.on=function(t,e,n,r){var i=this,o=void 0;return e&&(o="function"==typeof e?function(t){return e(new dr(t,i,i._ref))}:{next:e.next?function(t){return e.next(new dr(t,i,i._ref))}:void 0,complete:e.complete||void 0,error:e.error||void 0}),this._delegate.on(t,o,n||void 0,r||void 0)},t}(),fr=function(){function t(t,e){this._delegate=t,this._service=e}return Object.defineProperty(t.prototype,"prefixes",{get:function(){var t=this;return this._delegate.prefixes.map(function(e){return new mr(e,t._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"items",{get:function(){var t=this;return this._delegate.items.map(function(e){return new mr(e,t._service)})},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"nextPageToken",{get:function(){return this._delegate.nextPageToken||null},enumerable:!1,configurable:!0}),t}(),mr=function(){function t(t,e){this._delegate=t,this.storage=e}return Object.defineProperty(t.prototype,"name",{get:function(){return this._delegate.name},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"bucket",{get:function(){return this._delegate.bucket},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"fullPath",{get:function(){return this._delegate.fullPath},enumerable:!1,configurable:!0}),t.prototype.toString=function(){return this._delegate.toString()},t.prototype.child=function(e){return new t(function(t,e){return rr(t,e)}(this._delegate,e),this.storage)},Object.defineProperty(t.prototype,"root",{get:function(){return new t(this._delegate.root,this.storage)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){var e=this._delegate.parent;return null==e?null:new t(e,this.storage)},enumerable:!1,configurable:!0}),t.prototype.put=function(t,e){return this._throwIfRoot("put"),new pr(function(t,e,n){return function(t,e,n){return t._throwIfRoot("uploadBytesResumable"),new Qn(t,new On(e),n)}(t=Object(Ze.o)(t),e,n)}(this._delegate,t,e),this)},t.prototype.putString=function(t,e,n){void 0===e&&(e=cn.RAW),this._throwIfRoot("putString");var r=un(e,t),i=Object(He.a)({},n);return null==i.contentType&&null!=r.contentType&&(i.contentType=r.contentType),new pr(new Qn(this._delegate,new On(r.data,!0),i),this)},t.prototype.listAll=function(){var t,e=this;return(t=this._delegate,tr(t=Object(Ze.o)(t))).then(function(t){return new fr(t,e.storage)})},t.prototype.list=function(t){var e=this;return function(t,e){return nr(t=Object(Ze.o)(t),e)}(this._delegate,t||void 0).then(function(t){return new fr(t,e.storage)})},t.prototype.getMetadata=function(){return t=this._delegate,function(t){return Object(He.b)(this,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("getMetadata"),e=$n(t.storage,t._location,jn()),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise()]}})})}(t=Object(Ze.o)(t));var t},t.prototype.updateMetadata=function(t){return function(t,e){return function(t,e){return Object(He.b)(this,void 0,void 0,function(){var n;return Object(He.d)(this,function(r){switch(r.label){case 0:return t._throwIfRoot("updateMetadata"),n=function(t,e,n,r){var i=En(e.fullServerUrl(),t.host),o=Fn(n,r),s=t.maxOperationRetryTime,a=new Bn(i,"PATCH",Vn(t,r),s);return a.headers={"Content-Type":"application/json; charset=utf-8"},a.body=o,a.errorHandler=Gn(e),a}(t.storage,t._location,e,jn()),[4,t.storage.makeRequestWithTokens(n)];case 1:return[2,r.sent().getPromise()]}})})}(t=Object(Ze.o)(t),e)}(this._delegate,t)},t.prototype.getDownloadURL=function(){return t=this._delegate,function(t){return Object(He.b)(this,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("getDownloadURL"),e=function(t,e,n){var r=En(e.fullServerUrl(),t.host),i=t.maxOperationRetryTime,o=new Bn(r,"GET",function(t,e){return function(n,r){var i=zn(t,r,e);return Un(null!==i),function(t,e,n){var r=Pn(e);if(null===r)return null;if(!xn(r.downloadTokens))return null;var i=r.downloadTokens;if(0===i.length)return null;var o=encodeURIComponent;return i.split(",").map(function(e){var r=t.fullPath;return En("/b/"+o(t.bucket)+"/o/"+o(r),n)+Sn({alt:"media",token:e})})[0]}(i,r,t.host)}}(t,n),i);return o.errorHandler=Gn(e),o}(t.storage,t._location,jn()),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise().then(function(t){if(null===t)throw new Ye("no-download-url","The given file does not have any download URLs.");return t})]}})})}(t=Object(Ze.o)(t));var t},t.prototype.delete=function(){return this._throwIfRoot("delete"),t=this._delegate,function(t){return Object(He.b)(this,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return t._throwIfRoot("deleteObject"),e=function(t,e){var n=En(e.fullServerUrl(),t.host),r=new Bn(n,"DELETE",function(t,e){},t.maxOperationRetryTime);return r.successCodes=[200,204],r.errorHandler=Gn(e),r}(t.storage,t._location),[4,t.storage.makeRequestWithTokens(e)];case 1:return[2,n.sent().getPromise()]}})})}(t=Object(Ze.o)(t));var t},t.prototype._throwIfRoot=function(t){if(""===this._delegate._location.path)throw on(t)},t}(),gr=function(){function t(t,e){this.app=t,this._delegate=e}return Object.defineProperty(t.prototype,"maxOperationRetryTime",{get:function(){return this._delegate.maxOperationRetryTime},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"maxUploadRetryTime",{get:function(){return this._delegate.maxUploadRetryTime},enumerable:!1,configurable:!0}),t.prototype.ref=function(t){if(ir(t))throw nn("ref() expected a child path but got a URL, use refFromURL instead.");return new mr(lr(this._delegate,t),this)},t.prototype.refFromURL=function(t){if(!ir(t))throw nn("refFromURL() expected a full URL but got a child path, use ref() instead.");try{vn.makeFromUrl(t,this._delegate.host)}catch(K_){throw nn("refFromUrl() expected a valid full URL but got an invalid one.")}return new mr(lr(this._delegate,t),this)},t.prototype.setMaxUploadRetryTime=function(t){this._delegate.maxUploadRetryTime=t},t.prototype.setMaxOperationRetryTime=function(t){this._delegate.maxOperationRetryTime=t},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){void 0===r&&(r={}),function(t,e,n,r){void 0===r&&(r={}),t.host="http://"+e+":"+n;var i=r.mockUserToken;i&&(t._overrideAuthToken="string"==typeof i?i:Object(Ze.j)(i,t.app.options.projectId))}(t,e,n,r)}(this._delegate,t,e,n)},t}();function _r(t){const e=function(t){return new yt.a(e=>{const n=t=>e.next(t);n(t.snapshot);const r=t.on("state_changed",n);return t.then(t=>{n(t),e.complete()},r=>{n(t.snapshot),(t=>{e.error(t)})(r)}),function(){r()}}).pipe(function(t,e=_t.a){return n=>n.lift(new qe(t,e))}(0))}(t);return{task:t,then:t.then.bind(t),catch:t.catch.bind(t),pause:t.pause.bind(t),cancel:t.cancel.bind(t),resume:t.resume.bind(t),snapshotChanges:()=>e,percentageChanges:()=>e.pipe(Object(xt.a)(t=>t.bytesTransferred/t.totalBytes*100))}}function yr(t,e,n){return{getDownloadURL:()=>Object(vt.a)(void 0).pipe(Object(Gt.b)(e.outsideAngular),Et(()=>t.getDownloadURL()),n),getMetadata:()=>Object(vt.a)(void 0).pipe(Object(Gt.b)(e.outsideAngular),Et(()=>t.getMetadata()),n),delete:()=>Object(Tt.a)(t.delete()),child:r=>yr(t.child(r),e,n),updateMetadata:e=>Object(Tt.a)(t.updateMetadata(e)),put:(e,n)=>_r(t.put(e,n)),putString:(e,n,r)=>_r(t.putString(e,n,r)),listAll:()=>Object(Tt.a)(t.listAll())}}hr={TaskState:fn,TaskEvent:{STATE_CHANGED:"state_changed"},StringFormat:cn,Storage:cr,Reference:mr},(ur=We.a).INTERNAL.registerComponent(new Ke.a("storage",function(t,e){var n=e.instanceIdentifier,r=t.getProvider("app").getImmediate(),i=t.getProvider("auth-internal"),o=t.getProvider("app-check-internal");return new gr(r,new cr(r,i,o,new yn,n,We.a.SDK_VERSION))},"PUBLIC").setServiceProps(hr).setMultipleInstances(!0)),ur.registerVersion("@firebase/storage","0.7.1");const vr=new r.r("angularfire2.storageBucket"),br=new r.r("angularfire2.storage.maxUploadRetryTime"),xr=new r.r("angularfire2.storage.maxOperationRetryTime");let wr=(()=>{class t{constructor(t,e,n,r,i,o,s){this.schedulers=new gt.d(i),this.keepUnstableUntilFirst=Object(gt.h)(this.schedulers);const a=Object(gt.g)(t,i,e);this.storage=Object(gt.f)(`${a.name}.storage.${n}`,"AngularFireStorage",a,()=>{const t=i.runOutsideAngular(()=>a.storage(n||void 0));return o&&t.setMaxUploadRetryTime(o),s&&t.setMaxOperationRetryTime(s),t},[o,s])}ref(t){return yr(this.storage.ref(t),this.schedulers,this.keepUnstableUntilFirst)}refFromURL(t){return yr(this.storage.refFromURL(t),this.schedulers,this.keepUnstableUntilFirst)}upload(t,e,n){return yr(this.storage.ref(t),this.schedulers,this.keepUnstableUntilFirst).put(e,n)}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(gt.c),r.Rb(gt.b,8),r.Rb(vr,8),r.Rb(r.C),r.Rb(r.A),r.Rb(br,8),r.Rb(xr,8))},t.\u0275prov=r.Gb({factory:function(){return new t(r.Rb(gt.c),r.Rb(gt.b,8),r.Rb(vr,8),r.Rb(r.C),r.Rb(r.A),r.Rb(br,8),r.Rb(xr,8))},token:t,providedIn:"any"}),t})(),Tr=(()=>{class t{}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)}}),t})(),Cr=(()=>{class t{}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)},providers:[wr],imports:[Tr]}),t})();var Er=n("bHdf");function Sr(...t){return Object(Er.a)(1)(Object(vt.a)(...t))}var Ir=n("z+Ro");function kr(...t){const e=t[t.length-1];return Object(Ir.a)(e)?(t.pop(),n=>Sr(t,n,e)):e=>Sr(t,e)}function Ar(){return t=>t.lift(new Mr)}class Mr{call(t,e){return e.subscribe(new Or(t))}}class Or extends kt.a{constructor(t){super(t),this.hasPrev=!1}_next(t){let e;this.hasPrev?e=[this.prev,t]:this.hasPrev=!0,this.prev=t,e&&this.destination.next(e)}}var Pr=n("q/0M"),Dr=function(t,e){return(Dr=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&(t[n]=e[n])})(t,e)};function Rr(t){var e="function"==typeof Symbol&&Symbol.iterator,n=e&&t[e],r=0;if(n)return n.call(t);if(t&&"number"==typeof t.length)return{next:function(){return t&&r>=t.length&&(t=void 0),{value:t&&t[r++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}var Nr,Lr="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},jr=jr||{},zr=Lr||self;function Fr(){}function Br(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Ur(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Vr="closure_uid_"+(1e9*Math.random()>>>0),qr=0;function Gr(t,e,n){return t.call.apply(t.bind,arguments)}function $r(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Wr(t,e,n){return(Wr=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Gr:$r).apply(null,arguments)}function Hr(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function Zr(t,e){function n(){}n.prototype=e.prototype,t.Z=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.Vb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function Kr(){this.s=this.s,this.o=this.o}var Xr={};Kr.prototype.s=!1,Kr.prototype.na=function(){if(!this.s&&(this.s=!0,this.M(),0)){var t=function(t){return Object.prototype.hasOwnProperty.call(t,Vr)&&t[Vr]||(t[Vr]=++qr)}(this);delete Xr[t]}},Kr.prototype.M=function(){if(this.o)for(;this.o.length;)this.o.shift()()};var Yr=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Qr=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i="string"==typeof t?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Jr(t){return Array.prototype.concat.apply([],arguments)}function ti(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function ei(t){return/^[\s\xa0]*$/.test(t)}var ni,ri=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function ii(t,e){return-1!=t.indexOf(e)}function oi(t,e){return t<e?-1:t>e?1:0}t:{var si=zr.navigator;if(si){var ai=si.userAgent;if(ai){ni=ai;break t}}ni=""}function ci(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function li(t){var e={};for(var n in t)e[n]=t[n];return e}var ui="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function hi(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<ui.length;o++)n=ui[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function di(t){return di[" "](t),t}di[" "]=Fr;var pi,fi,mi=ii(ni,"Opera"),gi=ii(ni,"Trident")||ii(ni,"MSIE"),_i=ii(ni,"Edge"),yi=_i||gi,vi=ii(ni,"Gecko")&&!(ii(ni.toLowerCase(),"webkit")&&!ii(ni,"Edge"))&&!(ii(ni,"Trident")||ii(ni,"MSIE"))&&!ii(ni,"Edge"),bi=ii(ni.toLowerCase(),"webkit")&&!ii(ni,"Edge");function xi(){var t=zr.document;return t?t.documentMode:void 0}t:{var wi="",Ti=(fi=ni,vi?/rv:([^\);]+)(\)|;)/.exec(fi):_i?/Edge\/([\d\.]+)/.exec(fi):gi?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(fi):bi?/WebKit\/(\S+)/.exec(fi):mi?/(?:Version)[ \/]?(\S+)/.exec(fi):void 0);if(Ti&&(wi=Ti?Ti[1]:""),gi){var Ci=xi();if(null!=Ci&&Ci>parseFloat(wi)){pi=String(Ci);break t}}pi=wi}var Ei={};var Si=zr.document&&gi&&(xi()||parseInt(pi,10))||void 0,Ii=function(){if(!zr.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{zr.addEventListener("test",Fr,e),zr.removeEventListener("test",Fr,e)}catch(n){}return t}();function ki(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}function Ai(t,e){if(ki.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(vi){t:{try{di(e.nodeName);var i=!0;break t}catch(o){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:Mi[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&Ai.Z.h.call(this)}}ki.prototype.h=function(){this.defaultPrevented=!0},Zr(Ai,ki);var Mi={2:"touch",3:"pen",4:"mouse"};Ai.prototype.h=function(){Ai.Z.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var Oi="closure_listenable_"+(1e6*Math.random()|0),Pi=0;function Di(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.ia=i,this.key=++Pi,this.ca=this.fa=!1}function Ri(t){t.ca=!0,t.listener=null,t.proxy=null,t.src=null,t.ia=null}function Ni(t){this.src=t,this.g={},this.h=0}function Li(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],o=Yr(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(Ri(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function ji(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ca&&o.listener==e&&o.capture==!!n&&o.ia==r)return i}return-1}Ni.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.g[o])||(t=this.g[o]=[],this.h++);var s=ji(t,e,r,i);return-1<s?(e=t[s],n||(e.fa=!1)):((e=new Di(e,this.src,o,!!r,i)).fa=n,t.push(e)),e};var zi="closure_lm_"+(1e6*Math.random()|0),Fi={};function Bi(t,e,n,r,i){if(r&&r.once)return Vi(t,e,n,r,i);if(Array.isArray(e)){for(var o=0;o<e.length;o++)Bi(t,e[o],n,r,i);return null}return n=Ki(n),t&&t[Oi]?t.N(e,n,Ur(r)?!!r.capture:!!r,i):Ui(t,e,n,!1,r,i)}function Ui(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var s=Ur(i)?!!i.capture:!!i,a=Hi(t);if(a||(t[zi]=a=new Ni(t)),(n=a.add(e,n,r,s,o)).proxy)return n;if(r=function(){var t=Wi;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Ii||(i=s),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent($i(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Vi(t,e,n,r,i){if(Array.isArray(e)){for(var o=0;o<e.length;o++)Vi(t,e[o],n,r,i);return null}return n=Ki(n),t&&t[Oi]?t.O(e,n,Ur(r)?!!r.capture:!!r,i):Ui(t,e,n,!0,r,i)}function qi(t,e,n,r,i){if(Array.isArray(e))for(var o=0;o<e.length;o++)qi(t,e[o],n,r,i);else r=Ur(r)?!!r.capture:!!r,n=Ki(n),t&&t[Oi]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=ji(o=t.g[e],n,r,i))&&(Ri(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.g[e],t.h--))):t&&(t=Hi(t))&&(e=t.g[e.toString()],t=-1,e&&(t=ji(e,n,r,i)),(n=-1<t?e[t]:null)&&Gi(n))}function Gi(t){if("number"!=typeof t&&t&&!t.ca){var e=t.src;if(e&&e[Oi])Li(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent($i(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Hi(e))?(Li(n,t),0==n.h&&(n.src=null,e[zi]=null)):Ri(t)}}}function $i(t){return t in Fi?Fi[t]:Fi[t]="on"+t}function Wi(t,e){if(t.ca)t=!0;else{e=new Ai(e,this);var n=t.listener,r=t.ia||t.src;t.fa&&Gi(t),t=n.call(r,e)}return t}function Hi(t){return(t=t[zi])instanceof Ni?t:null}var Zi="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ki(t){return"function"==typeof t?t:(t[Zi]||(t[Zi]=function(e){return t.handleEvent(e)}),t[Zi])}function Xi(){Kr.call(this),this.i=new Ni(this),this.P=this,this.I=null}function Yi(t,e){var n,r=t.I;if(r)for(n=[];r;r=r.I)n.push(r);if(t=t.P,r=e.type||e,"string"==typeof e)e=new ki(e,t);else if(e instanceof ki)e.target=e.target||t;else{var i=e;hi(e=new ki(r,t),i)}if(i=!0,n)for(var o=n.length-1;0<=o;o--){var s=e.g=n[o];i=Qi(s,r,!0,e)&&i}if(i=Qi(s=e.g=t,r,!0,e)&&i,i=Qi(s,r,!1,e)&&i,n)for(o=0;o<n.length;o++)i=Qi(s=e.g=n[o],r,!1,e)&&i}function Qi(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var s=e[o];if(s&&!s.ca&&s.capture==n){var a=s.listener,c=s.ia||s.src;s.fa&&Li(t.i,s),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}Zr(Xi,Kr),Xi.prototype[Oi]=!0,Xi.prototype.removeEventListener=function(t,e,n,r){qi(this,t,e,n,r)},Xi.prototype.M=function(){if(Xi.Z.M.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)Ri(n[r]);delete e.g[t],e.h--}}this.I=null},Xi.prototype.N=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Xi.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ji=zr.JSON.stringify;function to(){var t=co,e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var eo,no=function(){function t(){this.h=this.g=null}return t.prototype.add=function(t,e){var n=ro.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n},t}(),ro=new(function(){function t(t,e){this.i=t,this.j=e,this.h=0,this.g=null}return t.prototype.get=function(){var t;return 0<this.h?(this.h--,this.g=(t=this.g).next,t.next=null):t=this.i(),t},t}())(function(){return new io},function(t){return t.reset()}),io=function(){function t(){this.next=this.g=this.h=null}return t.prototype.set=function(t,e){this.h=t,this.g=e,this.next=null},t.prototype.reset=function(){this.next=this.g=this.h=null},t}();function oo(t){zr.setTimeout(function(){throw t},0)}function so(t,e){eo||function(){var t=zr.Promise.resolve(void 0);eo=function(){t.then(lo)}}(),ao||(eo(),ao=!0),co.add(t,e)}var ao=!1,co=new no;function lo(){for(var t;t=to();){try{t.h.call(t.g)}catch(n){oo(n)}var e=ro;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}ao=!1}function uo(t,e){Xi.call(this),this.h=t||1,this.g=e||zr,this.j=Wr(this.kb,this),this.l=Date.now()}function ho(t){t.da=!1,t.S&&(t.g.clearTimeout(t.S),t.S=null)}function po(t,e,n){if("function"==typeof t)n&&(t=Wr(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Wr(t.handleEvent,t)}return 2147483647<Number(e)?-1:zr.setTimeout(t,e||0)}function fo(t){t.g=po(function(){t.g=null,t.i&&(t.i=!1,fo(t))},t.j);var e=t.h;t.h=null,t.m.apply(null,e)}Zr(uo,Xi),(Nr=uo.prototype).da=!1,Nr.S=null,Nr.kb=function(){if(this.da){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.S=this.g.setTimeout(this.j,this.h-t):(this.S&&(this.g.clearTimeout(this.S),this.S=null),Yi(this,"tick"),this.da&&(ho(this),this.start()))}},Nr.start=function(){this.da=!0,this.S||(this.S=this.g.setTimeout(this.j,this.h),this.l=Date.now())},Nr.M=function(){uo.Z.M.call(this),ho(this),delete this.g};var mo=function(t){function e(e,n){var r=t.call(this)||this;return r.m=e,r.j=n,r.h=null,r.i=!1,r.g=null,r}return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function n(){this.constructor=t}Dr(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}(e,t),e.prototype.l=function(t){this.h=arguments,this.g?this.i=!0:fo(this)},e.prototype.M=function(){t.prototype.M.call(this),this.g&&(zr.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)},e}(Kr);function go(t){Kr.call(this),this.h=t,this.g={}}Zr(go,Kr);var _o=[];function yo(t,e,n,r){Array.isArray(n)||(n&&(_o[0]=n.toString()),n=_o);for(var i=0;i<n.length;i++){var o=Bi(e,n[i],r||t.handleEvent,!1,t.h||t);if(!o)break;t.g[o.key]=o}}function vo(t){ci(t.g,function(t,e){this.g.hasOwnProperty(e)&&Gi(t)},t),t.g={}}function bo(){this.g=!0}function xo(t,e,n,r){t.info(function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var o=i[0];if("noop"!=o&&"stop"!=o&&"close"!=o)for(var s=1;s<i.length;s++)i[s]=""}}}return Ji(n)}catch(a){return e}}(t,n)+(r?" "+r:"")})}go.prototype.M=function(){go.Z.M.call(this),vo(this)},go.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},bo.prototype.Aa=function(){this.g=!1},bo.prototype.info=function(){};var wo={},To=null;function Co(){return To=To||new Xi}function Eo(t){ki.call(this,wo.Ma,t)}function So(t){var e=Co();Yi(e,new Eo(e,t))}function Io(t,e){ki.call(this,wo.STAT_EVENT,t),this.stat=e}function ko(t){var e=Co();Yi(e,new Io(e,t))}function Ao(t,e){ki.call(this,wo.Na,t),this.size=e}function Mo(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return zr.setTimeout(function(){t()},e)}wo.Ma="serverreachability",Zr(Eo,ki),wo.STAT_EVENT="statevent",Zr(Io,ki),wo.Na="timingevent",Zr(Ao,ki);var Oo={NO_ERROR:0,lb:1,yb:2,xb:3,sb:4,wb:5,zb:6,Ja:7,TIMEOUT:8,Cb:9},Po={qb:"complete",Mb:"success",Ka:"error",Ja:"abort",Eb:"ready",Fb:"readystatechange",TIMEOUT:"timeout",Ab:"incrementaldata",Db:"progress",tb:"downloadprogress",Ub:"uploadprogress"};function Do(){}function Ro(){}Do.prototype.h=null;var No,Lo={OPEN:"a",pb:"b",Ka:"c",Bb:"d"};function jo(){ki.call(this,"d")}function zo(){ki.call(this,"c")}function Fo(){}function Bo(t,e,n,r){this.l=t,this.j=e,this.m=n,this.X=r||1,this.V=new go(this),this.P=Vo,this.W=new uo(t=yi?125:void 0),this.H=null,this.i=!1,this.s=this.A=this.v=this.K=this.F=this.Y=this.B=null,this.D=[],this.g=null,this.C=0,this.o=this.u=null,this.N=-1,this.I=!1,this.O=0,this.L=null,this.aa=this.J=this.$=this.U=!1,this.h=new Uo}function Uo(){this.i=null,this.g="",this.h=!1}Zr(jo,ki),Zr(zo,ki),Zr(Fo,Do),Fo.prototype.g=function(){return new XMLHttpRequest},Fo.prototype.i=function(){return{}},No=new Fo;var Vo=45e3,qo={},Go={};function $o(t,e,n){t.K=1,t.v=fs(cs(e)),t.s=n,t.U=!0,Wo(t,null)}function Wo(t,e){t.F=Date.now(),Xo(t),t.A=cs(t.v);var n=t.A,r=t.X;Array.isArray(r)||(r=[String(r)]),Is(n.h,"t",r),t.C=0,n=t.l.H,t.h=new Uo,t.g=ka(t.l,n?e:null,!t.s),0<t.O&&(t.L=new mo(Wr(t.Ia,t,t.g),t.O)),yo(t.V,t.g,"readystatechange",t.gb),e=t.H?li(t.H):{},t.s?(t.u||(t.u="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ea(t.A,t.u,t.s,e)):(t.u="GET",t.g.ea(t.A,t.u,null,e)),So(1),function(t,e,n,r,i,o){t.info(function(){if(t.g)if(o)for(var s="",a=o.split("&"),c=0;c<a.length;c++){var l=a[c].split("=");if(1<l.length){var u=l[0];l=l[1];var h=u.split("_");s=2<=h.length&&"type"==h[1]?s+(u+"=")+l+"&":s+(u+"=redacted&")}}else s=null;else s=o;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+s})}(t.j,t.u,t.A,t.m,t.X,t.s)}function Ho(t){return!!t.g&&"GET"==t.u&&2!=t.K&&t.l.Ba}function Zo(t,e,n){for(var r,i=!0;!t.I&&t.C<n.length;){if((r=Ko(t,n))==Go){4==e&&(t.o=4,ko(14),i=!1),xo(t.j,t.m,null,"[Incomplete Response]");break}if(r==qo){t.o=4,ko(15),xo(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}xo(t.j,t.m,r,null),es(t,r)}Ho(t)&&r!=Go&&r!=qo&&(t.h.g="",t.C=0),4!=e||0!=n.length||t.h.h||(t.o=1,ko(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.aa&&(t.aa=!0,(e=t.l).g==t&&e.$&&!e.L&&(e.h.info("Great, no buffering proxy detected. Bytes received: "+n.length),ba(e),e.L=!0,ko(11))):(xo(t.j,t.m,n,"[Invalid Chunked Response]"),ts(t),Jo(t))}function Ko(t,e){var n=t.C,r=e.indexOf("\n",n);return-1==r?Go:(n=Number(e.substring(n,r)),isNaN(n)?qo:(r+=1)+n>e.length?Go:(e=e.substr(r,n),t.C=r+n,e))}function Xo(t){t.Y=Date.now()+t.P,Yo(t,t.P)}function Yo(t,e){if(null!=t.B)throw Error("WatchDog timer not null");t.B=Mo(Wr(t.eb,t),e)}function Qo(t){t.B&&(zr.clearTimeout(t.B),t.B=null)}function Jo(t){0==t.l.G||t.I||Ta(t.l,t)}function ts(t){Qo(t);var e=t.L;e&&"function"==typeof e.na&&e.na(),t.L=null,ho(t.W),vo(t.V),t.g&&(e=t.g,t.g=null,e.abort(),e.na())}function es(t,e){try{var n=t.l;if(0!=n.G&&(n.g==t||Rs(n.i,t)))if(n.I=t.N,!t.J&&Rs(n.i,t)&&3==n.G){try{var r=n.Ca.g.parse(e)}catch(o){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.F+3e3<t.F))break t;wa(n),ha(n)}va(n),ko(18)}}else n.ta=i[1],0<n.ta-n.U&&37500>i[2]&&n.N&&0==n.A&&!n.v&&(n.v=Mo(Wr(n.ab,n),6e3));if(1>=Ds(n.i)&&n.ka){try{n.ka()}catch(o){}n.ka=void 0}}else Ea(n,11)}else if((t.J||n.g==t)&&wa(n),!ei(e))for(i=n.Ca.g.parse(e),e=0;e<i.length;e++){var o=i[e];if(n.U=o[0],o=o[1],2==n.G)if("c"==o[0]){n.J=o[1],n.la=o[2];var s=o[3];null!=s&&(n.ma=s,n.h.info("VER="+n.ma));var a=o[4];null!=a&&(n.za=a,n.h.info("SVER="+n.za));var c=o[5];null!=c&&"number"==typeof c&&0<c&&(n.K=r=1.5*c,n.h.info("backChannelRequestTimeoutMs_="+r)),r=n;var l=t.g;if(l){var u=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(u){var h=r.i;!h.g&&(ii(u,"spdy")||ii(u,"quic")||ii(u,"h2"))&&(h.j=h.l,h.g=new Set,h.h&&(Ns(h,h.h),h.h=null))}if(r.D){var d=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;d&&(r.sa=d,ps(r.F,r.D,d))}}n.G=3,n.j&&n.j.xa(),n.$&&(n.O=Date.now()-t.F,n.h.info("Handshake RTT: "+n.O+"ms"));var p=t;if((r=n).oa=Ia(r,r.H?r.la:null,r.W),p.J){Ls(r.i,p);var f=p,m=r.K;m&&f.setTimeout(m),f.B&&(Qo(f),Xo(f)),r.g=p}else ya(r);0<n.l.length&&fa(n)}else"stop"!=o[0]&&"close"!=o[0]||Ea(n,7);else 3==n.G&&("stop"==o[0]||"close"==o[0]?"stop"==o[0]?Ea(n,7):ua(n):"noop"!=o[0]&&n.j&&n.j.wa(o),n.A=0)}So(4)}catch(o){}}function ns(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(Br(t)||"string"==typeof t)Qr(t,e,void 0);else{if(t.T&&"function"==typeof t.T)var n=t.T();else if(t.R&&"function"==typeof t.R)n=void 0;else if(Br(t)||"string"==typeof t){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.R&&"function"==typeof t.R)return t.R();if("string"==typeof t)return t.split("");if(Br(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function rs(t,e){this.h={},this.g=[],this.i=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof rs)for(n=t.T(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function is(t){if(t.i!=t.g.length){for(var e=0,n=0;e<t.g.length;){var r=t.g[e];os(t.h,r)&&(t.g[n++]=r),e++}t.g.length=n}if(t.i!=t.g.length){var i={};for(n=e=0;e<t.g.length;)os(i,r=t.g[e])||(t.g[n++]=r,i[r]=1),e++;t.g.length=n}}function os(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(Nr=Bo.prototype).setTimeout=function(t){this.P=t},Nr.gb=function(t){t=t.target;var e=this.L;e&&3==oa(t)?e.l():this.Ia(t)},Nr.Ia=function(t){try{if(t==this.g)t:{var e=oa(this.g),n=this.g.Da(),r=this.g.ba();if(!(3>e)&&(3!=e||yi||this.g&&(this.h.h||this.g.ga()||sa(this.g)))){this.I||4!=e||7==n||So(8==n||0>=r?3:2),Qo(this);var i=this.g.ba();this.N=i;e:if(Ho(this)){var o=sa(this.g);t="";var s=o.length,a=4==oa(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){ts(this),Jo(this);var c="";break e}this.h.i=new zr.TextDecoder}for(n=0;n<s;n++)this.h.h=!0,t+=this.h.i.decode(o[n],{stream:a&&n==s-1});o.splice(0,s),this.h.g+=t,this.C=0,c=this.h.g}else c=this.g.ga();if(this.i=200==i,function(t,e,n,r,i,o,s){t.info(function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+o+" "+s})}(this.j,this.u,this.A,this.m,this.X,e,i),this.i){if(this.$&&!this.J){e:{if(this.g){var l,u=this.g;if((l=u.g?u.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!ei(l)){var h=l;break e}}h=null}if(!(i=h)){this.i=!1,this.o=3,ko(12),ts(this),Jo(this);break t}xo(this.j,this.m,i,"Initial handshake response via X-HTTP-Initial-Response"),this.J=!0,es(this,i)}this.U?(Zo(this,e,c),yi&&this.i&&3==e&&(yo(this.V,this.W,"tick",this.fb),this.W.start())):(xo(this.j,this.m,c,null),es(this,c)),4==e&&ts(this),this.i&&!this.I&&(4==e?Ta(this.l,this):(this.i=!1,Xo(this)))}else 400==i&&0<c.indexOf("Unknown SID")?(this.o=3,ko(12)):(this.o=0,ko(13)),ts(this),Jo(this)}}}catch(e){}},Nr.fb=function(){if(this.g){var t=oa(this.g),e=this.g.ga();this.C<e.length&&(Qo(this),Zo(this,t,e),this.i&&4!=t&&Xo(this))}},Nr.cancel=function(){this.I=!0,ts(this)},Nr.eb=function(){this.B=null;var t=Date.now();0<=t-this.Y?(function(t,e){t.info(function(){return"TIMEOUT: "+e})}(this.j,this.A),2!=this.K&&(So(3),ko(17)),ts(this),this.o=2,Jo(this)):Yo(this,this.Y-t)},(Nr=rs.prototype).R=function(){is(this);for(var t=[],e=0;e<this.g.length;e++)t.push(this.h[this.g[e]]);return t},Nr.T=function(){return is(this),this.g.concat()},Nr.get=function(t,e){return os(this.h,t)?this.h[t]:e},Nr.set=function(t,e){os(this.h,t)||(this.i++,this.g.push(t)),this.h[t]=e},Nr.forEach=function(t,e){for(var n=this.T(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var ss=/^(?:([^:/?#.]+):)?(?:\/\/(?:([^\\/?#]*)@)?([^\\/?#]*?)(?::([0-9]+))?(?=[\\/?#]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function as(t,e){if(this.i=this.s=this.j="",this.m=null,this.o=this.l="",this.g=!1,t instanceof as){this.g=void 0!==e?e:t.g,ls(this,t.j),this.s=t.s,us(this,t.i),hs(this,t.m),this.l=t.l,e=t.h;var n=new Ts;n.i=e.i,e.g&&(n.g=new rs(e.g),n.h=e.h),ds(this,n),this.o=t.o}else t&&(n=String(t).match(ss))?(this.g=!!e,ls(this,n[1]||"",!0),this.s=ms(n[2]||""),us(this,n[3]||"",!0),hs(this,n[4]),this.l=ms(n[5]||"",!0),ds(this,n[6]||"",!0),this.o=ms(n[7]||"")):(this.g=!!e,this.h=new Ts(null,this.g))}function cs(t){return new as(t)}function ls(t,e,n){t.j=n?ms(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function us(t,e,n){t.i=n?ms(e,!0):e}function hs(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function ds(t,e,n){e instanceof Ts?(t.h=e,function(t,e){e&&!t.j&&(Cs(t),t.i=null,t.g.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(Es(this,e),Is(this,n,t))},t)),t.j=e}(t.h,t.g)):(n||(e=gs(e,xs)),t.h=new Ts(e,t.g))}function ps(t,e,n){t.h.set(e,n)}function fs(t){return ps(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function ms(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function gs(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,_s),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function _s(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}as.prototype.toString=function(){var t=[],e=this.j;e&&t.push(gs(e,ys,!0),":");var n=this.i;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(gs(e,ys,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.i&&"/"!=n.charAt(0)&&t.push("/"),t.push(gs(n,"/"==n.charAt(0)?bs:vs,!0))),(n=this.h.toString())&&t.push("?",n),(n=this.o)&&t.push("#",gs(n,ws)),t.join("")};var ys=/[#\/\?@]/g,vs=/[#\?:]/g,bs=/[#\?]/g,xs=/[#\?@]/g,ws=/#/g;function Ts(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Cs(t){t.g||(t.g=new rs,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function Es(t,e){Cs(t),e=ks(t,e),os(t.g.h,e)&&(t.i=null,t.h-=t.g.get(e).length,os((t=t.g).h,e)&&(delete t.h[e],t.i--,t.g.length>2*t.i&&is(t)))}function Ss(t,e){return Cs(t),e=ks(t,e),os(t.g.h,e)}function Is(t,e,n){Es(t,e),0<n.length&&(t.i=null,t.g.set(ks(t,e),ti(n)),t.h+=n.length)}function ks(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(Nr=Ts.prototype).add=function(t,e){Cs(this),this.i=null,t=ks(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},Nr.forEach=function(t,e){Cs(this),this.g.forEach(function(n,r){Qr(n,function(n){t.call(e,n,r,this)},this)},this)},Nr.T=function(){Cs(this);for(var t=this.g.R(),e=this.g.T(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},Nr.R=function(t){Cs(this);var e=[];if("string"==typeof t)Ss(this,t)&&(e=Jr(e,this.g.get(ks(this,t))));else{t=this.g.R();for(var n=0;n<t.length;n++)e=Jr(e,t[n])}return e},Nr.set=function(t,e){return Cs(this),this.i=null,Ss(this,t=ks(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},Nr.get=function(t,e){return t&&0<(t=this.R(t)).length?String(t[0]):e},Nr.toString=function(){if(this.i)return this.i;if(!this.g)return"";for(var t=[],e=this.g.T(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.R(r);for(var o=0;o<r.length;o++){var s=i;""!==r[o]&&(s+="="+encodeURIComponent(String(r[o]))),t.push(s)}}return this.i=t.join("&")};var As=function(){return function(t,e){this.h=t,this.g=e}}();function Ms(t){this.l=t||Os,t=zr.PerformanceNavigationTiming?0<(t=zr.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(zr.g&&zr.g.Ea&&zr.g.Ea()&&zr.g.Ea().Zb),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var Os=10;function Ps(t){return!!t.h||!!t.g&&t.g.size>=t.j}function Ds(t){return t.h?1:t.g?t.g.size:0}function Rs(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function Ns(t,e){t.g?t.g.add(e):t.h=e}function Ls(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function js(t){var e,n;if(null!=t.h)return t.i.concat(t.h.D);if(null!=t.g&&0!==t.g.size){var r=t.i;try{for(var i=Rr(t.g.values()),o=i.next();!o.done;o=i.next())r=r.concat(o.value.D)}catch(s){e={error:s}}finally{try{o&&!o.done&&(n=i.return)&&n.call(i)}finally{if(e)throw e.error}}return r}return ti(t.i)}function zs(){}function Fs(){this.g=new zs}function Bs(t,e,n){var r=n||"";try{ns(t,function(t,n){var i=t;Ur(t)&&(i=Ji(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(K_){throw e.push(r+"type="+encodeURIComponent("_badmap")),K_}}function Us(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(o){}}function Vs(t){this.l=t.$b||null,this.j=t.ib||!1}function qs(t,e){Xi.call(this),this.D=t,this.u=e,this.m=void 0,this.readyState=Gs,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}Ms.prototype.cancel=function(){var t,e;if(this.i=js(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){try{for(var n=Rr(this.g.values()),r=n.next();!r.done;r=n.next())r.value.cancel()}catch(i){t={error:i}}finally{try{r&&!r.done&&(e=n.return)&&e.call(n)}finally{if(t)throw t.error}}this.g.clear()}},zs.prototype.stringify=function(t){return zr.JSON.stringify(t,void 0)},zs.prototype.parse=function(t){return zr.JSON.parse(t,void 0)},Zr(Vs,Do),Vs.prototype.g=function(){return new qs(this.l,this.j)},Vs.prototype.i=function(t){return function(){return t}}({}),Zr(qs,Xi);var Gs=0;function $s(t){t.j.read().then(t.Sa.bind(t)).catch(t.ha.bind(t))}function Ws(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Hs(t)}function Hs(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(Nr=qs.prototype).open=function(t,e){if(this.readyState!=Gs)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Hs(this)},Nr.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;var e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.D||zr).fetch(new Request(this.B,e)).then(this.Va.bind(this),this.ha.bind(this))},Nr.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted."),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,Ws(this)),this.readyState=Gs},Nr.Va=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Hs(this)),this.g&&(this.readyState=3,Hs(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ta.bind(this),this.ha.bind(this));else if(void 0!==zr.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;$s(this)}else t.text().then(this.Ua.bind(this),this.ha.bind(this))},Nr.Sa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?Ws(this):Hs(this),3==this.readyState&&$s(this)}},Nr.Ua=function(t){this.g&&(this.response=this.responseText=t,Ws(this))},Nr.Ta=function(t){this.g&&(this.response=t,Ws(this))},Nr.ha=function(){this.g&&Ws(this)},Nr.setRequestHeader=function(t,e){this.v.append(t,e)},Nr.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},Nr.getAllResponseHeaders=function(){if(!this.h)return"";for(var t=[],e=this.h.entries(),n=e.next();!n.done;)t.push((n=n.value)[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(qs.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Zs=zr.JSON.parse;function Ks(t){Xi.call(this),this.headers=new rs,this.u=t||null,this.h=!1,this.C=this.g=null,this.H="",this.m=0,this.j="",this.l=this.F=this.v=this.D=!1,this.B=0,this.A=null,this.J=Xs,this.K=this.L=!1}Zr(Ks,Xi);var Xs="",Ys=/^https?$/i,Qs=["POST","PUT"];function Js(t){return"content-type"==t.toLowerCase()}function ta(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,ea(t),ra(t)}function ea(t){t.D||(t.D=!0,Yi(t,"complete"),Yi(t,"error"))}function na(t){if(t.h&&void 0!==jr&&(!t.C[1]||4!=oa(t)||2!=t.ba()))if(t.v&&4==oa(t))po(t.Fa,0,t);else if(Yi(t,"readystatechange"),4==oa(t)){t.h=!1;try{var e,n=t.ba();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.H).match(ss)[1]||null;if(!o&&zr.self&&zr.self.location){var s=zr.self.location.protocol;o=s.substr(0,s.length-1)}i=!Ys.test(o?o.toLowerCase():"")}e=i}if(e)Yi(t,"complete"),Yi(t,"success");else{t.m=6;try{var a=2<oa(t)?t.g.statusText:""}catch(c){a=""}t.j=a+" ["+t.ba()+"]",ea(t)}}finally{ra(t)}}}function ra(t,e){if(t.g){ia(t);var n=t.g,r=t.C[0]?Fr:null;t.g=null,t.C=null,e||Yi(t,"ready");try{n.onreadystatechange=r}catch(K_){}}}function ia(t){t.g&&t.K&&(t.g.ontimeout=null),t.A&&(zr.clearTimeout(t.A),t.A=null)}function oa(t){return t.g?t.g.readyState:0}function sa(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.J){case Xs:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(e){return null}}function aa(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=function(t){var e="";return ci(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):ps(t,e,n))}function ca(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function la(t){this.za=0,this.l=[],this.h=new bo,this.la=this.oa=this.F=this.W=this.g=this.sa=this.D=this.aa=this.o=this.P=this.s=null,this.Za=this.V=0,this.Xa=ca("failFast",!1,t),this.N=this.v=this.u=this.m=this.j=null,this.X=!0,this.I=this.ta=this.U=-1,this.Y=this.A=this.C=0,this.Pa=ca("baseRetryDelayMs",5e3,t),this.$a=ca("retryDelaySeedMs",1e4,t),this.Ya=ca("forwardChannelMaxRetries",2,t),this.ra=ca("forwardChannelRequestTimeoutMs",2e4,t),this.qa=t&&t.xmlHttpFactory||void 0,this.Ba=t&&t.Yb||!1,this.K=void 0,this.H=t&&t.supportsCrossDomainXhr||!1,this.J="",this.i=new Ms(t&&t.concurrentRequestLimit),this.Ca=new Fs,this.ja=t&&t.fastHandshake||!1,this.Ra=t&&t.Wb||!1,t&&t.Aa&&this.h.Aa(),t&&t.forceLongPolling&&(this.X=!1),this.$=!this.ja&&this.X&&t&&t.detectBufferingProxy||!1,this.ka=void 0,this.O=0,this.L=!1,this.B=null,this.Wa=!t||!1!==t.Xb}function ua(t){if(da(t),3==t.G){var e=t.V++,n=cs(t.F);ps(n,"SID",t.J),ps(n,"RID",e),ps(n,"TYPE","terminate"),ga(t,n),(e=new Bo(t,t.h,e,void 0)).K=2,e.v=fs(cs(n)),n=!1,zr.navigator&&zr.navigator.sendBeacon&&(n=zr.navigator.sendBeacon(e.v.toString(),"")),!n&&zr.Image&&((new Image).src=e.v,n=!0),n||(e.g=ka(e.l,null),e.g.ea(e.v)),e.F=Date.now(),Xo(e)}Sa(t)}function ha(t){t.g&&(ba(t),t.g.cancel(),t.g=null)}function da(t){ha(t),t.u&&(zr.clearTimeout(t.u),t.u=null),wa(t),t.i.cancel(),t.m&&("number"==typeof t.m&&zr.clearTimeout(t.m),t.m=null)}function pa(t,e){t.l.push(new As(t.Za++,e)),3==t.G&&fa(t)}function fa(t){Ps(t.i)||t.m||(t.m=!0,so(t.Ha,t),t.C=0)}function ma(t,e){var n;n=e?e.m:t.V++;var r=cs(t.F);ps(r,"SID",t.J),ps(r,"RID",n),ps(r,"AID",t.U),ga(t,r),t.o&&t.s&&aa(r,t.o,t.s),n=new Bo(t,t.h,n,t.C+1),null===t.o&&(n.H=t.s),e&&(t.l=e.D.concat(t.l)),e=_a(t,n,1e3),n.setTimeout(Math.round(.5*t.ra)+Math.round(.5*t.ra*Math.random())),Ns(t.i,n),$o(n,r,e)}function ga(t,e){t.j&&ns({},function(t,n){ps(e,n,t)})}function _a(t,e,n){n=Math.min(t.l.length,n);var r=t.j?Wr(t.j.Oa,t.j,t):null;t:for(var i=t.l,o=-1;;){var s=["count="+n];-1==o?0<n?s.push("ofs="+(o=i[0].h)):o=0:s.push("ofs="+o);for(var a=!0,c=0;c<n;c++){var l=i[c].h,u=i[c].g;if(0>(l-=o))o=Math.max(0,i[c].h-100),a=!1;else try{Bs(u,s,"req"+l+"_")}catch(sc){r&&r(u)}}if(a){r=s.join("&");break t}}return t=t.l.splice(0,n),e.D=t,r}function ya(t){t.g||t.u||(t.Y=1,so(t.Ga,t),t.A=0)}function va(t){return!(t.g||t.u||3<=t.A||(t.Y++,t.u=Mo(Wr(t.Ga,t),Ca(t,t.A)),t.A++,0))}function ba(t){null!=t.B&&(zr.clearTimeout(t.B),t.B=null)}function xa(t){t.g=new Bo(t,t.h,"rpc",t.Y),null===t.o&&(t.g.H=t.s),t.g.O=0;var e=cs(t.oa);ps(e,"RID","rpc"),ps(e,"SID",t.J),ps(e,"CI",t.N?"0":"1"),ps(e,"AID",t.U),ga(t,e),ps(e,"TYPE","xmlhttp"),t.o&&t.s&&aa(e,t.o,t.s),t.K&&t.g.setTimeout(t.K);var n=t.g;t=t.la,n.K=1,n.v=fs(cs(e)),n.s=null,n.U=!0,Wo(n,t)}function wa(t){null!=t.v&&(zr.clearTimeout(t.v),t.v=null)}function Ta(t,e){var n=null;if(t.g==e){wa(t),ba(t),t.g=null;var r=2}else{if(!Rs(t.i,e))return;n=e.D,Ls(t.i,e),r=1}if(t.I=e.N,0!=t.G)if(e.i)if(1==r){n=e.s?e.s.length:0,e=Date.now()-e.F;var i=t.C;Yi(r=Co(),new Ao(r,n,e,i)),fa(t)}else ya(t);else if(3==(i=e.o)||0==i&&0<t.I||!(1==r&&function(t,e){return!(Ds(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.l=e.D.concat(t.l),0):1==t.G||2==t.G||t.C>=(t.Xa?0:t.Ya)||(t.m=Mo(Wr(t.Ha,t,e),Ca(t,t.C)),t.C++,0)))}(t,e)||2==r&&va(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Ea(t,5);break;case 4:Ea(t,10);break;case 3:Ea(t,6);break;default:Ea(t,2)}}function Ca(t,e){var n=t.Pa+Math.floor(Math.random()*t.$a);return t.j||(n*=2),n*e}function Ea(t,e){if(t.h.info("Error code "+e),2==e){var n=null;t.j&&(n=null);var r=Wr(t.jb,t);n||(n=new as("//www.google.com/images/cleardot.gif"),zr.location&&"http"==zr.location.protocol||ls(n,"https"),fs(n)),function(t,e){var n=new bo;if(zr.Image){var r=new Image;r.onload=Hr(Us,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Hr(Us,n,r,"TestLoadImage: error",!1,e),r.onabort=Hr(Us,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Hr(Us,n,r,"TestLoadImage: timeout",!1,e),zr.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else ko(2);t.G=0,t.j&&t.j.va(e),Sa(t),da(t)}function Sa(t){t.G=0,t.I=-1,t.j&&(0==js(t.i).length&&0==t.l.length||(t.i.i.length=0,ti(t.l),t.l.length=0),t.j.ua())}function Ia(t,e,n){var r=function(t){return t instanceof as?cs(t):new as(t,void 0)}(n);if(""!=r.i)e&&us(r,e+"."+r.i),hs(r,r.m);else{var i=zr.location;r=function(t,e,n,r){var i=new as(null,void 0);return t&&ls(i,t),e&&us(i,e),n&&hs(i,n),r&&(i.l=r),i}(i.protocol,e?e+"."+i.hostname:i.hostname,+i.port,n)}return t.aa&&ci(t.aa,function(t,e){ps(r,e,t)}),n=t.sa,(e=t.D)&&n&&ps(r,e,n),ps(r,"VER",t.ma),ga(t,r),r}function ka(t,e,n){if(e&&!t.H)throw Error("Can't create secondary domain capable XhrIo object.");return(e=new Ks(n&&t.Ba&&!t.qa?new Vs({ib:!0}):t.qa)).L=t.H,e}function Aa(){}function Ma(){if(gi&&!(10<=Number(Si)))throw Error("Environmental error: no available transport.")}function Oa(t,e){Xi.call(this),this.g=new la(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.ya&&(t?t["X-WebChannel-Client-Profile"]=e.ya:t={"X-WebChannel-Client-Profile":e.ya}),this.g.P=t,(t=e&&e.httpHeadersOverwriteParam)&&!ei(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!ei(e)&&(this.g.D=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new Ra(this)}function Pa(t){jo.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function Da(){zo.call(this),this.status=1}function Ra(t){this.g=t}(Nr=Ks.prototype).ea=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.H+"; newUri="+t);e=e?e.toUpperCase():"GET",this.H=t,this.j="",this.m=0,this.D=!1,this.h=!0,this.g=this.u?this.u.g():No.g(),this.C=function(t){return t.h||(t.h=t.i())}(this.u?this.u:No),this.g.onreadystatechange=Wr(this.Fa,this);try{this.F=!0,this.g.open(e,String(t),!0),this.F=!1}catch(o){return void ta(this,o)}t=n||"";var i=new rs(this.headers);r&&ns(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Js,n=t.length,r="string"==typeof t?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:"string"==typeof t?t.charAt(e):t[e]}(i.T()),n=zr.FormData&&t instanceof zr.FormData,!(0<=Yr(Qs,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.g.setRequestHeader(e,t)},this),this.J&&(this.g.responseType=this.J),"withCredentials"in this.g&&this.g.withCredentials!==this.L&&(this.g.withCredentials=this.L);try{ia(this),0<this.B&&((this.K=function(t){return gi&&function(){return t=Ei,Object.prototype.hasOwnProperty.call(t,9)?t[9]:t[9]=function(){for(var t=0,e=ri(String(pi)).split("."),n=ri("9").split("."),r=Math.max(e.length,n.length),i=0;0==t&&i<r;i++){var o=e[i]||"",s=n[i]||"";do{if(o=/(\d*)(\D*)(.*)/.exec(o)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==o[0].length&&0==s[0].length)break;t=oi(0==o[1].length?0:parseInt(o[1],10),0==s[1].length?0:parseInt(s[1],10))||oi(0==o[2].length,0==s[2].length)||oi(o[2],s[2]),o=o[3],s=s[3]}while(0==t)}return 0<=t}();var t}()&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Wr(this.pa,this)):this.A=po(this.pa,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(o){ta(this,o)}},Nr.pa=function(){void 0!==jr&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Yi(this,"timeout"),this.abort(8))},Nr.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Yi(this,"complete"),Yi(this,"abort"),ra(this))},Nr.M=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),ra(this,!0)),Ks.Z.M.call(this)},Nr.Fa=function(){this.s||(this.F||this.v||this.l?na(this):this.cb())},Nr.cb=function(){na(this)},Nr.ba=function(){try{return 2<oa(this)?this.g.status:-1}catch(fi){return-1}},Nr.ga=function(){try{return this.g?this.g.responseText:""}catch(fi){return""}},Nr.Qa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Zs(e)}},Nr.Da=function(){return this.m},Nr.La=function(){return"string"==typeof this.j?this.j:String(this.j)},(Nr=la.prototype).ma=8,Nr.G=1,Nr.hb=function(t){try{this.h.info("Origin Trials invoked: "+t)}catch(e){}},Nr.Ha=function(t){if(this.m)if(this.m=null,1==this.G){if(!t){this.V=Math.floor(1e5*Math.random()),t=this.V++;var e=new Bo(this,this.h,t,void 0),n=this.s;if(this.P&&(n?hi(n=li(n),this.P):n=this.P),null===this.o&&(e.H=n),this.ja)t:{for(var r=0,i=0;i<this.l.length;i++){var o=this.l[i];if(void 0===(o="__data__"in o.g&&"string"==typeof(o=o.g.__data__)?o.length:void 0))break;if(4096<(r+=o)){r=i;break t}if(4096===r||i===this.l.length-1){r=i+1;break t}}r=1e3}else r=1e3;r=_a(this,e,r),ps(i=cs(this.F),"RID",t),ps(i,"CVER",22),this.D&&ps(i,"X-HTTP-Session-Id",this.D),ga(this,i),this.o&&n&&aa(i,this.o,n),Ns(this.i,e),this.Ra&&ps(i,"TYPE","init"),this.ja?(ps(i,"$req",r),ps(i,"SID","null"),e.$=!0,$o(e,i,null)):$o(e,i,r),this.G=2}}else 3==this.G&&(t?ma(this,t):0==this.l.length||Ps(this.i)||ma(this))},Nr.Ga=function(){if(this.u=null,xa(this),this.$&&!(this.L||null==this.g||0>=this.O)){var t=2*this.O;this.h.info("BP detection timer enabled: "+t),this.B=Mo(Wr(this.bb,this),t)}},Nr.bb=function(){this.B&&(this.B=null,this.h.info("BP detection timeout reached."),this.h.info("Buffering proxy detected and switch to long-polling!"),this.N=!1,this.L=!0,ko(10),ha(this),xa(this))},Nr.ab=function(){null!=this.v&&(this.v=null,ha(this),va(this),ko(19))},Nr.jb=function(t){t?(this.h.info("Successfully pinged google.com"),ko(2)):(this.h.info("Failed to ping google.com"),ko(1))},(Nr=Aa.prototype).xa=function(){},Nr.wa=function(){},Nr.va=function(){},Nr.ua=function(){},Nr.Oa=function(){},Ma.prototype.g=function(t,e){return new Oa(t,e)},Zr(Oa,Xi),Oa.prototype.m=function(){this.g.j=this.j,this.A&&(this.g.H=!0);var t=this.g,e=this.l,n=this.h||void 0;t.Wa&&(t.h.info("Origin Trials enabled."),so(Wr(t.hb,t,e))),ko(0),t.W=e,t.aa=n||{},t.N=t.X,t.F=Ia(t,null,t.W),fa(t)},Oa.prototype.close=function(){ua(this.g)},Oa.prototype.u=function(t){if("string"==typeof t){var e={};e.__data__=t,pa(this.g,e)}else this.v?((e={}).__data__=Ji(t),pa(this.g,e)):pa(this.g,t)},Oa.prototype.M=function(){this.g.j=null,delete this.j,ua(this.g),delete this.g,Oa.Z.M.call(this)},Zr(Pa,jo),Zr(Da,zo),Zr(Ra,Aa),Ra.prototype.xa=function(){Yi(this.g,"a")},Ra.prototype.wa=function(t){Yi(this.g,new Pa(t))},Ra.prototype.va=function(t){Yi(this.g,new Da(t))},Ra.prototype.ua=function(){Yi(this.g,"b")},Ma.prototype.createWebChannel=Ma.prototype.g,Oa.prototype.send=Oa.prototype.u,Oa.prototype.open=Oa.prototype.m,Oa.prototype.close=Oa.prototype.close,Oo.NO_ERROR=0,Oo.TIMEOUT=8,Oo.HTTP_ERROR=6,Po.COMPLETE="complete",Ro.EventType=Lo,Lo.OPEN="a",Lo.CLOSE="b",Lo.ERROR="c",Lo.MESSAGE="d",Xi.prototype.listen=Xi.prototype.N,Ks.prototype.listenOnce=Ks.prototype.O,Ks.prototype.getLastError=Ks.prototype.La,Ks.prototype.getLastErrorCode=Ks.prototype.Da,Ks.prototype.getStatus=Ks.prototype.ba,Ks.prototype.getResponseJson=Ks.prototype.Qa,Ks.prototype.getResponseText=Ks.prototype.ga,Ks.prototype.send=Ks.prototype.ea;var Na=Oo,La=Po,ja=wo,za=Vs,Fa=Ro,Ba=Ks,Ua=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.t(t)},this.i=function(t){return e.writeSequenceNumber(t)})}return t.prototype.t=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.i&&this.i(t),t},t}();Ua.o=-1;var Va={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},qa=function(t){function e(e,n){var r=this;return(r=t.call(this,n)||this).code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Object(He.c)(e,t),e}(Error),Ga=new Pr.b("@firebase/firestore");function $a(){return Ga.logLevel}function Wa(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ga.logLevel<=Pr.a.DEBUG){var r=e.map(Ka);Ga.debug.apply(Ga,Object(He.f)(["Firestore (8.10.1): "+t],r))}}function Ha(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ga.logLevel<=Pr.a.ERROR){var r=e.map(Ka);Ga.error.apply(Ga,Object(He.f)(["Firestore (8.10.1): "+t],r))}}function Za(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Ga.logLevel<=Pr.a.WARN){var r=e.map(Ka);Ga.warn.apply(Ga,Object(He.f)(["Firestore (8.10.1): "+t],r))}}function Ka(t){if("string"==typeof t)return t;try{return JSON.stringify(t)}catch(K_){return t}}function Xa(t){void 0===t&&(t="Unexpected state");var e="FIRESTORE (8.10.1) INTERNAL ASSERTION FAILED: "+t;throw Ha(e),new Error(e)}function Ya(t,e){t||Xa()}function Qa(t,e){return t}function Ja(t){var e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(var r=0;r<t;r++)n[r]=Math.floor(256*Math.random());return n}var tc=function(){function t(){}return t.u=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e=Math.floor(256/t.length)*t.length,n="";n.length<20;)for(var r=Ja(40),i=0;i<r.length;++i)n.length<20&&r[i]<e&&(n+=t.charAt(r[i]%t.length));return n},t}();function ec(t,e){return t<e?-1:t>e?1:0}function nc(t,e,n){return t.length===e.length&&t.every(function(t,r){return n(t,e[r])})}function rc(t){return t+"\0"}var ic=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new qa(Va.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new qa(Va.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new qa(Va.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new qa(Va.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,Math.floor(1e6*(e-1e3*n)))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?ec(this.nanoseconds,t.nanoseconds):ec(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t.prototype.toJSON=function(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}},t.prototype.valueOf=function(){return String(this.seconds- -62135596800).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")},t}(),oc=function(){function t(t){this.timestamp=t}return t.fromTimestamp=function(e){return new t(e)},t.min=function(){return new t(new ic(0,0))},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t}();function sc(t){var e=0;for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function ac(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function cc(t){for(var e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}var lc=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Xa(),void 0===n?n=t.length-e:n>t.length-e&&Xa(),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return this.construct(this.segments,this.offset+(t=void 0===t?1:t),this.length-t)},t.prototype.popLast=function(){return this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),uc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(He.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];for(var r=[],i=0,o=t;i<o.length;i++){var s=o[i];if(s.indexOf("//")>=0)throw new qa(Va.INVALID_ARGUMENT,"Invalid segment ("+s+"). Paths must not contain // in them.");r.push.apply(r,s.split("/").filter(function(t){return t.length>0}))}return new e(r)},e.emptyPath=function(){return new e([])},e}(lc),hc=/^[_a-zA-Z][_a-zA-Z0-9]*$/,dc=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(He.c)(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return hc.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new qa(Va.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},s=!1;i<t.length;){var a=t[i];if("\\"===a){if(i+1===t.length)throw new qa(Va.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var c=t[i+1];if("\\"!==c&&"."!==c&&"`"!==c)throw new qa(Va.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=c,i+=2}else"`"===a?(s=!s,i++):"."!==a||s?(r+=a,i++):(o(),i++)}if(o(),s)throw new qa(Va.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.emptyPath=function(){return new e([])},e}(lc),pc=function(){function t(t){this.fields=t,t.sort(dc.comparator)}return t.prototype.covers=function(t){for(var e=0,n=this.fields;e<n.length;e++)if(n[e].isPrefixOf(t))return!0;return!1},t.prototype.isEqual=function(t){return nc(this.fields,t.fields,function(t,e){return t.isEqual(e)})},t}(),fc=function(){function t(t){this.binaryString=t}return t.fromBase64String=function(e){return new t(atob(e))},t.fromUint8Array=function(e){return new t(function(t){for(var e="",n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(e))},t.prototype.toBase64=function(){return btoa(this.binaryString)},t.prototype.toUint8Array=function(){return function(t){for(var e=new Uint8Array(t.length),n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)},t.prototype.approximateByteSize=function(){return 2*this.binaryString.length},t.prototype.compareTo=function(t){return ec(this.binaryString,t.binaryString)},t.prototype.isEqual=function(t){return this.binaryString===t.binaryString},t}();fc.EMPTY_BYTE_STRING=new fc("");var mc=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gc(t){if(Ya(!!t),"string"==typeof t){var e=0,n=mc.exec(t);if(Ya(!!n),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t);return{seconds:Math.floor(i.getTime()/1e3),nanos:e}}return{seconds:_c(t.seconds),nanos:_c(t.nanos)}}function _c(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function yc(t){return"string"==typeof t?fc.fromBase64String(t):fc.fromUint8Array(t)}function vc(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function bc(t){var e=t.mapValue.fields.__previous_value__;return vc(e)?bc(e):e}function xc(t){var e=gc(t.mapValue.fields.__local_write_time__.timestampValue);return new ic(e.seconds,e.nanos)}function wc(t){return null==t}function Tc(t){return 0===t&&1/t==-1/0}function Cc(t){return"number"==typeof t&&Number.isInteger(t)&&!Tc(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}var Ec=function(){function t(t){this.path=t}return t.fromPath=function(e){return new t(uc.fromString(e))},t.fromName=function(e){return new t(uc.fromString(e).popFirst(5))},t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===uc.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return uc.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new uc(e.slice()))},t}();function Sc(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?vc(t)?4:10:Xa()}function Ic(t,e){var n=Sc(t);if(n!==Sc(e))return!1;switch(n){case 0:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return xc(t).isEqual(xc(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;var n=gc(t.timestampValue),r=gc(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return yc(t.bytesValue).isEqual(yc(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return _c(t.geoPointValue.latitude)===_c(e.geoPointValue.latitude)&&_c(t.geoPointValue.longitude)===_c(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return _c(t.integerValue)===_c(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){var n=_c(t.doubleValue),r=_c(e.doubleValue);return n===r?Tc(n)===Tc(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return nc(t.arrayValue.values||[],e.arrayValue.values||[],Ic);case 10:return function(t,e){var n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(sc(n)!==sc(r))return!1;for(var i in n)if(n.hasOwnProperty(i)&&(void 0===r[i]||!Ic(n[i],r[i])))return!1;return!0}(t,e);default:return Xa()}}function kc(t,e){return void 0!==(t.values||[]).find(function(t){return Ic(t,e)})}function Ac(t,e){var n=Sc(t),r=Sc(e);if(n!==r)return ec(n,r);switch(n){case 0:return 0;case 1:return ec(t.booleanValue,e.booleanValue);case 2:return function(t,e){var n=_c(t.integerValue||t.doubleValue),r=_c(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return Mc(t.timestampValue,e.timestampValue);case 4:return Mc(xc(t),xc(e));case 5:return ec(t.stringValue,e.stringValue);case 6:return function(t,e){var n=yc(t),r=yc(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){for(var n=t.split("/"),r=e.split("/"),i=0;i<n.length&&i<r.length;i++){var o=ec(n[i],r[i]);if(0!==o)return o}return ec(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){var n=ec(_c(t.latitude),_c(e.latitude));return 0!==n?n:ec(_c(t.longitude),_c(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){for(var n=t.values||[],r=e.values||[],i=0;i<n.length&&i<r.length;++i){var o=Ac(n[i],r[i]);if(o)return o}return ec(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){var n=t.fields||{},r=Object.keys(n),i=e.fields||{},o=Object.keys(i);r.sort(),o.sort();for(var s=0;s<r.length&&s<o.length;++s){var a=ec(r[s],o[s]);if(0!==a)return a;var c=Ac(n[r[s]],i[o[s]]);if(0!==c)return c}return ec(r.length,o.length)}(t.mapValue,e.mapValue);default:throw Xa()}}function Mc(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ec(t,e);var n=gc(t),r=gc(e),i=ec(n.seconds,r.seconds);return 0!==i?i:ec(n.nanos,r.nanos)}function Oc(t){return Pc(t)}function Pc(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){var e=gc(t);return"time("+e.seconds+","+e.nanos+")"}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?yc(t.bytesValue).toBase64():"referenceValue"in t?Ec.fromName(t.referenceValue).toString():"geoPointValue"in t?"geo("+(e=t.geoPointValue).latitude+","+e.longitude+")":"arrayValue"in t?function(t){for(var e="[",n=!0,r=0,i=t.values||[];r<i.length;r++)n?n=!1:e+=",",e+=Pc(i[r]);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){for(var e="{",n=!0,r=0,i=Object.keys(t.fields||{}).sort();r<i.length;r++){var o=i[r];n?n=!1:e+=",",e+=o+":"+Pc(t.fields[o])}return e+"}"}(t.mapValue):Xa();var e}function Dc(t,e){return{referenceValue:"projects/"+t.projectId+"/databases/"+t.database+"/documents/"+e.path.canonicalString()}}function Rc(t){return!!t&&"integerValue"in t}function Nc(t){return!!t&&"arrayValue"in t}function Lc(t){return!!t&&"nullValue"in t}function jc(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function zc(t){return!!t&&"mapValue"in t}function Fc(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){var e={mapValue:{fields:{}}};return ac(t.mapValue.fields,function(t,n){return e.mapValue.fields[t]=Fc(n)}),e}if(t.arrayValue){for(var n={arrayValue:{values:[]}},r=0;r<(t.arrayValue.values||[]).length;++r)n.arrayValue.values[r]=Fc(t.arrayValue.values[r]);return n}return Object.assign({},t)}var Bc=function(){function t(t){this.value=t}return t.empty=function(){return new t({mapValue:{}})},t.prototype.field=function(t){if(t.isEmpty())return this.value;for(var e=this.value,n=0;n<t.length-1;++n)if(!zc(e=(e.mapValue.fields||{})[t.get(n)]))return null;return(e=(e.mapValue.fields||{})[t.lastSegment()])||null},t.prototype.set=function(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=Fc(e)},t.prototype.setAll=function(t){var e=this,n=dc.emptyPath(),r={},i=[];t.forEach(function(t,o){if(!n.isImmediateParentOf(o)){var s=e.getFieldsMap(n);e.applyChanges(s,r,i),r={},i=[],n=o.popLast()}t?r[o.lastSegment()]=Fc(t):i.push(o.lastSegment())});var o=this.getFieldsMap(n);this.applyChanges(o,r,i)},t.prototype.delete=function(t){var e=this.field(t.popLast());zc(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]},t.prototype.isEqual=function(t){return Ic(this.value,t.value)},t.prototype.getFieldsMap=function(t){var e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(var n=0;n<t.length;++n){var r=e.mapValue.fields[t.get(n)];zc(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields},t.prototype.applyChanges=function(t,e,n){ac(e,function(e,n){return t[e]=n});for(var r=0,i=n;r<i.length;r++)delete t[i[r]]},t.prototype.clone=function(){return new t(Fc(this.value))},t}();function Uc(t){var e=[];return ac(t.fields,function(t,n){var r=new dc([t]);if(zc(n)){var i=Uc(n.mapValue).fields;if(0===i.length)e.push(r);else for(var o=0,s=i;o<s.length;o++)e.push(r.child(s[o]))}else e.push(r)}),new pc(e)}var Vc=function(){function t(t,e,n,r,i){this.key=t,this.documentType=e,this.version=n,this.data=r,this.documentState=i}return t.newInvalidDocument=function(e){return new t(e,0,oc.min(),Bc.empty(),0)},t.newFoundDocument=function(e,n,r){return new t(e,1,n,r,0)},t.newNoDocument=function(e,n){return new t(e,2,n,Bc.empty(),0)},t.newUnknownDocument=function(e,n){return new t(e,3,n,Bc.empty(),2)},t.prototype.convertToFoundDocument=function(t,e){return this.version=t,this.documentType=1,this.data=e,this.documentState=0,this},t.prototype.convertToNoDocument=function(t){return this.version=t,this.documentType=2,this.data=Bc.empty(),this.documentState=0,this},t.prototype.convertToUnknownDocument=function(t){return this.version=t,this.documentType=3,this.data=Bc.empty(),this.documentState=2,this},t.prototype.setHasCommittedMutations=function(){return this.documentState=2,this},t.prototype.setHasLocalMutations=function(){return this.documentState=1,this},Object.defineProperty(t.prototype,"hasLocalMutations",{get:function(){return 1===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasCommittedMutations",{get:function(){return 2===this.documentState},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!1,configurable:!0}),t.prototype.isValidDocument=function(){return 0!==this.documentType},t.prototype.isFoundDocument=function(){return 1===this.documentType},t.prototype.isNoDocument=function(){return 2===this.documentType},t.prototype.isUnknownDocument=function(){return 3===this.documentType},t.prototype.isEqual=function(e){return e instanceof t&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)},t.prototype.clone=function(){return new t(this.key,this.documentType,this.version,this.data.clone(),this.documentState)},t.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+JSON.stringify(this.data.value)+", {documentType: "+this.documentType+"}), {documentState: "+this.documentState+"})"},t}(),qc=function(t,e,n,r,i,o,s){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=s,this.h=null};function Gc(t,e,n,r,i,o,s){return void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===s&&(s=null),new qc(t,e,n,r,i,o,s)}function $c(t){var e=Qa(t);if(null===e.h){var n=e.path.canonicalString();null!==e.collectionGroup&&(n+="|cg:"+e.collectionGroup),n+="|f:",n+=e.filters.map(function(t){return function(t){return t.field.canonicalString()+t.op.toString()+Oc(t.value)}(t)}).join(","),n+="|ob:",n+=e.orderBy.map(function(t){return function(t){return t.field.canonicalString()+t.dir}(t)}).join(","),wc(e.limit)||(n+="|l:",n+=e.limit),e.startAt&&(n+="|lb:",n+=il(e.startAt)),e.endAt&&(n+="|ub:",n+=il(e.endAt)),e.h=n}return e.h}function Wc(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(var n=0;n<t.orderBy.length;n++)if(!sl(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(var r=0;r<t.filters.length;r++)if((i=t.filters[r]).op!==(o=e.filters[r]).op||!i.field.isEqual(o.field)||!Ic(i.value,o.value))return!1;var i,o;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!cl(t.startAt,e.startAt)&&cl(t.endAt,e.endAt)}function Hc(t){return Ec.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}var Zc=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).field=e,i.op=n,i.value=r,i}return Object(He.c)(e,t),e.create=function(t,n,r){return t.isKeyField()?"in"===n||"not-in"===n?this.l(t,n,r):new Kc(t,n,r):"array-contains"===n?new Jc(t,r):"in"===n?new tl(t,r):"not-in"===n?new el(t,r):"array-contains-any"===n?new nl(t,r):new e(t,n,r)},e.l=function(t,e,n){return"in"===e?new Xc(t,n):new Yc(t,n)},e.prototype.matches=function(t){var e=t.data.field(this.field);return"!="===this.op?null!==e&&this.m(Ac(e,this.value)):null!==e&&Sc(this.value)===Sc(e)&&this.m(Ac(e,this.value))},e.prototype.m=function(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Xa()}},e.prototype.g=function(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0},e}(function(){}),Kc=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,r)||this).key=Ec.fromName(r.referenceValue),i}return Object(He.c)(e,t),e.prototype.matches=function(t){var e=Ec.comparator(t.key,this.key);return this.m(e)},e}(Zc),Xc=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"in",n)||this).keys=Qc(0,n),r}return Object(He.c)(e,t),e.prototype.matches=function(t){return this.keys.some(function(e){return e.isEqual(t.key)})},e}(Zc),Yc=function(t){function e(e,n){var r=this;return(r=t.call(this,e,"not-in",n)||this).keys=Qc(0,n),r}return Object(He.c)(e,t),e.prototype.matches=function(t){return!this.keys.some(function(e){return e.isEqual(t.key)})},e}(Zc);function Qc(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map(function(t){return Ec.fromName(t.referenceValue)})}var Jc=function(t){function e(e,n){return t.call(this,e,"array-contains",n)||this}return Object(He.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return Nc(e)&&kc(e.arrayValue,this.value)},e}(Zc),tl=function(t){function e(e,n){return t.call(this,e,"in",n)||this}return Object(He.c)(e,t),e.prototype.matches=function(t){var e=t.data.field(this.field);return null!==e&&kc(this.value.arrayValue,e)},e}(Zc),el=function(t){function e(e,n){return t.call(this,e,"not-in",n)||this}return Object(He.c)(e,t),e.prototype.matches=function(t){if(kc(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;var e=t.data.field(this.field);return null!==e&&!kc(this.value.arrayValue,e)},e}(Zc),nl=function(t){function e(e,n){return t.call(this,e,"array-contains-any",n)||this}return Object(He.c)(e,t),e.prototype.matches=function(t){var e=this,n=t.data.field(this.field);return!(!Nc(n)||!n.arrayValue.values)&&n.arrayValue.values.some(function(t){return kc(e.value.arrayValue,t)})},e}(Zc),rl=function(t,e){this.position=t,this.before=e};function il(t){return(t.before?"b":"a")+":"+t.position.map(function(t){return Oc(t)}).join(",")}var ol=function(t,e){void 0===e&&(e="asc"),this.field=t,this.dir=e};function sl(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}function al(t,e,n){for(var r=0,i=0;i<t.position.length;i++){var o=e[i],s=t.position[i];if(r=o.field.isKeyField()?Ec.comparator(Ec.fromName(s.referenceValue),n.key):Ac(s,n.data.field(o.field)),"desc"===o.dir&&(r*=-1),0!==r)break}return t.before?r<=0:r<0}function cl(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.before!==e.before||t.position.length!==e.position.length)return!1;for(var n=0;n<t.position.length;n++)if(!Ic(t.position[n],e.position[n]))return!1;return!0}var ll=function(t,e,n,r,i,o,s,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o="F"),void 0===s&&(s=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=o,this.startAt=s,this.endAt=a,this.p=null,this.T=null};function ul(t,e,n,r,i,o,s,a){return new ll(t,e,n,r,i,o,s,a)}function hl(t){return new ll(t)}function dl(t){return!wc(t.limit)&&"F"===t.limitType}function pl(t){return!wc(t.limit)&&"L"===t.limitType}function fl(t){return t.explicitOrderBy.length>0?t.explicitOrderBy[0].field:null}function ml(t){for(var e=0,n=t.filters;e<n.length;e++){var r=n[e];if(r.g())return r.field}return null}function gl(t){return null!==t.collectionGroup}function _l(t){var e=Qa(t);if(null===e.p){e.p=[];var n=ml(e),r=fl(e);if(null!==n&&null===r)n.isKeyField()||e.p.push(new ol(n)),e.p.push(new ol(dc.keyField(),"asc"));else{for(var i=!1,o=0,s=e.explicitOrderBy;o<s.length;o++){var a=s[o];e.p.push(a),a.field.isKeyField()&&(i=!0)}if(!i){var c=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc";e.p.push(new ol(dc.keyField(),c))}}}return e.p}function yl(t){var e=Qa(t);if(!e.T)if("F"===e.limitType)e.T=Gc(e.path,e.collectionGroup,_l(e),e.filters,e.limit,e.startAt,e.endAt);else{for(var n=[],r=0,i=_l(e);r<i.length;r++){var o=i[r];n.push(new ol(o.field,"desc"===o.dir?"asc":"desc"))}var s=e.endAt?new rl(e.endAt.position,!e.endAt.before):null,a=e.startAt?new rl(e.startAt.position,!e.startAt.before):null;e.T=Gc(e.path,e.collectionGroup,n,e.filters,e.limit,s,a)}return e.T}function vl(t,e,n){return new ll(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function bl(t,e){return Wc(yl(t),yl(e))&&t.limitType===e.limitType}function xl(t){return $c(yl(t))+"|lt:"+t.limitType}function wl(t){return"Query(target="+function(t){var e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=", filters: ["+t.filters.map(function(t){return(e=t).field.canonicalString()+" "+e.op+" "+Oc(e.value);var e}).join(", ")+"]"),wc(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=", orderBy: ["+t.orderBy.map(function(t){return function(t){return t.field.canonicalString()+" ("+t.dir+")"}(t)}).join(", ")+"]"),t.startAt&&(e+=", startAt: "+il(t.startAt)),t.endAt&&(e+=", endAt: "+il(t.endAt)),"Target("+e+")"}(yl(t))+"; limitType="+t.limitType+")"}function Tl(t,e){return e.isFoundDocument()&&function(t,e){var n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):Ec.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(var n=0,r=t.explicitOrderBy;n<r.length;n++){var i=r[n];if(!i.field.isKeyField()&&null===e.data.field(i.field))return!1}return!0}(t,e)&&function(t,e){for(var n=0,r=t.filters;n<r.length;n++)if(!r[n].matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!al(t.startAt,_l(t),e)||t.endAt&&al(t.endAt,_l(t),e))}(t,e)}function Cl(t){return function(e,n){for(var r=!1,i=0,o=_l(t);i<o.length;i++){var s=o[i],a=El(s,e,n);if(0!==a)return a;r=r||s.field.isKeyField()}return 0}}function El(t,e,n){var r=t.field.isKeyField()?Ec.comparator(e.key,n.key):function(t,e,n){var r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?Ac(r,i):Xa()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Xa()}}function Sl(t,e){if(t.I){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Tc(e)?"-0":e}}function Il(t){return{integerValue:""+t}}function kl(t,e){return Cc(e)?Il(e):Sl(t,e)}var Al=function(){this._=void 0};function Ml(t,e,n){return t instanceof Dl?function(t,e){var n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Rl?Nl(t,e):t instanceof Ll?jl(t,e):function(t,e){var n=Pl(t,e),r=Fl(n)+Fl(t.A);return Rc(n)&&Rc(t.A)?Il(r):Sl(t.R,r)}(t,e)}function Ol(t,e,n){return t instanceof Rl?Nl(t,e):t instanceof Ll?jl(t,e):n}function Pl(t,e){return t instanceof zl?Rc(n=e)||function(t){return!!t&&"doubleValue"in t}(n)?e:{integerValue:0}:null;var n}var Dl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(He.c)(e,t),e}(Al),Rl=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(He.c)(e,t),e}(Al);function Nl(t,e){for(var n=Bl(e),r=function(t){n.some(function(e){return Ic(e,t)})||n.push(t)},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var Ll=function(t){function e(e){var n=this;return(n=t.call(this)||this).elements=e,n}return Object(He.c)(e,t),e}(Al);function jl(t,e){for(var n=Bl(e),r=function(t){n=n.filter(function(e){return!Ic(e,t)})},i=0,o=t.elements;i<o.length;i++)r(o[i]);return{arrayValue:{values:n}}}var zl=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).R=e,r.A=n,r}return Object(He.c)(e,t),e}(Al);function Fl(t){return _c(t.integerValue||t.doubleValue)}function Bl(t){return Nc(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}var Ul=function(t,e){this.field=t,this.transform=e},Vl=function(t,e){this.version=t,this.transformResults=e},ql=function(){function t(t,e){this.updateTime=t,this.exists=e}return t.none=function(){return new t},t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)},t}();function Gl(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}var $l=function(){};function Wl(t,e,n){t instanceof Yl?function(t,e,n){var r=t.value.clone(),i=tu(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof Ql?function(t,e,n){if(Gl(t.precondition,e)){var r=tu(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(Jl(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}else e.convertToUnknownDocument(n.version)}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Hl(t,e,n){t instanceof Yl?function(t,e,n){if(Gl(t.precondition,e)){var r=t.value.clone(),i=eu(t.fieldTransforms,n,e);r.setAll(i),e.convertToFoundDocument(Xl(e),r).setHasLocalMutations()}}(t,e,n):t instanceof Ql?function(t,e,n){if(Gl(t.precondition,e)){var r=eu(t.fieldTransforms,n,e),i=e.data;i.setAll(Jl(t)),i.setAll(r),e.convertToFoundDocument(Xl(e),i).setHasLocalMutations()}}(t,e,n):function(t,e){Gl(t.precondition,e)&&e.convertToNoDocument(oc.min())}(t,e)}function Zl(t,e){for(var n=null,r=0,i=t.fieldTransforms;r<i.length;r++){var o=i[r],s=e.data.field(o.field),a=Pl(o.transform,s||null);null!=a&&(null==n&&(n=Bc.empty()),n.set(o.field,a))}return n||null}function Kl(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&nc(t,e,function(t,e){return function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Rl&&e instanceof Rl||t instanceof Ll&&e instanceof Ll?nc(t.elements,e.elements,Ic):t instanceof zl&&e instanceof zl?Ic(t.A,e.A):t instanceof Dl&&e instanceof Dl}(t.transform,e.transform)}(t,e)})}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}function Xl(t){return t.isFoundDocument()?t.version:oc.min()}var Yl=function(t){function e(e,n,r,i){void 0===i&&(i=[]);var o=this;return(o=t.call(this)||this).key=e,o.value=n,o.precondition=r,o.fieldTransforms=i,o.type=0,o}return Object(He.c)(e,t),e}($l),Ql=function(t){function e(e,n,r,i,o){void 0===o&&(o=[]);var s=this;return(s=t.call(this)||this).key=e,s.data=n,s.fieldMask=r,s.precondition=i,s.fieldTransforms=o,s.type=1,s}return Object(He.c)(e,t),e}($l);function Jl(t){var e=new Map;return t.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=t.data.field(n);e.set(n,r)}}),e}function tu(t,e,n){var r=new Map;Ya(t.length===n.length);for(var i=0;i<n.length;i++){var o=t[i],s=o.transform,a=e.data.field(o.field);r.set(o.field,Ol(s,a,n[i]))}return r}function eu(t,e,n){for(var r=new Map,i=0,o=t;i<o.length;i++){var s=o[i],a=s.transform,c=n.data.field(s.field);r.set(s.field,Ml(a,c,e))}return r}var nu,ru,iu=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=2,r.fieldTransforms=[],r}return Object(He.c)(e,t),e}($l),ou=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).key=e,r.precondition=n,r.type=3,r.fieldTransforms=[],r}return Object(He.c)(e,t),e}($l),su=function(t){this.count=t};function au(t){switch(t){case Va.OK:return Xa();case Va.CANCELLED:case Va.UNKNOWN:case Va.DEADLINE_EXCEEDED:case Va.RESOURCE_EXHAUSTED:case Va.INTERNAL:case Va.UNAVAILABLE:case Va.UNAUTHENTICATED:return!1;case Va.INVALID_ARGUMENT:case Va.NOT_FOUND:case Va.ALREADY_EXISTS:case Va.PERMISSION_DENIED:case Va.FAILED_PRECONDITION:case Va.ABORTED:case Va.OUT_OF_RANGE:case Va.UNIMPLEMENTED:case Va.DATA_LOSS:return!0;default:return Xa()}}function cu(t){if(void 0===t)return Ha("GRPC error has no .code"),Va.UNKNOWN;switch(t){case nu.OK:return Va.OK;case nu.CANCELLED:return Va.CANCELLED;case nu.UNKNOWN:return Va.UNKNOWN;case nu.DEADLINE_EXCEEDED:return Va.DEADLINE_EXCEEDED;case nu.RESOURCE_EXHAUSTED:return Va.RESOURCE_EXHAUSTED;case nu.INTERNAL:return Va.INTERNAL;case nu.UNAVAILABLE:return Va.UNAVAILABLE;case nu.UNAUTHENTICATED:return Va.UNAUTHENTICATED;case nu.INVALID_ARGUMENT:return Va.INVALID_ARGUMENT;case nu.NOT_FOUND:return Va.NOT_FOUND;case nu.ALREADY_EXISTS:return Va.ALREADY_EXISTS;case nu.PERMISSION_DENIED:return Va.PERMISSION_DENIED;case nu.FAILED_PRECONDITION:return Va.FAILED_PRECONDITION;case nu.ABORTED:return Va.ABORTED;case nu.OUT_OF_RANGE:return Va.OUT_OF_RANGE;case nu.UNIMPLEMENTED:return Va.UNIMPLEMENTED;case nu.DATA_LOSS:return Va.DATA_LOSS;default:return Xa()}}(ru=nu||(nu={}))[ru.OK=0]="OK",ru[ru.CANCELLED=1]="CANCELLED",ru[ru.UNKNOWN=2]="UNKNOWN",ru[ru.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",ru[ru.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",ru[ru.NOT_FOUND=5]="NOT_FOUND",ru[ru.ALREADY_EXISTS=6]="ALREADY_EXISTS",ru[ru.PERMISSION_DENIED=7]="PERMISSION_DENIED",ru[ru.UNAUTHENTICATED=16]="UNAUTHENTICATED",ru[ru.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",ru[ru.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",ru[ru.ABORTED=10]="ABORTED",ru[ru.OUT_OF_RANGE=11]="OUT_OF_RANGE",ru[ru.UNIMPLEMENTED=12]="UNIMPLEMENTED",ru[ru.INTERNAL=13]="INTERNAL",ru[ru.UNAVAILABLE=14]="UNAVAILABLE",ru[ru.DATA_LOSS=15]="DATA_LOSS";var lu=function(){function t(t,e){this.comparator=t,this.root=e||hu.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,hu.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,hu.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!1,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new uu(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new uu(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new uu(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new uu(this.root,t,this.comparator,!0)},t}(),uu=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),hu=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Xa();if(this.right.isRed())throw Xa();var t=this.left.check();if(t!==this.right.check())throw Xa();return t+(this.isRed()?0:1)},t}();hu.EMPTY=null,hu.RED=!0,hu.BLACK=!1,hu.EMPTY=new(function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Xa()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Xa()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Xa()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Xa()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Xa()},enumerable:!1,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new hu(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}());var du=function(){function t(t){this.comparator=t,this.data=new lu(this.comparator)}return t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!1,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new pu(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new pu(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return e.size<t.size&&(e=t,t=this),t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),pu=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),fu=new lu(Ec.comparator);function mu(){return fu}var gu=new lu(Ec.comparator);function _u(){return gu}var yu=new lu(Ec.comparator);function vu(){return yu}var bu=new du(Ec.comparator);function xu(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=bu,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var wu=new du(ec);function Tu(){return wu}var Cu=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r=new Map;return r.set(e,Eu.createSynthesizedTargetChangeForCurrentChange(e,n)),new t(oc.min(),r,Tu(),mu(),xu())},t}(),Eu=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(fc.EMPTY_BYTE_STRING,n,xu(),xu(),xu())},t}(),Su=function(t,e,n,r){this.v=t,this.removedTargetIds=e,this.key=n,this.P=r},Iu=function(t,e){this.targetId=t,this.V=e},ku=function(t,e,n,r){void 0===n&&(n=fc.EMPTY_BYTE_STRING),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r},Au=function(){function t(){this.S=0,this.D=Pu(),this.C=fc.EMPTY_BYTE_STRING,this.N=!1,this.k=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this.N},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this.C},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"F",{get:function(){return 0!==this.S},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"$",{get:function(){return this.k},enumerable:!1,configurable:!0}),t.prototype.O=function(t){t.approximateByteSize()>0&&(this.k=!0,this.C=t)},t.prototype.M=function(){var t=xu(),e=xu(),n=xu();return this.D.forEach(function(r,i){switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Xa()}}),new Eu(this.C,this.N,t,e,n)},t.prototype.L=function(){this.k=!1,this.D=Pu()},t.prototype.B=function(t,e){this.k=!0,this.D=this.D.insert(t,e)},t.prototype.q=function(t){this.k=!0,this.D=this.D.remove(t)},t.prototype.U=function(){this.S+=1},t.prototype.K=function(){this.S-=1},t.prototype.j=function(){this.k=!0,this.N=!0},t}(),Mu=function(){function t(t){this.W=t,this.G=new Map,this.H=mu(),this.J=Ou(),this.Y=new du(ec)}return t.prototype.X=function(t){for(var e=0,n=t.v;e<n.length;e++){var r=n[e];t.P&&t.P.isFoundDocument()?this.Z(r,t.P):this.tt(r,t.key,t.P)}for(var i=0,o=t.removedTargetIds;i<o.length;i++)this.tt(r=o[i],t.key,t.P)},t.prototype.et=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.nt(n);switch(t.state){case 0:e.st(n)&&r.O(t.resumeToken);break;case 1:r.K(),r.F||r.L(),r.O(t.resumeToken);break;case 2:r.K(),r.F||e.removeTarget(n);break;case 3:e.st(n)&&(r.j(),r.O(t.resumeToken));break;case 4:e.st(n)&&(e.it(n),r.O(t.resumeToken));break;default:Xa()}})},t.prototype.forEachTarget=function(t,e){var n=this;t.targetIds.length>0?t.targetIds.forEach(e):this.G.forEach(function(t,r){n.st(r)&&e(r)})},t.prototype.rt=function(t){var e=t.targetId,n=t.V.count,r=this.ot(e);if(r){var i=r.target;if(Hc(i))if(0===n){var o=new Ec(i.path);this.tt(e,o,Vc.newNoDocument(o,oc.min()))}else Ya(1===n);else this.ct(e)!==n&&(this.it(e),this.Y=this.Y.add(e))}},t.prototype.ut=function(t){var e=this,n=new Map;this.G.forEach(function(r,i){var o=e.ot(i);if(o){if(r.current&&Hc(o.target)){var s=new Ec(o.target.path);null!==e.H.get(s)||e.at(i,s)||e.tt(i,s,Vc.newNoDocument(s,t))}r.$&&(n.set(i,r.M()),r.L())}});var r=xu();this.J.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.ot(t);return!n||2===n.purpose||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Cu(t,n,this.Y,this.H,r);return this.H=mu(),this.J=Ou(),this.Y=new du(ec),i},t.prototype.Z=function(t,e){if(this.st(t)){var n=this.at(t,e.key)?2:0;this.nt(t).B(e.key,n),this.H=this.H.insert(e.key,e),this.J=this.J.insert(e.key,this.ht(e.key).add(t))}},t.prototype.tt=function(t,e,n){if(this.st(t)){var r=this.nt(t);this.at(t,e)?r.B(e,1):r.q(e),this.J=this.J.insert(e,this.ht(e).delete(t)),n&&(this.H=this.H.insert(e,n))}},t.prototype.removeTarget=function(t){this.G.delete(t)},t.prototype.ct=function(t){var e=this.nt(t).M();return this.W.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.U=function(t){this.nt(t).U()},t.prototype.nt=function(t){var e=this.G.get(t);return e||(e=new Au,this.G.set(t,e)),e},t.prototype.ht=function(t){var e=this.J.get(t);return e||(e=new du(ec),this.J=this.J.insert(t,e)),e},t.prototype.st=function(t){var e=null!==this.ot(t);return e||Wa("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.ot=function(t){var e=this.G.get(t);return e&&e.F?null:this.W.lt(t)},t.prototype.it=function(t){var e=this;this.G.set(t,new Au),this.W.getRemoteKeysForTarget(t).forEach(function(n){e.tt(t,n,null)})},t.prototype.at=function(t,e){return this.W.getRemoteKeysForTarget(t).has(e)},t}();function Ou(){return new lu(Ec.comparator)}function Pu(){return new lu(Ec.comparator)}var Du={asc:"ASCENDING",desc:"DESCENDING"},Ru={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},Nu=function(t,e){this.databaseId=t,this.I=e};function Lu(t,e){return t.I?new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")+"."+("000000000"+e.nanoseconds).slice(-9)+"Z":{seconds:""+e.seconds,nanos:e.nanoseconds}}function ju(t,e){return t.I?e.toBase64():e.toUint8Array()}function zu(t,e){return Lu(t,e.toTimestamp())}function Fu(t){return Ya(!!t),oc.fromTimestamp(function(t){var e=gc(t);return new ic(e.seconds,e.nanos)}(t))}function Bu(t,e){return function(t){return new uc(["projects",t.projectId,"databases",t.database])}(t).child("documents").child(e).canonicalString()}function Uu(t){var e=uc.fromString(t);return Ya(hh(e)),e}function Vu(t,e){return Bu(t.databaseId,e.path)}function qu(t,e){var n=Uu(e);if(n.get(1)!==t.databaseId.projectId)throw new qa(Va.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new qa(Va.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new Ec(Hu(n))}function Gu(t,e){return Bu(t.databaseId,e)}function $u(t){var e=Uu(t);return 4===e.length?uc.emptyPath():Hu(e)}function Wu(t){return new uc(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function Hu(t){return Ya(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Zu(t,e,n){return{name:Vu(t,e),fields:n.value.mapValue.fields}}function Ku(t,e,n){var r=qu(t,e.name),i=Fu(e.updateTime),o=new Bc({mapValue:{fields:e.fields}}),s=Vc.newFoundDocument(r,i,o);return n&&s.setHasCommittedMutations(),n?s.setHasCommittedMutations():s}function Xu(t,e){var n;if(e instanceof Yl)n={update:Zu(t,e.key,e.value)};else if(e instanceof iu)n={delete:Vu(t,e.key)};else if(e instanceof Ql)n={update:Zu(t,e.key,e.data),updateMask:uh(e.fieldMask)};else{if(!(e instanceof ou))return Xa();n={verify:Vu(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map(function(t){return function(t,e){var n=e.transform;if(n instanceof Dl)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Rl)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Ll)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof zl)return{fieldPath:e.field.canonicalString(),increment:n.A};throw Xa()}(0,t)})),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:zu(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Xa()}(t,e.precondition)),n}function Yu(t,e){var n=e.currentDocument?function(t){return void 0!==t.updateTime?ql.updateTime(Fu(t.updateTime)):void 0!==t.exists?ql.exists(t.exists):ql.none()}(e.currentDocument):ql.none(),r=e.updateTransforms?e.updateTransforms.map(function(e){return function(t,e){var n=null;"setToServerValue"in e?(Ya("REQUEST_TIME"===e.setToServerValue),n=new Dl):"appendMissingElements"in e?n=new Rl(e.appendMissingElements.values||[]):"removeAllFromArray"in e?n=new Ll(e.removeAllFromArray.values||[]):"increment"in e?n=new zl(t,e.increment):Xa();var r=dc.fromServerFormat(e.fieldPath);return new Ul(r,n)}(t,e)}):[];if(e.update){var i=qu(t,e.update.name),o=new Bc({mapValue:{fields:e.update.fields}});if(e.updateMask){var s=function(t){return new pc((t.fieldPaths||[]).map(function(t){return dc.fromServerFormat(t)}))}(e.updateMask);return new Ql(i,o,s,n,r)}return new Yl(i,o,n,r)}if(e.delete){var a=qu(t,e.delete);return new iu(a,n)}if(e.verify){var c=qu(t,e.verify);return new ou(c,n)}return Xa()}function Qu(t,e){return{documents:[Gu(t,e.path)]}}function Ju(t,e){var n={structuredQuery:{}},r=e.path;null!==e.collectionGroup?(n.parent=Gu(t,r),n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(n.parent=Gu(t,r.popLast()),n.structuredQuery.from=[{collectionId:r.lastSegment()}]);var i=function(t){if(0!==t.length){var e=t.map(function(t){return function(t){if("=="===t.op){if(jc(t.value))return{unaryFilter:{field:sh(t.field),op:"IS_NAN"}};if(Lc(t.value))return{unaryFilter:{field:sh(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(jc(t.value))return{unaryFilter:{field:sh(t.field),op:"IS_NOT_NAN"}};if(Lc(t.value))return{unaryFilter:{field:sh(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:sh(t.field),op:oh(t.op),value:t.value}}}(t)});return 1===e.length?e[0]:{compositeFilter:{op:"AND",filters:e}}}}(e.filters);i&&(n.structuredQuery.where=i);var o=function(t){if(0!==t.length)return t.map(function(t){return function(t){return{field:sh(t.field),direction:ih(t.dir)}}(t)})}(e.orderBy);o&&(n.structuredQuery.orderBy=o);var s=function(t,e){return t.I||wc(e)?e:{value:e}}(t,e.limit);return null!==s&&(n.structuredQuery.limit=s),e.startAt&&(n.structuredQuery.startAt=nh(e.startAt)),e.endAt&&(n.structuredQuery.endAt=nh(e.endAt)),n}function th(t){var e=$u(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){Ya(1===r);var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var s=[];n.where&&(s=eh(n.where));var a=[];n.orderBy&&(a=n.orderBy.map(function(t){return function(t){return new ol(ah(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)}));var c=null;n.limit&&(c=function(t){var e;return wc(e="object"==typeof t?t.value:t)?null:e}(n.limit));var l=null;n.startAt&&(l=rh(n.startAt));var u=null;return n.endAt&&(u=rh(n.endAt)),ul(e,i,a,s,c,"F",l,u)}function eh(t){return t?void 0!==t.unaryFilter?[lh(t)]:void 0!==t.fieldFilter?[ch(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return eh(t)}).reduce(function(t,e){return t.concat(e)}):Xa():[]}function nh(t){return{before:t.before,values:t.position}}function rh(t){return new rl(t.values||[],!!t.before)}function ih(t){return Du[t]}function oh(t){return Ru[t]}function sh(t){return{fieldPath:t.canonicalString()}}function ah(t){return dc.fromServerFormat(t.fieldPath)}function ch(t){return Zc.create(ah(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":default:return Xa()}}(t.fieldFilter.op),t.fieldFilter.value)}function lh(t){switch(t.unaryFilter.op){case"IS_NAN":var e=ah(t.unaryFilter.field);return Zc.create(e,"==",{doubleValue:NaN});case"IS_NULL":var n=ah(t.unaryFilter.field);return Zc.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":var r=ah(t.unaryFilter.field);return Zc.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":var i=ah(t.unaryFilter.field);return Zc.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":default:return Xa()}}function uh(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}}function hh(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}function dh(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=fh(e)),e=ph(t.get(n),e);return fh(e)}function ph(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+="\x01\x10";break;case"\x01":n+="\x01\x11";break;default:n+=o}}return n}function fh(t){return t+"\x01\x01"}function mh(t){var e=t.length;if(Ya(e>=2),2===e)return Ya("\x01"===t.charAt(0)&&"\x01"===t.charAt(1)),uc.emptyPath();for(var n=e-2,r=[],i="",o=0;o<e;){var s=t.indexOf("\x01",o);switch((s<0||s>n)&&Xa(),t.charAt(s+1)){case"\x01":var a=t.substring(o,s),c=void 0;0===i.length?c=a:(c=i+=a,i=""),r.push(c);break;case"\x10":i+=t.substring(o,s),i+="\0";break;case"\x11":i+=t.substring(o,s+1);break;default:Xa()}o=s+2}return new uc(r)}var gh=function(t,e){this.seconds=t,this.nanoseconds=e},_h=function(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n};_h.store="owner",_h.key="owner";var yh=function(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n};yh.store="mutationQueues",yh.keyPath="userId";var vh=function(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i};vh.store="mutations",vh.keyPath="batchId",vh.userMutationsIndex="userMutationsIndex",vh.userMutationsKeyPath=["userId","batchId"];var bh=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,dh(e)]},t.key=function(t,e,n){return[t,dh(e),n]},t}();bh.store="documentMutations",bh.PLACEHOLDER=new bh;var xh=function(t,e){this.path=t,this.readTime=e},wh=function(t,e){this.path=t,this.version=e},Th=function(t,e,n,r,i,o){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r,this.readTime=i,this.parentPath=o};Th.store="remoteDocuments",Th.readTimeIndex="readTimeIndex",Th.readTimeIndexPath="readTime",Th.collectionReadTimeIndex="collectionReadTimeIndex",Th.collectionReadTimeIndexPath=["parentPath","readTime"];var Ch=function(t){this.byteSize=t};Ch.store="remoteDocumentGlobal",Ch.key="remoteDocumentGlobalKey";var Eh=function(t,e,n,r,i,o,s){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.lastLimboFreeSnapshotVersion=o,this.query=s};Eh.store="targets",Eh.keyPath="targetId",Eh.queryTargetsIndexName="queryTargetsIndex",Eh.queryTargetsKeyPath=["canonicalId","targetId"];var Sh=function(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n};Sh.store="targetDocuments",Sh.keyPath=["targetId","path"],Sh.documentTargetsIndex="documentTargetsIndex",Sh.documentTargetsKeyPath=["path","targetId"];var Ih=function(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r};Ih.key="targetGlobalKey",Ih.store="targetGlobal";var kh=function(t,e){this.collectionId=t,this.parent=e};kh.store="collectionParents",kh.keyPath=["collectionId","parent"];var Ah=function(t,e,n,r){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r};Ah.store="clientMetadata",Ah.keyPath="clientId";var Mh=function(t,e,n){this.bundleId=t,this.createTime=e,this.version=n};Mh.store="bundles",Mh.keyPath="bundleId";var Oh=function(t,e,n){this.name=t,this.readTime=e,this.bundledQuery=n};Oh.store="namedQueries",Oh.keyPath="name";var Ph=Object(He.f)(Object(He.f)([],Object(He.f)(Object(He.f)([],Object(He.f)(Object(He.f)([],Object(He.f)(Object(He.f)([],[yh.store,vh.store,bh.store,Th.store,Eh.store,_h.store,Ih.store,Sh.store]),[Ah.store])),[Ch.store])),[kh.store])),[Mh.store,Oh.store]),Dh="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Rh=function(){function t(){this.onCommittedListeners=[]}return t.prototype.addOnCommittedListener=function(t){this.onCommittedListeners.push(t)},t.prototype.raiseOnCommittedEvent=function(){this.onCommittedListeners.forEach(function(t){return t()})},t}(),Nh=function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})},Lh=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Xa(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++)r(o[i]);return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),jh=function(){function t(t,e){var n=this;this.action=t,this.transaction=e,this.aborted=!1,this.ft=new Nh,this.transaction.oncomplete=function(){n.ft.resolve()},this.transaction.onabort=function(){e.error?n.ft.reject(new Bh(t,e.error)):n.ft.resolve()},this.transaction.onerror=function(e){var r=$h(e.target.error);n.ft.reject(new Bh(t,r))}}return t.open=function(e,n,r,i){try{return new t(n,e.transaction(i,r))}catch(e){throw new Bh(n,e)}},Object.defineProperty(t.prototype,"dt",{get:function(){return this.ft.promise},enumerable:!1,configurable:!0}),t.prototype.abort=function(t){t&&this.ft.reject(t),this.aborted||(Wa("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return new Vh(e)},t}(),zh=function(){function t(e,n,r){this.name=e,this.version=n,this.wt=r,12.2===t._t(Object(Ze.p)())&&Ha("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.delete=function(t){return Wa("SimpleDb","Removing database:",t),qh(window.indexedDB.deleteDatabase(t)).toPromise()},t.yt=function(){if("undefined"==typeof indexedDB)return!1;if(t.gt())return!0;var e=Object(Ze.p)(),n=t._t(e),r=0<n&&n<10,i=t.Et(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.gt=function(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.env)||void 0===t?void 0:t.Tt)},t.It=function(t,e){return t.store(e)},t._t=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.Et=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.At=function(t){return Object(He.b)(this,void 0,void 0,function(){var e,n=this;return Object(He.d)(this,function(r){switch(r.label){case 0:return this.db?[3,2]:(Wa("SimpleDb","Opening database:",this.name),e=this,[4,new Promise(function(e,r){var i=indexedDB.open(n.name,n.version);i.onsuccess=function(t){e(t.target.result)},i.onblocked=function(){r(new Bh(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},i.onerror=function(e){var n=e.target.error;r("VersionError"===n.name?new qa(Va.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh."):new Bh(t,n))},i.onupgradeneeded=function(t){Wa("SimpleDb",'Database "'+n.name+'" requires upgrade from version:',t.oldVersion),n.wt.Rt(t.target.result,i.transaction,t.oldVersion,n.version).next(function(){Wa("SimpleDb","Database upgrade to version "+n.version+" complete")})}})]);case 1:e.db=r.sent(),r.label=2;case 2:return[2,(this.bt&&(this.db.onversionchange=function(t){return n.bt(t)}),this.db)]}})})},t.prototype.vt=function(t){this.bt=t,this.db&&(this.db.onversionchange=function(e){return t(e)})},t.prototype.runTransaction=function(t,e,n,r){return Object(He.b)(this,void 0,void 0,function(){var i,o,s,a,c;return Object(He.d)(this,function(l){switch(l.label){case 0:i="readonly"===e,o=0,s=function(){var e,s,c,l,u;return Object(He.d)(this,function(h){switch(h.label){case 0:++o,h.label=1;case 1:return h.trys.push([1,4,,5]),[4,a.At(t)];case 2:return a.db=h.sent(),e=jh.open(a.db,t,i?"readonly":"readwrite",n),s=r(e).catch(function(t){return e.abort(t),Lh.reject(t)}).toPromise(),c={},s.catch(function(){}),[4,e.dt];case 3:return[2,(c.value=(h.sent(),s),c)];case 4:return Wa("SimpleDb","Transaction failed with error:",(l=h.sent()).message,"Retrying:",u="FirebaseError"!==l.name&&o<3),a.close(),u?[3,5]:[2,{value:Promise.reject(l)}];case 5:return[2]}})},a=this,l.label=1;case 1:return[5,s()];case 2:if("object"==typeof(c=l.sent()))return[2,c.value];l.label=3;case 3:return[3,1];case 4:return[2]}})})},t.prototype.close=function(){this.db&&this.db.close(),this.db=void 0},t}(),Fh=function(){function t(t){this.Pt=t,this.Vt=!1,this.St=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.Vt},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Dt",{get:function(){return this.St},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.Pt=t},enumerable:!1,configurable:!0}),t.prototype.done=function(){this.Vt=!0},t.prototype.Ct=function(t){this.St=t},t.prototype.delete=function(){return qh(this.Pt.delete())},t}(),Bh=function(t){function e(e,n){var r=this;return(r=t.call(this,Va.UNAVAILABLE,"IndexedDB transaction '"+e+"' failed: "+n)||this).name="IndexedDbTransactionError",r}return Object(He.c)(e,t),e}(qa);function Uh(t){return"IndexedDbTransactionError"===t.name}var Vh=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(Wa("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(Wa("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),qh(n)},t.prototype.add=function(t){return Wa("SimpleDb","ADD",this.store.name,t,t),qh(this.store.add(t))},t.prototype.get=function(t){var e=this;return qh(this.store.get(t)).next(function(n){return void 0===n&&(n=null),Wa("SimpleDb","GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return Wa("SimpleDb","DELETE",this.store.name,t),qh(this.store.delete(t))},t.prototype.count=function(){return Wa("SimpleDb","COUNT",this.store.name),qh(this.store.count())},t.prototype.Nt=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.xt(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.kt=function(t,e){Wa("SimpleDb","DELETE ALL",this.store.name);var n=this.options(t,e);n.Ft=!1;var r=this.cursor(n);return this.xt(r,function(t,e,n){return n.delete()})},t.prototype.$t=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.xt(r,e)},t.prototype.Ot=function(t){var e=this.cursor({});return new Lh(function(n,r){e.onerror=function(t){var e=$h(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.xt=function(t,e){var n=[];return new Lh(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new Fh(i),s=e(i.primaryKey,i.value,o);if(s instanceof Lh){var a=s.catch(function(t){return o.done(),Lh.reject(t)});n.push(a)}o.isDone?r():null===o.Dt?i.continue():i.continue(o.Dt)}else r()}}).next(function(){return Lh.waitFor(n)})},t.prototype.options=function(t,e){var n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.Ft?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function qh(t){return new Lh(function(e,n){t.onsuccess=function(t){e(t.target.result)},t.onerror=function(t){var e=$h(t.target.error);n(e)}})}var Gh=!1;function $h(t){var e=zh._t(Object(Ze.p)());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new qa("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return Gh||(Gh=!0,setTimeout(function(){throw r},0)),r}}return t}var Wh=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Mt=e,r.currentSequenceNumber=n,r}return Object(He.c)(e,t),e}(Rh);function Hh(t,e){var n=Qa(t);return zh.It(n.Mt,e)}var Zh=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}return t.prototype.applyToRemoteDocument=function(t,e){for(var n=e.mutationResults,r=0;r<this.mutations.length;r++){var i=this.mutations[r];i.key.isEqual(t.key)&&Wl(i,t,n[r])}},t.prototype.applyToLocalView=function(t){for(var e=0,n=this.baseMutations;e<n.length;e++)(o=n[e]).key.isEqual(t.key)&&Hl(o,t,this.localWriteTime);for(var r=0,i=this.mutations;r<i.length;r++){var o;(o=i[r]).key.isEqual(t.key)&&Hl(o,t,this.localWriteTime)}},t.prototype.applyToLocalDocumentSet=function(t){var e=this;this.mutations.forEach(function(n){var r=t.get(n.key),i=r;e.applyToLocalView(i),r.isValidDocument()||i.convertToNoDocument(oc.min())})},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},xu())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&nc(this.mutations,t.mutations,function(t,e){return Kl(t,e)})&&nc(this.baseMutations,t.baseMutations,function(t,e){return Kl(t,e)})},t}(),Kh=function(){function t(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}return t.from=function(e,n,r){Ya(e.mutations.length===r.length);for(var i=vu(),o=e.mutations,s=0;s<o.length;s++)i=i.insert(o[s].key,r[s].version);return new t(e,n,r,i)},t}(),Xh=function(){function t(t,e,n,r,i,o,s){void 0===i&&(i=oc.min()),void 0===o&&(o=oc.min()),void 0===s&&(s=fc.EMPTY_BYTE_STRING),this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=o,this.resumeToken=s}return t.prototype.withSequenceNumber=function(e){return new t(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,n,this.lastLimboFreeSnapshotVersion,e)},t.prototype.withLastLimboFreeSnapshotVersion=function(e){return new t(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken)},t}(),Yh=function(t){this.Lt=t};function Qh(t,e){if(e.document)return Ku(t.Lt,e.document,!!e.hasCommittedMutations);if(e.noDocument){var n=Ec.fromSegments(e.noDocument.path),r=rd(e.noDocument.readTime),i=Vc.newNoDocument(n,r);return e.hasCommittedMutations?i.setHasCommittedMutations():i}if(e.unknownDocument){var o=Ec.fromSegments(e.unknownDocument.path);return r=rd(e.unknownDocument.version),Vc.newUnknownDocument(o,r)}return Xa()}function Jh(t,e,n){var r=td(n),i=e.key.path.popLast().toArray();if(e.isFoundDocument()){var o=function(t,e){return{name:Vu(t,e.key),fields:e.data.value.mapValue.fields,updateTime:Lu(t,e.version.toTimestamp())}}(t.Lt,e),s=e.hasCommittedMutations;return new Th(null,null,o,s,r,i)}if(e.isNoDocument()){var a=e.key.path.toArray(),c=nd(e.version);return s=e.hasCommittedMutations,new Th(null,new xh(a,c),null,s,r,i)}if(e.isUnknownDocument()){var l=e.key.path.toArray(),u=nd(e.version);return new Th(new wh(l,u),null,null,!0,r,i)}return Xa()}function td(t){var e=t.toTimestamp();return[e.seconds,e.nanoseconds]}function ed(t){var e=new ic(t[0],t[1]);return oc.fromTimestamp(e)}function nd(t){var e=t.toTimestamp();return new gh(e.seconds,e.nanoseconds)}function rd(t){var e=new ic(t.seconds,t.nanoseconds);return oc.fromTimestamp(e)}function id(t,e){for(var n=(e.baseMutations||[]).map(function(e){return Yu(t.Lt,e)}),r=0;r<e.mutations.length-1;++r)r+1<e.mutations.length&&void 0!==e.mutations[r+1].transform&&(e.mutations[r].updateTransforms=e.mutations[r+1].transform.fieldTransforms,e.mutations.splice(r+1,1),++r);var i=e.mutations.map(function(e){return Yu(t.Lt,e)}),o=ic.fromMillis(e.localWriteTimeMs);return new Zh(e.batchId,o,n,i)}function od(t){var e,n,r=rd(t.readTime),i=void 0!==t.lastLimboFreeSnapshotVersion?rd(t.lastLimboFreeSnapshotVersion):oc.min();return void 0!==t.query.documents?(Ya(1===(n=t.query).documents.length),e=yl(hl($u(n.documents[0])))):e=function(t){return yl(th(t))}(t.query),new Xh(e,t.targetId,0,t.lastListenSequenceNumber,r,i,fc.fromBase64String(t.resumeToken))}function sd(t,e){var n,r=nd(e.snapshotVersion),i=nd(e.lastLimboFreeSnapshotVersion);n=Hc(e.target)?Qu(t.Lt,e.target):Ju(t.Lt,e.target);var o=e.resumeToken.toBase64();return new Eh(e.targetId,$c(e.target),r,o,e.sequenceNumber,i,n)}function ad(t){var e=th({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?vl(e,e.limit,"L"):e}var cd=function(){function t(){}return t.prototype.getBundleMetadata=function(t,e){return ld(t).get(e).next(function(t){if(t)return{id:(e=t).bundleId,createTime:rd(e.createTime),version:e.version};var e})},t.prototype.saveBundleMetadata=function(t,e){return ld(t).put({bundleId:(n=e).id,createTime:nd(Fu(n.createTime)),version:n.version});var n},t.prototype.getNamedQuery=function(t,e){return ud(t).get(e).next(function(t){if(t)return{name:(e=t).name,query:ad(e.bundledQuery),readTime:rd(e.readTime)};var e})},t.prototype.saveNamedQuery=function(t,e){return ud(t).put(function(t){return{name:t.name,readTime:nd(Fu(t.readTime)),bundledQuery:t.bundledQuery}}(e))},t}();function ld(t){return Hh(t,Mh.store)}function ud(t){return Hh(t,Oh.store)}var hd=function(){function t(){this.Bt=new dd}return t.prototype.addToCollectionParentIndex=function(t,e){return this.Bt.add(e),Lh.resolve()},t.prototype.getCollectionParents=function(t,e){return Lh.resolve(this.Bt.getEntries(e))},t}(),dd=function(){function t(){this.index={}}return t.prototype.add=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new du(uc.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.has=function(t){var e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)},t.prototype.getEntries=function(t){return(this.index[t]||new du(uc.comparator)).toArray()},t}(),pd=function(){function t(){this.qt=new dd}return t.prototype.addToCollectionParentIndex=function(t,e){var n=this;if(!this.qt.has(e)){var r=e.lastSegment(),i=e.popLast();t.addOnCommittedListener(function(){n.qt.add(e)});var o={collectionId:r,parent:dh(i)};return fd(t).put(o)}return Lh.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[rc(e),""],!1,!0);return fd(t).Nt(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(mh(o.parent))}return n})},t}();function fd(t){return Hh(t,kh.store)}var md={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},gd=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t}();function _d(t,e,n){var r=t.store(vh.store),i=t.store(bh.store),o=[],s=IDBKeyRange.only(n.batchId),a=0,c=r.$t({range:s},function(t,e,n){return a++,n.delete()});o.push(c.next(function(){Ya(1===a)}));for(var l=[],u=0,h=n.mutations;u<h.length;u++){var d=h[u],p=bh.key(e,d.key.path,n.batchId);o.push(i.delete(p)),l.push(d.key)}return Lh.waitFor(o).next(function(){return l})}function yd(t){if(!t)return 0;var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Xa();e=t.noDocument}return JSON.stringify(e).length}gd.DEFAULT_COLLECTION_PERCENTILE=10,gd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,gd.DEFAULT=new gd(41943040,gd.DEFAULT_COLLECTION_PERCENTILE,gd.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),gd.DISABLED=new gd(-1,0,0);var vd=function(){function t(t,e,n,r){this.userId=t,this.R=e,this.Ut=n,this.referenceDelegate=r,this.Kt={}}return t.Qt=function(e,n,r,i){return Ya(""!==e.uid),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return xd(t).$t({index:vh.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=wd(t),s=xd(t);return s.add({}).next(function(a){Ya("number"==typeof a);for(var c=new Zh(a,e,n,r),l=function(t,e,n){var r=n.baseMutations.map(function(e){return Xu(t.Lt,e)}),i=n.mutations.map(function(e){return Xu(t.Lt,e)});return new vh(e,n.batchId,n.localWriteTime.toMillis(),r,i)}(i.R,i.userId,c),u=[],h=new du(function(t,e){return ec(t.canonicalString(),e.canonicalString())}),d=0,p=r;d<p.length;d++){var f=p[d],m=bh.key(i.userId,f.key.path,a);h=h.add(f.key.path.popLast()),u.push(s.put(l)),u.push(o.put(m,bh.PLACEHOLDER))}return h.forEach(function(e){u.push(i.Ut.addToCollectionParentIndex(t,e))}),t.addOnCommittedListener(function(){i.Kt[a]=c.keys()}),Lh.waitFor(u).next(function(){return c})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return xd(t).get(e).next(function(t){return t?(Ya(t.userId===n.userId),id(n.R,t)):null})},t.prototype.jt=function(t,e){var n=this;return this.Kt[e]?Lh.resolve(this.Kt[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.Kt[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return xd(t).$t({index:vh.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(Ya(e.batchId>=r),o=id(n.R,e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return xd(t).$t({index:vh.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return xd(t).Nt(vh.userMutationsIndex,n).next(function(t){return t.map(function(t){return id(e.R,t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=bh.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return wd(t).$t({range:i},function(r,i,s){var a=r[0],c=r[2],l=mh(r[1]);if(a===n.userId&&e.path.isEqual(l))return xd(t).get(c).next(function(t){if(!t)throw Xa();Ya(t.userId===n.userId),o.push(id(n.R,t))});s.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new du(ec),i=[];return e.forEach(function(e){var o=bh.prefixForPath(n.userId,e.path),s=IDBKeyRange.lowerBound(o),a=wd(t).$t({range:s},function(t,i,o){var s=t[0],a=t[2],c=mh(t[1]);s===n.userId&&e.path.isEqual(c)?r=r.add(a):o.done()});i.push(a)}),Lh.waitFor(i).next(function(){return n.Wt(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this,r=e.path,i=r.length+1,o=bh.prefixForPath(this.userId,r),s=IDBKeyRange.lowerBound(o),a=new du(ec);return wd(t).$t({range:s},function(t,e,o){var s=t[0],c=t[2],l=mh(t[1]);s===n.userId&&r.isPrefixOf(l)?l.length===i&&(a=a.add(c)):o.done()}).next(function(){return n.Wt(t,a)})},t.prototype.Wt=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(xd(t).get(e).next(function(t){if(null===t)throw Xa();Ya(t.userId===n.userId),r.push(id(n.R,t))}))}),Lh.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return _d(t.Mt,this.userId,e).next(function(r){return t.addOnCommittedListener(function(){n.Gt(e.batchId)}),Lh.forEach(r,function(e){return n.referenceDelegate.markPotentiallyOrphaned(t,e)})})},t.prototype.Gt=function(t){delete this.Kt[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return Lh.resolve();var r=IDBKeyRange.lowerBound(bh.prefixForUser(e.userId)),i=[];return wd(t).$t({range:r},function(t,n,r){if(t[0]===e.userId){var o=mh(t[1]);i.push(o)}else r.done()}).next(function(){Ya(0===i.length)})})},t.prototype.containsKey=function(t,e){return bd(t,this.userId,e)},t.prototype.zt=function(t){var e=this;return Td(t).get(this.userId).next(function(t){return t||new yh(e.userId,-1,"")})},t}();function bd(t,e,n){var r=bh.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),s=!1;return wd(t).$t({range:o,Ft:!0},function(t,n,r){t[0]===e&&t[1]===i&&(s=!0),r.done()}).next(function(){return s})}function xd(t){return Hh(t,vh.store)}function wd(t){return Hh(t,bh.store)}function Td(t){return Hh(t,yh.store)}var Cd=function(){function t(t){this.Ht=t}return t.prototype.next=function(){return this.Ht+=2,this.Ht},t.Jt=function(){return new t(0)},t.Yt=function(){return new t(-1)},t}(),Ed=function(){function t(t,e){this.referenceDelegate=t,this.R=e}return t.prototype.allocateTargetId=function(t){var e=this;return this.Xt(t).next(function(n){var r=new Cd(n.highestTargetId);return n.highestTargetId=r.next(),e.Zt(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.Xt(t).next(function(t){return oc.fromTimestamp(new ic(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return this.Xt(t).next(function(t){return t.highestListenSequenceNumber})},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.Xt(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.Zt(t,i)})},t.prototype.addTargetData=function(t,e){var n=this;return this.te(t,e).next(function(){return n.Xt(t).next(function(r){return r.targetCount+=1,n.ee(e,r),n.Zt(t,r)})})},t.prototype.updateTargetData=function(t,e){return this.te(t,e)},t.prototype.removeTargetData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return Sd(t).delete(e.targetId)}).next(function(){return n.Xt(t)}).next(function(e){return Ya(e.targetCount>0),e.targetCount-=1,n.Zt(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return Sd(t).$t(function(s,a){var c=od(a);c.sequenceNumber<=e&&null===n.get(c.targetId)&&(i++,o.push(r.removeTargetData(t,c)))}).next(function(){return Lh.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){return Sd(t).$t(function(t,n){var r=od(n);e(r)})},t.prototype.Xt=function(t){return Id(t).get(Ih.key).next(function(t){return Ya(null!==t),t})},t.prototype.Zt=function(t,e){return Id(t).put(Ih.key,e)},t.prototype.te=function(t,e){return Sd(t).put(sd(this.R,e))},t.prototype.ee=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getTargetCount=function(t){return this.Xt(t).next(function(t){return t.targetCount})},t.prototype.getTargetData=function(t,e){var n=$c(e),r=IDBKeyRange.bound([n,Number.NEGATIVE_INFINITY],[n,Number.POSITIVE_INFINITY]),i=null;return Sd(t).$t({range:r,index:Eh.queryTargetsIndexName},function(t,n,r){var o=od(n);Wc(e,o.target)&&(i=o,r.done())}).next(function(){return i})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=kd(t);return e.forEach(function(e){var s=dh(e.path);i.push(o.put(new Sh(n,s))),i.push(r.referenceDelegate.addReference(t,n,e))}),Lh.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=kd(t);return Lh.forEach(e,function(e){var o=dh(e.path);return Lh.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,n,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=kd(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=kd(t),i=xu();return r.$t({range:n,Ft:!0},function(t,e,n){var r=mh(t[1]),o=new Ec(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=dh(e.path),r=IDBKeyRange.bound([n],[rc(n)],!1,!0),i=0;return kd(t).$t({index:Sh.documentTargetsIndex,Ft:!0,range:r},function(t,e,n){0!==t[0]&&(i++,n.done())}).next(function(){return i>0})},t.prototype.lt=function(t,e){return Sd(t).get(e).next(function(t){return t?od(t):null})},t}();function Sd(t){return Hh(t,Eh.store)}function Id(t){return Hh(t,Ih.store)}function kd(t){return Hh(t,Sh.store)}function Ad(t){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(e){if(t.code!==Va.FAILED_PRECONDITION||t.message!==Dh)throw t;return Wa("LocalStore","Unexpectedly lost primary lease"),[2]})})}function Md(t,e){var n=t[1],r=e[1],i=ec(t[0],e[0]);return 0===i?ec(n,r):i}var Od=function(){function t(t){this.ne=t,this.buffer=new du(Md),this.se=0}return t.prototype.ie=function(){return++this.se},t.prototype.re=function(t){var e=[t,this.ie()];if(this.buffer.size<this.ne)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();Md(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!1,configurable:!0}),t}(),Pd=function(){function t(t,e){this.garbageCollector=t,this.asyncQueue=e,this.oe=!1,this.ce=null}return t.prototype.start=function(t){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.ue(t)},t.prototype.stop=function(){this.ce&&(this.ce.cancel(),this.ce=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.ce},enumerable:!1,configurable:!0}),t.prototype.ue=function(t){var e=this,n=this.oe?3e5:6e4;Wa("LruGarbageCollector","Garbage collection scheduled in "+n+"ms"),this.ce=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",n,function(){return Object(He.b)(e,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:this.ce=null,this.oe=!0,n.label=1;case 1:return n.trys.push([1,3,,7]),[4,t.collectGarbage(this.garbageCollector)];case 2:return n.sent(),[3,7];case 3:return Uh(e=n.sent())?(Wa("LruGarbageCollector","Ignoring IndexedDB error during garbage collection: ",e),[3,6]):[3,4];case 4:return[4,Ad(e)];case 5:n.sent(),n.label=6;case 6:return[3,7];case 7:return[4,this.ue(t)];case 8:return n.sent(),[2]}})})})},t}(),Dd=function(){function t(t,e){this.ae=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.ae.he(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return Lh.resolve(Ua.o);var r=new Od(e);return this.ae.forEachTarget(t,function(t){return r.re(t.sequenceNumber)}).next(function(){return n.ae.le(t,function(t){return r.re(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.ae.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.ae.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return-1===this.params.cacheSizeCollectionThreshold?(Wa("LruGarbageCollector","Garbage collection skipped; disabled"),Lh.resolve(md)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(Wa("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),md):n.fe(t,e)})},t.prototype.getCacheSize=function(t){return this.ae.getCacheSize(t)},t.prototype.fe=function(t,e){var n,r,i,o,s,a,c,l=this,u=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>l.params.maximumSequenceNumbersToCollect?(Wa("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+l.params.maximumSequenceNumbersToCollect+" from "+e),r=l.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),l.nthSequenceNumber(t,r)}).next(function(r){return n=r,s=Date.now(),l.removeTargets(t,n,e)}).next(function(e){return i=e,a=Date.now(),l.removeOrphanedDocuments(t,n)}).next(function(t){return c=Date.now(),$a()<=Pr.a.DEBUG&&Wa("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-u)+"ms\n\tDetermined least recently used "+r+" in "+(s-o)+"ms\n\tRemoved "+i+" targets in "+(a-s)+"ms\n\tRemoved "+t+" documents in "+(c-a)+"ms\nTotal Duration: "+(c-u)+"ms"),Lh.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Rd=function(){function t(t,e){this.db=t,this.garbageCollector=function(t,e){return new Dd(t,e)}(this,e)}return t.prototype.he=function(t){var e=this.de(t);return this.db.getTargetCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.de=function(t){var e=0;return this.le(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getTargetCache().forEachTarget(t,e)},t.prototype.le=function(t,e){return this.we(t,function(t,n){return e(n)})},t.prototype.addReference=function(t,e,n){return Nd(t,n)},t.prototype.removeReference=function(t,e,n){return Nd(t,n)},t.prototype.removeTargets=function(t,e,n){return this.db.getTargetCache().removeTargets(t,e,n)},t.prototype.markPotentiallyOrphaned=function(t,e){return Nd(t,e)},t.prototype._e=function(t,e){return function(t,e){var n=!1;return Td(t).Ot(function(r){return bd(t,r,e).next(function(t){return t&&(n=!0),Lh.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.we(t,function(s,a){if(a<=e){var c=n._e(t,s).next(function(e){if(!e)return o++,r.getEntry(t,s).next(function(){return r.removeEntry(s),kd(t).delete([0,dh(s.path)])})});i.push(c)}}).next(function(){return Lh.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getTargetCache().updateTargetData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Nd(t,e)},t.prototype.we=function(t,e){var n,r=kd(t),i=Ua.o;return r.$t({index:Sh.documentTargetsIndex},function(t,r){var o=r.path,s=r.sequenceNumber;0===t[0]?(i!==Ua.o&&e(new Ec(mh(n)),i),i=s,n=o):i=Ua.o}).next(function(){i!==Ua.o&&e(new Ec(mh(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Nd(t,e){return kd(t).put(function(t,e){return new Sh(0,dh(t.path),e)}(e,t.currentSequenceNumber))}var Ld=function(){function t(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],s=o[1];if(this.equalsFn(o[0],t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(this.equalsFn(r[i][0],t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){ac(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];t(o[0],o[1])}})},t.prototype.isEmpty=function(){return cc(this.inner)},t}(),jd=function(){function t(){this.changes=new Ld(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),this.changesApplied=!1}return t.prototype.getReadTime=function(t){var e=this.changes.get(t);return e?e.readTime:oc.min()},t.prototype.addEntry=function(t,e){this.assertNotApplied(),this.changes.set(t.key,{document:t,readTime:e})},t.prototype.removeEntry=function(t,e){void 0===e&&(e=null),this.assertNotApplied(),this.changes.set(t,{document:Vc.newInvalidDocument(t),readTime:e})},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?Lh.resolve(n.document):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){},t}(),zd=function(){function t(t,e){this.R=t,this.Ut=e}return t.prototype.addEntry=function(t,e,n){return Ud(t).put(Vd(e),n)},t.prototype.removeEntry=function(t,e){var n=Ud(t),r=Vd(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e){var n=this;return this.getMetadata(t).next(function(r){return r.byteSize+=e,n.me(t,r)})},t.prototype.getEntry=function(t,e){var n=this;return Ud(t).get(Vd(e)).next(function(t){return n.ye(e,t)})},t.prototype.ge=function(t,e){var n=this;return Ud(t).get(Vd(e)).next(function(t){return{document:n.ye(e,t),size:yd(t)}})},t.prototype.getEntries=function(t,e){var n=this,r=mu();return this.pe(t,e,function(t,e){var i=n.ye(t,e);r=r.insert(t,i)}).next(function(){return r})},t.prototype.Ee=function(t,e){var n=this,r=mu(),i=new lu(Ec.comparator);return this.pe(t,e,function(t,e){var o=n.ye(t,e);r=r.insert(t,o),i=i.insert(t,yd(e))}).next(function(){return{documents:r,Te:i}})},t.prototype.pe=function(t,e,n){if(e.isEmpty())return Lh.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return Ud(t).$t({range:r},function(t,e,r){for(var s=Ec.fromSegments(t);o&&Ec.comparator(o,s)<0;)n(o,null),o=i.getNext();o&&o.isEqual(s)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.Ct(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){var r=this,i=mu(),o=e.path.length+1,s={};if(n.isEqual(oc.min())){var a=e.path.toArray();s.range=IDBKeyRange.lowerBound(a)}else{var c=e.path.toArray(),l=td(n);s.range=IDBKeyRange.lowerBound([c,l],!0),s.index=Th.collectionReadTimeIndex}return Ud(t).$t(s,function(t,n,s){if(t.length===o){var a=Qh(r.R,n);e.path.isPrefixOf(a.key.path)?Tl(e,a)&&(i=i.insert(a.key,a)):s.done()}}).next(function(){return i})},t.prototype.newChangeBuffer=function(t){return new Fd(this,!!t&&t.trackRemovals)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return Bd(t).get(Ch.key).next(function(t){return Ya(!!t),t})},t.prototype.me=function(t,e){return Bd(t).put(Ch.key,e)},t.prototype.ye=function(t,e){if(e){var n=Qh(this.R,e);if(!n.isNoDocument()||!n.version.isEqual(oc.min()))return n}return Vc.newInvalidDocument(t)},t}(),Fd=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).Ie=e,r.trackRemovals=n,r.Ae=new Ld(function(t){return t.toString()},function(t,e){return t.isEqual(e)}),r}return Object(He.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=new du(function(t,e){return ec(t.canonicalString(),e.canonicalString())});return this.changes.forEach(function(o,s){var a=e.Ae.get(o);if(s.document.isValidDocument()){var c=Jh(e.Ie.R,s.document,e.getReadTime(o));i=i.add(o.path.popLast());var l=yd(c);r+=l-a,n.push(e.Ie.addEntry(t,o,c))}else if(r-=a,e.trackRemovals){var u=Jh(e.Ie.R,Vc.newNoDocument(o,oc.min()),e.getReadTime(o));n.push(e.Ie.addEntry(t,o,u))}else n.push(e.Ie.removeEntry(t,o))}),i.forEach(function(r){n.push(e.Ie.Ut.addToCollectionParentIndex(t,r))}),n.push(this.Ie.updateMetadata(t,r)),Lh.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.Ie.ge(t,e).next(function(t){return n.Ae.set(e,t.size),t.document})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.Ie.Ee(t,e).next(function(t){var e=t.documents;return t.Te.forEach(function(t,e){n.Ae.set(t,e)}),e})},e}(jd);function Bd(t){return Hh(t,Ch.store)}function Ud(t){return Hh(t,Th.store)}function Vd(t){return t.path.toArray()}var qd=function(){function t(t){this.R=t}return t.prototype.Rt=function(t,e,n,r){var i=this;Ya(n<r&&n>=0&&r<=11);var o=new jh("createOrUpgrade",e);n<1&&r>=1&&(function(t){t.createObjectStore(_h.store)}(t),function(t){t.createObjectStore(yh.store,{keyPath:yh.keyPath}),t.createObjectStore(vh.store,{keyPath:vh.keyPath,autoIncrement:!0}).createIndex(vh.userMutationsIndex,vh.userMutationsKeyPath,{unique:!0}),t.createObjectStore(bh.store)}(t),Gd(t),function(t){t.createObjectStore(Th.store)}(t));var s=Lh.resolve();return n<3&&r>=3&&(0!==n&&(function(t){t.deleteObjectStore(Sh.store),t.deleteObjectStore(Eh.store),t.deleteObjectStore(Ih.store)}(t),Gd(t)),s=s.next(function(){return function(t){var e=t.store(Ih.store),n=new Ih(0,0,oc.min().toTimestamp(),0);return e.put(Ih.key,n)}(o)})),n<4&&r>=4&&(0!==n&&(s=s.next(function(){return function(t,e){return e.store(vh.store).Nt().next(function(n){t.deleteObjectStore(vh.store),t.createObjectStore(vh.store,{keyPath:vh.keyPath,autoIncrement:!0}).createIndex(vh.userMutationsIndex,vh.userMutationsKeyPath,{unique:!0});var r=e.store(vh.store),i=n.map(function(t){return r.put(t)});return Lh.waitFor(i)})}(t,o)})),s=s.next(function(){!function(t){t.createObjectStore(Ah.store,{keyPath:Ah.keyPath})}(t)})),n<5&&r>=5&&(s=s.next(function(){return i.Re(o)})),n<6&&r>=6&&(s=s.next(function(){return function(t){t.createObjectStore(Ch.store)}(t),i.be(o)})),n<7&&r>=7&&(s=s.next(function(){return i.ve(o)})),n<8&&r>=8&&(s=s.next(function(){return i.Pe(t,o)})),n<9&&r>=9&&(s=s.next(function(){!function(t){t.objectStoreNames.contains("remoteDocumentChanges")&&t.deleteObjectStore("remoteDocumentChanges")}(t),function(t){var e=t.objectStore(Th.store);e.createIndex(Th.readTimeIndex,Th.readTimeIndexPath,{unique:!1}),e.createIndex(Th.collectionReadTimeIndex,Th.collectionReadTimeIndexPath,{unique:!1})}(e)})),n<10&&r>=10&&(s=s.next(function(){return i.Ve(o)})),n<11&&r>=11&&(s=s.next(function(){!function(t){t.createObjectStore(Mh.store,{keyPath:Mh.keyPath})}(t),function(t){t.createObjectStore(Oh.store,{keyPath:Oh.keyPath})}(t)})),s},t.prototype.be=function(t){var e=0;return t.store(Th.store).$t(function(t,n){e+=yd(n)}).next(function(){var n=new Ch(e);return t.store(Ch.store).put(Ch.key,n)})},t.prototype.Re=function(t){var e=this,n=t.store(yh.store),r=t.store(vh.store);return n.Nt().next(function(n){return Lh.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.Nt(vh.userMutationsIndex,i).next(function(r){return Lh.forEach(r,function(r){Ya(r.userId===n.userId);var i=id(e.R,r);return _d(t,n.userId,i).next(function(){})})})})})},t.prototype.ve=function(t){var e=t.store(Sh.store),n=t.store(Th.store);return t.store(Ih.store).get(Ih.key).next(function(t){var r=[];return n.$t(function(n,i){var o=new uc(n),s=function(t){return[0,dh(t)]}(o);r.push(e.get(s).next(function(n){return n?Lh.resolve():function(n){return e.put(new Sh(0,dh(n),t.highestListenSequenceNumber))}(o)}))}).next(function(){return Lh.waitFor(r)})})},t.prototype.Pe=function(t,e){t.createObjectStore(kh.store,{keyPath:kh.keyPath});var n=e.store(kh.store),r=new dd,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:dh(i)})}};return e.store(Th.store).$t({Ft:!0},function(t,e){var n=new uc(t);return i(n.popLast())}).next(function(){return e.store(bh.store).$t({Ft:!0},function(t,e){var n=mh(t[1]);return i(n.popLast())})})},t.prototype.Ve=function(t){var e=this,n=t.store(Eh.store);return n.$t(function(t,r){var i=od(r),o=sd(e.R,i);return n.put(o)})},t}();function Gd(t){t.createObjectStore(Sh.store,{keyPath:Sh.keyPath}).createIndex(Sh.documentTargetsIndex,Sh.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Eh.store,{keyPath:Eh.keyPath}).createIndex(Eh.queryTargetsIndexName,Eh.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Ih.store)}var $d="Failed to obtain exclusive access to the persistence layer. To allow shared access, multi-tab synchronization has to be enabled in all tabs. If you are using `experimentalForceOwningTab:true`, make sure that only one tab has persistence enabled at any given time.",Wd=function(){function t(e,n,r,i,o,s,a,c,l,u){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.Se=o,this.window=s,this.document=a,this.De=l,this.Ce=u,this.Ne=null,this.xe=!1,this.isPrimary=!1,this.networkEnabled=!0,this.ke=null,this.inForeground=!1,this.Fe=null,this.$e=null,this.Oe=Number.NEGATIVE_INFINITY,this.Me=function(t){return Promise.resolve()},!t.yt())throw new qa(Va.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");this.referenceDelegate=new Rd(this,i),this.Le=n+"main",this.R=new Yh(c),this.Be=new zh(this.Le,11,new qd(this.R)),this.qe=new Ed(this.referenceDelegate,this.R),this.Ut=new pd,this.Ue=function(t,e){return new zd(t,e)}(this.R,this.Ut),this.Ke=new cd,this.window&&this.window.localStorage?this.Qe=this.window.localStorage:(this.Qe=null,!1===u&&Ha("IndexedDbPersistence","LocalStorage is unavailable. As a result, persistence may not work reliably. In particular enablePersistence() could fail immediately after refreshing the page."))}return t.prototype.start=function(){var t=this;return this.je().then(function(){if(!t.isPrimary&&!t.allowTabSynchronization)throw new qa(Va.FAILED_PRECONDITION,$d);return t.We(),t.Ge(),t.ze(),t.runTransaction("getHighestListenSequenceNumber","readonly",function(e){return t.qe.getHighestSequenceNumber(e)})}).then(function(e){t.Ne=new Ua(e,t.De)}).then(function(){t.xe=!0}).catch(function(e){return t.Be&&t.Be.close(),Promise.reject(e)})},t.prototype.He=function(t){var e=this;return this.Me=function(n){return Object(He.b)(e,void 0,void 0,function(){return Object(He.d)(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.Be.vt(function(n){return Object(He.b)(e,void 0,void 0,function(){return Object(He.d)(this,function(e){switch(e.label){case 0:return null===n.newVersion?[4,t()]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.Se.enqueueAndForget(function(){return Object(He.b)(e,void 0,void 0,function(){return Object(He.d)(this,function(t){switch(t.label){case 0:return this.started?[4,this.je()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.je=function(){var t=this;return this.runTransaction("updateClientMetadataAndTryBecomePrimary","readwrite",function(e){return Zd(e).put(new Ah(t.clientId,Date.now(),t.networkEnabled,t.inForeground)).next(function(){if(t.isPrimary)return t.Je(e).next(function(e){e||(t.isPrimary=!1,t.Se.enqueueRetryable(function(){return t.Me(!1)}))})}).next(function(){return t.Ye(e)}).next(function(n){return t.isPrimary&&!n?t.Xe(e).next(function(){return!1}):!!n&&t.Ze(e).next(function(){return!0})})}).catch(function(e){if(Uh(e))return Wa("IndexedDbPersistence","Failed to extend owner lease: ",e),t.isPrimary;if(!t.allowTabSynchronization)throw e;return Wa("IndexedDbPersistence","Releasing owner lease after error during lease refresh",e),!1}).then(function(e){t.isPrimary!==e&&t.Se.enqueueRetryable(function(){return t.Me(e)}),t.isPrimary=e})},t.prototype.Je=function(t){var e=this;return Hd(t).get(_h.key).next(function(t){return Lh.resolve(e.tn(t))})},t.prototype.en=function(t){return Zd(t).delete(this.clientId)},t.prototype.nn=function(){return Object(He.b)(this,void 0,void 0,function(){var t,e,n,r=this;return Object(He.d)(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.sn(this.Oe,18e5)?[3,2]:(this.Oe=Date.now(),[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(t){var e=Hh(t,Ah.store);return e.Nt().next(function(t){var n=r.rn(t,18e5),i=t.filter(function(t){return-1===n.indexOf(t)});return Lh.forEach(i,function(t){return e.delete(t.clientId)}).next(function(){return i})})}).catch(function(){return[]})]);case 1:if(t=i.sent(),this.Qe)for(e=0,n=t;e<n.length;e++)this.Qe.removeItem(this.on(n[e].clientId));i.label=2;case 2:return[2]}})})},t.prototype.ze=function(){var t=this;this.$e=this.Se.enqueueAfterDelay("client_metadata_refresh",4e3,function(){return t.je().then(function(){return t.nn()}).then(function(){return t.ze()})})},t.prototype.tn=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.Ye=function(t){var e=this;return this.Ce?Lh.resolve(!0):Hd(t).get(_h.key).next(function(n){if(null!==n&&e.sn(n.leaseTimestampMs,5e3)&&!e.cn(n.ownerId)){if(e.tn(n)&&e.networkEnabled)return!0;if(!e.tn(n)){if(!n.allowTabSynchronization)throw new qa(Va.FAILED_PRECONDITION,$d);return!1}}return!(!e.networkEnabled||!e.inForeground)||Zd(t).Nt().next(function(t){return void 0===e.rn(t,5e3).find(function(t){return!(e.clientId===t.clientId||!(!e.networkEnabled&&t.networkEnabled||!e.inForeground&&t.inForeground&&e.networkEnabled===t.networkEnabled))})})}).next(function(t){return e.isPrimary!==t&&Wa("IndexedDbPersistence","Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return Object(He.b)(this,void 0,void 0,function(){var t=this;return Object(He.d)(this,function(e){switch(e.label){case 0:return this.xe=!1,this.un(),this.$e&&(this.$e.cancel(),this.$e=null),this.an(),this.hn(),[4,this.Be.runTransaction("shutdown","readwrite",[_h.store,Ah.store],function(e){var n=new Wh(e,Ua.o);return t.Xe(n).next(function(){return t.en(n)})})];case 1:return e.sent(),this.Be.close(),this.ln(),[2]}})})},t.prototype.rn=function(t,e){var n=this;return t.filter(function(t){return n.sn(t.updateTimeMs,e)&&!n.cn(t.clientId)})},t.prototype.fn=function(){var t=this;return this.runTransaction("getActiveClients","readonly",function(e){return Zd(e).Nt().next(function(e){return t.rn(e,18e5).map(function(t){return t.clientId})})})},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.getMutationQueue=function(t){return vd.Qt(t,this.R,this.Ut,this.referenceDelegate)},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r,i=this;return Wa("IndexedDbPersistence","Starting transaction:",t),this.Be.runTransaction(t,"readonly"===e?"readonly":"readwrite",Ph,function(o){return r=new Wh(o,i.Ne?i.Ne.next():Ua.o),"readwrite-primary"===e?i.Je(r).next(function(t){return!!t||i.Ye(r)}).next(function(e){if(!e)throw Ha("Failed to obtain primary lease for action '"+t+"'."),i.isPrimary=!1,i.Se.enqueueRetryable(function(){return i.Me(!1)}),new qa(Va.FAILED_PRECONDITION,Dh);return n(r)}).next(function(t){return i.Ze(r).next(function(){return t})}):i.dn(r).next(function(){return n(r)})}).then(function(t){return r.raiseOnCommittedEvent(),t})},t.prototype.dn=function(t){var e=this;return Hd(t).get(_h.key).next(function(t){if(null!==t&&e.sn(t.leaseTimestampMs,5e3)&&!e.cn(t.ownerId)&&!e.tn(t)&&!(e.Ce||e.allowTabSynchronization&&t.allowTabSynchronization))throw new qa(Va.FAILED_PRECONDITION,$d)})},t.prototype.Ze=function(t){var e=new _h(this.clientId,this.allowTabSynchronization,Date.now());return Hd(t).put(_h.key,e)},t.yt=function(){return zh.yt()},t.prototype.Xe=function(t){var e=this,n=Hd(t);return n.get(_h.key).next(function(t){return e.tn(t)?(Wa("IndexedDbPersistence","Releasing primary lease."),n.delete(_h.key)):Lh.resolve()})},t.prototype.sn=function(t,e){var n=Date.now();return!(t<n-e||t>n&&(Ha("Detected an update time that is in the future: "+t+" > "+n),1))},t.prototype.We=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.Fe=function(){t.Se.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.je()})},this.document.addEventListener("visibilitychange",this.Fe),this.inForeground="visible"===this.document.visibilityState)},t.prototype.an=function(){this.Fe&&(this.document.removeEventListener("visibilitychange",this.Fe),this.Fe=null)},t.prototype.Ge=function(){var t,e=this;"function"==typeof(null===(t=this.window)||void 0===t?void 0:t.addEventListener)&&(this.ke=function(){e.un(),Object(Ze.A)()&&navigator.appVersion.match("Version/14")&&e.Se.enterRestrictedMode(!0),e.Se.enqueueAndForget(function(){return e.shutdown()})},this.window.addEventListener("pagehide",this.ke))},t.prototype.hn=function(){this.ke&&(this.window.removeEventListener("pagehide",this.ke),this.ke=null)},t.prototype.cn=function(t){var e;try{var n=null!==(null===(e=this.Qe)||void 0===e?void 0:e.getItem(this.on(t)));return Wa("IndexedDbPersistence","Client '"+t+"' "+(n?"is":"is not")+" zombied in LocalStorage"),n}catch(t){return Ha("IndexedDbPersistence","Failed to get zombied client id.",t),!1}},t.prototype.un=function(){if(this.Qe)try{this.Qe.setItem(this.on(this.clientId),String(Date.now()))}catch(t){Ha("Failed to set zombie client id.",t)}},t.prototype.ln=function(){if(this.Qe)try{this.Qe.removeItem(this.on(this.clientId))}catch(t){}},t.prototype.on=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t}();function Hd(t){return Hh(t,_h.store)}function Zd(t){return Hh(t,Ah.store)}function Kd(t,e){var n=t.projectId;return t.isDefaultDatabase||(n+="."+t.database),"firestore/"+e+"/"+n+"/"}var Xd=function(t,e){this.progress=t,this.wn=e},Yd=function(){function t(t,e,n){this.Ue=t,this._n=e,this.Ut=n}return t.prototype.mn=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.yn(t,e,r)})},t.prototype.yn=function(t,e,n){return this.Ue.getEntry(t,e).next(function(t){for(var e=0,r=n;e<r.length;e++)r[e].applyToLocalView(t);return t})},t.prototype.gn=function(t,e){t.forEach(function(t,n){for(var r=0,i=e;r<i.length;r++)i[r].applyToLocalView(n)})},t.prototype.pn=function(t,e){var n=this;return this.Ue.getEntries(t,e).next(function(e){return n.En(t,e).next(function(){return e})})},t.prototype.En=function(t,e){var n=this;return this._n.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(t){return n.gn(e,t)})},t.prototype.getDocumentsMatchingQuery=function(t,e,n){return function(t){return Ec.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.Tn(t,e.path):gl(e)?this.In(t,e,n):this.An(t,e,n)},t.prototype.Tn=function(t,e){return this.mn(t,new Ec(e)).next(function(t){var e=_u();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e})},t.prototype.In=function(t,e,n){var r=this,i=e.collectionGroup,o=_u();return this.Ut.getCollectionParents(t,i).next(function(s){return Lh.forEach(s,function(s){var a=function(t,e){return new ll(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,s.child(i));return r.An(t,a,n).next(function(t){t.forEach(function(t,e){o=o.insert(t,e)})})}).next(function(){return o})})},t.prototype.An=function(t,e,n){var r,i,o=this;return this.Ue.getDocumentsMatchingQuery(t,e,n).next(function(n){return r=n,o._n.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return o.Rn(t,i=e,r).next(function(t){r=t;for(var e=0,n=i;e<n.length;e++)for(var o=n[e],s=0,a=o.mutations;s<a.length;s++){var c=a[s],l=c.key,u=r.get(l);null==u&&(u=Vc.newInvalidDocument(l),r=r.insert(l,u)),Hl(c,u,o.localWriteTime),u.isFoundDocument()||(r=r.remove(l))}})}).next(function(){return r.forEach(function(t,n){Tl(e,n)||(r=r.remove(t))}),r})},t.prototype.Rn=function(t,e,n){for(var r=xu(),i=0,o=e;i<o.length;i++)for(var s=0,a=o[i].mutations;s<a.length;s++){var c=a[s];c instanceof Ql&&null===n.get(c.key)&&(r=r.add(c.key))}var l=n;return this.Ue.getEntries(t,r).next(function(t){return t.forEach(function(t,e){e.isFoundDocument()&&(l=l.insert(t,e))}),l})},t}(),Qd=function(){function t(t,e,n,r){this.targetId=t,this.fromCache=e,this.bn=n,this.vn=r}return t.Pn=function(e,n){for(var r=xu(),i=xu(),o=0,s=n.docChanges;o<s.length;o++){var a=s[o];switch(a.type){case 0:r=r.add(a.doc.key);break;case 1:i=i.add(a.doc.key)}}return new t(e,n.fromCache,r,i)},t}(),Jd=function(){function t(){}return t.prototype.Vn=function(t){this.Sn=t},t.prototype.getDocumentsMatchingQuery=function(t,e,n,r){var i=this;return function(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}(e)||n.isEqual(oc.min())?this.Dn(t,e):this.Sn.pn(t,r).next(function(o){var s=i.Cn(e,o);return(dl(e)||pl(e))&&i.Nn(e.limitType,s,r,n)?i.Dn(t,e):($a()<=Pr.a.DEBUG&&Wa("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),wl(e)),i.Sn.getDocumentsMatchingQuery(t,e,n).next(function(t){return s.forEach(function(e){t=t.insert(e.key,e)}),t}))})},t.prototype.Cn=function(t,e){var n=new du(Cl(t));return e.forEach(function(e,r){Tl(t,r)&&(n=n.add(r))}),n},t.prototype.Nn=function(t,e,n,r){if(n.size!==e.size)return!0;var i="F"===t?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)},t.prototype.Dn=function(t,e){return $a()<=Pr.a.DEBUG&&Wa("QueryEngine","Using full collection scan to execute query:",wl(e)),this.Sn.getDocumentsMatchingQuery(t,e,oc.min())},t}(),tp=function(){function t(t,e,n,r){this.persistence=t,this.xn=e,this.R=r,this.kn=new lu(ec),this.Fn=new Ld(function(t){return $c(t)},Wc),this.$n=oc.min(),this._n=t.getMutationQueue(n),this.On=t.getRemoteDocumentCache(),this.qe=t.getTargetCache(),this.Mn=new Yd(this.On,this._n,this.persistence.getIndexManager()),this.Ke=t.getBundleCache(),this.xn.Vn(this.Mn)}return t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.kn)})},t}();function ep(t,e,n,r){return new tp(t,e,n,r)}function np(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(He.d)(this,function(s){switch(s.label){case 0:return n=Qa(t),r=n._n,i=n.Mn,[4,n.persistence.runTransaction("Handle user change","readonly",function(t){var o;return n._n.getAllMutationBatches(t).next(function(s){return o=s,r=n.persistence.getMutationQueue(e),i=new Yd(n.On,r,n.persistence.getIndexManager()),r.getAllMutationBatches(t)}).next(function(e){for(var n=[],r=[],s=xu(),a=0,c=o;a<c.length;a++){var l=c[a];n.push(l.batchId);for(var u=0,h=l.mutations;u<h.length;u++)s=s.add(h[u].key)}for(var d=0,p=e;d<p.length;d++){var f=p[d];r.push(f.batchId);for(var m=0,g=f.mutations;m<g.length;m++)s=s.add(g[m].key)}return i.pn(t,s).next(function(t){return{Ln:t,removedBatchIds:n,addedBatchIds:r}})})})];case 1:return o=s.sent(),[2,(n._n=r,n.Mn=i,n.xn.Vn(n.Mn),o)]}})})}function rp(t,e){var n=Qa(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(t){var r=e.batch.keys(),i=n.On.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){var i=n.batch,o=i.keys(),s=Lh.resolve();return o.forEach(function(t){s=s.next(function(){return r.getEntry(e,t)}).next(function(e){var o=n.docVersions.get(t);Ya(null!==o),e.version.compareTo(o)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&r.addEntry(e,n.commitVersion))})}),s.next(function(){return t._n.removeMutationBatch(e,i)})}(n,t,e,i).next(function(){return i.apply(t)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}function ip(t){var e=Qa(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",function(t){return e.qe.getLastRemoteSnapshotVersion(t)})}function op(t,e){var n=Qa(t),r=e.snapshotVersion,i=n.kn;return n.persistence.runTransaction("Apply remote event","readwrite-primary",function(t){var o=n.On.newChangeBuffer({trackRemovals:!0});i=n.kn;var s=[];e.targetChanges.forEach(function(e,o){var a=i.get(o);if(a){s.push(n.qe.removeMatchingKeys(t,e.removedDocuments,o).next(function(){return n.qe.addMatchingKeys(t,e.addedDocuments,o)}));var c=e.resumeToken;if(c.approximateByteSize()>0){var l=a.withResumeToken(c,r).withSequenceNumber(t.currentSequenceNumber);i=i.insert(o,l),function(t,e,n){return Ya(e.resumeToken.approximateByteSize()>0),0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(a,l,e)&&s.push(n.qe.updateTargetData(t,l))}}});var a=mu();if(e.documentUpdates.forEach(function(r,i){e.resolvedLimboDocuments.has(r)&&s.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))}),s.push(sp(t,o,e.documentUpdates,r,void 0).next(function(t){a=t})),!r.isEqual(oc.min())){var c=n.qe.getLastRemoteSnapshotVersion(t).next(function(e){return n.qe.setTargetsMetadata(t,t.currentSequenceNumber,r)});s.push(c)}return Lh.waitFor(s).next(function(){return o.apply(t)}).next(function(){return n.Mn.En(t,a)}).next(function(){return a})}).then(function(t){return n.kn=i,t})}function sp(t,e,n,r,i){var o=xu();return n.forEach(function(t){return o=o.add(t)}),e.getEntries(t,o).next(function(t){var o=mu();return n.forEach(function(n,s){var a=t.get(n),c=(null==i?void 0:i.get(n))||r;s.isNoDocument()&&s.version.isEqual(oc.min())?(e.removeEntry(n,c),o=o.insert(n,s)):!a.isValidDocument()||s.version.compareTo(a.version)>0||0===s.version.compareTo(a.version)&&a.hasPendingWrites?(e.addEntry(s,c),o=o.insert(n,s)):Wa("LocalStore","Ignoring outdated watch update for ",n,". Current version:",a.version," Watch version:",s.version)}),o})}function ap(t,e){var n=Qa(t);return n.persistence.runTransaction("Get next mutation batch","readonly",function(t){return void 0===e&&(e=-1),n._n.getNextMutationBatchAfterBatchId(t,e)})}function cp(t,e){var n=Qa(t);return n.persistence.runTransaction("Allocate target","readwrite",function(t){var r;return n.qe.getTargetData(t,e).next(function(i){return i?Lh.resolve(r=i):n.qe.allocateTargetId(t).next(function(i){return r=new Xh(e,i,0,t.currentSequenceNumber),n.qe.addTargetData(t,r).next(function(){return r})})})}).then(function(t){var r=n.kn.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.kn=n.kn.insert(t.targetId,t),n.Fn.set(e,t.targetId)),t})}function lp(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(He.d)(this,function(a){switch(a.label){case 0:r=Qa(t),i=r.kn.get(e),o=n?"readwrite":"readwrite-primary",a.label=1;case 1:return a.trys.push([1,4,,5]),n?[3,3]:[4,r.persistence.runTransaction("Release target",o,function(t){return r.persistence.referenceDelegate.removeTarget(t,i)})];case 2:a.sent(),a.label=3;case 3:return[3,5];case 4:if(!Uh(s=a.sent()))throw s;return Wa("LocalStore","Failed to update sequence numbers for target "+e+": "+s),[3,5];case 5:return r.kn=r.kn.remove(e),r.Fn.delete(i.target),[2]}})})}function up(t,e,n){var r=Qa(t),i=oc.min(),o=xu();return r.persistence.runTransaction("Execute query","readonly",function(t){return function(t,e,n){var r=Qa(t),i=r.Fn.get(n);return void 0!==i?Lh.resolve(r.kn.get(i)):r.qe.getTargetData(e,n)}(r,t,yl(e)).next(function(e){if(e)return i=e.lastLimboFreeSnapshotVersion,r.qe.getMatchingKeysForTargetId(t,e.targetId).next(function(t){o=t})}).next(function(){return r.xn.getDocumentsMatchingQuery(t,e,n?i:oc.min(),n?o:xu())}).next(function(t){return{documents:t,Bn:o}})})}function hp(t,e){var n=Qa(t),r=Qa(n.qe),i=n.kn.get(e);return i?Promise.resolve(i.target):n.persistence.runTransaction("Get target data","readonly",function(t){return r.lt(t,e).next(function(t){return t?t.target:null})})}function dp(t){var e=Qa(t);return e.persistence.runTransaction("Get new document changes","readonly",function(t){return function(t,e,n){var r=Qa(t),i=mu(),o=td(n),s=Ud(e),a=IDBKeyRange.lowerBound(o,!0);return s.$t({index:Th.readTimeIndex,range:a},function(t,e){var n=Qh(r.R,e);i=i.insert(n.key,n),o=e.readTime}).next(function(){return{wn:i,readTime:ed(o)}})}(e.On,t,e.$n)}).then(function(t){var n=t.wn;return e.$n=t.readTime,n})}function pp(t){return Object(He.b)(this,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){return[2,(e=Qa(t)).persistence.runTransaction("Synchronize last document change read time","readonly",function(t){return function(t){var e=Ud(t),n=oc.min();return e.$t({index:Th.readTimeIndex,reverse:!0},function(t,e,r){e.readTime&&(n=ed(e.readTime)),r.done()}).next(function(){return n})}(t)}).then(function(t){e.$n=t})]})})}function fp(t,e,n,r){return Object(He.b)(this,void 0,void 0,function(){var i,o,s,a,c,l,u,h,d,p;return Object(He.d)(this,function(f){switch(f.label){case 0:for(i=Qa(t),o=xu(),s=mu(),a=vu(),c=0,l=n;c<l.length;c++)h=e.qn((u=l[c]).metadata.name),u.document&&(o=o.add(h)),s=s.insert(h,e.Un(u)),a=a.insert(h,e.Kn(u.metadata.readTime));return d=i.On.newChangeBuffer({trackRemovals:!0}),[4,cp(i,function(t){return yl(hl(uc.fromString("__bundle__/docs/"+t)))}(r))];case 1:return p=f.sent(),[2,i.persistence.runTransaction("Apply bundle documents","readwrite",function(t){return sp(t,d,s,oc.min(),a).next(function(e){return d.apply(t),e}).next(function(e){return i.qe.removeMatchingKeysForTargetId(t,p.targetId).next(function(){return i.qe.addMatchingKeys(t,o,p.targetId)}).next(function(){return i.Mn.En(t,e)}).next(function(){return e})})})]}})})}function mp(t,e,n){return void 0===n&&(n=xu()),Object(He.b)(this,void 0,void 0,function(){var r,i;return Object(He.d)(this,function(o){switch(o.label){case 0:return[4,cp(t,yl(ad(e.bundledQuery)))];case 1:return r=o.sent(),[2,(i=Qa(t)).persistence.runTransaction("Save named query","readwrite",function(t){var o=Fu(e.readTime);if(r.snapshotVersion.compareTo(o)>=0)return i.Ke.saveNamedQuery(t,e);var s=r.withResumeToken(fc.EMPTY_BYTE_STRING,o);return i.kn=i.kn.insert(s.targetId,s),i.qe.updateTargetData(t,s).next(function(){return i.qe.removeMatchingKeysForTargetId(t,r.targetId)}).next(function(){return i.qe.addMatchingKeys(t,n,r.targetId)}).next(function(){return i.Ke.saveNamedQuery(t,e)})})]}})})}var gp=function(){function t(t){this.R=t,this.Qn=new Map,this.jn=new Map}return t.prototype.getBundleMetadata=function(t,e){return Lh.resolve(this.Qn.get(e))},t.prototype.saveBundleMetadata=function(t,e){var n;return this.Qn.set(e.id,{id:(n=e).id,version:n.version,createTime:Fu(n.createTime)}),Lh.resolve()},t.prototype.getNamedQuery=function(t,e){return Lh.resolve(this.jn.get(e))},t.prototype.saveNamedQuery=function(t,e){return this.jn.set(e.name,function(t){return{name:t.name,query:ad(t.bundledQuery),readTime:Fu(t.readTime)}}(e)),Lh.resolve()},t}(),_p=function(){function t(){this.Wn=new du(yp.Gn),this.zn=new du(yp.Hn)}return t.prototype.isEmpty=function(){return this.Wn.isEmpty()},t.prototype.addReference=function(t,e){var n=new yp(t,e);this.Wn=this.Wn.add(n),this.zn=this.zn.add(n)},t.prototype.Jn=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.Yn(new yp(t,e))},t.prototype.Xn=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.Zn=function(t){var e=this,n=new Ec(new uc([])),r=new yp(n,t),i=new yp(n,t+1),o=[];return this.zn.forEachInRange([r,i],function(t){e.Yn(t),o.push(t.key)}),o},t.prototype.ts=function(){var t=this;this.Wn.forEach(function(e){return t.Yn(e)})},t.prototype.Yn=function(t){this.Wn=this.Wn.delete(t),this.zn=this.zn.delete(t)},t.prototype.es=function(t){var e=new Ec(new uc([])),n=new yp(e,t),r=new yp(e,t+1),i=xu();return this.zn.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new yp(t,0),n=this.Wn.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),yp=function(){function t(t,e){this.key=t,this.ns=e}return t.Gn=function(t,e){return Ec.comparator(t.key,e.key)||ec(t.ns,e.ns)},t.Hn=function(t,e){return ec(t.ns,e.ns)||Ec.comparator(t.key,e.key)},t}(),vp=function(){function t(t,e){this.Ut=t,this.referenceDelegate=e,this._n=[],this.ss=1,this.rs=new du(yp.Gn)}return t.prototype.checkEmpty=function(t){return Lh.resolve(0===this._n.length)},t.prototype.addMutationBatch=function(t,e,n,r){var i=this.ss;this.ss++;var o=new Zh(i,e,n,r);this._n.push(o);for(var s=0,a=r;s<a.length;s++){var c=a[s];this.rs=this.rs.add(new yp(c.key,i)),this.Ut.addToCollectionParentIndex(t,c.key.path.popLast())}return Lh.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return Lh.resolve(this.os(e))},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this.cs(e+1),r=n<0?0:n;return Lh.resolve(this._n.length>r?this._n[r]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return Lh.resolve(0===this._n.length?-1:this.ss-1)},t.prototype.getAllMutationBatches=function(t){return Lh.resolve(this._n.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new yp(e,0),i=new yp(e,Number.POSITIVE_INFINITY),o=[];return this.rs.forEachInRange([r,i],function(t){var e=n.os(t.ns);o.push(e)}),Lh.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new du(ec);return e.forEach(function(t){var e=new yp(t,0),i=new yp(t,Number.POSITIVE_INFINITY);n.rs.forEachInRange([e,i],function(t){r=r.add(t.ns)})}),Lh.resolve(this.us(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=e.path,r=n.length+1,i=n;Ec.isDocumentKey(i)||(i=i.child(""));var o=new yp(new Ec(i),0),s=new du(ec);return this.rs.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(s=s.add(t.ns)),!0)},o),Lh.resolve(this.us(s))},t.prototype.us=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.os(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;Ya(0===this.hs(e.batchId,"removed")),this._n.shift();var r=this.rs;return Lh.forEach(e.mutations,function(i){var o=new yp(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.markPotentiallyOrphaned(t,i.key)}).next(function(){n.rs=r})},t.prototype.Gt=function(t){},t.prototype.containsKey=function(t,e){var n=new yp(e,0),r=this.rs.firstAfterOrEqual(n);return Lh.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return Lh.resolve()},t.prototype.hs=function(t,e){return this.cs(t)},t.prototype.cs=function(t){return 0===this._n.length?0:t-this._n[0].batchId},t.prototype.os=function(t){var e=this.cs(t);return e<0||e>=this._n.length?null:this._n[e]},t}(),bp=function(){function t(t,e){this.Ut=t,this.ls=e,this.docs=new lu(Ec.comparator),this.size=0}return t.prototype.addEntry=function(t,e,n){var r=e.key,i=this.docs.get(r),o=i?i.size:0,s=this.ls(e);return this.docs=this.docs.insert(r,{document:e.clone(),size:s,readTime:n}),this.size+=s-o,this.Ut.addToCollectionParentIndex(t,r.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return Lh.resolve(n?n.document.clone():Vc.newInvalidDocument(e))},t.prototype.getEntries=function(t,e){var n=this,r=mu();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.document.clone():Vc.newInvalidDocument(t))}),Lh.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e,n){for(var r=mu(),i=new Ec(e.path.child("")),o=this.docs.getIteratorFrom(i);o.hasNext();){var s=o.getNext(),a=s.value,c=a.document,l=a.readTime;if(!e.path.isPrefixOf(s.key.path))break;l.compareTo(n)<=0||Tl(e,c)&&(r=r.insert(c.key,c.clone()))}return Lh.resolve(r)},t.prototype.fs=function(t,e){return Lh.forEach(this.docs,function(t){return e(t)})},t.prototype.newChangeBuffer=function(t){return new xp(this)},t.prototype.getSize=function(t){return Lh.resolve(this.size)},t}(),xp=function(t){function e(e){var n=this;return(n=t.call(this)||this).Ie=e,n}return Object(He.c)(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i.document.isValidDocument()?n.push(e.Ie.addEntry(t,i.document,e.getReadTime(r))):e.Ie.removeEntry(r)}),Lh.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.Ie.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.Ie.getEntries(t,e)},e}(jd),wp=function(){function t(t){this.persistence=t,this.ds=new Ld(function(t){return $c(t)},Wc),this.lastRemoteSnapshotVersion=oc.min(),this.highestTargetId=0,this.ws=0,this._s=new _p,this.targetCount=0,this.ys=Cd.Jt()}return t.prototype.forEachTarget=function(t,e){return this.ds.forEach(function(t,n){return e(n)}),Lh.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return Lh.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return Lh.resolve(this.ws)},t.prototype.allocateTargetId=function(t){return this.highestTargetId=this.ys.next(),Lh.resolve(this.highestTargetId)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.ws&&(this.ws=e),Lh.resolve()},t.prototype.te=function(t){this.ds.set(t.target,t);var e=t.targetId;e>this.highestTargetId&&(this.ys=new Cd(e),this.highestTargetId=e),t.sequenceNumber>this.ws&&(this.ws=t.sequenceNumber)},t.prototype.addTargetData=function(t,e){return this.te(e),this.targetCount+=1,Lh.resolve()},t.prototype.updateTargetData=function(t,e){return this.te(e),Lh.resolve()},t.prototype.removeTargetData=function(t,e){return this.ds.delete(e.target),this._s.Zn(e.targetId),this.targetCount-=1,Lh.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.ds.forEach(function(s,a){a.sequenceNumber<=e&&null===n.get(a.targetId)&&(r.ds.delete(s),o.push(r.removeMatchingKeysForTargetId(t,a.targetId)),i++)}),Lh.waitFor(o).next(function(){return i})},t.prototype.getTargetCount=function(t){return Lh.resolve(this.targetCount)},t.prototype.getTargetData=function(t,e){var n=this.ds.get(e)||null;return Lh.resolve(n)},t.prototype.addMatchingKeys=function(t,e,n){return this._s.Jn(e,n),Lh.resolve()},t.prototype.removeMatchingKeys=function(t,e,n){this._s.Xn(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.markPotentiallyOrphaned(t,e))}),Lh.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this._s.Zn(e),Lh.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this._s.es(e);return Lh.resolve(n)},t.prototype.containsKey=function(t,e){return Lh.resolve(this._s.containsKey(e))},t}(),Tp=function(){function t(t,e){var n=this;this.gs={},this.Ne=new Ua(0),this.xe=!1,this.xe=!0,this.referenceDelegate=t(this),this.qe=new wp(this),this.Ut=new hd,this.Ue=function(t,e){return new bp(t,function(t){return n.referenceDelegate.ps(t)})}(this.Ut),this.R=new Yh(e),this.Ke=new gp(this.R)}return t.prototype.start=function(){return Promise.resolve()},t.prototype.shutdown=function(){return this.xe=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this.xe},enumerable:!1,configurable:!0}),t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(){},t.prototype.getIndexManager=function(){return this.Ut},t.prototype.getMutationQueue=function(t){var e=this.gs[t.toKey()];return e||(e=new vp(this.Ut,this.referenceDelegate),this.gs[t.toKey()]=e),e},t.prototype.getTargetCache=function(){return this.qe},t.prototype.getRemoteDocumentCache=function(){return this.Ue},t.prototype.getBundleCache=function(){return this.Ke},t.prototype.runTransaction=function(t,e,n){var r=this;Wa("MemoryPersistence","Starting transaction:",t);var i=new Cp(this.Ne.next());return this.referenceDelegate.Es(),n(i).next(function(t){return r.referenceDelegate.Ts(i).next(function(){return t})}).toPromise().then(function(t){return i.raiseOnCommittedEvent(),t})},t.prototype.Is=function(t,e){return Lh.or(Object.values(this.gs).map(function(n){return function(){return n.containsKey(t,e)}}))},t}(),Cp=function(t){function e(e){var n=this;return(n=t.call(this)||this).currentSequenceNumber=e,n}return Object(He.c)(e,t),e}(Rh),Ep=function(){function t(t){this.persistence=t,this.As=new _p,this.Rs=null}return t.bs=function(e){return new t(e)},Object.defineProperty(t.prototype,"vs",{get:function(){if(this.Rs)return this.Rs;throw Xa()},enumerable:!1,configurable:!0}),t.prototype.addReference=function(t,e,n){return this.As.addReference(n,e),this.vs.delete(n.toString()),Lh.resolve()},t.prototype.removeReference=function(t,e,n){return this.As.removeReference(n,e),this.vs.add(n.toString()),Lh.resolve()},t.prototype.markPotentiallyOrphaned=function(t,e){return this.vs.add(e.toString()),Lh.resolve()},t.prototype.removeTarget=function(t,e){var n=this;this.As.Zn(e.targetId).forEach(function(t){return n.vs.add(t.toString())});var r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.vs.add(t.toString())})}).next(function(){return r.removeTargetData(t,e)})},t.prototype.Es=function(){this.Rs=new Set},t.prototype.Ts=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return Lh.forEach(this.vs,function(r){var i=Ec.fromPath(r);return e.Ps(t,i).next(function(t){t||n.removeEntry(i)})}).next(function(){return e.Rs=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.Ps(t,e).next(function(t){t?n.vs.delete(e.toString()):n.vs.add(e.toString())})},t.prototype.ps=function(t){return 0},t.prototype.Ps=function(t,e){var n=this;return Lh.or([function(){return Lh.resolve(n.As.containsKey(e))},function(){return n.persistence.getTargetCache().containsKey(t,e)},function(){return n.persistence.Is(t,e)}])},t}(),Sp=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t}();function Ip(t,e){return"firestore_clients_"+t+"_"+e}function kp(t,e,n){var r="firestore_mutations_"+t+"_"+n;return e.isAuthenticated()&&(r+="_"+e.uid),r}function Ap(t,e){return"firestore_targets_"+t+"_"+e}Sp.UNAUTHENTICATED=new Sp(null),Sp.GOOGLE_CREDENTIALS=new Sp("google-credentials-uid"),Sp.FIRST_PARTY=new Sp("first-party-uid"),Sp.MOCK_USER=new Sp("mock-user");var Mp=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r}return t.Vs=function(e,n,r){var i,o=JSON.parse(r),s="object"==typeof o&&-1!==["pending","acknowledged","rejected"].indexOf(o.state)&&(void 0===o.error||"object"==typeof o.error);return s&&o.error&&(s="string"==typeof o.error.message&&"string"==typeof o.error.code)&&(i=new qa(o.error.code,o.error.message)),s?new t(e,n,o.state,i):(Ha("SharedClientState","Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Op=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n}return t.Vs=function(e,n){var r,i=JSON.parse(n),o="object"==typeof i&&-1!==["not-current","current","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error);return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(r=new qa(i.error.code,i.error.message)),o?new t(e,i.state,r):(Ha("SharedClientState","Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.Ss=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Pp=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.Vs=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Tu(),s=0;i&&s<r.activeTargetIds.length;++s)i=Cc(r.activeTargetIds[s]),o=o.add(r.activeTargetIds[s]);return i?new t(e,o):(Ha("SharedClientState","Failed to parse client data for instance '"+e+"': "+n),null)},t}(),Dp=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.Vs=function(e){var n=JSON.parse(e);return"object"==typeof n&&-1!==["Unknown","Online","Offline"].indexOf(n.onlineState)&&"string"==typeof n.clientId?new t(n.clientId,n.onlineState):(Ha("SharedClientState","Failed to parse online state: "+e),null)},t}(),Rp=function(){function t(){this.activeTargetIds=Tu()}return t.prototype.Ds=function(t){this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.Cs=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.Ss=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Np=function(){function t(t,e,n,r,i){this.window=t,this.Se=e,this.persistenceKey=n,this.Ns=r,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.xs=this.ks.bind(this),this.Fs=new lu(ec),this.started=!1,this.$s=[];var o=n.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.window.localStorage,this.currentUser=i,this.Os=Ip(this.persistenceKey,this.Ns),this.Ms=function(t){return"firestore_sequence_number_"+t}(this.persistenceKey),this.Fs=this.Fs.insert(this.Ns,new Rp),this.Ls=new RegExp("^firestore_clients_"+o+"_([^_]*)$"),this.Bs=new RegExp("^firestore_mutations_"+o+"_(\\d+)(?:_(.*))?$"),this.qs=new RegExp("^firestore_targets_"+o+"_(\\d+)$"),this.Us=function(t){return"firestore_online_state_"+t}(this.persistenceKey),this.Ks=function(t){return"firestore_bundle_loaded_"+t}(this.persistenceKey),this.window.addEventListener("storage",this.xs)}return t.yt=function(t){return!(!t||!t.localStorage)},t.prototype.start=function(){return Object(He.b)(this,void 0,void 0,function(){var t,e,n,r,i,o,s,a,c,l,u=this;return Object(He.d)(this,function(h){switch(h.label){case 0:return[4,this.syncEngine.fn()];case 1:for(t=h.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.Ns&&(i=this.getItem(Ip(this.persistenceKey,r)))&&(o=Pp.Vs(r,i))&&(this.Fs=this.Fs.insert(o.clientId,o));for(this.Qs(),(s=this.storage.getItem(this.Us))&&(a=this.js(s))&&this.Ws(a),c=0,l=this.$s;c<l.length;c++)this.ks(l[c]);return this.$s=[],this.window.addEventListener("pagehide",function(){return u.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.Ms,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){return this.Gs(this.Fs)},t.prototype.isActiveQueryTarget=function(t){var e=!1;return this.Fs.forEach(function(n,r){r.activeTargetIds.has(t)&&(e=!0)}),e},t.prototype.addPendingMutation=function(t){this.zs(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.zs(t,e,n),this.Hs(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(Ap(this.persistenceKey,t));if(n){var r=Op.Vs(t,n);r&&(e=r.state)}}return this.Js.Ds(t),this.Qs(),e},t.prototype.removeLocalQueryTarget=function(t){this.Js.Cs(t),this.Qs()},t.prototype.isLocalQueryTarget=function(t){return this.Js.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(Ap(this.persistenceKey,t))},t.prototype.updateQueryState=function(t,e,n){this.Ys(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.Hs(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.Xs(t)},t.prototype.notifyBundleLoaded=function(){this.Zs()},t.prototype.shutdown=function(){this.started&&(this.window.removeEventListener("storage",this.xs),this.removeItem(this.Os),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return Wa("SharedClientState","READ",t,e),e},t.prototype.setItem=function(t,e){Wa("SharedClientState","SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){Wa("SharedClientState","REMOVE",t),this.storage.removeItem(t)},t.prototype.ks=function(t){var e=this,n=t;if(n.storageArea===this.storage){if(Wa("SharedClientState","EVENT",n.key,n.newValue),n.key===this.Os)return void Ha("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.Se.enqueueRetryable(function(){return Object(He.b)(e,void 0,void 0,function(){var t,e,r,i,o,s;return Object(He.d)(this,function(a){if(this.started){if(null!==n.key)if(this.Ls.test(n.key)){if(null==n.newValue)return t=this.ti(n.key),[2,this.ei(t,null)];if(e=this.ni(n.key,n.newValue))return[2,this.ei(e.clientId,e)]}else if(this.Bs.test(n.key)){if(null!==n.newValue&&(r=this.si(n.key,n.newValue)))return[2,this.ii(r)]}else if(this.qs.test(n.key)){if(null!==n.newValue&&(i=this.ri(n.key,n.newValue)))return[2,this.oi(i)]}else if(n.key===this.Us){if(null!==n.newValue&&(o=this.js(n.newValue)))return[2,this.Ws(o)]}else if(n.key===this.Ms)(s=function(t){var e=Ua.o;if(null!=t)try{var n=JSON.parse(t);Ya("number"==typeof n),e=n}catch(t){Ha("SharedClientState","Failed to read sequence number from WebStorage",t)}return e}(n.newValue))!==Ua.o&&this.sequenceNumberHandler(s);else if(n.key===this.Ks)return[2,this.syncEngine.ci()]}else this.$s.push(n);return[2]})})})}},Object.defineProperty(t.prototype,"Js",{get:function(){return this.Fs.get(this.Ns)},enumerable:!1,configurable:!0}),t.prototype.Qs=function(){this.setItem(this.Os,this.Js.Ss())},t.prototype.zs=function(t,e,n){var r=new Mp(this.currentUser,t,e,n),i=kp(this.persistenceKey,this.currentUser,t);this.setItem(i,r.Ss())},t.prototype.Hs=function(t){var e=kp(this.persistenceKey,this.currentUser,t);this.removeItem(e)},t.prototype.Xs=function(t){this.storage.setItem(this.Us,JSON.stringify({clientId:this.Ns,onlineState:t}))},t.prototype.Ys=function(t,e,n){var r=Ap(this.persistenceKey,t),i=new Op(t,e,n);this.setItem(r,i.Ss())},t.prototype.Zs=function(){this.setItem(this.Ks,"value-not-used")},t.prototype.ti=function(t){var e=this.Ls.exec(t);return e?e[1]:null},t.prototype.ni=function(t,e){var n=this.ti(t);return Pp.Vs(n,e)},t.prototype.si=function(t,e){var n=this.Bs.exec(t),r=Number(n[1]);return Mp.Vs(new Sp(void 0!==n[2]?n[2]:null),r,e)},t.prototype.ri=function(t,e){var n=this.qs.exec(t),r=Number(n[1]);return Op.Vs(r,e)},t.prototype.js=function(t){return Dp.Vs(t)},t.prototype.ii=function(t){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(e){return t.user.uid===this.currentUser.uid?[2,this.syncEngine.ui(t.batchId,t.state,t.error)]:(Wa("SharedClientState","Ignoring mutation for non-active user "+t.user.uid),[2])})})},t.prototype.oi=function(t){return this.syncEngine.ai(t.targetId,t.state,t.error)},t.prototype.ei=function(t,e){var n=this,r=e?this.Fs.insert(t,e):this.Fs.remove(t),i=this.Gs(this.Fs),o=this.Gs(r),s=[],a=[];return o.forEach(function(t){i.has(t)||s.push(t)}),i.forEach(function(t){o.has(t)||a.push(t)}),this.syncEngine.hi(s,a).then(function(){n.Fs=r})},t.prototype.Ws=function(t){this.Fs.get(t.clientId)&&this.onlineStateHandler(t.onlineState)},t.prototype.Gs=function(t){var e=Tu();return t.forEach(function(t,n){e=e.unionWith(n.activeTargetIds)}),e},t}(),Lp=function(){function t(){this.li=new Rp,this.fi={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.li.Ds(t),this.fi[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.fi[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.li.Cs(t)},t.prototype.isLocalQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.fi[t]},t.prototype.getAllActiveQueryTargets=function(){return this.li.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.li.activeTargetIds.has(t)},t.prototype.start=function(){return this.li=new Rp,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t.prototype.notifyBundleLoaded=function(){},t}(),jp=function(){function t(){}return t.prototype.di=function(t){},t.prototype.shutdown=function(){},t}(),zp=function(){function t(){var t=this;this.wi=function(){return t._i()},this.mi=function(){return t.yi()},this.gi=[],this.pi()}return t.prototype.di=function(t){this.gi.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.wi),window.removeEventListener("offline",this.mi)},t.prototype.pi=function(){window.addEventListener("online",this.wi),window.addEventListener("offline",this.mi)},t.prototype._i=function(){Wa("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(0)},t.prototype.yi=function(){Wa("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.gi;t<e.length;t++)(0,e[t])(1)},t.yt=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),Fp={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery"},Bp=function(){function t(t){this.Ei=t.Ei,this.Ti=t.Ti}return t.prototype.Ii=function(t){this.Ai=t},t.prototype.Ri=function(t){this.bi=t},t.prototype.onMessage=function(t){this.vi=t},t.prototype.close=function(){this.Ti()},t.prototype.send=function(t){this.Ei(t)},t.prototype.Pi=function(){this.Ai()},t.prototype.Vi=function(t){this.bi(t)},t.prototype.Si=function(t){this.vi(t)},t}(),Up=function(t){function e(e){var n=this;return(n=t.call(this,e)||this).forceLongPolling=e.forceLongPolling,n.autoDetectLongPolling=e.autoDetectLongPolling,n.useFetchStreams=e.useFetchStreams,n}return Object(He.c)(e,t),e.prototype.Fi=function(t,e,n,r){return new Promise(function(i,o){var s=new Ba;s.listenOnce(La.COMPLETE,function(){try{switch(s.getLastErrorCode()){case Na.NO_ERROR:var e=s.getResponseJson();Wa("Connection","XHR received:",JSON.stringify(e)),i(e);break;case Na.TIMEOUT:Wa("Connection",'RPC "'+t+'" timed out'),o(new qa(Va.DEADLINE_EXCEEDED,"Request time out"));break;case Na.HTTP_ERROR:var n=s.getStatus();if(Wa("Connection",'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var a=function(t){var e=t.toLowerCase().replace(/_/g,"-");return Object.values(Va).indexOf(e)>=0?e:Va.UNKNOWN}(r.status);o(new qa(a,r.message))}else o(new qa(Va.UNKNOWN,"Server responded with status "+s.getStatus()))}else o(new qa(Va.UNAVAILABLE,"Connection failed."));break;default:Xa()}}finally{Wa("Connection",'RPC "'+t+'" completed.')}});var a=JSON.stringify(r);s.send(e,"POST",a,n,15)})},e.prototype.Oi=function(t,e){var n=[this.Di,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=new Ma,i=Co(),o={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling};this.useFetchStreams&&(o.xmlHttpFactory=new za({})),this.ki(o.initMessageHeaders,e),Object(Ze.w)()||Object(Ze.z)()||Object(Ze.t)()||Object(Ze.v)()||Object(Ze.B)()||Object(Ze.s)()||(o.httpHeadersOverwriteParam="$httpHeaders");var s=n.join("");Wa("Connection","Creating WebChannel: "+s,o);var a=r.createWebChannel(s,o),c=!1,l=!1,u=new Bp({Ei:function(t){l?Wa("Connection","Not sending because WebChannel is closed:",t):(c||(Wa("Connection","Opening WebChannel transport."),a.open(),c=!0),Wa("Connection","WebChannel sending:",t),a.send(t))},Ti:function(){return a.close()}}),h=function(t,e,n){t.listen(e,function(t){try{n(t)}catch(t){setTimeout(function(){throw t},0)}})};return h(a,Fa.EventType.OPEN,function(){l||Wa("Connection","WebChannel transport opened.")}),h(a,Fa.EventType.CLOSE,function(){l||(l=!0,Wa("Connection","WebChannel transport closed"),u.Vi())}),h(a,Fa.EventType.ERROR,function(t){l||(l=!0,Za("Connection","WebChannel transport errored:",t),u.Vi(new qa(Va.UNAVAILABLE,"The operation could not be completed")))}),h(a,Fa.EventType.MESSAGE,function(t){var e;if(!l){var n=t.data[0];Ya(!!n);var r=n.error||(null===(e=n[0])||void 0===e?void 0:e.error);if(r){Wa("Connection","WebChannel received error:",r);var i=r.status,o=function(t){var e=nu[t];if(void 0!==e)return cu(e)}(i),s=r.message;void 0===o&&(o=Va.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),l=!0,u.Vi(new qa(o,s)),a.close()}else Wa("Connection","WebChannel received:",n),u.Si(n)}}),h(i,ja.STAT_EVENT,function(t){10===t.stat?Wa("Connection","Detected buffering proxy"):11===t.stat&&Wa("Connection","Detected no buffering proxy")}),setTimeout(function(){u.Pi()},0),u},e}(function(){function t(t){this.databaseInfo=t,this.databaseId=t.databaseId,this.Di=(t.ssl?"https":"http")+"://"+t.host,this.Ci="projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database+"/documents"}return t.prototype.Ni=function(t,e,n,r){var i=this.xi(t,e);Wa("RestConnection","Sending: ",i,n);var o={};return this.ki(o,r),this.Fi(t,i,o,n).then(function(t){return Wa("RestConnection","Received: ",t),t},function(e){throw Za("RestConnection",t+" failed with error: ",e,"url: ",i,"request:",n),e})},t.prototype.$i=function(t,e,n,r){return this.Ni(t,e,n,r)},t.prototype.ki=function(t,e){if(t["X-Goog-Api-Client"]="gl-js/ fire/8.10.1",t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n])},t.prototype.xi=function(t,e){return this.Di+"/v1/"+e+":"+Fp[t]},t}());function Vp(){return"undefined"!=typeof window?window:null}function qp(){return"undefined"!=typeof document?document:null}function Gp(t){return new Nu(t,!0)}var $p=function(){function t(t,e,n,r,i){void 0===n&&(n=1e3),void 0===r&&(r=1.5),void 0===i&&(i=6e4),this.Se=t,this.timerId=e,this.Mi=n,this.Li=r,this.Bi=i,this.qi=0,this.Ui=null,this.Ki=Date.now(),this.reset()}return t.prototype.reset=function(){this.qi=0},t.prototype.Qi=function(){this.qi=this.Bi},t.prototype.ji=function(t){var e=this;this.cancel();var n=Math.floor(this.qi+this.Wi()),r=Math.max(0,Date.now()-this.Ki),i=Math.max(0,n-r);i>0&&Wa("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.qi+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.Ui=this.Se.enqueueAfterDelay(this.timerId,i,function(){return e.Ki=Date.now(),t()}),this.qi*=this.Li,this.qi<this.Mi&&(this.qi=this.Mi),this.qi>this.Bi&&(this.qi=this.Bi)},t.prototype.Gi=function(){null!==this.Ui&&(this.Ui.skipDelay(),this.Ui=null)},t.prototype.cancel=function(){null!==this.Ui&&(this.Ui.cancel(),this.Ui=null)},t.prototype.Wi=function(){return(Math.random()-.5)*this.qi},t}(),Wp=function(){function t(t,e,n,r,i,o){this.Se=t,this.zi=n,this.Hi=r,this.Ji=i,this.listener=o,this.state=0,this.Yi=0,this.Xi=null,this.stream=null,this.Zi=new $p(t,e)}return t.prototype.tr=function(){return 1===this.state||2===this.state||4===this.state},t.prototype.er=function(){return 2===this.state},t.prototype.start=function(){3!==this.state?this.auth():this.nr()},t.prototype.stop=function(){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(t){switch(t.label){case 0:return this.tr()?[4,this.close(0)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.sr=function(){this.state=0,this.Zi.reset()},t.prototype.ir=function(){var t=this;this.er()&&null===this.Xi&&(this.Xi=this.Se.enqueueAfterDelay(this.zi,6e4,function(){return t.rr()}))},t.prototype.cr=function(t){this.ur(),this.stream.send(t)},t.prototype.rr=function(){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(t){return this.er()?[2,this.close(0)]:[2]})})},t.prototype.ur=function(){this.Xi&&(this.Xi.cancel(),this.Xi=null)},t.prototype.close=function(t,e){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(n){switch(n.label){case 0:return this.ur(),this.Zi.cancel(),this.Yi++,3!==t?this.Zi.reset():e&&e.code===Va.RESOURCE_EXHAUSTED?(Ha(e.toString()),Ha("Using maximum backoff delay to prevent overloading the backend."),this.Zi.Qi()):e&&e.code===Va.UNAUTHENTICATED&&this.Ji.invalidateToken(),null!==this.stream&&(this.ar(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.Ri(e)];case 1:return n.sent(),[2]}})})},t.prototype.ar=function(){},t.prototype.auth=function(){var t=this;this.state=1;var e=this.hr(this.Yi),n=this.Yi;this.Ji.getToken().then(function(e){t.Yi===n&&t.lr(e)},function(n){e(function(){var e=new qa(Va.UNKNOWN,"Fetching auth token failed: "+n.message);return t.dr(e)})})},t.prototype.lr=function(t){var e=this,n=this.hr(this.Yi);this.stream=this.wr(t),this.stream.Ii(function(){n(function(){return e.state=2,e.listener.Ii()})}),this.stream.Ri(function(t){n(function(){return e.dr(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.nr=function(){var t=this;this.state=4,this.Zi.ji(function(){return Object(He.b)(t,void 0,void 0,function(){return Object(He.d)(this,function(t){return this.state=0,this.start(),[2]})})})},t.prototype.dr=function(t){return Wa("PersistentStream","close with error: "+t),this.stream=null,this.close(3,t)},t.prototype.hr=function(t){var e=this;return function(n){e.Se.enqueueAndForget(function(){return e.Yi===t?n():(Wa("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Hp=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"listen_stream_connection_backoff","listen_stream_idle",n,r,o)||this).R=i,s}return Object(He.c)(e,t),e.prototype.wr=function(t){return this.Hi.Oi("Listen",t)},e.prototype.onMessage=function(t){this.Zi.reset();var e=function(t,e){var n;if("targetChange"in e){var r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Xa()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],o=function(t,e){return t.I?(Ya(void 0===e||"string"==typeof e),fc.fromBase64String(e||"")):(Ya(void 0===e||e instanceof Uint8Array),fc.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),s=(a=e.targetChange.cause)&&function(t){var e=void 0===t.code?Va.UNKNOWN:cu(t.code);return new qa(e,t.message||"")}(a);n=new ku(r,i,o,s||null)}else if("documentChange"in e){i=qu(t,(r=e.documentChange).document.name),o=Fu(r.document.updateTime);var a=new Bc({mapValue:{fields:r.document.fields}}),c=(s=Vc.newFoundDocument(i,o,a),r.targetIds||[]);n=new Su(c,r.removedTargetIds||[],s.key,s)}else if("documentDelete"in e)i=qu(t,(r=e.documentDelete).document),o=r.readTime?Fu(r.readTime):oc.min(),a=Vc.newNoDocument(i,o),n=new Su([],s=r.removedTargetIds||[],a.key,a);else if("documentRemove"in e)i=qu(t,(r=e.documentRemove).document),n=new Su([],o=r.removedTargetIds||[],i,null);else{if(!("filter"in e))return Xa();var l=e.filter;i=new su(r=l.count||0),n=new Iu(o=l.targetId,i)}return n}(this.R,t),n=function(t){if(!("targetChange"in t))return oc.min();var e=t.targetChange;return e.targetIds&&e.targetIds.length?oc.min():e.readTime?Fu(e.readTime):oc.min()}(t);return this.listener._r(e,n)},e.prototype.mr=function(t){var e={};e.database=Wu(this.R),e.addTarget=function(t,e){var n,r=e.target;return(n=Hc(r)?{documents:Qu(t,r)}:{query:Ju(t,r)}).targetId=e.targetId,e.resumeToken.approximateByteSize()>0?n.resumeToken=ju(t,e.resumeToken):e.snapshotVersion.compareTo(oc.min())>0&&(n.readTime=Lu(t,e.snapshotVersion.toTimestamp())),n}(this.R,t);var n=function(t,e){var n=function(t,e){switch(e){case 0:return null;case 1:return"existence-filter-mismatch";case 2:return"limbo-document";default:return Xa()}}(0,e.purpose);return null==n?null:{"goog-listen-tags":n}}(0,t);n&&(e.labels=n),this.cr(e)},e.prototype.yr=function(t){var e={};e.database=Wu(this.R),e.removeTarget=t,this.cr(e)},e}(Wp),Zp=function(t){function e(e,n,r,i,o){var s=this;return(s=t.call(this,e,"write_stream_connection_backoff","write_stream_idle",n,r,o)||this).R=i,s.gr=!1,s}return Object(He.c)(e,t),Object.defineProperty(e.prototype,"pr",{get:function(){return this.gr},enumerable:!1,configurable:!0}),e.prototype.start=function(){this.gr=!1,this.lastStreamToken=void 0,t.prototype.start.call(this)},e.prototype.ar=function(){this.gr&&this.Er([])},e.prototype.wr=function(t){return this.Hi.Oi("Write",t)},e.prototype.onMessage=function(t){if(Ya(!!t.streamToken),this.lastStreamToken=t.streamToken,this.gr){this.Zi.reset();var e=function(t,e){return t&&t.length>0?(Ya(void 0!==e),t.map(function(t){return function(t,e){var n=Fu(t.updateTime?t.updateTime:e);return n.isEqual(oc.min())&&(n=Fu(e)),new Vl(n,t.transformResults||[])}(t,e)})):[]}(t.writeResults,t.commitTime),n=Fu(t.commitTime);return this.listener.Tr(n,e)}return Ya(!t.writeResults||0===t.writeResults.length),this.gr=!0,this.listener.Ir()},e.prototype.Ar=function(){var t={};t.database=Wu(this.R),this.cr(t)},e.prototype.Er=function(t){var e=this,n={streamToken:this.lastStreamToken,writes:t.map(function(t){return Xu(e.R,t)})};this.cr(n)},e}(Wp),Kp=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).credentials=e,i.Hi=n,i.R=r,i.Rr=!1,i}return Object(He.c)(e,t),e.prototype.br=function(){if(this.Rr)throw new qa(Va.FAILED_PRECONDITION,"The client has already been terminated.")},e.prototype.Ni=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.Ni(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Va.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new qa(Va.UNKNOWN,t.toString())})},e.prototype.$i=function(t,e,n){var r=this;return this.br(),this.credentials.getToken().then(function(i){return r.Hi.$i(t,e,n,i)}).catch(function(t){throw"FirebaseError"===t.name?(t.code===Va.UNAUTHENTICATED&&r.credentials.invalidateToken(),t):new qa(Va.UNKNOWN,t.toString())})},e.prototype.terminate=function(){this.Rr=!0},e}(function(){}),Xp=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.vr=0,this.Pr=null,this.Vr=!0}return t.prototype.Sr=function(){var t=this;0===this.vr&&(this.Dr("Unknown"),this.Pr=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,function(){return t.Pr=null,t.Cr("Backend didn't respond within 10 seconds."),t.Dr("Offline"),Promise.resolve()}))},t.prototype.Nr=function(t){"Online"===this.state?this.Dr("Unknown"):(this.vr++,this.vr>=1&&(this.kr(),this.Cr("Connection failed 1 times. Most recent error: "+t.toString()),this.Dr("Offline")))},t.prototype.set=function(t){this.kr(),this.vr=0,"Online"===t&&(this.Vr=!1),this.Dr(t)},t.prototype.Dr=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.Cr=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.Vr?(Ha(e),this.Vr=!1):Wa("OnlineStateTracker",e)},t.prototype.kr=function(){null!==this.Pr&&(this.Pr.cancel(),this.Pr=null)},t}(),Yp=function(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.Fr=[],this.$r=new Map,this.Or=new Set,this.Mr=[],this.Lr=i,this.Lr.di(function(t){n.enqueueAndForget(function(){return Object(He.b)(o,void 0,void 0,function(){return Object(He.d)(this,function(t){switch(t.label){case 0:return af(this)?(Wa("RemoteStore","Restarting streams for network reachability change."),[4,function(t){return Object(He.b)(this,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return(e=Qa(t)).Or.add(4),[4,Jp(e)];case 1:return n.sent(),e.Br.set("Unknown"),e.Or.delete(4),[4,Qp(e)];case 2:return n.sent(),[2]}})})}(this)]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.Br=new Xp(n,r)};function Qp(t){return Object(He.b)(this,void 0,void 0,function(){var e,n;return Object(He.d)(this,function(r){switch(r.label){case 0:if(!af(t))return[3,4];e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!0)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function Jp(t){return Object(He.b)(this,void 0,void 0,function(){var e,n;return Object(He.d)(this,function(r){switch(r.label){case 0:e=0,n=t.Mr,r.label=1;case 1:return e<n.length?[4,(0,n[e])(!1)]:[3,4];case 2:r.sent(),r.label=3;case 3:return e++,[3,1];case 4:return[2]}})})}function tf(t,e){var n=Qa(t);n.$r.has(e.targetId)||(n.$r.set(e.targetId,e),sf(n)?of(n):wf(n).er()&&nf(n,e))}function ef(t,e){var n=Qa(t),r=wf(n);n.$r.delete(e),r.er()&&rf(n,e),0===n.$r.size&&(r.er()?r.ir():af(n)&&n.Br.set("Unknown"))}function nf(t,e){t.qr.U(e.targetId),wf(t).mr(e)}function rf(t,e){t.qr.U(e),wf(t).yr(e)}function of(t){t.qr=new Mu({getRemoteKeysForTarget:function(e){return t.remoteSyncer.getRemoteKeysForTarget(e)},lt:function(e){return t.$r.get(e)||null}}),wf(t).start(),t.Br.Sr()}function sf(t){return af(t)&&!wf(t).tr()&&t.$r.size>0}function af(t){return 0===Qa(t).Or.size}function cf(t){t.qr=void 0}function lf(t){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(e){return t.$r.forEach(function(e,n){nf(t,e)}),[2]})})}function uf(t,e){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(n){return cf(t),sf(t)?(t.Br.Nr(e),of(t)):t.Br.set("Unknown"),[2]})})}function hf(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i,o;return Object(He.d)(this,function(s){switch(s.label){case 0:if(t.Br.set("Online"),!(e instanceof ku&&2===e.state&&e.cause))return[3,6];s.label=1;case 1:return s.trys.push([1,3,,5]),[4,function(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i,o;return Object(He.d)(this,function(s){switch(s.label){case 0:n=e.cause,r=0,i=e.targetIds,s.label=1;case 1:return r<i.length?t.$r.has(o=i[r])?[4,t.remoteSyncer.rejectListen(o,n)]:[3,3]:[3,5];case 2:s.sent(),t.$r.delete(o),t.qr.removeTarget(o),s.label=3;case 3:s.label=4;case 4:return r++,[3,1];case 5:return[2]}})})}(t,e)];case 2:return s.sent(),[3,5];case 3:return r=s.sent(),Wa("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),r),[4,df(t,r)];case 4:return s.sent(),[3,5];case 5:return[3,13];case 6:if(e instanceof Su?t.qr.X(e):e instanceof Iu?t.qr.rt(e):t.qr.et(e),n.isEqual(oc.min()))return[3,13];s.label=7;case 7:return s.trys.push([7,11,,13]),[4,ip(t.localStore)];case 8:return i=s.sent(),n.compareTo(i)>=0?[4,function(t,e){var n=t.qr.ut(e);return n.targetChanges.forEach(function(n,r){if(n.resumeToken.approximateByteSize()>0){var i=t.$r.get(r);i&&t.$r.set(r,i.withResumeToken(n.resumeToken,e))}}),n.targetMismatches.forEach(function(e){var n=t.$r.get(e);if(n){t.$r.set(e,n.withResumeToken(fc.EMPTY_BYTE_STRING,n.snapshotVersion)),rf(t,e);var r=new Xh(n.target,e,1,n.sequenceNumber);nf(t,r)}}),t.remoteSyncer.applyRemoteEvent(n)}(t,n)]:[3,10];case 9:s.sent(),s.label=10;case 10:return[3,13];case 11:return Wa("RemoteStore","Failed to raise snapshot:",o=s.sent()),[4,df(t,o)];case 12:return s.sent(),[3,13];case 13:return[2]}})})}function df(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r=this;return Object(He.d)(this,function(i){switch(i.label){case 0:if(!Uh(e))throw e;return t.Or.add(1),[4,Jp(t)];case 1:return i.sent(),t.Br.set("Offline"),n||(n=function(){return ip(t.localStore)}),t.asyncQueue.enqueueRetryable(function(){return Object(He.b)(r,void 0,void 0,function(){return Object(He.d)(this,function(e){switch(e.label){case 0:return Wa("RemoteStore","Retrying IndexedDB access"),[4,n()];case 1:return e.sent(),t.Or.delete(1),[4,Qp(t)];case 2:return e.sent(),[2]}})})}),[2]}})})}function pf(t,e){return e().catch(function(n){return df(t,n,e)})}function ff(t){return Object(He.b)(this,void 0,void 0,function(){var e,n,r,i,o;return Object(He.d)(this,function(s){switch(s.label){case 0:e=Qa(t),n=Tf(e),r=e.Fr.length>0?e.Fr[e.Fr.length-1].batchId:-1,s.label=1;case 1:if(!function(t){return af(t)&&t.Fr.length<10}(e))return[3,7];s.label=2;case 2:return s.trys.push([2,4,,6]),[4,ap(e.localStore,r)];case 3:return null===(i=s.sent())?(0===e.Fr.length&&n.ir(),[3,7]):(r=i.batchId,function(t,e){t.Fr.push(e);var n=Tf(t);n.er()&&n.pr&&n.Er(e.mutations)}(e,i),[3,6]);case 4:return o=s.sent(),[4,df(e,o)];case 5:return s.sent(),[3,6];case 6:return[3,1];case 7:return mf(e)&&gf(e),[2]}})})}function mf(t){return af(t)&&!Tf(t).tr()&&t.Fr.length>0}function gf(t){Tf(t).start()}function _f(t){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(e){return Tf(t).Ar(),[2]})})}function yf(t){return Object(He.b)(this,void 0,void 0,function(){var e,n,r;return Object(He.d)(this,function(i){for(e=Tf(t),n=0,r=t.Fr;n<r.length;n++)e.Er(r[n].mutations);return[2]})})}function vf(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i;return Object(He.d)(this,function(o){switch(o.label){case 0:return r=t.Fr.shift(),i=Kh.from(r,e,n),[4,pf(t,function(){return t.remoteSyncer.applySuccessfulWrite(i)})];case 1:return o.sent(),[4,ff(t)];case 2:return o.sent(),[2]}})})}function bf(t,e){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(n){switch(n.label){case 0:return e&&Tf(t).pr?[4,function(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r;return Object(He.d)(this,function(i){switch(i.label){case 0:return au(r=e.code)&&r!==Va.ABORTED?(n=t.Fr.shift(),Tf(t).sr(),[4,pf(t,function(){return t.remoteSyncer.rejectFailedWrite(n.batchId,e)})]):[3,3];case 1:return i.sent(),[4,ff(t)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}(t,e)]:[3,2];case 1:n.sent(),n.label=2;case 2:return mf(t)&&gf(t),[2]}})})}function xf(t,e){return Object(He.b)(this,void 0,void 0,function(){var n;return Object(He.d)(this,function(r){switch(r.label){case 0:return n=Qa(t),e?(n.Or.delete(2),[4,Qp(n)]):[3,2];case 1:return r.sent(),[3,5];case 2:return e?[3,4]:(n.Or.add(2),[4,Jp(n)]);case 3:r.sent(),n.Br.set("Unknown"),r.label=4;case 4:r.label=5;case 5:return[2]}})})}function wf(t){var e=this;return t.Ur||(t.Ur=function(t,e,n){var r=Qa(t);return r.br(),new Hp(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:lf.bind(null,t),Ri:uf.bind(null,t),_r:hf.bind(null,t)}),t.Mr.push(function(n){return Object(He.b)(e,void 0,void 0,function(){return Object(He.d)(this,function(e){switch(e.label){case 0:return n?(t.Ur.sr(),sf(t)?of(t):t.Br.set("Unknown"),[3,3]):[3,1];case 1:return[4,t.Ur.stop()];case 2:e.sent(),cf(t),e.label=3;case 3:return[2]}})})})),t.Ur}function Tf(t){var e=this;return t.Kr||(t.Kr=function(t,e,n){var r=Qa(t);return r.br(),new Zp(e,r.Hi,r.credentials,r.R,n)}(t.datastore,t.asyncQueue,{Ii:_f.bind(null,t),Ri:bf.bind(null,t),Ir:yf.bind(null,t),Tr:vf.bind(null,t)}),t.Mr.push(function(n){return Object(He.b)(e,void 0,void 0,function(){return Object(He.d)(this,function(e){switch(e.label){case 0:return n?(t.Kr.sr(),[4,ff(t)]):[3,2];case 1:return e.sent(),[3,4];case 2:return[4,t.Kr.stop()];case 3:e.sent(),t.Fr.length>0&&(Wa("RemoteStore","Stopping write stream with "+t.Fr.length+" pending writes"),t.Fr=[]),e.label=4;case 4:return[2]}})})})),t.Kr}var Cf=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Nh,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var s=new t(e,n,Date.now()+r,i,o);return s.start(r),s},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new qa(Va.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}();function Ef(t,e){if(Ha("AsyncQueue",e+": "+t),Uh(t))return new qa(Va.UNAVAILABLE,e+": "+t);throw t}var Sf=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Ec.comparator(e.key,n.key)}:function(t,e){return Ec.comparator(t.key,e.key)},this.keyedMap=_u(),this.sortedSet=new lu(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}(),If=function(){function t(){this.Qr=new lu(Ec.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.Qr.get(e);n?0!==t.type&&3===n.type?this.Qr=this.Qr.insert(e,t):3===t.type&&1!==n.type?this.Qr=this.Qr.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.Qr=this.Qr.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.Qr=this.Qr.remove(e):1===t.type&&2===n.type?this.Qr=this.Qr.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.Qr=this.Qr.insert(e,{type:2,doc:t.doc}):Xa():this.Qr=this.Qr.insert(e,t)},t.prototype.jr=function(){var t=[];return this.Qr.inorderTraversal(function(e,n){t.push(n)}),t},t}(),kf=function(){function t(t,e,n,r,i,o,s,a){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=s,this.excludesMetadataChanges=a}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:0,doc:t})}),new t(e,n,Sf.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&bl(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Af=function(){this.Wr=void 0,this.listeners=[]},Mf=function(){this.queries=new Ld(function(t){return xl(t)},bl),this.onlineState="Unknown",this.Gr=new Set};function Of(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,c;return Object(He.d)(this,function(l){switch(l.label){case 0:if(n=Qa(t),i=!1,(o=n.queries.get(r=e.query))||(i=!0,o=new Af),!i)return[3,4];l.label=1;case 1:return l.trys.push([1,3,,4]),s=o,[4,n.onListen(r)];case 2:return s.Wr=l.sent(),[3,4];case 3:return a=l.sent(),c=Ef(a,"Initialization of query '"+wl(e.query)+"' failed"),[2,void e.onError(c)];case 4:return n.queries.set(r,o),o.listeners.push(e),e.zr(n.onlineState),o.Wr&&e.Hr(o.Wr)&&Nf(n),[2]}})})}function Pf(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(He.d)(this,function(a){return n=Qa(t),i=!1,(o=n.queries.get(r=e.query))&&(s=o.listeners.indexOf(e))>=0&&(o.listeners.splice(s,1),i=0===o.listeners.length),i?[2,(n.queries.delete(r),n.onUnlisten(r))]:[2]})})}function Df(t,e){for(var n=Qa(t),r=!1,i=0,o=e;i<o.length;i++){var s=o[i],a=n.queries.get(s.query);if(a){for(var c=0,l=a.listeners;c<l.length;c++)l[c].Hr(s)&&(r=!0);a.Wr=s}}r&&Nf(n)}function Rf(t,e,n){var r=Qa(t),i=r.queries.get(e);if(i)for(var o=0,s=i.listeners;o<s.length;o++)s[o].onError(n);r.queries.delete(e)}function Nf(t){t.Gr.forEach(function(t){t.next()})}var Lf=function(){function t(t,e,n){this.query=t,this.Jr=e,this.Yr=!1,this.Xr=null,this.onlineState="Unknown",this.options=n||{}}return t.prototype.Hr=function(t){if(!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];3!==i.type&&e.push(i)}t=new kf(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.Yr?this.Zr(t)&&(this.Jr.next(t),o=!0):this.eo(t,this.onlineState)&&(this.no(t),o=!0),this.Xr=t,o},t.prototype.onError=function(t){this.Jr.error(t)},t.prototype.zr=function(t){this.onlineState=t;var e=!1;return this.Xr&&!this.Yr&&this.eo(this.Xr,t)&&(this.no(this.Xr),e=!0),e},t.prototype.eo=function(t,e){return!t.fromCache||!(this.options.so&&"Offline"!==e||t.docs.isEmpty()&&"Offline"!==e)},t.prototype.Zr=function(t){return t.docChanges.length>0||!!(t.syncStateChanged||this.Xr&&this.Xr.hasPendingWrites!==t.hasPendingWrites)&&!0===this.options.includeMetadataChanges},t.prototype.no=function(t){t=kf.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.Yr=!0,this.Jr.next(t)},t}(),jf=function(){function t(t,e){this.payload=t,this.byteLength=e}return t.prototype.io=function(){return"metadata"in this.payload},t}(),zf=function(){function t(t){this.R=t}return t.prototype.qn=function(t){return qu(this.R,t)},t.prototype.Un=function(t){return t.metadata.exists?Ku(this.R,t.document,!1):Vc.newNoDocument(this.qn(t.metadata.name),this.Kn(t.metadata.readTime))},t.prototype.Kn=function(t){return Fu(t)},t}();!function(){function t(t,e,n){this.ro=t,this.localStore=e,this.R=n,this.queries=[],this.documents=[],this.progress=function(t){return{taskState:"Running",documentsLoaded:0,bytesLoaded:0,totalDocuments:t.totalDocuments,totalBytes:t.totalBytes}}(t)}t.prototype.oo=function(t){this.progress.bytesLoaded+=t.byteLength;var e=this.progress.documentsLoaded;return t.payload.namedQuery?this.queries.push(t.payload.namedQuery):t.payload.documentMetadata?(this.documents.push({metadata:t.payload.documentMetadata}),t.payload.documentMetadata.exists||++e):t.payload.document&&(this.documents[this.documents.length-1].document=t.payload.document,++e),e!==this.progress.documentsLoaded?(this.progress.documentsLoaded=e,Object.assign({},this.progress)):null},t.prototype.co=function(t){for(var e=new Map,n=new zf(this.R),r=0,i=t;r<i.length;r++){var o=i[r];if(o.metadata.queries)for(var s=n.qn(o.metadata.name),a=0,c=o.metadata.queries;a<c.length;a++){var l=c[a],u=(e.get(l)||xu()).add(s);e.set(l,u)}}return e},t.prototype.complete=function(){return Object(He.b)(this,void 0,void 0,function(){var t,e,n,r,i;return Object(He.d)(this,function(o){switch(o.label){case 0:return[4,fp(this.localStore,new zf(this.R),this.documents,this.ro.id)];case 1:t=o.sent(),e=this.co(this.documents),n=0,r=this.queries,o.label=2;case 2:return n<r.length?[4,mp(this.localStore,i=r[n],e.get(i.name))]:[3,5];case 3:o.sent(),o.label=4;case 4:return n++,[3,2];case 5:return[2,(this.progress.taskState="Success",new Xd(Object.assign({},this.progress),t))]}})})}}();var Ff=function(t){this.key=t},Bf=function(t){this.key=t},Uf=function(){function t(t,e){this.query=t,this.uo=e,this.ao=null,this.current=!1,this.ho=xu(),this.mutatedKeys=xu(),this.lo=Cl(t),this.fo=new Sf(this.lo)}return Object.defineProperty(t.prototype,"wo",{get:function(){return this.uo},enumerable:!1,configurable:!0}),t.prototype._o=function(t,e){var n=this,r=e?e.mo:new If,i=e?e.fo:this.fo,o=e?e.mutatedKeys:this.mutatedKeys,s=i,a=!1,c=dl(this.query)&&i.size===this.query.limit?i.last():null,l=pl(this.query)&&i.size===this.query.limit?i.first():null;if(t.inorderTraversal(function(t,e){var u=i.get(t),h=Tl(n.query,e)?e:null,d=!!u&&n.mutatedKeys.has(u.key),p=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),f=!1;u&&h?u.data.isEqual(h.data)?d!==p&&(r.track({type:3,doc:h}),f=!0):n.yo(u,h)||(r.track({type:2,doc:h}),f=!0,(c&&n.lo(h,c)>0||l&&n.lo(h,l)<0)&&(a=!0)):!u&&h?(r.track({type:0,doc:h}),f=!0):u&&!h&&(r.track({type:1,doc:u}),f=!0,(c||l)&&(a=!0)),f&&(h?(s=s.add(h),o=p?o.add(t):o.delete(t)):(s=s.delete(t),o=o.delete(t)))}),dl(this.query)||pl(this.query))for(;s.size>this.query.limit;){var u=dl(this.query)?s.last():s.first();s=s.delete(u.key),o=o.delete(u.key),r.track({type:1,doc:u})}return{fo:s,mo:r,Nn:a,mutatedKeys:o}},t.prototype.yo=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this,i=this.fo;this.fo=t.fo,this.mutatedKeys=t.mutatedKeys;var o=t.mo.jr();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Xa()}};return n(t)-n(e)}(t.type,e.type)||r.lo(t.doc,e.doc)}),this.po(n);var s=e?this.Eo():[],a=0===this.ho.size&&this.current?1:0,c=a!==this.ao;return this.ao=a,0!==o.length||c?{snapshot:new kf(this.query,t.fo,i,o,t.mutatedKeys,0===a,c,!1),To:s}:{To:s}},t.prototype.zr=function(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({fo:this.fo,mo:new If,mutatedKeys:this.mutatedKeys,Nn:!1},!1)):{To:[]}},t.prototype.Io=function(t){return!this.uo.has(t)&&!!this.fo.has(t)&&!this.fo.get(t).hasLocalMutations},t.prototype.po=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e.uo=e.uo.add(t)}),t.modifiedDocuments.forEach(function(t){}),t.removedDocuments.forEach(function(t){return e.uo=e.uo.delete(t)}),this.current=t.current)},t.prototype.Eo=function(){var t=this;if(!this.current)return[];var e=this.ho;this.ho=xu(),this.fo.forEach(function(e){t.Io(e.key)&&(t.ho=t.ho.add(e.key))});var n=[];return e.forEach(function(e){t.ho.has(e)||n.push(new Bf(e))}),this.ho.forEach(function(t){e.has(t)||n.push(new Ff(t))}),n},t.prototype.Ao=function(t){this.uo=t.Bn,this.ho=xu();var e=this._o(t.documents);return this.applyChanges(e,!0)},t.prototype.Ro=function(){return kf.fromInitialDocuments(this.query,this.fo,this.mutatedKeys,0===this.ao)},t}(),Vf=function(t,e,n){this.query=t,this.targetId=e,this.view=n},qf=function(t){this.key=t,this.bo=!1},Gf=function(){function t(t,e,n,r,i,o){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=o,this.vo={},this.Po=new Ld(function(t){return xl(t)},bl),this.Vo=new Map,this.So=new Set,this.Do=new lu(Ec.comparator),this.Co=new Map,this.No=new _p,this.xo={},this.ko=new Map,this.Fo=Cd.Yt(),this.onlineState="Unknown",this.$o=void 0}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.$o},enumerable:!1,configurable:!0}),t}();function $f(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(He.d)(this,function(a){switch(a.label){case 0:return n=bm(t),(i=n.Po.get(e))?(n.sharedClientState.addLocalQueryTarget(i.targetId),r=i.view.Ro(),[3,4]):[3,1];case 1:return[4,cp(n.localStore,yl(e))];case 2:return o=a.sent(),s=n.sharedClientState.addLocalQueryTarget(o.targetId),[4,Wf(n,e,o.targetId,"current"===s)];case 3:r=a.sent(),n.isPrimaryClient&&tf(n.remoteStore,o),a.label=4;case 4:return[2,r]}})})}function Wf(t,e,n,r){return Object(He.b)(this,void 0,void 0,function(){var i,o,s,a,c,l;return Object(He.d)(this,function(u){switch(u.label){case 0:return t.Oo=function(e,n,r){return function(t,e,n,r){return Object(He.b)(this,void 0,void 0,function(){var i,o,s;return Object(He.d)(this,function(a){switch(a.label){case 0:return(i=e.view._o(n)).Nn?[4,up(t.localStore,e.query,!1).then(function(t){return e.view._o(t.documents,i)})]:[3,2];case 1:i=a.sent(),a.label=2;case 2:return o=r&&r.targetChanges.get(e.targetId),s=e.view.applyChanges(i,t.isPrimaryClient,o),[2,(om(t,e.targetId,s.To),s.snapshot)]}})})}(t,e,n,r)},[4,up(t.localStore,e,!0)];case 1:return i=u.sent(),o=new Uf(e,i.Bn),s=o._o(i.documents),a=Eu.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState),c=o.applyChanges(s,t.isPrimaryClient,a),om(t,n,c.To),l=new Vf(e,n,o),[2,(t.Po.set(e,l),t.Vo.has(n)?t.Vo.get(n).push(e):t.Vo.set(n,[e]),c.snapshot)]}})})}function Hf(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i;return Object(He.d)(this,function(o){switch(o.label){case 0:return n=Qa(t),r=n.Po.get(e),(i=n.Vo.get(r.targetId)).length>1?[2,(n.Vo.set(r.targetId,i.filter(function(t){return!bl(t,e)})),void n.Po.delete(e))]:n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)?[3,2]:[4,lp(n.localStore,r.targetId,!1).then(function(){n.sharedClientState.clearQueryState(r.targetId),ef(n.remoteStore,r.targetId),rm(n,r.targetId)}).catch(Ad)]):[3,3];case 1:o.sent(),o.label=2;case 2:return[3,5];case 3:return rm(n,r.targetId),[4,lp(n.localStore,r.targetId,!0)];case 4:o.sent(),o.label=5;case 5:return[2]}})})}function Zf(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(He.d)(this,function(a){switch(a.label){case 0:r=xm(t),a.label=1;case 1:return a.trys.push([1,5,,6]),[4,function(t,e){var n,r=Qa(t),i=ic.now(),o=e.reduce(function(t,e){return t.add(e.key)},xu());return r.persistence.runTransaction("Locally write mutations","readwrite",function(t){return r.Mn.pn(t,o).next(function(o){n=o;for(var s=[],a=0,c=e;a<c.length;a++){var l=c[a],u=Zl(l,n.get(l.key));null!=u&&s.push(new Ql(l.key,u,Uc(u.value.mapValue),ql.exists(!0)))}return r._n.addMutationBatch(t,i,s,e)})}).then(function(t){return t.applyToLocalDocumentSet(n),{batchId:t.batchId,changes:n}})}(r.localStore,e)];case 2:return i=a.sent(),r.sharedClientState.addPendingMutation(i.batchId),function(t,e,n){var r=t.xo[t.currentUser.toKey()];r||(r=new lu(ec)),r=r.insert(e,n),t.xo[t.currentUser.toKey()]=r}(r,i.batchId,n),[4,cm(r,i.changes)];case 3:return a.sent(),[4,ff(r.remoteStore)];case 4:return a.sent(),[3,6];case 5:return o=a.sent(),s=Ef(o,"Failed to persist write"),n.reject(s),[3,6];case 6:return[2]}})})}function Kf(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r;return Object(He.d)(this,function(i){switch(i.label){case 0:n=Qa(t),i.label=1;case 1:return i.trys.push([1,4,,6]),[4,op(n.localStore,e)];case 2:return r=i.sent(),e.targetChanges.forEach(function(t,e){var r=n.Co.get(e);r&&(Ya(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.bo=!0:t.modifiedDocuments.size>0?Ya(r.bo):t.removedDocuments.size>0&&(Ya(r.bo),r.bo=!1))}),[4,cm(n,r,e)];case 3:return i.sent(),[3,6];case 4:return[4,Ad(i.sent())];case 5:return i.sent(),[3,6];case 6:return[2]}})})}function Xf(t,e,n){var r=Qa(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){var i=[];r.Po.forEach(function(t,n){var r=n.view.zr(e);r.snapshot&&i.push(r.snapshot)}),function(t,e){var n=Qa(t);n.onlineState=e;var r=!1;n.queries.forEach(function(t,n){for(var i=0,o=n.listeners;i<o.length;i++)o[i].zr(e)&&(r=!0)}),r&&Nf(n)}(r.eventManager,e),i.length&&r.vo._r(i),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}function Yf(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i,o,s,a,c;return Object(He.d)(this,function(l){switch(l.label){case 0:return(r=Qa(t)).sharedClientState.updateQueryState(e,"rejected",n),i=r.Co.get(e),(o=i&&i.key)?(s=(s=new lu(Ec.comparator)).insert(o,Vc.newNoDocument(o,oc.min())),a=xu().add(o),c=new Cu(oc.min(),new Map,new du(ec),s,a),[4,Kf(r,c)]):[3,2];case 1:return l.sent(),r.Do=r.Do.remove(o),r.Co.delete(e),am(r),[3,4];case 2:return[4,lp(r.localStore,e,!1).then(function(){return rm(r,e,n)}).catch(Ad)];case 3:l.sent(),l.label=4;case 4:return[2]}})})}function Qf(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i;return Object(He.d)(this,function(o){switch(o.label){case 0:n=Qa(t),r=e.batch.batchId,o.label=1;case 1:return o.trys.push([1,4,,6]),[4,rp(n.localStore,e)];case 2:return i=o.sent(),nm(n,r,null),em(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),[4,cm(n,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ad(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function Jf(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i;return Object(He.d)(this,function(o){switch(o.label){case 0:r=Qa(t),o.label=1;case 1:return o.trys.push([1,4,,6]),[4,function(t,e){var n=Qa(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",function(t){var r;return n._n.lookupMutationBatch(t,e).next(function(e){return Ya(null!==e),r=e.keys(),n._n.removeMutationBatch(t,e)}).next(function(){return n._n.performConsistencyCheck(t)}).next(function(){return n.Mn.pn(t,r)})})}(r.localStore,e)];case 2:return i=o.sent(),nm(r,e,n),em(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),[4,cm(r,i)];case 3:return o.sent(),[3,6];case 4:return[4,Ad(o.sent())];case 5:return o.sent(),[3,6];case 6:return[2]}})})}function tm(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i,o,s;return Object(He.d)(this,function(a){switch(a.label){case 0:af((n=Qa(t)).remoteStore)||Wa("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),a.label=1;case 1:return a.trys.push([1,3,,4]),[4,function(t){var e=Qa(t);return e.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(t){return e._n.getHighestUnacknowledgedBatchId(t)})}(n.localStore)];case 2:return-1===(r=a.sent())?[2,void e.resolve()]:((i=n.ko.get(r)||[]).push(e),n.ko.set(r,i),[3,4]);case 3:return o=a.sent(),s=Ef(o,"Initialization of waitForPendingWrites() operation failed"),e.reject(s),[3,4];case 4:return[2]}})})}function em(t,e){(t.ko.get(e)||[]).forEach(function(t){t.resolve()}),t.ko.delete(e)}function nm(t,e,n){var r=Qa(t),i=r.xo[r.currentUser.toKey()];if(i){var o=i.get(e);o&&(n?o.reject(n):o.resolve(),i=i.remove(e)),r.xo[r.currentUser.toKey()]=i}}function rm(t,e,n){void 0===n&&(n=null),t.sharedClientState.removeLocalQueryTarget(e);for(var r=0,i=t.Vo.get(e);r<i.length;r++){var o=i[r];t.Po.delete(o),n&&t.vo.Mo(o,n)}t.Vo.delete(e),t.isPrimaryClient&&t.No.Zn(e).forEach(function(e){t.No.containsKey(e)||im(t,e)})}function im(t,e){t.So.delete(e.path.canonicalString());var n=t.Do.get(e);null!==n&&(ef(t.remoteStore,n),t.Do=t.Do.remove(e),t.Co.delete(n),am(t))}function om(t,e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r];o instanceof Ff?(t.No.addReference(o.key,e),sm(t,o)):o instanceof Bf?(Wa("SyncEngine","Document no longer in limbo: "+o.key),t.No.removeReference(o.key,e),t.No.containsKey(o.key)||im(t,o.key)):Xa()}}function sm(t,e){var n=e.key,r=n.path.canonicalString();t.Do.get(n)||t.So.has(r)||(Wa("SyncEngine","New document in limbo: "+n),t.So.add(r),am(t))}function am(t){for(;t.So.size>0&&t.Do.size<t.maxConcurrentLimboResolutions;){var e=t.So.values().next().value;t.So.delete(e);var n=new Ec(uc.fromString(e)),r=t.Fo.next();t.Co.set(r,new qf(n)),t.Do=t.Do.insert(n,r),tf(t.remoteStore,new Xh(yl(hl(n.path)),r,2,Ua.o))}}function cm(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i,o,s;return Object(He.d)(this,function(a){switch(a.label){case 0:return r=Qa(t),i=[],o=[],s=[],r.Po.isEmpty()?[3,3]:(r.Po.forEach(function(t,a){s.push(r.Oo(a,e,n).then(function(t){if(t){r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,t.fromCache?"not-current":"current"),i.push(t);var e=Qd.Pn(a.targetId,t);o.push(e)}}))}),[4,Promise.all(s)]);case 1:return a.sent(),r.vo._r(i),[4,function(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,c,l;return Object(He.d)(this,function(u){switch(u.label){case 0:n=Qa(t),u.label=1;case 1:return u.trys.push([1,3,,4]),[4,n.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(t){return Lh.forEach(e,function(e){return Lh.forEach(e.bn,function(r){return n.persistence.referenceDelegate.addReference(t,e.targetId,r)}).next(function(){return Lh.forEach(e.vn,function(r){return n.persistence.referenceDelegate.removeReference(t,e.targetId,r)})})})})];case 2:return u.sent(),[3,4];case 3:if(!Uh(r=u.sent()))throw r;return Wa("LocalStore","Failed to update sequence numbers: "+r),[3,4];case 4:for(i=0,o=e;i<o.length;i++)a=(s=o[i]).targetId,s.fromCache||(c=n.kn.get(a),l=c.withLastLimboFreeSnapshotVersion(c.snapshotVersion),n.kn=n.kn.insert(a,l));return[2]}})})}(r.localStore,o)];case 2:a.sent(),a.label=3;case 3:return[2]}})})}function lm(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r;return Object(He.d)(this,function(i){switch(i.label){case 0:return(n=Qa(t)).currentUser.isEqual(e)?[3,3]:(Wa("SyncEngine","User change. New user:",e.toKey()),[4,np(n.localStore,e)]);case 1:return r=i.sent(),n.currentUser=e,function(t,e){t.ko.forEach(function(t){t.forEach(function(t){t.reject(new qa(Va.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))})}),t.ko.clear()}(n),n.sharedClientState.handleUserChange(e,r.removedBatchIds,r.addedBatchIds),[4,cm(n,r.Ln)];case 2:i.sent(),i.label=3;case 3:return[2]}})})}function um(t,e){var n=Qa(t),r=n.Co.get(e);if(r&&r.bo)return xu().add(r.key);var i=xu(),o=n.Vo.get(e);if(!o)return i;for(var s=0,a=o;s<a.length;s++){var c=n.Po.get(a[s]);i=i.unionWith(c.view.wo)}return i}function hm(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i;return Object(He.d)(this,function(o){switch(o.label){case 0:return[4,up((n=Qa(t)).localStore,e.query,!0)];case 1:return r=o.sent(),i=e.view.Ao(r),[2,(n.isPrimaryClient&&om(n,e.targetId,i.To),i)]}})})}function dm(t){return Object(He.b)(this,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){return[2,dp((e=Qa(t)).localStore).then(function(t){return cm(e,t)})]})})}function pm(t,e,n,r){return Object(He.b)(this,void 0,void 0,function(){var i,o;return Object(He.d)(this,function(s){switch(s.label){case 0:return[4,function(t,e){var n=Qa(t),r=Qa(n._n);return n.persistence.runTransaction("Lookup mutation documents","readonly",function(t){return r.jt(t,e).next(function(e){return e?n.Mn.pn(t,e):Lh.resolve(null)})})}((i=Qa(t)).localStore,e)];case 1:return null===(o=s.sent())?[3,6]:"pending"!==n?[3,3]:[4,ff(i.remoteStore)];case 2:return s.sent(),[3,4];case 3:"acknowledged"===n||"rejected"===n?(nm(i,e,r||null),em(i,e),function(t,e){Qa(Qa(t)._n).Gt(e)}(i.localStore,e)):Xa(),s.label=4;case 4:return[4,cm(i,o)];case 5:return s.sent(),[3,7];case 6:Wa("SyncEngine","Cannot apply mutation batch with id: "+e),s.label=7;case 7:return[2]}})})}function fm(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,c;return Object(He.d)(this,function(l){switch(l.label){case 0:return bm(n=Qa(t)),xm(n),!0!==e||!0===n.$o?[3,3]:(r=n.sharedClientState.getAllActiveQueryTargets(),[4,mm(n,r.toArray())]);case 1:return i=l.sent(),n.$o=!0,[4,xf(n.remoteStore,!0)];case 2:for(l.sent(),o=0,s=i;o<s.length;o++)tf(n.remoteStore,s[o]);return[3,7];case 3:return!1!==e||!1===n.$o?[3,7]:(a=[],c=Promise.resolve(),n.Vo.forEach(function(t,e){n.sharedClientState.isLocalQueryTarget(e)?a.push(e):c=c.then(function(){return rm(n,e),lp(n.localStore,e,!0)}),ef(n.remoteStore,e)}),[4,c]);case 4:return l.sent(),[4,mm(n,a)];case 5:return l.sent(),function(t){var e=Qa(t);e.Co.forEach(function(t,n){ef(e.remoteStore,n)}),e.No.ts(),e.Co=new Map,e.Do=new lu(Ec.comparator)}(n),n.$o=!1,[4,xf(n.remoteStore,!1)];case 6:l.sent(),l.label=7;case 7:return[2]}})})}function mm(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var n,r,i,o,s,a,c,l,u,h,d,p,f;return Object(He.d)(this,function(m){switch(m.label){case 0:n=Qa(t),r=[],i=[],o=0,s=e,m.label=1;case 1:return o<s.length?(c=void 0,(l=n.Vo.get(a=s[o]))&&0!==l.length?[4,cp(n.localStore,yl(l[0]))]:[3,7]):[3,13];case 2:c=m.sent(),u=0,h=l,m.label=3;case 3:return u<h.length?(d=n.Po.get(h[u]),[4,hm(n,d)]):[3,6];case 4:(p=m.sent()).snapshot&&i.push(p.snapshot),m.label=5;case 5:return u++,[3,3];case 6:return[3,11];case 7:return[4,hp(n.localStore,a)];case 8:return f=m.sent(),[4,cp(n.localStore,f)];case 9:return c=m.sent(),[4,Wf(n,gm(f),a,!1)];case 10:m.sent(),m.label=11;case 11:r.push(c),m.label=12;case 12:return o++,[3,1];case 13:return[2,(n.vo._r(i),r)]}})})}function gm(t){return ul(t.path,t.collectionGroup,t.orderBy,t.filters,t.limit,"F",t.startAt,t.endAt)}function _m(t){var e=Qa(t);return Qa(Qa(e.localStore).persistence).fn()}function ym(t,e,n,r){return Object(He.b)(this,void 0,void 0,function(){var i,o,s;return Object(He.d)(this,function(a){switch(a.label){case 0:return(i=Qa(t)).$o?(Wa("SyncEngine","Ignoring unexpected query state notification."),[3,8]):[3,1];case 1:if(!i.Vo.has(e))return[3,8];switch(n){case"current":case"not-current":return[3,2];case"rejected":return[3,5]}return[3,7];case 2:return[4,dp(i.localStore)];case 3:return o=a.sent(),s=Cu.createSynthesizedRemoteEventForCurrentChange(e,"current"===n),[4,cm(i,o,s)];case 4:return a.sent(),[3,8];case 5:return[4,lp(i.localStore,e,!0)];case 6:return a.sent(),rm(i,e,r),[3,8];case 7:Xa(),a.label=8;case 8:return[2]}})})}function vm(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i,o,s,a,c,l,u,h;return Object(He.d)(this,function(d){switch(d.label){case 0:if(!(r=bm(t)).$o)return[3,10];i=0,o=e,d.label=1;case 1:return i<o.length?r.Vo.has(s=o[i])?(Wa("SyncEngine","Adding an already active target "+s),[3,5]):[4,hp(r.localStore,s)]:[3,6];case 2:return a=d.sent(),[4,cp(r.localStore,a)];case 3:return c=d.sent(),[4,Wf(r,gm(a),c.targetId,!1)];case 4:d.sent(),tf(r.remoteStore,c),d.label=5;case 5:return i++,[3,1];case 6:l=function(t){return Object(He.d)(this,function(e){switch(e.label){case 0:return r.Vo.has(t)?[4,lp(r.localStore,t,!1).then(function(){ef(r.remoteStore,t),rm(r,t)}).catch(Ad)]:[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})},u=0,h=n,d.label=7;case 7:return u<h.length?[5,l(h[u])]:[3,10];case 8:d.sent(),d.label=9;case 9:return u++,[3,7];case 10:return[2]}})})}function bm(t){var e=Qa(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Kf.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=um.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Yf.bind(null,e),e.vo._r=Df.bind(null,e.eventManager),e.vo.Mo=Rf.bind(null,e.eventManager),e}function xm(t){var e=Qa(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Qf.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Jf.bind(null,e),e}var wm=function(){function t(){this.synchronizeTabs=!1}return t.prototype.initialize=function(t){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(e){switch(e.label){case 0:return this.R=Gp(t.databaseInfo.databaseId),this.sharedClientState=this.Bo(t),this.persistence=this.qo(t),[4,this.persistence.start()];case 1:return e.sent(),this.gcScheduler=this.Uo(t),this.localStore=this.Ko(t),[2]}})})},t.prototype.Uo=function(t){return null},t.prototype.Ko=function(t){return ep(this.persistence,new Jd,t.initialUser,this.R)},t.prototype.qo=function(t){return new Tp(Ep.bs,this.R)},t.prototype.Bo=function(t){return new Lp},t.prototype.terminate=function(){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(t){switch(t.label){case 0:return this.gcScheduler&&this.gcScheduler.stop(),[4,this.sharedClientState.shutdown()];case 1:return t.sent(),[4,this.persistence.shutdown()];case 2:return t.sent(),[2]}})})},t}(),Tm=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).Qo=e,i.cacheSizeBytes=n,i.forceOwnership=r,i.synchronizeTabs=!1,i}return Object(He.c)(e,t),e.prototype.initialize=function(e){return Object(He.b)(this,void 0,void 0,function(){var n=this;return Object(He.d)(this,function(r){switch(r.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return r.sent(),[4,pp(this.localStore)];case 2:return r.sent(),[4,this.Qo.initialize(this,e)];case 3:return r.sent(),[4,xm(this.Qo.syncEngine)];case 4:return r.sent(),[4,ff(this.Qo.remoteStore)];case 5:return r.sent(),[4,this.persistence.He(function(){return n.gcScheduler&&!n.gcScheduler.started&&n.gcScheduler.start(n.localStore),Promise.resolve()})];case 6:return r.sent(),[2]}})})},e.prototype.Ko=function(t){return ep(this.persistence,new Jd,t.initialUser,this.R)},e.prototype.Uo=function(t){return new Pd(this.persistence.referenceDelegate.garbageCollector,t.asyncQueue)},e.prototype.qo=function(t){var e=Kd(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey),n=void 0!==this.cacheSizeBytes?gd.withCacheSize(this.cacheSizeBytes):gd.DEFAULT;return new Wd(this.synchronizeTabs,e,t.clientId,n,t.asyncQueue,Vp(),qp(),this.R,this.sharedClientState,!!this.forceOwnership)},e.prototype.Bo=function(t){return new Lp},e}(wm),Cm=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n,!1)||this).Qo=e,r.cacheSizeBytes=n,r.synchronizeTabs=!0,r}return Object(He.c)(e,t),e.prototype.initialize=function(e){return Object(He.b)(this,void 0,void 0,function(){var n,r=this;return Object(He.d)(this,function(i){switch(i.label){case 0:return[4,t.prototype.initialize.call(this,e)];case 1:return i.sent(),n=this.Qo.syncEngine,this.sharedClientState instanceof Np?(this.sharedClientState.syncEngine={ui:pm.bind(null,n),ai:ym.bind(null,n),hi:vm.bind(null,n),fn:_m.bind(null,n),ci:dm.bind(null,n)},[4,this.sharedClientState.start()]):[3,3];case 2:i.sent(),i.label=3;case 3:return[4,this.persistence.He(function(t){return Object(He.b)(r,void 0,void 0,function(){return Object(He.d)(this,function(e){switch(e.label){case 0:return[4,fm(this.Qo.syncEngine,t)];case 1:return e.sent(),this.gcScheduler&&(t&&!this.gcScheduler.started?this.gcScheduler.start(this.localStore):t||this.gcScheduler.stop()),[2]}})})})];case 4:return i.sent(),[2]}})})},e.prototype.Bo=function(t){var e=Vp();if(!Np.yt(e))throw new qa(Va.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");var n=Kd(t.databaseInfo.databaseId,t.databaseInfo.persistenceKey);return new Np(e,t.asyncQueue,n,t.clientId,t.initialUser)},e}(Tm),Em=function(){function t(){}return t.prototype.initialize=function(t,e){return Object(He.b)(this,void 0,void 0,function(){var n=this;return Object(He.d)(this,function(r){switch(r.label){case 0:return this.localStore?[3,2]:(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=function(t){return Xf(n.syncEngine,t,1)},this.remoteStore.remoteSyncer.handleCredentialChange=lm.bind(null,this.syncEngine),[4,xf(this.remoteStore,this.syncEngine.isPrimaryClient)]);case 1:r.sent(),r.label=2;case 2:return[2]}})})},t.prototype.createEventManager=function(t){return new Mf},t.prototype.createDatastore=function(t){var e=Gp(t.databaseInfo.databaseId),n=new Up(t.databaseInfo);return function(t,e,n){return new Kp(t,e,n)}(t.credentials,n,e)},t.prototype.createRemoteStore=function(t){var e,n,r,i,o,s=this;return e=this.localStore,n=this.datastore,r=t.asyncQueue,i=function(t){return Xf(s.syncEngine,t,0)},o=zp.yt()?new zp:new jp,new Yp(e,n,r,i,o)},t.prototype.createSyncEngine=function(t,e){return function(t,e,n,r,i,o,s){var a=new Gf(t,e,n,r,i,o);return s&&(a.$o=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)},t.prototype.terminate=function(){return function(t){return Object(He.b)(this,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return e=Qa(t),Wa("RemoteStore","RemoteStore shutting down."),e.Or.add(5),[4,Jp(e)];case 1:return n.sent(),e.Lr.shutdown(),e.Br.set("Unknown"),[2]}})})}(this.remoteStore)},t}(),Sm=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.observer.next&&this.jo(this.observer.next,t)},t.prototype.error=function(t){this.observer.error?this.jo(this.observer.error,t):console.error("Uncaught Error in snapshot listener:",t)},t.prototype.Wo=function(){this.muted=!0},t.prototype.jo=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),Im=(function(){function t(t,e){var n=this;this.Go=t,this.R=e,this.metadata=new Nh,this.buffer=new Uint8Array,this.zo=new TextDecoder("utf-8"),this.Ho().then(function(t){t&&t.io()?n.metadata.resolve(t.payload.metadata):n.metadata.reject(new Error("The first element of the bundle is not a metadata, it is\n             "+JSON.stringify(null==t?void 0:t.payload)))},function(t){return n.metadata.reject(t)})}t.prototype.close=function(){return this.Go.cancel()},t.prototype.getMetadata=function(){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(t){return[2,this.metadata.promise]})})},t.prototype.Lo=function(){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(t){switch(t.label){case 0:return[4,this.getMetadata()];case 1:return[2,(t.sent(),this.Ho())]}})})},t.prototype.Ho=function(){return Object(He.b)(this,void 0,void 0,function(){var t,e,n,r;return Object(He.d)(this,function(i){switch(i.label){case 0:return[4,this.Jo()];case 1:return null===(t=i.sent())?[2,null]:(e=this.zo.decode(t),n=Number(e),isNaN(n)&&this.Yo("length string ("+e+") is not valid number"),[4,this.Xo(n)]);case 2:return r=i.sent(),[2,new jf(JSON.parse(r),t.length+n)]}})})},t.prototype.Zo=function(){return this.buffer.findIndex(function(t){return t==="{".charCodeAt(0)})},t.prototype.Jo=function(){return Object(He.b)(this,void 0,void 0,function(){var t,e;return Object(He.d)(this,function(n){switch(n.label){case 0:return this.Zo()<0?[4,this.tc()]:[3,3];case 1:if(n.sent())return[3,3];n.label=2;case 2:return[3,0];case 3:return 0===this.buffer.length?[2,null]:((t=this.Zo())<0&&this.Yo("Reached the end of bundle when a length string is expected."),e=this.buffer.slice(0,t),[2,(this.buffer=this.buffer.slice(t),e)])}})})},t.prototype.Xo=function(t){return Object(He.b)(this,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return this.buffer.length<t?[4,this.tc()]:[3,3];case 1:n.sent()&&this.Yo("Reached the end of bundle when more is expected."),n.label=2;case 2:return[3,0];case 3:return e=this.zo.decode(this.buffer.slice(0,t)),[2,(this.buffer=this.buffer.slice(t),e)]}})})},t.prototype.Yo=function(t){throw this.Go.cancel(),new Error("Invalid bundle format: "+t)},t.prototype.tc=function(){return Object(He.b)(this,void 0,void 0,function(){var t,e;return Object(He.d)(this,function(n){switch(n.label){case 0:return[4,this.Go.read()];case 1:return(t=n.sent()).done||((e=new Uint8Array(this.buffer.length+t.value.length)).set(this.buffer),e.set(t.value,this.buffer.length),this.buffer=e),[2,t.done]}})})}}(),function(){function t(t){this.datastore=t,this.readVersions=new Map,this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return Object(He.b)(this,void 0,void 0,function(){var e,n=this;return Object(He.d)(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new qa(Va.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,function(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i,o,s,a;return Object(He.d)(this,function(c){switch(c.label){case 0:return n=Qa(t),r=Wu(n.R)+"/documents",i={documents:e.map(function(t){return Vu(n.R,t)})},[4,n.$i("BatchGetDocuments",r,i)];case 1:return o=c.sent(),s=new Map,o.forEach(function(t){var e=function(t,e){return"found"in e?function(t,e){Ya(!!e.found);var n=qu(t,e.found.name),r=Fu(e.found.updateTime),i=new Bc({mapValue:{fields:e.found.fields}});return Vc.newFoundDocument(n,r,i)}(t,e):"missing"in e?function(t,e){Ya(!!e.missing),Ya(!!e.readTime);var n=qu(t,e.missing),r=Fu(e.readTime);return Vc.newNoDocument(n,r)}(t,e):Xa()}(n.R,t);s.set(e.key.toString(),e)}),a=[],[2,(e.forEach(function(t){var e=s.get(t.toString());Ya(!!e),a.push(e)}),a)]}})})}(this.datastore,t)];case 1:return[2,((e=r.sent()).forEach(function(t){return n.recordVersion(t)}),e)]}})})},t.prototype.set=function(t,e){this.write(e.toMutation(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.update=function(t,e){try{this.write(e.toMutation(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t.toString())},t.prototype.delete=function(t){this.write(new iu(t,this.precondition(t))),this.writtenDocs.add(t.toString())},t.prototype.commit=function(){return Object(He.b)(this,void 0,void 0,function(){var t,e=this;return Object(He.d)(this,function(n){switch(n.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;return t=this.readVersions,this.mutations.forEach(function(e){t.delete(e.key.toString())}),t.forEach(function(t,n){var r=Ec.fromPath(n);e.mutations.push(new ou(r,e.precondition(r)))}),[4,function(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i;return Object(He.d)(this,function(o){switch(o.label){case 0:return n=Qa(t),r=Wu(n.R)+"/documents",i={writes:e.map(function(t){return Xu(n.R,t)})},[4,n.Ni("Commit",r,i)];case 1:return o.sent(),[2]}})})}(this.datastore,this.mutations)];case 1:return n.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t.isFoundDocument())e=t.version;else{if(!t.isNoDocument())throw Xa();e=oc.min()}var n=this.readVersions.get(t.key.toString());if(n){if(!e.isEqual(n))throw new qa(Va.ABORTED,"Document version changed between two reads.")}else this.readVersions.set(t.key.toString(),e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t.toString());return!this.writtenDocs.has(t.toString())&&e?ql.updateTime(e):ql.none()},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t.toString());if(!this.writtenDocs.has(t.toString())&&e){if(e.isEqual(oc.min()))throw new qa(Va.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return ql.updateTime(e)}return ql.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations.push(t)},t.prototype.ensureCommitNotCalled=function(){},t}()),km=function(){function t(t,e,n,r){this.asyncQueue=t,this.datastore=e,this.updateFunction=n,this.deferred=r,this.ec=5,this.Zi=new $p(this.asyncQueue,"transaction_retry")}return t.prototype.run=function(){this.ec-=1,this.nc()},t.prototype.nc=function(){var t=this;this.Zi.ji(function(){return Object(He.b)(t,void 0,void 0,function(){var t,e,n=this;return Object(He.d)(this,function(r){return t=new Im(this.datastore),(e=this.sc(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.ic(t)})})}).catch(function(t){n.ic(t)}),[2]})})})},t.prototype.sc=function(t){try{var e=this.updateFunction(t);return!wc(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.ic=function(t){var e=this;this.ec>0&&this.rc(t)?(this.ec-=1,this.asyncQueue.enqueueAndForget(function(){return e.nc(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.rc=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!au(e)}return!1},t}(),Am=function(){function t(t,e,n){var r=this;this.credentials=t,this.asyncQueue=e,this.databaseInfo=n,this.user=Sp.UNAUTHENTICATED,this.clientId=tc.u(),this.credentialListener=function(){return Promise.resolve()},this.credentials.setChangeListener(e,function(t){return Object(He.b)(r,void 0,void 0,function(){return Object(He.d)(this,function(e){switch(e.label){case 0:return Wa("FirestoreClient","Received user=",t.uid),[4,this.credentialListener(t)];case 1:return e.sent(),this.user=t,[2]}})})})}return t.prototype.getConfiguration=function(){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(t){return[2,{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,credentials:this.credentials,initialUser:this.user,maxConcurrentLimboResolutions:100}]})})},t.prototype.setCredentialChangeListener=function(t){this.credentialListener=t},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new qa(Va.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.terminate=function(){var t=this;this.asyncQueue.enterRestrictedMode();var e=new Nh;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(function(){return Object(He.b)(t,void 0,void 0,function(){var t,n;return Object(He.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,5,,6]),this.onlineComponents?[4,this.onlineComponents.terminate()]:[3,2];case 1:r.sent(),r.label=2;case 2:return this.offlineComponents?[4,this.offlineComponents.terminate()]:[3,4];case 3:r.sent(),r.label=4;case 4:return this.credentials.removeChangeListener(),e.resolve(),[3,6];case 5:return t=r.sent(),n=Ef(t,"Failed to shutdown persistence"),e.reject(n),[3,6];case 6:return[2]}})})}),e.promise},t}();function Mm(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r,i=this;return Object(He.d)(this,function(o){switch(o.label){case 0:return t.asyncQueue.verifyOperationInProgress(),Wa("FirestoreClient","Initializing OfflineComponentProvider"),[4,t.getConfiguration()];case 1:return n=o.sent(),[4,e.initialize(n)];case 2:return o.sent(),r=n.initialUser,t.setCredentialChangeListener(function(t){return Object(He.b)(i,void 0,void 0,function(){return Object(He.d)(this,function(n){switch(n.label){case 0:return r.isEqual(t)?[3,2]:[4,np(e.localStore,t)];case 1:n.sent(),r=t,n.label=2;case 2:return[2]}})})}),e.persistence.setDatabaseDeletedListener(function(){return t.terminate()}),t.offlineComponents=e,[2]}})})}function Om(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r;return Object(He.d)(this,function(i){switch(i.label){case 0:return t.asyncQueue.verifyOperationInProgress(),[4,Pm(t)];case 1:return n=i.sent(),Wa("FirestoreClient","Initializing OnlineComponentProvider"),[4,t.getConfiguration()];case 2:return r=i.sent(),[4,e.initialize(n,r)];case 3:return i.sent(),t.setCredentialChangeListener(function(t){return function(t,e){return Object(He.b)(this,void 0,void 0,function(){var n,r;return Object(He.d)(this,function(i){switch(i.label){case 0:return(n=Qa(t)).asyncQueue.verifyOperationInProgress(),Wa("RemoteStore","RemoteStore received new credentials"),r=af(n),n.Or.add(3),[4,Jp(n)];case 1:return i.sent(),r&&n.Br.set("Unknown"),[4,n.remoteSyncer.handleCredentialChange(e)];case 2:return i.sent(),n.Or.delete(3),[4,Qp(n)];case 3:return i.sent(),[2]}})})}(e.remoteStore,t)}),t.onlineComponents=e,[2]}})})}function Pm(t){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(e){switch(e.label){case 0:return t.offlineComponents?[3,2]:(Wa("FirestoreClient","Using default OfflineComponentProvider"),[4,Mm(t,new wm)]);case 1:e.sent(),e.label=2;case 2:return[2,t.offlineComponents]}})})}function Dm(t){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(e){switch(e.label){case 0:return t.onlineComponents?[3,2]:(Wa("FirestoreClient","Using default OnlineComponentProvider"),[4,Om(t,new Em)]);case 1:e.sent(),e.label=2;case 2:return[2,t.onlineComponents]}})})}function Rm(t){return Pm(t).then(function(t){return t.persistence})}function Nm(t){return Pm(t).then(function(t){return t.localStore})}function Lm(t){return Dm(t).then(function(t){return t.remoteStore})}function jm(t){return Dm(t).then(function(t){return t.syncEngine})}function zm(t){return Object(He.b)(this,void 0,void 0,function(){var e,n;return Object(He.d)(this,function(r){switch(r.label){case 0:return[4,Dm(t)];case 1:return e=r.sent(),[2,((n=e.eventManager).onListen=$f.bind(null,e.syncEngine),n.onUnlisten=Hf.bind(null,e.syncEngine),n)]}})})}function Fm(t,e,n){var r=this;void 0===n&&(n={});var i=new Nh;return t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(r,void 0,void 0,function(){var r;return Object(He.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Sm({next:function(o){e.enqueueAndForget(function(){return Pf(t,s)});var a=o.docs.has(n);!a&&o.fromCache?i.reject(new qa(Va.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&o.fromCache&&r&&"server"===r.source?i.reject(new qa(Va.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(o)},error:function(t){return i.reject(t)}}),s=new Lf(hl(n.path),o,{includeMetadataChanges:!0,so:!0});return Of(t,s)},[4,zm(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}function Bm(t,e,n){var r=this;void 0===n&&(n={});var i=new Nh;return t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(r,void 0,void 0,function(){var r;return Object(He.d)(this,function(o){switch(o.label){case 0:return r=function(t,e,n,r,i){var o=new Sm({next:function(n){e.enqueueAndForget(function(){return Pf(t,s)}),n.fromCache&&"server"===r.source?i.reject(new qa(Va.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(n)},error:function(t){return i.reject(t)}}),s=new Lf(n,o,{includeMetadataChanges:!0,so:!0});return Of(t,s)},[4,zm(t)];case 1:return[2,r.apply(void 0,[o.sent(),t.asyncQueue,e,n,i])]}})})}),i.promise}var Um=function(t,e,n,r,i,o,s,a){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=o,this.autoDetectLongPolling=s,this.useFetchStreams=a},Vm=function(){function t(t,e){this.projectId=t,this.database=e||"(default)"}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return"(default)"===this.database},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t}(),qm=new Map,Gm=function(t,e){this.user=e,this.type="OAuth",this.authHeaders={},this.authHeaders.Authorization="Bearer "+t},$m=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){this.changeListener=e,t.enqueueRetryable(function(){return e(Sp.UNAUTHENTICATED)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Wm=function(){function t(t){this.token=t,this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(this.token)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t,e){var n=this;this.changeListener=e,t.enqueueRetryable(function(){return e(n.token.user)})},t.prototype.removeChangeListener=function(){this.changeListener=null},t}(),Hm=function(){function t(t){var e=this;this.currentUser=Sp.UNAUTHENTICATED,this.oc=new Nh,this.cc=0,this.forceRefresh=!1,this.auth=null,this.asyncQueue=null,this.uc=function(){e.cc++,e.currentUser=e.ac(),e.oc.resolve(),e.changeListener&&e.asyncQueue.enqueueRetryable(function(){return e.changeListener(e.currentUser)})};var n=function(t){Wa("FirebaseCredentialsProvider","Auth detected"),e.auth=t,e.auth.addAuthTokenListener(e.uc)};t.onInit(function(t){return n(t)}),setTimeout(function(){if(!e.auth){var r=t.getImmediate({optional:!0});r?n(r):(Wa("FirebaseCredentialsProvider","Auth not yet detected"),e.oc.resolve())}},0)}return t.prototype.getToken=function(){var t=this,e=this.cc,n=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(n).then(function(n){return t.cc!==e?(Wa("FirebaseCredentialsProvider","getToken aborted due to token change."),t.getToken()):n?(Ya("string"==typeof n.accessToken),new Gm(n.accessToken,t.currentUser)):null}):Promise.resolve(null)},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t,e){var n=this;this.asyncQueue=t,this.asyncQueue.enqueueRetryable(function(){return Object(He.b)(n,void 0,void 0,function(){return Object(He.d)(this,function(t){switch(t.label){case 0:return[4,this.oc.promise];case 1:return t.sent(),[4,e(this.currentUser)];case 2:return t.sent(),this.changeListener=e,[2]}})})})},t.prototype.removeChangeListener=function(){this.auth&&this.auth.removeAuthTokenListener(this.uc),this.changeListener=function(){return Promise.resolve()}},t.prototype.ac=function(){var t=this.auth&&this.auth.getUid();return Ya(null===t||"string"==typeof t),new Sp(t)},t}(),Zm=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n,this.type="FirstParty",this.user=Sp.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.lc},e=this.hc.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),this.fc&&(t["X-Goog-Iam-Authorization-Token"]=this.fc),t},enumerable:!1,configurable:!0}),t}(),Km=function(){function t(t,e,n){this.hc=t,this.lc=e,this.fc=n}return t.prototype.getToken=function(){return Promise.resolve(new Zm(this.hc,this.lc,this.fc))},t.prototype.setChangeListener=function(t,e){t.enqueueRetryable(function(){return e(Sp.FIRST_PARTY)})},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function Xm(t,e,n){if(!n)throw new qa(Va.INVALID_ARGUMENT,"Function "+t+"() cannot be called with an empty "+e+".")}function Ym(t,e){if(void 0===e)return{merge:!1};if(void 0!==e.mergeFields&&void 0!==e.merge)throw new qa(Va.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Qm(t,e,n,r){if(!0===e&&!0===r)throw new qa(Va.INVALID_ARGUMENT,t+" and "+n+" cannot be used together.")}function Jm(t){if(!Ec.isDocumentKey(t))throw new qa(Va.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+t+" has "+t.length+".")}function tg(t){if(Ec.isDocumentKey(t))throw new qa(Va.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+t+" has "+t.length+".")}function eg(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Xa()}function ng(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new qa(Va.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");var n=eg(t);throw new qa(Va.INVALID_ARGUMENT,"Expected type '"+e.name+"', but it was: "+n)}return t}function rg(t,e){if(e<=0)throw new qa(Va.INVALID_ARGUMENT,"Function "+t+"() requires a positive number, but it was: "+e+".")}var ig=function(){function t(t){var e;if(void 0===t.host){if(void 0!==t.ssl)throw new qa(Va.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new qa(Va.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.useFetchStreams=!!t.useFetchStreams,Qm("experimentalForceLongPolling",t.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",t.experimentalAutoDetectLongPolling)}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams},t}(),og=function(){function t(t,e){this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ig({}),this._settingsFrozen=!1,t instanceof Vm?(this._databaseId=t,this._credentials=new $m):(this._app=t,this._databaseId=function(t){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new qa(Va.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Vm(t.options.projectId)}(t),this._credentials=new Hm(e))}return Object.defineProperty(t.prototype,"app",{get:function(){if(!this._app)throw new qa(Va.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_initialized",{get:function(){return this._settingsFrozen},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_terminated",{get:function(){return void 0!==this._terminateTask},enumerable:!1,configurable:!0}),t.prototype._setSettings=function(t){if(this._settingsFrozen)throw new qa(Va.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ig(t),void 0!==t.credentials&&(this._credentials=function(t){if(!t)return new $m;switch(t.type){case"gapi":var e=t.client;return Ya(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty)),new Km(e,t.sessionIndex||"0",t.iamToken||null);case"provider":return t.client;default:throw new qa(Va.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(t.credentials))},t.prototype._getSettings=function(){return this._settings},t.prototype._freezeSettings=function(){return this._settingsFrozen=!0,this._settings},t.prototype._delete=function(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask},t.prototype.toJSON=function(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}},t.prototype._terminate=function(){return(t=qm.get(this))&&(Wa("ComponentProvider","Removing Datastore"),qm.delete(this),t.terminate()),Promise.resolve();var t},t}(),sg=function(){function t(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}return Object.defineProperty(t.prototype,"_path",{get:function(){return this._key.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new cg(this.firestore,this.converter,this._key.path.popLast())},enumerable:!1,configurable:!0}),t.prototype.withConverter=function(e){return new t(this.firestore,e,this._key)},t}(),ag=function(){function t(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}return t.prototype.withConverter=function(e){return new t(this.firestore,e,this._query)},t}(),cg=function(t){function e(e,n,r){var i=this;return(i=t.call(this,e,n,hl(r))||this)._path=r,i.type="collection",i}return Object(He.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._path.popLast();return t.isEmpty()?null:new sg(this.firestore,null,new Ec(t))},enumerable:!1,configurable:!0}),e.prototype.withConverter=function(t){return new e(this.firestore,t,this._path)},e}(ag);function lg(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(Ze.o)(t),Xm("collection","path",e),t instanceof og)return tg(n=uc.fromString.apply(uc,Object(He.f)([e],r))),new cg(t,null,n);if(!(t instanceof sg||t instanceof cg))throw new qa(Va.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return tg(n=uc.fromString.apply(uc,Object(He.f)([t.path],r)).child(uc.fromString(e))),new cg(t.firestore,null,n)}function ug(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];if(t=Object(Ze.o)(t),1===arguments.length&&(e=tc.u()),Xm("doc","path",e),t instanceof og)return Jm(n=uc.fromString.apply(uc,Object(He.f)([e],r))),new sg(t,null,new Ec(n));if(!(t instanceof sg||t instanceof cg))throw new qa(Va.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");return Jm(n=t._path.child(uc.fromString.apply(uc,Object(He.f)([e],r)))),new sg(t.firestore,t instanceof cg?t.converter:null,new Ec(n))}function hg(t,e){return t=Object(Ze.o)(t),e=Object(Ze.o)(e),(t instanceof sg||t instanceof cg)&&(e instanceof sg||e instanceof cg)&&t.firestore===e.firestore&&t.path===e.path&&t.converter===e.converter}function dg(t,e){return t=Object(Ze.o)(t),e=Object(Ze.o)(e),t instanceof ag&&e instanceof ag&&t.firestore===e.firestore&&bl(t._query,e._query)&&t.converter===e.converter}var pg=function(){function t(){var t=this;this.dc=Promise.resolve(),this.wc=[],this._c=!1,this.mc=[],this.yc=null,this.gc=!1,this.Ec=!1,this.Tc=[],this.Zi=new $p(this,"async_queue_retry"),this.Ic=function(){var e=qp();e&&Wa("AsyncQueue","Visibility state changed to "+e.visibilityState),t.Zi.Gi()};var e=qp();e&&"function"==typeof e.addEventListener&&e.addEventListener("visibilitychange",this.Ic)}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._c},enumerable:!1,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenWhileRestricted=function(t){this.Ac(),this.Rc(t)},t.prototype.enterRestrictedMode=function(t){if(!this._c){this._c=!0,this.Ec=t||!1;var e=qp();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this.Ic)}},t.prototype.enqueue=function(t){var e=this;if(this.Ac(),this._c)return new Promise(function(){});var n=new Nh;return this.Rc(function(){return e._c&&e.Ec?Promise.resolve():(t().then(n.resolve,n.reject),n.promise)}).then(function(){return n.promise})},t.prototype.enqueueRetryable=function(t){var e=this;this.enqueueAndForget(function(){return e.wc.push(t),e.bc()})},t.prototype.bc=function(){return Object(He.b)(this,void 0,void 0,function(){var t,e=this;return Object(He.d)(this,function(n){switch(n.label){case 0:if(0===this.wc.length)return[3,5];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,this.wc[0]()];case 2:return n.sent(),this.wc.shift(),this.Zi.reset(),[3,4];case 3:if(!Uh(t=n.sent()))throw t;return Wa("AsyncQueue","Operation failed with retryable error: "+t),[3,4];case 4:this.wc.length>0&&this.Zi.ji(function(){return e.bc()}),n.label=5;case 5:return[2]}})})},t.prototype.Rc=function(t){var e=this,n=this.dc.then(function(){return e.gc=!0,t().catch(function(t){throw e.yc=t,e.gc=!1,Ha("INTERNAL UNHANDLED ERROR: ",function(t){var e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t)),t}).then(function(t){return e.gc=!1,t})});return this.dc=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.Ac(),this.Tc.indexOf(t)>-1&&(e=0);var i=Cf.createAndSchedule(this,t,e,n,function(t){return r.vc(t)});return this.mc.push(i),i},t.prototype.Ac=function(){this.yc&&Xa()},t.prototype.verifyOperationInProgress=function(){},t.prototype.Pc=function(){return Object(He.b)(this,void 0,void 0,function(){var t;return Object(He.d)(this,function(e){switch(e.label){case 0:return[4,t=this.dc];case 1:e.sent(),e.label=2;case 2:if(t!==this.dc)return[3,0];e.label=3;case 3:return[2]}})})},t.prototype.Vc=function(t){for(var e=0,n=this.mc;e<n.length;e++)if(n[e].timerId===t)return!0;return!1},t.prototype.Sc=function(t){var e=this;return this.Pc().then(function(){e.mc.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.mc;n<r.length;n++){var i=r[n];if(i.skipDelay(),"all"!==t&&i.timerId===t)break}return e.Pc()})},t.prototype.Dc=function(t){this.Tc.push(t)},t.prototype.vc=function(t){var e=this.mc.indexOf(t);this.mc.splice(e,1)},t}();function fg(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=["next","error","complete"];r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t)}!function(){function t(){this._progressObserver={},this._taskCompletionResolver=new Nh,this._lastProgress={taskState:"Running",totalBytes:0,totalDocuments:0,bytesLoaded:0,documentsLoaded:0}}t.prototype.onProgress=function(t,e,n){this._progressObserver={next:t,error:e,complete:n}},t.prototype.catch=function(t){return this._taskCompletionResolver.promise.catch(t)},t.prototype.then=function(t,e){return this._taskCompletionResolver.promise.then(t,e)},t.prototype._completeWith=function(t){this._updateProgress(t),this._progressObserver.complete&&this._progressObserver.complete(),this._taskCompletionResolver.resolve(t)},t.prototype._failWith=function(t){this._lastProgress.taskState="Error",this._progressObserver.next&&this._progressObserver.next(this._lastProgress),this._progressObserver.error&&this._progressObserver.error(t),this._taskCompletionResolver.reject(t)},t.prototype._updateProgress=function(t){this._lastProgress=t,this._progressObserver.next&&this._progressObserver.next(t)}}();var mg=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).type="firestore",r._queue=new pg,r._persistenceKey="name"in e?e.name:"[DEFAULT]",r}return Object(He.c)(e,t),e.prototype._terminate=function(){return this._firestoreClient||_g(this),this._firestoreClient.terminate()},e}(og);function gg(t){return t._firestoreClient||_g(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function _g(t){var e,n=t._freezeSettings(),r=function(t,e,n,r){return new Um(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,n);t._firestoreClient=new Am(t._credentials,t._queue,r)}function yg(t,e,n){var r=this,i=new Nh;return t.asyncQueue.enqueue(function(){return Object(He.b)(r,void 0,void 0,function(){var r;return Object(He.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,3,,4]),[4,Mm(t,n)];case 1:return o.sent(),[4,Om(t,e)];case 2:return o.sent(),i.resolve(),[3,4];case 3:if(!function(t){return"FirebaseError"===t.name?t.code===Va.FAILED_PRECONDITION||t.code===Va.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(r=o.sent()))throw r;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+r),i.reject(r),[3,4];case 4:return[2]}})})}).then(function(){return i.promise})}function vg(t){if(t._initialized||t._terminated)throw new qa(Va.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only enable persistence before calling any other methods on a Firestore object.")}var bg=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=0;n<t.length;++n)if(0===t[n].length)throw new qa(Va.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new dc(t)}return t.prototype.isEqual=function(t){return this._internalPath.isEqual(t._internalPath)},t}(),xg=function(){function t(t){this._byteString=t}return t.fromBase64String=function(e){try{return new t(fc.fromBase64String(e))}catch(e){throw new qa(Va.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}},t.fromUint8Array=function(e){return new t(fc.fromUint8Array(e))},t.prototype.toBase64=function(){return this._byteString.toBase64()},t.prototype.toUint8Array=function(){return this._byteString.toUint8Array()},t.prototype.toString=function(){return"Bytes(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._byteString.isEqual(t._byteString)},t}(),wg=function(t){this._methodName=t},Tg=function(){function t(t,e){if(!isFinite(t)||t<-90||t>90)throw new qa(Va.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new qa(Va.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!1,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype.toJSON=function(){return{latitude:this._lat,longitude:this._long}},t.prototype._compareTo=function(t){return ec(this._lat,t._lat)||ec(this._long,t._long)},t}(),Cg=/^__.*__$/,Eg=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return null!==this.fieldMask?new Ql(t,this.data,this.fieldMask,e,this.fieldTransforms):new Yl(t,this.data,e,this.fieldTransforms)},t}(),Sg=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutation=function(t,e){return new Ql(t,this.data,this.fieldMask,e,this.fieldTransforms)},t}();function Ig(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Xa()}}var kg=function(){function t(t,e,n,r,i,o){this.settings=t,this.databaseId=e,this.R=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Cc(),this.fieldTransforms=i||[],this.fieldMask=o||[]}return Object.defineProperty(t.prototype,"path",{get:function(){return this.settings.path},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"Nc",{get:function(){return this.settings.Nc},enumerable:!1,configurable:!0}),t.prototype.xc=function(e){return new t(Object.assign(Object.assign({},this.settings),e),this.databaseId,this.R,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)},t.prototype.kc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.$c(t),r},t.prototype.Oc=function(t){var e,n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.xc({path:n,Fc:!1});return r.Cc(),r},t.prototype.Mc=function(t){return this.xc({path:void 0,Fc:!0})},t.prototype.Lc=function(t){return Zg(t,this.settings.methodName,this.settings.Bc||!1,this.path,this.settings.qc)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.Cc=function(){if(this.path)for(var t=0;t<this.path.length;t++)this.$c(this.path.get(t))},t.prototype.$c=function(t){if(0===t.length)throw this.Lc("Document fields must not be empty");if(Ig(this.Nc)&&Cg.test(t))throw this.Lc('Document fields cannot begin and end with "__"')},t}(),Ag=function(){function t(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.R=n||Gp(t)}return t.prototype.Uc=function(t,e,n,r){return void 0===r&&(r=!1),new kg({Nc:t,methodName:e,qc:n,path:dc.emptyPath(),Fc:!1,Bc:r},this.databaseId,this.R,this.ignoreUndefinedProperties)},t}();function Mg(t){var e=t._freezeSettings(),n=Gp(t._databaseId);return new Ag(t._databaseId,!!e.ignoreUndefinedProperties,n)}function Og(t,e,n,r,i,o){void 0===o&&(o={});var s=t.Uc(o.merge||o.mergeFields?2:0,e,n,i);Gg("Data must be an object, but it was:",s,r);var a,c,l=Vg(r,s);if(o.merge)a=new pc(s.fieldMask),c=s.fieldTransforms;else if(o.mergeFields){for(var u=[],h=0,d=o.mergeFields;h<d.length;h++){var p=$g(e,d[h],n);if(!s.contains(p))throw new qa(Va.INVALID_ARGUMENT,"Field '"+p+"' is specified in your field mask but missing from your input data.");Kg(u,p)||u.push(p)}a=new pc(u),c=s.fieldTransforms.filter(function(t){return a.covers(t.field)})}else a=null,c=s.fieldTransforms;return new Eg(new Bc(l),a,c)}var Pg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(He.c)(e,t),e.prototype._toFieldTransform=function(t){if(2!==t.Nc)throw t.Lc(1===t.Nc?this._methodName+"() can only appear at the top level of your update data":this._methodName+"() cannot be used with set() unless you pass {merge:true}");return t.fieldMask.push(t.path),null},e.prototype.isEqual=function(t){return t instanceof e},e}(wg);function Dg(t,e,n){return new kg({Nc:3,qc:e.settings.qc,methodName:t._methodName,Fc:n},e.databaseId,e.R,e.ignoreUndefinedProperties)}var Rg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(He.c)(e,t),e.prototype._toFieldTransform=function(t){return new Ul(t.path,new Dl)},e.prototype.isEqual=function(t){return t instanceof e},e}(wg),Ng=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(He.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Dg(this,t,!0),n=this.Kc.map(function(t){return Ug(t,e)}),r=new Rl(n);return new Ul(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(wg),Lg=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Kc=n,r}return Object(He.c)(e,t),e.prototype._toFieldTransform=function(t){var e=Dg(this,t,!0),n=this.Kc.map(function(t){return Ug(t,e)}),r=new Ll(n);return new Ul(t.path,r)},e.prototype.isEqual=function(t){return this===t},e}(wg),jg=function(t){function e(e,n){var r=this;return(r=t.call(this,e)||this).Qc=n,r}return Object(He.c)(e,t),e.prototype._toFieldTransform=function(t){var e=new zl(t.R,kl(t.R,this.Qc));return new Ul(t.path,e)},e.prototype.isEqual=function(t){return this===t},e}(wg);function zg(t,e,n,r){var i=t.Uc(1,e,n);Gg("Data must be an object, but it was:",i,r);var o=[],s=Bc.empty();ac(r,function(t,r){var a=Hg(e,t,n);r=Object(Ze.o)(r);var c=i.Oc(a);if(r instanceof Pg)o.push(a);else{var l=Ug(r,c);null!=l&&(o.push(a),s.set(a,l))}});var a=new pc(o);return new Sg(s,a,i.fieldTransforms)}function Fg(t,e,n,r,i,o){var s=t.Uc(1,e,n),a=[$g(e,r,n)],c=[i];if(o.length%2!=0)throw new qa(Va.INVALID_ARGUMENT,"Function "+e+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var l=0;l<o.length;l+=2)a.push($g(e,o[l])),c.push(o[l+1]);for(var u=[],h=Bc.empty(),d=a.length-1;d>=0;--d)if(!Kg(u,a[d])){var p=a[d],f=c[d];f=Object(Ze.o)(f);var m=s.Oc(p);if(f instanceof Pg)u.push(p);else{var g=Ug(f,m);null!=g&&(u.push(p),h.set(p,g))}}var _=new pc(u);return new Sg(h,_,s.fieldTransforms)}function Bg(t,e,n,r){return void 0===r&&(r=!1),Ug(n,t.Uc(r?4:3,e))}function Ug(t,e){if(qg(t=Object(Ze.o)(t)))return Gg("Unsupported field value:",e,t),Vg(t,e);if(t instanceof wg)return function(t,e){if(!Ig(e.Nc))throw e.Lc(t._methodName+"() can only be used with update() and set()");if(!e.path)throw e.Lc(t._methodName+"() is not currently supported inside arrays");var n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Fc&&4!==e.Nc)throw e.Lc("Nested arrays are not supported");return function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var s=Ug(o[i],e.Mc(r));null==s&&(s={nullValue:"NULL_VALUE"}),n.push(s),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=Object(Ze.o)(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return kl(e.R,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){var n=ic.fromDate(t);return{timestampValue:Lu(e.R,n)}}if(t instanceof ic)return n=new ic(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)),{timestampValue:Lu(e.R,n)};if(t instanceof Tg)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof xg)return{bytesValue:ju(e.R,t._byteString)};if(t instanceof sg){var r=t.firestore._databaseId;if(!r.isEqual(n=e.databaseId))throw e.Lc("Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return{referenceValue:Bu(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.Lc("Unsupported field value: "+eg(t))}(t,e)}function Vg(t,e){var n={};return cc(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):ac(t,function(t,r){var i=Ug(r,e.kc(t));null!=i&&(n[t]=i)}),{mapValue:{fields:n}}}function qg(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof ic||t instanceof Tg||t instanceof xg||t instanceof sg||t instanceof wg)}function Gg(t,e,n){if(!qg(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){var r=eg(n);throw e.Lc("an object"===r?t+" a custom object":t+" "+r)}}function $g(t,e,n){if((e=Object(Ze.o)(e))instanceof bg)return e._internalPath;if("string"==typeof e)return Hg(t,e);throw Zg("Field path arguments must be of type string or FieldPath.",t,!1,void 0,n)}var Wg=new RegExp("[~\\*/\\[\\]]");function Hg(t,e,n){if(e.search(Wg)>=0)throw Zg("Invalid field path ("+e+"). Paths must not contain '~', '*', '/', '[', or ']'",t,!1,void 0,n);try{return(new(bg.bind.apply(bg,Object(He.f)([void 0],e.split(".")))))._internalPath}catch(K_){throw Zg("Invalid field path ("+e+"). Paths must not be empty, begin with '.', end with '.', or contain '..'",t,!1,void 0,n)}}function Zg(t,e,n,r,i){var o=r&&!r.isEmpty(),s=void 0!==i,a="Function "+e+"() called with invalid data";n&&(a+=" (via `toFirestore()`)");var c="";return(o||s)&&(c+=" (found",o&&(c+=" in field "+r),s&&(c+=" in document "+i),c+=")"),new qa(Va.INVALID_ARGUMENT,(a+=". ")+t+c)}function Kg(t,e){return t.some(function(t){return t.isEqual(e)})}var Xg=function(){function t(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}return Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new sg(this._firestore,this._converter,this._key)},enumerable:!1,configurable:!0}),t.prototype.exists=function(){return null!==this._document},t.prototype.data=function(){if(this._document){if(this._converter){var t=new Yg(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}},t.prototype.get=function(t){if(this._document){var e=this._document.data.field(Qg("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}},t}(),Yg=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(He.c)(e,t),e.prototype.data=function(){return t.prototype.data.call(this)},e}(Xg);function Qg(t,e){return"string"==typeof e?Hg(t,e):e instanceof bg?e._internalPath:e._delegate._internalPath}var Jg=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),t_=function(t){function e(e,n,r,i,o,s){var a=this;return(a=t.call(this,e,n,r,i,s)||this)._firestore=e,a._firestoreImpl=e,a.metadata=o,a}return Object(He.c)(e,t),e.prototype.exists=function(){return t.prototype.exists.call(this)},e.prototype.data=function(t){if(void 0===t&&(t={}),this._document){if(this._converter){var e=new e_(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}},e.prototype.get=function(t,e){if(void 0===e&&(e={}),this._document){var n=this._document.data.field(Qg("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}},e}(Xg),e_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(He.c)(e,t),e.prototype.data=function(e){return void 0===e&&(e={}),t.prototype.data.call(this,e)},e}(t_),n_=function(){function t(t,e,n,r){this._firestore=t,this._userDataWriter=e,this._snapshot=r,this.metadata=new Jg(r.hasPendingWrites,r.fromCache),this.query=n}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return 0===this.size},enumerable:!1,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;this._snapshot.docs.forEach(function(r){t.call(e,new e_(n._firestore,n._userDataWriter,r.key,r,new Jg(n._snapshot.mutatedKeys.has(r.key),n._snapshot.fromCache),n.query.converter))})},t.prototype.docChanges=function(t){void 0===t&&(t={});var e=!!t.includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new qa(Va.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e){if(t._snapshot.oldDocs.isEmpty()){var n=0;return t._snapshot.docChanges.map(function(e){return{type:"added",doc:new e_(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Jg(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),oldIndex:-1,newIndex:n++}})}var r=t._snapshot.oldDocs;return t._snapshot.docChanges.filter(function(t){return e||3!==t.type}).map(function(e){var n=new e_(t._firestore,t._userDataWriter,e.doc.key,e.doc,new Jg(t._snapshot.mutatedKeys.has(e.doc.key),t._snapshot.fromCache),t.query.converter),i=-1,o=-1;return 0!==e.type&&(i=r.indexOf(e.doc.key),r=r.delete(e.doc.key)),1!==e.type&&(o=(r=r.add(e.doc)).indexOf(e.doc.key)),{type:r_(e.type),doc:n,oldIndex:i,newIndex:o}})}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t}();function r_(t){switch(t){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Xa()}}function i_(t,e){return t instanceof t_&&e instanceof t_?t._firestore===e._firestore&&t._key.isEqual(e._key)&&(null===t._document?null===e._document:t._document.isEqual(e._document))&&t._converter===e._converter:t instanceof n_&&e instanceof n_&&t._firestore===e._firestore&&dg(t.query,e.query)&&t.metadata.isEqual(e.metadata)&&t._snapshot.isEqual(e._snapshot)}function o_(t){if(pl(t)&&0===t.explicitOrderBy.length)throw new qa(Va.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}var s_=function(){};function a_(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=0,i=e;r<i.length;r++){var o=i[r];t=o._apply(t)}return t}var c_=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).jc=e,i.Wc=n,i.Gc=r,i.type="where",i}return Object(He.c)(e,t),e.prototype._apply=function(t){var e=Mg(t.firestore),n=function(t,e,n,r,i,o,s){var a;if(i.isKeyField()){if("array-contains"===o||"array-contains-any"===o)throw new qa(Va.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+o+"' queries on FieldPath.documentId().");if("in"===o||"not-in"===o){m_(s,o);for(var c=[],l=0,u=s;l<u.length;l++)c.push(f_(r,t,u[l]));a={arrayValue:{values:c}}}else a=f_(r,t,s)}else"in"!==o&&"not-in"!==o&&"array-contains-any"!==o||m_(s,o),a=Bg(n,"where",s,"in"===o||"not-in"===o);var h=Zc.create(i,o,a);return function(t,e){if(e.g()){var n=ml(t);if(null!==n&&!n.isEqual(e.field))throw new qa(Va.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, !=, not-in, >, or >=) must be on the same field. But you have inequality filters on '"+n.toString()+"' and '"+e.field.toString()+"'");var r=fl(t);null!==r&&g_(0,e.field,r)}var i=function(t,e){for(var n=0,r=t.filters;n<r.length;n++){var i=r[n];if(e.indexOf(i.op)>=0)return i.op}return null}(t,function(t){switch(t){case"!=":return["!=","not-in"];case"array-contains":return["array-contains","array-contains-any","not-in"];case"in":return["array-contains-any","in","not-in"];case"array-contains-any":return["array-contains","array-contains-any","in","not-in"];case"not-in":return["array-contains","array-contains-any","in","not-in","!="];default:return[]}}(e.op));if(null!==i)throw new qa(Va.INVALID_ARGUMENT,i===e.op?"Invalid query. You cannot use more than one '"+e.op.toString()+"' filter.":"Invalid query. You cannot use '"+e.op.toString()+"' filters with '"+i.toString()+"' filters.")}(t,h),h}(t._query,0,e,t.firestore._databaseId,this.jc,this.Wc,this.Gc);return new ag(t.firestore,t.converter,function(t,e){var n=t.filters.concat([e]);return new ll(t.path,t.collectionGroup,t.explicitOrderBy.slice(),n,t.limit,t.limitType,t.startAt,t.endAt)}(t._query,n))},e}(s_),l_=function(t){function e(e,n){var r=this;return(r=t.call(this)||this).jc=e,r.zc=n,r.type="orderBy",r}return Object(He.c)(e,t),e.prototype._apply=function(t){var e=function(t,e,n){if(null!==t.startAt)throw new qa(Va.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==t.endAt)throw new qa(Va.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");var r=new ol(e,n);return function(t,e){if(null===fl(t)){var n=ml(t);null!==n&&g_(0,n,e.field)}}(t,r),r}(t._query,this.jc,this.zc);return new ag(t.firestore,t.converter,function(t,e){var n=t.explicitOrderBy.concat([e]);return new ll(t.path,t.collectionGroup,n,t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(t._query,e))},e}(s_),u_=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Hc=n,i.Jc=r,i}return Object(He.c)(e,t),e.prototype._apply=function(t){return new ag(t.firestore,t.converter,vl(t._query,this.Hc,this.Jc))},e}(s_),h_=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(He.c)(e,t),e.prototype._apply=function(t){var e=p_(t,this.type,this.Yc,this.Xc);return new ag(t.firestore,t.converter,function(t,e){return new ll(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,e,t.endAt)}(t._query,e))},e}(s_),d_=function(t){function e(e,n,r){var i=this;return(i=t.call(this)||this).type=e,i.Yc=n,i.Xc=r,i}return Object(He.c)(e,t),e.prototype._apply=function(t){var e=p_(t,this.type,this.Yc,this.Xc);return new ag(t.firestore,t.converter,function(t,e){return new ll(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,e)}(t._query,e))},e}(s_);function p_(t,e,n,r){if(n[0]=Object(Ze.o)(n[0]),n[0]instanceof Xg)return function(t,e,n,r,i){if(!r)throw new qa(Va.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+n+"().");for(var o=[],s=0,a=_l(t);s<a.length;s++){var c=a[s];if(c.field.isKeyField())o.push(Dc(e,r.key));else{var l=r.data.field(c.field);if(vc(l))throw new qa(Va.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+c.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===l){var u=c.field.canonicalString();throw new qa(Va.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}o.push(l)}}return new rl(o,i)}(t._query,t.firestore._databaseId,e,n[0]._document,r);var i=Mg(t.firestore);return function(t,e,n,r,i,o){var s=t.explicitOrderBy;if(i.length>s.length)throw new qa(Va.INVALID_ARGUMENT,"Too many arguments provided to "+r+"(). The number of arguments must be less than or equal to the number of orderBy() clauses");for(var a=[],c=0;c<i.length;c++){var l=i[c];if(s[c].field.isKeyField()){if("string"!=typeof l)throw new qa(Va.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+r+"(), but got a "+typeof l);if(!gl(t)&&-1!==l.indexOf("/"))throw new qa(Va.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+r+"() must be a plain document ID, but '"+l+"' contains a slash.");var u=t.path.child(uc.fromString(l));if(!Ec.isDocumentKey(u))throw new qa(Va.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+r+"() must result in a valid document path, but '"+u+"' is not because it contains an odd number of segments.");var h=new Ec(u);a.push(Dc(e,h))}else{var d=Bg(n,r,l);a.push(d)}}return new rl(a,o)}(t._query,t.firestore._databaseId,i,e,n,r)}function f_(t,e,n){if("string"==typeof(n=Object(Ze.o)(n))){if(""===n)throw new qa(Va.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!gl(e)&&-1!==n.indexOf("/"))throw new qa(Va.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+n+"' contains a '/' character.");var r=e.path.child(uc.fromString(n));if(!Ec.isDocumentKey(r))throw new qa(Va.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+r+"' is not because it has an odd number of segments ("+r.length+").");return Dc(t,new Ec(r))}if(n instanceof sg)return Dc(t,n._key);throw new qa(Va.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+eg(n)+".")}function m_(t,e){if(!Array.isArray(t)||0===t.length)throw new qa(Va.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new qa(Va.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.")}function g_(t,e,n){if(!n.isEqual(e))throw new qa(Va.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, !=, not-in, >, or >=) on field '"+e.toString()+"' and so you must also use '"+e.toString()+"' as your first argument to orderBy(), but your first orderBy() is on field '"+n.toString()+"' instead.")}var __=function(){function t(){}return t.prototype.convertValue=function(t,e){switch(void 0===e&&(e="none"),Sc(t)){case 0:return null;case 1:return t.booleanValue;case 2:return _c(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(yc(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Xa()}},t.prototype.convertObject=function(t,e){var n=this,r={};return ac(t.fields,function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertGeoPoint=function(t){return new Tg(_c(t.latitude),_c(t.longitude))},t.prototype.convertArray=function(t,e){var n=this;return(t.values||[]).map(function(t){return n.convertValue(t,e)})},t.prototype.convertServerTimestamp=function(t,e){switch(e){case"previous":var n=bc(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(xc(t));default:return null}},t.prototype.convertTimestamp=function(t){var e=gc(t);return new ic(e.seconds,e.nanos)},t.prototype.convertDocumentKey=function(t,e){var n=uc.fromString(t);Ya(hh(n));var r=new Vm(n.get(1),n.get(3)),i=new Ec(n.popFirst(5));return r.isEqual(e)||Ha("Document "+i+" contains a document reference within a different database ("+r.projectId+"/"+r.database+") which is not supported. It will be treated as a reference in the current database ("+e.projectId+"/"+e.database+") instead."),i},t}();function y_(t,e,n){return t?n&&(n.merge||n.mergeFields)?t.toFirestore(e,n):t.toFirestore(e):e}var v_=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(He.c)(e,t),e.prototype.convertBytes=function(t){return new xg(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new sg(this.firestore,null,e)},e}(__),b_=function(){function t(t,e){this._firestore=t,this._commitHandler=e,this._mutations=[],this._committed=!1,this._dataReader=Mg(t)}return t.prototype.set=function(t,e,n){this._verifyNotCommitted();var r=x_(t,this._firestore),i=y_(r.converter,e,n),o=Og(this._dataReader,"WriteBatch.set",r._key,i,null!==r.converter,n);return this._mutations.push(o.toMutation(r._key,ql.none())),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._verifyNotCommitted();var o,s=x_(t,this._firestore);return o="string"==typeof(e=Object(Ze.o)(e))||e instanceof bg?Fg(this._dataReader,"WriteBatch.update",s._key,e,n,r):zg(this._dataReader,"WriteBatch.update",s._key,e),this._mutations.push(o.toMutation(s._key,ql.exists(!0))),this},t.prototype.delete=function(t){this._verifyNotCommitted();var e=x_(t,this._firestore);return this._mutations=this._mutations.concat(new iu(e._key,ql.none())),this},t.prototype.commit=function(){return this._verifyNotCommitted(),this._committed=!0,this._mutations.length>0?this._commitHandler(this._mutations):Promise.resolve()},t.prototype._verifyNotCommitted=function(){if(this._committed)throw new qa(Va.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}();function x_(t,e){if((t=Object(Ze.o)(t)).firestore!==e)throw new qa(Va.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return t}var w_=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(He.c)(e,t),e.prototype.convertBytes=function(t){return new xg(t)},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return new sg(this.firestore,null,e)},e}(__);function T_(t,e,n){t=ng(t,sg);var r=ng(t.firestore,mg),i=y_(t.converter,e,n);return S_(r,[Og(Mg(r),"setDoc",t._key,i,null!==t.converter,n).toMutation(t._key,ql.none())])}function C_(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];t=ng(t,sg);var o=ng(t.firestore,mg),s=Mg(o);return S_(o,[("string"==typeof(e=Object(Ze.o)(e))||e instanceof bg?Fg(s,"updateDoc",t._key,e,n,r):zg(s,"updateDoc",t._key,e)).toMutation(t._key,ql.exists(!0))])}function E_(t){for(var e,n,r,i=[],o=1;o<arguments.length;o++)i[o-1]=arguments[o];t=Object(Ze.o)(t);var s={includeMetadataChanges:!1},a=0;"object"!=typeof i[a]||fg(i[a])||(s=i[a],a++);var c,l,u,h={includeMetadataChanges:s.includeMetadataChanges};if(fg(i[a])){var d=i[a];i[a]=null===(e=d.next)||void 0===e?void 0:e.bind(d),i[a+1]=null===(n=d.error)||void 0===n?void 0:n.bind(d),i[a+2]=null===(r=d.complete)||void 0===r?void 0:r.bind(d)}if(t instanceof sg)l=ng(t.firestore,mg),u=hl(t._key.path),c={next:function(e){i[a]&&i[a](I_(l,t,e))},error:i[a+1],complete:i[a+2]};else{var p=ng(t,ag);l=ng(p.firestore,mg),u=p._query;var f=new w_(l);c={next:function(t){i[a]&&i[a](new n_(l,f,p,t))},error:i[a+1],complete:i[a+2]},o_(t._query)}return function(t,e,n,r){var i=this,o=new Sm(r),s=new Lf(e,o,n);return t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(i,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return e=Of,[4,zm(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})}),function(){o.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(i,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return e=Pf,[4,zm(t)];case 1:return[2,e.apply(void 0,[n.sent(),s])]}})})})}}(gg(l),u,h,c)}function S_(t,e){return function(t,e){var n=this,r=new Nh;return t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(n,void 0,void 0,function(){var n;return Object(He.d)(this,function(i){switch(i.label){case 0:return n=Zf,[4,jm(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(gg(t),e)}function I_(t,e,n){var r=n.docs.get(e._key),i=new w_(t);return new t_(t,i,e._key,r,new Jg(n.hasPendingWrites,n.fromCache),e.converter)}var k_=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this)._firestore=e,r}return Object(He.c)(e,t),e.prototype.get=function(e){var n=this,r=x_(e,this._firestore),i=new w_(this._firestore);return t.prototype.get.call(this,e).then(function(t){return new t_(n._firestore,i,r._key,t._document,new Jg(!1,!1),r.converter)})},e}(function(){function t(t,e){this._firestore=t,this._transaction=e,this._dataReader=Mg(t)}return t.prototype.get=function(t){var e=this,n=x_(t,this._firestore),r=new v_(this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Xa();var i=t[0];if(i.isFoundDocument())return new Xg(e._firestore,r,i.key,i,n.converter);if(i.isNoDocument())return new Xg(e._firestore,r,n._key,null,n.converter);throw Xa()})},t.prototype.set=function(t,e,n){var r=x_(t,this._firestore),i=y_(r.converter,e,n),o=Og(this._dataReader,"Transaction.set",r._key,i,null!==r.converter,n);return this._transaction.set(r._key,o),this},t.prototype.update=function(t,e,n){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];var o,s=x_(t,this._firestore);return o="string"==typeof(e=Object(Ze.o)(e))||e instanceof bg?Fg(this._dataReader,"Transaction.update",s._key,e,n,r):zg(this._dataReader,"Transaction.update",s._key,e),this._transaction.update(s._key,o),this},t.prototype.delete=function(t){var e=x_(t,this._firestore);return this._transaction.delete(e._key),this},t}());function A_(){if("undefined"==typeof Uint8Array)throw new qa(Va.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function M_(){if("undefined"==typeof atob)throw new qa(Va.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var O_=function(){function t(t){this._delegate=t}return t.fromBase64String=function(e){return M_(),new t(xg.fromBase64String(e))},t.fromUint8Array=function(e){return A_(),new t(xg.fromUint8Array(e))},t.prototype.toBase64=function(){return M_(),this._delegate.toBase64()},t.prototype.toUint8Array=function(){return A_(),this._delegate.toUint8Array()},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t}(),P_=function(){function t(){}return t.prototype.enableIndexedDbPersistence=function(t,e){return function(t,e){vg(t=ng(t,mg));var n=gg(t),r=t._freezeSettings(),i=new Em;return yg(n,i,new Tm(i,r.cacheSizeBytes,null==e?void 0:e.forceOwnership))}(t._delegate,{forceOwnership:e})},t.prototype.enableMultiTabIndexedDbPersistence=function(t){return function(t){vg(t=ng(t,mg));var e=gg(t),n=t._freezeSettings(),r=new Em;return yg(e,r,new Cm(r,n.cacheSizeBytes))}(t._delegate)},t.prototype.clearIndexedDbPersistence=function(t){return function(t){var e=this;if(t._initialized&&!t._terminated)throw new qa(Va.FAILED_PRECONDITION,"Persistence can only be cleared before a Firestore instance is initialized or after it is terminated.");var n=new Nh;return t._queue.enqueueAndForgetEvenWhileRestricted(function(){return Object(He.b)(e,void 0,void 0,function(){var e;return Object(He.d)(this,function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),[4,function(t){return Object(He.b)(this,void 0,void 0,function(){return Object(He.d)(this,function(e){switch(e.label){case 0:return zh.yt()?[4,zh.delete(t+"main")]:[2,Promise.resolve()];case 1:return e.sent(),[2]}})})}(Kd(t._databaseId,t._persistenceKey))];case 1:return r.sent(),n.resolve(),[3,3];case 2:return e=r.sent(),n.reject(e),[3,3];case 3:return[2]}})})}),n.promise}(t._delegate)},t}(),D_=function(){function t(t,e,n){var r=this;this._delegate=e,this.Zc=n,this.INTERNAL={delete:function(){return r.terminate()}},t instanceof Vm||(this.tu=t)}return Object.defineProperty(t.prototype,"_databaseId",{get:function(){return this._delegate._databaseId},enumerable:!1,configurable:!0}),t.prototype.settings=function(t){var e=this._delegate._getSettings();t.merge||e.host===t.host||Za("You are overriding the original host. If you did not intend to override your settings, use {merge: true}."),t.merge&&delete(t=Object.assign(Object.assign({},e),t)).merge,this._delegate._setSettings(t)},t.prototype.useEmulator=function(t,e,n){void 0===n&&(n={}),function(t,e,n,r){var i;void 0===r&&(r={});var o=(t=ng(t,og))._getSettings();if("firestore.googleapis.com"!==o.host&&o.host!==e&&Za("Host has been set in both settings() and useEmulator(), emulator host will be used"),t._setSettings(Object.assign(Object.assign({},o),{host:e+":"+n,ssl:!1})),r.mockUserToken){var s,a;if("string"==typeof r.mockUserToken)s=r.mockUserToken,a=Sp.MOCK_USER;else{s=Object(Ze.j)(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);var c=r.mockUserToken.sub||r.mockUserToken.user_id;if(!c)throw new qa(Va.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");a=new Sp(c)}t._credentials=new Wm(new Gm(s,a))}}(this._delegate,t,e,n)},t.prototype.enableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(He.b)(e,void 0,void 0,function(){var e,n;return Object(He.d)(this,function(r){switch(r.label){case 0:return[4,Rm(t)];case 1:return e=r.sent(),[4,Lm(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!0),function(t){var e=Qa(t);return e.Or.delete(0),Qp(e)}(n))]}})})})}(gg(ng(this._delegate,mg)))},t.prototype.disableNetwork=function(){return function(t){var e=this;return t.asyncQueue.enqueue(function(){return Object(He.b)(e,void 0,void 0,function(){var e,n;return Object(He.d)(this,function(r){switch(r.label){case 0:return[4,Rm(t)];case 1:return e=r.sent(),[4,Lm(t)];case 2:return n=r.sent(),[2,(e.setNetworkEnabled(!1),function(t){return Object(He.b)(this,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return(e=Qa(t)).Or.add(0),[4,Jp(e)];case 1:return n.sent(),e.Br.set("Offline"),[2]}})})}(n))]}})})})}(gg(ng(this._delegate,mg)))},t.prototype.enablePersistence=function(t){var e=!1,n=!1;return t&&Qm("synchronizeTabs",e=!!t.synchronizeTabs,"experimentalForceOwningTab",n=!!t.experimentalForceOwningTab),e?this.Zc.enableMultiTabIndexedDbPersistence(this):this.Zc.enableIndexedDbPersistence(this,n)},t.prototype.clearPersistence=function(){return this.Zc.clearIndexedDbPersistence(this)},t.prototype.terminate=function(){return this.tu&&(this.tu._removeServiceInstance("firestore"),this.tu._removeServiceInstance("firestore-exp")),this._delegate._delete()},t.prototype.waitForPendingWrites=function(){return function(t){var e=this,n=new Nh;return t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(e,void 0,void 0,function(){var e;return Object(He.d)(this,function(r){switch(r.label){case 0:return e=tm,[4,jm(t)];case 1:return[2,e.apply(void 0,[r.sent(),n])]}})})}),n.promise}(gg(ng(this._delegate,mg)))},t.prototype.onSnapshotsInSync=function(t){return function(t,e){return function(t,e){var n=this,r=new Sm(e);return t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(n,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Qa(t).Gr.add(e),e.next()},[4,zm(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})}),function(){r.Wo(),t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(n,void 0,void 0,function(){var e;return Object(He.d)(this,function(n){switch(n.label){case 0:return e=function(t,e){Qa(t).Gr.delete(e)},[4,zm(t)];case 1:return[2,e.apply(void 0,[n.sent(),r])]}})})})}}(gg(t=ng(t,mg)),fg(e)?e:{next:e})}(this._delegate,t)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this.tu)throw new qa(Va.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this.tu},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new H_(this,lg(this._delegate,t))}catch(t){throw F_(t,"collection()","Firestore.collection()")}},t.prototype.doc=function(t){try{return new z_(this,ug(this._delegate,t))}catch(t){throw F_(t,"doc()","Firestore.doc()")}},t.prototype.collectionGroup=function(t){try{return new G_(this,function(t,e){if(t=ng(t,og),Xm("collectionGroup","collection id",e),e.indexOf("/")>=0)throw new qa(Va.INVALID_ARGUMENT,"Invalid collection ID '"+e+"' passed to function collectionGroup(). Collection IDs must not contain '/'.");return new ag(t,null,function(t){return new ll(uc.emptyPath(),t)}(e))}(this._delegate,t))}catch(t){throw F_(t,"collectionGroup()","Firestore.collectionGroup()")}},t.prototype.runTransaction=function(t){var e=this;return function(t,e){return function(t,e){var n=this,r=new Nh;return t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(n,void 0,void 0,function(){var n;return Object(He.d)(this,function(i){switch(i.label){case 0:return[4,function(t){return Dm(t).then(function(t){return t.datastore})}(t)];case 1:return n=i.sent(),new km(t.asyncQueue,n,e,r).run(),[2]}})})}),r.promise}(gg(t),function(n){return e(new k_(t,n))})}(this._delegate,function(n){return t(new N_(e,n))})},t.prototype.batch=function(){var t=this;return gg(this._delegate),new L_(new b_(this._delegate,function(e){return S_(t._delegate,e)}))},t.prototype.loadBundle=function(t){throw new qa(Va.FAILED_PRECONDITION,'"loadBundle()" does not exist, have you imported "firebase/firestore/bundle"?')},t.prototype.namedQuery=function(t){throw new qa(Va.FAILED_PRECONDITION,'"namedQuery()" does not exist, have you imported "firebase/firestore/bundle"?')},t}(),R_=function(t){function e(e){var n=this;return(n=t.call(this)||this).firestore=e,n}return Object(He.c)(e,t),e.prototype.convertBytes=function(t){return new O_(new xg(t))},e.prototype.convertReference=function(t){var e=this.convertDocumentKey(t,this.firestore._databaseId);return z_.eu(e,this.firestore,null)},e}(__),N_=function(){function t(t,e){this._firestore=t,this._delegate=e,this._userDataWriter=new R_(t)}return t.prototype.get=function(t){var e=this,n=Z_(t);return this._delegate.get(n).then(function(t){return new V_(e._firestore,new t_(e._firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,n.converter))})},t.prototype.set=function(t,e,n){var r=Z_(t);return n?(Ym("Transaction.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Z_(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(He.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Z_(t);return this._delegate.delete(e),this},t}(),L_=function(){function t(t){this._delegate=t}return t.prototype.set=function(t,e,n){var r=Z_(t);return n?(Ym("WriteBatch.set",n),this._delegate.set(r,e,n)):this._delegate.set(r,e),this},t.prototype.update=function(t,e,n){for(var r,i=[],o=3;o<arguments.length;o++)i[o-3]=arguments[o];var s=Z_(t);return 2===arguments.length?this._delegate.update(s,e):(r=this._delegate).update.apply(r,Object(He.f)([s,e,n],i)),this},t.prototype.delete=function(t){var e=Z_(t);return this._delegate.delete(e),this},t.prototype.commit=function(){return this._delegate.commit()},t}(),j_=function(){function t(t,e,n){this._firestore=t,this._userDataWriter=e,this._delegate=n}return t.prototype.fromFirestore=function(t,e){var n=new e_(this._firestore._delegate,this._userDataWriter,t._key,t._document,t.metadata,null);return this._delegate.fromFirestore(new q_(this._firestore,n),null!=e?e:{})},t.prototype.toFirestore=function(t,e){return e?this._delegate.toFirestore(t,e):this._delegate.toFirestore(t)},t.nu=function(e,n){var r=t.su,i=r.get(e);i||(i=new WeakMap,r.set(e,i));var o=i.get(n);return o||(o=new t(e,new R_(e),n),i.set(n,o)),o},t}();j_.su=new WeakMap;var z_=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new R_(t)}return t.iu=function(e,n,r){if(e.length%2!=0)throw new qa(Va.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(n,new sg(n._delegate,r,new Ec(e)))},t.eu=function(e,n,r){return new t(n,new sg(n._delegate,r,e))},Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new H_(this.firestore,this._delegate.parent)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),t.prototype.collection=function(t){try{return new H_(this.firestore,lg(this._delegate,t))}catch(t){throw F_(t,"collection()","DocumentReference.collection()")}},t.prototype.isEqual=function(t){return(t=Object(Ze.o)(t))instanceof sg&&hg(this._delegate,t)},t.prototype.set=function(t,e){e=Ym("DocumentReference.set",e);try{return e?T_(this._delegate,t,e):T_(this._delegate,t)}catch(t){throw F_(t,"setDoc()","DocumentReference.set()")}},t.prototype.update=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];try{return 1===arguments.length?C_(this._delegate,t):C_.apply(void 0,Object(He.f)([this._delegate,t,e],n))}catch(t){throw F_(t,"updateDoc()","DocumentReference.update()")}},t.prototype.delete=function(){return S_(ng((t=this._delegate).firestore,mg),[new iu(t._key,ql.none())]);var t},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=B_(e),i=U_(e,function(e){return new V_(t.firestore,new t_(t.firestore._delegate,t._userDataWriter,e._key,e._document,e.metadata,t._delegate.converter))});return E_(this._delegate,r,i)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=ng(t,sg);var e=ng(t.firestore,mg),n=gg(e),r=new w_(e);return function(t,e){var n=this,r=new Nh;return t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(n,void 0,void 0,function(){var n;return Object(He.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i;return Object(He.d)(this,function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,function(t,e){var n=Qa(t);return n.persistence.runTransaction("read document","readonly",function(t){return n.Mn.mn(t,e)})}(t,e)];case 1:return(i=o.sent()).isFoundDocument()?n.resolve(i):i.isNoDocument()?n.resolve(null):n.reject(new qa(Va.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")),[3,3];case 2:return r=o.sent(),i=Ef(r,"Failed to get document '"+e+" from cache"),n.reject(i),[3,3];case 3:return[2]}})})},[4,Nm(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._key).then(function(n){return new t_(e,r,t._key,n,new Jg(null!==n&&n.hasLocalMutations,!0),t.converter)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=ng(t,sg);var e=ng(t.firestore,mg);return Fm(gg(e),t._key,{source:"server"}).then(function(n){return I_(e,t,n)})}(this._delegate):function(t){t=ng(t,sg);var e=ng(t.firestore,mg);return Fm(gg(e),t._key).then(function(n){return I_(e,t,n)})}(this._delegate)).then(function(t){return new V_(e.firestore,new t_(e.firestore._delegate,e._userDataWriter,t._key,t._document,t.metadata,e._delegate.converter))})},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?j_.nu(this.firestore,e):null))},t}();function F_(t,e,n){return t.message=t.message.replace(e,n),t}function B_(t){for(var e=0,n=t;e<n.length;e++){var r=n[e];if("object"==typeof r&&!fg(r))return r}return{}}function U_(t,e){var n,r,i;return{next:function(t){i.next&&i.next(e(t))},error:null===(n=(i=fg(t[0])?t[0]:fg(t[1])?t[1]:"function"==typeof t[0]?{next:t[0],error:t[1],complete:t[2]}:{next:t[1],error:t[2],complete:t[3]}).error)||void 0===n?void 0:n.bind(i),complete:null===(r=i.complete)||void 0===r?void 0:r.bind(i)}}var V_=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"ref",{get:function(){return new z_(this._firestore,this._delegate.ref)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return this._delegate.exists()},enumerable:!1,configurable:!0}),t.prototype.data=function(t){return this._delegate.data(t)},t.prototype.get=function(t,e){return this._delegate.get(t,e)},t.prototype.isEqual=function(t){return i_(this._delegate,t._delegate)},t}(),q_=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Object(He.c)(e,t),e.prototype.data=function(t){return this._delegate.data(t)},e}(V_),G_=function(){function t(t,e){this.firestore=t,this._delegate=e,this._userDataWriter=new R_(t)}return t.prototype.where=function(e,n,r){try{return new t(this.firestore,a_(this._delegate,function(t,e,n){var r=e,i=Qg("where",t);return new c_(i,r,n)}(e,n,r)))}catch(e){throw F_(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.orderBy=function(e,n){try{return new t(this.firestore,a_(this._delegate,function(t,e){void 0===e&&(e="asc");var n=e,r=Qg("orderBy",t);return new l_(r,n)}(e,n)))}catch(e){throw F_(e,/(orderBy|where)\(\)/,"Query.$1()")}},t.prototype.limit=function(e){try{return new t(this.firestore,a_(this._delegate,function(t){return rg("limit",t),new u_("limit",t,"F")}(e)))}catch(e){throw F_(e,"limit()","Query.limit()")}},t.prototype.limitToLast=function(e){try{return new t(this.firestore,a_(this._delegate,function(t){return rg("limitToLast",t),new u_("limitToLast",t,"L")}(e)))}catch(e){throw F_(e,"limitToLast()","Query.limitToLast()")}},t.prototype.startAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,a_(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new h_("startAt",t,!0)}).apply(void 0,e)))}catch(e){throw F_(e,"startAt()","Query.startAt()")}},t.prototype.startAfter=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,a_(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new h_("startAfter",t,!1)}).apply(void 0,e)))}catch(e){throw F_(e,"startAfter()","Query.startAfter()")}},t.prototype.endBefore=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,a_(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new d_("endBefore",t,!0)}).apply(void 0,e)))}catch(e){throw F_(e,"endBefore()","Query.endBefore()")}},t.prototype.endAt=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];try{return new t(this.firestore,a_(this._delegate,(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new d_("endAt",t,!1)}).apply(void 0,e)))}catch(e){throw F_(e,"endAt()","Query.endAt()")}},t.prototype.isEqual=function(t){return dg(this._delegate,t._delegate)},t.prototype.get=function(t){var e=this;return("cache"===(null==t?void 0:t.source)?function(t){t=ng(t,ag);var e=ng(t.firestore,mg),n=gg(e),r=new w_(e);return function(t,e){var n=this,r=new Nh;return t.asyncQueue.enqueueAndForget(function(){return Object(He.b)(n,void 0,void 0,function(){var n;return Object(He.d)(this,function(i){switch(i.label){case 0:return n=function(t,e,n){return Object(He.b)(this,void 0,void 0,function(){var r,i,o,s,a;return Object(He.d)(this,function(c){switch(c.label){case 0:return c.trys.push([0,2,,3]),[4,up(t,e,!0)];case 1:return a=c.sent(),r=new Uf(e,a.Bn),i=r._o(a.documents),o=r.applyChanges(i,!1),n.resolve(o.snapshot),[3,3];case 2:return s=c.sent(),a=Ef(s,"Failed to execute query '"+e+" against cache"),n.reject(a),[3,3];case 3:return[2]}})})},[4,Nm(t)];case 1:return[2,n.apply(void 0,[i.sent(),e,r])]}})})}),r.promise}(n,t._query).then(function(n){return new n_(e,r,t,n)})}(this._delegate):"server"===(null==t?void 0:t.source)?function(t){t=ng(t,ag);var e=ng(t.firestore,mg),n=gg(e),r=new w_(e);return Bm(n,t._query,{source:"server"}).then(function(n){return new n_(e,r,t,n)})}(this._delegate):function(t){t=ng(t,ag);var e=ng(t.firestore,mg),n=gg(e),r=new w_(e);return o_(t._query),Bm(n,t._query).then(function(n){return new n_(e,r,t,n)})}(this._delegate)).then(function(t){return new W_(e.firestore,new n_(e.firestore._delegate,e._userDataWriter,e._delegate,t._snapshot))})},t.prototype.onSnapshot=function(){for(var t=this,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=B_(e),i=U_(e,function(e){return new W_(t.firestore,new n_(t.firestore._delegate,t._userDataWriter,t._delegate,e._snapshot))});return E_(this._delegate,r,i)},t.prototype.withConverter=function(e){return new t(this.firestore,this._delegate.withConverter(e?j_.nu(this.firestore,e):null))},t}(),$_=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"type",{get:function(){return this._delegate.type},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"doc",{get:function(){return new q_(this._firestore,this._delegate.doc)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"oldIndex",{get:function(){return this._delegate.oldIndex},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"newIndex",{get:function(){return this._delegate.newIndex},enumerable:!1,configurable:!0}),t}(),W_=function(){function t(t,e){this._firestore=t,this._delegate=e}return Object.defineProperty(t.prototype,"query",{get:function(){return new G_(this._firestore,this._delegate.query)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return this._delegate.metadata},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._delegate.size},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._delegate.empty},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"docs",{get:function(){var t=this;return this._delegate.docs.map(function(e){return new q_(t._firestore,e)})},enumerable:!1,configurable:!0}),t.prototype.docChanges=function(t){var e=this;return this._delegate.docChanges(t).map(function(t){return new $_(e._firestore,t)})},t.prototype.forEach=function(t,e){var n=this;this._delegate.forEach(function(r){t.call(e,new q_(n._firestore,r))})},t.prototype.isEqual=function(t){return i_(this._delegate,t._delegate)},t}(),H_=function(t){function e(e,n){var r=this;return(r=t.call(this,e,n)||this).firestore=e,r._delegate=n,r}return Object(He.c)(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._delegate.id},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._delegate.path},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._delegate.parent;return t?new z_(this.firestore,t):null},enumerable:!1,configurable:!0}),e.prototype.doc=function(t){try{return new z_(this.firestore,void 0===t?ug(this._delegate):ug(this._delegate,t))}catch(t){throw F_(t,"doc()","CollectionReference.doc()")}},e.prototype.add=function(t){var e=this;return function(t,e){var n=ng(t.firestore,mg),r=ug(t),i=y_(t.converter,e);return S_(n,[Og(Mg(t.firestore),"addDoc",r._key,i,null!==t.converter,{}).toMutation(r._key,ql.exists(!1))]).then(function(){return r})}(this._delegate,t).then(function(t){return new z_(e.firestore,t)})},e.prototype.isEqual=function(t){return hg(this._delegate,t._delegate)},e.prototype.withConverter=function(t){return new e(this.firestore,this._delegate.withConverter(t?j_.nu(this.firestore,t):null))},e}(G_);function Z_(t){return ng(t,sg)}var K_,X_=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._delegate=new(bg.bind.apply(bg,Object(He.f)([void 0],t)))}return t.documentId=function(){return new t(dc.keyField().canonicalString())},t.prototype.isEqual=function(t){return(t=Object(Ze.o)(t))instanceof bg&&this._delegate._internalPath.isEqual(t._internalPath)},t}(),Y_=function(){function t(t){this._delegate=t}return t.serverTimestamp=function(){var e=new Rg("serverTimestamp");return e._methodName="FieldValue.serverTimestamp",new t(e)},t.delete=function(){var e=new Pg("deleteField");return e._methodName="FieldValue.delete",new t(e)},t.arrayUnion=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Ng("arrayUnion",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayUnion",new t(r)},t.arrayRemove=function(){for(var e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];var r=(function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return new Lg("arrayRemove",t)}).apply(void 0,e);return r._methodName="FieldValue.arrayRemove",new t(r)},t.increment=function(e){var n=function(t){return new jg("increment",t)}(e);return n._methodName="FieldValue.increment",new t(n)},t.prototype.isEqual=function(t){return this._delegate.isEqual(t._delegate)},t}(),Q_={Firestore:D_,GeoPoint:Tg,Timestamp:ic,Blob:O_,Transaction:N_,WriteBatch:L_,DocumentReference:z_,DocumentSnapshot:V_,Query:G_,QueryDocumentSnapshot:q_,QuerySnapshot:W_,CollectionReference:H_,FieldPath:X_,FieldValue:Y_,setLogLevel:function(t){Ga.setLogLevel(t)},CACHE_SIZE_UNLIMITED:-1};function J_(t,e){return function(t,e=_t.b){return new yt.a(n=>{let r;return null!=e?e.schedule(()=>{r=t.onSnapshot({includeMetadataChanges:!0},n)}):r=t.onSnapshot({includeMetadataChanges:!0},n),()=>{null!=r&&r()}})}(t,e)}function ty(t,e){return J_(t,e).pipe(Object(xt.a)(t=>({payload:t,type:"query"})))}function ey(t,e){return ty(t,e).pipe(kr(void 0),Ar(),Object(xt.a)(([t,e])=>{const n=e.payload.docChanges(),r=n.map(t=>({type:t.type,payload:t}));return t&&JSON.stringify(t.payload.metadata)!==JSON.stringify(e.payload.metadata)&&e.payload.docs.forEach((e,i)=>{const o=n.find(t=>t.doc.ref.isEqual(e.ref)),s=null==t?void 0:t.payload.docs.find(t=>t.ref.isEqual(e.ref));o&&JSON.stringify(o.doc.metadata)===JSON.stringify(e.metadata)||!o&&s&&JSON.stringify(s.metadata)===JSON.stringify(e.metadata)||r.push({type:"modified",payload:{oldIndex:i,newIndex:i,type:"modified",doc:e}})}),r}))}function ny(t,e,n){return ey(t,n).pipe(At((t,n)=>function(t,e,n){return e.forEach(e=>{n.indexOf(e.type)>-1&&(t=function(t,e){switch(e.type){case"added":if(!t[e.newIndex]||!t[e.newIndex].doc.ref.isEqual(e.doc.ref))return ry(t,e.newIndex,0,e);break;case"modified":if(null==t[e.oldIndex]||t[e.oldIndex].doc.ref.isEqual(e.doc.ref)){if(e.oldIndex!==e.newIndex){const n=t.slice();return n.splice(e.oldIndex,1),n.splice(e.newIndex,0,e),n}return ry(t,e.newIndex,1,e)}break;case"removed":if(t[e.oldIndex]&&t[e.oldIndex].doc.ref.isEqual(e.doc.ref))return ry(t,e.oldIndex,1)}return t}(t,e))}),t}(t,n.map(t=>t.payload),e),[]),Pt(),Object(xt.a)(t=>t.map(t=>({type:t.type,payload:t}))))}function ry(t,e,n,...r){const i=t.slice();return i.splice(e,n,...r),i}function iy(t){return t&&0!==t.length||(t=["added","removed","modified"]),t}(function(t,e){t.INTERNAL.registerComponent(new Ke.a("firestore",function(t){return function(t,e){return new D_(t,new mg(t,e),new P_)}(t.getProvider("app").getImmediate(),t.getProvider("auth-internal"))},"PUBLIC").setServiceProps(Object.assign({},Q_)))})(K_=We.a),K_.registerVersion("@firebase/firestore","2.4.1");class oy{constructor(t,e,n){this.ref=t,this.query=e,this.afs=n}stateChanges(t){let e=ey(this.query,this.afs.schedulers.outsideAngular);return t&&t.length>0&&(e=e.pipe(Object(xt.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)))),e.pipe(kr(void 0),Ar(),Jt(([t,e])=>e.length>0||!t),Object(xt.a)(([t,e])=>e),this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(At((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=iy(t);return ny(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return ty(this.query,this.afs.schedulers.outsideAngular).pipe(Object(xt.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(Tt.a)(this.query.get(t)).pipe(Object(Gt.b)(this.afs.schedulers.insideAngular))}add(t){return this.ref.add(t)}doc(t){return new sy(this.ref.doc(t),this.afs)}}class sy{constructor(t,e){this.ref=t,this.afs=e}set(t,e){return this.ref.set(t,e)}update(t){return this.ref.update(t)}delete(){return this.ref.delete()}collection(t,e){const n=this.ref.collection(t),{ref:r,query:i}=dy(n,e);return new oy(r,i,this.afs)}snapshotChanges(){return J_(this.ref,this.afs.schedulers.outsideAngular).pipe(kr(void 0),Ar(),Object(xt.a)(([t,e])=>e.exists?(null==t?void 0:t.exists)?{payload:e,type:"modified"}:{payload:e,type:"added"}:{payload:e,type:"removed"})).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return this.snapshotChanges().pipe(Object(xt.a)(({payload:e})=>t.idField?Object.assign(Object.assign({},e.data()),{[t.idField]:e.id}):e.data()))}get(t){return Object(Tt.a)(this.ref.get(t)).pipe(Object(Gt.b)(this.afs.schedulers.insideAngular))}}class ay{constructor(t,e){this.query=t,this.afs=e}stateChanges(t){return t&&0!==t.length?ey(this.query,this.afs.schedulers.outsideAngular).pipe(Object(xt.a)(e=>e.filter(e=>t.indexOf(e.type)>-1)),Jt(t=>t.length>0),this.afs.keepUnstableUntilFirst):ey(this.query,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}auditTrail(t){return this.stateChanges(t).pipe(At((t,e)=>[...t,...e],[]))}snapshotChanges(t){const e=iy(t);return ny(this.query,e,this.afs.schedulers.outsideAngular).pipe(this.afs.keepUnstableUntilFirst)}valueChanges(t={}){return ty(this.query,this.afs.schedulers.outsideAngular).pipe(Object(xt.a)(e=>e.payload.docs.map(e=>t.idField?Object.assign({[t.idField]:e.id},e.data()):e.data())),this.afs.keepUnstableUntilFirst)}get(t){return Object(Tt.a)(this.query.get(t)).pipe(Object(Gt.b)(this.afs.schedulers.insideAngular))}}const cy=new r.r("angularfire2.enableFirestorePersistence"),ly=new r.r("angularfire2.firestore.persistenceSettings"),uy=new r.r("angularfire2.firestore.settings"),hy=new r.r("angularfire2.firestore.use-emulator");function dy(t,e=(t=>t)){return{query:e(t),ref:t}}let py=(()=>{class t{constructor(t,e,n,r,i,o,s,a,c){this.schedulers=new gt.d(o),this.keepUnstableUntilFirst=Object(gt.h)(this.schedulers);const l=Object(gt.g)(t,o,e);!Se.a.auth&&c&&Object(gt.j)();const u=a;[this.firestore,this.persistenceEnabled$]=Object(gt.f)(`${l.name}.firestore`,"AngularFirestore",l,()=>{const t=o.runOutsideAngular(()=>l.firestore());if(r&&t.settings(r),u&&t.useEmulator(...u),n&&!j(i)){const e=()=>{try{return Object(Tt.a)(t.enablePersistence(s||void 0).then(()=>!0,()=>!1))}catch(K_){return"undefined"!=typeof console&&console.warn(K_),Object(vt.a)(!1)}};return[t,o.runOutsideAngular(e)]}return[t,Object(vt.a)(!1)]},[r,u,n])}collection(t,e){let n;n="string"==typeof t?this.firestore.collection(t):t;const{ref:r,query:i}=dy(n,e),o=this.schedulers.ngZone.run(()=>r);return new oy(o,i,this)}collectionGroup(t,e){const n=e||(t=>t),r=this.firestore.collectionGroup(t);return new ay(n(r),this)}doc(t){let e;e="string"==typeof t?this.firestore.doc(t):t;const n=this.schedulers.ngZone.run(()=>e);return new sy(n,this)}createId(){return this.firestore.collection("_").doc().id}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(gt.c),r.Rb(gt.b,8),r.Rb(cy,8),r.Rb(uy,8),r.Rb(r.C),r.Rb(r.A),r.Rb(ly,8),r.Rb(hy,8),r.Rb(ye,8))},t.\u0275prov=r.Gb({factory:function(){return new t(r.Rb(gt.c),r.Rb(gt.b,8),r.Rb(cy,8),r.Rb(uy,8),r.Rb(r.C),r.Rb(r.A),r.Rb(ly,8),r.Rb(hy,8),r.Rb(ye,8))},token:t,providedIn:"any"}),t})(),fy=(()=>{class t{static enablePersistence(e){return{ngModule:t,providers:[{provide:cy,useValue:!0},{provide:ly,useValue:e}]}}}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)},providers:[py]}),t})();const my={apiKey:"AIzaSyDyawPquR9k41-4DIY1YX2cnCZhtvlPfbo",authDomain:"go2parts-senior-3490d.firebaseapp.com",projectId:"go2parts-senior-3490d",storageBucket:"go2parts-senior-3490d.appspot.com",messagingSenderId:"225368192480",appId:"1:225368192480:web:ee2fa075afd79ef20aa785"};function gy(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(t);e&&(r=r.filter(function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable})),n.push.apply(n,r)}return n}function _y(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?gy(Object(n),!0).forEach(function(e){vy(t,e,n[e])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):gy(Object(n)).forEach(function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))})}return t}function yy(t){return(yy="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}function vy(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function by(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var n=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=n){var r,i,o=[],s=!0,a=!1;try{for(n=n.call(t);!(s=(r=n.next()).done)&&(o.push(r.value),!e||o.length!==e);s=!0);}catch(c){a=!0,i=c}finally{try{s||null==n.return||n.return()}finally{if(a)throw i}}return o}}(t,e)||wy(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xy(t){return function(t){if(Array.isArray(t))return Ty(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||wy(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wy(t,e){if(t){if("string"==typeof t)return Ty(t,e);var n=Object.prototype.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ty(t,e):void 0}}function Ty(t,e){(null==e||e>t.length)&&(e=t.length);for(var n=0,r=new Array(e);n<e;n++)r[n]=t[n];return r}var Cy=function(){},Ey={},Sy={},Iy=null,ky={mark:Cy,measure:Cy};try{"undefined"!=typeof window&&(Ey=window),"undefined"!=typeof document&&(Sy=document),"undefined"!=typeof MutationObserver&&(Iy=MutationObserver),"undefined"!=typeof performance&&(ky=performance)}catch(K_){}var Ay=(Ey.navigator||{}).userAgent,My=void 0===Ay?"":Ay,Oy=Ey,Py=Sy,Dy=Iy,Ry=ky,Ny=!!Py.documentElement&&!!Py.head&&"function"==typeof Py.addEventListener&&"function"==typeof Py.createElement,Ly=~My.indexOf("MSIE")||~My.indexOf("Trident/"),jy="svg-inline--fa",zy="data-fa-i2svg",Fy="data-fa-pseudo-element",By="data-prefix",Uy="data-icon",Vy="fontawesome-i2svg",qy=["HTML","HEAD","STYLE","SCRIPT"],Gy=function(){try{return!0}catch(K_){return!1}}(),$y={fas:"solid","fa-solid":"solid",far:"regular","fa-regular":"regular",fal:"light","fa-light":"light",fat:"thin","fa-thin":"thin",fad:"duotone","fa-duotone":"duotone",fab:"brands","fa-brands":"brands",fak:"kit","fa-kit":"kit",fa:"solid"},Wy={solid:"fas",regular:"far",light:"fal",thin:"fat",duotone:"fad",brands:"fab",kit:"fak"},Hy={fab:"fa-brands",fad:"fa-duotone",fak:"fa-kit",fal:"fa-light",far:"fa-regular",fas:"fa-solid",fat:"fa-thin"},Zy={"fa-brands":"fab","fa-duotone":"fad","fa-kit":"fak","fa-light":"fal","fa-regular":"far","fa-solid":"fas","fa-thin":"fat"},Ky=/fa[srltdbk\-\ ]/,Xy="fa-layers-text",Yy=/Font ?Awesome ?([56 ]*)(Solid|Regular|Light|Thin|Duotone|Brands|Free|Pro|Kit)?.*/i,Qy={900:"fas",400:"far",normal:"far",300:"fal",100:"fat"},Jy=[1,2,3,4,5,6,7,8,9,10],tv=Jy.concat([11,12,13,14,15,16,17,18,19,20]),ev=["class","data-prefix","data-icon","data-fa-transform","data-fa-mask"],nv="duotone-group",rv="primary",iv="secondary",ov=[].concat(xy(Object.keys(Wy)),["2xs","xs","sm","lg","xl","2xl","beat","border","fade","beat-fade","bounce","flip-both","flip-horizontal","flip-vertical","flip","fw","inverse","layers-counter","layers-text","layers","li","pull-left","pull-right","pulse","rotate-180","rotate-270","rotate-90","rotate-by","shake","spin-pulse","spin-reverse","spin","stack-1x","stack-2x","stack","ul",nv,"swap-opacity",rv,iv]).concat(Jy.map(function(t){return"".concat(t,"x")})).concat(tv.map(function(t){return"w-".concat(t)})),sv=Oy.FontAwesomeConfig||{};Py&&"function"==typeof Py.querySelector&&[["data-family-prefix","familyPrefix"],["data-style-default","styleDefault"],["data-replacement-class","replacementClass"],["data-auto-replace-svg","autoReplaceSvg"],["data-auto-add-css","autoAddCss"],["data-auto-a11y","autoA11y"],["data-search-pseudo-elements","searchPseudoElements"],["data-observe-mutations","observeMutations"],["data-mutate-approach","mutateApproach"],["data-keep-original-source","keepOriginalSource"],["data-measure-performance","measurePerformance"],["data-show-missing-icons","showMissingIcons"]].forEach(function(t){var e=by(t,2),n=e[1],r=function(t){return""===t||"false"!==t&&("true"===t||t)}(function(t){var e=Py.querySelector("script["+t+"]");if(e)return e.getAttribute(t)}(e[0]));null!=r&&(sv[n]=r)});var av=_y(_y({},{familyPrefix:"fa",styleDefault:"solid",replacementClass:jy,autoReplaceSvg:!0,autoAddCss:!0,autoA11y:!0,searchPseudoElements:!1,observeMutations:!0,mutateApproach:"async",keepOriginalSource:!0,measurePerformance:!1,showMissingIcons:!0}),sv);av.autoReplaceSvg||(av.observeMutations=!1);var cv={};Object.keys(av).forEach(function(t){Object.defineProperty(cv,t,{enumerable:!0,set:function(e){av[t]=e,lv.forEach(function(t){return t(cv)})},get:function(){return av[t]}})}),Oy.FontAwesomeConfig=cv;var lv=[],uv=16,hv={size:16,x:0,y:0,rotate:0,flipX:!1,flipY:!1};function dv(){for(var t=12,e="";t-- >0;)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[62*Math.random()|0];return e}function pv(t){for(var e=[],n=(t||[]).length>>>0;n--;)e[n]=t[n];return e}function fv(t){return t.classList?pv(t.classList):(t.getAttribute("class")||"").split(" ").filter(function(t){return t})}function mv(t){return"".concat(t).replace(/&/g,"&amp;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/</g,"&lt;").replace(/>/g,"&gt;")}function gv(t){return Object.keys(t||{}).reduce(function(e,n){return e+"".concat(n,": ").concat(t[n].trim(),";")},"")}function _v(t){return t.size!==hv.size||t.x!==hv.x||t.y!==hv.y||t.rotate!==hv.rotate||t.flipX||t.flipY}function yv(){var t="fa",e=jy,n=cv.familyPrefix,r=cv.replacementClass,i=':root, :host {\n  --fa-font-solid: normal 900 1em/1 "Font Awesome 6 Solid";\n  --fa-font-regular: normal 400 1em/1 "Font Awesome 6 Regular";\n  --fa-font-light: normal 300 1em/1 "Font Awesome 6 Light";\n  --fa-font-thin: normal 100 1em/1 "Font Awesome 6 Thin";\n  --fa-font-duotone: normal 900 1em/1 "Font Awesome 6 Duotone";\n  --fa-font-brands: normal 400 1em/1 "Font Awesome 6 Brands";\n}\n\nsvg:not(:root).svg-inline--fa, svg:not(:host).svg-inline--fa {\n  overflow: visible;\n  box-sizing: content-box;\n}\n\n.svg-inline--fa {\n  display: var(--fa-display, inline-block);\n  height: 1em;\n  overflow: visible;\n  vertical-align: -0.125em;\n}\n.svg-inline--fa.fa-2xs {\n  vertical-align: 0.1em;\n}\n.svg-inline--fa.fa-xs {\n  vertical-align: 0em;\n}\n.svg-inline--fa.fa-sm {\n  vertical-align: -0.0714285705em;\n}\n.svg-inline--fa.fa-lg {\n  vertical-align: -0.2em;\n}\n.svg-inline--fa.fa-xl {\n  vertical-align: -0.25em;\n}\n.svg-inline--fa.fa-2xl {\n  vertical-align: -0.3125em;\n}\n.svg-inline--fa.fa-pull-left {\n  margin-right: var(--fa-pull-margin, 0.3em);\n  width: auto;\n}\n.svg-inline--fa.fa-pull-right {\n  margin-left: var(--fa-pull-margin, 0.3em);\n  width: auto;\n}\n.svg-inline--fa.fa-li {\n  width: var(--fa-li-width, 2em);\n  top: 0.25em;\n}\n.svg-inline--fa.fa-fw {\n  width: var(--fa-fw-width, 1.25em);\n}\n\n.fa-layers svg.svg-inline--fa {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n}\n\n.fa-layers-counter, .fa-layers-text {\n  display: inline-block;\n  position: absolute;\n  text-align: center;\n}\n\n.fa-layers {\n  display: inline-block;\n  height: 1em;\n  position: relative;\n  text-align: center;\n  vertical-align: -0.125em;\n  width: 1em;\n}\n.fa-layers svg.svg-inline--fa {\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-text {\n  left: 50%;\n  top: 50%;\n  -webkit-transform: translate(-50%, -50%);\n          transform: translate(-50%, -50%);\n  -webkit-transform-origin: center center;\n          transform-origin: center center;\n}\n\n.fa-layers-counter {\n  background-color: var(--fa-counter-background-color, #ff253a);\n  border-radius: var(--fa-counter-border-radius, 1em);\n  box-sizing: border-box;\n  color: var(--fa-inverse, #fff);\n  line-height: var(--fa-counter-line-height, 1);\n  max-width: var(--fa-counter-max-width, 5em);\n  min-width: var(--fa-counter-min-width, 1.5em);\n  overflow: hidden;\n  padding: var(--fa-counter-padding, 0.25em 0.5em);\n  right: var(--fa-right, 0);\n  text-overflow: ellipsis;\n  top: var(--fa-top, 0);\n  -webkit-transform: scale(var(--fa-counter-scale, 0.25));\n          transform: scale(var(--fa-counter-scale, 0.25));\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-bottom-right {\n  bottom: var(--fa-bottom, 0);\n  right: var(--fa-right, 0);\n  top: auto;\n  -webkit-transform: scale(var(--fa-layers-scale, 0.25));\n          transform: scale(var(--fa-layers-scale, 0.25));\n  -webkit-transform-origin: bottom right;\n          transform-origin: bottom right;\n}\n\n.fa-layers-bottom-left {\n  bottom: var(--fa-bottom, 0);\n  left: var(--fa-left, 0);\n  right: auto;\n  top: auto;\n  -webkit-transform: scale(var(--fa-layers-scale, 0.25));\n          transform: scale(var(--fa-layers-scale, 0.25));\n  -webkit-transform-origin: bottom left;\n          transform-origin: bottom left;\n}\n\n.fa-layers-top-right {\n  top: var(--fa-top, 0);\n  right: var(--fa-right, 0);\n  -webkit-transform: scale(var(--fa-layers-scale, 0.25));\n          transform: scale(var(--fa-layers-scale, 0.25));\n  -webkit-transform-origin: top right;\n          transform-origin: top right;\n}\n\n.fa-layers-top-left {\n  left: var(--fa-left, 0);\n  right: auto;\n  top: var(--fa-top, 0);\n  -webkit-transform: scale(var(--fa-layers-scale, 0.25));\n          transform: scale(var(--fa-layers-scale, 0.25));\n  -webkit-transform-origin: top left;\n          transform-origin: top left;\n}\n\n.fa-1x {\n  font-size: 1em;\n}\n\n.fa-2x {\n  font-size: 2em;\n}\n\n.fa-3x {\n  font-size: 3em;\n}\n\n.fa-4x {\n  font-size: 4em;\n}\n\n.fa-5x {\n  font-size: 5em;\n}\n\n.fa-6x {\n  font-size: 6em;\n}\n\n.fa-7x {\n  font-size: 7em;\n}\n\n.fa-8x {\n  font-size: 8em;\n}\n\n.fa-9x {\n  font-size: 9em;\n}\n\n.fa-10x {\n  font-size: 10em;\n}\n\n.fa-2xs {\n  font-size: 0.625em;\n  line-height: 0.1em;\n  vertical-align: 0.225em;\n}\n\n.fa-xs {\n  font-size: 0.75em;\n  line-height: 0.0833333337em;\n  vertical-align: 0.125em;\n}\n\n.fa-sm {\n  font-size: 0.875em;\n  line-height: 0.0714285718em;\n  vertical-align: 0.0535714295em;\n}\n\n.fa-lg {\n  font-size: 1.25em;\n  line-height: 0.05em;\n  vertical-align: -0.075em;\n}\n\n.fa-xl {\n  font-size: 1.5em;\n  line-height: 0.0416666682em;\n  vertical-align: -0.125em;\n}\n\n.fa-2xl {\n  font-size: 2em;\n  line-height: 0.03125em;\n  vertical-align: -0.1875em;\n}\n\n.fa-fw {\n  text-align: center;\n  width: 1.25em;\n}\n\n.fa-ul {\n  list-style-type: none;\n  margin-left: var(--fa-li-margin, 2.5em);\n  padding-left: 0;\n}\n.fa-ul > li {\n  position: relative;\n}\n\n.fa-li {\n  left: calc(var(--fa-li-width, 2em) * -1);\n  position: absolute;\n  text-align: center;\n  width: var(--fa-li-width, 2em);\n  line-height: inherit;\n}\n\n.fa-border {\n  border-color: var(--fa-border-color, #eee);\n  border-radius: var(--fa-border-radius, 0.1em);\n  border-style: var(--fa-border-style, solid);\n  border-width: var(--fa-border-width, 0.08em);\n  padding: var(--fa-border-padding, 0.2em 0.25em 0.15em);\n}\n\n.fa-pull-left {\n  float: left;\n  margin-right: var(--fa-pull-margin, 0.3em);\n}\n\n.fa-pull-right {\n  float: right;\n  margin-left: var(--fa-pull-margin, 0.3em);\n}\n\n.fa-beat {\n  -webkit-animation-name: fa-beat;\n          animation-name: fa-beat;\n  -webkit-animation-delay: var(--fa-animation-delay, 0);\n          animation-delay: var(--fa-animation-delay, 0);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);\n          animation-timing-function: var(--fa-animation-timing, ease-in-out);\n}\n\n.fa-bounce {\n  -webkit-animation-name: fa-bounce;\n          animation-name: fa-bounce;\n  -webkit-animation-delay: var(--fa-animation-delay, 0);\n          animation-delay: var(--fa-animation-delay, 0);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));\n          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.28, 0.84, 0.42, 1));\n}\n\n.fa-fade {\n  -webkit-animation-name: fa-fade;\n          animation-name: fa-fade;\n  -webkit-animation-delay: var(--fa-animation-delay, 0);\n          animation-delay: var(--fa-animation-delay, 0);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));\n          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));\n}\n\n.fa-beat-fade {\n  -webkit-animation-name: fa-beat-fade;\n          animation-name: fa-beat-fade;\n  -webkit-animation-delay: var(--fa-animation-delay, 0);\n          animation-delay: var(--fa-animation-delay, 0);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));\n          animation-timing-function: var(--fa-animation-timing, cubic-bezier(0.4, 0, 0.6, 1));\n}\n\n.fa-flip {\n  -webkit-animation-name: fa-flip;\n          animation-name: fa-flip;\n  -webkit-animation-delay: var(--fa-animation-delay, 0);\n          animation-delay: var(--fa-animation-delay, 0);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, ease-in-out);\n          animation-timing-function: var(--fa-animation-timing, ease-in-out);\n}\n\n.fa-shake {\n  -webkit-animation-name: fa-shake;\n          animation-name: fa-shake;\n  -webkit-animation-delay: var(--fa-animation-delay, 0);\n          animation-delay: var(--fa-animation-delay, 0);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, linear);\n          animation-timing-function: var(--fa-animation-timing, linear);\n}\n\n.fa-spin {\n  -webkit-animation-name: fa-spin;\n          animation-name: fa-spin;\n  -webkit-animation-delay: var(--fa-animation-delay, 0);\n          animation-delay: var(--fa-animation-delay, 0);\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 2s);\n          animation-duration: var(--fa-animation-duration, 2s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, linear);\n          animation-timing-function: var(--fa-animation-timing, linear);\n}\n\n.fa-spin-reverse {\n  --fa-animation-direction: reverse;\n}\n\n.fa-pulse,\n.fa-spin-pulse {\n  -webkit-animation-name: fa-spin;\n          animation-name: fa-spin;\n  -webkit-animation-direction: var(--fa-animation-direction, normal);\n          animation-direction: var(--fa-animation-direction, normal);\n  -webkit-animation-duration: var(--fa-animation-duration, 1s);\n          animation-duration: var(--fa-animation-duration, 1s);\n  -webkit-animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n          animation-iteration-count: var(--fa-animation-iteration-count, infinite);\n  -webkit-animation-timing-function: var(--fa-animation-timing, steps(8));\n          animation-timing-function: var(--fa-animation-timing, steps(8));\n}\n\n@media (prefers-reduced-motion: reduce) {\n  .fa-beat,\n.fa-bounce,\n.fa-fade,\n.fa-beat-fade,\n.fa-flip,\n.fa-pulse,\n.fa-shake,\n.fa-spin,\n.fa-spin-pulse {\n    -webkit-animation-delay: -1ms;\n            animation-delay: -1ms;\n    -webkit-animation-duration: 1ms;\n            animation-duration: 1ms;\n    -webkit-animation-iteration-count: 1;\n            animation-iteration-count: 1;\n    transition-delay: 0s;\n    transition-duration: 0s;\n  }\n}\n@-webkit-keyframes fa-beat {\n  0%, 90% {\n    -webkit-transform: scale(1);\n            transform: scale(1);\n  }\n  45% {\n    -webkit-transform: scale(var(--fa-beat-scale, 1.25));\n            transform: scale(var(--fa-beat-scale, 1.25));\n  }\n}\n@keyframes fa-beat {\n  0%, 90% {\n    -webkit-transform: scale(1);\n            transform: scale(1);\n  }\n  45% {\n    -webkit-transform: scale(var(--fa-beat-scale, 1.25));\n            transform: scale(var(--fa-beat-scale, 1.25));\n  }\n}\n@-webkit-keyframes fa-bounce {\n  0% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n  10% {\n    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);\n            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);\n  }\n  30% {\n    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));\n            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));\n  }\n  50% {\n    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);\n            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);\n  }\n  57% {\n    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));\n            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));\n  }\n  64% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n  100% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n}\n@keyframes fa-bounce {\n  0% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n  10% {\n    -webkit-transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);\n            transform: scale(var(--fa-bounce-start-scale-x, 1.1), var(--fa-bounce-start-scale-y, 0.9)) translateY(0);\n  }\n  30% {\n    -webkit-transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));\n            transform: scale(var(--fa-bounce-jump-scale-x, 0.9), var(--fa-bounce-jump-scale-y, 1.1)) translateY(var(--fa-bounce-height, -0.5em));\n  }\n  50% {\n    -webkit-transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);\n            transform: scale(var(--fa-bounce-land-scale-x, 1.05), var(--fa-bounce-land-scale-y, 0.95)) translateY(0);\n  }\n  57% {\n    -webkit-transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));\n            transform: scale(1, 1) translateY(var(--fa-bounce-rebound, -0.125em));\n  }\n  64% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n  100% {\n    -webkit-transform: scale(1, 1) translateY(0);\n            transform: scale(1, 1) translateY(0);\n  }\n}\n@-webkit-keyframes fa-fade {\n  50% {\n    opacity: var(--fa-fade-opacity, 0.4);\n  }\n}\n@keyframes fa-fade {\n  50% {\n    opacity: var(--fa-fade-opacity, 0.4);\n  }\n}\n@-webkit-keyframes fa-beat-fade {\n  0%, 100% {\n    opacity: var(--fa-beat-fade-opacity, 0.4);\n    -webkit-transform: scale(1);\n            transform: scale(1);\n  }\n  50% {\n    opacity: 1;\n    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));\n            transform: scale(var(--fa-beat-fade-scale, 1.125));\n  }\n}\n@keyframes fa-beat-fade {\n  0%, 100% {\n    opacity: var(--fa-beat-fade-opacity, 0.4);\n    -webkit-transform: scale(1);\n            transform: scale(1);\n  }\n  50% {\n    opacity: 1;\n    -webkit-transform: scale(var(--fa-beat-fade-scale, 1.125));\n            transform: scale(var(--fa-beat-fade-scale, 1.125));\n  }\n}\n@-webkit-keyframes fa-flip {\n  50% {\n    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));\n            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));\n  }\n}\n@keyframes fa-flip {\n  50% {\n    -webkit-transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));\n            transform: rotate3d(var(--fa-flip-x, 0), var(--fa-flip-y, 1), var(--fa-flip-z, 0), var(--fa-flip-angle, -180deg));\n  }\n}\n@-webkit-keyframes fa-shake {\n  0% {\n    -webkit-transform: rotate(-15deg);\n            transform: rotate(-15deg);\n  }\n  4% {\n    -webkit-transform: rotate(15deg);\n            transform: rotate(15deg);\n  }\n  8%, 24% {\n    -webkit-transform: rotate(-18deg);\n            transform: rotate(-18deg);\n  }\n  12%, 28% {\n    -webkit-transform: rotate(18deg);\n            transform: rotate(18deg);\n  }\n  16% {\n    -webkit-transform: rotate(-22deg);\n            transform: rotate(-22deg);\n  }\n  20% {\n    -webkit-transform: rotate(22deg);\n            transform: rotate(22deg);\n  }\n  32% {\n    -webkit-transform: rotate(-12deg);\n            transform: rotate(-12deg);\n  }\n  36% {\n    -webkit-transform: rotate(12deg);\n            transform: rotate(12deg);\n  }\n  40%, 100% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n}\n@keyframes fa-shake {\n  0% {\n    -webkit-transform: rotate(-15deg);\n            transform: rotate(-15deg);\n  }\n  4% {\n    -webkit-transform: rotate(15deg);\n            transform: rotate(15deg);\n  }\n  8%, 24% {\n    -webkit-transform: rotate(-18deg);\n            transform: rotate(-18deg);\n  }\n  12%, 28% {\n    -webkit-transform: rotate(18deg);\n            transform: rotate(18deg);\n  }\n  16% {\n    -webkit-transform: rotate(-22deg);\n            transform: rotate(-22deg);\n  }\n  20% {\n    -webkit-transform: rotate(22deg);\n            transform: rotate(22deg);\n  }\n  32% {\n    -webkit-transform: rotate(-12deg);\n            transform: rotate(-12deg);\n  }\n  36% {\n    -webkit-transform: rotate(12deg);\n            transform: rotate(12deg);\n  }\n  40%, 100% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n}\n@-webkit-keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n@keyframes fa-spin {\n  0% {\n    -webkit-transform: rotate(0deg);\n            transform: rotate(0deg);\n  }\n  100% {\n    -webkit-transform: rotate(360deg);\n            transform: rotate(360deg);\n  }\n}\n.fa-rotate-90 {\n  -webkit-transform: rotate(90deg);\n          transform: rotate(90deg);\n}\n\n.fa-rotate-180 {\n  -webkit-transform: rotate(180deg);\n          transform: rotate(180deg);\n}\n\n.fa-rotate-270 {\n  -webkit-transform: rotate(270deg);\n          transform: rotate(270deg);\n}\n\n.fa-flip-horizontal {\n  -webkit-transform: scale(-1, 1);\n          transform: scale(-1, 1);\n}\n\n.fa-flip-vertical {\n  -webkit-transform: scale(1, -1);\n          transform: scale(1, -1);\n}\n\n.fa-flip-both,\n.fa-flip-horizontal.fa-flip-vertical {\n  -webkit-transform: scale(-1, -1);\n          transform: scale(-1, -1);\n}\n\n.fa-rotate-by {\n  -webkit-transform: rotate(var(--fa-rotate-angle, none));\n          transform: rotate(var(--fa-rotate-angle, none));\n}\n\n.fa-stack {\n  display: inline-block;\n  vertical-align: middle;\n  height: 2em;\n  position: relative;\n  width: 2.5em;\n}\n\n.fa-stack-1x,\n.fa-stack-2x {\n  bottom: 0;\n  left: 0;\n  margin: auto;\n  position: absolute;\n  right: 0;\n  top: 0;\n  z-index: var(--fa-stack-z-index, auto);\n}\n\n.svg-inline--fa.fa-stack-1x {\n  height: 1em;\n  width: 1.25em;\n}\n.svg-inline--fa.fa-stack-2x {\n  height: 2em;\n  width: 2.5em;\n}\n\n.fa-inverse {\n  color: var(--fa-inverse, #fff);\n}\n\n.sr-only,\n.fa-sr-only {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  white-space: nowrap;\n  border-width: 0;\n}\n\n.sr-only-focusable:not(:focus),\n.fa-sr-only-focusable:not(:focus) {\n  position: absolute;\n  width: 1px;\n  height: 1px;\n  padding: 0;\n  margin: -1px;\n  overflow: hidden;\n  clip: rect(0, 0, 0, 0);\n  white-space: nowrap;\n  border-width: 0;\n}\n\n.svg-inline--fa .fa-primary {\n  fill: var(--fa-primary-color, currentColor);\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa .fa-secondary {\n  fill: var(--fa-secondary-color, currentColor);\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-primary {\n  opacity: var(--fa-secondary-opacity, 0.4);\n}\n\n.svg-inline--fa.fa-swap-opacity .fa-secondary {\n  opacity: var(--fa-primary-opacity, 1);\n}\n\n.svg-inline--fa mask .fa-primary,\n.svg-inline--fa mask .fa-secondary {\n  fill: black;\n}\n\n.fad.fa-inverse,\n.fa-duotone.fa-inverse {\n  color: var(--fa-inverse, #fff);\n}';if(n!==t||r!==e){var o=new RegExp("\\.".concat(t,"\\-"),"g"),s=new RegExp("\\--".concat(t,"\\-"),"g"),a=new RegExp("\\.".concat(e),"g");i=i.replace(o,".".concat(n,"-")).replace(s,"--".concat(n,"-")).replace(a,".".concat(r))}return i}var vv=!1;function bv(){cv.autoAddCss&&!vv&&(function(t){if(t&&Ny){var e=Py.createElement("style");e.setAttribute("type","text/css"),e.innerHTML=t;for(var n=Py.head.childNodes,r=null,i=n.length-1;i>-1;i--){var o=n[i],s=(o.tagName||"").toUpperCase();["STYLE","LINK"].indexOf(s)>-1&&(r=o)}Py.head.insertBefore(e,r)}}(yv()),vv=!0)}var xv={mixout:function(){return{dom:{css:yv,insertCss:bv}}},hooks:function(){return{beforeDOMElementCreation:function(){bv()},beforeI2svg:function(){bv()}}}},wv=Oy||{};wv.___FONT_AWESOME___||(wv.___FONT_AWESOME___={}),wv.___FONT_AWESOME___.styles||(wv.___FONT_AWESOME___.styles={}),wv.___FONT_AWESOME___.hooks||(wv.___FONT_AWESOME___.hooks={}),wv.___FONT_AWESOME___.shims||(wv.___FONT_AWESOME___.shims=[]);var Tv=wv.___FONT_AWESOME___,Cv=[],Ev=!1;function Sv(t){Ny&&(Ev?setTimeout(t,0):Cv.push(t))}function Iv(t){var e=t.tag,n=t.attributes,r=void 0===n?{}:n,i=t.children,o=void 0===i?[]:i;return"string"==typeof t?mv(t):"<".concat(e," ").concat(function(t){return Object.keys(t||{}).reduce(function(e,n){return e+"".concat(n,'="').concat(mv(t[n]),'" ')},"").trim()}(r),">").concat(o.map(Iv).join(""),"</").concat(e,">")}function kv(t,e,n){if(t&&t[e]&&t[e][n])return{prefix:e,iconName:n,icon:t[e][n]}}Ny&&((Ev=(Py.documentElement.doScroll?/^loaded|^c/:/^loaded|^i|^c/).test(Py.readyState))||Py.addEventListener("DOMContentLoaded",function t(){Py.removeEventListener("DOMContentLoaded",t),Ev=1,Cv.map(function(t){return t()})}));var Av=function(t,e,n,r){var i,o,s,a=Object.keys(t),c=a.length,l=void 0!==r?function(t,e){return function(n,r,i,o){return t.call(e,n,r,i,o)}}(e,r):e;for(void 0===n?(i=1,s=t[a[0]]):(i=0,s=n);i<c;i++)s=l(s,t[o=a[i]],o,t);return s};function Mv(t){var e=function(t){for(var e=[],n=0,r=t.length;n<r;){var i=t.charCodeAt(n++);if(i>=55296&&i<=56319&&n<r){var o=t.charCodeAt(n++);56320==(64512&o)?e.push(((1023&i)<<10)+(1023&o)+65536):(e.push(i),n--)}else e.push(i)}return e}(t);return 1===e.length?e[0].toString(16):null}function Ov(t){return Object.keys(t).reduce(function(e,n){var r=t[n];return r.icon?e[r.iconName]=r.icon:e[n]=r,e},{})}function Pv(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.skipHooks,i=void 0!==r&&r,o=Ov(e);"function"!=typeof Tv.hooks.addPack||i?Tv.styles[t]=_y(_y({},Tv.styles[t]||{}),o):Tv.hooks.addPack(t,Ov(e)),"fas"===t&&Pv("fa",e)}var Dv=Tv.styles,Rv=Tv.shims,Nv=Object.values(Hy),Lv=null,jv={},zv={},Fv={},Bv={},Uv={},Vv=Object.keys($y);function qv(t,e){var n=e.split("-"),r=n[0],i=n.slice(1).join("-");return r!==t||""===i||~ov.indexOf(i)?null:i}var Gv=function(){var t=function(t){return Av(Dv,function(e,n,r){return e[r]=Av(n,t,{}),e},{})};jv=t(function(t,e,n){return e[3]&&(t[e[3]]=n),e[2]&&e[2].filter(function(t){return"number"==typeof t}).forEach(function(e){t[e.toString(16)]=n}),t}),zv=t(function(t,e,n){return t[n]=n,e[2]&&e[2].filter(function(t){return"string"==typeof t}).forEach(function(e){t[e]=n}),t}),Uv=t(function(t,e,n){var r=e[2];return t[n]=n,r.forEach(function(e){t[e]=n}),t});var e="far"in Dv||cv.autoFetchSvg,n=Av(Rv,function(t,n){var r=n[0],i=n[1],o=n[2];return"far"!==i||e||(i="fas"),"string"==typeof r&&(t.names[r]={prefix:i,iconName:o}),"number"==typeof r&&(t.unicodes[r.toString(16)]={prefix:i,iconName:o}),t},{names:{},unicodes:{}});Fv=n.names,Bv=n.unicodes,Lv=Kv(cv.styleDefault)};function $v(t,e){return(jv[t]||{})[e]}function Wv(t,e){return(Uv[t]||{})[e]}function Hv(t){return Fv[t]||{prefix:null,iconName:null}}function Zv(){return Lv}function Kv(t){return Wy[t]||Wy[$y[t]]||(t in Tv.styles?t:null)||null}function Xv(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.skipLookups,r=void 0!==n&&n,i=null,o=t.reduce(function(t,e){var n=qv(cv.familyPrefix,e);if(Dv[e]?(e=Nv.includes(e)?Zy[e]:e,i=e,t.prefix=e):Vv.indexOf(e)>-1?(i=e,t.prefix=Kv(e)):n?t.iconName=n:e!==cv.replacementClass&&t.rest.push(e),!r&&t.prefix&&t.iconName){var o="fa"===i?Hv(t.iconName):{},s=Wv(t.prefix,t.iconName);o.prefix&&(i=null),t.iconName=o.iconName||s||t.iconName,t.prefix=o.prefix||t.prefix,"far"!==t.prefix||Dv.far||!Dv.fas||cv.autoFetchSvg||(t.prefix="fas")}return t},{prefix:null,iconName:null,rest:[]});return"fa"!==o.prefix&&"fa"!==i||(o.prefix=Zv()||"fas"),o}lv.push(function(t){Lv=Kv(t.styleDefault)}),Gv();var Yv=function(){function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.definitions={}}var e,n;return e=t,(n=[{key:"add",value:function(){for(var t=this,e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];var i=n.reduce(this._pullDefinitions,{});Object.keys(i).forEach(function(e){t.definitions[e]=_y(_y({},t.definitions[e]||{}),i[e]),Pv(e,i[e]);var n=Hy[e];n&&Pv(n,i[e]),Gv()})}},{key:"reset",value:function(){this.definitions={}}},{key:"_pullDefinitions",value:function(t,e){var n=e.prefix&&e.iconName&&e.icon?{0:e}:e;return Object.keys(n).map(function(e){var r=n[e],i=r.prefix,o=r.iconName,s=r.icon,a=s[2];t[i]||(t[i]={}),a.length>0&&a.forEach(function(e){"string"==typeof e&&(t[i][e]=s)}),t[i][o]=s}),t}}])&&function(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}(e.prototype,n),Object.defineProperty(e,"prototype",{writable:!1}),t}(),Qv=[],Jv={},tb={},eb=Object.keys(tb);function nb(t,e){for(var n=arguments.length,r=new Array(n>2?n-2:0),i=2;i<n;i++)r[i-2]=arguments[i];var o=Jv[t]||[];return o.forEach(function(t){e=t.apply(null,[e].concat(r))}),e}function rb(t){for(var e=arguments.length,n=new Array(e>1?e-1:0),r=1;r<e;r++)n[r-1]=arguments[r];var i=Jv[t]||[];i.forEach(function(t){t.apply(null,n)})}function ib(){var t=arguments[0],e=Array.prototype.slice.call(arguments,1);return tb[t]?tb[t].apply(null,e):void 0}function ob(t){"fa"===t.prefix&&(t.prefix="fas");var e=t.iconName,n=t.prefix||Zv();if(e)return e=Wv(n,e)||e,kv(sb.definitions,n,e)||kv(Tv.styles,n,e)}var sb=new Yv,ab={i2svg:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return Ny?(rb("beforeI2svg",t),ib("pseudoElements2svg",t),ib("i2svg",t)):Promise.reject("Operation requires a DOM of some kind.")},watch:function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.autoReplaceSvgRoot;!1===cv.autoReplaceSvg&&(cv.autoReplaceSvg=!0),cv.observeMutations=!0,Sv(function(){lb({autoReplaceSvgRoot:e}),rb("watch",t)})}},cb={noAuto:function(){cv.autoReplaceSvg=!1,cv.observeMutations=!1,rb("noAuto")},config:cv,dom:ab,parse:{icon:function(t){if(null===t)return null;if("object"===yy(t)&&t.prefix&&t.iconName)return{prefix:t.prefix,iconName:Wv(t.prefix,t.iconName)||t.iconName};if(Array.isArray(t)&&2===t.length){var e=0===t[1].indexOf("fa-")?t[1].slice(3):t[1],n=Kv(t[0]);return{prefix:n,iconName:Wv(n,e)||e}}if("string"==typeof t&&(t.indexOf("".concat(cv.familyPrefix,"-"))>-1||t.match(Ky))){var r=Xv(t.split(" "),{skipLookups:!0});return{prefix:r.prefix||Zv(),iconName:Wv(r.prefix,r.iconName)||r.iconName}}if("string"==typeof t){var i=Zv();return{prefix:i,iconName:Wv(i,t)||t}}}},library:sb,findIconDefinition:ob,toHtml:Iv},lb=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},e=t.autoReplaceSvgRoot,n=void 0===e?Py:e;(Object.keys(Tv.styles).length>0||cv.autoFetchSvg)&&Ny&&cv.autoReplaceSvg&&cb.dom.i2svg({node:n})};function ub(t,e){return Object.defineProperty(t,"abstract",{get:e}),Object.defineProperty(t,"html",{get:function(){return t.abstract.map(function(t){return Iv(t)})}}),Object.defineProperty(t,"node",{get:function(){if(Ny){var e=Py.createElement("div");return e.innerHTML=t.html,e.children}}}),t}function hb(t){var e=t.icons,n=e.main,r=e.mask,i=t.prefix,o=t.iconName,s=t.transform,a=t.symbol,c=t.title,l=t.maskId,u=t.titleId,h=t.extra,d=t.watchable,p=void 0!==d&&d,f=r.found?r:n,m=f.width,g=f.height,_="fak"===i,y=[cv.replacementClass,o?"".concat(cv.familyPrefix,"-").concat(o):""].filter(function(t){return-1===h.classes.indexOf(t)}).filter(function(t){return""!==t||!!t}).concat(h.classes).join(" "),v={children:[],attributes:_y(_y({},h.attributes),{},{"data-prefix":i,"data-icon":o,class:y,role:h.attributes.role||"img",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(m," ").concat(g)})},b=_&&!~h.classes.indexOf("fa-fw")?{width:"".concat(m/g*16*.0625,"em")}:{};p&&(v.attributes[zy]=""),c&&(v.children.push({tag:"title",attributes:{id:v.attributes["aria-labelledby"]||"title-".concat(u||dv())},children:[c]}),delete v.attributes.title);var x=_y(_y({},v),{},{prefix:i,iconName:o,main:n,mask:r,maskId:l,transform:s,symbol:a,styles:_y(_y({},b),h.styles)}),w=r.found&&n.found?ib("generateAbstractMask",x)||{children:[],attributes:{}}:ib("generateAbstractIcon",x)||{children:[],attributes:{}},T=w.attributes;return x.children=w.children,x.attributes=T,a?function(t){var e=t.iconName,n=t.children,r=t.attributes,i=t.symbol,o=!0===i?"".concat(t.prefix,"-").concat(cv.familyPrefix,"-").concat(e):i;return[{tag:"svg",attributes:{style:"display: none;"},children:[{tag:"symbol",attributes:_y(_y({},r),{},{id:o}),children:n}]}]}(x):function(t){var e=t.children,n=t.main,r=t.mask,i=t.attributes,o=t.styles,s=t.transform;if(_v(s)&&n.found&&!r.found){var a={x:n.width/n.height/2,y:.5};i.style=gv(_y(_y({},o),{},{"transform-origin":"".concat(a.x+s.x/16,"em ").concat(a.y+s.y/16,"em")}))}return[{tag:"svg",attributes:i,children:e}]}(x)}function db(t){var e=t.content,n=t.width,r=t.height,i=t.transform,o=t.title,s=t.extra,a=t.watchable,c=void 0!==a&&a,l=_y(_y(_y({},s.attributes),o?{title:o}:{}),{},{class:s.classes.join(" ")});c&&(l[zy]="");var u=_y({},s.styles);_v(i)&&(u.transform=function(t){var e=t.transform,n=t.width,r=t.height,i=void 0===r?16:r,o=t.startCentered,s=void 0!==o&&o,a="";return a+=s&&Ly?"translate(".concat(e.x/uv-(void 0===n?16:n)/2,"em, ").concat(e.y/uv-i/2,"em) "):s?"translate(calc(-50% + ".concat(e.x/uv,"em), calc(-50% + ").concat(e.y/uv,"em)) "):"translate(".concat(e.x/uv,"em, ").concat(e.y/uv,"em) "),(a+="scale(".concat(e.size/uv*(e.flipX?-1:1),", ").concat(e.size/uv*(e.flipY?-1:1),") "))+"rotate(".concat(e.rotate,"deg) ")}({transform:i,startCentered:!0,width:n,height:r}),u["-webkit-transform"]=u.transform);var h=gv(u);h.length>0&&(l.style=h);var d=[];return d.push({tag:"span",attributes:l,children:[e]}),o&&d.push({tag:"span",attributes:{class:"sr-only"},children:[o]}),d}function pb(t){var e=t.content,n=t.title,r=t.extra,i=_y(_y(_y({},r.attributes),n?{title:n}:{}),{},{class:r.classes.join(" ")}),o=gv(r.styles);o.length>0&&(i.style=o);var s=[];return s.push({tag:"span",attributes:i,children:[e]}),n&&s.push({tag:"span",attributes:{class:"sr-only"},children:[n]}),s}var fb=Tv.styles;function mb(t){var e=t[0],n=t[1],r=by(t.slice(4),1)[0];return{found:!0,width:e,height:n,icon:Array.isArray(r)?{tag:"g",attributes:{class:"".concat(cv.familyPrefix,"-").concat(nv)},children:[{tag:"path",attributes:{class:"".concat(cv.familyPrefix,"-").concat(iv),fill:"currentColor",d:r[0]}},{tag:"path",attributes:{class:"".concat(cv.familyPrefix,"-").concat(rv),fill:"currentColor",d:r[1]}}]}:{tag:"path",attributes:{fill:"currentColor",d:r}}}}var gb={found:!1,width:512,height:512};function _b(t,e){var n=e;return"fa"===e&&null!==cv.styleDefault&&(e=Zv()),new Promise(function(r,i){if(ib("missingIconAbstract"),"fa"===n){var o=Hv(t)||{};t=o.iconName||t,e=o.prefix||e}if(t&&e&&fb[e]&&fb[e][t])return r(mb(fb[e][t]));!function(t,e){Gy||cv.showMissingIcons||!t||console.error('Icon with name "'.concat(t,'" and prefix "').concat(e,'" is missing.'))}(t,e),r(_y(_y({},gb),{},{icon:cv.showMissingIcons&&t&&ib("missingIconAbstract")||{}}))})}var yb=function(){},vb=cv.measurePerformance&&Ry&&Ry.mark&&Ry.measure?Ry:{mark:yb,measure:yb},bb='FA "6.0.0"',xb=function(t){return vb.mark("".concat(bb," ").concat(t," begins")),function(){return function(t){vb.mark("".concat(bb," ").concat(t," ends")),vb.measure("".concat(bb," ").concat(t),"".concat(bb," ").concat(t," begins"),"".concat(bb," ").concat(t," ends"))}(t)}},wb=function(){};function Tb(t){return"string"==typeof(t.getAttribute?t.getAttribute(zy):null)}function Cb(t){return Py.createElementNS("http://www.w3.org/2000/svg",t)}function Eb(t){return Py.createElement(t)}function Sb(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.ceFn,r=void 0===n?"svg"===t.tag?Cb:Eb:n;if("string"==typeof t)return Py.createTextNode(t);var i=r(t.tag);Object.keys(t.attributes||[]).forEach(function(e){i.setAttribute(e,t.attributes[e])});var o=t.children||[];return o.forEach(function(t){i.appendChild(Sb(t,{ceFn:r}))}),i}var Ib={replace:function(t){var e=t[0];if(e.parentNode)if(t[1].forEach(function(t){e.parentNode.insertBefore(Sb(t),e)}),null===e.getAttribute(zy)&&cv.keepOriginalSource){var n=Py.createComment(function(t){var e=" ".concat(t.outerHTML," ");return"".concat(e,"Font Awesome fontawesome.com ")}(e));e.parentNode.replaceChild(n,e)}else e.remove()},nest:function(t){var e=t[0],n=t[1];if(~fv(e).indexOf(cv.replacementClass))return Ib.replace(t);var r=new RegExp("".concat(cv.familyPrefix,"-.*"));if(delete n[0].attributes.id,n[0].attributes.class){var i=n[0].attributes.class.split(" ").reduce(function(t,e){return e===cv.replacementClass||e.match(r)?t.toSvg.push(e):t.toNode.push(e),t},{toNode:[],toSvg:[]});n[0].attributes.class=i.toSvg.join(" "),0===i.toNode.length?e.removeAttribute("class"):e.setAttribute("class",i.toNode.join(" "))}var o=n.map(function(t){return Iv(t)}).join("\n");e.setAttribute(zy,""),e.innerHTML=o}};function kb(t){t()}function Ab(t,e){var n="function"==typeof e?e:wb;if(0===t.length)n();else{var r=kb;"async"===cv.mutateApproach&&(r=Oy.requestAnimationFrame||kb),r(function(){var e=!0===cv.autoReplaceSvg?Ib.replace:Ib[cv.autoReplaceSvg]||Ib.replace,r=xb("mutate");t.map(e),r(),n()})}}var Mb=!1;function Ob(){Mb=!0}function Pb(){Mb=!1}var Db=null;function Rb(t){if(Dy&&cv.observeMutations){var e=t.treeCallback,n=void 0===e?wb:e,r=t.nodeCallback,i=void 0===r?wb:r,o=t.pseudoElementsCallback,s=void 0===o?wb:o,a=t.observeMutationsRoot,c=void 0===a?Py:a;Db=new Dy(function(t){if(!Mb){var e=Zv();pv(t).forEach(function(t){if("childList"===t.type&&t.addedNodes.length>0&&!Tb(t.addedNodes[0])&&(cv.searchPseudoElements&&s(t.target),n(t.target)),"attributes"===t.type&&t.target.parentNode&&cv.searchPseudoElements&&s(t.target.parentNode),"attributes"===t.type&&Tb(t.target)&&~ev.indexOf(t.attributeName))if("class"===t.attributeName&&function(t){var e=t.getAttribute?t.getAttribute(By):null,n=t.getAttribute?t.getAttribute(Uy):null;return e&&n}(t.target)){var r=Xv(fv(t.target)),o=r.iconName;t.target.setAttribute(By,r.prefix||e),o&&t.target.setAttribute(Uy,o)}else(a=t.target)&&a.classList&&a.classList.contains&&a.classList.contains(cv.replacementClass)&&i(t.target);var a})}}),Ny&&Db.observe(c,{childList:!0,attributes:!0,characterData:!0,subtree:!0})}}function Nb(t){var e=t.getAttribute("style"),n=[];return e&&(n=e.split(";").reduce(function(t,e){var n=e.split(":"),r=n[0],i=n.slice(1);return r&&i.length>0&&(t[r]=i.join(":").trim()),t},{})),n}function Lb(t){var e=t.getAttribute("data-prefix"),n=t.getAttribute("data-icon"),r=void 0!==t.innerText?t.innerText.trim():"",i=Xv(fv(t));return i.prefix||(i.prefix=Zv()),e&&n&&(i.prefix=e,i.iconName=n),i.iconName&&i.prefix||i.prefix&&r.length>0&&(i.iconName=(zv[i.prefix]||{})[t.innerText]||$v(i.prefix,Mv(t.innerText))),i}function jb(t){var e=pv(t.attributes).reduce(function(t,e){return"class"!==t.name&&"style"!==t.name&&(t[e.name]=e.value),t},{}),n=t.getAttribute("title"),r=t.getAttribute("data-fa-title-id");return cv.autoA11y&&(n?e["aria-labelledby"]="".concat(cv.replacementClass,"-title-").concat(r||dv()):(e["aria-hidden"]="true",e.focusable="false")),e}function zb(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{styleParser:!0},n=Lb(t),r=n.iconName,i=n.prefix,o=n.rest,s=jb(t),a=nb("parseNodeAttributes",{},t),c=e.styleParser?Nb(t):[];return _y({iconName:r,title:t.getAttribute("title"),titleId:t.getAttribute("data-fa-title-id"),prefix:i,transform:hv,mask:{iconName:null,prefix:null,rest:[]},maskId:null,symbol:!1,extra:{classes:o,styles:c,attributes:s}},a)}var Fb=Tv.styles;function Bb(t){var e="nest"===cv.autoReplaceSvg?zb(t,{styleParser:!1}):zb(t);return~e.extra.classes.indexOf(Xy)?ib("generateLayersText",t,e):ib("generateSvgReplacementMutation",t,e)}function Ub(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;if(!Ny)return Promise.resolve();var n=Py.documentElement.classList,r=function(t){return n.add("".concat(Vy,"-").concat(t))},i=function(t){return n.remove("".concat(Vy,"-").concat(t))},o=Object.keys(cv.autoFetchSvg?$y:Fb),s=[".".concat(Xy,":not([").concat(zy,"])")].concat(o.map(function(t){return".".concat(t,":not([").concat(zy,"])")})).join(", ");if(0===s.length)return Promise.resolve();var a=[];try{a=pv(t.querySelectorAll(s))}catch(K_){}if(!(a.length>0))return Promise.resolve();r("pending"),i("complete");var c=xb("onTree"),l=a.reduce(function(t,e){try{var n=Bb(e);n&&t.push(n)}catch(K_){Gy||"MissingIcon"===K_.name&&console.error(K_)}return t},[]);return new Promise(function(t,n){Promise.all(l).then(function(n){Ab(n,function(){r("active"),r("complete"),i("pending"),"function"==typeof e&&e(),c(),t()})}).catch(function(t){c(),n(t)})})}function Vb(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null;Bb(t).then(function(t){t&&Ab([t],e)})}var qb=function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.transform,r=void 0===n?hv:n,i=e.symbol,o=void 0!==i&&i,s=e.mask,a=void 0===s?null:s,c=e.maskId,l=void 0===c?null:c,u=e.title,h=void 0===u?null:u,d=e.titleId,p=void 0===d?null:d,f=e.classes,m=void 0===f?[]:f,g=e.attributes,_=void 0===g?{}:g,y=e.styles,v=void 0===y?{}:y;if(t){var b=t.prefix,x=t.iconName,w=t.icon;return ub(_y({type:"icon"},t),function(){return rb("beforeDOMElementCreation",{iconDefinition:t,params:e}),cv.autoA11y&&(h?_["aria-labelledby"]="".concat(cv.replacementClass,"-title-").concat(p||dv()):(_["aria-hidden"]="true",_.focusable="false")),hb({icons:{main:mb(w),mask:a?mb(a.icon):{found:!1,width:null,height:null,icon:{}}},prefix:b,iconName:x,transform:_y(_y({},hv),r),symbol:o,title:h,maskId:l,titleId:p,extra:{attributes:_,styles:v,classes:m}})})}},Gb={mixout:function(){return{icon:(t=qb,function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=(e||{}).icon?e:ob(e||{}),i=n.mask;return i&&(i=(i||{}).icon?i:ob(i||{})),t(r,_y(_y({},n),{},{mask:i}))})};var t},hooks:function(){return{mutationObserverCallbacks:function(t){return t.treeCallback=Ub,t.nodeCallback=Vb,t}}},provides:function(t){t.i2svg=function(t){var e=t.node,n=t.callback;return Ub(void 0===e?Py:e,void 0===n?function(){}:n)},t.generateSvgReplacementMutation=function(t,e){var n=e.iconName,r=e.title,i=e.titleId,o=e.prefix,s=e.transform,a=e.symbol,c=e.mask,l=e.maskId,u=e.extra;return new Promise(function(e,h){Promise.all([_b(n,o),c.iconName?_b(c.iconName,c.prefix):Promise.resolve({found:!1,width:512,height:512,icon:{}})]).then(function(c){var h=by(c,2);e([t,hb({icons:{main:h[0],mask:h[1]},prefix:o,iconName:n,transform:s,symbol:a,maskId:l,title:r,titleId:i,extra:u,watchable:!0})])}).catch(h)})},t.generateAbstractIcon=function(t){var e,n=t.children,r=t.attributes,i=t.main,o=t.transform,s=gv(t.styles);return s.length>0&&(r.style=s),_v(o)&&(e=ib("generateAbstractTransformGrouping",{main:i,transform:o,containerWidth:i.width,iconWidth:i.width})),n.push(e||i.icon),{children:n,attributes:r}}}},$b={mixout:function(){return{layer:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.classes,r=void 0===n?[]:n;return ub({type:"layer"},function(){rb("beforeDOMElementCreation",{assembler:t,params:e});var n=[];return t(function(t){Array.isArray(t)?t.map(function(t){n=n.concat(t.abstract)}):n=n.concat(t.abstract)}),[{tag:"span",attributes:{class:["".concat(cv.familyPrefix,"-layers")].concat(xy(r)).join(" ")},children:n}]})}}}},Wb={mixout:function(){return{counter:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.title,r=void 0===n?null:n,i=e.classes,o=void 0===i?[]:i,s=e.attributes,a=void 0===s?{}:s,c=e.styles,l=void 0===c?{}:c;return ub({type:"counter",content:t},function(){return rb("beforeDOMElementCreation",{content:t,params:e}),pb({content:t.toString(),title:r,extra:{attributes:a,styles:l,classes:["".concat(cv.familyPrefix,"-layers-counter")].concat(xy(o))}})})}}}},Hb={mixout:function(){return{text:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e.transform,r=void 0===n?hv:n,i=e.title,o=void 0===i?null:i,s=e.classes,a=void 0===s?[]:s,c=e.attributes,l=void 0===c?{}:c,u=e.styles,h=void 0===u?{}:u;return ub({type:"text",content:t},function(){return rb("beforeDOMElementCreation",{content:t,params:e}),db({content:t,transform:_y(_y({},hv),r),title:o,extra:{attributes:l,styles:h,classes:["".concat(cv.familyPrefix,"-layers-text")].concat(xy(a))}})})}}},provides:function(t){t.generateLayersText=function(t,e){var n=e.title,r=e.transform,i=e.extra,o=null,s=null;if(Ly){var a=parseInt(getComputedStyle(t).fontSize,10),c=t.getBoundingClientRect();o=c.width/a,s=c.height/a}return cv.autoA11y&&!n&&(i.attributes["aria-hidden"]="true"),Promise.resolve([t,db({content:t.innerHTML,width:o,height:s,transform:r,title:n,extra:i,watchable:!0})])}}},Zb=new RegExp('"',"ug"),Kb=[1105920,1112319];function Xb(t,e){var n="".concat("data-fa-pseudo-element-pending").concat(e.replace(":","-"));return new Promise(function(r,i){if(null!==t.getAttribute(n))return r();var o,s,a,c=pv(t.children).filter(function(t){return t.getAttribute(Fy)===e})[0],l=Oy.getComputedStyle(t,e),u=l.getPropertyValue("font-family").match(Yy),h=l.getPropertyValue("font-weight"),d=l.getPropertyValue("content");if(c&&!u)return t.removeChild(c),r();if(u&&"none"!==d&&""!==d){var p=l.getPropertyValue("content"),f=~["Solid","Regular","Light","Thin","Duotone","Brands","Kit"].indexOf(u[2])?Wy[u[2].toLowerCase()]:Qy[h],m=function(t){var e,n,r,i,o=t.replace(Zb,""),s=(r=(e=o).length,(i=e.charCodeAt(0))>=55296&&i<=56319&&r>1&&(n=e.charCodeAt(1))>=56320&&n<=57343?1024*(i-55296)+n-56320+65536:i),a=s>=Kb[0]&&s<=Kb[1],c=2===o.length&&o[0]===o[1];return{value:Mv(c?o[0]:o),isSecondary:a||c}}(p),g=m.value,_=m.isSecondary,y=u[0].startsWith("FontAwesome"),v=$v(f,g),b=v;if(y){var x=(s=Bv[o=g],a=$v("fas",o),s||(a?{prefix:"fas",iconName:a}:null)||{prefix:null,iconName:null});x.iconName&&x.prefix&&(v=x.iconName,f=x.prefix)}if(!v||_||c&&c.getAttribute(By)===f&&c.getAttribute(Uy)===b)r();else{t.setAttribute(n,b),c&&t.removeChild(c);var w={iconName:null,title:null,titleId:null,prefix:null,transform:hv,symbol:!1,mask:{iconName:null,prefix:null,rest:[]},maskId:null,extra:{classes:[],styles:{},attributes:{}}},T=w.extra;T.attributes[Fy]=e,_b(v,f).then(function(i){var o=hb(_y(_y({},w),{},{icons:{main:i,mask:{prefix:null,iconName:null,rest:[]}},prefix:f,iconName:b,extra:T,watchable:!0})),s=Py.createElement("svg");"::before"===e?t.insertBefore(s,t.firstChild):t.appendChild(s),s.outerHTML=o.map(function(t){return Iv(t)}).join("\n"),t.removeAttribute(n),r()}).catch(i)}}else r()})}function Yb(t){return Promise.all([Xb(t,"::before"),Xb(t,"::after")])}function Qb(t){return!(t.parentNode===document.head||~qy.indexOf(t.tagName.toUpperCase())||t.getAttribute(Fy)||t.parentNode&&"svg"===t.parentNode.tagName)}function Jb(t){if(Ny)return new Promise(function(e,n){var r=pv(t.querySelectorAll("*")).filter(Qb).map(Yb),i=xb("searchPseudoElements");Ob(),Promise.all(r).then(function(){i(),Pb(),e()}).catch(function(){i(),Pb(),n()})})}var tx,ex=!1,nx=function(t){return t.toLowerCase().split(" ").reduce(function(t,e){var n=e.toLowerCase().split("-"),r=n[0],i=n.slice(1).join("-");if(r&&"h"===i)return t.flipX=!0,t;if(r&&"v"===i)return t.flipY=!0,t;if(i=parseFloat(i),isNaN(i))return t;switch(r){case"grow":t.size=t.size+i;break;case"shrink":t.size=t.size-i;break;case"left":t.x=t.x-i;break;case"right":t.x=t.x+i;break;case"up":t.y=t.y-i;break;case"down":t.y=t.y+i;break;case"rotate":t.rotate=t.rotate+i}return t},{size:16,x:0,y:0,flipX:!1,flipY:!1,rotate:0})},rx={x:0,y:0,width:"100%",height:"100%"};function ix(t){var e=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return t.attributes&&(t.attributes.fill||e)&&(t.attributes.fill="black"),t}tx=cb,Qv=[xv,Gb,$b,Wb,Hb,{hooks:function(){return{mutationObserverCallbacks:function(t){return t.pseudoElementsCallback=Jb,t}}},provides:function(t){t.pseudoElements2svg=function(t){var e=t.node;cv.searchPseudoElements&&Jb(void 0===e?Py:e)}}},{mixout:function(){return{dom:{unwatch:function(){Ob(),ex=!0}}}},hooks:function(){return{bootstrap:function(){Rb(nb("mutationObserverCallbacks",{}))},noAuto:function(){Db&&Db.disconnect()},watch:function(t){var e=t.observeMutationsRoot;ex?Pb():Rb(nb("mutationObserverCallbacks",{observeMutationsRoot:e}))}}}},{mixout:function(){return{parse:{transform:function(t){return nx(t)}}}},hooks:function(){return{parseNodeAttributes:function(t,e){var n=e.getAttribute("data-fa-transform");return n&&(t.transform=nx(n)),t}}},provides:function(t){t.generateAbstractTransformGrouping=function(t){var e=t.main,n=t.transform,r=t.iconWidth,i={transform:"translate(".concat(t.containerWidth/2," 256)")},o="translate(".concat(32*n.x,", ").concat(32*n.y,") "),s="scale(".concat(n.size/16*(n.flipX?-1:1),", ").concat(n.size/16*(n.flipY?-1:1),") "),a="rotate(".concat(n.rotate," 0 0)"),c={outer:i,inner:{transform:"".concat(o," ").concat(s," ").concat(a)},path:{transform:"translate(".concat(r/2*-1," -256)")}};return{tag:"g",attributes:_y({},c.outer),children:[{tag:"g",attributes:_y({},c.inner),children:[{tag:e.icon.tag,children:e.icon.children,attributes:_y(_y({},e.icon.attributes),c.path)}]}]}}}},{hooks:function(){return{parseNodeAttributes:function(t,e){var n=e.getAttribute("data-fa-mask"),r=n?Xv(n.split(" ").map(function(t){return t.trim()})):{prefix:null,iconName:null,rest:[]};return r.prefix||(r.prefix=Zv()),t.mask=r,t.maskId=e.getAttribute("data-fa-mask-id"),t}}},provides:function(t){t.generateAbstractMask=function(t){var e,n=t.children,r=t.attributes,i=t.main,o=t.mask,s=t.maskId,a=i.icon,c=o.icon,l=function(t){var e=t.transform,n=t.iconWidth,r={transform:"translate(".concat(t.containerWidth/2," 256)")},i="translate(".concat(32*e.x,", ").concat(32*e.y,") "),o="scale(".concat(e.size/16*(e.flipX?-1:1),", ").concat(e.size/16*(e.flipY?-1:1),") "),s="rotate(".concat(e.rotate," 0 0)");return{outer:r,inner:{transform:"".concat(i," ").concat(o," ").concat(s)},path:{transform:"translate(".concat(n/2*-1," -256)")}}}({transform:t.transform,containerWidth:o.width,iconWidth:i.width}),u={tag:"rect",attributes:_y(_y({},rx),{},{fill:"white"})},h=a.children?{children:a.children.map(ix)}:{},d={tag:"g",attributes:_y({},l.inner),children:[ix(_y({tag:a.tag,attributes:_y(_y({},a.attributes),l.path)},h))]},p={tag:"g",attributes:_y({},l.outer),children:[d]},f="mask-".concat(s||dv()),m="clip-".concat(s||dv()),g={tag:"mask",attributes:_y(_y({},rx),{},{id:f,maskUnits:"userSpaceOnUse",maskContentUnits:"userSpaceOnUse"}),children:[u,p]},_={tag:"defs",children:[{tag:"clipPath",attributes:{id:m},children:(e=c,"g"===e.tag?e.children:[e])},g]};return n.push(_,{tag:"rect",attributes:_y({fill:"currentColor","clip-path":"url(#".concat(m,")"),mask:"url(#".concat(f,")")},rx)}),{children:n,attributes:r}}}},{provides:function(t){var e=!1;Oy.matchMedia&&(e=Oy.matchMedia("(prefers-reduced-motion: reduce)").matches),t.missingIconAbstract=function(){var t=[],n={fill:"currentColor"},r={attributeType:"XML",repeatCount:"indefinite",dur:"2s"};t.push({tag:"path",attributes:_y(_y({},n),{},{d:"M156.5,447.7l-12.6,29.5c-18.7-9.5-35.9-21.2-51.5-34.9l22.7-22.7C127.6,430.5,141.5,440,156.5,447.7z M40.6,272H8.5 c1.4,21.2,5.4,41.7,11.7,61.1L50,321.2C45.1,305.5,41.8,289,40.6,272z M40.6,240c1.4-18.8,5.2-37,11.1-54.1l-29.5-12.6 C14.7,194.3,10,216.7,8.5,240H40.6z M64.3,156.5c7.8-14.9,17.2-28.8,28.1-41.5L69.7,92.3c-13.7,15.6-25.5,32.8-34.9,51.5 L64.3,156.5z M397,419.6c-13.9,12-29.4,22.3-46.1,30.4l11.9,29.8c20.7-9.9,39.8-22.6,56.9-37.6L397,419.6z M115,92.4 c13.9-12,29.4-22.3,46.1-30.4l-11.9-29.8c-20.7,9.9-39.8,22.6-56.8,37.6L115,92.4z M447.7,355.5c-7.8,14.9-17.2,28.8-28.1,41.5 l22.7,22.7c13.7-15.6,25.5-32.9,34.9-51.5L447.7,355.5z M471.4,272c-1.4,18.8-5.2,37-11.1,54.1l29.5,12.6 c7.5-21.1,12.2-43.5,13.6-66.8H471.4z M321.2,462c-15.7,5-32.2,8.2-49.2,9.4v32.1c21.2-1.4,41.7-5.4,61.1-11.7L321.2,462z M240,471.4c-18.8-1.4-37-5.2-54.1-11.1l-12.6,29.5c21.1,7.5,43.5,12.2,66.8,13.6V471.4z M462,190.8c5,15.7,8.2,32.2,9.4,49.2h32.1 c-1.4-21.2-5.4-41.7-11.7-61.1L462,190.8z M92.4,397c-12-13.9-22.3-29.4-30.4-46.1l-29.8,11.9c9.9,20.7,22.6,39.8,37.6,56.9 L92.4,397z M272,40.6c18.8,1.4,36.9,5.2,54.1,11.1l12.6-29.5C317.7,14.7,295.3,10,272,8.5V40.6z M190.8,50 c15.7-5,32.2-8.2,49.2-9.4V8.5c-21.2,1.4-41.7,5.4-61.1,11.7L190.8,50z M442.3,92.3L419.6,115c12,13.9,22.3,29.4,30.5,46.1 l29.8-11.9C470,128.5,457.3,109.4,442.3,92.3z M397,92.4l22.7-22.7c-15.6-13.7-32.8-25.5-51.5-34.9l-12.6,29.5 C370.4,72.1,384.4,81.5,397,92.4z"})});var i=_y(_y({},r),{},{attributeName:"opacity"}),o={tag:"circle",attributes:_y(_y({},n),{},{cx:"256",cy:"364",r:"28"}),children:[]};return e||o.children.push({tag:"animate",attributes:_y(_y({},r),{},{attributeName:"r",values:"28;14;28;28;14;28;"})},{tag:"animate",attributes:_y(_y({},i),{},{values:"1;0;1;1;0;1;"})}),t.push(o),t.push({tag:"path",attributes:_y(_y({},n),{},{opacity:"1",d:"M263.7,312h-16c-6.6,0-12-5.4-12-12c0-71,77.4-63.9,77.4-107.8c0-20-17.8-40.2-57.4-40.2c-29.1,0-44.3,9.6-59.2,28.7 c-3.9,5-11.1,6-16.2,2.4l-13.1-9.2c-5.6-3.9-6.9-11.8-2.6-17.2c21.2-27.2,46.4-44.7,91.2-44.7c52.3,0,97.4,29.8,97.4,80.2 c0,67.6-77.4,63.5-77.4,107.8C275.7,306.6,270.3,312,263.7,312z"}),children:e?[]:[{tag:"animate",attributes:_y(_y({},i),{},{values:"1;0;0;0;0;1;"})}]}),e||t.push({tag:"path",attributes:_y(_y({},n),{},{opacity:"0",d:"M232.5,134.5l7,168c0.3,6.4,5.6,11.5,12,11.5h9c6.4,0,11.7-5.1,12-11.5l7-168c0.3-6.8-5.2-12.5-12-12.5h-23 C237.7,122,232.2,127.7,232.5,134.5z"}),children:[{tag:"animate",attributes:_y(_y({},i),{},{values:"0;0;1;1;0;0;"})}]}),{tag:"g",attributes:{class:"missing"},children:t}}}},{hooks:function(){return{parseNodeAttributes:function(t,e){var n=e.getAttribute("data-fa-symbol");return t.symbol=null!==n&&(""===n||n),t}}}}],Jv={},Object.keys(tb).forEach(function(t){-1===eb.indexOf(t)&&delete tb[t]}),Qv.forEach(function(t){var e=t.mixout?t.mixout():{};if(Object.keys(e).forEach(function(t){"function"==typeof e[t]&&(tx[t]=e[t]),"object"===yy(e[t])&&Object.keys(e[t]).forEach(function(n){tx[t]||(tx[t]={}),tx[t][n]=e[t][n]})}),t.hooks){var n=t.hooks();Object.keys(n).forEach(function(t){Jv[t]||(Jv[t]=[]),Jv[t].push(n[t])})}t.provides&&t.provides(tb)});let ox=(()=>{class t{}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)}}),t})();class sx extends qt.a{constructor(t){super(),this._value=t}get value(){return this.getValue()}_subscribe(t){const e=super._subscribe(t);return e&&!e.closed&&t.next(this._value),e}getValue(){if(this.hasError)throw this.thrownError;if(this.closed)throw new Ht.a;return this._value}next(t){super.next(this._value=t)}}var ax=n("DH7j"),cx=n("yCtX");const lx={};class ux{constructor(t){this.resultSelector=t}call(t,e){return e.subscribe(new hx(t,this.resultSelector))}}class hx extends Nt{constructor(t,e){super(t),this.resultSelector=e,this.active=0,this.values=[],this.observables=[]}_next(t){this.values.push(lx),this.observables.push(t)}_complete(){const t=this.observables,e=t.length;if(0===e)this.destination.complete();else{this.active=e,this.toRespond=e;for(let n=0;n<e;n++)this.add(zt(this,t[n],void 0,n))}}notifyComplete(t){0==(this.active-=1)&&this.destination.complete()}notifyNext(t,e,n){const r=this.values,i=this.toRespond?r[n]===lx?--this.toRespond:this.toRespond:0;r[n]=e,0===i&&(this.resultSelector?this._tryResultSelector(r):this.destination.next(r.slice()))}_tryResultSelector(t){let e;try{e=this.resultSelector.apply(this,t)}catch(n){return void this.destination.error(n)}this.destination.next(e)}}function dx(t){return new yt.a(e=>{let n;try{n=t()}catch(r){return void e.error(r)}return(n?Object(Tt.a)(n):Object(re.b)()).subscribe(e)})}function px(t){return function(e){const n=new fx(t),r=e.lift(n);return n.caught=r}}class fx{constructor(t){this.selector=t}call(t,e){return e.subscribe(new mx(t,this.selector,this.caught))}}class mx extends Ct.b{constructor(t,e,n){super(t),this.selector=e,this.caught=n}error(t){if(!this.isStopped){let n;try{n=this.selector(t,this.caught)}catch(e){return void super.error(e)}this._unsubscribeAndRecycle();const r=new Ct.a(this);this.add(r);const i=Object(Ct.c)(n,r);i!==r&&this.add(i)}}}var gx=n("5+tZ");function _x(t,e){return Object(gx.a)(t,e,1)}function yx(t){return function(e){return 0===t?Object(re.b)():e.lift(new vx(t))}}class vx{constructor(t){if(this.total=t,this.total<0)throw new ne}call(t,e){return e.subscribe(new bx(t,this.total))}}class bx extends kt.a{constructor(t,e){super(t),this.total=e,this.ring=new Array,this.count=0}_next(t){const e=this.ring,n=this.total,r=this.count++;e.length<n?e.push(t):e[r%n]=t}_complete(){const t=this.destination;let e=this.count;if(e>0){const n=this.count>=this.total?this.total:this.count,r=this.ring;for(let i=0;i<n;i++){const i=e++%n;t.next(r[i])}}t.complete()}}var xx=n("vkgz");class wx{constructor(t){this.callback=t}call(t,e){return e.subscribe(new Tx(t,this.callback))}}class Tx extends kt.a{constructor(t,e){super(t),this.add(new Wt.a(e))}}class Cx{constructor(t,e){this.id=t,this.url=e}}class Ex extends Cx{constructor(t,e,n="imperative",r=null){super(t,e),this.navigationTrigger=n,this.restoredState=r}toString(){return`NavigationStart(id: ${this.id}, url: '${this.url}')`}}class Sx extends Cx{constructor(t,e,n){super(t,e),this.urlAfterRedirects=n}toString(){return`NavigationEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}')`}}class Ix extends Cx{constructor(t,e,n){super(t,e),this.reason=n}toString(){return`NavigationCancel(id: ${this.id}, url: '${this.url}')`}}class kx extends Cx{constructor(t,e,n){super(t,e),this.error=n}toString(){return`NavigationError(id: ${this.id}, url: '${this.url}', error: ${this.error})`}}class Ax extends Cx{constructor(t,e,n,r){super(t,e),this.urlAfterRedirects=n,this.state=r}toString(){return`RoutesRecognized(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Mx extends Cx{constructor(t,e,n,r){super(t,e),this.urlAfterRedirects=n,this.state=r}toString(){return`GuardsCheckStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Ox extends Cx{constructor(t,e,n,r,i){super(t,e),this.urlAfterRedirects=n,this.state=r,this.shouldActivate=i}toString(){return`GuardsCheckEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state}, shouldActivate: ${this.shouldActivate})`}}class Px extends Cx{constructor(t,e,n,r){super(t,e),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveStart(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Dx extends Cx{constructor(t,e,n,r){super(t,e),this.urlAfterRedirects=n,this.state=r}toString(){return`ResolveEnd(id: ${this.id}, url: '${this.url}', urlAfterRedirects: '${this.urlAfterRedirects}', state: ${this.state})`}}class Rx{constructor(t){this.route=t}toString(){return`RouteConfigLoadStart(path: ${this.route.path})`}}class Nx{constructor(t){this.route=t}toString(){return`RouteConfigLoadEnd(path: ${this.route.path})`}}class Lx{constructor(t){this.snapshot=t}toString(){return`ChildActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class jx{constructor(t){this.snapshot=t}toString(){return`ChildActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class zx{constructor(t){this.snapshot=t}toString(){return`ActivationStart(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Fx{constructor(t){this.snapshot=t}toString(){return`ActivationEnd(path: '${this.snapshot.routeConfig&&this.snapshot.routeConfig.path||""}')`}}class Bx{constructor(t,e,n){this.routerEvent=t,this.position=e,this.anchor=n}toString(){return`Scroll(anchor: '${this.anchor}', position: '${this.position?`${this.position[0]}, ${this.position[1]}`:null}')`}}const Ux="primary";class Vx{constructor(t){this.params=t||{}}has(t){return Object.prototype.hasOwnProperty.call(this.params,t)}get(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e[0]:e}return null}getAll(t){if(this.has(t)){const e=this.params[t];return Array.isArray(e)?e:[e]}return[]}get keys(){return Object.keys(this.params)}}function qx(t){return new Vx(t)}function Gx(t){const e=Error("NavigationCancelingError: "+t);return e.ngNavigationCancelingError=!0,e}function $x(t,e,n){const r=n.path.split("/");if(r.length>t.length)return null;if("full"===n.pathMatch&&(e.hasChildren()||r.length<t.length))return null;const i={};for(let o=0;o<r.length;o++){const e=r[o],n=t[o];if(e.startsWith(":"))i[e.substring(1)]=n;else if(e!==n.path)return null}return{consumed:t.slice(0,r.length),posParams:i}}function Wx(t,e){const n=t?Object.keys(t):void 0,r=e?Object.keys(e):void 0;if(!n||!r||n.length!=r.length)return!1;let i;for(let o=0;o<n.length;o++)if(i=n[o],!Hx(t[i],e[i]))return!1;return!0}function Hx(t,e){if(Array.isArray(t)&&Array.isArray(e)){if(t.length!==e.length)return!1;const n=[...t].sort(),r=[...e].sort();return n.every((t,e)=>r[e]===t)}return t===e}function Zx(t){return Array.prototype.concat.apply([],t)}function Kx(t){return t.length>0?t[t.length-1]:null}function Xx(t,e){for(const n in t)t.hasOwnProperty(n)&&e(t[n],n)}function Yx(t){return Object(r.qb)(t)?t:Object(r.rb)(t)?Object(Tt.a)(Promise.resolve(t)):Object(vt.a)(t)}function Qx(t,e,n){return n?function(t,e){return Wx(t,e)}(t.queryParams,e.queryParams)&&Jx(t.root,e.root):function(t,e){return Object.keys(e).length<=Object.keys(t).length&&Object.keys(e).every(n=>Hx(t[n],e[n]))}(t.queryParams,e.queryParams)&&tw(t.root,e.root)}function Jx(t,e){if(!ow(t.segments,e.segments))return!1;if(t.numberOfChildren!==e.numberOfChildren)return!1;for(const n in e.children){if(!t.children[n])return!1;if(!Jx(t.children[n],e.children[n]))return!1}return!0}function tw(t,e){return ew(t,e,e.segments)}function ew(t,e,n){if(t.segments.length>n.length)return!!ow(t.segments.slice(0,n.length),n)&&!e.hasChildren();if(t.segments.length===n.length){if(!ow(t.segments,n))return!1;for(const n in e.children){if(!t.children[n])return!1;if(!tw(t.children[n],e.children[n]))return!1}return!0}{const r=n.slice(0,t.segments.length),i=n.slice(t.segments.length);return!!ow(t.segments,r)&&!!t.children.primary&&ew(t.children.primary,e,i)}}class nw{constructor(t,e,n){this.root=t,this.queryParams=e,this.fragment=n}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=qx(this.queryParams)),this._queryParamMap}toString(){return cw.serialize(this)}}class rw{constructor(t,e){this.segments=t,this.children=e,this.parent=null,Xx(e,(t,e)=>t.parent=this)}hasChildren(){return this.numberOfChildren>0}get numberOfChildren(){return Object.keys(this.children).length}toString(){return lw(this)}}class iw{constructor(t,e){this.path=t,this.parameters=e}get parameterMap(){return this._parameterMap||(this._parameterMap=qx(this.parameters)),this._parameterMap}toString(){return gw(this)}}function ow(t,e){return t.length===e.length&&t.every((t,n)=>t.path===e[n].path)}class sw{}class aw{parse(t){const e=new xw(t);return new nw(e.parseRootSegment(),e.parseQueryParams(),e.parseFragment())}serialize(t){var e;return`/${uw(t.root,!0)}${function(t){const e=Object.keys(t).map(e=>{const n=t[e];return Array.isArray(n)?n.map(t=>`${dw(e)}=${dw(t)}`).join("&"):`${dw(e)}=${dw(n)}`});return e.length?`?${e.join("&")}`:""}(t.queryParams)}${"string"==typeof t.fragment?`#${e=t.fragment,encodeURI(e)}`:""}`}}const cw=new aw;function lw(t){return t.segments.map(t=>gw(t)).join("/")}function uw(t,e){if(!t.hasChildren())return lw(t);if(e){const e=t.children.primary?uw(t.children.primary,!1):"",n=[];return Xx(t.children,(t,e)=>{e!==Ux&&n.push(`${e}:${uw(t,!1)}`)}),n.length>0?`${e}(${n.join("//")})`:e}{const e=function(t,e){let n=[];return Xx(t.children,(t,r)=>{r===Ux&&(n=n.concat(e(t,r)))}),Xx(t.children,(t,r)=>{r!==Ux&&(n=n.concat(e(t,r)))}),n}(t,(e,n)=>n===Ux?[uw(t.children.primary,!1)]:[`${n}:${uw(e,!1)}`]);return 1===Object.keys(t.children).length&&null!=t.children.primary?`${lw(t)}/${e[0]}`:`${lw(t)}/(${e.join("//")})`}}function hw(t){return encodeURIComponent(t).replace(/%40/g,"@").replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",")}function dw(t){return hw(t).replace(/%3B/gi,";")}function pw(t){return hw(t).replace(/\(/g,"%28").replace(/\)/g,"%29").replace(/%26/gi,"&")}function fw(t){return decodeURIComponent(t)}function mw(t){return fw(t.replace(/\+/g,"%20"))}function gw(t){return`${pw(t.path)}${e=t.parameters,Object.keys(e).map(t=>`;${pw(t)}=${pw(e[t])}`).join("")}`;var e}const _w=/^[^\/()?;=#]+/;function yw(t){const e=t.match(_w);return e?e[0]:""}const vw=/^[^=?&#]+/,bw=/^[^?&#]+/;class xw{constructor(t){this.url=t,this.remaining=t}parseRootSegment(){return this.consumeOptional("/"),""===this.remaining||this.peekStartsWith("?")||this.peekStartsWith("#")?new rw([],{}):new rw([],this.parseChildren())}parseQueryParams(){const t={};if(this.consumeOptional("?"))do{this.parseQueryParam(t)}while(this.consumeOptional("&"));return t}parseFragment(){return this.consumeOptional("#")?decodeURIComponent(this.remaining):null}parseChildren(){if(""===this.remaining)return{};this.consumeOptional("/");const t=[];for(this.peekStartsWith("(")||t.push(this.parseSegment());this.peekStartsWith("/")&&!this.peekStartsWith("//")&&!this.peekStartsWith("/(");)this.capture("/"),t.push(this.parseSegment());let e={};this.peekStartsWith("/(")&&(this.capture("/"),e=this.parseParens(!0));let n={};return this.peekStartsWith("(")&&(n=this.parseParens(!1)),(t.length>0||Object.keys(e).length>0)&&(n.primary=new rw(t,e)),n}parseSegment(){const t=yw(this.remaining);if(""===t&&this.peekStartsWith(";"))throw new Error(`Empty path url segment cannot have parameters: '${this.remaining}'.`);return this.capture(t),new iw(fw(t),this.parseMatrixParams())}parseMatrixParams(){const t={};for(;this.consumeOptional(";");)this.parseParam(t);return t}parseParam(t){const e=yw(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){const t=yw(this.remaining);t&&(n=t,this.capture(n))}t[fw(e)]=fw(n)}parseQueryParam(t){const e=function(t){const e=t.match(vw);return e?e[0]:""}(this.remaining);if(!e)return;this.capture(e);let n="";if(this.consumeOptional("=")){const t=function(t){const e=t.match(bw);return e?e[0]:""}(this.remaining);t&&(n=t,this.capture(n))}const r=mw(e),i=mw(n);if(t.hasOwnProperty(r)){let e=t[r];Array.isArray(e)||(e=[e],t[r]=e),e.push(i)}else t[r]=i}parseParens(t){const e={};for(this.capture("(");!this.consumeOptional(")")&&this.remaining.length>0;){const n=yw(this.remaining),r=this.remaining[n.length];if("/"!==r&&")"!==r&&";"!==r)throw new Error(`Cannot parse url '${this.url}'`);let i;n.indexOf(":")>-1?(i=n.substr(0,n.indexOf(":")),this.capture(i),this.capture(":")):t&&(i=Ux);const o=this.parseChildren();e[i]=1===Object.keys(o).length?o.primary:new rw([],o),this.consumeOptional("//")}return e}peekStartsWith(t){return this.remaining.startsWith(t)}consumeOptional(t){return!!this.peekStartsWith(t)&&(this.remaining=this.remaining.substring(t.length),!0)}capture(t){if(!this.consumeOptional(t))throw new Error(`Expected "${t}".`)}}class ww{constructor(t){this._root=t}get root(){return this._root.value}parent(t){const e=this.pathFromRoot(t);return e.length>1?e[e.length-2]:null}children(t){const e=Tw(t,this._root);return e?e.children.map(t=>t.value):[]}firstChild(t){const e=Tw(t,this._root);return e&&e.children.length>0?e.children[0].value:null}siblings(t){const e=Cw(t,this._root);return e.length<2?[]:e[e.length-2].children.map(t=>t.value).filter(e=>e!==t)}pathFromRoot(t){return Cw(t,this._root).map(t=>t.value)}}function Tw(t,e){if(t===e.value)return e;for(const n of e.children){const e=Tw(t,n);if(e)return e}return null}function Cw(t,e){if(t===e.value)return[e];for(const n of e.children){const r=Cw(t,n);if(r.length)return r.unshift(e),r}return[]}class Ew{constructor(t,e){this.value=t,this.children=e}toString(){return`TreeNode(${this.value})`}}function Sw(t){const e={};return t&&t.children.forEach(t=>e[t.value.outlet]=t),e}class Iw extends ww{constructor(t,e){super(t),this.snapshot=e,Dw(this,t)}toString(){return this.snapshot.toString()}}function kw(t,e){const n=function(t,e){const n=new Ow([],{},{},"",{},Ux,e,null,t.root,-1,{});return new Pw("",new Ew(n,[]))}(t,e),r=new sx([new iw("",{})]),i=new sx({}),o=new sx({}),s=new sx({}),a=new sx(""),c=new Aw(r,i,s,a,o,Ux,e,n.root);return c.snapshot=n.root,new Iw(new Ew(c,[]),n)}class Aw{constructor(t,e,n,r,i,o,s,a){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=o,this.component=s,this._futureSnapshot=a}get routeConfig(){return this._futureSnapshot.routeConfig}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=this.params.pipe(Object(xt.a)(t=>qx(t)))),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=this.queryParams.pipe(Object(xt.a)(t=>qx(t)))),this._queryParamMap}toString(){return this.snapshot?this.snapshot.toString():`Future(${this._futureSnapshot})`}}function Mw(t,e="emptyOnly"){const n=t.pathFromRoot;let r=0;if("always"!==e)for(r=n.length-1;r>=1;){const t=n[r],e=n[r-1];if(t.routeConfig&&""===t.routeConfig.path)r--;else{if(e.component)break;r--}}return function(t){return t.reduce((t,e)=>({params:Object.assign(Object.assign({},t.params),e.params),data:Object.assign(Object.assign({},t.data),e.data),resolve:Object.assign(Object.assign({},t.resolve),e._resolvedData)}),{params:{},data:{},resolve:{}})}(n.slice(r))}class Ow{constructor(t,e,n,r,i,o,s,a,c,l,u){this.url=t,this.params=e,this.queryParams=n,this.fragment=r,this.data=i,this.outlet=o,this.component=s,this.routeConfig=a,this._urlSegment=c,this._lastPathIndex=l,this._resolve=u}get root(){return this._routerState.root}get parent(){return this._routerState.parent(this)}get firstChild(){return this._routerState.firstChild(this)}get children(){return this._routerState.children(this)}get pathFromRoot(){return this._routerState.pathFromRoot(this)}get paramMap(){return this._paramMap||(this._paramMap=qx(this.params)),this._paramMap}get queryParamMap(){return this._queryParamMap||(this._queryParamMap=qx(this.queryParams)),this._queryParamMap}toString(){return`Route(url:'${this.url.map(t=>t.toString()).join("/")}', path:'${this.routeConfig?this.routeConfig.path:""}')`}}class Pw extends ww{constructor(t,e){super(e),this.url=t,Dw(this,e)}toString(){return Rw(this._root)}}function Dw(t,e){e.value._routerState=t,e.children.forEach(e=>Dw(t,e))}function Rw(t){const e=t.children.length>0?` { ${t.children.map(Rw).join(", ")} } `:"";return`${t.value}${e}`}function Nw(t){if(t.snapshot){const e=t.snapshot,n=t._futureSnapshot;t.snapshot=n,Wx(e.queryParams,n.queryParams)||t.queryParams.next(n.queryParams),e.fragment!==n.fragment&&t.fragment.next(n.fragment),Wx(e.params,n.params)||t.params.next(n.params),function(t,e){if(t.length!==e.length)return!1;for(let n=0;n<t.length;++n)if(!Wx(t[n],e[n]))return!1;return!0}(e.url,n.url)||t.url.next(n.url),Wx(e.data,n.data)||t.data.next(n.data)}else t.snapshot=t._futureSnapshot,t.data.next(t._futureSnapshot.data)}function Lw(t,e){return Wx(t.params,e.params)&&function(t,e){return ow(t,e)&&t.every((t,n)=>Wx(t.parameters,e[n].parameters))}(t.url,e.url)&&!(!t.parent!=!e.parent)&&(!t.parent||Lw(t.parent,e.parent))}function jw(t,e,n){if(n&&t.shouldReuseRoute(e.value,n.value.snapshot)){const r=n.value;r._futureSnapshot=e.value;const i=function(t,e,n){return e.children.map(e=>{for(const r of n.children)if(t.shouldReuseRoute(e.value,r.value.snapshot))return jw(t,e,r);return jw(t,e)})}(t,e,n);return new Ew(r,i)}{const n=t.retrieve(e.value);if(n){const t=n.route;return zw(e,t),t}{const n=new Aw(new sx((r=e.value).url),new sx(r.params),new sx(r.queryParams),new sx(r.fragment),new sx(r.data),r.outlet,r.component,r),i=e.children.map(e=>jw(t,e));return new Ew(n,i)}}var r}function zw(t,e){if(t.value.routeConfig!==e.value.routeConfig)throw new Error("Cannot reattach ActivatedRouteSnapshot created from a different route");if(t.children.length!==e.children.length)throw new Error("Cannot reattach ActivatedRouteSnapshot with a different number of children");e.value._futureSnapshot=t.value;for(let n=0;n<t.children.length;++n)zw(t.children[n],e.children[n])}function Fw(t){return"object"==typeof t&&null!=t&&!t.outlets&&!t.segmentPath}function Bw(t){return"object"==typeof t&&null!=t&&t.outlets}function Uw(t,e,n,r,i){let o={};return r&&Xx(r,(t,e)=>{o[e]=Array.isArray(t)?t.map(t=>`${t}`):`${t}`}),new nw(n.root===t?e:Vw(n.root,t,e),o,i)}function Vw(t,e,n){const r={};return Xx(t.children,(t,i)=>{r[i]=t===e?n:Vw(t,e,n)}),new rw(t.segments,r)}class qw{constructor(t,e,n){if(this.isAbsolute=t,this.numberOfDoubleDots=e,this.commands=n,t&&n.length>0&&Fw(n[0]))throw new Error("Root segment cannot have matrix parameters");const r=n.find(Bw);if(r&&r!==Kx(n))throw new Error("{outlets:{}} has to be the last command")}toRoot(){return this.isAbsolute&&1===this.commands.length&&"/"==this.commands[0]}}class Gw{constructor(t,e,n){this.segmentGroup=t,this.processChildren=e,this.index=n}}function $w(t,e,n){if(t||(t=new rw([],{})),0===t.segments.length&&t.hasChildren())return Ww(t,e,n);const r=function(t,e,n){let r=0,i=e;const o={match:!1,pathIndex:0,commandIndex:0};for(;i<t.segments.length;){if(r>=n.length)return o;const e=t.segments[i],s=n[r];if(Bw(s))break;const a=`${s}`,c=r<n.length-1?n[r+1]:null;if(i>0&&void 0===a)break;if(a&&c&&"object"==typeof c&&void 0===c.outlets){if(!Xw(a,c,e))return o;r+=2}else{if(!Xw(a,{},e))return o;r++}i++}return{match:!0,pathIndex:i,commandIndex:r}}(t,e,n),i=n.slice(r.commandIndex);if(r.match&&r.pathIndex<t.segments.length){const e=new rw(t.segments.slice(0,r.pathIndex),{});return e.children.primary=new rw(t.segments.slice(r.pathIndex),t.children),Ww(e,0,i)}return r.match&&0===i.length?new rw(t.segments,{}):r.match&&!t.hasChildren()?Hw(t,e,n):r.match?Ww(t,0,i):Hw(t,e,n)}function Ww(t,e,n){if(0===n.length)return new rw(t.segments,{});{const r=function(t){return Bw(t[0])?t[0].outlets:{[Ux]:t}}(n),i={};return Xx(r,(n,r)=>{"string"==typeof n&&(n=[n]),null!==n&&(i[r]=$w(t.children[r],e,n))}),Xx(t.children,(t,e)=>{void 0===r[e]&&(i[e]=t)}),new rw(t.segments,i)}}function Hw(t,e,n){const r=t.segments.slice(0,e);let i=0;for(;i<n.length;){const o=n[i];if(Bw(o)){const t=Zw(o.outlets);return new rw(r,t)}if(0===i&&Fw(n[0])){r.push(new iw(t.segments[e].path,Kw(n[0]))),i++;continue}const s=Bw(o)?o.outlets.primary:`${o}`,a=i<n.length-1?n[i+1]:null;s&&a&&Fw(a)?(r.push(new iw(s,Kw(a))),i+=2):(r.push(new iw(s,{})),i++)}return new rw(r,{})}function Zw(t){const e={};return Xx(t,(t,n)=>{"string"==typeof t&&(t=[t]),null!==t&&(e[n]=Hw(new rw([],{}),0,t))}),e}function Kw(t){const e={};return Xx(t,(t,n)=>e[n]=`${t}`),e}function Xw(t,e,n){return t==n.path&&Wx(e,n.parameters)}class Yw{constructor(t,e,n,r){this.routeReuseStrategy=t,this.futureState=e,this.currState=n,this.forwardEvent=r}activate(t){const e=this.futureState._root,n=this.currState?this.currState._root:null;this.deactivateChildRoutes(e,n,t),Nw(this.futureState.root),this.activateChildRoutes(e,n,t)}deactivateChildRoutes(t,e,n){const r=Sw(e);t.children.forEach(t=>{const e=t.value.outlet;this.deactivateRoutes(t,r[e],n),delete r[e]}),Xx(r,(t,e)=>{this.deactivateRouteAndItsChildren(t,n)})}deactivateRoutes(t,e,n){const r=t.value,i=e?e.value:null;if(r===i)if(r.component){const i=n.getContext(r.outlet);i&&this.deactivateChildRoutes(t,e,i.children)}else this.deactivateChildRoutes(t,e,n);else i&&this.deactivateRouteAndItsChildren(e,n)}deactivateRouteAndItsChildren(t,e){this.routeReuseStrategy.shouldDetach(t.value.snapshot)?this.detachAndStoreRouteSubtree(t,e):this.deactivateRouteAndOutlet(t,e)}detachAndStoreRouteSubtree(t,e){const n=e.getContext(t.value.outlet);if(n&&n.outlet){const e=n.outlet.detach(),r=n.children.onOutletDeactivated();this.routeReuseStrategy.store(t.value.snapshot,{componentRef:e,route:t,contexts:r})}}deactivateRouteAndOutlet(t,e){const n=e.getContext(t.value.outlet),r=n&&t.value.component?n.children:e,i=Sw(t);for(const o of Object.keys(i))this.deactivateRouteAndItsChildren(i[o],r);n&&n.outlet&&(n.outlet.deactivate(),n.children.onOutletDeactivated())}activateChildRoutes(t,e,n){const r=Sw(e);t.children.forEach(t=>{this.activateRoutes(t,r[t.value.outlet],n),this.forwardEvent(new Fx(t.value.snapshot))}),t.children.length&&this.forwardEvent(new jx(t.value.snapshot))}activateRoutes(t,e,n){const r=t.value,i=e?e.value:null;if(Nw(r),r===i)if(r.component){const i=n.getOrCreateContext(r.outlet);this.activateChildRoutes(t,e,i.children)}else this.activateChildRoutes(t,e,n);else if(r.component){const e=n.getOrCreateContext(r.outlet);if(this.routeReuseStrategy.shouldAttach(r.snapshot)){const t=this.routeReuseStrategy.retrieve(r.snapshot);this.routeReuseStrategy.store(r.snapshot,null),e.children.onOutletReAttached(t.contexts),e.attachRef=t.componentRef,e.route=t.route.value,e.outlet&&e.outlet.attach(t.componentRef,t.route.value),Qw(t.route)}else{const n=function(t){for(let e=t.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig;if(t&&t.component)return null}return null}(r.snapshot),i=n?n.module.componentFactoryResolver:null;e.attachRef=null,e.route=r,e.resolver=i,e.outlet&&e.outlet.activateWith(r,i),this.activateChildRoutes(t,null,e.children)}}else this.activateChildRoutes(t,null,n)}}function Qw(t){Nw(t.value),t.children.forEach(Qw)}class Jw{constructor(t,e){this.routes=t,this.module=e}}function tT(t){return"function"==typeof t}function eT(t){return t instanceof nw}const nT=Symbol("INITIAL_VALUE");function rT(){return Et(t=>function(...t){let e,n;return Object(Ir.a)(t[t.length-1])&&(n=t.pop()),"function"==typeof t[t.length-1]&&(e=t.pop()),1===t.length&&Object(ax.a)(t[0])&&(t=t[0]),Object(cx.a)(t,n).lift(new ux(e))}(t.map(t=>t.pipe(ie(1),kr(nT)))).pipe(At((t,e)=>{let n=!1;return e.reduce((t,r,i)=>{if(t!==nT)return t;if(r===nT&&(n=!0),!n){if(!1===r)return r;if(i===e.length-1||eT(r))return r}return t},t)},nT),Jt(t=>t!==nT),Object(xt.a)(t=>eT(t)?t:!0===t),ie(1)))}let iT=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=r.Eb({type:t,selectors:[["ng-component"]],decls:1,vars:0,template:function(t,e){1&t&&r.Lb(0,"router-outlet")},directives:function(){return[YT]},encapsulation:2}),t})();function oT(t,e=""){for(let n=0;n<t.length;n++){const r=t[n];sT(r,aT(e,r))}}function sT(t,e){t.children&&oT(t.children,e)}function aT(t,e){return e?t||e.path?t&&!e.path?`${t}/`:!t&&e.path?e.path:`${t}/${e.path}`:"":t}function cT(t){const e=t.children&&t.children.map(cT),n=e?Object.assign(Object.assign({},t),{children:e}):Object.assign({},t);return!n.component&&(e||n.loadChildren)&&n.outlet&&n.outlet!==Ux&&(n.component=iT),n}function lT(t){return t.outlet||Ux}function uT(t,e){const n=t.filter(t=>lT(t)===e);return n.push(...t.filter(t=>lT(t)!==e)),n}const hT={matched:!1,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};function dT(t,e,n){var r;if(""===e.path)return"full"===e.pathMatch&&(t.hasChildren()||n.length>0)?Object.assign({},hT):{matched:!0,consumedSegments:[],lastChild:0,parameters:{},positionalParamSegments:{}};const i=(e.matcher||$x)(n,t,e);if(!i)return Object.assign({},hT);const o={};Xx(i.posParams,(t,e)=>{o[e]=t.path});const s=i.consumed.length>0?Object.assign(Object.assign({},o),i.consumed[i.consumed.length-1].parameters):o;return{matched:!0,consumedSegments:i.consumed,lastChild:i.consumed.length,parameters:s,positionalParamSegments:null!==(r=i.posParams)&&void 0!==r?r:{}}}function pT(t,e,n,r,i="corrected"){if(n.length>0&&function(t,e,n){return n.some(n=>fT(t,e,n)&&lT(n)!==Ux)}(t,n,r)){const i=new rw(e,function(t,e,n,r){const i={};i.primary=r,r._sourceSegment=t,r._segmentIndexShift=e.length;for(const o of n)if(""===o.path&&lT(o)!==Ux){const n=new rw([],{});n._sourceSegment=t,n._segmentIndexShift=e.length,i[lT(o)]=n}return i}(t,e,r,new rw(n,t.children)));return i._sourceSegment=t,i._segmentIndexShift=e.length,{segmentGroup:i,slicedSegments:[]}}if(0===n.length&&function(t,e,n){return n.some(n=>fT(t,e,n))}(t,n,r)){const o=new rw(t.segments,function(t,e,n,r,i,o){const s={};for(const a of r)if(fT(t,n,a)&&!i[lT(a)]){const n=new rw([],{});n._sourceSegment=t,n._segmentIndexShift="legacy"===o?t.segments.length:e.length,s[lT(a)]=n}return Object.assign(Object.assign({},i),s)}(t,e,n,r,t.children,i));return o._sourceSegment=t,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:n}}const o=new rw(t.segments,t.children);return o._sourceSegment=t,o._segmentIndexShift=e.length,{segmentGroup:o,slicedSegments:n}}function fT(t,e,n){return(!(t.hasChildren()||e.length>0)||"full"!==n.pathMatch)&&""===n.path}function mT(t,e,n,r){return!!(lT(t)===r||r!==Ux&&fT(e,n,t))&&("**"===t.path||dT(e,t,n).matched)}function gT(t,e,n){return 0===e.length&&!t.children[n]}class _T{constructor(t){this.segmentGroup=t||null}}class yT{constructor(t){this.urlTree=t}}function vT(t){return new yt.a(e=>e.error(new _T(t)))}function bT(t){return new yt.a(e=>e.error(new yT(t)))}function xT(t){return new yt.a(e=>e.error(new Error(`Only absolute redirects can have named outlets. redirectTo: '${t}'`)))}class wT{constructor(t,e,n,i,o){this.configLoader=e,this.urlSerializer=n,this.urlTree=i,this.config=o,this.allowRedirects=!0,this.ngModule=t.get(r.y)}apply(){const t=pT(this.urlTree.root,[],[],this.config).segmentGroup,e=new rw(t.segments,t.children);return this.expandSegmentGroup(this.ngModule,this.config,e,Ux).pipe(Object(xt.a)(t=>this.createUrlTree(TT(t),this.urlTree.queryParams,this.urlTree.fragment))).pipe(px(t=>{if(t instanceof yT)return this.allowRedirects=!1,this.match(t.urlTree);if(t instanceof _T)throw this.noMatchError(t);throw t}))}match(t){return this.expandSegmentGroup(this.ngModule,this.config,t.root,Ux).pipe(Object(xt.a)(e=>this.createUrlTree(TT(e),t.queryParams,t.fragment))).pipe(px(t=>{if(t instanceof _T)throw this.noMatchError(t);throw t}))}noMatchError(t){return new Error(`Cannot match any routes. URL Segment: '${t.segmentGroup}'`)}createUrlTree(t,e,n){const r=t.segments.length>0?new rw([],{[Ux]:t}):t;return new nw(r,e,n)}expandSegmentGroup(t,e,n,r){return 0===n.segments.length&&n.hasChildren()?this.expandChildren(t,e,n).pipe(Object(xt.a)(t=>new rw([],t))):this.expandSegment(t,n,e,n.segments,r,!0)}expandChildren(t,e,n){const r=[];for(const i of Object.keys(n.children))"primary"===i?r.unshift(i):r.push(i);return Object(Tt.a)(r).pipe(_x(r=>{const i=n.children[r],o=uT(e,r);return this.expandSegmentGroup(t,o,i,r).pipe(Object(xt.a)(t=>({segment:t,outlet:r})))}),At((t,e)=>(t[e.outlet]=e.segment,t),{}),function(t,e){const n=arguments.length>=2;return r=>r.pipe(t?Jt((e,n)=>t(e,n,r)):fe.a,yx(1),n?ae(e):ue(()=>new Qt))}())}expandSegment(t,e,n,r,i,o){return Object(Tt.a)(n).pipe(_x(s=>this.expandSegmentAgainstRoute(t,e,n,s,r,i,o).pipe(px(t=>{if(t instanceof _T)return Object(vt.a)(null);throw t}))),me(t=>!!t),px((t,n)=>{if(t instanceof Qt||"EmptyError"===t.name){if(gT(e,r,i))return Object(vt.a)(new rw([],{}));throw new _T(e)}throw t}))}expandSegmentAgainstRoute(t,e,n,r,i,o,s){return mT(r,e,i,o)?void 0===r.redirectTo?this.matchSegmentAgainstRoute(t,e,r,i,o):s&&this.allowRedirects?this.expandSegmentAgainstRouteUsingRedirect(t,e,n,r,i,o):vT(e):vT(e)}expandSegmentAgainstRouteUsingRedirect(t,e,n,r,i,o){return"**"===r.path?this.expandWildCardWithParamsAgainstRouteUsingRedirect(t,n,r,o):this.expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,r,i,o)}expandWildCardWithParamsAgainstRouteUsingRedirect(t,e,n,r){const i=this.applyRedirectCommands([],n.redirectTo,{});return n.redirectTo.startsWith("/")?bT(i):this.lineralizeSegments(n,i).pipe(Object(gx.a)(n=>{const i=new rw(n,{});return this.expandSegment(t,i,e,n,r,!1)}))}expandRegularSegmentAgainstRouteUsingRedirect(t,e,n,r,i,o){const{matched:s,consumedSegments:a,lastChild:c,positionalParamSegments:l}=dT(e,r,i);if(!s)return vT(e);const u=this.applyRedirectCommands(a,r.redirectTo,l);return r.redirectTo.startsWith("/")?bT(u):this.lineralizeSegments(r,u).pipe(Object(gx.a)(r=>this.expandSegment(t,e,n,r.concat(i.slice(c)),o,!1)))}matchSegmentAgainstRoute(t,e,n,r,i){if("**"===n.path)return n.loadChildren?this.configLoader.load(t.injector,n).pipe(Object(xt.a)(t=>(n._loadedConfig=t,new rw(r,{})))):Object(vt.a)(new rw(r,{}));const{matched:o,consumedSegments:s,lastChild:a}=dT(e,n,r);if(!o)return vT(e);const c=r.slice(a);return this.getChildConfig(t,n,r).pipe(Object(gx.a)(t=>{const r=t.module,o=t.routes,{segmentGroup:a,slicedSegments:l}=pT(e,s,c,o),u=new rw(a.segments,a.children);if(0===l.length&&u.hasChildren())return this.expandChildren(r,o,u).pipe(Object(xt.a)(t=>new rw(s,t)));if(0===o.length&&0===l.length)return Object(vt.a)(new rw(s,{}));const h=lT(n)===i;return this.expandSegment(r,u,o,l,h?Ux:i,!0).pipe(Object(xt.a)(t=>new rw(s.concat(t.segments),t.children)))}))}getChildConfig(t,e,n){return e.children?Object(vt.a)(new Jw(e.children,t)):e.loadChildren?void 0!==e._loadedConfig?Object(vt.a)(e._loadedConfig):this.runCanLoadGuards(t.injector,e,n).pipe(Object(gx.a)(n=>n?this.configLoader.load(t.injector,e).pipe(Object(xt.a)(t=>(e._loadedConfig=t,t))):function(t){return new yt.a(e=>e.error(Gx(`Cannot load children because the guard of the route "path: '${t.path}'" returned false`)))}(e))):Object(vt.a)(new Jw([],t))}runCanLoadGuards(t,e,n){const r=e.canLoad;if(!r||0===r.length)return Object(vt.a)(!0);const i=r.map(r=>{const i=t.get(r);let o;if(function(t){return t&&tT(t.canLoad)}(i))o=i.canLoad(e,n);else{if(!tT(i))throw new Error("Invalid CanLoad guard");o=i(e,n)}return Yx(o)});return Object(vt.a)(i).pipe(rT(),Object(xx.a)(t=>{if(!eT(t))return;const e=Gx(`Redirecting to "${this.urlSerializer.serialize(t)}"`);throw e.url=t,e}),Object(xt.a)(t=>!0===t))}lineralizeSegments(t,e){let n=[],r=e.root;for(;;){if(n=n.concat(r.segments),0===r.numberOfChildren)return Object(vt.a)(n);if(r.numberOfChildren>1||!r.children.primary)return xT(t.redirectTo);r=r.children.primary}}applyRedirectCommands(t,e,n){return this.applyRedirectCreatreUrlTree(e,this.urlSerializer.parse(e),t,n)}applyRedirectCreatreUrlTree(t,e,n,r){const i=this.createSegmentGroup(t,e.root,n,r);return new nw(i,this.createQueryParams(e.queryParams,this.urlTree.queryParams),e.fragment)}createQueryParams(t,e){const n={};return Xx(t,(t,r)=>{if("string"==typeof t&&t.startsWith(":")){const i=t.substring(1);n[r]=e[i]}else n[r]=t}),n}createSegmentGroup(t,e,n,r){const i=this.createSegments(t,e.segments,n,r);let o={};return Xx(e.children,(e,i)=>{o[i]=this.createSegmentGroup(t,e,n,r)}),new rw(i,o)}createSegments(t,e,n,r){return e.map(e=>e.path.startsWith(":")?this.findPosParam(t,e,r):this.findOrReturn(e,n))}findPosParam(t,e,n){const r=n[e.path.substring(1)];if(!r)throw new Error(`Cannot redirect to '${t}'. Cannot find '${e.path}'.`);return r}findOrReturn(t,e){let n=0;for(const r of e){if(r.path===t.path)return e.splice(n),r;n++}return t}}function TT(t){const e={};for(const n of Object.keys(t.children)){const r=TT(t.children[n]);(r.segments.length>0||r.hasChildren())&&(e[n]=r)}return function(t){if(1===t.numberOfChildren&&t.children.primary){const e=t.children.primary;return new rw(t.segments.concat(e.segments),e.children)}return t}(new rw(t.segments,e))}class CT{constructor(t){this.path=t,this.route=this.path[this.path.length-1]}}class ET{constructor(t,e){this.component=t,this.route=e}}function ST(t,e,n){const r=t._root;return kT(r,e?e._root:null,n,[r.value])}function IT(t,e,n){const r=function(t){if(!t)return null;for(let e=t.parent;e;e=e.parent){const t=e.routeConfig;if(t&&t._loadedConfig)return t._loadedConfig}return null}(e);return(r?r.module.injector:n).get(t)}function kT(t,e,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=Sw(e);return t.children.forEach(t=>{!function(t,e,n,r,i={canDeactivateChecks:[],canActivateChecks:[]}){const o=t.value,s=e?e.value:null,a=n?n.getContext(t.value.outlet):null;if(s&&o.routeConfig===s.routeConfig){const c=function(t,e,n){if("function"==typeof n)return n(t,e);switch(n){case"pathParamsChange":return!ow(t.url,e.url);case"pathParamsOrQueryParamsChange":return!ow(t.url,e.url)||!Wx(t.queryParams,e.queryParams);case"always":return!0;case"paramsOrQueryParamsChange":return!Lw(t,e)||!Wx(t.queryParams,e.queryParams);case"paramsChange":default:return!Lw(t,e)}}(s,o,o.routeConfig.runGuardsAndResolvers);c?i.canActivateChecks.push(new CT(r)):(o.data=s.data,o._resolvedData=s._resolvedData),kT(t,e,o.component?a?a.children:null:n,r,i),c&&a&&a.outlet&&a.outlet.isActivated&&i.canDeactivateChecks.push(new ET(a.outlet.component,s))}else s&&AT(e,a,i),i.canActivateChecks.push(new CT(r)),kT(t,null,o.component?a?a.children:null:n,r,i)}(t,o[t.value.outlet],n,r.concat([t.value]),i),delete o[t.value.outlet]}),Xx(o,(t,e)=>AT(t,n.getContext(e),i)),i}function AT(t,e,n){const r=Sw(t),i=t.value;Xx(r,(t,r)=>{AT(t,i.component?e?e.children.getContext(r):null:e,n)}),n.canDeactivateChecks.push(new ET(i.component&&e&&e.outlet&&e.outlet.isActivated?e.outlet.component:null,i))}class MT{}function OT(t){return new yt.a(e=>e.error(t))}class PT{constructor(t,e,n,r,i,o){this.rootComponentType=t,this.config=e,this.urlTree=n,this.url=r,this.paramsInheritanceStrategy=i,this.relativeLinkResolution=o}recognize(){const t=pT(this.urlTree.root,[],[],this.config.filter(t=>void 0===t.redirectTo),this.relativeLinkResolution).segmentGroup,e=this.processSegmentGroup(this.config,t,Ux);if(null===e)return null;const n=new Ow([],Object.freeze({}),Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,{},Ux,this.rootComponentType,null,this.urlTree.root,-1,{}),r=new Ew(n,e),i=new Pw(this.url,r);return this.inheritParamsAndData(i._root),i}inheritParamsAndData(t){const e=t.value,n=Mw(e,this.paramsInheritanceStrategy);e.params=Object.freeze(n.params),e.data=Object.freeze(n.data),t.children.forEach(t=>this.inheritParamsAndData(t))}processSegmentGroup(t,e,n){return 0===e.segments.length&&e.hasChildren()?this.processChildren(t,e):this.processSegment(t,e,e.segments,n)}processChildren(t,e){const n=[];for(const i of Object.keys(e.children)){const r=e.children[i],o=uT(t,i),s=this.processSegmentGroup(o,r,i);if(null===s)return null;n.push(...s)}const r=function(t){const e=[];for(const n of t){if(!DT(n)){e.push(n);continue}const t=e.find(t=>n.value.routeConfig===t.value.routeConfig);void 0!==t?t.children.push(...n.children):e.push(n)}return e}(n);return r.sort((t,e)=>t.value.outlet===Ux?-1:e.value.outlet===Ux?1:t.value.outlet.localeCompare(e.value.outlet)),r}processSegment(t,e,n,r){for(const i of t){const t=this.processSegmentAgainstRoute(i,e,n,r);if(null!==t)return t}return gT(e,n,r)?[]:null}processSegmentAgainstRoute(t,e,n,r){if(t.redirectTo||!mT(t,e,n,r))return null;let i,o=[],s=[];if("**"===t.path){const r=n.length>0?Kx(n).parameters:{};i=new Ow(n,r,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,LT(t),lT(t),t.component,t,RT(e),NT(e)+n.length,jT(t))}else{const r=dT(e,t,n);if(!r.matched)return null;o=r.consumedSegments,s=n.slice(r.lastChild),i=new Ow(o,r.parameters,Object.freeze(Object.assign({},this.urlTree.queryParams)),this.urlTree.fragment,LT(t),lT(t),t.component,t,RT(e),NT(e)+o.length,jT(t))}const a=function(t){return t.children?t.children:t.loadChildren?t._loadedConfig.routes:[]}(t),{segmentGroup:c,slicedSegments:l}=pT(e,o,s,a.filter(t=>void 0===t.redirectTo),this.relativeLinkResolution);if(0===l.length&&c.hasChildren()){const t=this.processChildren(a,c);return null===t?null:[new Ew(i,t)]}if(0===a.length&&0===l.length)return[new Ew(i,[])];const u=lT(t)===r,h=this.processSegment(a,c,l,u?Ux:r);return null===h?null:[new Ew(i,h)]}}function DT(t){const e=t.value.routeConfig;return e&&""===e.path&&void 0===e.redirectTo}function RT(t){let e=t;for(;e._sourceSegment;)e=e._sourceSegment;return e}function NT(t){let e=t,n=e._segmentIndexShift?e._segmentIndexShift:0;for(;e._sourceSegment;)e=e._sourceSegment,n+=e._segmentIndexShift?e._segmentIndexShift:0;return n-1}function LT(t){return t.data||{}}function jT(t){return t.resolve||{}}function zT(t){return Et(e=>{const n=t(e);return n?Object(Tt.a)(n).pipe(Object(xt.a)(()=>e)):Object(vt.a)(e)})}class FT extends class{shouldDetach(t){return!1}store(t,e){}shouldAttach(t){return!1}retrieve(t){return null}shouldReuseRoute(t,e){return t.routeConfig===e.routeConfig}}{}const BT=new r.r("ROUTES");class UT{constructor(t,e,n,r){this.loader=t,this.compiler=e,this.onLoadStartListener=n,this.onLoadEndListener=r}load(t,e){return this.onLoadStartListener&&this.onLoadStartListener(e),this.loadModuleFactory(e.loadChildren).pipe(Object(xt.a)(n=>{this.onLoadEndListener&&this.onLoadEndListener(e);const i=n.create(t);return new Jw(Zx(i.injector.get(BT,void 0,r.q.Self|r.q.Optional)).map(cT),i)}))}loadModuleFactory(t){return"string"==typeof t?Object(Tt.a)(this.loader.load(t)):Yx(t()).pipe(Object(gx.a)(t=>t instanceof r.w?Object(vt.a)(t):Object(Tt.a)(this.compiler.compileModuleAsync(t))))}}class VT{constructor(){this.outlet=null,this.route=null,this.resolver=null,this.children=new qT,this.attachRef=null}}class qT{constructor(){this.contexts=new Map}onChildOutletCreated(t,e){const n=this.getOrCreateContext(t);n.outlet=e,this.contexts.set(t,n)}onChildOutletDestroyed(t){const e=this.getContext(t);e&&(e.outlet=null)}onOutletDeactivated(){const t=this.contexts;return this.contexts=new Map,t}onOutletReAttached(t){this.contexts=t}getOrCreateContext(t){let e=this.getContext(t);return e||(e=new VT,this.contexts.set(t,e)),e}getContext(t){return this.contexts.get(t)||null}}class GT{shouldProcessUrl(t){return!0}extract(t){return t}merge(t,e){return t}}function $T(t){throw t}function WT(t,e,n){return e.parse("/")}function HT(t,e){return Object(vt.a)(null)}let ZT=(()=>{class t{constructor(t,e,n,i,o,s,a,c){this.rootComponentType=t,this.urlSerializer=e,this.rootContexts=n,this.location=i,this.config=c,this.lastSuccessfulNavigation=null,this.currentNavigation=null,this.lastLocationChangeInfo=null,this.navigationId=0,this.isNgZoneEnabled=!1,this.events=new qt.a,this.errorHandler=$T,this.malformedUriErrorHandler=WT,this.navigated=!1,this.lastSuccessfulId=-1,this.hooks={beforePreactivation:HT,afterPreactivation:HT},this.urlHandlingStrategy=new GT,this.routeReuseStrategy=new FT,this.onSameUrlNavigation="ignore",this.paramsInheritanceStrategy="emptyOnly",this.urlUpdateStrategy="deferred",this.relativeLinkResolution="corrected",this.ngModule=o.get(r.y),this.console=o.get(r.Y);const l=o.get(r.A);this.isNgZoneEnabled=l instanceof r.A&&r.A.isInAngularZone(),this.resetConfig(c),this.currentUrlTree=new nw(new rw([],{}),{},null),this.rawUrlTree=this.currentUrlTree,this.browserUrlTree=this.currentUrlTree,this.configLoader=new UT(s,a,t=>this.triggerEvent(new Rx(t)),t=>this.triggerEvent(new Nx(t))),this.routerState=kw(this.currentUrlTree,this.rootComponentType),this.transitions=new sx({id:0,currentUrlTree:this.currentUrlTree,currentRawUrl:this.currentUrlTree,extractedUrl:this.urlHandlingStrategy.extract(this.currentUrlTree),urlAfterRedirects:this.urlHandlingStrategy.extract(this.currentUrlTree),rawUrl:this.currentUrlTree,extras:{},resolve:null,reject:null,promise:Promise.resolve(!0),source:"imperative",restoredState:null,currentSnapshot:this.routerState.snapshot,targetSnapshot:null,currentRouterState:this.routerState,targetRouterState:null,guards:{canActivateChecks:[],canDeactivateChecks:[]},guardsResult:null}),this.navigations=this.setupNavigations(this.transitions),this.processNavigations()}setupNavigations(t){const e=this.events;return t.pipe(Jt(t=>0!==t.id),Object(xt.a)(t=>Object.assign(Object.assign({},t),{extractedUrl:this.urlHandlingStrategy.extract(t.rawUrl)})),Et(t=>{let n=!1,r=!1;return Object(vt.a)(t).pipe(Object(xx.a)(t=>{this.currentNavigation={id:t.id,initialUrl:t.currentRawUrl,extractedUrl:t.extractedUrl,trigger:t.source,extras:t.extras,previousNavigation:this.lastSuccessfulNavigation?Object.assign(Object.assign({},this.lastSuccessfulNavigation),{previousNavigation:null}):null}}),Et(t=>{const n=!this.navigated||t.extractedUrl.toString()!==this.browserUrlTree.toString();if(("reload"===this.onSameUrlNavigation||n)&&this.urlHandlingStrategy.shouldProcessUrl(t.rawUrl))return Object(vt.a)(t).pipe(Et(t=>{const n=this.transitions.getValue();return e.next(new Ex(t.id,this.serializeUrl(t.extractedUrl),t.source,t.restoredState)),n!==this.transitions.getValue()?re.a:Promise.resolve(t)}),(r=this.ngModule.injector,i=this.configLoader,o=this.urlSerializer,s=this.config,Et(t=>function(t,e,n,r,i){return new wT(t,e,n,r,i).apply()}(r,i,o,t.extractedUrl,s).pipe(Object(xt.a)(e=>Object.assign(Object.assign({},t),{urlAfterRedirects:e}))))),Object(xx.a)(t=>{this.currentNavigation=Object.assign(Object.assign({},this.currentNavigation),{finalUrl:t.urlAfterRedirects})}),function(t,e,n,r,i){return Object(gx.a)(o=>function(t,e,n,r,i="emptyOnly",o="legacy"){try{const s=new PT(t,e,n,r,i,o).recognize();return null===s?OT(new MT):Object(vt.a)(s)}catch(K_){return OT(K_)}}(t,e,o.urlAfterRedirects,n(o.urlAfterRedirects),r,i).pipe(Object(xt.a)(t=>Object.assign(Object.assign({},o),{targetSnapshot:t}))))}(this.rootComponentType,this.config,t=>this.serializeUrl(t),this.paramsInheritanceStrategy,this.relativeLinkResolution),Object(xx.a)(t=>{"eager"===this.urlUpdateStrategy&&(t.extras.skipLocationChange||this.setBrowserUrl(t.urlAfterRedirects,!!t.extras.replaceUrl,t.id,t.extras.state),this.browserUrlTree=t.urlAfterRedirects);const n=new Ax(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);e.next(n)}));var r,i,o,s;if(n&&this.rawUrlTree&&this.urlHandlingStrategy.shouldProcessUrl(this.rawUrlTree)){const{id:n,extractedUrl:r,source:i,restoredState:o,extras:s}=t,a=new Ex(n,this.serializeUrl(r),i,o);e.next(a);const c=kw(r,this.rootComponentType).snapshot;return Object(vt.a)(Object.assign(Object.assign({},t),{targetSnapshot:c,urlAfterRedirects:r,extras:Object.assign(Object.assign({},s),{skipLocationChange:!1,replaceUrl:!1})}))}return this.rawUrlTree=t.rawUrl,this.browserUrlTree=t.urlAfterRedirects,t.resolve(null),re.a}),zT(t=>{const{targetSnapshot:e,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:o,replaceUrl:s}}=t;return this.hooks.beforePreactivation(e,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!o,replaceUrl:!!s})}),Object(xx.a)(t=>{const e=new Mx(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}),Object(xt.a)(t=>Object.assign(Object.assign({},t),{guards:ST(t.targetSnapshot,t.currentSnapshot,this.rootContexts)})),function(t,e){return Object(gx.a)(n=>{const{targetSnapshot:r,currentSnapshot:i,guards:{canActivateChecks:o,canDeactivateChecks:s}}=n;return 0===s.length&&0===o.length?Object(vt.a)(Object.assign(Object.assign({},n),{guardsResult:!0})):function(t,e,n,r){return Object(Tt.a)(t).pipe(Object(gx.a)(t=>function(t,e,n,r,i){const o=e&&e.routeConfig?e.routeConfig.canDeactivate:null;if(!o||0===o.length)return Object(vt.a)(!0);const s=o.map(o=>{const s=IT(o,e,i);let a;if(function(t){return t&&tT(t.canDeactivate)}(s))a=Yx(s.canDeactivate(t,e,n,r));else{if(!tT(s))throw new Error("Invalid CanDeactivate guard");a=Yx(s(t,e,n,r))}return a.pipe(me())});return Object(vt.a)(s).pipe(rT())}(t.component,t.route,n,e,r)),me(t=>!0!==t,!0))}(s,r,i,t).pipe(Object(gx.a)(n=>n&&"boolean"==typeof n?function(t,e,n,r){return Object(Tt.a)(e).pipe(_x(e=>Sr(function(t,e){return null!==t&&e&&e(new Lx(t)),Object(vt.a)(!0)}(e.route.parent,r),function(t,e){return null!==t&&e&&e(new zx(t)),Object(vt.a)(!0)}(e.route,r),function(t,e,n){const r=e[e.length-1],i=e.slice(0,e.length-1).reverse().map(t=>function(t){const e=t.routeConfig?t.routeConfig.canActivateChild:null;return e&&0!==e.length?{node:t,guards:e}:null}(t)).filter(t=>null!==t).map(e=>dx(()=>{const i=e.guards.map(i=>{const o=IT(i,e.node,n);let s;if(function(t){return t&&tT(t.canActivateChild)}(o))s=Yx(o.canActivateChild(r,t));else{if(!tT(o))throw new Error("Invalid CanActivateChild guard");s=Yx(o(r,t))}return s.pipe(me())});return Object(vt.a)(i).pipe(rT())}));return Object(vt.a)(i).pipe(rT())}(t,e.path,n),function(t,e,n){const r=e.routeConfig?e.routeConfig.canActivate:null;if(!r||0===r.length)return Object(vt.a)(!0);const i=r.map(r=>dx(()=>{const i=IT(r,e,n);let o;if(function(t){return t&&tT(t.canActivate)}(i))o=Yx(i.canActivate(e,t));else{if(!tT(i))throw new Error("Invalid CanActivate guard");o=Yx(i(e,t))}return o.pipe(me())}));return Object(vt.a)(i).pipe(rT())}(t,e.route,n))),me(t=>!0!==t,!0))}(r,o,t,e):Object(vt.a)(n)),Object(xt.a)(t=>Object.assign(Object.assign({},n),{guardsResult:t})))})}(this.ngModule.injector,t=>this.triggerEvent(t)),Object(xx.a)(t=>{if(eT(t.guardsResult)){const e=Gx(`Redirecting to "${this.serializeUrl(t.guardsResult)}"`);throw e.url=t.guardsResult,e}const e=new Ox(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot,!!t.guardsResult);this.triggerEvent(e)}),Jt(t=>{if(!t.guardsResult){this.resetUrlToCurrentUrlTree();const n=new Ix(t.id,this.serializeUrl(t.extractedUrl),"");return e.next(n),t.resolve(!1),!1}return!0}),zT(t=>{if(t.guards.canActivateChecks.length)return Object(vt.a)(t).pipe(Object(xx.a)(t=>{const e=new Px(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}),Et(t=>{let n=!1;return Object(vt.a)(t).pipe((r=this.paramsInheritanceStrategy,i=this.ngModule.injector,Object(gx.a)(t=>{const{targetSnapshot:e,guards:{canActivateChecks:n}}=t;if(!n.length)return Object(vt.a)(t);let o=0;return Object(Tt.a)(n).pipe(_x(t=>function(t,e,n,r){return function(t,e,n,r){const i=Object.keys(t);if(0===i.length)return Object(vt.a)({});const o={};return Object(Tt.a)(i).pipe(Object(gx.a)(i=>function(t,e,n,r){const i=IT(t,e,r);return Yx(i.resolve?i.resolve(e,n):i(e,n))}(t[i],e,n,r).pipe(Object(xx.a)(t=>{o[i]=t}))),yx(1),Object(gx.a)(()=>Object.keys(o).length===i.length?Object(vt.a)(o):re.a))}(t._resolve,t,e,r).pipe(Object(xt.a)(e=>(t._resolvedData=e,t.data=Object.assign(Object.assign({},t.data),Mw(t,n).resolve),null)))}(t.route,e,r,i)),Object(xx.a)(()=>o++),yx(1),Object(gx.a)(e=>o===n.length?Object(vt.a)(t):re.a))})),Object(xx.a)({next:()=>n=!0,complete:()=>{if(!n){const n=new Ix(t.id,this.serializeUrl(t.extractedUrl),"At least one route resolver didn't emit any value.");e.next(n),t.resolve(!1)}}}));var r,i}),Object(xx.a)(t=>{const e=new Dx(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(t.urlAfterRedirects),t.targetSnapshot);this.triggerEvent(e)}))}),zT(t=>{const{targetSnapshot:e,id:n,extractedUrl:r,rawUrl:i,extras:{skipLocationChange:o,replaceUrl:s}}=t;return this.hooks.afterPreactivation(e,{navigationId:n,appliedUrlTree:r,rawUrlTree:i,skipLocationChange:!!o,replaceUrl:!!s})}),Object(xt.a)(t=>{const e=function(t,e,n){const r=jw(t,e._root,n?n._root:void 0);return new Iw(r,e)}(this.routeReuseStrategy,t.targetSnapshot,t.currentRouterState);return Object.assign(Object.assign({},t),{targetRouterState:e})}),Object(xx.a)(t=>{this.currentUrlTree=t.urlAfterRedirects,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,t.rawUrl),this.routerState=t.targetRouterState,"deferred"===this.urlUpdateStrategy&&(t.extras.skipLocationChange||this.setBrowserUrl(this.rawUrlTree,!!t.extras.replaceUrl,t.id,t.extras.state),this.browserUrlTree=t.urlAfterRedirects)}),(o=this.rootContexts,s=this.routeReuseStrategy,a=t=>this.triggerEvent(t),Object(xt.a)(t=>(new Yw(s,t.targetRouterState,t.currentRouterState,a).activate(o),t))),Object(xx.a)({next(){n=!0},complete(){n=!0}}),(i=()=>{if(!n&&!r){this.resetUrlToCurrentUrlTree();const n=new Ix(t.id,this.serializeUrl(t.extractedUrl),`Navigation ID ${t.id} is not equal to the current navigation id ${this.navigationId}`);e.next(n),t.resolve(!1)}this.currentNavigation=null},t=>t.lift(new wx(i))),px(n=>{if(r=!0,(i=n)&&i.ngNavigationCancelingError){const r=eT(n.url);r||(this.navigated=!0,this.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl));const i=new Ix(t.id,this.serializeUrl(t.extractedUrl),n.message);e.next(i),r?setTimeout(()=>{const e=this.urlHandlingStrategy.merge(n.url,this.rawUrlTree);this.scheduleNavigation(e,"imperative",null,{skipLocationChange:t.extras.skipLocationChange,replaceUrl:"eager"===this.urlUpdateStrategy},{resolve:t.resolve,reject:t.reject,promise:t.promise})},0):t.resolve(!1)}else{this.resetStateAndUrl(t.currentRouterState,t.currentUrlTree,t.rawUrl);const r=new kx(t.id,this.serializeUrl(t.extractedUrl),n);e.next(r);try{t.resolve(this.errorHandler(n))}catch(_l){t.reject(_l)}}var i;return re.a}));var i,o,s,a}))}resetRootComponentType(t){this.rootComponentType=t,this.routerState.root.component=this.rootComponentType}getTransition(){const t=this.transitions.value;return t.urlAfterRedirects=this.browserUrlTree,t}setTransition(t){this.transitions.next(Object.assign(Object.assign({},this.getTransition()),t))}initialNavigation(){this.setUpLocationChangeListener(),0===this.navigationId&&this.navigateByUrl(this.location.path(!0),{replaceUrl:!0})}setUpLocationChangeListener(){this.locationSubscription||(this.locationSubscription=this.location.subscribe(t=>{const e=this.extractLocationChangeInfoFromEvent(t);this.shouldScheduleNavigation(this.lastLocationChangeInfo,e)&&setTimeout(()=>{const{source:t,state:n,urlTree:r}=e,i={replaceUrl:!0};if(n){const t=Object.assign({},n);delete t.navigationId,0!==Object.keys(t).length&&(i.state=t)}this.scheduleNavigation(r,t,n,i)},0),this.lastLocationChangeInfo=e}))}extractLocationChangeInfoFromEvent(t){var e;return{source:"popstate"===t.type?"popstate":"hashchange",urlTree:this.parseUrl(t.url),state:(null===(e=t.state)||void 0===e?void 0:e.navigationId)?t.state:null,transitionId:this.getTransition().id}}shouldScheduleNavigation(t,e){if(!t)return!0;const n=e.urlTree.toString()===t.urlTree.toString();return!(e.transitionId===t.transitionId&&n&&("hashchange"===e.source&&"popstate"===t.source||"popstate"===e.source&&"hashchange"===t.source))}get url(){return this.serializeUrl(this.currentUrlTree)}getCurrentNavigation(){return this.currentNavigation}triggerEvent(t){this.events.next(t)}resetConfig(t){oT(t),this.config=t.map(cT),this.navigated=!1,this.lastSuccessfulId=-1}ngOnDestroy(){this.dispose()}dispose(){this.locationSubscription&&(this.locationSubscription.unsubscribe(),this.locationSubscription=void 0)}createUrlTree(t,e={}){const{relativeTo:n,queryParams:r,fragment:i,queryParamsHandling:o,preserveFragment:s}=e,a=n||this.routerState.root,c=s?this.currentUrlTree.fragment:i;let l=null;switch(o){case"merge":l=Object.assign(Object.assign({},this.currentUrlTree.queryParams),r);break;case"preserve":l=this.currentUrlTree.queryParams;break;default:l=r||null}return null!==l&&(l=this.removeEmptyProps(l)),function(t,e,n,r,i){if(0===n.length)return Uw(e.root,e.root,e,r,i);const o=function(t){if("string"==typeof t[0]&&1===t.length&&"/"===t[0])return new qw(!0,0,t);let e=0,n=!1;const r=t.reduce((t,r,i)=>{if("object"==typeof r&&null!=r){if(r.outlets){const e={};return Xx(r.outlets,(t,n)=>{e[n]="string"==typeof t?t.split("/"):t}),[...t,{outlets:e}]}if(r.segmentPath)return[...t,r.segmentPath]}return"string"!=typeof r?[...t,r]:0===i?(r.split("/").forEach((r,i)=>{0==i&&"."===r||(0==i&&""===r?n=!0:".."===r?e++:""!=r&&t.push(r))}),t):[...t,r]},[]);return new qw(n,e,r)}(n);if(o.toRoot())return Uw(e.root,new rw([],{}),e,r,i);const s=function(t,e,n){if(t.isAbsolute)return new Gw(e.root,!0,0);if(-1===n.snapshot._lastPathIndex){const t=n.snapshot._urlSegment;return new Gw(t,t===e.root,0)}const r=Fw(t.commands[0])?0:1;return function(t,e,n){let r=t,i=e,o=n;for(;o>i;){if(o-=i,r=r.parent,!r)throw new Error("Invalid number of '../'");i=r.segments.length}return new Gw(r,!1,i-o)}(n.snapshot._urlSegment,n.snapshot._lastPathIndex+r,t.numberOfDoubleDots)}(o,e,t),a=s.processChildren?Ww(s.segmentGroup,s.index,o.commands):$w(s.segmentGroup,s.index,o.commands);return Uw(s.segmentGroup,a,e,r,i)}(a,this.currentUrlTree,t,l,c)}navigateByUrl(t,e={skipLocationChange:!1}){const n=eT(t)?t:this.parseUrl(t),r=this.urlHandlingStrategy.merge(n,this.rawUrlTree);return this.scheduleNavigation(r,"imperative",null,e)}navigate(t,e={skipLocationChange:!1}){return function(t){for(let e=0;e<t.length;e++){const n=t[e];if(null==n)throw new Error(`The requested path contains ${n} segment at index ${e}`)}}(t),this.navigateByUrl(this.createUrlTree(t,e),e)}serializeUrl(t){return this.urlSerializer.serialize(t)}parseUrl(t){let e;try{e=this.urlSerializer.parse(t)}catch(K_){e=this.malformedUriErrorHandler(K_,this.urlSerializer,t)}return e}isActive(t,e){if(eT(t))return Qx(this.currentUrlTree,t,e);const n=this.parseUrl(t);return Qx(this.currentUrlTree,n,e)}removeEmptyProps(t){return Object.keys(t).reduce((e,n)=>{const r=t[n];return null!=r&&(e[n]=r),e},{})}processNavigations(){this.navigations.subscribe(t=>{this.navigated=!0,this.lastSuccessfulId=t.id,this.events.next(new Sx(t.id,this.serializeUrl(t.extractedUrl),this.serializeUrl(this.currentUrlTree))),this.lastSuccessfulNavigation=this.currentNavigation,this.currentNavigation=null,t.resolve(!0)},t=>{this.console.warn("Unhandled Navigation Error: ")})}scheduleNavigation(t,e,n,r,i){const o=this.getTransition(),s="imperative"!==e&&"imperative"===(null==o?void 0:o.source),a=(this.lastSuccessfulId===o.id||this.currentNavigation?o.rawUrl:o.urlAfterRedirects).toString()===t.toString();if(s&&a)return Promise.resolve(!0);let c,l,u;i?(c=i.resolve,l=i.reject,u=i.promise):u=new Promise((t,e)=>{c=t,l=e});const h=++this.navigationId;return this.setTransition({id:h,source:e,restoredState:n,currentUrlTree:this.currentUrlTree,currentRawUrl:this.rawUrlTree,rawUrl:t,extras:r,resolve:c,reject:l,promise:u,currentSnapshot:this.routerState.snapshot,currentRouterState:this.routerState}),u.catch(t=>Promise.reject(t))}setBrowserUrl(t,e,n,r){const i=this.urlSerializer.serialize(t);r=r||{},this.location.isCurrentPathEqualTo(i)||e?this.location.replaceState(i,"",Object.assign(Object.assign({},r),{navigationId:n})):this.location.go(i,"",Object.assign(Object.assign({},r),{navigationId:n}))}resetStateAndUrl(t,e,n){this.routerState=t,this.currentUrlTree=e,this.rawUrlTree=this.urlHandlingStrategy.merge(this.currentUrlTree,n),this.resetUrlToCurrentUrlTree()}resetUrlToCurrentUrlTree(){this.location.replaceState(this.urlSerializer.serialize(this.rawUrlTree),"",{navigationId:this.lastSuccessfulId})}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(r.N),r.Rb(sw),r.Rb(qT),r.Rb(x),r.Rb(r.s),r.Rb(r.x),r.Rb(r.i),r.Rb(void 0))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})(),KT=(()=>{class t{constructor(t,e,n,r,i){this.router=t,this.route=e,this.commands=[],this.onChanges=new qt.a,null==n&&r.setAttribute(i.nativeElement,"tabindex","0")}ngOnChanges(t){this.onChanges.next(this)}set routerLink(t){this.commands=null!=t?Array.isArray(t)?t:[t]:[]}onClick(){const t={skipLocationChange:XT(this.skipLocationChange),replaceUrl:XT(this.replaceUrl),state:this.state};return this.router.navigateByUrl(this.urlTree,t),!0}get urlTree(){return this.router.createUrlTree(this.commands,{relativeTo:void 0!==this.relativeTo?this.relativeTo:this.route,queryParams:this.queryParams,fragment:this.fragment,queryParamsHandling:this.queryParamsHandling,preserveFragment:XT(this.preserveFragment)})}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(ZT),r.Kb(Aw),r.Sb("tabindex"),r.Kb(r.E),r.Kb(r.l))},t.\u0275dir=r.Fb({type:t,selectors:[["","routerLink","",5,"a",5,"area"]],hostBindings:function(t,e){1&t&&r.Ub("click",function(){return e.onClick()})},inputs:{routerLink:"routerLink",queryParams:"queryParams",fragment:"fragment",queryParamsHandling:"queryParamsHandling",preserveFragment:"preserveFragment",skipLocationChange:"skipLocationChange",replaceUrl:"replaceUrl",state:"state",relativeTo:"relativeTo"},features:[r.yb]}),t})();function XT(t){return""===t||!!t}let YT=(()=>{class t{constructor(t,e,n,i,o){this.parentContexts=t,this.location=e,this.resolver=n,this.changeDetector=o,this.activated=null,this._activatedRoute=null,this.activateEvents=new r.n,this.deactivateEvents=new r.n,this.name=i||Ux,t.onChildOutletCreated(this.name,this)}ngOnDestroy(){this.parentContexts.onChildOutletDestroyed(this.name)}ngOnInit(){if(!this.activated){const t=this.parentContexts.getContext(this.name);t&&t.route&&(t.attachRef?this.attach(t.attachRef,t.route):this.activateWith(t.route,t.resolver||null))}}get isActivated(){return!!this.activated}get component(){if(!this.activated)throw new Error("Outlet is not activated");return this.activated.instance}get activatedRoute(){if(!this.activated)throw new Error("Outlet is not activated");return this._activatedRoute}get activatedRouteData(){return this._activatedRoute?this._activatedRoute.snapshot.data:{}}detach(){if(!this.activated)throw new Error("Outlet is not activated");this.location.detach();const t=this.activated;return this.activated=null,this._activatedRoute=null,t}attach(t,e){this.activated=t,this._activatedRoute=e,this.location.insert(t.hostView)}deactivate(){if(this.activated){const t=this.component;this.activated.destroy(),this.activated=null,this._activatedRoute=null,this.deactivateEvents.emit(t)}}activateWith(t,e){if(this.isActivated)throw new Error("Cannot activate an already activated outlet");this._activatedRoute=t;const n=(e=e||this.resolver).resolveComponentFactory(t._futureSnapshot.routeConfig.component),r=this.parentContexts.getOrCreateContext(this.name).children,i=new QT(t,r,this.location.injector);this.activated=this.location.createComponent(n,this.location.length,i),this.changeDetector.markForCheck(),this.activateEvents.emit(this.activated.instance)}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(qT),r.Kb(r.Q),r.Kb(r.j),r.Sb("name"),r.Kb(r.h))},t.\u0275dir=r.Fb({type:t,selectors:[["router-outlet"]],outputs:{activateEvents:"activate",deactivateEvents:"deactivate"},exportAs:["outlet"]}),t})();class QT{constructor(t,e,n){this.route=t,this.childContexts=e,this.parent=n}get(t,e){return t===Aw?this.route:t===qT?this.childContexts:this.parent.get(t,e)}}class JT{}class tC{preload(t,e){return Object(vt.a)(null)}}let eC=(()=>{class t{constructor(t,e,n,r,i){this.router=t,this.injector=r,this.preloadingStrategy=i,this.loader=new UT(e,n,e=>t.triggerEvent(new Rx(e)),e=>t.triggerEvent(new Nx(e)))}setUpPreloading(){this.subscription=this.router.events.pipe(Jt(t=>t instanceof Sx),_x(()=>this.preload())).subscribe(()=>{})}preload(){const t=this.injector.get(r.y);return this.processRoutes(t,this.router.config)}ngOnDestroy(){this.subscription&&this.subscription.unsubscribe()}processRoutes(t,e){const n=[];for(const r of e)if(r.loadChildren&&!r.canLoad&&r._loadedConfig){const t=r._loadedConfig;n.push(this.processRoutes(t.module,t.routes))}else r.loadChildren&&!r.canLoad?n.push(this.preloadConfig(t,r)):r.children&&n.push(this.processRoutes(t,r.children));return Object(Tt.a)(n).pipe(Object(Er.a)(),Object(xt.a)(t=>{}))}preloadConfig(t,e){return this.preloadingStrategy.preload(e,()=>this.loader.load(t.injector,e).pipe(Object(gx.a)(t=>(e._loadedConfig=t,this.processRoutes(t.module,t.routes)))))}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(ZT),r.Rb(r.x),r.Rb(r.i),r.Rb(r.s),r.Rb(JT))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})(),nC=(()=>{class t{constructor(t,e,n={}){this.router=t,this.viewportScroller=e,this.options=n,this.lastId=0,this.lastSource="imperative",this.restoredId=0,this.store={},n.scrollPositionRestoration=n.scrollPositionRestoration||"disabled",n.anchorScrolling=n.anchorScrolling||"disabled"}init(){"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.setHistoryScrollRestoration("manual"),this.routerEventsSubscription=this.createScrollEvents(),this.scrollEventsSubscription=this.consumeScrollEvents()}createScrollEvents(){return this.router.events.subscribe(t=>{t instanceof Ex?(this.store[this.lastId]=this.viewportScroller.getScrollPosition(),this.lastSource=t.navigationTrigger,this.restoredId=t.restoredState?t.restoredState.navigationId:0):t instanceof Sx&&(this.lastId=t.id,this.scheduleScrollEvent(t,this.router.parseUrl(t.urlAfterRedirects).fragment))})}consumeScrollEvents(){return this.router.events.subscribe(t=>{t instanceof Bx&&(t.position?"top"===this.options.scrollPositionRestoration?this.viewportScroller.scrollToPosition([0,0]):"enabled"===this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition(t.position):t.anchor&&"enabled"===this.options.anchorScrolling?this.viewportScroller.scrollToAnchor(t.anchor):"disabled"!==this.options.scrollPositionRestoration&&this.viewportScroller.scrollToPosition([0,0]))})}scheduleScrollEvent(t,e){this.router.triggerEvent(new Bx(t,"popstate"===this.lastSource?this.store[this.restoredId]:null,e))}ngOnDestroy(){this.routerEventsSubscription&&this.routerEventsSubscription.unsubscribe(),this.scrollEventsSubscription&&this.scrollEventsSubscription.unsubscribe()}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(ZT),r.Rb(z),r.Rb(void 0))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})();const rC=new r.r("ROUTER_CONFIGURATION"),iC=new r.r("ROUTER_FORROOT_GUARD"),oC=[x,{provide:sw,useClass:aw},{provide:ZT,useFactory:function(t,e,n,r,i,s,a,c={},l,u){const h=new ZT(null,t,e,n,r,i,s,Zx(a));if(l&&(h.urlHandlingStrategy=l),u&&(h.routeReuseStrategy=u),function(t,e){t.errorHandler&&(e.errorHandler=t.errorHandler),t.malformedUriErrorHandler&&(e.malformedUriErrorHandler=t.malformedUriErrorHandler),t.onSameUrlNavigation&&(e.onSameUrlNavigation=t.onSameUrlNavigation),t.paramsInheritanceStrategy&&(e.paramsInheritanceStrategy=t.paramsInheritanceStrategy),t.relativeLinkResolution&&(e.relativeLinkResolution=t.relativeLinkResolution),t.urlUpdateStrategy&&(e.urlUpdateStrategy=t.urlUpdateStrategy)}(c,h),c.enableTracing){const t=o();h.events.subscribe(e=>{t.logGroup(`Router Event: ${e.constructor.name}`),t.log(e.toString()),t.log(e),t.logGroupEnd()})}return h},deps:[sw,qT,x,r.s,r.x,r.i,BT,rC,[class{},new r.B],[class{},new r.B]]},qT,{provide:Aw,useFactory:function(t){return t.routerState.root},deps:[ZT]},{provide:r.x,useClass:r.K},eC,tC,class{preload(t,e){return e().pipe(px(()=>Object(vt.a)(null)))}},{provide:rC,useValue:{enableTracing:!1}}];function sC(){return new r.z("Router",ZT)}let aC=(()=>{class t{constructor(t,e){}static forRoot(e,n){return{ngModule:t,providers:[oC,hC(e),{provide:iC,useFactory:uC,deps:[[ZT,new r.B,new r.J]]},{provide:rC,useValue:n||{}},{provide:g,useFactory:lC,deps:[a,[new r.p(y),new r.B],rC]},{provide:nC,useFactory:cC,deps:[ZT,z,rC]},{provide:JT,useExisting:n&&n.preloadingStrategy?n.preloadingStrategy:tC},{provide:r.z,multi:!0,useFactory:sC},[dC,{provide:r.d,multi:!0,useFactory:pC,deps:[dC]},{provide:mC,useFactory:fC,deps:[dC]},{provide:r.b,multi:!0,useExisting:mC}]]}}static forChild(e){return{ngModule:t,providers:[hC(e)]}}}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)(r.Rb(iC,8),r.Rb(ZT,8))}}),t})();function cC(t,e,n){return n.scrollOffset&&e.setOffset(n.scrollOffset),new nC(t,e,n)}function lC(t,e,n={}){return n.useHash?new b(t,e):new v(t,e)}function uC(t){return"guarded"}function hC(t){return[{provide:r.a,multi:!0,useValue:t},{provide:BT,multi:!0,useValue:t}]}let dC=(()=>{class t{constructor(t){this.injector=t,this.initNavigation=!1,this.resultOfPreactivationDone=new qt.a}appInitializer(){return this.injector.get(l,Promise.resolve(null)).then(()=>{let t=null;const e=new Promise(e=>t=e),n=this.injector.get(ZT),r=this.injector.get(rC);return"disabled"===r.initialNavigation?(n.setUpLocationChangeListener(),t(!0)):"enabled"===r.initialNavigation||"enabledBlocking"===r.initialNavigation?(n.hooks.afterPreactivation=()=>this.initNavigation?Object(vt.a)(null):(this.initNavigation=!0,t(!0),this.resultOfPreactivationDone),n.initialNavigation()):t(!0),e})}bootstrapListener(t){const e=this.injector.get(rC),n=this.injector.get(eC),i=this.injector.get(nC),o=this.injector.get(ZT),s=this.injector.get(r.g);t===s.components[0]&&("enabledNonBlocking"!==e.initialNavigation&&void 0!==e.initialNavigation||o.initialNavigation(),n.setUpPreloading(),i.init(),o.resetRootComponentType(s.componentTypes[0]),this.resultOfPreactivationDone.next(null),this.resultOfPreactivationDone.complete())}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(r.s))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})();function pC(t){return t.appInitializer.bind(t)}function fC(t){return t.bootstrapListener.bind(t)}const mC=new r.r("Router Initializer");var gC={prefix:"fas",iconName:"arrow-left",icon:[448,512,[],"f060","M257.5 445.1l-22.2 22.2c-9.4 9.4-24.6 9.4-33.9 0L7 273c-9.4-9.4-9.4-24.6 0-33.9L201.4 44.7c9.4-9.4 24.6-9.4 33.9 0l22.2 22.2c9.5 9.5 9.3 25-.4 34.3L136.6 216H424c13.3 0 24 10.7 24 24v32c0 13.3-10.7 24-24 24H136.6l120.5 114.8c9.8 9.3 10 24.8.4 34.3z"]},_C={prefix:"fas",iconName:"bell",icon:[448,512,[],"f0f3","M224 512c35.32 0 63.97-28.65 63.97-64H160.03c0 35.35 28.65 64 63.97 64zm215.39-149.71c-19.32-20.76-55.47-51.99-55.47-154.29 0-77.7-54.48-139.9-127.94-155.16V32c0-17.67-14.32-32-31.98-32s-31.98 14.33-31.98 32v20.84C118.56 68.1 64.08 130.3 64.08 208c0 102.3-36.15 133.53-55.47 154.29-6 6.45-8.66 14.16-8.61 21.71.11 16.4 12.98 32 32.1 32h383.8c19.12 0 32-15.6 32.1-32 .05-7.55-2.61-15.27-8.61-21.71z"]},yC={prefix:"fas",iconName:"car",icon:[512,512,[],"f1b9","M499.99 176h-59.87l-16.64-41.6C406.38 91.63 365.57 64 319.5 64h-127c-46.06 0-86.88 27.63-103.99 70.4L71.87 176H12.01C4.2 176-1.53 183.34.37 190.91l6 24C7.7 220.25 12.5 224 18.01 224h20.07C24.65 235.73 16 252.78 16 272v48c0 16.12 6.16 30.67 16 41.93V416c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32v-32h256v32c0 17.67 14.33 32 32 32h32c17.67 0 32-14.33 32-32v-54.07c9.84-11.25 16-25.8 16-41.93v-48c0-19.22-8.65-36.27-22.07-48H494c5.51 0 10.31-3.75 11.64-9.09l6-24c1.89-7.57-3.84-14.91-11.65-14.91zm-352.06-17.83c7.29-18.22 24.94-30.17 44.57-30.17h127c19.63 0 37.28 11.95 44.57 30.17L384 208H128l19.93-49.83zM96 319.8c-19.2 0-32-12.76-32-31.9S76.8 256 96 256s48 28.71 48 47.85-28.8 15.95-48 15.95zm320 0c-19.2 0-48 3.19-48-15.95S396.8 256 416 256s32 12.76 32 31.9-12.8 31.9-32 31.9z"]},vC={prefix:"fas",iconName:"edit",icon:[576,512,[],"f044","M402.6 83.2l90.2 90.2c3.8 3.8 3.8 10 0 13.8L274.4 405.6l-92.8 10.3c-12.4 1.4-22.9-9.1-21.5-21.5l10.3-92.8L388.8 83.2c3.8-3.8 10-3.8 13.8 0zm162-22.9l-48.8-48.8c-15.2-15.2-39.9-15.2-55.2 0l-35.4 35.4c-3.8 3.8-3.8 10 0 13.8l90.2 90.2c3.8 3.8 10 3.8 13.8 0l35.4-35.4c15.2-15.3 15.2-40 0-55.2zM384 346.2V448H64V128h229.8c3.2 0 6.2-1.3 8.5-3.5l40-40c7.6-7.6 2.2-20.5-8.5-20.5H48C21.5 64 0 85.5 0 112v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V306.2c0-10.7-12.9-16-20.5-8.5l-40 40c-2.2 2.3-3.5 5.3-3.5 8.5z"]},bC={prefix:"fas",iconName:"hand-holding-heart",icon:[576,512,[],"f4be","M275.3 250.5c7 7.4 18.4 7.4 25.5 0l108.9-114.2c31.6-33.2 29.8-88.2-5.6-118.8-30.8-26.7-76.7-21.9-104.9 7.7L288 36.9l-11.1-11.6C248.7-4.4 202.8-9.2 172 17.5c-35.3 30.6-37.2 85.6-5.6 118.8l108.9 114.2zm290 77.6c-11.8-10.7-30.2-10-42.6 0L430.3 402c-11.3 9.1-25.4 14-40 14H272c-8.8 0-16-7.2-16-16s7.2-16 16-16h78.3c15.9 0 30.7-10.9 33.3-26.6 3.3-20-12.1-37.4-31.6-37.4H192c-27 0-53.1 9.3-74.1 26.3L71.4 384H16c-8.8 0-16 7.2-16 16v96c0 8.8 7.2 16 16 16h356.8c14.5 0 28.6-4.9 40-14L564 377c15.2-12.1 16.4-35.3 1.3-48.9z"]},xC={prefix:"fas",iconName:"home",icon:[576,512,[],"f015","M280.37 148.26L96 300.11V464a16 16 0 0 0 16 16l112.06-.29a16 16 0 0 0 15.92-16V368a16 16 0 0 1 16-16h64a16 16 0 0 1 16 16v95.64a16 16 0 0 0 16 16.05L464 480a16 16 0 0 0 16-16V300L295.67 148.26a12.19 12.19 0 0 0-15.3 0zM571.6 251.47L488 182.56V44.05a12 12 0 0 0-12-12h-56a12 12 0 0 0-12 12v72.61L318.47 43a48 48 0 0 0-61 0L4.34 251.47a12 12 0 0 0-1.6 16.9l25.5 31A12 12 0 0 0 45.15 301l235.22-193.74a12.19 12.19 0 0 1 15.3 0L530.9 301a12 12 0 0 0 16.9-1.6l25.5-31a12 12 0 0 0-1.7-16.93z"]},wC={prefix:"fas",iconName:"magnet",icon:[512,512,[],"f076","M164.07 148.1H12a12 12 0 0 1-12-12v-80a36 36 0 0 1 36-36h104a36 36 0 0 1 36 36v80a11.89 11.89 0 0 1-11.93 12zm347.93-12V56a36 36 0 0 0-36-36H372a36 36 0 0 0-36 36v80a12 12 0 0 0 12 12h152a11.89 11.89 0 0 0 12-11.9zm-164 44a12 12 0 0 0-12 12v52c0 128.1-160 127.9-160 0v-52a12 12 0 0 0-12-12H12.1a12 12 0 0 0-12 12.1c.1 21.4.6 40.3 0 53.3 0 150.6 136.17 246.6 256.75 246.6s255-96 255-246.7c-.6-12.8-.2-33 0-53.2a12 12 0 0 0-12-12.1z"]},TC={prefix:"fas",iconName:"shopping-basket",icon:[576,512,[],"f291","M576 216v16c0 13.255-10.745 24-24 24h-8l-26.113 182.788C514.509 462.435 494.257 480 470.37 480H105.63c-23.887 0-44.139-17.565-47.518-41.212L32 256h-8c-13.255 0-24-10.745-24-24v-16c0-13.255 10.745-24 24-24h67.341l106.78-146.821c10.395-14.292 30.407-17.453 44.701-7.058 14.293 10.395 17.453 30.408 7.058 44.701L170.477 192h235.046L326.12 82.821c-10.395-14.292-7.234-34.306 7.059-44.701 14.291-10.395 34.306-7.235 44.701 7.058L484.659 192H552c13.255 0 24 10.745 24 24zM312 392V280c0-13.255-10.745-24-24-24s-24 10.745-24 24v112c0 13.255 10.745 24 24 24s24-10.745 24-24zm112 0V280c0-13.255-10.745-24-24-24s-24 10.745-24 24v112c0 13.255 10.745 24 24 24s24-10.745 24-24zm-224 0V280c0-13.255-10.745-24-24-24s-24 10.745-24 24v112c0 13.255 10.745 24 24 24s24-10.745 24-24z"]},CC={prefix:"fas",iconName:"user-alt",icon:[512,512,[],"f406","M256 288c79.5 0 144-64.5 144-144S335.5 0 256 0 112 64.5 112 144s64.5 144 144 144zm128 32h-55.1c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16H128C57.3 320 0 377.3 0 448v16c0 26.5 21.5 48 48 48h416c26.5 0 48-21.5 48-48v-16c0-70.7-57.3-128-128-128z"]};function EC(t,e){if(1&t&&(r.Nb(0,"tr"),r.Lb(1,"th",14),r.Nb(2,"td"),r.jc(3),r.Mb(),r.Nb(4,"td"),r.jc(5),r.Mb(),r.Nb(6,"td"),r.jc(7),r.Mb(),r.Nb(8,"td"),r.jc(9),r.Mb(),r.Mb()),2&t){const t=e.$implicit;r.Ab(3),r.kc(t.name),r.Ab(2),r.kc(t.email),r.Ab(2),r.kc(t.phone),r.Ab(2),r.kc(t.address)}}let SC=(()=>{class t{constructor(t,e,n){this.database=t,this.fbs=e,this.firestore=n,this.faEdit=vC,this.showInput=!1,this.showSeacrhSpace=!1,this.showInfo=!1,this.filterBy="category",this.dropDownOn1=!1,this.dropDownOn2=!1,this.chosenTopic="new",this.docs=[],this.myArray=[],this.loading=!0}ngOnInit(){this.database.list("users").valueChanges().subscribe(t=>{this.customers=t,this.docs=[],this.fbs.collection("users").valueChanges().subscribe(t=>{this.myArray=t,console.log(t)})})}showInputMeth(){this.showInput=!this.showInput}setFilterBy(t){this.filterBy=t,this.dropDownOn1=!1}filter(t){this.database.list("orders/",e=>e.orderByChild(`${this.filterBy}`).equalTo(t)).valueChanges().subscribe(t=>{this.customers=t,this.loading=!1})}getData(){return this.fbs.collection("users").snapshotChanges()}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(Ue),r.Kb(py),r.Kb(py))},t.\u0275cmp=r.Eb({type:t,selectors:[["app-customers"]],decls:31,vars:1,consts:[["id","main",1,"main"],[1,"pagetitle"],[1,"breadcrumb"],["routerLink","registration",1,"breadcrumb-item"],["href","dashboard"],[1,"section"],[1,"row"],[1,"col-lg-12"],[1,"card"],[1,"card-body"],[1,"card-title"],[1,"table","datatable"],["scope","col"],[4,"ngFor","ngForOf"],["scope","row"]],template:function(t,e){1&t&&(r.Nb(0,"main",0),r.Nb(1,"div",1),r.Nb(2,"h1"),r.jc(3,"Customers"),r.Mb(),r.Nb(4,"nav"),r.Nb(5,"ol",2),r.Nb(6,"li",3),r.Nb(7,"a",4),r.jc(8,"Home"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(9,"section",5),r.Nb(10,"div",6),r.Nb(11,"div",7),r.Nb(12,"div",8),r.Nb(13,"div",9),r.Nb(14,"h5",10),r.jc(15,"Customers "),r.Mb(),r.Nb(16,"table",11),r.Nb(17,"thead"),r.Nb(18,"tr"),r.Nb(19,"th",12),r.jc(20,"#"),r.Mb(),r.Nb(21,"th",12),r.jc(22,"Name"),r.Mb(),r.Nb(23,"th",12),r.jc(24,"Email"),r.Mb(),r.Nb(25,"th",12),r.jc(26,"phone"),r.Mb(),r.Nb(27,"th",12),r.jc(28,"Address"),r.Mb(),r.Mb(),r.Mb(),r.Nb(29,"tbody"),r.ic(30,EC,10,4,"tr",13),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb()),2&t&&(r.Ab(30),r.Zb("ngForOf",e.myArray))},directives:[KT,M],styles:[".main-customers[_ngcontent-%COMP%]{width:100%;height:100%}.mock-line[_ngcontent-%COMP%]{background-color:hsla(0,0%,50.2%,.425);width:100%;margin-top:5%;margin-bottom:5%;height:1px}.top-bar[_ngcontent-%COMP%]{width:100%;height:8.5vh;display:flex;align-items:center;justify-content:space-between;padding-left:1.5rem;padding-right:1.5rem}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:17rem;margin-right:1%;border-radius:.5rem;border:none;font-size:16px;padding:4px 4px 4px 10px;animation-name:input-anim;animation-duration:.5s;transition:ease-in-out}@keyframes input-anim{0%{width:1rem}to{width:17rem}}.search-button[_ngcontent-%COMP%]{border:none;margin-right:1%;cursor:pointer;padding:7px;border-radius:.5rem;transition:.2s ease-in-out;font-weight:700;background-color:#fff}.search-button[_ngcontent-%COMP%]:hover{transform:scale(105%);background-color:#038138;color:#fff}.search-space[_ngcontent-%COMP%]{position:absolute;width:21.5rem;top:0;right:0;background-color:#f4fdeb;height:100Vh;animation-name:search-space-anim-in;animation-duration:.5s;transition:ease-in-out;box-shadow:-3px 0 5px -2px grey;z-index:5}.search-space-top[_ngcontent-%COMP%]{width:90%;margin-left:7.5%;margin-top:5%;display:flex;flex-direction:row;align-items:center;gap:.5rem}.search-input[_ngcontent-%COMP%]{border:1px solid grey}@keyframes search-space-anim-in{0%{width:1rem}to{width:21.5rem}}@keyframes search-space-anim-out{0%{width:21.5rem}to{width:0}}h3[_ngcontent-%COMP%]{padding-left:1rem;font-weight:700;color:#fff}.toggle-details[_ngcontent-%COMP%], .toggle-details-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.toggle-details[_ngcontent-%COMP%]{gap:1rem;margin-right:2rem}.showDetails[_ngcontent-%COMP%]{margin-left:1rem;min-width:4rem}.filter-dropdown[_ngcontent-%COMP%]{z-index:3}.filterBy-span[_ngcontent-%COMP%]{font-size:14px;text-align:center;font-weight:700;cursor:pointer}.drop-down-container[_ngcontent-%COMP%], .filterBy-span[_ngcontent-%COMP%]{width:5rem;padding:4px;background-color:#fff}.drop-down-container[_ngcontent-%COMP%]{display:flex;list-style-type:none;flex-direction:column;align-items:center;justify-content:center;position:absolute;max-height:5rem;animation-name:drop-down-anim-in;animation-duration:.2s;transition:ease-in-out;box-shadow:0 3px 3px 2px hsla(0,0%,50.2%,.445)}.drop-down-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;border-bottom:1px solid hsla(0,0%,50.2%,.37);width:100%;text-align:center}.drop-down-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.drop-down-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{opacity:.8}@keyframes drop-down-anim-in{0%{height:1rem}to{height:5rem}}.top-table[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;align-items:center;gap:1rem;flex-wrap:nowrap;border-bottom:1px solid hsla(0,0%,50.2%,.848);padding-top:5px;padding-bottom:5px;font-weight:700;text-align:center;position:sticky;top:0}.customers[_ngcontent-%COMP%]{overflow-y:scroll;height:100vh;padding-top:1.5%}.customers[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;width:95%;margin:.5% 2.5% 2.5%;overflow:hidden;padding:1rem;height:84vh;overflow-y:scroll;background-color:rgba(229,233,236,.8274509803921568);border-radius:.5rem;box-shadow:2px 2px 5px 2px rgba(20,20,20,.096)}.customers[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;align-items:center;gap:1rem;flex-wrap:nowrap;border-bottom:1px solid rgba(77,76,76,.182);padding-top:5px;padding-bottom:5px;text-align:center;transition:.2s ease-in-out}.customers[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:rgba(204,202,202,.363)}.customers-individual[_ngcontent-%COMP%]{width:10rem;overflow:hidden}.cancel[_ngcontent-%COMP%]{background-color:tomato;width:5rem;cursor:pointer;border-radius:.5rem;transition:.3s ease-in-out;color:bisque}.cancel[_ngcontent-%COMP%]:hover{background-color:brown;color:#fff}.canceled[_ngcontent-%COMP%]{background-color:tomato;cursor:default;color:bisque;opacity:.4}.canceled[_ngcontent-%COMP%], .edit[_ngcontent-%COMP%]{width:5rem;border-radius:.5rem}.edit[_ngcontent-%COMP%]{background-color:#d3fd85;cursor:pointer;transition:.3s ease-in-out;color:#000}.edit[_ngcontent-%COMP%]:hover{background-color:#694b13;color:#fff}.freeze[_ngcontent-%COMP%]{background-color:#47f3ff;width:5rem;cursor:pointer;border-radius:.5rem;transition:.3s ease-in-out;color:#000}.freeze[_ngcontent-%COMP%]:hover{background-color:#21487c;color:#fff}#addbutton[_ngcontent-%COMP%]{line-height:12px;width:18px;font-size:8pt;font-family:tahoma;margin-top:1px;margin-right:2px;position:absolute;top:20;right:0;color:green}"]}),t})(),IC=(()=>{class t{constructor(){this.destroy$=new qt.a}ngOnInit(){}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=r.Eb({type:t,selectors:[["app-dashboard"]],decls:323,vars:0,consts:[["id","main",1,"main"],[1,"pagetitle"],[1,"breadcrumb"],[1,"breadcrumb-item"],["href","index.html"],[1,"breadcrumb-item","active"],[1,"section","dashboard"],[1,"row"],[1,"col-lg-8"],[1,"col-xxl-4","col-md-6"],[1,"card","info-card","sales-card"],[1,"filter"],["href","#","data-bs-toggle","dropdown",1,"icon"],[1,"bi","bi-three-dots"],[1,"dropdown-menu","dropdown-menu-end","dropdown-menu-arrow"],[1,"dropdown-header","text-start"],["href","#",1,"dropdown-item"],[1,"card-body"],[1,"card-title"],[1,"d-flex","align-items-center"],[1,"card-icon","rounded-circle","d-flex","align-items-center","justify-content-center"],[1,"bi","bi-cart"],[1,"ps-3"],[1,"text-success","small","pt-1","fw-bold"],[1,"text-muted","small","pt-2","ps-1"],[1,"card","info-card","revenue-card"],[1,"bi","bi-currency-dollar"],[1,"col-xxl-4","col-xl-12"],[1,"card","info-card","customers-card"],[1,"bi","bi-people"],[1,"text-danger","small","pt-1","fw-bold"],[1,"col-12"],[1,"card","recent-sales","overflow-auto"],[1,"table","table-borderless","datatable"],["scope","col"],["scope","row"],["href","#"],["href","#",1,"text-primary"],[1,"badge","bg-success"],[1,"badge","bg-warning"],["href","#",1,"text-primar"],[1,"badge","bg-danger"],[1,"card","top-selling","overflow-auto"],[1,"card-body","pb-0"],[1,"table","table-borderless"],["src","assets/img/product-1.jpg","alt",""],["href","#",1,"text-primary","fw-bold"],[1,"fw-bold"],["src","assets/img/product-2.jpg","alt",""],["src","assets/img/product-3.jpg","alt",""],["src","assets/img/product-4.jpg","alt",""],["src","assets/img/product-5.jpg","alt",""]],template:function(t,e){1&t&&(r.Nb(0,"main",0),r.Nb(1,"div",1),r.Nb(2,"h1"),r.jc(3,"Dashboard"),r.Mb(),r.Nb(4,"nav"),r.Nb(5,"ol",2),r.Nb(6,"li",3),r.Nb(7,"a",4),r.jc(8,"Home"),r.Mb(),r.Mb(),r.Nb(9,"li",5),r.jc(10,"Dashboard"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(11,"section",6),r.Nb(12,"div",7),r.Nb(13,"div",8),r.Nb(14,"div",7),r.Nb(15,"div",9),r.Nb(16,"div",10),r.Nb(17,"div",11),r.Nb(18,"a",12),r.Lb(19,"i",13),r.Mb(),r.Nb(20,"ul",14),r.Nb(21,"li",15),r.Nb(22,"h6"),r.jc(23,"Filter"),r.Mb(),r.Mb(),r.Nb(24,"li"),r.Nb(25,"a",16),r.jc(26,"Today"),r.Mb(),r.Mb(),r.Nb(27,"li"),r.Nb(28,"a",16),r.jc(29,"This Month"),r.Mb(),r.Mb(),r.Nb(30,"li"),r.Nb(31,"a",16),r.jc(32,"This Year"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(33,"div",17),r.Nb(34,"h5",18),r.jc(35,"Sales "),r.Nb(36,"span"),r.jc(37,"| Today"),r.Mb(),r.Mb(),r.Nb(38,"div",19),r.Nb(39,"div",20),r.Lb(40,"i",21),r.Mb(),r.Nb(41,"div",22),r.Nb(42,"h6"),r.jc(43,"145"),r.Mb(),r.Nb(44,"span",23),r.jc(45,"12%"),r.Mb(),r.Nb(46,"span",24),r.jc(47,"increase"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(48,"div",9),r.Nb(49,"div",25),r.Nb(50,"div",11),r.Nb(51,"a",12),r.Lb(52,"i",13),r.Mb(),r.Nb(53,"ul",14),r.Nb(54,"li",15),r.Nb(55,"h6"),r.jc(56,"Filter"),r.Mb(),r.Mb(),r.Nb(57,"li"),r.Nb(58,"a",16),r.jc(59,"Today"),r.Mb(),r.Mb(),r.Nb(60,"li"),r.Nb(61,"a",16),r.jc(62,"This Month"),r.Mb(),r.Mb(),r.Nb(63,"li"),r.Nb(64,"a",16),r.jc(65,"This Year"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(66,"div",17),r.Nb(67,"h5",18),r.jc(68,"Revenue "),r.Nb(69,"span"),r.jc(70,"| This Month"),r.Mb(),r.Mb(),r.Nb(71,"div",19),r.Nb(72,"div",20),r.Lb(73,"i",26),r.Mb(),r.Nb(74,"div",22),r.Nb(75,"h6"),r.jc(76,"$3,264"),r.Mb(),r.Nb(77,"span",23),r.jc(78,"8%"),r.Mb(),r.Nb(79,"span",24),r.jc(80,"increase"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(81,"div",27),r.Nb(82,"div",28),r.Nb(83,"div",11),r.Nb(84,"a",12),r.Lb(85,"i",13),r.Mb(),r.Nb(86,"ul",14),r.Nb(87,"li",15),r.Nb(88,"h6"),r.jc(89,"Filter"),r.Mb(),r.Mb(),r.Nb(90,"li"),r.Nb(91,"a",16),r.jc(92,"Today"),r.Mb(),r.Mb(),r.Nb(93,"li"),r.Nb(94,"a",16),r.jc(95,"This Month"),r.Mb(),r.Mb(),r.Nb(96,"li"),r.Nb(97,"a",16),r.jc(98,"This Year"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(99,"div",17),r.Nb(100,"h5",18),r.jc(101,"Customers "),r.Nb(102,"span"),r.jc(103,"| This Year"),r.Mb(),r.Mb(),r.Nb(104,"div",19),r.Nb(105,"div",20),r.Lb(106,"i",29),r.Mb(),r.Nb(107,"div",22),r.Nb(108,"h6"),r.jc(109,"1244"),r.Mb(),r.Nb(110,"span",30),r.jc(111,"12%"),r.Mb(),r.Nb(112,"span",24),r.jc(113,"decrease"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(114,"div",31),r.Nb(115,"div",32),r.Nb(116,"div",11),r.Nb(117,"a",12),r.Lb(118,"i",13),r.Mb(),r.Nb(119,"ul",14),r.Nb(120,"li",15),r.Nb(121,"h6"),r.jc(122,"Filter"),r.Mb(),r.Mb(),r.Nb(123,"li"),r.Nb(124,"a",16),r.jc(125,"Today"),r.Mb(),r.Mb(),r.Nb(126,"li"),r.Nb(127,"a",16),r.jc(128,"This Month"),r.Mb(),r.Mb(),r.Nb(129,"li"),r.Nb(130,"a",16),r.jc(131,"This Year"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(132,"div",17),r.Nb(133,"h5",18),r.jc(134,"Recent Sales "),r.Nb(135,"span"),r.jc(136,"| Today"),r.Mb(),r.Mb(),r.Nb(137,"table",33),r.Nb(138,"thead"),r.Nb(139,"tr"),r.Nb(140,"th",34),r.jc(141,"#"),r.Mb(),r.Nb(142,"th",34),r.jc(143,"Customer"),r.Mb(),r.Nb(144,"th",34),r.jc(145,"Product"),r.Mb(),r.Nb(146,"th",34),r.jc(147,"Price"),r.Mb(),r.Nb(148,"th",34),r.jc(149,"Status"),r.Mb(),r.Mb(),r.Mb(),r.Nb(150,"tbody"),r.Nb(151,"tr"),r.Nb(152,"th",35),r.Nb(153,"a",36),r.jc(154,"#2457"),r.Mb(),r.Mb(),r.Nb(155,"td"),r.jc(156,"zaher najib"),r.Mb(),r.Nb(157,"td"),r.Nb(158,"a",37),r.jc(159,"At praesentium minu"),r.Mb(),r.Mb(),r.Nb(160,"td"),r.jc(161,"$64"),r.Mb(),r.Nb(162,"td"),r.Nb(163,"span",38),r.jc(164,"Approved"),r.Mb(),r.Mb(),r.Mb(),r.Nb(165,"tr"),r.Nb(166,"th",35),r.Nb(167,"a",36),r.jc(168,"#2147"),r.Mb(),r.Mb(),r.Nb(169,"td"),r.jc(170,"Bridie Kessler"),r.Mb(),r.Nb(171,"td"),r.Nb(172,"a",37),r.jc(173,"Blanditiis dolor omnis similique"),r.Mb(),r.Mb(),r.Nb(174,"td"),r.jc(175,"$47"),r.Mb(),r.Nb(176,"td"),r.Nb(177,"span",39),r.jc(178,"Pending"),r.Mb(),r.Mb(),r.Mb(),r.Nb(179,"tr"),r.Nb(180,"th",35),r.Nb(181,"a",36),r.jc(182,"#2049"),r.Mb(),r.Mb(),r.Nb(183,"td"),r.jc(184,"Ashleigh Langosh"),r.Mb(),r.Nb(185,"td"),r.Nb(186,"a",37),r.jc(187,"At recusandae consectetur"),r.Mb(),r.Mb(),r.Nb(188,"td"),r.jc(189,"$147"),r.Mb(),r.Nb(190,"td"),r.Nb(191,"span",38),r.jc(192,"Approved"),r.Mb(),r.Mb(),r.Mb(),r.Nb(193,"tr"),r.Nb(194,"th",35),r.Nb(195,"a",36),r.jc(196,"#2644"),r.Mb(),r.Mb(),r.Nb(197,"td"),r.jc(198,"Angus Grady"),r.Mb(),r.Nb(199,"td"),r.Nb(200,"a",40),r.jc(201,"Ut voluptatem id earum et"),r.Mb(),r.Mb(),r.Nb(202,"td"),r.jc(203,"$67"),r.Mb(),r.Nb(204,"td"),r.Nb(205,"span",41),r.jc(206,"Rejected"),r.Mb(),r.Mb(),r.Mb(),r.Nb(207,"tr"),r.Nb(208,"th",35),r.Nb(209,"a",36),r.jc(210,"#2644"),r.Mb(),r.Mb(),r.Nb(211,"td"),r.jc(212,"Raheem Lehner"),r.Mb(),r.Nb(213,"td"),r.Nb(214,"a",37),r.jc(215,"Sunt similique distinctio"),r.Mb(),r.Mb(),r.Nb(216,"td"),r.jc(217,"$165"),r.Mb(),r.Nb(218,"td"),r.Nb(219,"span",38),r.jc(220,"Approved"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(221,"div",31),r.Nb(222,"div",42),r.Nb(223,"div",11),r.Nb(224,"a",12),r.Lb(225,"i",13),r.Mb(),r.Nb(226,"ul",14),r.Nb(227,"li",15),r.Nb(228,"h6"),r.jc(229,"Filter"),r.Mb(),r.Mb(),r.Nb(230,"li"),r.Nb(231,"a",16),r.jc(232,"Today"),r.Mb(),r.Mb(),r.Nb(233,"li"),r.Nb(234,"a",16),r.jc(235,"This Month"),r.Mb(),r.Mb(),r.Nb(236,"li"),r.Nb(237,"a",16),r.jc(238,"This Year"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(239,"div",43),r.Nb(240,"h5",18),r.jc(241,"Top Selling "),r.Nb(242,"span"),r.jc(243,"| Today"),r.Mb(),r.Mb(),r.Nb(244,"table",44),r.Nb(245,"thead"),r.Nb(246,"tr"),r.Nb(247,"th",34),r.jc(248,"Preview"),r.Mb(),r.Nb(249,"th",34),r.jc(250,"Product"),r.Mb(),r.Nb(251,"th",34),r.jc(252,"Price"),r.Mb(),r.Nb(253,"th",34),r.jc(254,"Sold"),r.Mb(),r.Nb(255,"th",34),r.jc(256,"Revenue"),r.Mb(),r.Mb(),r.Mb(),r.Nb(257,"tbody"),r.Nb(258,"tr"),r.Nb(259,"th",35),r.Nb(260,"a",36),r.Lb(261,"img",45),r.Mb(),r.Mb(),r.Nb(262,"td"),r.Nb(263,"a",46),r.jc(264,"Ut inventore ipsa voluptas nulla"),r.Mb(),r.Mb(),r.Nb(265,"td"),r.jc(266,"$64"),r.Mb(),r.Nb(267,"td",47),r.jc(268,"124"),r.Mb(),r.Nb(269,"td"),r.jc(270,"$5,828"),r.Mb(),r.Mb(),r.Nb(271,"tr"),r.Nb(272,"th",35),r.Nb(273,"a",36),r.Lb(274,"img",48),r.Mb(),r.Mb(),r.Nb(275,"td"),r.Nb(276,"a",46),r.jc(277,"Exercitationem similique doloremque"),r.Mb(),r.Mb(),r.Nb(278,"td"),r.jc(279,"$46"),r.Mb(),r.Nb(280,"td",47),r.jc(281,"98"),r.Mb(),r.Nb(282,"td"),r.jc(283,"$4,508"),r.Mb(),r.Mb(),r.Nb(284,"tr"),r.Nb(285,"th",35),r.Nb(286,"a",36),r.Lb(287,"img",49),r.Mb(),r.Mb(),r.Nb(288,"td"),r.Nb(289,"a",46),r.jc(290,"Doloribus nisi exercitationem"),r.Mb(),r.Mb(),r.Nb(291,"td"),r.jc(292,"$59"),r.Mb(),r.Nb(293,"td",47),r.jc(294,"74"),r.Mb(),r.Nb(295,"td"),r.jc(296,"$4,366"),r.Mb(),r.Mb(),r.Nb(297,"tr"),r.Nb(298,"th",35),r.Nb(299,"a",36),r.Lb(300,"img",50),r.Mb(),r.Mb(),r.Nb(301,"td"),r.Nb(302,"a",46),r.jc(303,"Officiis quaerat sint rerum error"),r.Mb(),r.Mb(),r.Nb(304,"td"),r.jc(305,"$32"),r.Mb(),r.Nb(306,"td",47),r.jc(307,"63"),r.Mb(),r.Nb(308,"td"),r.jc(309,"$2,016"),r.Mb(),r.Mb(),r.Nb(310,"tr"),r.Nb(311,"th",35),r.Nb(312,"a",36),r.Lb(313,"img",51),r.Mb(),r.Mb(),r.Nb(314,"td"),r.Nb(315,"a",46),r.jc(316,"Sit unde debitis delectus repellendus"),r.Mb(),r.Mb(),r.Nb(317,"td"),r.jc(318,"$79"),r.Mb(),r.Nb(319,"td",47),r.jc(320,"41"),r.Mb(),r.Nb(321,"td"),r.jc(322,"$3,239"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb())},styles:[""]}),t})();function kC(t,e){if(1&t&&(r.Nb(0,"tr"),r.Lb(1,"th",11),r.Nb(2,"td"),r.jc(3),r.Mb(),r.Nb(4,"td"),r.jc(5),r.Mb(),r.Nb(6,"td"),r.jc(7),r.Mb(),r.Nb(8,"td"),r.jc(9),r.Mb(),r.Nb(10,"td"),r.Nb(11,"span",12),r.jc(12,"Approve"),r.Mb(),r.jc(13," \xa0 "),r.Nb(14,"span",13),r.jc(15,"Reject"),r.Mb(),r.Mb(),r.Mb()),2&t){const t=e.$implicit;r.Ab(3),r.kc(t.shopname),r.Ab(2),r.kc(t.email),r.Ab(2),r.kc(t.phone),r.Ab(2),r.kc(t.Address)}}let AC=(()=>{class t{constructor(t){this.fbs=t,this.faArrowLeft=gC,this.myArray=[]}ngOnInit(){this.fbs.collection("shopOwners",t=>t.where("isverified","==","false")).valueChanges().subscribe(t=>{this.myArray=t,console.log(t)})}changeName(t){this.shopname=t}changeAddress(t){this.shopAdress=t}changeDescription(t){this.shopDescription=t}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(py))},t.\u0275cmp=r.Eb({type:t,selectors:[["app-edit-shop"]],decls:27,vars:1,consts:[["id","main",1,"main"],[1,"section"],[1,"row"],[1,"col-lg-12"],[1,"card"],[1,"card-body"],[1,"card-title"],["id","Addbutton","type","button",1,"btn","btn-primary"],[1,"table","datatable"],["scope","col"],[4,"ngFor","ngForOf"],["scope","row"],["onclick","console.log('approved shopowners')",1,"badge","bg-success"],["onclick","console.log('rejected shopowners')",1,"badge","bg-danger"]],template:function(t,e){1&t&&(r.Nb(0,"main",0),r.Nb(1,"section",1),r.Nb(2,"div",2),r.Nb(3,"div",3),r.Nb(4,"div",4),r.Nb(5,"div",5),r.Nb(6,"h5",6),r.jc(7," Edit Shopowners "),r.Nb(8,"button",7),r.jc(9,"Add shopowner"),r.Mb(),r.Mb(),r.Nb(10,"table",8),r.Nb(11,"thead"),r.Nb(12,"tr"),r.Nb(13,"th",9),r.jc(14,"#"),r.Mb(),r.Nb(15,"th",9),r.jc(16,"ShopName"),r.Mb(),r.Nb(17,"th",9),r.jc(18,"Email"),r.Mb(),r.Nb(19,"th",9),r.jc(20,"phone"),r.Mb(),r.Nb(21,"th",9),r.jc(22,"Address"),r.Mb(),r.Nb(23,"th",9),r.jc(24,"Status"),r.Mb(),r.Mb(),r.Mb(),r.Nb(25,"tbody"),r.ic(26,kC,16,4,"tr",10),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb()),2&t&&(r.Ab(26),r.Zb("ngForOf",e.myArray))},directives:[M],styles:[".main-customers[_ngcontent-%COMP%]{width:100%;height:100%}.mock-line[_ngcontent-%COMP%]{background-color:hsla(0,0%,50.2%,.425);width:100%;margin-top:5%;margin-bottom:5%;height:1px}.top-bar[_ngcontent-%COMP%]{height:8.5vh;align-items:center;justify-content:space-between;padding-left:1.5rem;padding-right:1.5rem}.container[_ngcontent-%COMP%], .top-bar[_ngcontent-%COMP%]{width:100%;display:flex}.container[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:nowrap;padding-top:1rem}h1[_ngcontent-%COMP%]{font-weight:700;font-size:18px;margin-bottom:3rem;height:2rem;width:100%;text-align:center}.left[_ngcontent-%COMP%]{width:80%;height:91.5vh;border-right:2px solid hsla(0,0%,50.2%,.247);padding-top:1rem}form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center}label[_ngcontent-%COMP%]{font-weight:700;margin-top:1rem;margin-bottom:.5rem}input[_ngcontent-%COMP%]{border-radius:.3rem;background-color:rgba(206,211,214,.28627450980392155);border:none;padding:8px;width:30%}.right[_ngcontent-%COMP%]{width:30%;height:91.5vh;display:flex;flex-direction:column;align-items:center;padding-top:1rem}.mobile[_ngcontent-%COMP%]{width:15rem;height:28rem;border:1px solid grey;border-radius:1rem;padding:1.5%}.mobile-top-bar[_ngcontent-%COMP%]{width:100%;height:5%}.mobile-shop-title[_ngcontent-%COMP%]{padding:0;font-size:14px;margin-top:.3rem;font-weight:700}.moble-shop-address[_ngcontent-%COMP%]{font-size:10px}.mobile-shop-description[_ngcontent-%COMP%]{font-size:12px;font-weight:lighter;line-height:.85rem;margin-top:.3rem}.mobile-shop-news-image[_ngcontent-%COMP%]{width:100%;height:7rem;margin-top:.7rem;border-radius:.3rem;background-position:50%;background-size:cover;background-image:url(https://blog.businesswire.com/hubfs/Images/All%20Stock%20Images/AdobeStock_76425572-media.jpg)}#Addbutton[_ngcontent-%COMP%]{line-height:12px;width:18px;font-size:8pt;font-family:tahoma;margin-top:1px;margin-right:2px;position:absolute;top:20;right:0;color:green}"]}),t})();var MC=n("XoHu");function OC(t,e){return new yt.a(n=>{const r=t.length;if(0===r)return void n.complete();const i=new Array(r);let o=0,s=0;for(let a=0;a<r;a++){const c=Object(Tt.a)(t[a]);let l=!1;n.add(c.subscribe({next:t=>{l||(l=!0,s++),i[a]=t},error:t=>n.error(t),complete:()=>{o++,o!==r&&l||(s===r&&n.next(e?e.reduce((t,e,n)=>(t[e]=i[n],t),{}):i),n.complete())}}))}})}const PC=new r.r("NgValueAccessor"),DC={provide:PC,useExisting:Object(r.U)(()=>RC),multi:!0};let RC=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{}}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"checked",t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.E),r.Kb(r.l))},t.\u0275dir=r.Fb({type:t,selectors:[["input","type","checkbox","formControlName",""],["input","type","checkbox","formControl",""],["input","type","checkbox","ngModel",""]],hostBindings:function(t,e){1&t&&r.Ub("change",function(t){return e.onChange(t.target.checked)})("blur",function(){return e.onTouched()})},features:[r.zb([DC])]}),t})();const NC={provide:PC,useExisting:Object(r.U)(()=>jC),multi:!0},LC=new r.r("CompositionEventMode");let jC=(()=>{class t{constructor(t,e,n){this._renderer=t,this._elementRef=e,this._compositionMode=n,this.onChange=t=>{},this.onTouched=()=>{},this._composing=!1,null==this._compositionMode&&(this._compositionMode=!function(){const t=o()?o().getUserAgent():"";return/android (\d+)/.test(t.toLowerCase())}())}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=t}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_handleInput(t){(!this._compositionMode||this._compositionMode&&!this._composing)&&this.onChange(t)}_compositionStart(){this._composing=!0}_compositionEnd(t){this._composing=!1,this._compositionMode&&this.onChange(t)}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.E),r.Kb(r.l),r.Kb(LC,8))},t.\u0275dir=r.Fb({type:t,selectors:[["input","formControlName","",3,"type","checkbox"],["textarea","formControlName",""],["input","formControl","",3,"type","checkbox"],["textarea","formControl",""],["input","ngModel","",3,"type","checkbox"],["textarea","ngModel",""],["","ngDefaultControl",""]],hostBindings:function(t,e){1&t&&r.Ub("input",function(t){return e._handleInput(t.target.value)})("blur",function(){return e.onTouched()})("compositionstart",function(){return e._compositionStart()})("compositionend",function(t){return e._compositionEnd(t.target.value)})},features:[r.zb([NC])]}),t})();function zC(t){return null==t||0===t.length}function FC(t){return null!=t&&"number"==typeof t.length}const BC=new r.r("NgValidators"),UC=new r.r("NgAsyncValidators"),VC=/^(?=.{1,254}$)(?=.{1,64}@)[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+(?:\.[a-zA-Z0-9!#$%&'*+/=?^_`{|}~-]+)*@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/;class qC{static min(t){return e=>{if(zC(e.value)||zC(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n<t?{min:{min:t,actual:e.value}}:null}}static max(t){return e=>{if(zC(e.value)||zC(t))return null;const n=parseFloat(e.value);return!isNaN(n)&&n>t?{max:{max:t,actual:e.value}}:null}}static required(t){return zC(t.value)?{required:!0}:null}static requiredTrue(t){return!0===t.value?null:{required:!0}}static email(t){return zC(t.value)||VC.test(t.value)?null:{email:!0}}static minLength(t){return e=>zC(e.value)||!FC(e.value)?null:e.value.length<t?{minlength:{requiredLength:t,actualLength:e.value.length}}:null}static maxLength(t){return e=>FC(e.value)&&e.value.length>t?{maxlength:{requiredLength:t,actualLength:e.value.length}}:null}static pattern(t){if(!t)return qC.nullValidator;let e,n;return"string"==typeof t?(n="","^"!==t.charAt(0)&&(n+="^"),n+=t,"$"!==t.charAt(t.length-1)&&(n+="$"),e=new RegExp(n)):(n=t.toString(),e=t),t=>{if(zC(t.value))return null;const r=t.value;return e.test(r)?null:{pattern:{requiredPattern:n,actualValue:r}}}}static nullValidator(t){return null}static compose(t){if(!t)return null;const e=t.filter(GC);return 0==e.length?null:function(t){return WC(HC(t,e))}}static composeAsync(t){if(!t)return null;const e=t.filter(GC);return 0==e.length?null:function(t){return function(...t){if(1===t.length){const e=t[0];if(Object(ax.a)(e))return OC(e,null);if(Object(MC.a)(e)&&Object.getPrototypeOf(e)===Object.prototype){const t=Object.keys(e);return OC(t.map(t=>e[t]),t)}}if("function"==typeof t[t.length-1]){const e=t.pop();return OC(t=1===t.length&&Object(ax.a)(t[0])?t[0]:t,null).pipe(Object(xt.a)(t=>e(...t)))}return OC(t,null)}(HC(t,e).map($C)).pipe(Object(xt.a)(WC))}}}function GC(t){return null!=t}function $C(t){const e=Object(r.rb)(t)?Object(Tt.a)(t):t;return Object(r.qb)(e),e}function WC(t){let e={};return t.forEach(t=>{e=null!=t?Object.assign(Object.assign({},e),t):e}),0===Object.keys(e).length?null:e}function HC(t,e){return e.map(e=>e(t))}function ZC(t){return t.map(t=>function(t){return!t.validate}(t)?t:e=>t.validate(e))}function KC(t){return null!=t?qC.compose(ZC(t)):null}function XC(t){return null!=t?qC.composeAsync(ZC(t)):null}function YC(t,e){return null===t?[e]:Array.isArray(t)?[...t,e]:[t,e]}let QC=(()=>{class t{constructor(){this._rawValidators=[],this._rawAsyncValidators=[],this._onDestroyCallbacks=[]}get value(){return this.control?this.control.value:null}get valid(){return this.control?this.control.valid:null}get invalid(){return this.control?this.control.invalid:null}get pending(){return this.control?this.control.pending:null}get disabled(){return this.control?this.control.disabled:null}get enabled(){return this.control?this.control.enabled:null}get errors(){return this.control?this.control.errors:null}get pristine(){return this.control?this.control.pristine:null}get dirty(){return this.control?this.control.dirty:null}get touched(){return this.control?this.control.touched:null}get status(){return this.control?this.control.status:null}get untouched(){return this.control?this.control.untouched:null}get statusChanges(){return this.control?this.control.statusChanges:null}get valueChanges(){return this.control?this.control.valueChanges:null}get path(){return null}_setValidators(t){this._rawValidators=t||[],this._composedValidatorFn=KC(this._rawValidators)}_setAsyncValidators(t){this._rawAsyncValidators=t||[],this._composedAsyncValidatorFn=XC(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn||null}get asyncValidator(){return this._composedAsyncValidatorFn||null}_registerOnDestroy(t){this._onDestroyCallbacks.push(t)}_invokeOnDestroyCallbacks(){this._onDestroyCallbacks.forEach(t=>t()),this._onDestroyCallbacks=[]}reset(t){this.control&&this.control.reset(t)}hasError(t,e){return!!this.control&&this.control.hasError(t,e)}getError(t,e){return this.control?this.control.getError(t,e):null}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=r.Fb({type:t}),t})(),JC=(()=>{class t extends QC{get formDirective(){return null}get path(){return null}}return t.\u0275fac=function(e){return tE(e||t)},t.\u0275dir=r.Fb({type:t,features:[r.xb]}),t})();const tE=r.Pb(JC);class eE extends QC{constructor(){super(...arguments),this._parent=null,this.name=null,this.valueAccessor=null}}class nE{constructor(t){this._cd=t}is(t){var e,n;return!!(null===(n=null===(e=this._cd)||void 0===e?void 0:e.control)||void 0===n?void 0:n[t])}}let rE=(()=>{class t extends nE{constructor(t){super(t)}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(eE,2))},t.\u0275dir=r.Fb({type:t,selectors:[["","formControlName",""],["","ngModel",""],["","formControl",""]],hostVars:14,hostBindings:function(t,e){2&t&&r.Cb("ng-untouched",e.is("untouched"))("ng-touched",e.is("touched"))("ng-pristine",e.is("pristine"))("ng-dirty",e.is("dirty"))("ng-valid",e.is("valid"))("ng-invalid",e.is("invalid"))("ng-pending",e.is("pending"))},features:[r.xb]}),t})(),iE=(()=>{class t extends nE{constructor(t){super(t)}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(JC,10))},t.\u0275dir=r.Fb({type:t,selectors:[["","formGroupName",""],["","formArrayName",""],["","ngModelGroup",""],["","formGroup",""],["form",3,"ngNoForm",""],["","ngForm",""]],hostVars:14,hostBindings:function(t,e){2&t&&r.Cb("ng-untouched",e.is("untouched"))("ng-touched",e.is("touched"))("ng-pristine",e.is("pristine"))("ng-dirty",e.is("dirty"))("ng-valid",e.is("valid"))("ng-invalid",e.is("invalid"))("ng-pending",e.is("pending"))},features:[r.xb]}),t})();const oE={provide:PC,useExisting:Object(r.U)(()=>sE),multi:!0};let sE=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{}}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",null==t?"":t)}registerOnChange(t){this.onChange=e=>{t(""==e?null:parseFloat(e))}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.E),r.Kb(r.l))},t.\u0275dir=r.Fb({type:t,selectors:[["input","type","number","formControlName",""],["input","type","number","formControl",""],["input","type","number","ngModel",""]],hostBindings:function(t,e){1&t&&r.Ub("input",function(t){return e.onChange(t.target.value)})("blur",function(){return e.onTouched()})},features:[r.zb([oE])]}),t})();const aE={provide:PC,useExisting:Object(r.U)(()=>lE),multi:!0};let cE=(()=>{class t{constructor(){this._accessors=[]}add(t,e){this._accessors.push([t,e])}remove(t){for(let e=this._accessors.length-1;e>=0;--e)if(this._accessors[e][1]===t)return void this._accessors.splice(e,1)}select(t){this._accessors.forEach(e=>{this._isSameGroup(e,t)&&e[1]!==t&&e[1].fireUncheck(t.value)})}_isSameGroup(t,e){return!!t[0].control&&t[0]._parent===e._control._parent&&t[1].name===e.name}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac}),t})(),lE=(()=>{class t{constructor(t,e,n,r){this._renderer=t,this._elementRef=e,this._registry=n,this._injector=r,this.onChange=()=>{},this.onTouched=()=>{}}ngOnInit(){this._control=this._injector.get(eE),this._checkName(),this._registry.add(this._control,this)}ngOnDestroy(){this._registry.remove(this)}writeValue(t){this._state=t===this.value,this._renderer.setProperty(this._elementRef.nativeElement,"checked",this._state)}registerOnChange(t){this._fn=t,this.onChange=()=>{t(this.value),this._registry.select(this)}}fireUncheck(t){this.writeValue(t)}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_checkName(){!this.name&&this.formControlName&&(this.name=this.formControlName)}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.E),r.Kb(r.l),r.Kb(cE),r.Kb(r.s))},t.\u0275dir=r.Fb({type:t,selectors:[["input","type","radio","formControlName",""],["input","type","radio","formControl",""],["input","type","radio","ngModel",""]],hostBindings:function(t,e){1&t&&r.Ub("change",function(){return e.onChange()})("blur",function(){return e.onTouched()})},inputs:{name:"name",formControlName:"formControlName",value:"value"},features:[r.zb([aE])]}),t})();const uE={provide:PC,useExisting:Object(r.U)(()=>hE),multi:!0};let hE=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this.onChange=t=>{},this.onTouched=()=>{}}writeValue(t){this._renderer.setProperty(this._elementRef.nativeElement,"value",parseFloat(t))}registerOnChange(t){this.onChange=e=>{t(""==e?null:parseFloat(e))}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.E),r.Kb(r.l))},t.\u0275dir=r.Fb({type:t,selectors:[["input","type","range","formControlName",""],["input","type","range","formControl",""],["input","type","range","ngModel",""]],hostBindings:function(t,e){1&t&&r.Ub("change",function(t){return e.onChange(t.target.value)})("input",function(t){return e.onChange(t.target.value)})("blur",function(){return e.onTouched()})},features:[r.zb([uE])]}),t})();const dE={provide:PC,useExisting:Object(r.U)(()=>pE),multi:!0};let pE=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=t=>{},this.onTouched=()=>{},this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){this.value=t;const e=this._getOptionId(t);null==e&&this._renderer.setProperty(this._elementRef.nativeElement,"selectedIndex",-1);const n=function(t,e){return null==t?`${e}`:(e&&"object"==typeof e&&(e="Object"),`${t}: ${e}`.slice(0,50))}(e,t);this._renderer.setProperty(this._elementRef.nativeElement,"value",n)}registerOnChange(t){this.onChange=e=>{this.value=this._getOptionValue(e),t(this.value)}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(){return(this._idCounter++).toString()}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e),t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e):t}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.E),r.Kb(r.l))},t.\u0275dir=r.Fb({type:t,selectors:[["select","formControlName","",3,"multiple",""],["select","formControl","",3,"multiple",""],["select","ngModel","",3,"multiple",""]],hostBindings:function(t,e){1&t&&r.Ub("change",function(t){return e.onChange(t.target.value)})("blur",function(){return e.onTouched()})},inputs:{compareWith:"compareWith"},features:[r.zb([dE])]}),t})();const fE={provide:PC,useExisting:Object(r.U)(()=>mE),multi:!0};let mE=(()=>{class t{constructor(t,e){this._renderer=t,this._elementRef=e,this._optionMap=new Map,this._idCounter=0,this.onChange=t=>{},this.onTouched=()=>{},this._compareWith=Object.is}set compareWith(t){this._compareWith=t}writeValue(t){let e;if(this.value=t,Array.isArray(t)){const n=t.map(t=>this._getOptionId(t));e=(t,e)=>{t._setSelected(n.indexOf(e.toString())>-1)}}else e=(t,e)=>{t._setSelected(!1)};this._optionMap.forEach(e)}registerOnChange(t){this.onChange=e=>{const n=[];if(void 0!==e.selectedOptions){const t=e.selectedOptions;for(let e=0;e<t.length;e++){const r=t.item(e),i=this._getOptionValue(r.value);n.push(i)}}else{const t=e.options;for(let e=0;e<t.length;e++){const r=t.item(e);if(r.selected){const t=this._getOptionValue(r.value);n.push(t)}}}this.value=n,t(n)}}registerOnTouched(t){this.onTouched=t}setDisabledState(t){this._renderer.setProperty(this._elementRef.nativeElement,"disabled",t)}_registerOption(t){const e=(this._idCounter++).toString();return this._optionMap.set(e,t),e}_getOptionId(t){for(const e of Array.from(this._optionMap.keys()))if(this._compareWith(this._optionMap.get(e)._value,t))return e;return null}_getOptionValue(t){const e=function(t){return t.split(":")[0]}(t);return this._optionMap.has(e)?this._optionMap.get(e)._value:t}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(r.E),r.Kb(r.l))},t.\u0275dir=r.Fb({type:t,selectors:[["select","multiple","","formControlName",""],["select","multiple","","formControl",""],["select","multiple","","ngModel",""]],hostBindings:function(t,e){1&t&&r.Ub("change",function(t){return e.onChange(t.target)})("blur",function(){return e.onTouched()})},inputs:{compareWith:"compareWith"},features:[r.zb([fE])]}),t})();function gE(t,e){yE(t,e,!0),e.valueAccessor.writeValue(t.value),function(t,e){e.valueAccessor.registerOnChange(n=>{t._pendingValue=n,t._pendingChange=!0,t._pendingDirty=!0,"change"===t.updateOn&&vE(t,e)})}(t,e),function(t,e){const n=(t,n)=>{e.valueAccessor.writeValue(t),n&&e.viewToModelUpdate(t)};t.registerOnChange(n),e._registerOnDestroy(()=>{t._unregisterOnChange(n)})}(t,e),function(t,e){e.valueAccessor.registerOnTouched(()=>{t._pendingTouched=!0,"blur"===t.updateOn&&t._pendingChange&&vE(t,e),"submit"!==t.updateOn&&t.markAsTouched()})}(t,e),function(t,e){if(e.valueAccessor.setDisabledState){const n=t=>{e.valueAccessor.setDisabledState(t)};t.registerOnDisabledChange(n),e._registerOnDestroy(()=>{t._unregisterOnDisabledChange(n)})}}(t,e)}function _E(t,e){t.forEach(t=>{t.registerOnValidatorChange&&t.registerOnValidatorChange(e)})}function yE(t,e,n){const r=function(t){return t._rawValidators}(t);null!==e.validator?t.setValidators(YC(r,e.validator)):"function"==typeof r&&t.setValidators([r]);const i=function(t){return t._rawAsyncValidators}(t);if(null!==e.asyncValidator?t.setAsyncValidators(YC(i,e.asyncValidator)):"function"==typeof i&&t.setAsyncValidators([i]),n){const n=()=>t.updateValueAndValidity();_E(e._rawValidators,n),_E(e._rawAsyncValidators,n)}}function vE(t,e){t._pendingDirty&&t.markAsDirty(),t.setValue(t._pendingValue,{emitModelToViewChange:!1}),e.viewToModelUpdate(t._pendingValue),t._pendingChange=!1}const bE=[RC,hE,sE,pE,mE,lE];function xE(t,e){const n=t.indexOf(e);n>-1&&t.splice(n,1)}const wE="VALID",TE="INVALID",CE="PENDING",EE="DISABLED";function SE(t){return(ME(t)?t.validators:t)||null}function IE(t){return Array.isArray(t)?KC(t):t||null}function kE(t,e){return(ME(e)?e.asyncValidators:t)||null}function AE(t){return Array.isArray(t)?XC(t):t||null}function ME(t){return null!=t&&!Array.isArray(t)&&"object"==typeof t}class OE{constructor(t,e){this._hasOwnPendingAsyncValidator=!1,this._onCollectionChange=()=>{},this._parent=null,this.pristine=!0,this.touched=!1,this._onDisabledChange=[],this._rawValidators=t,this._rawAsyncValidators=e,this._composedValidatorFn=IE(this._rawValidators),this._composedAsyncValidatorFn=AE(this._rawAsyncValidators)}get validator(){return this._composedValidatorFn}set validator(t){this._rawValidators=this._composedValidatorFn=t}get asyncValidator(){return this._composedAsyncValidatorFn}set asyncValidator(t){this._rawAsyncValidators=this._composedAsyncValidatorFn=t}get parent(){return this._parent}get valid(){return this.status===wE}get invalid(){return this.status===TE}get pending(){return this.status==CE}get disabled(){return this.status===EE}get enabled(){return this.status!==EE}get dirty(){return!this.pristine}get untouched(){return!this.touched}get updateOn(){return this._updateOn?this._updateOn:this.parent?this.parent.updateOn:"change"}setValidators(t){this._rawValidators=t,this._composedValidatorFn=IE(t)}setAsyncValidators(t){this._rawAsyncValidators=t,this._composedAsyncValidatorFn=AE(t)}clearValidators(){this.validator=null}clearAsyncValidators(){this.asyncValidator=null}markAsTouched(t={}){this.touched=!0,this._parent&&!t.onlySelf&&this._parent.markAsTouched(t)}markAllAsTouched(){this.markAsTouched({onlySelf:!0}),this._forEachChild(t=>t.markAllAsTouched())}markAsUntouched(t={}){this.touched=!1,this._pendingTouched=!1,this._forEachChild(t=>{t.markAsUntouched({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}markAsDirty(t={}){this.pristine=!1,this._parent&&!t.onlySelf&&this._parent.markAsDirty(t)}markAsPristine(t={}){this.pristine=!0,this._pendingDirty=!1,this._forEachChild(t=>{t.markAsPristine({onlySelf:!0})}),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}markAsPending(t={}){this.status=CE,!1!==t.emitEvent&&this.statusChanges.emit(this.status),this._parent&&!t.onlySelf&&this._parent.markAsPending(t)}disable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=EE,this.errors=null,this._forEachChild(e=>{e.disable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this._updateValue(),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!0))}enable(t={}){const e=this._parentMarkedDirty(t.onlySelf);this.status=wE,this._forEachChild(e=>{e.enable(Object.assign(Object.assign({},t),{onlySelf:!0}))}),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent}),this._updateAncestors(Object.assign(Object.assign({},t),{skipPristineCheck:e})),this._onDisabledChange.forEach(t=>t(!1))}_updateAncestors(t){this._parent&&!t.onlySelf&&(this._parent.updateValueAndValidity(t),t.skipPristineCheck||this._parent._updatePristine(),this._parent._updateTouched())}setParent(t){this._parent=t}updateValueAndValidity(t={}){this._setInitialStatus(),this._updateValue(),this.enabled&&(this._cancelExistingSubscription(),this.errors=this._runValidator(),this.status=this._calculateStatus(),this.status!==wE&&this.status!==CE||this._runAsyncValidator(t.emitEvent)),!1!==t.emitEvent&&(this.valueChanges.emit(this.value),this.statusChanges.emit(this.status)),this._parent&&!t.onlySelf&&this._parent.updateValueAndValidity(t)}_updateTreeValidity(t={emitEvent:!0}){this._forEachChild(e=>e._updateTreeValidity(t)),this.updateValueAndValidity({onlySelf:!0,emitEvent:t.emitEvent})}_setInitialStatus(){this.status=this._allControlsDisabled()?EE:wE}_runValidator(){return this.validator?this.validator(this):null}_runAsyncValidator(t){if(this.asyncValidator){this.status=CE,this._hasOwnPendingAsyncValidator=!0;const e=$C(this.asyncValidator(this));this._asyncValidationSubscription=e.subscribe(e=>{this._hasOwnPendingAsyncValidator=!1,this.setErrors(e,{emitEvent:t})})}}_cancelExistingSubscription(){this._asyncValidationSubscription&&(this._asyncValidationSubscription.unsubscribe(),this._hasOwnPendingAsyncValidator=!1)}setErrors(t,e={}){this.errors=t,this._updateControlsErrors(!1!==e.emitEvent)}get(t){return function(t,e,n){if(null==e)return null;if(Array.isArray(e)||(e=e.split(".")),Array.isArray(e)&&0===e.length)return null;let r=t;return e.forEach(t=>{r=r instanceof DE?r.controls.hasOwnProperty(t)?r.controls[t]:null:r instanceof RE&&r.at(t)||null}),r}(this,t)}getError(t,e){const n=e?this.get(e):this;return n&&n.errors?n.errors[t]:null}hasError(t,e){return!!this.getError(t,e)}get root(){let t=this;for(;t._parent;)t=t._parent;return t}_updateControlsErrors(t){this.status=this._calculateStatus(),t&&this.statusChanges.emit(this.status),this._parent&&this._parent._updateControlsErrors(t)}_initObservables(){this.valueChanges=new r.n,this.statusChanges=new r.n}_calculateStatus(){return this._allControlsDisabled()?EE:this.errors?TE:this._hasOwnPendingAsyncValidator||this._anyControlsHaveStatus(CE)?CE:this._anyControlsHaveStatus(TE)?TE:wE}_anyControlsHaveStatus(t){return this._anyControls(e=>e.status===t)}_anyControlsDirty(){return this._anyControls(t=>t.dirty)}_anyControlsTouched(){return this._anyControls(t=>t.touched)}_updatePristine(t={}){this.pristine=!this._anyControlsDirty(),this._parent&&!t.onlySelf&&this._parent._updatePristine(t)}_updateTouched(t={}){this.touched=this._anyControlsTouched(),this._parent&&!t.onlySelf&&this._parent._updateTouched(t)}_isBoxedValue(t){return"object"==typeof t&&null!==t&&2===Object.keys(t).length&&"value"in t&&"disabled"in t}_registerOnCollectionChange(t){this._onCollectionChange=t}_setUpdateStrategy(t){ME(t)&&null!=t.updateOn&&(this._updateOn=t.updateOn)}_parentMarkedDirty(t){return!t&&!(!this._parent||!this._parent.dirty)&&!this._parent._anyControlsDirty()}}class PE extends OE{constructor(t=null,e,n){super(SE(e),kE(n,e)),this._onChange=[],this._applyFormState(t),this._setUpdateStrategy(e),this._initObservables(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!n})}setValue(t,e={}){this.value=this._pendingValue=t,this._onChange.length&&!1!==e.emitModelToViewChange&&this._onChange.forEach(t=>t(this.value,!1!==e.emitViewToModelChange)),this.updateValueAndValidity(e)}patchValue(t,e={}){this.setValue(t,e)}reset(t=null,e={}){this._applyFormState(t),this.markAsPristine(e),this.markAsUntouched(e),this.setValue(this.value,e),this._pendingChange=!1}_updateValue(){}_anyControls(t){return!1}_allControlsDisabled(){return this.disabled}registerOnChange(t){this._onChange.push(t)}_unregisterOnChange(t){xE(this._onChange,t)}registerOnDisabledChange(t){this._onDisabledChange.push(t)}_unregisterOnDisabledChange(t){xE(this._onDisabledChange,t)}_forEachChild(t){}_syncPendingControls(){return!("submit"!==this.updateOn||(this._pendingDirty&&this.markAsDirty(),this._pendingTouched&&this.markAsTouched(),!this._pendingChange)||(this.setValue(this._pendingValue,{onlySelf:!0,emitModelToViewChange:!1}),0))}_applyFormState(t){this._isBoxedValue(t)?(this.value=this._pendingValue=t.value,t.disabled?this.disable({onlySelf:!0,emitEvent:!1}):this.enable({onlySelf:!0,emitEvent:!1})):this.value=this._pendingValue=t}}class DE extends OE{constructor(t,e,n){super(SE(e),kE(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!n})}registerControl(t,e){return this.controls[t]?this.controls[t]:(this.controls[t]=e,e.setParent(this),e._registerOnCollectionChange(this._onCollectionChange),e)}addControl(t,e){this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}removeControl(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],this.updateValueAndValidity(),this._onCollectionChange()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),delete this.controls[t],e&&this.registerControl(t,e),this.updateValueAndValidity(),this._onCollectionChange()}contains(t){return this.controls.hasOwnProperty(t)&&this.controls[t].enabled}setValue(t,e={}){this._checkAllValuesPresent(t),Object.keys(t).forEach(n=>{this._throwIfControlMissing(n),this.controls[n].setValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(Object.keys(t).forEach(n=>{this.controls[n]&&this.controls[n].patchValue(t[n],{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t={},e={}){this._forEachChild((n,r)=>{n.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this._reduceChildren({},(t,e,n)=>(t[n]=e instanceof PE?e.value:e.getRawValue(),t))}_syncPendingControls(){let t=this._reduceChildren(!1,(t,e)=>!!e._syncPendingControls()||t);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!Object.keys(this.controls).length)throw new Error("\n        There are no form controls registered with this group yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.controls[t])throw new Error(`Cannot find form control with name: ${t}.`)}_forEachChild(t){Object.keys(this.controls).forEach(e=>{const n=this.controls[e];n&&t(n,e)})}_setUpControls(){this._forEachChild(t=>{t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)})}_updateValue(){this.value=this._reduceValue()}_anyControls(t){for(const e of Object.keys(this.controls)){const n=this.controls[e];if(this.contains(e)&&t(n))return!0}return!1}_reduceValue(){return this._reduceChildren({},(t,e,n)=>((e.enabled||this.disabled)&&(t[n]=e.value),t))}_reduceChildren(t,e){let n=t;return this._forEachChild((t,r)=>{n=e(n,t,r)}),n}_allControlsDisabled(){for(const t of Object.keys(this.controls))if(this.controls[t].enabled)return!1;return Object.keys(this.controls).length>0||this.disabled}_checkAllValuesPresent(t){this._forEachChild((e,n)=>{if(void 0===t[n])throw new Error(`Must supply a value for form control with name: '${n}'.`)})}}class RE extends OE{constructor(t,e,n){super(SE(e),kE(n,e)),this.controls=t,this._initObservables(),this._setUpdateStrategy(e),this._setUpControls(),this.updateValueAndValidity({onlySelf:!0,emitEvent:!!n})}at(t){return this.controls[t]}push(t){this.controls.push(t),this._registerControl(t),this.updateValueAndValidity(),this._onCollectionChange()}insert(t,e){this.controls.splice(t,0,e),this._registerControl(e),this.updateValueAndValidity()}removeAt(t){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),this.updateValueAndValidity()}setControl(t,e){this.controls[t]&&this.controls[t]._registerOnCollectionChange(()=>{}),this.controls.splice(t,1),e&&(this.controls.splice(t,0,e),this._registerControl(e)),this.updateValueAndValidity(),this._onCollectionChange()}get length(){return this.controls.length}setValue(t,e={}){this._checkAllValuesPresent(t),t.forEach((t,n)=>{this._throwIfControlMissing(n),this.at(n).setValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e)}patchValue(t,e={}){null!=t&&(t.forEach((t,n)=>{this.at(n)&&this.at(n).patchValue(t,{onlySelf:!0,emitEvent:e.emitEvent})}),this.updateValueAndValidity(e))}reset(t=[],e={}){this._forEachChild((n,r)=>{n.reset(t[r],{onlySelf:!0,emitEvent:e.emitEvent})}),this._updatePristine(e),this._updateTouched(e),this.updateValueAndValidity(e)}getRawValue(){return this.controls.map(t=>t instanceof PE?t.value:t.getRawValue())}clear(){this.controls.length<1||(this._forEachChild(t=>t._registerOnCollectionChange(()=>{})),this.controls.splice(0),this.updateValueAndValidity())}_syncPendingControls(){let t=this.controls.reduce((t,e)=>!!e._syncPendingControls()||t,!1);return t&&this.updateValueAndValidity({onlySelf:!0}),t}_throwIfControlMissing(t){if(!this.controls.length)throw new Error("\n        There are no form controls registered with this array yet. If you're using ngModel,\n        you may want to check next tick (e.g. use setTimeout).\n      ");if(!this.at(t))throw new Error(`Cannot find form control at index ${t}`)}_forEachChild(t){this.controls.forEach((e,n)=>{t(e,n)})}_updateValue(){this.value=this.controls.filter(t=>t.enabled||this.disabled).map(t=>t.value)}_anyControls(t){return this.controls.some(e=>e.enabled&&t(e))}_setUpControls(){this._forEachChild(t=>this._registerControl(t))}_checkAllValuesPresent(t){this._forEachChild((e,n)=>{if(void 0===t[n])throw new Error(`Must supply a value for form control at index: ${n}.`)})}_allControlsDisabled(){for(const t of this.controls)if(t.enabled)return!1;return this.controls.length>0||this.disabled}_registerControl(t){t.setParent(this),t._registerOnCollectionChange(this._onCollectionChange)}}const NE={provide:JC,useExisting:Object(r.U)(()=>jE)},LE=(()=>Promise.resolve(null))();let jE=(()=>{class t extends JC{constructor(t,e){super(),this.submitted=!1,this._directives=[],this.ngSubmit=new r.n,this.form=new DE({},KC(t),XC(e))}ngAfterViewInit(){this._setUpdateStrategy()}get formDirective(){return this}get control(){return this.form}get path(){return[]}get controls(){return this.form.controls}addControl(t){LE.then(()=>{const e=this._findContainer(t.path);t.control=e.registerControl(t.name,t.control),gE(t.control,t),t.control.updateValueAndValidity({emitEvent:!1}),this._directives.push(t)})}getControl(t){return this.form.get(t.path)}removeControl(t){LE.then(()=>{const e=this._findContainer(t.path);e&&e.removeControl(t.name),xE(this._directives,t)})}addFormGroup(t){LE.then(()=>{const e=this._findContainer(t.path),n=new DE({});(function(t,e){yE(t,e,!1)})(n,t),e.registerControl(t.name,n),n.updateValueAndValidity({emitEvent:!1})})}removeFormGroup(t){LE.then(()=>{const e=this._findContainer(t.path);e&&e.removeControl(t.name)})}getFormGroup(t){return this.form.get(t.path)}updateModel(t,e){LE.then(()=>{this.form.get(t.path).setValue(e)})}setValue(t){this.control.setValue(t)}onSubmit(t){return this.submitted=!0,e=this._directives,this.form._syncPendingControls(),e.forEach(t=>{const e=t.control;"submit"===e.updateOn&&e._pendingChange&&(t.viewToModelUpdate(e._pendingValue),e._pendingChange=!1)}),this.ngSubmit.emit(t),!1;var e}onReset(){this.resetForm()}resetForm(t){this.form.reset(t),this.submitted=!1}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.form._updateOn=this.options.updateOn)}_findContainer(t){return t.pop(),t.length?this.form.get(t):this.form}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(BC,10),r.Kb(UC,10))},t.\u0275dir=r.Fb({type:t,selectors:[["form",3,"ngNoForm","",3,"formGroup",""],["ng-form"],["","ngForm",""]],hostBindings:function(t,e){1&t&&r.Ub("submit",function(t){return e.onSubmit(t)})("reset",function(){return e.onReset()})},inputs:{options:["ngFormOptions","options"]},outputs:{ngSubmit:"ngSubmit"},exportAs:["ngForm"],features:[r.zb([NE]),r.xb]}),t})();const zE={provide:eE,useExisting:Object(r.U)(()=>BE)},FE=(()=>Promise.resolve(null))();let BE=(()=>{class t extends eE{constructor(t,e,n,i){super(),this.control=new PE,this._registered=!1,this.update=new r.n,this._parent=t,this._setValidators(e),this._setAsyncValidators(n),this.valueAccessor=function(t,e){if(!e)return null;let n,r,i;return Array.isArray(e),e.forEach(t=>{var e;t.constructor===jC?n=t:(e=t,bE.some(t=>e.constructor===t)?r=t:i=t)}),i||r||n||null}(0,i)}ngOnChanges(t){this._checkForErrors(),this._registered||this._setUpControl(),"isDisabled"in t&&this._updateDisabled(t),function(t,e){if(!t.hasOwnProperty("model"))return!1;const n=t.model;return!!n.isFirstChange()||!Object.is(e,n.currentValue)}(t,this.viewModel)&&(this._updateValue(this.model),this.viewModel=this.model)}ngOnDestroy(){this.formDirective&&this.formDirective.removeControl(this)}get path(){return this._parent?[...this._parent.path,this.name]:[this.name]}get formDirective(){return this._parent?this._parent.formDirective:null}viewToModelUpdate(t){this.viewModel=t,this.update.emit(t)}_setUpControl(){this._setUpdateStrategy(),this._isStandalone()?this._setUpStandalone():this.formDirective.addControl(this),this._registered=!0}_setUpdateStrategy(){this.options&&null!=this.options.updateOn&&(this.control._updateOn=this.options.updateOn)}_isStandalone(){return!this._parent||!(!this.options||!this.options.standalone)}_setUpStandalone(){gE(this.control,this),this.control.updateValueAndValidity({emitEvent:!1})}_checkForErrors(){this._isStandalone()||this._checkParentType(),this._checkName()}_checkParentType(){}_checkName(){this.options&&this.options.name&&(this.name=this.options.name),this._isStandalone()}_updateValue(t){FE.then(()=>{this.control.setValue(t,{emitViewToModelChange:!1})})}_updateDisabled(t){const e=t.isDisabled.currentValue,n=""===e||e&&"false"!==e;FE.then(()=>{n&&!this.control.disabled?this.control.disable():!n&&this.control.disabled&&this.control.enable()})}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(JC,9),r.Kb(BC,10),r.Kb(UC,10),r.Kb(PC,10))},t.\u0275dir=r.Fb({type:t,selectors:[["","ngModel","",3,"formControlName","",3,"formControl",""]],inputs:{name:"name",isDisabled:["disabled","isDisabled"],model:["ngModel","model"],options:["ngModelOptions","options"]},outputs:{update:"ngModelChange"},exportAs:["ngModel"],features:[r.zb([zE]),r.xb,r.yb]}),t})(),UE=(()=>{class t{}return t.\u0275fac=function(e){return new(e||t)},t.\u0275dir=r.Fb({type:t,selectors:[["form",3,"ngNoForm","",3,"ngNativeValidate",""]],hostAttrs:["novalidate",""]}),t})(),VE=(()=>{class t{}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)}}),t})(),qE=(()=>{class t{}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)},providers:[cE],imports:[VE]}),t})();function GE(t){return e=>e.lift(new $E(t))}class $E{constructor(t){this.notifier=t}call(t,e){const n=new WE(t),r=Object(Ct.c)(this.notifier,new Ct.a(n));return r&&!n.seenValue?(n.add(r),e.subscribe(n)):n}}class WE extends Ct.b{constructor(t){super(t),this.seenValue=!1}notifyNext(){this.seenValue=!0,this.complete()}notifyComplete(){}}const HE=["newIngredient"],ZE=function(t){return{"background-image":t}};function KE(t,e){1&t&&r.Lb(0,"div",11),2&t&&r.Zb("ngStyle",r.bc(1,ZE,"url("+e.$implicit+")"))}let XE=(()=>{class t{constructor(t,e){this.auth=t,this.firestore=e,this.destroy$=new qt.a}ngOnInit(){this.itemId?this.firestore.collection("items").doc(this.itemId).valueChanges().pipe(GE(this.destroy$)).subscribe(t=>{t&&(this.item=t)}):alert("something went wrong! ")}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}editPrice(t){var e=this.firestore.firestore.batch(),n=this.firestore.firestore.collection("items").doc(this.itemId);e.update(n,{price:+t});var r=this.firestore.firestore.collection("shopOwners").doc(this.uid).collection("items").doc(this.itemId);e.update(r,{price:+t}),e.commit().catch(t=>{t&&alert(t)})}editQuantity(t){var e=this.firestore.firestore.batch(),n=this.firestore.firestore.collection("items").doc(this.itemId);e.update(n,{quantity:+t});var r=this.firestore.firestore.collection("shopOwners").doc(this.uid).collection("items").doc(this.itemId);e.update(r,{quantity:+t}),e.commit().catch(t=>{t&&alert(t)})}editCategory(t){var e=this.firestore.firestore.batch(),n=this.firestore.firestore.collection("items").doc(this.itemId);e.update(n,{category:t});var r=this.firestore.firestore.collection("shopOwners").doc(this.uid).collection("items").doc(this.itemId);e.update(r,{category:t}),e.commit().catch(t=>{t&&alert(t)}),this.firestore.collection("items").doc(this.itemId).update({category:t}).catch(t=>alert(t))}editCarBrand(t){var e=this.firestore.firestore.batch(),n=this.firestore.firestore.collection("items").doc(this.itemId);e.update(n,{brand:t});var r=this.firestore.firestore.collection("shopOwners").doc(this.uid).collection("items").doc(this.itemId);e.update(r,{brand:t}),e.commit().catch(t=>{t&&alert(t)}),this.firestore.collection("items").doc(this.itemId).update({brand:t}).catch(t=>alert(t))}editTopic(t){var e=this.firestore.firestore.batch(),n=this.firestore.firestore.collection("items").doc(this.itemId);e.update(n,{topics:t});var r=this.firestore.firestore.collection("shopOwners").doc(this.uid).collection("items").doc(this.itemId);e.update(r,{topics:t}),e.commit().catch(t=>{t&&alert(t)})}editDescription(t){var e=this.firestore.firestore.batch(),n=this.firestore.firestore.collection("items").doc(this.itemId);e.update(n,{description:t});var r=this.firestore.firestore.collection("shopOwners").doc(this.uid).collection("items").doc(this.itemId);e.update(r,{description:t}),e.commit().catch(t=>{t&&alert(t)})}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(Ce),r.Kb(py))},t.\u0275cmp=r.Eb({type:t,selectors:[["app-inside-item"]],viewQuery:function(t,e){if(1&t&&r.mc(HE,1),2&t){let t;r.cc(t=r.Vb())&&(e.ingredientHTML=t.first)}},inputs:{itemId:"itemId",uid:"uid"},decls:32,vars:6,consts:[[1,"prviewContainer"],["class","prviewImage",3,"ngStyle",4,"ngFor","ngForOf"],[2,"font-size","20px"],["type","text",3,"ngModel","keyUp.enter"],["itemPrice",""],["itemQuantity",""],["type","text",2,"width","10rem",3,"ngModel","keyUp.enter"],["itemCategory",""],["carBrand",""],["type","text",2,"width","100%",3,"ngModel","keyUp.enter"],["itemDescription",""],[1,"prviewImage",3,"ngStyle"]],template:function(t,e){if(1&t){const t=r.Ob();r.Nb(0,"div",0),r.ic(1,KE,1,3,"div",1),r.Mb(),r.Nb(2,"div"),r.Nb(3,"p",2),r.Nb(4,"strong"),r.jc(5,"Item Price $"),r.Mb(),r.Mb(),r.Nb(6,"input",3,4),r.Ub("keyUp.enter",function(){r.ec(t);const n=r.dc(7);return e.editPrice(n.value)}),r.Mb(),r.Mb(),r.Nb(8,"div"),r.Nb(9,"p",2),r.Nb(10,"strong"),r.jc(11,"Item Quantity"),r.Mb(),r.Mb(),r.Nb(12,"input",3,5),r.Ub("keyUp.enter",function(){r.ec(t);const n=r.dc(13);return e.editQuantity(n.value)}),r.Mb(),r.Mb(),r.Nb(14,"div"),r.Nb(15,"p",2),r.Nb(16,"strong"),r.jc(17,"Item Category"),r.Mb(),r.Mb(),r.Nb(18,"input",6,7),r.Ub("keyUp.enter",function(){r.ec(t);const n=r.dc(19);return e.editCategory(n.value)}),r.Mb(),r.Mb(),r.Nb(20,"div"),r.Nb(21,"p",2),r.Nb(22,"strong"),r.jc(23,"Car Brand"),r.Mb(),r.Mb(),r.Nb(24,"input",6,8),r.Ub("keyUp.enter",function(){r.ec(t);const n=r.dc(25);return e.editCarBrand(n.value)}),r.Mb(),r.Mb(),r.Nb(26,"div"),r.Nb(27,"p",2),r.Nb(28,"strong"),r.jc(29,"Item Description"),r.Mb(),r.Mb(),r.Nb(30,"textarea",9,10),r.Ub("keyUp.enter",function(){r.ec(t);const n=r.dc(31);return e.editDescription(n.value)}),r.Mb(),r.Mb()}2&t&&(r.Ab(1),r.Zb("ngForOf",e.item.url),r.Ab(5),r.Zb("ngModel",e.item.price),r.Ab(6),r.Zb("ngModel",e.item.quantity),r.Ab(6),r.Zb("ngModel",e.item.category),r.Ab(6),r.Zb("ngModel",e.item.brand),r.Ab(6),r.Zb("ngModel",e.item.description))},directives:[M,jC,rE,BE,N],styles:[".info[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:4rem;margin-right:1%;border-radius:.5rem;border:1px solid grey;font-size:16px;padding:4px 4px 4px 10px;margin-top:.25rem;margin-bottom:.5rem}.tag[_ngcontent-%COMP%]{animation-name:ingredient-tag-in;animation-duration:.2s;transition:ease-in-out}@keyframes ingredient-tag-in{0%{width:1rem}to{width:4rem}}.prviewContainer[_ngcontent-%COMP%]{width:100%;height:20rem;overflow-x:scroll;display:flex;flex-direction:row;flex-wrap:nowrap;scroll-snap-type:x mandatory;margin-bottom:.7rem}.prviewImage[_ngcontent-%COMP%]{width:100%;height:100%;background-position:50%;background-size:cover;scroll-behavior:smooth;flex-grow:0;flex-shrink:0;scroll-snap-align:start}"]}),t})(),YE=(()=>{class t{constructor(){}ngOnInit(){}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=r.Eb({type:t,selectors:[["app-loader"]],decls:2,vars:0,consts:[[1,"cell"],[1,"pl","pl-hourglass"]],template:function(t,e){1&t&&(r.Nb(0,"div",0),r.Lb(1,"div",1),r.Mb())},styles:['.cell[_ngcontent-%COMP%]{flex-basis:50%}.pl[_ngcontent-%COMP%], .pl[_ngcontent-%COMP%]:after, .pl[_ngcontent-%COMP%]:before{animation-duration:2s;animation-timing-function:linear;animation-iteration-count:infinite}.pl[_ngcontent-%COMP%]{margin:0 auto;position:relative;width:1.2em;height:1.2em}.pl[_ngcontent-%COMP%]:after, .pl[_ngcontent-%COMP%]:before{background:currentColor;content:"";display:block;position:absolute;top:0;left:0;width:100%;height:50%;transform-origin:50% 100%;clip-path:polygon(0 0,100% 0,50% 100%);-webkit-clip-path:polygon(0 0,100% 0,50% 100%)}.pl-hourglass[_ngcontent-%COMP%]{animation-name:hourglassA;background:#a3a3a3;clip-path:polygon(0 0,100% 0,50% 50%,100% 100%,0 100%,50% 50%);-webkit-clip-path:polygon(0 0,100% 0,50% 50%,100% 100%,0 100%,50% 50%)}.pl-hourglass[_ngcontent-%COMP%]:after, .pl-hourglass[_ngcontent-%COMP%]:before{position:static;clip-path:none;-webkit-clip-path:none}.pl-hourglass[_ngcontent-%COMP%]:before{animation-name:hourglassB}.pl-hourglass[_ngcontent-%COMP%]:after{animation-name:hourglassC}@keyframes hourglassA{0%,75%{transform:rotate(0)}to{transform:rotate(180deg)}}@keyframes hourglassB{0%{transform:scaleY(1)}50%,to{transform:scaleY(0)}}@keyframes hourglassC{0%{transform:scaleY(0)}50%,to{transform:scaleY(1)}}']}),t})();function QE(t,e){if(1&t){const t=r.Ob();r.Nb(0,"button",44),r.Ub("click",function(){return r.ec(t),r.Wb().showInputMeth()}),r.jc(1,"Search Item"),r.Mb()}}function JE(t,e){1&t&&r.Lb(0,"input",45)}function tS(t,e){if(1&t){const t=r.Ob();r.Nb(0,"button",46),r.Ub("click",function(){return r.ec(t),r.Wb().showInput=!1}),r.Mb()}}function eS(t,e){1&t&&r.Lb(0,"div",47)}const nS=function(t){return{"background-image":t}};function rS(t,e){1&t&&r.Lb(0,"div",48),2&t&&r.Zb("ngStyle",r.bc(1,nS,"url("+e.$implicit+")"))}function iS(t,e){if(1&t){const t=r.Ob();r.Nb(0,"button",49),r.Ub("click",function(){r.ec(t);const e=r.Wb(),n=r.dc(24),i=r.dc(29),o=r.dc(34),s=r.dc(39),a=r.dc(44);return e.uplaodItem(n.value,i.value,o.value,s.value,a.value)}),r.jc(1,"Add item"),r.Mb()}}function oS(t,e){if(1&t){const t=r.Ob();r.Nb(0,"div",10),r.Lb(1,"div",11),r.Nb(2,"div",12),r.Nb(3,"header",13),r.Nb(4,"input",50,51),r.Ub("keyUp.enter",function(){r.ec(t);const e=r.dc(5);return r.Wb().editTitle(e.value)}),r.Mb(),r.Nb(6,"button",15),r.Ub("click",function(){return r.ec(t),r.Wb().showItemModal=!1}),r.Mb(),r.Mb(),r.Nb(7,"section",16),r.Lb(8,"app-inside-item",52),r.Mb(),r.Nb(9,"footer",33),r.Nb(10,"button",34),r.Ub("click",function(){return r.ec(t),r.Wb().showItemModal=!1}),r.jc(11,"Cancel"),r.Mb(),r.Nb(12,"button",53),r.Ub("click",function(){return r.ec(t),r.Wb().deleteItem()}),r.jc(13,"Delete This Item"),r.Mb(),r.Mb(),r.Mb(),r.Mb()}if(2&t){const t=r.Wb();r.Cb("is-active",1==t.showItemModal),r.Ab(4),r.Zb("ngModel",t.itemTitle),r.Ab(4),r.Zb("itemId",t.itemId)}}function sS(t,e){if(1&t&&(r.Nb(0,"div",54),r.Nb(1,"p",55),r.jc(2),r.Mb(),r.Lb(3,"app-loader"),r.Mb()),2&t){const t=r.Wb();r.Ab(2),r.lc("uploading ",t.uploadImageProgress,"%")}}function aS(t,e){1&t&&(r.Nb(0,"div",54),r.Nb(1,"p",56),r.jc(2,"Uploaded "),r.Mb(),r.Mb())}function cS(t,e){1&t&&(r.Nb(0,"div",57),r.Nb(1,"p",56),r.jc(2,"Deleted "),r.Mb(),r.Mb())}function lS(t,e){if(1&t&&(r.Nb(0,"p",64),r.jc(1),r.Mb()),2&t){const t=r.Wb().$implicit;r.Ab(1),r.kc(t.title)}}function uS(t,e){if(1&t&&(r.Nb(0,"p",64),r.jc(1),r.Mb()),2&t){const t=r.Wb().$implicit;r.Ab(1),r.kc(t.title.substring(0,10))}}function hS(t,e){if(1&t){const t=r.Ob();r.Nb(0,"li",58),r.Ub("click",function(){r.ec(t);const n=e.$implicit;return r.Wb().itemModal(n.id,n.title)}),r.Lb(1,"div",59),r.Nb(2,"div",60),r.ic(3,lS,2,1,"p",61),r.ic(4,uS,2,1,"p",61),r.Mb(),r.Nb(5,"div",62),r.Nb(6,"div",60),r.Nb(7,"p",63),r.jc(8,"Price"),r.Mb(),r.Nb(9,"p"),r.jc(10),r.Mb(),r.Mb(),r.Nb(11,"div",60),r.Nb(12,"p",63),r.jc(13,"Quantity"),r.Mb(),r.Nb(14,"p"),r.jc(15),r.Mb(),r.Mb(),r.Mb(),r.Mb()}if(2&t){const t=e.$implicit;r.Ab(1),r.Zb("ngStyle",r.bc(5,nS,"url("+t.url[0]+")")),r.Ab(2),r.Zb("ngIf",t.title.length<=10),r.Ab(1),r.Zb("ngIf",t.title.length>10),r.Ab(6),r.lc("$",t.price,""),r.Ab(5),r.kc(t.quantity)}}function dS(t,e){1&t&&(r.Nb(0,"div",65),r.Nb(1,"h4"),r.jc(2,"No items yet! Add Some"),r.Mb(),r.Mb())}function pS(t,e){1&t&&(r.Nb(0,"div",65),r.Lb(1,"app-loader"),r.Mb())}let fS=(()=>{class t{constructor(t,e){this.firestore=t,this.storage=e,this.showInput=!1,this.faPlus=vC,this.showInfo=!1,this.showAddItemModal=!1,this.showItemModal=!1,this.loading=!0,this.previewUrls=[],this.paths=[],this.uploading=!1,this.uploadImageProgress=.1,this.uploaded=!1,this.toUplaodURLS=[],this.itemdeleted=!1}ngOnInit(){this.firestore.collection("items").valueChanges().subscribe(t=>{this.items=t,this.loading=!1})}showInputMeth(){this.showInput=!this.showInput}additemModal(){this.showAddItemModal=!0}itemModal(t,e){this.itemId=t,this.showItemModal=!0,this.itemTitle=e}uploadImage(t){this.imagePath=t.target.files[0],this.paths.push(this.imagePath);const e=new FileReader;e.onload=()=>{this.imagePreiviewUrl=e.result,this.previewUrls.push(this.imagePreiviewUrl)},e.readAsDataURL(this.imagePath)}uplaodItem(t,e,n,r,i){return Object(He.b)(this,void 0,void 0,function*(){if(this.imagePath)if(""!=t&&0!=e&&0!=n&&""!=r&&""!=i){let o=this.firestore.createId();this.showAddItemModal=!1;for(let t=0;t<this.paths.length;t++)yield this.uploadIndividualImgae(o,this.paths[t]);const s={key:o,title:t,price:e,discount:0,quantity:n,category:r,description:i,url:this.toUplaodURLS};this.firestore.collection("items").doc(o).set(s).catch(t=>alert(t))}else alert("Empty field");else alert("You need to add an item image")})}uploadIndividualImgae(t,e){return new Promise((n,r)=>{var i=this.firestore.createId();const o=this.storage.upload(`/items/${t}/${i}`,e);o.then(t=>{t.ref.getDownloadURL().then(t=>{this.toUplaodURLS.push(t),n()})}).catch(t=>console.log("image not uploaded")),o.percentageChanges().subscribe(t=>{this.uploading=!0,this.uploadImageProgress=null==t?void 0:t.valueOf(),100==t&&(this.uploading=!1,this.uploaded=!0,setInterval(()=>{this.uploaded=!1},2e3))})})}editTitle(t){}deleteItem(){}filter(t){}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(py),r.Kb(wr))},t.\u0275cmp=r.Eb({type:t,selectors:[["app-items"]],decls:73,vars:15,consts:[[1,"main-customers"],[1,"top-bar","primary"],["class","search-button",3,"click",4,"ngIf"],["type","text","class","search-input",4,"ngIf"],["class","delete","style","border-radius: 0.25rem;",3,"click",4,"ngIf"],[1,"toggle-details",3,"click"],[1,"showDetails"],[2,"font-size","26px","color","white"],["class","search-space",4,"ngIf"],[2,"margin-left","1%"],[1,"modal"],[1,"modal-background"],[1,"modal-card"],[1,"modal-card-head"],[1,"modal-card-title"],["aria-label","close",1,"delete",3,"click"],[1,"modal-card-body"],[1,"input-container"],[1,"add-item-modal-label"],["type","text",1,"add-item-modal-input"],["title",""],["type","number",1,"add-item-modal-input"],["price",""],["quantity",""],["category",""],["type","text",1,"add-item-modal-textarea"],["description",""],[1,"input-container","image-file-input"],[2,"display","flex","flex-direction","column","align-items","center","gap","0.5rem"],[1,"button","is-warning","is-small"],["type","file","accept","*.png.jpg",2,"display","none",3,"change"],[1,"prviewContainer"],["class","prviewImage",3,"ngStyle",4,"ngFor","ngForOf"],[1,"modal-card-foot"],[1,"button",3,"click"],["class","button","style","background-color: black;color: white;",3,"click",4,"ngIf"],["class","modal",3,"is-active",4,"ngIf"],["class","upload-progress-container",4,"ngIf"],["class","upload-progress-container","style","background-color: rgb(247, 42, 6);",4,"ngIf"],[1,"Top-Options"],[1,"mock-line"],[1,"items"],[3,"click",4,"ngFor","ngForOf"],["style","width: 95%;height: 60vh;display: flex;flex-direction: column;align-items: center;justify-content: center;",4,"ngIf"],[1,"search-button",3,"click"],["type","text",1,"search-input"],[1,"delete",2,"border-radius","0.25rem",3,"click"],[1,"search-space"],[1,"prviewImage",3,"ngStyle"],[1,"button",2,"background-color","black","color","white",3,"click"],["type","text",1,"modal-card-title",2,"font-weight","bold","font-size","22px",3,"ngModel","keyUp.enter"],["itemTit",""],[3,"itemId"],[1,"button","is-danger",3,"click"],[1,"upload-progress-container"],[2,"color","rgb(255, 255, 255)","font-size","14px"],[2,"color","rgb(255, 255, 255)","font-size","16px"],[1,"upload-progress-container",2,"background-color","rgb(247, 42, 6)"],[3,"click"],[1,"poster",3,"ngStyle"],[1,"info"],["style","font-weight: bold;font-size: 18px;",4,"ngIf"],[1,"bottom-info"],[2,"font-weight","bold"],[2,"font-weight","bold","font-size","18px"],[2,"width","95%","height","60vh","display","flex","flex-direction","column","align-items","center","justify-content","center"]],template:function(t,e){1&t&&(r.Nb(0,"div",0),r.Nb(1,"div",1),r.ic(2,QE,2,0,"button",2),r.ic(3,JE,1,0,"input",3),r.ic(4,tS,1,0,"button",4),r.Nb(5,"div",5),r.Ub("click",function(){return e.additemModal()}),r.Nb(6,"p",6),r.jc(7,"Add new item"),r.Mb(),r.Nb(8,"p",7),r.jc(9,"+"),r.Mb(),r.Mb(),r.Mb(),r.ic(10,eS,1,0,"div",8),r.Nb(11,"div",9),r.Nb(12,"div",10),r.Lb(13,"div",11),r.Nb(14,"div",12),r.Nb(15,"header",13),r.Nb(16,"p",14),r.jc(17,"Adding a new item"),r.Mb(),r.Nb(18,"button",15),r.Ub("click",function(){return e.showAddItemModal=!1}),r.Mb(),r.Mb(),r.Nb(19,"section",16),r.Nb(20,"div",17),r.Nb(21,"label",18),r.jc(22,"Item Title"),r.Mb(),r.Lb(23,"input",19,20),r.Mb(),r.Nb(25,"div",17),r.Nb(26,"label",18),r.jc(27,"Item Price ($ - LBP)"),r.Mb(),r.Lb(28,"input",21,22),r.Mb(),r.Nb(30,"div",17),r.Nb(31,"label",18),r.jc(32,"Item Quantity"),r.Mb(),r.Lb(33,"input",21,23),r.Mb(),r.Nb(35,"div",17),r.Nb(36,"label",18),r.jc(37,"Item Category"),r.Mb(),r.Lb(38,"input",19,24),r.Mb(),r.Nb(40,"div",17),r.Nb(41,"label",18),r.jc(42,"Item Description"),r.Mb(),r.Lb(43,"textarea",25,26),r.Mb(),r.Nb(45,"div",27),r.Nb(46,"div",28),r.Nb(47,"h3"),r.jc(48,"You can add multiple images"),r.Mb(),r.Nb(49,"label",29),r.Nb(50,"input",30),r.Ub("change",function(t){return e.uploadImage(t)}),r.Mb(),r.jc(51," Add image "),r.Mb(),r.Mb(),r.Mb(),r.Nb(52,"div",31),r.ic(53,rS,1,3,"div",32),r.Mb(),r.Mb(),r.Nb(54,"footer",33),r.Nb(55,"button",34),r.Ub("click",function(){return e.showAddItemModal=!1}),r.jc(56,"Cancel"),r.Mb(),r.ic(57,iS,2,0,"button",35),r.Mb(),r.Mb(),r.Mb(),r.ic(58,oS,14,4,"div",36),r.ic(59,sS,4,1,"div",37),r.ic(60,aS,3,0,"div",37),r.ic(61,cS,3,0,"div",38),r.Nb(62,"div",39),r.Nb(63,"ul"),r.Nb(64,"li"),r.jc(65,"Most Recent"),r.Mb(),r.Nb(66,"li"),r.jc(67,"Most Relevant"),r.Mb(),r.Mb(),r.Mb(),r.Lb(68,"div",40),r.Nb(69,"ul",41),r.ic(70,hS,16,7,"li",42),r.ic(71,dS,3,0,"div",43),r.ic(72,pS,2,0,"div",43),r.Mb(),r.Mb(),r.Mb()),2&t&&(r.Ab(2),r.Zb("ngIf",0==e.showInput),r.Ab(1),r.Zb("ngIf",1==e.showInput),r.Ab(1),r.Zb("ngIf",1==e.showInput),r.Ab(6),r.Zb("ngIf",1==e.showInput),r.Ab(2),r.Cb("is-active",1==e.showAddItemModal),r.Ab(41),r.Zb("ngForOf",e.previewUrls),r.Ab(4),r.Zb("ngIf",0==e.uploading),r.Ab(1),r.Zb("ngIf",1==e.showItemModal),r.Ab(1),r.Zb("ngIf",1==e.uploading),r.Ab(1),r.Zb("ngIf",1==e.uploaded),r.Ab(1),r.Zb("ngIf",1==e.itemdeleted),r.Ab(9),r.Zb("ngForOf",e.items),r.Ab(1),r.Zb("ngIf",0==e.items.length&&0==e.loading),r.Ab(1),r.Zb("ngIf",1==e.loading))},directives:[P,M,N,jC,rE,BE,XE,YE],styles:[".main-customers[_ngcontent-%COMP%]{width:100%;height:100%}.mock-line[_ngcontent-%COMP%]{background-color:hsla(0,0%,50.2%,.425);width:92.5%;margin-left:1.25%;margin-top:.5rem;margin-bottom:.5rem;height:1px}ul[_ngcontent-%COMP%]{list-style-type:none;flex-direction:row;flex-wrap:wrap;overflow:hidden;padding:1rem;height:91.5vh}.top-bar[_ngcontent-%COMP%], ul[_ngcontent-%COMP%]{display:flex;width:100%}.top-bar[_ngcontent-%COMP%]{height:8.5vh;align-items:center;padding-left:1.5rem;padding-right:1.5rem}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:17rem;margin-right:1%;border-radius:.5rem;border:none;font-size:16px;padding:4px 4px 4px 10px;animation-name:input-anim;animation-duration:.5s;transition:ease-in-out}@keyframes input-anim{0%{width:1rem}to{width:17rem}}.search-button[_ngcontent-%COMP%]{border:none;margin-right:1%;cursor:pointer;padding:7px;border-radius:.2rem;transition:.2s ease-in-out;font-weight:700;background-color:#fff}.search-button[_ngcontent-%COMP%]:hover{transform:scale(105%);background-color:#3d8ed0;color:#fff}.search-space[_ngcontent-%COMP%]{position:absolute;width:21.5rem;top:8.5vh;background-color:#f3f3f3;animation-name:search-space-anim-in;animation-duration:.5s;transition:ease-in-out;height:91.5vh;box-shadow:2px 2px 3px hsla(0,.8%,49%,.373)}.search-input[_ngcontent-%COMP%]{border:1px solid grey}@keyframes search-space-anim-in{0%{height:0}to{height:100Vh}}@keyframes search-space-anim-out{0%{width:21.5rem}to{width:0}}h3[_ngcontent-%COMP%]{padding-left:1rem;font-weight:700}.toggle-details[_ngcontent-%COMP%], .toggle-details-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.toggle-details[_ngcontent-%COMP%]{gap:1rem;margin-right:2rem;cursor:pointer}.showDetails[_ngcontent-%COMP%]{margin-left:1rem;min-width:4rem;color:#fff;font-size:14px}.filter-dropdown[_ngcontent-%COMP%]{z-index:3}.filterBy-span[_ngcontent-%COMP%]{font-size:14px;text-align:center;font-weight:700;cursor:pointer}.drop-down-container[_ngcontent-%COMP%], .filterBy-span[_ngcontent-%COMP%]{width:5rem;padding:4px;background-color:#fff}.drop-down-container[_ngcontent-%COMP%]{display:flex;list-style-type:none;flex-direction:column;align-items:center;justify-content:center;position:absolute;max-height:5rem;animation-name:drop-down-anim-in;animation-duration:.2s;transition:ease-in-out;box-shadow:0 3px 3px 2px hsla(0,0%,50.2%,.445)}.drop-down-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;border-bottom:1px solid hsla(0,0%,50.2%,.37);width:100%;text-align:center}.drop-down-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.drop-down-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{opacity:.8}@keyframes drop-down-anim-in{0%{height:1rem}to{height:5rem}}.Top-Options[_ngcontent-%COMP%]{width:100%;height:2rem}.Top-Options[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{padding-top:.5rem;max-height:3rem}.Top-Options[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-right:1rem;cursor:pointer;color:grey;transition:.5s ease-in-out;max-height:3rem}.Top-Options[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{font-weight:700}.items[_ngcontent-%COMP%]{overflow-y:scroll}.items[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{margin-right:2%;margin-bottom:2rem;padding-bottom:1rem;border-radius:1rem;box-shadow:0 4px 2px 2px rgba(90,89,89,.164);max-height:18rem}.items[_ngcontent-%COMP%]   li[_ngcontent-%COMP%], .poster[_ngcontent-%COMP%]{transition:.3s ease-in-out}.poster[_ngcontent-%COMP%]{width:16rem;height:10rem;background-position:50%;background-repeat:no-repeat;background-size:cover;border-top-left-radius:.5rem;border-top-right-radius:.5rem;margin-bottom:.5rem}.items[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{transform:scale(102%);cursor:pointer;background-color:rgba(178,218,250,.808)}.info[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between;padding-left:1rem;padding-right:1rem}@keyframes bottom-info-anim-in{0%{height:1rem}to{height:4rem}}.bottom-info[_ngcontent-%COMP%]{animation-name:bottom-info-anim-in;height:4rem}.bottom-info[_ngcontent-%COMP%], .is-active[_ngcontent-%COMP%]{animation-duration:.5s;transition:ease-in-out}.is-active[_ngcontent-%COMP%]{animation-name:add-item-modal-fade-in}@keyframes add-item-modal-fade-in{0%{opacity:0}to{opacity:1}}.input-container[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;align-items:center;justify-content:space-between;margin-top:1rem}.add-item-modal-input[_ngcontent-%COMP%]{border:1px solid grey}.add-item-modal-input-special[_ngcontent-%COMP%]{width:15.25rem;animation-name:input-anim-special;border:1px solid grey}@keyframes input-anim-special{0%{width:1rem}to{width:15.25rem}}.image-file-input[_ngcontent-%COMP%]{width:100%;display:flex;align-items:center;justify-content:center;margin-top:2.5rem}.prviewContainer[_ngcontent-%COMP%]{width:100%;height:15rem;overflow-x:scroll;display:flex;flex-direction:row;flex-wrap:nowrap;scroll-snap-type:x mandatory;margin-top:2rem;margin-bottom:3rem;border:1px solid grey;border-radius:.5rem}.prviewImage[_ngcontent-%COMP%]{width:100%;height:100%;background-position:50%;background-size:cover;scroll-behavior:smooth;flex-grow:0;flex-shrink:0;scroll-snap-align:start}.add-item-modal-textarea[_ngcontent-%COMP%]{border:1px solid grey;min-height:6rem}.add-item-modal-label[_ngcontent-%COMP%]{font-weight:700}.add-modal-ingred-container[_ngcontent-%COMP%]{display:flex;justify-content:center;align-items:center;margin-right:4px}.ingredients-container[_ngcontent-%COMP%]{width:100%;min-height:2rem;padding-top:5px}.tag[_ngcontent-%COMP%]{animation-name:ingredient-tag-in;animation-duration:.2s;transition:ease-in-out}@keyframes ingredient-tag-in{0%{width:1rem}to{width:4rem}}.upload-progress-container[_ngcontent-%COMP%]{width:10rem;height:2.5rem;background-color:#2f302f;position:fixed;bottom:4%;right:2.5%;border-radius:.5rem;animation-name:upload-progress-in;animation-duration:.7s;transition:ease-in-out;display:flex;flex-direction:row;align-items:center;justify-content:space-evenly;cursor:default;box-shadow:0 5px 4px 2px rgba(170,169,169,.288)}@keyframes upload-progress-in{0%{width:1rem}to{width:10rem}}"]}),t})();const mS=function(t){return{"is-loading":t}};let gS=(()=>{class t{constructor(t,e){this.auth=t,this.router=e,this.isLOading=!1}ngOnInit(){}login(t,e){return Object(He.b)(this,void 0,void 0,function*(){""!=t&&""!=e?(this.isLOading=!0,yield this.auth.signInWithEmailAndPassword(t,e).catch(t=>{alert(t)}).then(()=>{this.router.navigate(["dashboard"]),this.isLOading=!1})):alert("Empty Fields")})}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(Ce),r.Kb(ZT))},t.\u0275cmp=r.Eb({type:t,selectors:[["app-login"]],decls:28,vars:3,consts:[[1,"main","is-info"],["id","font"],[1,"box"],[1,"field"],[1,"label"],[1,"control"],["type","email","placeholder","e.g. alex@example.com",1,"input"],["email1",""],["type","password","placeholder","********",1,"input"],["pass1",""],[1,"button",2,"background-color","#012970","color","white",3,"ngClass","click"]],template:function(t,e){if(1&t){const t=r.Ob();r.Nb(0,"div",0),r.Nb(1,"h1"),r.jc(2,"Go2Parts"),r.Mb(),r.Nb(3,"p",1),r.jc(4,"Login in with your Admin Account"),r.Mb(),r.Nb(5,"p"),r.jc(6,"Not signed in? "),r.Nb(7,"a"),r.jc(8,"register here"),r.Mb(),r.Mb(),r.Nb(9,"form",2),r.Nb(10,"div",3),r.Nb(11,"label",4),r.jc(12,"Email"),r.Mb(),r.Nb(13,"div",5),r.Lb(14,"input",6,7),r.Mb(),r.Mb(),r.Nb(16,"div",3),r.Nb(17,"label",4),r.jc(18,"Password"),r.Mb(),r.Nb(19,"div",5),r.Lb(20,"input",8,9),r.Mb(),r.Mb(),r.Nb(22,"button",10),r.Ub("click",function(){r.ec(t);const n=r.dc(15),i=r.dc(21);return e.login(n.value,i.value)}),r.jc(23,"Login"),r.Mb(),r.Mb(),r.Nb(24,"p"),r.jc(25,"For further help "),r.Nb(26,"a"),r.jc(27,"Reach Our Support"),r.Mb(),r.Mb(),r.Mb()}2&t&&(r.Ab(22),r.Zb("ngClass",r.bc(1,mS,!0===e.isLOading)))},directives:[UE,iE,jE,k],styles:[".main[_ngcontent-%COMP%]{position:absolute;left:0;width:100%;height:100vh;display:flex;flex-direction:column;justify-content:center;align-items:center;gap:1rem;background-color:#f5f6f7}h1[_ngcontent-%COMP%]{font-weight:700;font-size:40px;padding-bottom:0}h1[_ngcontent-%COMP%], label[_ngcontent-%COMP%], p[_ngcontent-%COMP%]{color:#012970}"]}),t})();function _S(t,e){1&t&&r.Lb(0,"input",15)}function yS(t,e){if(1&t){const t=r.Ob();r.Nb(0,"button",16),r.Ub("click",function(){return r.ec(t),r.Wb(2).showInput=!1}),r.Mb()}}function vS(t,e){if(1&t&&(r.Nb(0,"div",10),r.Nb(1,"div",11),r.ic(2,_S,1,0,"input",12),r.ic(3,yS,1,0,"button",13),r.Mb(),r.Lb(4,"div",14),r.Mb()),2&t){const t=r.Wb();r.Ab(2),r.Zb("ngIf",1==t.showInput),r.Ab(1),r.Zb("ngIf",1==t.showInput)}}const bS=function(){return{color:"orange"}};function xS(t,e){if(1&t&&(r.Nb(0,"p",20),r.jc(1),r.Mb()),2&t){const t=r.Wb().$implicit;r.Zb("ngStyle",r.ac(2,bS)),r.Ab(1),r.lc(" ",t.orderstatus,"")}}function wS(t,e){if(1&t&&(r.Nb(0,"p",21),r.jc(1),r.Mb()),2&t){const t=r.Wb().$implicit;r.Ab(1),r.lc(" ",t.orderstatus,"")}}function TS(t,e){if(1&t&&(r.Nb(0,"p",22),r.jc(1),r.Mb()),2&t){const t=r.Wb().$implicit;r.Ab(1),r.lc(" ",t.orderstatus,"")}}function CS(t,e){if(1&t&&(r.Nb(0,"li"),r.Nb(1,"p",7),r.jc(2),r.Mb(),r.Nb(3,"p",7),r.jc(4),r.Mb(),r.Nb(5,"p",7),r.jc(6),r.Mb(),r.Nb(7,"p",7),r.jc(8),r.Mb(),r.ic(9,xS,2,3,"p",17),r.ic(10,wS,2,1,"p",18),r.ic(11,TS,2,1,"p",19),r.Nb(12,"p",7),r.jc(13),r.Mb(),r.Mb()),2&t){const t=e.$implicit;r.Ab(2),r.kc(t.orderid),r.Ab(2),r.kc(t.username),r.Ab(2),r.kc(t.phonenumber),r.Ab(2),r.kc(t.adress),r.Ab(1),r.Zb("ngIf","pending"==t.orderstatus),r.Ab(1),r.Zb("ngIf","canceled"==t.orderstatus),r.Ab(1),r.Zb("ngIf","started"==t.orderstatus),r.Ab(2),r.kc(t.totlaprice)}}function ES(t,e){1&t&&(r.Nb(0,"div",23),r.Nb(1,"p",24),r.jc(2,"You have no order yet!"),r.Mb(),r.Mb())}let SS=(()=>{class t{constructor(t,e){this.auth=t,this.firestore=e,this.showInput=!1,this.showInfo=!1,this.filterBy="category",this.dropDownOn1=!1,this.dropDownOn2=!1,this.chosenTopic="new",this.isCancelClicked=!1,this.isStartClicked=!1,this.orderToCancelId="",this.orderToStartId="",this.t=Date.now(),this.userid="",this.username="",this.shopname="",this.shopid="",this.loading=!0,this.destroy$=new qt.a,this.destroy1$=new qt.a,this.destroy2$=new qt.a}ngOnInit(){this.getUser().then(()=>{this.firestore.collection("orders",t=>t.orderBy("timestamp","desc")).valueChanges().pipe(GE(this.destroy2$)).subscribe(t=>{this.orders=t})})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete(),this.destroy1$.next(),this.destroy1$.complete(),this.destroy2$.next(),this.destroy2$.complete()}getUser(){return new Promise((t,e)=>{this.auth.authState.pipe(GE(this.destroy$)).subscribe(e=>{this.uid=e.uid,t()})})}showInputMeth(){this.showInput=!this.showInput}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(Ce),r.Kb(py))},t.\u0275cmp=r.Eb({type:t,selectors:[["app-orders"]],decls:26,vars:4,consts:[[1,"main-customers"],[1,"top-bar","primary"],["class","search-space",4,"ngIf"],[1,"orders"],[2,"font-weight","bold","margin-top","1rem","margin-left","50%","size","50px"],[2,"font-weight","bold","margin-left","65%"],[1,"top-table"],[1,"order-individual"],[4,"ngFor","ngForOf"],["style","height: 5rem;display: flex;flex-direction:row;align-items:center;justify-content:center;",4,"ngIf"],[1,"search-space"],[1,"search-space-top"],["type","text","class","search-input",4,"ngIf"],["class","delete","style","border-radius: 0.25rem;",3,"click",4,"ngIf"],[1,"mock-line"],["type","text",1,"search-input"],[1,"delete",2,"border-radius","0.25rem",3,"click"],["class","order-individual",3,"ngStyle",4,"ngIf"],["class","order-individual","style","color: tomato;",4,"ngIf"],["class","order-individual","style","color: rgb(68, 172, 70);",4,"ngIf"],[1,"order-individual",3,"ngStyle"],[1,"order-individual",2,"color","tomato"],[1,"order-individual",2,"color","rgb(68, 172, 70)"],[2,"height","5rem","display","flex","flex-direction","row","align-items","center","justify-content","center"],[2,"text-align","center"]],template:function(t,e){1&t&&(r.Nb(0,"div",0),r.Nb(1,"div",1),r.Nb(2,"h3"),r.jc(3,"Orders"),r.Mb(),r.Mb(),r.ic(4,vS,5,2,"div",2),r.Nb(5,"div",3),r.Nb(6,"h3",4),r.jc(7,"Today's orders"),r.Mb(),r.Nb(8,"h1",5),r.jc(9),r.Mb(),r.Nb(10,"ul"),r.Nb(11,"div",6),r.Nb(12,"p",7),r.jc(13,"Id"),r.Mb(),r.Nb(14,"p",7),r.jc(15,"To name"),r.Mb(),r.Nb(16,"p",7),r.jc(17,"To phone number"),r.Mb(),r.Nb(18,"p",7),r.jc(19,"To Address"),r.Mb(),r.Nb(20,"p",7),r.jc(21,"Order status"),r.Mb(),r.Nb(22,"p",7),r.jc(23,"Total Price $"),r.Mb(),r.Mb(),r.ic(24,CS,14,8,"li",8),r.ic(25,ES,3,0,"div",9),r.Mb(),r.Mb(),r.Mb()),2&t&&(r.Ab(4),r.Zb("ngIf",1==e.showInput),r.Ab(5),r.lc("",e.orders.length," total Orders"),r.Ab(15),r.Zb("ngForOf",e.orders),r.Ab(1),r.Zb("ngIf",0==e.orders.length))},directives:[P,M,N],styles:[".main-customers[_ngcontent-%COMP%]{width:100%;height:100%}.mock-line[_ngcontent-%COMP%]{background-color:hsla(0,0%,50.2%,.425);width:100%;margin-top:5%;margin-bottom:5%;height:1px}.top-bar[_ngcontent-%COMP%]{width:100%;height:8.5vh;background-color:#ddf1c9;display:flex;align-items:center;justify-content:space-between;padding-left:1.5rem;padding-right:1.5rem}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:17rem;margin-right:1%;border-radius:.5rem;border:none;font-size:16px;padding:4px 4px 4px 10px;animation-name:input-anim;animation-duration:.5s;transition:ease-in-out}@keyframes input-anim{0%{width:1rem}to{width:17rem}}.search-button[_ngcontent-%COMP%]{border:none;margin-right:1%;cursor:pointer;padding:7px;border-radius:.5rem;transition:.2s ease-in-out;font-weight:700;background-color:#fff}.search-button[_ngcontent-%COMP%]:hover{transform:scale(105%);background-color:#038138;color:#fff}.search-space[_ngcontent-%COMP%]{position:absolute;width:21.5rem;top:0;right:0;background-color:#f4fdeb;height:100Vh;animation-name:search-space-anim-in;animation-duration:.5s;transition:ease-in-out;box-shadow:-3px 0 5px -2px grey;z-index:5}.search-space-top[_ngcontent-%COMP%]{width:90%;margin-left:7.5%;margin-top:5%;display:flex;flex-direction:row;align-items:center;gap:.5rem}.search-input[_ngcontent-%COMP%]{border:1px solid grey}@keyframes search-space-anim-in{0%{width:1rem}to{width:21.5rem}}@keyframes search-space-anim-out{0%{width:21.5rem}to{width:0}}h3[_ngcontent-%COMP%]{padding-left:1rem;font-weight:700}.toggle-details[_ngcontent-%COMP%], .toggle-details-container[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center}.toggle-details[_ngcontent-%COMP%]{gap:1rem;margin-right:2rem}.showDetails[_ngcontent-%COMP%]{margin-left:1rem;min-width:4rem}.filter-dropdown[_ngcontent-%COMP%]{z-index:3}.filterBy-span[_ngcontent-%COMP%]{font-size:14px;text-align:center;font-weight:700;cursor:pointer}.drop-down-container[_ngcontent-%COMP%], .filterBy-span[_ngcontent-%COMP%]{width:5rem;padding:4px;background-color:#fff}.drop-down-container[_ngcontent-%COMP%]{display:flex;list-style-type:none;flex-direction:column;align-items:center;justify-content:center;position:absolute;max-height:5rem;animation-name:drop-down-anim-in;animation-duration:.2s;transition:ease-in-out;box-shadow:0 3px 3px 2px hsla(0,0%,50.2%,.445)}.drop-down-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{font-size:14px;cursor:pointer;border-bottom:1px solid hsla(0,0%,50.2%,.37);width:100%;text-align:center}.drop-down-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:last-child{border-bottom:none}.drop-down-container[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{opacity:.8}@keyframes drop-down-anim-in{0%{height:1rem}to{height:5rem}}.top-table[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;align-items:center;gap:1rem;flex-wrap:nowrap;border-bottom:1px solid hsla(0,0%,50.2%,.848);padding-top:5px;padding-bottom:5px;font-weight:700;text-align:center;position:sticky;top:0;background-color:#f4fdeb}.orders[_ngcontent-%COMP%]{overflow-y:scroll;height:100vh;padding-bottom:10%}.orders[_ngcontent-%COMP%]   ul[_ngcontent-%COMP%]{list-style-type:none;width:60%;margin:.5% 25% 25%;overflow:hidden;padding:1rem;height:56vh;overflow-y:scroll;background-color:#f4fdeb;border-radius:.5rem;box-shadow:2px 2px 5px 2px rgba(20,20,20,.096)}.orders[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;align-items:center;gap:1rem;flex-wrap:nowrap;border-bottom:1px solid rgba(77,76,76,.182);padding-top:5px;padding-bottom:5px;text-align:center;transition:.2s ease-in-out}.orders[_ngcontent-%COMP%]   li[_ngcontent-%COMP%]:hover{background-color:rgba(204,202,202,.363)}.order-individual[_ngcontent-%COMP%]{width:10rem;overflow:hidden}.cancel[_ngcontent-%COMP%]{background-color:tomato;width:5rem;cursor:pointer;border-radius:.5rem;transition:.3s ease-in-out;color:bisque}.cancel[_ngcontent-%COMP%]:hover{background-color:brown;color:#fff}.canceled[_ngcontent-%COMP%]{background-color:tomato;width:5rem;cursor:default;border-radius:.5rem;color:bisque;opacity:.4}"]}),t})(),IS=(()=>{class t{constructor(t,e){this.auth=t,this.router=e}canActivate(t,e){return new Promise((t,e)=>{this.auth.authState.subscribe(e=>{e&&"zahernajib77@gmail.com"==e.email?t(!0):(this.router.navigate(["login"]),t(!1))})})}}return t.\u0275fac=function(e){return new(e||t)(r.Rb(Ce),r.Rb(ZT))},t.\u0275prov=r.Gb({token:t,factory:t.\u0275fac,providedIn:"root"}),t})();var kS=n("4ZJM");let AS=(()=>{class t{constructor(){this.style="mapbox://styles/mapbox/streets-v11",this.lat=37.75,this.lng=-122.41}ngOnInit(){kS.accessToken="pk.eyJ1IjoiemFoZXJuYWppYiIsImEiOiJjbDJtNHkyY20wazdlM2NuazdwamV5bGMxIn0.TPaPQ_nBYCWwyeTAIvHWfw",this.map=new kS.Map({container:"map",style:this.style,zoom:13,center:[this.lng,this.lat]}),this.map.addControl(new kS.NavigationControl)}}return t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=r.Eb({type:t,selectors:[["app-map"]],decls:1,vars:0,consts:[["id","map",1,"match-parent"]],template:function(t,e){1&t&&r.Lb(0,"div",0)},styles:[".match-parent[_ngcontent-%COMP%]{width:100%;height:100vh}"]}),t})();const MS=["newIngredient"];let OS=(()=>{class t{constructor(t){this.firestore=t,this.shopname="",this.Arealocation="",this.address="",this.Description="",this.isverified=!1,this.myArray=[],this.destroy$=new qt.a}ngOnInit(){this.itemId&&this.firestore.collection("shopOwners").valueChanges().subscribe(t=>{t&&(this.item=t,console.log(t))})}ngOnDestroy(){this.destroy$.next(),this.destroy$.complete()}editname(t){this.shopname=t,console.log(t)}editQuantity(t){this.firestore.collection("items").doc(this.itemId).update({quantity:+t}).catch(t=>alert(t))}editCategory(t){this.firestore.collection("items").doc(this.itemId).update({category:t}).catch(t=>alert(t))}editTopic(t){this.firestore.collection("items").doc(this.itemId).update({topics:t}).catch(t=>alert(t))}editDescription(t){this.firestore.collection("items").doc(this.itemId).update({description:t}).catch(t=>alert(t))}submit(){this.firestore.collection("shopOwners").add({shopname:this.shopname,Arealocation:this.Arealocation,Description:this.Description,Adress:this.address,isverified:!0}).then(t=>{console.log(t)}).catch(t=>{console.log(t)})}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(py))},t.\u0275cmp=r.Eb({type:t,selectors:[["app-addshopowner"]],viewQuery:function(t,e){if(1&t&&r.mc(MS,1),2&t){let t;r.cc(t=r.Vb())&&(e.ingredientHTML=t.first)}},inputs:{itemId:"itemId"},decls:31,vars:5,consts:[[2,"font-size","20px"],["type","text","id","shopname",3,"ngModel","keyUp"],["itemPrice",""],["type","text","id","address",3,"ngModel","keyUp.enter"],["itemQuantity",""],["type","text","id","arealocation",2,"width","10rem",3,"ngModel","keyUp.enter"],["itemCategory",""],["type","text","id","description",2,"width","10rem",3,"ngModel","keyUp.enter"],["itemTopics",""],[1,"modal-card-foot"],[1,"button"],[1,"button","is-danger",3,"click"]],template:function(t,e){if(1&t){const t=r.Ob();r.Nb(0,"div"),r.Nb(1,"p",0),r.Nb(2,"strong"),r.jc(3,"Shop Name"),r.Mb(),r.Mb(),r.Nb(4,"input",1,2),r.Ub("keyUp",function(){r.ec(t);const n=r.dc(5);return e.editname(n.value)}),r.Mb(),r.Mb(),r.Nb(6,"div"),r.Nb(7,"p",0),r.Nb(8,"strong"),r.jc(9,"Address"),r.Mb(),r.Mb(),r.Nb(10,"input",3,4),r.Ub("keyUp.enter",function(){r.ec(t);const n=r.dc(11);return e.editQuantity(n.value)}),r.Mb(),r.Mb(),r.Nb(12,"div"),r.Nb(13,"p",0),r.Nb(14,"strong"),r.jc(15,"Area Location"),r.Mb(),r.Mb(),r.Nb(16,"input",5,6),r.Ub("keyUp.enter",function(){r.ec(t);const n=r.dc(17);return e.editCategory(n.value)}),r.Mb(),r.Mb(),r.Nb(18,"div"),r.Nb(19,"p",0),r.Nb(20,"strong"),r.jc(21,"Description"),r.Mb(),r.Mb(),r.Nb(22,"input",7,8),r.Ub("keyUp.enter",function(){r.ec(t);const n=r.dc(23);return e.editTopic(n.value)}),r.Mb(),r.Mb(),r.Nb(24,"footer",9),r.Nb(25,"button",10),r.jc(26,"Cancel"),r.Mb(),r.Nb(27,"button",11),r.Ub("click",function(){return e.submit()}),r.jc(28,"Update"),r.Mb(),r.Mb(),r.Nb(29,"h2"),r.jc(30),r.Mb()}2&t&&(r.Ab(4),r.Zb("ngModel",e.shopname),r.Ab(6),r.Zb("ngModel",e.address),r.Ab(6),r.Zb("ngModel",e.Arealocation),r.Ab(6),r.Zb("ngModel",e.Description),r.Ab(8),r.kc(e.shopname))},directives:[jC,rE,BE],styles:[".info[_ngcontent-%COMP%]{display:flex;flex-direction:row;align-items:center;justify-content:space-between}input[_ngcontent-%COMP%], textarea[_ngcontent-%COMP%]{width:4rem;margin-right:1%;border-radius:.5rem;border:1px solid grey;font-size:16px;padding:4px 4px 4px 10px;margin-top:.25rem;margin-bottom:.5rem}.tag[_ngcontent-%COMP%]{animation-name:ingredient-tag-in;animation-duration:.2s;transition:ease-in-out}@keyframes ingredient-tag-in{0%{width:1rem}to{width:4rem}}.prviewContainer[_ngcontent-%COMP%]{width:100%;height:20rem;overflow-x:scroll;display:flex;flex-direction:row;flex-wrap:nowrap;scroll-snap-type:x mandatory;margin-bottom:.7rem}.prviewImage[_ngcontent-%COMP%]{width:100%;height:100%;background-position:50%;background-size:cover;scroll-behavior:smooth;flex-grow:0;flex-shrink:0;scroll-snap-align:start}"]}),t})();function PS(t,e){if(1&t){const t=r.Ob();r.Nb(0,"div",12),r.Lb(1,"div",13),r.Nb(2,"div",14),r.Nb(3,"header",15),r.Nb(4,"input",16,17),r.Ub("keyUp.enter",function(){r.ec(t);const e=r.dc(5);return r.Wb().editTitle(e.value)}),r.Mb(),r.Nb(6,"button",18),r.Ub("click",function(){return r.ec(t),r.Wb().showItemModal=!1}),r.Mb(),r.Mb(),r.Nb(7,"section",19),r.Lb(8,"app-addshopowner"),r.Mb(),r.Mb(),r.Mb()}if(2&t){const t=r.Wb();r.Cb("is-active",1==t.showItemModal),r.Ab(4),r.Zb("ngModel",t.itemTitle)}}function DS(t,e){if(1&t){const t=r.Ob();r.Nb(0,"tr"),r.Lb(1,"th",20),r.Nb(2,"td"),r.jc(3),r.Mb(),r.Nb(4,"td"),r.jc(5),r.Mb(),r.Nb(6,"td"),r.jc(7),r.Mb(),r.Nb(8,"td"),r.jc(9),r.Mb(),r.Nb(10,"td"),r.Nb(11,"span",21),r.Ub("click",function(){r.ec(t);const n=e.$implicit;return r.Wb().Approve(n.uid)}),r.jc(12,"Approve"),r.Mb(),r.jc(13," \xa0 "),r.Nb(14,"span",22),r.Ub("click",function(){r.ec(t);const n=e.$implicit;return r.Wb().reject(n.uid)}),r.jc(15,"Reject"),r.Mb(),r.Mb(),r.Mb()}if(2&t){const t=e.$implicit;r.Ab(3),r.kc(t.shopname),r.Ab(2),r.kc(t.email),r.Ab(2),r.kc(t.phone),r.Ab(2),r.kc(t.Address)}}function RS(t,e){if(1&t&&(r.Nb(0,"tr"),r.Lb(1,"th",20),r.Nb(2,"td"),r.jc(3),r.Mb(),r.Nb(4,"td"),r.jc(5),r.Mb(),r.Nb(6,"td"),r.jc(7),r.Mb(),r.Nb(8,"td"),r.jc(9),r.Mb(),r.Mb()),2&t){const t=e.$implicit;r.Ab(3),r.kc(t.shopname),r.Ab(2),r.kc(t.Address),r.Ab(2),r.kc(t.areaLocation),r.Ab(2),r.kc(t.phone)}}const NS=[{path:"",component:IC,canActivate:[IS]},{path:"login",component:gS},{path:"dashboard",component:IC,canActivate:[IS]},{path:"customers",component:SC,canActivate:[IS]},{path:"orders",component:SS,canActivate:[IS]},{path:"items",component:fS,canActivate:[IS]},{path:"shopowner",component:(()=>{class t{constructor(t){this.fbs=t,this.faArrowLeft=gC,this.myArray=[],this.myArray1=[],this.showItemModal=!1}ngOnInit(){this.getVerified(),this.getunverified()}getVerified(){this.fbs.collection("shopOwners",t=>t.where("isverified","==",!0)).valueChanges().subscribe(t=>{this.myArray=t,console.log(t)})}getunverified(){this.fbs.collection("shopOwners",t=>t.where("isverified","==",!1)).valueChanges().subscribe(t=>{this.myArray1=t,console.log(t)})}changeName(t){this.shopname=t}changeAddress(t){this.shopAdress=t}changeDescription(t){this.shopDescription=t}Approve(t){this.fbs.collection("shopOwners").doc(t).update({isverified:!0}).catch(t=>{alert(t)})}reject(t){this.fbs.collection("shopOwners").doc(t).delete().catch(t=>{alert(t)})}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(py))},t.\u0275cmp=r.Eb({type:t,selectors:[["app-shopowner"]],decls:49,vars:3,consts:[["id","main",1,"main"],["class","modal",3,"is-active",4,"ngIf"],[1,"section"],[1,"row"],[1,"col-lg-12"],[1,"card"],[1,"card-body"],[2,"display","flex","flex-direction","row","justify-content","space-between","align-items","center"],[1,"card-title"],[1,"table","datatable"],["scope","col"],[4,"ngFor","ngForOf"],[1,"modal"],[1,"modal-background"],[1,"modal-card"],[1,"modal-card-head"],["type","text",1,"modal-card-title",2,"font-weight","bold","font-size","22px",3,"ngModel","keyUp.enter"],["itemTit",""],["aria-label","close",1,"delete",3,"click"],[1,"modal-card-body"],["scope","row"],[1,"badge","bg-success",2,"cursor","pointer",3,"click"],[1,"badge","bg-danger",2,"cursor","pointer",3,"click"]],template:function(t,e){1&t&&(r.Nb(0,"main",0),r.ic(1,PS,9,3,"div",1),r.Nb(2,"section",2),r.Nb(3,"div",3),r.Nb(4,"div",4),r.Nb(5,"div",5),r.Nb(6,"div",6),r.Nb(7,"div",7),r.Nb(8,"h5",8),r.jc(9," Edit Shopowners "),r.Mb(),r.Mb(),r.Nb(10,"table",9),r.Nb(11,"thead"),r.Nb(12,"tr"),r.Nb(13,"th",10),r.jc(14,"#"),r.Mb(),r.Nb(15,"th",10),r.jc(16,"ShopName"),r.Mb(),r.Nb(17,"th",10),r.jc(18,"Email"),r.Mb(),r.Nb(19,"th",10),r.jc(20,"phone"),r.Mb(),r.Nb(21,"th",10),r.jc(22,"Address"),r.Mb(),r.Nb(23,"th",10),r.jc(24,"Status"),r.Mb(),r.Mb(),r.Mb(),r.Nb(25,"tbody"),r.ic(26,DS,16,4,"tr",11),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Nb(27,"section",2),r.Nb(28,"div",3),r.Nb(29,"div",4),r.Nb(30,"div",5),r.Nb(31,"div",6),r.Nb(32,"h5",8),r.jc(33,"Shopowners"),r.Mb(),r.Nb(34,"table",9),r.Nb(35,"thead"),r.Nb(36,"tr"),r.Nb(37,"th",10),r.jc(38,"#"),r.Mb(),r.Nb(39,"th",10),r.jc(40,"ShopName"),r.Mb(),r.Nb(41,"th",10),r.jc(42,"Address"),r.Mb(),r.Nb(43,"th",10),r.jc(44,"Arealocation"),r.Mb(),r.Nb(45,"th",10),r.jc(46,"phone"),r.Mb(),r.Mb(),r.Mb(),r.Nb(47,"tbody"),r.ic(48,RS,10,4,"tr",11),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb()),2&t&&(r.Ab(1),r.Zb("ngIf",1==e.showItemModal),r.Ab(25),r.Zb("ngForOf",e.myArray1),r.Ab(22),r.Zb("ngForOf",e.myArray))},directives:[P,M,jC,rE,BE,OS],styles:[".main-customers[_ngcontent-%COMP%]{width:100%;height:100%}.mock-line[_ngcontent-%COMP%]{background-color:hsla(0,0%,50.2%,.425);width:100%;margin-top:5%;margin-bottom:5%;height:1px}.top-bar[_ngcontent-%COMP%]{height:8.5vh;align-items:center;justify-content:space-between;padding-left:1.5rem;padding-right:1.5rem}.container[_ngcontent-%COMP%], .top-bar[_ngcontent-%COMP%]{width:100%;display:flex}.container[_ngcontent-%COMP%]{flex-direction:row;flex-wrap:nowrap;padding-top:1rem}h1[_ngcontent-%COMP%]{font-weight:700;font-size:18px;margin-bottom:3rem;height:2rem;width:100%;text-align:center}.left[_ngcontent-%COMP%]{width:80%;height:91.5vh;border-right:2px solid hsla(0,0%,50.2%,.247);padding-top:1rem}form[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:column;align-items:center}label[_ngcontent-%COMP%]{font-weight:700;margin-top:1rem;margin-bottom:.5rem}input[_ngcontent-%COMP%]{border-radius:.3rem;background-color:rgba(206,211,214,.28627450980392155);border:none;padding:8px;width:30%}.right[_ngcontent-%COMP%]{width:30%;height:91.5vh;display:flex;flex-direction:column;align-items:center;padding-top:1rem}.mobile[_ngcontent-%COMP%]{width:15rem;height:28rem;border:1px solid grey;border-radius:1rem;padding:1.5%}.mobile-top-bar[_ngcontent-%COMP%]{width:100%;height:5%}.mobile-shop-title[_ngcontent-%COMP%]{padding:0;font-size:14px;margin-top:.3rem;font-weight:700}.moble-shop-address[_ngcontent-%COMP%]{font-size:10px}.mobile-shop-description[_ngcontent-%COMP%]{font-size:12px;font-weight:lighter;line-height:.85rem;margin-top:.3rem}.mobile-shop-news-image[_ngcontent-%COMP%]{width:100%;height:7rem;margin-top:.7rem;border-radius:.3rem;background-position:50%;background-size:cover;background-image:url(https://blog.businesswire.com/hubfs/Images/All%20Stock%20Images/AdobeStock_76425572-media.jpg)}"]}),t})(),canActivate:[IS]},{path:"editshop",component:AC,canActivate:[IS]},{path:"map",component:AS,canActivate:[IS]}];let LS=(()=>{class t{}return t.\u0275mod=r.Ib({type:t}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)},imports:[[aC.forRoot(NS)],aC]}),t})();function jS(t,e){if(1&t){const t=r.Ob();r.Nb(0,"header",2),r.Nb(1,"div",3),r.Nb(2,"a",4),r.Lb(3,"img",5),r.Nb(4,"span",6),r.jc(5," Go2parts Admin "),r.Mb(),r.Mb(),r.Mb(),r.Nb(6,"nav",7),r.Nb(7,"ul",8),r.Nb(8,"li",9),r.Nb(9,"a",10),r.Lb(10,"i",11),r.Mb(),r.Mb(),r.Nb(11,"li",12),r.Nb(12,"a",13),r.Lb(13,"img",14),r.Nb(14,"span",15),r.jc(15,"Admin"),r.Mb(),r.Mb(),r.Nb(16,"ul",16),r.Nb(17,"li",17),r.Nb(18,"span"),r.jc(19,"Admin"),r.Mb(),r.Mb(),r.Nb(20,"li"),r.Lb(21,"hr",18),r.Mb(),r.Nb(22,"li"),r.Nb(23,"a",19),r.Lb(24,"i",20),r.Nb(25,"span"),r.jc(26,"My Profile"),r.Mb(),r.Mb(),r.Mb(),r.Nb(27,"li"),r.Lb(28,"hr",18),r.Mb(),r.Nb(29,"li"),r.Nb(30,"a",19),r.Lb(31,"i",21),r.Nb(32,"span"),r.jc(33,"Account Settings"),r.Mb(),r.Mb(),r.Mb(),r.Nb(34,"li"),r.Lb(35,"hr",18),r.Mb(),r.Nb(36,"li"),r.Nb(37,"a",22),r.Lb(38,"i",23),r.Nb(39,"span"),r.jc(40,"Need Help?"),r.Mb(),r.Mb(),r.Mb(),r.Nb(41,"li"),r.Lb(42,"hr",18),r.Mb(),r.Nb(43,"li"),r.Nb(44,"a",24),r.Ub("click",function(){return r.ec(t),r.Wb().signOut()}),r.Lb(45,"i",25),r.Nb(46,"span"),r.jc(47,"Sign Out"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb()}}const zS=function(t){return{collapsed:t}};function FS(t,e){if(1&t){const t=r.Ob();r.Nb(0,"aside",26),r.Nb(1,"ul",27),r.Nb(2,"li",28),r.Nb(3,"a",29),r.Ub("click",function(){return r.ec(t),r.Wb().toDashboard()}),r.Lb(4,"i",30),r.Nb(5,"span"),r.jc(6,"Dashboard"),r.Mb(),r.Mb(),r.Mb(),r.Nb(7,"li",28),r.Nb(8,"a",29),r.Ub("click",function(){return r.ec(t),r.Wb().toCustomers()}),r.Lb(9,"i",31),r.Nb(10,"span"),r.jc(11,"Customers"),r.Mb(),r.Mb(),r.Mb(),r.Nb(12,"li",28),r.Nb(13,"a",29),r.Ub("click",function(){return r.ec(t),r.Wb().toShopowner()}),r.Lb(14,"i",31),r.Nb(15,"span"),r.jc(16,"Shopowners"),r.Mb(),r.Mb(),r.Mb(),r.Nb(17,"li",28),r.Nb(18,"a",29),r.Ub("click",function(){return r.ec(t),r.Wb().toOrders()}),r.Lb(19,"i",32),r.Nb(20,"span"),r.jc(21,"Orders"),r.Mb(),r.Mb(),r.Mb(),r.Nb(22,"li",28),r.Nb(23,"a",29),r.Ub("click",function(){return r.ec(t),r.Wb().toItems()}),r.Lb(24,"i",32),r.Nb(25,"span"),r.jc(26,"Items"),r.Mb(),r.Mb(),r.Mb(),r.Nb(27,"li",28),r.Nb(28,"a",29),r.Ub("click",function(){return r.ec(t),r.Wb().tomap()}),r.Lb(29,"i",32),r.Nb(30,"span"),r.jc(31,"map"),r.Mb(),r.Mb(),r.Mb(),r.Mb(),r.Mb()}if(2&t){const t=r.Wb();r.Ab(3),r.Zb("ngClass",r.bc(6,zS,"dashboard"!=t.chosen)),r.Ab(5),r.Zb("ngClass",r.bc(8,zS,"customers"!=t.chosen)),r.Ab(5),r.Zb("ngClass",r.bc(10,zS,"shopowner"!=t.chosen)),r.Ab(5),r.Zb("ngClass",r.bc(12,zS,"orders"!=t.chosen)),r.Ab(5),r.Zb("ngClass",r.bc(14,zS,"items"!=t.chosen)),r.Ab(5),r.Zb("ngClass",r.bc(16,zS,"map"!=t.chosen))}}let BS=(()=>{class t{constructor(t,e,n){this.router=t,this.auth=e,this.firestore=n,this.title="rabi3AdminApp",this.faEdit=vC,this.faBell=_C,this.faHome=xC,this.faShoppingBasket=TC,this.faHandHoldingHeart=bC,this.faCar=yC,this.faMagnet=wC,this.faUserAlt=CC,this.isUserDropClickedd=!1,this.chosen="dashboard",this.getUser().then(()=>{this.getUserData()})}getUser(){return new Promise((t,e)=>{this.auth.authState.subscribe(e=>{e&&(this.user=e,t())})})}getUserData(){return new Promise((t,e)=>{this.firestore.collection("shopOwners").doc(this.user.uid).valueChanges().subscribe(t=>{this.userData=t})})}toDashboard(){this.chosen="dashboard",this.router.navigate(["dashboard"])}toCustomers(){this.chosen="customers",this.router.navigate(["customers"])}toShopowner(){this.chosen="shopowner",this.router.navigate(["shopowner"])}toItems(){this.chosen="items",this.router.navigate(["items"])}tomap(){this.chosen="map",this.router.navigate(["map"])}toOrders(){this.chosen="orders",this.router.navigate(["orders"])}toEditshop(){this.chosen="editshop",this.isUserDropClickedd=!1,this.router.navigate(["editshop"])}signOut(){this.chosen="logout",this.auth.signOut().catch(t=>alert(t)).then(()=>{window.location.reload()})}}return t.\u0275fac=function(e){return new(e||t)(r.Kb(ZT),r.Kb(Ce),r.Kb(py))},t.\u0275cmp=r.Eb({type:t,selectors:[["app-root"]],decls:3,vars:2,consts:[["id","header","class","header fixed-top d-flex align-items-center",4,"ngIf"],["id","sidebar","class","sidebar",4,"ngIf"],["id","header",1,"header","fixed-top","d-flex","align-items-center"],[1,"d-flex","align-items-center","justify-content-between"],[1,"logo","d-flex","align-items-center"],["src","assets/img/categoryicon.png","alt",""],[1,"d-none","d-lg-block"],[1,"header-nav","ms-auto"],[1,"d-flex","align-items-center"],[1,"nav-item","d-block","d-lg-none"],["href","#",1,"nav-link","nav-icon","search-bar-toggle"],[1,"bi","bi-search"],[1,"nav-item","dropdown","pe-3"],["href","#","data-bs-toggle","dropdown",1,"nav-link","nav-profile","d-flex","align-items-center","pe-0"],["src","assets/img/profile-img.jpg","alt","Profile",1,"rounded-circle"],[1,"d-none","d-md-block","dropdown-toggle","ps-2"],[1,"dropdown-menu","dropdown-menu-end","dropdown-menu-arrow","profile"],[1,"dropdown-header"],[1,"dropdown-divider"],["href","users-profile.html",1,"dropdown-item","d-flex","align-items-center"],[1,"bi","bi-person"],[1,"bi","bi-gear"],["href","pages-faq.html",1,"dropdown-item","d-flex","align-items-center"],[1,"bi","bi-question-circle"],[1,"dropdown-item","d-flex","align-items-center",3,"click"],[1,"bi","bi-box-arrow-right"],["id","sidebar",1,"sidebar"],["id","sidebar-nav",1,"sidebar-nav"],[1,"nav-item"],[1,"nav-link",3,"ngClass","click"],[1,"bi","bi-grid"],[1,"bi","bi-box-arrow-in-right"],[1,"bi","bi-card-list"]],template:function(t,e){1&t&&(r.ic(0,jS,48,0,"header",0),r.ic(1,FS,32,18,"aside",1),r.Lb(2,"router-outlet")),2&t&&(r.Zb("ngIf",null!=e.user),r.Ab(1),r.Zb("ngIf",null!=e.user))},directives:[P,YT,k],styles:[""]}),t})(),US=(()=>{class t{}return t.\u0275mod=r.Ib({type:t,bootstrap:[BS]}),t.\u0275inj=r.Hb({factory:function(e){return new(e||t)},providers:[],imports:[[mt,LS,qE,gt.a.initializeApp(my),Ee,fy,Ve,Cr,ox]]}),t})();Object(r.T)(),pt().bootstrapModule(US).catch(t=>console.error(t))},zn8P:function(t,e){function n(t){return Promise.resolve().then(function(){var e=new Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e})}n.keys=function(){return[]},n.resolve=n,t.exports=n,n.id="zn8P"},zx2A:function(t,e,n){"use strict";n.d(e,"a",function(){return s}),n.d(e,"b",function(){return a}),n.d(e,"c",function(){return c});var r=n("7o/Q"),i=n("HDdC"),o=n("SeVD");class s extends r.a{constructor(t){super(),this.parent=t}_next(t){this.parent.notifyNext(t)}_error(t){this.parent.notifyError(t),this.unsubscribe()}_complete(){this.parent.notifyComplete(),this.unsubscribe()}}class a extends r.a{notifyNext(t){this.destination.next(t)}notifyError(t){this.destination.error(t)}notifyComplete(){this.destination.complete()}}function c(t,e){if(e.closed)return;if(t instanceof i.a)return t.subscribe(e);let n;try{n=Object(o.a)(t)(e)}catch(r){e.error(r)}return n}}},[[0,0]]]);